"use strict";var QI,__extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),__awaiter=this&&this.__awaiter||function(t,i,n,s){return new(n||(n=Promise))(function(e,o){function fulfilled(t){try{step(s.next(t))}catch(t){o(t)}}function rejected(t){try{step(s.throw(t))}catch(t){o(t)}}function step(t){t.done?e(t.value):function adopt(e){return e instanceof n?e:new n(function(t){t(e)})}(t.value).then(fulfilled,rejected)}step((s=s.apply(t,i||[])).next())})},__generator=this&&this.__generator||function(o,i){var n,s,a,t,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function verb(e){return function(t){return function step(e){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(a=2&e[0]?s.return:e[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,e[1])).done)return a;switch(s=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++,s=e[1],e=[0];continue;case 7:e=r.ops.pop(),r.trys.pop();continue;default:if(!(a=0<(a=r.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){r=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){r.label=e[1];break}if(6===e[0]&&r.label<a[1]){r.label=a[1],a=e;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(e);break}a[2]&&r.ops.pop(),r.trys.pop();continue}e=i.call(o,r)}catch(t){e=[6,t],s=0}finally{n=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};!function(t){var e=function(e){function Mesh(){var t=null!==e&&e.apply(this,arguments)||this;return t.shapeKeyGroups={},t}return __extends(Mesh,e),Mesh.prototype.addShapeKeyGroup=function(t){this.shapeKeyGroups[t.name]=t},Mesh}(BABYLON.Mesh);t.Mesh=e;var o=function(){function ShapeKeyGroup(t,e,o,i){this.shapeKeys={},this.name=e,this.mesh=t,this.indices=o,this.opositions=i}return ShapeKeyGroup.prototype._addShapeKey=function(t,e){this.shapeKeys[t]=new i(t,e,this)},ShapeKeyGroup}();t.ShapeKeyGroup=o;var i=function(){function ShapeKey(t,e,o){var m=this;this.name="",this._value=0,this._value2=0,this.computeNormals=!1,this.updatePositions=function(t){for(var e=m.shapeKeyGroup,o=e.indices,i=e.opositions,n=o.length,s=m.positions,a=m._value,r=0;r<n;r++){var c=3*r,d=i[c],p=i[c+1],l=i[c+2],u=d+(s[c]-d)*a,y=p+(s[c+1]-p)*a,g=l+(s[c+2]-l)*a;t[o[c]]=u,t[o[c+1]]=y,t[o[c+2]]=g}},this.name=t,this.positions=e,this.shapeKeyGroup=o}return Object.defineProperty(ShapeKey.prototype,"value",{get:function(){return this._value2},set:function(t){var e=this._value-t;e<.01&&-.01<e?this._value2=t:(this._value=t,this._value2=t,this.shapeKeyGroup.mesh.updateMeshPositions(this.updatePositions,this.computeNormals))},enumerable:!1,configurable:!0}),ShapeKey}();t.ShapeKey=i}(QI||(QI={}));var hamster36_1;__extends=this.__extends||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);function __(){this.constructor=t}__.prototype=e.prototype,t.prototype=new __};!function(t){var r=BABYLON,n=r.Matrix.FromValues,s=!1;function defineMaterials(t,e){if(e||(e="./"),Number(r.Engine.Version.substr(0,r.Engine.Version.lastIndexOf(".")))<2.3)throw"Babylon version too old";var o,i;s||(r.Tools.Log("In hamster36_1.defineMaterials"),e.lastIndexOf("/")+1!==e.length&&(e+="/"),t.getMaterialByID("hamster36_1.Material")||((o=new r.StandardMaterial("hamster36_1.Material",t)).ambientColor=new r.Color3(.8,.8,.8),o.diffuseColor=new r.Color3(.64,.64,.64),o.emissiveColor=new r.Color3(0,0,0),o.specularColor=new r.Color3(0,0,0),o.specularPower=50,o.alpha=1,o.backFaceCulling=!0,o.checkReadyOnlyOnce=!1),t.getMaterialByID("hamster36_1.eye")||((o=new r.StandardMaterial("hamster36_1.eye",t)).ambientColor=new r.Color3(0,0,0),o.diffuseColor=new r.Color3(0,0,0),o.emissiveColor=new r.Color3(0,0,0),o.specularColor=new r.Color3(.5,.5,.5),o.specularPower=50,o.alpha=1,o.backFaceCulling=!0,o.checkReadyOnlyOnce=!1),(i=new r.MultiMaterial("hamster36_1.Multimaterial#0",t)).subMaterials.push(t.getMaterialByID("hamster36_1.Material")),i.subMaterials.push(t.getMaterialByID("hamster36_1.eye")),s=!0)}t.defineMaterials=defineMaterials;var a=!1;function defineSkeletons(t){if(Number(r.Engine.Version.substr(0,r.Engine.Version.lastIndexOf(".")))<2.3)throw"Babylon version too old";var e,o,i;a||(r.Tools.Log("In hamster36_1.defineSkeletons"),r.Tools.Log("defining skeleton:  Armature"),e=new r.Skeleton("Armature","0",t),(o=new r.Bone("spine0",e,null,n(1,0,0,0,0,-.0164,.9999,0,0,.9999,.0164,0,0,.0142,.0141,1),n(1,0,0,0,0,-.0164,.9999,0,0,.9999,.0164,0,0,.0142,.0141,1))).length=.4146,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(1,0,0,0,0,-.0164,.9999,0,0,.9999,.0164,0,0,.0142,.0141,1)}]),o.animations.push(i),(o=new r.Bone("hip",e,e.bones[0],n(0,-1,-4e-4,0,0,-4e-4,1,0,-1,0,0,0,0,.4349,.0033,1),n(0,-1,-4e-4,0,0,-4e-4,1,0,-1,0,0,0,0,.4349,.0033,1))).length=.025,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(0,-1,-4e-4,0,0,-4e-4,1,0,-1,0,0,0,0,.4349,.0033,1)}]),o.animations.push(i),(o=new r.Bone("leg1.R",e,e.bones[1],n(-.5,-.866,0,0,.866,-.5,0,0,0,0,1,0,.019,.0062,.2302,1),n(-.5,-.866,0,0,.866,-.5,0,0,0,0,1,0,.019,.0062,.2302,1))).length=.3002,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(-.5,-.866,0,0,.866,-.5,0,0,0,0,1,0,.019,.0062,.2302,1)}]),o.animations.push(i),(o=new r.Bone("leg2.R",e,e.bones[2],n(-.3807,-.9247,0,0,.9247,-.3807,0,0,0,0,1,0,0,.3002,0,1),n(-.3807,-.9247,0,0,.9247,-.3807,0,0,0,0,1,0,0,.3002,0,1))).length=.3122,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(-.3807,-.9247,0,0,.9247,-.3807,0,0,0,0,1,0,0,.3002,0,1)}]),o.animations.push(i),(o=new r.Bone("foot.R",e,e.bones[3],n(-.6985,.7156,0,0,-.7156,-.6985,0,0,0,0,1,0,0,.3122,0,1),n(-.6985,.7156,0,0,-.7156,-.6985,0,0,0,0,1,0,0,.3122,0,1))).length=.1055,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(-.6985,.7156,0,0,-.7156,-.6985,0,0,0,0,1,0,0,.3122,0,1)}]),o.animations.push(i),(o=new r.Bone("leg1.L",e,e.bones[1],n(-.5,-.866,0,0,.866,-.5,0,0,0,0,1,0,.019,.0063,-.2302,1),n(-.5,-.866,0,0,.866,-.5,0,0,0,0,1,0,.019,.0063,-.2302,1))).length=.3002,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(-.5,-.866,0,0,.866,-.5,0,0,0,0,1,0,.019,.0063,-.2302,1)}]),o.animations.push(i),(o=new r.Bone("leg2.L",e,e.bones[5],n(-.3807,-.9247,0,0,.9247,-.3807,0,0,0,0,1,0,0,.3002,0,1),n(-.3807,-.9247,0,0,.9247,-.3807,0,0,0,0,1,0,0,.3002,0,1))).length=.3122,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(-.3807,-.9247,0,0,.9247,-.3807,0,0,0,0,1,0,0,.3002,0,1)}]),o.animations.push(i),(o=new r.Bone("foot.L",e,e.bones[6],n(-.6985,.7156,0,0,-.7156,-.6985,0,0,0,0,1,0,0,.3122,0,1),n(-.6985,.7156,0,0,-.7156,-.6985,0,0,0,0,1,0,0,.3122,0,1))).length=.1055,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(-.6985,.7156,0,0,-.7156,-.6985,0,0,0,0,1,0,0,.3122,0,1)}]),o.animations.push(i),(o=new r.Bone("spine1",e,e.bones[0],n(-1,0,0,0,0,-1,.0066,0,0,.0065,.9946,0,0,.5021,-.0054,1),n(-1,0,0,0,0,-1,.0066,0,0,.0066,1,0,0,.5021,-.0054,1))).length=.2959,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(-1,0,0,0,0,-1,.0066,0,0,.0065,.9946,0,0,.5021,-.0054,1)}]),o.animations.push(i),(o=new r.Bone("spine2",e,e.bones[8],n(1,0,0,0,0,.9999,.0128,0,0,-.0127,1.0053,0,0,.4425,-.0029,1),n(1,0,0,0,0,.9999,.0126,0,0,-.0127,1.0003,0,0,.4425,-.0029,1))).length=.2667,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(1,0,0,0,0,.9999,.0128,0,0,-.0127,1.0053,0,0,.4425,-.0029,1)}]),o.animations.push(i),(o=new r.Bone("neck",e,e.bones[9],n(1,0,0,0,0,.9991,.0416,0,0,-.0416,.9991,0,0,.3927,.0037,1),n(1,0,0,0,0,.9991,.0414,0,0,-.0414,.9988,0,0,.3927,.0036,1))).length=.1817,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(1,0,0,0,0,.9991,.0416,0,0,-.0416,.9991,0,0,.3927,.0037,1)}]),o.animations.push(i),(o=new r.Bone("head",e,e.bones[10],n(1,0,0,0,0,.9963,-.0862,0,0,.0862,.9963,0,0,.1817,0,1),n(1,0,0,0,0,.9963,-.0858,0,0,.0857,.9954,0,0,.1817,0,1))).length=.4834,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(1,0,0,0,0,.9963,-.0862,0,0,.0862,.9963,0,0,.1817,0,1)}]),o.animations.push(i),(o=new r.Bone("ears",e,e.bones[11],n(0,.5423,.8402,0,0,-.8402,.5423,0,1,0,0,0,0,-.0178,.3962,1),n(0,.5403,.8422,0,0,-.8415,.5408,0,1,0,0,0,0,-.0177,.3944,1))).length=.1301,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(0,.5423,.8402,0,0,-.8402,.5423,0,1,0,0,0,0,-.0178,.3962,1)}]),o.animations.push(i),(o=new r.Bone("mouth",e,e.bones[11],n(.9999,-.0152,-.0029,0,.0155,.977,.2128,0,-4e-4,-.2128,.9771,0,-.0022,.2798,-.1155,1),n(.9999,-.0152,-.0029,0,.0155,.9772,.2119,0,-4e-4,-.2117,.9782,0,-.0022,.2798,-.1149,1))).length=.1448,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(.9999,-.0152,-.0029,0,.0155,.977,.2128,0,-4e-4,-.2128,.9771,0,-.0022,.2798,-.1155,1)}]),o.animations.push(i),(o=new r.Bone("cheeks",e,e.bones[9],n(1,0,0,0,0,.9992,.0405,0,0,-.0405,.9992,0,0,.3243,.0382,1),n(1,0,0,0,0,.9992,.0403,0,0,-.0403,.9988,0,0,.3243,.038,1))).length=.0788,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(1,0,0,0,0,.9992,.0405,0,0,-.0405,.9992,0,0,.3243,.0382,1)}]),o.animations.push(i),(o=new r.Bone("cheek.L",e,e.bones[14],n(.9963,-.0861,-3e-4,0,.086,.9953,-.0436,0,.004,.0434,.9991,0,-.2109,-.007,-.1187,1),n(.9963,-.0861,-3e-4,0,.086,.9954,-.0433,0,.004,.0431,.999,0,-.2109,-.0069,-.1181,1))).length=.2329,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(.9963,-.0861,-3e-4,0,.086,.9953,-.0436,0,.004,.0434,.9991,0,-.2109,-.007,-.1187,1)}]),o.animations.push(i),(o=new r.Bone("cheek.R",e,e.bones[14],n(.9963,.0861,3e-4,0,-.086,.9953,-.0436,0,-.004,.0434,.9991,0,.2109,-.007,-.1187,1),n(.9963,.0861,3e-4,0,-.086,.9954,-.0433,0,-.004,.0431,.999,0,.2109,-.0069,-.1181,1))).length=.2329,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(.9963,.0861,3e-4,0,-.086,.9953,-.0436,0,-.004,.0434,.9991,0,.2109,-.007,-.1187,1)}]),o.animations.push(i),(o=new r.Bone("chest",e,e.bones[9],n(1,0,0,0,0,.9997,.0232,0,0,-.0232,.9997,0,0,.1984,-.1681,1),n(1,0,0,0,0,.9997,.0231,0,0,-.0231,.9994,0,0,.1984,-.1671,1))).length=.1619,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(1,0,0,0,0,.9997,.0232,0,0,-.0232,.9997,0,0,.1984,-.1681,1)}]),o.animations.push(i),(o=new r.Bone("shoulder",e,e.bones[9],n(0,.9996,-.0266,0,0,.0266,.9996,0,1,0,0,0,0,.2667,0,1),n(0,.9996,-.0266,0,0,.0267,.9993,0,1,0,0,0,0,.2667,0,1))).length=.0288,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(0,.9996,-.0266,0,0,.0266,.9996,0,1,0,0,0,0,.2667,0,1)}]),o.animations.push(i),(o=new r.Bone("arm1.R",e,e.bones[18],n(.7484,-.6632,0,0,-.6632,-.7484,0,0,0,0,-1,0,.1244,-.0076,.2342,1),n(.7467,-.6652,0,0,-.6652,-.7467,0,0,0,0,-1,0,.1244,-.0075,.2342,1))).length=.2567,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(.7484,-.6632,0,0,-.6632,-.7484,0,0,0,0,-1,0,.1244,-.0076,.2342,1)}]),o.animations.push(i),(o=new r.Bone("arm2.R",e,e.bones[19],n(-.0187,.9998,-.0048,0,.9998,.0187,-.0018,0,-.0018,-.0049,-1,0,0,.2567,0,1),n(-.0133,.9999,-.0048,0,.9999,.0133,-.0018,0,-.0018,-.0049,-1,0,0,.256,0,1))).length=.2209,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(-.0187,.9998,-.0048,0,.9998,.0187,-.0018,0,-.0018,-.0049,-1,0,0,.2567,0,1)}]),o.animations.push(i),(o=new r.Bone("hand.R",e,e.bones[20],n(.8363,.5408,-.0905,0,-.5434,.8394,-.0057,0,.0728,.054,.9959,0,0,.2209,0,1),n(.8372,.5393,-.0905,0,-.542,.8404,-.0058,0,.0729,.0539,.9959,0,0,.2204,0,1))).length=.0598,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(.8363,.5408,-.0905,0,-.5434,.8394,-.0057,0,.0728,.054,.9959,0,0,.2209,0,1)}]),o.animations.push(i),(o=new r.Bone("arm1.L",e,e.bones[18],n(.7484,-.6632,0,0,-.6632,-.7484,0,0,0,0,-1,0,.1244,-.0076,-.2345,1),n(.7467,-.6652,0,0,-.6652,-.7467,0,0,0,0,-1,0,.1244,-.0075,-.2345,1))).length=.2567,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(.7484,-.6632,0,0,-.6632,-.7484,0,0,0,0,-1,0,.1244,-.0076,-.2345,1)}]),o.animations.push(i),(o=new r.Bone("arm2.L",e,e.bones[22],n(-.0187,.9998,0,0,.9998,.0187,0,0,0,0,-1,0,0,.2567,0,1),n(-.0133,.9999,0,0,.9999,.0133,0,0,0,0,-1,0,0,.256,0,1))).length=.2209,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(-.0187,.9998,0,0,.9998,.0187,0,0,0,0,-1,0,0,.2567,0,1)}]),o.animations.push(i),(o=new r.Bone("hand.L",e,e.bones[23],n(.8395,.5434,0,0,-.5434,.8395,0,0,0,0,1,0,0,.2209,0,1),n(.8404,.542,0,0,-.542,.8404,0,0,0,0,1,0,0,.2204,0,1))).length=.0598,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(.8395,.5434,0,0,-.5434,.8395,0,0,0,0,1,0,0,.2209,0,1)}]),o.animations.push(i),(o=new r.Bone("spine1_1",e,e.bones[8],n(1,0,0,0,0,.9999,.0101,0,0,-.0101,.9999,0,0,.2959,0,1),n(1,0,0,0,0,1,.01,0,0,-.01,1.0001,0,0,.2959,0,1))).length=.2062,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(1,0,0,0,0,.9999,.0101,0,0,-.0101,.9999,0,0,.2959,0,1)}]),o.animations.push(i),(o=new r.Bone("belly.R",e,e.bones[25],n(-.9999,-.0154,.0027,0,-.0153,.9999,.0056,0,-.0028,.0056,-1.0054,0,.2172,.0569,-.0771,1),n(-.9999,-.0154,.0028,0,-.0153,.9999,.0056,0,-.0028,.0055,-.9997,0,.2172,.0569,-.0767,1))).length=.1996,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(-.9999,-.0154,.0027,0,-.0153,.9999,.0056,0,-.0028,.0056,-1.0054,0,.2172,.0569,-.0771,1)}]),o.animations.push(i),(o=new r.Bone("belly.L",e,e.bones[25],n(-.9999,.0154,-.0027,0,.0153,.9999,.0056,0,.0028,.0056,-1.0054,0,-.2172,.0569,-.0771,1),n(-.9999,.0154,-.0027,0,.0153,.9999,.0056,0,.0028,.0055,-.9998,0,-.2172,.0569,-.0767,1))).length=.1996,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(-.9999,.0154,-.0027,0,.0153,.9999,.0056,0,.0028,.0056,-1.0054,0,-.2172,.0569,-.0771,1)}]),o.animations.push(i),(o=new r.Bone("tail",e,e.bones[8],n(0,.5712,-.8252,0,0,-.8208,-.5743,0,-1,0,0,0,0,-.0072,-.0023,1),n(0,.5691,-.8223,0,0,-.8223,-.5691,0,-1,0,0,0,0,-.0072,-.0023,1))).length=.2649,(i=new r.Animation("anim","_matrix",24,3,1)).setKeys([{frame:3,value:n(0,.5712,-.8252,0,0,-.8208,-.5743,0,-1,0,0,0,0,-.0072,-.0023,1)}]),o.animations.push(i),e.createAnimationRange("PoseLib",1,3),a=!0)}t.defineSkeletons=defineSkeletons;var e=function(a){function hamster(t,e,o,i){a.call(this,t,e,null,i,!0),o||(o="./"),defineMaterials(e,o);var n,s=i&&null!==i;(r.Tools.Log("defining mesh: "+this.name+(s?" (cloned)":"")),this.position.x=0,this.position.y=0,this.position.z=0,this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.scaling.x=1,this.scaling.y=1,this.scaling.z=1,this.id=this.name,this.billboardMode=0,this.isVisible=!0,this.setEnabled(!0),this.checkCollisions=!1,this.receiveShadows=!1,this.castShadows=!1,s)||(defineSkeletons(e),this.skeleton=e.getLastSkeletonByID("0"),this.numBoneInfluencers=4,this.setVerticesData(r.VertexBuffer.PositionKind,new Float32Array([.1387,.2198,-.7724,.133,.2185,-.7705,.1466,.1937,-.775,.1258,.2401,-.7835,.1108,.2488,-.8068,.1059,.2464,-.8041,.1288,.1726,-.8461,.148,.167,-.825,.1436,.164,-.8226,.1209,.2377,-.7812,.1011,.2192,-.8509,.1097,.1904,-.8547,.1046,.1903,-.8524,.1005,.2386,-.8348,.0965,.2173,-.8482,.1514,.1956,-.7776,.1524,.1733,-.7955,.1567,.1758,-.7985,.0956,.2362,-.8317,.3263,.1202,7e-4,.3615,.0258,.0035,.3633,.0239,.1189,.1756,.2694,-.2846,.1749,.2604,-.1507,0,.3167,-.2876,.2049,.2469,.4647,0,.2826,.4772,0,.3009,.2469,.2022,.1738,.5836,.2208,.009,.6432,0,.0486,.7008,.2328,-.3184,-.2509,.2106,-.2595,-.1345,.2902,-.2236,-.1377,.3397,.1145,.1118,.3429,.1069,.2228,.2202,.2553,.233,.1341,.099,-.8875,.0707,.0925,-1.0239,.081,.0239,-.9939,0,-.2577,-.1444,0,-.2627,-.0941,.094,-.2604,-.0964,.1972,.2531,.1081,.1519,.0205,-.8877,.2127,.0119,-.772,.2038,.1083,-.7911,.1659,-.1069,-.6816,0,-.1433,-.6951,0,-.2038,-.5189,0,.0184,-1.0235,.2015,-.167,-.5172,.3113,-.0326,-.5071,.2515,.0014,-.6578,0,-.0209,-.9863,.0618,-.0152,-.9639,.163,.3081,-.4969,.1539,.4113,-.5546,.1149,.3357,-.6166,.3535,-.0402,-.3835,.2851,-.2039,-.3885,.1571,.3125,-.4481,.1663,.291,-.3664,0,.3251,-.3409,.2405,.4178,-.4304,.1571,.3125,-.4481,.2202,.4339,-.4546,.269,.063,-.6795,.1123,.2891,-.7405,.1688,.2406,-.708,.1897,.2884,-.5865,0,-.1141,-.7822,.1432,-.081,-.7757,.0874,-.0466,-.8848,.1556,-.2672,.173,.1535,-.2627,.0611,.0767,-.2673,.0656,.1983,-.3242,-.3451,.2326,-.3213,-.3444,.2312,-.3106,-.3195,.2179,-.2356,-.419,0,.3499,-.5006,0,.3543,-.6569,.1149,.3357,-.6166,.2543,.381,-.4175,.241,.2666,-.4309,.1571,.3125,-.4481,.241,.2666,-.4309,.3026,.1523,-.5287,.1149,.3357,-.6166,.163,.3081,-.4969,.241,.2666,-.4309,.1571,.3125,-.4481,.1539,.4113,-.5546,.1571,.3125,-.4481,.1149,.3357,-.6166,.1828,.4359,-.5012,.2202,.4339,-.4546,.241,.2666,-.4309,.2543,.381,-.4175,.241,.2666,-.4309,.163,.3081,-.4969,.2611,-.3437,-.3053,.2328,-.3184,-.2509,.2637,-.3153,-.2996,.1149,.3357,-.6166,0,.3229,-.7675,.3055,-.2167,-.2632,.312,.1018,.4419,.1357,-.1345,.7033,.2884,-.2352,.2494,.2776,-.2009,.4924,.3256,-.0666,.446,.2302,-.3286,.4749,.1578,-.2723,.285,.2666,-.314,.4092,.2376,-.3144,.3884,.3736,-.0668,.1228,.3616,-.0687,.0207,.2802,-.2282,.0455,.0606,-.2243,-.3855,0,-.2085,.6715,.1766,-.3124,.4069,0,-.258,.4639,0,-.1663,.7751,0,-.0706,.7209,.2449,-.3413,.3759,.279,-.3409,.3727,.2924,-.3422,.3039,.2071,-.3422,.2985,.214,-.3412,.3663,0,-.2714,.3187,.2057,-.3135,-.3054,.1113,-.2576,-.1444,0,-.2308,-.3877,0,-.2722,.0701,0,-.27,.193,.0384,-.27,.193,.2074,-.3437,-.3051,.2333,-.3437,-.3031,.2327,-.3443,-.3373,.2637,-.3153,-.2996,.0965,.2212,-.857,.1005,.1633,-.8986,.11,.1869,-.8684,.1564,.1956,-.7723,.1454,.2258,-.7606,.1594,.1724,-.797,.1497,.1624,-.8266,.2418,.1247,-.6867,0,.2834,-.8611,.0812,.2579,-.8356,.0604,.2024,-.9161,.1285,.1681,-.8506,.1251,.2458,-.7794,.1093,.2507,-.8067,.0982,.2409,-.8357,0,.2049,-.9478,0,.1376,-1.0237,.0393,.1337,-1.0127,0,.0791,-1.0508,.0422,-.0337,-.9471,0,-.0524,-.9525,0,-.0783,-.8909,0,-.0314,-.9738,.0466,-.0278,-.9551,0,-.0359,-.9626,0,-.0359,-.9626,.0422,-.0337,-.9471,.0379,-.0347,-.7518,0,-.0314,-.9738,0,.1169,-.6887,.0466,.1152,-.7099,.0874,-.0466,-.8848,.1019,-.0199,-.7924,.0466,-.0278,-.9551,0,-.0316,-.7274,.1241,.1703,-.8439,0,.3412,-.4445,.241,.2666,-.4309,.3521,.1426,-.2283,.241,.2666,-.4309,.3414,.1548,-.3732,.1821,-.259,-.0937,.2852,-.2238,-.1031,.3392,.1315,-.1138,.3567,-.0538,-.0855,.3517,-.0391,-.1917,.234,-.3443,-.3805,.2344,-.3331,-.3805,.1981,-.3331,-.37,.2312,-.3106,-.3195,.2662,-.3443,-.3365,.2663,-.3275,-.3392,.269,-.3443,-.3675,.198,-.3443,-.37,.2014,-.3443,-.3381,.2663,-.3275,-.3392,.2637,-.3153,-.2996,.2014,-.3443,-.3381,.198,-.3443,-.37,.1983,-.3242,-.3451,.2662,-.3443,-.3365,.269,-.3443,-.3675,0,-.2443,-.2661,.2637,-.3153,-.2996,.2312,-.3106,-.3195,.2637,-.3153,-.2996,.3703,.0388,-.1069,.1742,.2511,-.0169,0,.3134,-.1647,0,.3098,-.0419,.241,.2666,-.4309,.0804,-.241,-.265,.3738,-.0651,.2248,.2843,-.2315,.1474,0,.3051,.1025,.269,-.3331,-.3675,.2663,-.3275,-.3392,.269,-.3331,-.3675,.1981,-.3331,-.37,.2344,-.3331,-.3805,.1983,-.3242,-.3451,.198,-.3443,-.37,.1981,-.3331,-.37,.269,-.3331,-.3675,.1766,-.3124,.4069,.214,-.3412,.3663,.2081,-.3245,.3527,.2486,-.3422,.2802,.2476,-.3277,.2802,.2105,-.3318,.2985,.214,-.3412,.3663,.2071,-.3422,.2985,.279,-.3409,.3727,.2302,-.3286,.4749,.2666,-.314,.4092,.2666,-.314,.4092,.2797,-.3253,.3526,.279,-.3409,.3727,.2924,-.3422,.3039,.2924,-.3318,.3039,.2924,-.3422,.3039,.2924,-.3422,.3039,.279,-.3409,.3727,.2302,-.3286,.4749,.214,-.3412,.3663,.1766,-.3124,.4069,.2302,-.3286,.4749,.2449,-.3413,.3759,.214,-.3412,.3663,.2302,-.3286,.4749,.279,-.3409,.3727,.2449,-.3413,.3759,.2071,-.3422,.2985,.2105,-.3318,.2985,.2376,-.3144,.3884,.2439,-.3172,.352,.2797,-.3253,.3526,.2105,-.3318,.2985,.2476,-.3277,.2802,.2081,-.3245,.3527,.2376,-.3144,.3884,.2924,-.3318,.3039,.2797,-.3253,.3526,.2328,-.3184,-.2509,.2074,-.3437,-.3051,.2057,-.3135,-.3054,.2014,-.3443,-.3381,.1983,-.3242,-.3451,.2057,-.3135,-.3054,.2611,-.3437,-.3053,.2074,-.3437,-.3051,.2328,-.3184,-.2509,.2333,-.3437,-.3031,.2333,-.3437,-.3031,.2328,-.3184,-.2509,.1571,.3125,-.4481,.1828,.4359,-.5012,.1571,.3125,-.4481,.1539,.4113,-.5546,.1828,.4359,-.5012,.2202,.4339,-.4546,.2405,.4178,-.4304,.2543,.381,-.4175,.2405,.4178,-.4304,.3743,.0518,-.2172,.3698,.0573,-.3856,.3293,.0598,-.5251,-.1466,.1937,-.775,-.133,.2185,-.7705,-.1387,.2198,-.7724,-.1258,.2401,-.7835,-.1209,.2377,-.7812,-.1059,.2464,-.8041,-.1288,.1726,-.8461,-.1241,.1703,-.8439,-.1436,.164,-.8226,-.1011,.2192,-.8509,-.0965,.2173,-.8482,-.1046,.1903,-.8524,-.1005,.2386,-.8348,-.0956,.2362,-.8317,-.1524,.1733,-.7955,-.1514,.1956,-.7776,-.1567,.1758,-.7985,-.1108,.2488,-.8068,-.3263,.1202,7e-4,-.3633,.0239,.1189,-.3615,.0258,.0035,-.1756,.2694,-.2846,-.1749,.2604,-.1507,-.2049,.2469,.4647,-.2208,.009,.6432,-.2022,.1738,.5836,0,.1914,.6411,-.2328,-.3184,-.2509,-.2902,-.2236,-.1377,-.2106,-.2595,-.1345,-.2202,.2553,.233,-.3429,.1069,.2228,-.3397,.1145,.1118,-.081,.0239,-.9939,-.0707,.0925,-1.0239,-.1341,.099,-.8875,0,-.2577,-.1444,-.1113,-.2576,-.1444,-.094,-.2604,-.0964,-.1972,.2531,.1081,-.1519,.0205,-.8877,-.2038,.1083,-.7911,0,-.2038,-.5189,0,-.1433,-.6951,-.1659,-.1069,-.6816,-.2015,-.167,-.5172,-.2515,.0014,-.6578,-.0618,-.0152,-.9639,-.163,.3081,-.4969,-.1149,.3357,-.6166,-.1539,.4113,-.5546,-.3535,-.0402,-.3835,-.2851,-.2039,-.3885,-.3113,-.0326,-.5071,-.1571,.3125,-.4481,-.2405,.4178,-.4304,-.2202,.4339,-.4546,-.1571,.3125,-.4481,-.269,.063,-.6795,-.2127,.0119,-.772,-.1123,.2891,-.7405,-.1897,.2884,-.5865,-.1688,.2406,-.708,-.0874,-.0466,-.8848,-.1432,-.081,-.7757,0,-.1141,-.7822,0,-.1433,-.6951,-.0767,-.2673,.0656,-.1535,-.2627,.0611,-.1556,-.2672,.173,-.2312,-.3106,-.3195,-.2326,-.3213,-.3444,-.1983,-.3242,-.3451,-.2179,-.2356,-.419,-.1149,.3357,-.6166,-.2543,.381,-.4175,-.1571,.3125,-.4481,-.241,.2666,-.4309,-.3026,.1523,-.5287,-.241,.2666,-.4309,-.1149,.3357,-.6166,-.163,.3081,-.4969,-.241,.2666,-.4309,-.1663,.291,-.3664,-.1571,.3125,-.4481,-.1539,.4113,-.5546,-.1149,.3357,-.6166,-.1571,.3125,-.4481,-.1828,.4359,-.5012,-.2202,.4339,-.4546,-.241,.2666,-.4309,-.2543,.381,-.4175,-.163,.3081,-.4969,-.241,.2666,-.4309,-.2611,-.3437,-.3053,-.2637,-.3153,-.2996,-.2328,-.3184,-.2509,-.1149,.3357,-.6166,-.1149,.3357,-.6166,-.3055,-.2167,-.2632,-.312,.1018,.4419,-.1357,-.1345,.7033,-.3256,-.0666,.446,-.2776,-.2009,.4924,-.2884,-.2352,.2494,-.2302,-.3286,.4749,-.2843,-.2315,.1474,-.2666,-.314,.4092,-.2376,-.3144,.3884,-.3736,-.0668,.1228,-.2802,-.2282,.0455,-.0606,-.2243,-.3855,0,-.2085,.6715,0,-.258,.4639,-.1766,-.3124,.4069,0,-.2085,.6715,-.2924,-.3422,.3039,-.279,-.3409,.3727,-.2449,-.3413,.3759,-.214,-.3412,.3663,-.2071,-.3422,.2985,0,-.258,.4639,0,-.2714,.3187,0,-.2308,-.3877,0,-.2038,-.5189,0,-.2722,.0701,-.0384,-.27,.193,-.2074,-.3437,-.3051,-.2014,-.3443,-.3381,-.2327,-.3443,-.3373,-.2637,-.3153,-.2996,-.0965,.2212,-.857,-.11,.1869,-.8684,-.1005,.1633,-.8986,-.1564,.1956,-.7723,-.1454,.2258,-.7606,-.1497,.1624,-.8266,-.1594,.1724,-.797,-.2418,.1247,-.6867,-.0812,.2579,-.8356,-.0604,.2024,-.9161,-.1285,.1681,-.8506,-.1251,.2458,-.7794,-.1093,.2507,-.8067,-.1097,.1904,-.8547,-.148,.167,-.825,-.0982,.2409,-.8357,-.0393,.1337,-1.0127,0,-.0783,-.8909,-.0422,-.0337,-.9471,-.0466,-.0278,-.9551,0,-.0359,-.9626,0,-.0316,-.7274,-.0379,-.0347,-.7518,-.0466,.1152,-.7099,0,.1169,-.6887,0,-.0314,-.9738,-.1019,-.0199,-.7924,-.0874,-.0466,-.8848,-.0466,-.0278,-.9551,0,-.0316,-.7274,-.241,.2666,-.4309,-.3521,.1426,-.2283,-.3414,.1548,-.3732,-.241,.2666,-.4309,-.1821,-.259,-.0937,-.2852,-.2238,-.1031,-.3616,-.0687,.0207,-.3392,.1315,-.1138,-.3567,-.0538,-.0855,-.3517,-.0391,-.1917,-.1981,-.3331,-.37,-.2344,-.3331,-.3805,-.234,-.3443,-.3805,-.2637,-.3153,-.2996,-.2312,-.3106,-.3195,-.2662,-.3443,-.3365,-.269,-.3443,-.3675,-.2663,-.3275,-.3392,-.198,-.3443,-.37,-.234,-.3443,-.3805,-.2663,-.3275,-.3392,-.2014,-.3443,-.3381,-.1983,-.3242,-.3451,-.198,-.3443,-.37,-.269,-.3443,-.3675,-.2662,-.3443,-.3365,0,-.2443,-.2661,0,-.2308,-.3877,-.2637,-.3153,-.2996,-.2057,-.3135,-.3054,-.2637,-.3153,-.2996,-.3703,.0388,-.1069,-.1742,.2511,-.0169,-.241,.2666,-.4309,-.0804,-.241,-.265,0,-.2577,-.1444,-.3738,-.0651,.2248,-.1578,-.2723,.285,-.2663,-.3275,-.3392,-.269,-.3331,-.3675,-.269,-.3331,-.3675,-.1981,-.3331,-.37,-.1983,-.3242,-.3451,-.1981,-.3331,-.37,-.198,-.3443,-.37,-.269,-.3331,-.3675,-.1766,-.3124,.4069,-.2081,-.3245,.3527,-.214,-.3412,.3663,-.2105,-.3318,.2985,-.2476,-.3277,.2802,-.2486,-.3422,.2802,-.214,-.3412,.3663,-.2071,-.3422,.2985,-.279,-.3409,.3727,-.2666,-.314,.4092,-.2302,-.3286,.4749,-.2666,-.314,.4092,-.279,-.3409,.3727,-.2797,-.3253,.3526,-.2924,-.3318,.3039,-.2924,-.3422,.3039,-.2924,-.3422,.3039,-.279,-.3409,.3727,-.2302,-.3286,.4749,-.1766,-.3124,.4069,-.214,-.3412,.3663,-.2302,-.3286,.4749,-.214,-.3412,.3663,-.2449,-.3413,.3759,-.2302,-.3286,.4749,-.2449,-.3413,.3759,-.279,-.3409,.3727,-.2071,-.3422,.2985,-.2105,-.3318,.2985,-.2376,-.3144,.3884,-.2666,-.314,.4092,-.2797,-.3253,.3526,-.2105,-.3318,.2985,-.2081,-.3245,.3527,-.2439,-.3172,.352,-.2081,-.3245,.3527,-.1766,-.3124,.4069,-.2376,-.3144,.3884,-.2797,-.3253,.3526,-.2924,-.3318,.3039,-.2328,-.3184,-.2509,-.2057,-.3135,-.3054,-.2074,-.3437,-.3051,-.2014,-.3443,-.3381,-.2074,-.3437,-.3051,-.2057,-.3135,-.3054,-.2611,-.3437,-.3053,-.2333,-.3437,-.3031,-.2074,-.3437,-.3051,-.2333,-.3437,-.3031,-.2328,-.3184,-.2509,-.2328,-.3184,-.2509,-.2333,-.3437,-.3031,-.1828,.4359,-.5012,-.1571,.3125,-.4481,0,-.2714,.3187,0,-.27,.193,0,-.2722,.0701,0,-.2627,-.0941,-.1571,.3125,-.4481,-.1828,.4359,-.5012,-.1539,.4113,-.5546,-.2202,.4339,-.4546,-.2405,.4178,-.4304,-.2405,.4178,-.4304,-.2543,.381,-.4175,-.3743,.0518,-.2172,-.3698,.0573,-.3856,-.3293,.0598,-.5251,.2057,-.3135,-.3054,.1149,.3357,-.6166,.241,.2666,-.4309,.1149,.3357,-.6166,.2486,-.3422,.2802,.2486,-.3422,.2802,0,-.0359,-.9626,.0466,-.0278,-.9551,0,-.0314,-.9738,.0422,-.0337,-.9471,.0874,-.0466,-.8848,.0874,-.0466,-.8848,.0466,-.0278,-.9551,.198,-.3443,-.37,.2637,-.3153,-.2996,.2312,-.3106,-.3195,.234,-.3443,-.3805,.2663,-.3275,-.3392,.234,-.3443,-.3805,.269,-.3443,-.3675,.2344,-.3331,-.3805,.1981,-.3331,-.37,.2071,-.3422,.2985,.2666,-.314,.4092,.2376,-.3144,.3884,.2797,-.3253,.3526,.2081,-.3245,.3527,.2105,-.3318,.2985,.1766,-.3124,.4069,.2081,-.3245,.3527,.2376,-.3144,.3884,.2476,-.3277,.2802,.2924,-.3318,.3039,.2074,-.3437,-.3051,.2014,-.3443,-.3381,.2057,-.3135,-.3054,.2662,-.3443,-.3365,.2611,-.3437,-.3053,0,-.2627,-.0941,0,-.2577,-.1444,0,-.2038,-.5189,0,-.0783,-.8909,0,-.1141,-.7822,0,-.1141,-.7822,0,-.1433,-.6951,-.2057,-.3135,-.3054,-.1149,.3357,-.6166,-.241,.2666,-.4309,0,-.2038,-.5189,0,-.2085,.6715,0,-.258,.4639,-.2486,-.3422,.2802,-.2486,-.3422,.2802,0,-.2714,.3187,0,-.27,.193,0,-.2722,.0701,0,-.0783,-.8909,-.0422,-.0337,-.9471,0,-.0359,-.9626,-.0466,-.0278,-.9551,0,-.0314,-.9738,-.0422,-.0337,-.9471,-.0874,-.0466,-.8848,-.0874,-.0466,-.8848,-.0466,-.0278,-.9551,0,.1169,-.6887,0,-.0316,-.7274,-.198,-.3443,-.37,-.2312,-.3106,-.3195,-.2637,-.3153,-.2996,-.2663,-.3275,-.3392,-.234,-.3443,-.3805,-.269,-.3443,-.3675,0,-.2443,-.2661,-.2312,-.3106,-.3195,0,-.2443,-.2661,0,-.2577,-.1444,0,-.2714,.3187,-.2344,-.3331,-.3805,-.2344,-.3331,-.3805,-.1981,-.3331,-.37,-.2071,-.3422,.2985,-.2924,-.3422,.3039,-.2376,-.3144,.3884,-.2797,-.3253,.3526,-.2476,-.3277,.2802,-.2105,-.3318,.2985,-.2081,-.3245,.3527,-.2376,-.3144,.3884,-.2476,-.3277,.2802,-.2924,-.3318,.3039,-.1983,-.3242,-.3451,-.2014,-.3443,-.3381,-.2057,-.3135,-.3054,-.2662,-.3443,-.3365,-.2611,-.3437,-.3053,0,-.2627,-.0941,.1059,.2464,-.8041,.0956,.2362,-.8317,.117,.2382,-.8366,.1209,.2377,-.7812,.1059,.2464,-.8041,.1251,.2469,-.8109,.0965,.2173,-.8482,.1085,.2156,-.8516,.137,.2283,-.8396,.1452,.237,-.8139,.1297,.2385,-.7842,.1209,.2094,-.8534,.1504,.2101,-.8377,.1585,.2188,-.812,.1421,.2323,-.7861,.1292,.1982,-.8523,.1535,.1885,-.8314,.1616,.1973,-.8057,.1523,.2078,-.781,.1311,.1849,-.8484,.1481,.1742,-.8248,.1562,.1829,-.7991,.1277,.1763,-.8444,.1436,.164,-.8226,.1524,.1733,-.7955,.1241,.1703,-.8439,.1436,.164,-.8226,.133,.2185,-.7705,.1209,.2377,-.7812,.0965,.2173,-.8482,.1046,.1903,-.8524,.133,.2185,-.7705,.1046,.1903,-.8524,.133,.2185,-.7705,.1504,.2211,-.7849,.1046,.1903,-.8524,.133,.2185,-.7705,.1046,.1903,-.8524,.133,.2185,-.7705,.1466,.1937,-.775,.1046,.1903,-.8524,.1046,.1903,-.8524,.1241,.1703,-.8439,.1524,.1733,-.7955,.1466,.1937,-.775,-.1059,.2464,-.8041,-.1251,.2469,-.8109,-.117,.2382,-.8366,-.1209,.2377,-.7812,-.1297,.2385,-.7842,-.1085,.2156,-.8516,-.0965,.2173,-.8482,-.1452,.237,-.8139,-.137,.2283,-.8396,-.1421,.2323,-.7861,-.1209,.2094,-.8534,-.1585,.2188,-.812,-.1504,.2101,-.8377,-.1504,.2211,-.7849,-.1292,.1982,-.8523,-.1616,.1973,-.8057,-.1535,.1885,-.8314,-.1523,.2078,-.781,-.1311,.1849,-.8484,-.1562,.1829,-.7991,-.1481,.1742,-.8248,-.1466,.1937,-.775,-.1277,.1763,-.8444,-.1524,.1733,-.7955,-.1436,.164,-.8226,-.1436,.164,-.8226,-.1241,.1703,-.8439,-.133,.2185,-.7705,-.1209,.2377,-.7812,-.0965,.2173,-.8482,-.1046,.1903,-.8524,-.133,.2185,-.7705,-.1046,.1903,-.8524,-.133,.2185,-.7705,-.1046,.1903,-.8524,-.133,.2185,-.7705,-.1046,.1903,-.8524,-.133,.2185,-.7705,-.1466,.1937,-.775,-.1046,.1903,-.8524,-.1241,.1703,-.8439,-.1046,.1903,-.8524,-.1466,.1937,-.775,-.1524,.1733,-.7955,.1059,.2464,-.8041,.1209,.2377,-.7812,.0956,.2362,-.8317,.0965,.2173,-.8482,.1466,.1937,-.775,.1524,.1733,-.7955,.1436,.164,-.8226,-.0956,.2362,-.8317,-.1059,.2464,-.8041,-.1059,.2464,-.8041,-.1209,.2377,-.7812,-.0956,.2362,-.8317,-.0965,.2173,-.8482,-.1524,.1733,-.7955,-.1436,.164,-.8226]),!0),this.setVerticesData(r.VertexBuffer.NormalKind,new Float32Array([.3364,.1065,-.9357,.792,.2069,-.5744,.6045,.3612,-.71,.6917,-.1666,-.7027,.8855,-.1135,-.4505,.8629,.027,-.5047,.5163,.8563,-.0108,.3296,.9096,-.2528,.4319,.8438,-.3185,.6523,.2805,-.7041,.9853,.1342,.1058,.7508,.5438,.3749,.9492,.2922,-.1166,.9859,-.0472,-.1602,.9384,.3304,-.1006,.1093,.5375,-.8361,.3912,.7088,-.587,.2564,.8313,-.4931,.9541,.0927,-.2847,.8224,.5681,.0307,.9882,.1512,.025,.9839,.1768,-.0232,.4086,.8999,.1521,.4557,.8877,.0657,0,.9937,.1123,.5036,.821,.2689,0,.9544,.2984,0,.9995,.0326,.5264,.5661,.6343,.6529,.1313,.746,0,.297,.9549,.1123,-.9102,.3986,.1974,-.9296,.3112,.7762,-.6101,.1591,.8745,.4819,-.0536,.9047,.4189,.0779,.5234,.852,.0029,.8147,.2545,-.521,.6293,.1505,-.7624,.6357,-.3938,-.6639,0,-.9943,-.1068,0,-.9974,-.072,.0179,-.9987,-.0472,.4736,.8767,-.0841,.8043,-.2411,-.5431,.8455,-.3156,-.4308,.8385,.2692,-.4738,.5262,-.7718,-.3569,0,-.947,-.3213,0,-.9582,-.2861,0,-.5348,-.845,.4199,-.7721,-.4769,.8442,-.3655,-.392,.8221,-.4447,-.3555,0,-.7261,-.6876,.4469,-.708,-.5468,.8095,.4146,-.4156,-.0644,.788,-.6122,.3741,.9118,-.1692,.9495,-.2552,-.1822,.7645,-.4974,-.41,-.1342,.8426,.5215,.3424,.9179,.2002,0,.9861,.1658,.5784,.7269,.3702,-.1342,.8426,.5215,.3183,.9472,.0371,.9227,-.0039,-.3856,.538,.7596,-.3653,.766,.5062,-.3962,.6817,.7027,-.2037,0,-.9397,-.3419,.513,-.764,-.3911,.3,-.8295,-.471,.1438,-.9888,-.0399,.1506,-.9883,-.0255,.0508,-.9982,-.0317,-.7873,.6037,-.125,.0569,.9397,-.3372,.1617,.2076,-.9648,.202,-.7794,-.5931,0,.9952,.0973,0,.9838,-.1791,.3741,.9118,-.1692,.8227,.2228,.523,.7093,.7042,.0291,-.1342,.8426,.5215,.7093,.7042,.0291,.8627,.4128,-.292,.3741,.9118,-.1692,.8095,.4146,-.4156,.7093,.7042,.0291,-.1342,.8426,.5215,-.0644,.788,-.6122,-.1342,.8426,.5215,.3741,.9118,-.1692,.0149,.9492,-.3144,.3183,.9472,.0371,.7093,.7042,.0291,.8227,.2228,.523,.7093,.7042,.0291,.8095,.4146,-.4156,.6259,-.7231,.2922,.1123,-.9102,.3986,.9648,-.2626,-.0146,.3741,.9118,-.1692,0,.9387,-.3448,.9387,-.3441,-.0186,.8986,.3366,.2811,.4848,-.2516,.8376,.698,-.7131,-.0649,.878,-.2721,.3937,.9445,-.1086,.31,.3252,-.845,.4245,.0563,-.976,-.2101,.9709,-.1577,.1803,.2564,.1898,-.9477,.9807,-.1884,-.0525,.9724,-.224,-.0644,.6243,-.7808,-.0229,-.0371,-.9669,-.2521,0,-.8779,.4788,-.3429,-.9332,-.107,0,-.9883,.1528,0,-.3419,.9397,0,.2946,.9556,-.004,-.997,.0773,.7449,-.63,.2194,.7371,-.5938,-.3225,-.735,-.5121,-.4444,-.454,-.8909,-.0117,0,-.9991,-.0409,-.8483,-.5227,-.084,-.096,-.9952,.0168,0,-.9877,-.1564,0,-.9996,-.0269,0,-1,.0034,.0103,-.9999,-.0099,-.6339,-.7055,.3168,1e-4,-.9701,.2428,-1e-4,-.9999,.01,.9648,-.2626,-.0146,.7143,.4766,-.5124,.7583,.4174,-.5007,.7958,.4521,-.4028,.7148,.4981,-.4908,.7621,.4001,-.509,.7805,.4955,-.381,.7511,.4262,-.5041,.8396,.3897,-.3783,0,.8449,-.5349,.4936,.7218,-.4851,.5345,.6125,-.5823,.7544,.4163,-.5074,.7964,.4564,-.3968,.675,.6157,-.4064,.6478,.5614,-.5149,0,.7586,-.6515,0,.5887,-.8083,.4122,.5902,-.6941,0,-.0305,-.9995,.6197,.3147,-.7189,0,-.7786,-.6275,0,-.9306,-.366,0,-.9771,-.2127,.061,-.9862,-.1539,0,.4029,-.9152,0,.4029,-.9152,.6197,.3147,-.7189,-.3223,.7949,-.514,0,-.9771,-.2127,0,-.6864,-.7272,-.5604,-.7382,-.3754,.3,-.8295,-.471,-.9451,.2589,-.1994,.061,-.9862,-.1539,0,.6945,-.7195,.6546,.7475,-.1127,0,.9881,.1534,.7093,.7042,.0291,.83,.5525,.0758,.7093,.7042,.0291,.8737,.4757,-.1013,.1372,-.9902,.0268,.6808,-.7302,.057,.7935,.5929,.1367,.9702,-.2373,-.0494,.9667,-.2554,-.0109,.0228,-.6433,-.7653,.0378,.5371,-.8426,-.6787,.4693,-.5648,.1617,.2076,-.9648,.7127,-.6944,.0992,.8037,.5896,-.0798,.6829,-.5925,-.4273,-.6546,-.5958,-.4653,-.673,-.7307,.1149,.8037,.5896,-.0798,.9648,-.2626,-.0146,-.673,-.7307,.1149,-.6546,-.5958,-.4653,-.7873,.6037,-.125,.7127,-.6944,.0992,.6829,-.5925,-.4273,0,-.9926,-.1218,.9648,-.2626,-.0146,.1617,.2076,-.9648,.9648,-.2626,-.0146,.9958,.0705,.0586,.4735,.8807,-.0098,0,.9993,.036,0,.9995,.0305,.7093,.7042,.0291,-.2391,-.9679,-.0771,.9836,-.1547,.0929,.6214,-.7821,-.0468,0,.9999,.0118,.7244,.4897,-.4851,.8037,.5896,-.0798,.7244,.4897,-.4851,-.6787,.4693,-.5648,.0378,.5371,-.8426,-.7873,.6037,-.125,-.6546,-.5958,-.4653,-.6787,.4693,-.5648,.7244,.4897,-.4851,-.3429,-.9332,-.107,-.454,-.8909,-.0117,-.8218,.5357,-.194,.0324,-.619,-.7847,-.0052,.5935,-.8048,-.62,.6084,-.4954,-.454,-.8909,-.0117,-.735,-.5121,-.4444,.7449,-.63,.2194,.3252,-.845,.4245,.9709,-.1577,.1803,.9709,-.1577,.1803,.7103,.7009,.0644,.7449,-.63,.2194,.7371,-.5938,-.3225,.7884,.5038,-.353,.7371,-.5938,-.3225,.7371,-.5938,-.3225,.7449,-.63,.2194,.3252,-.845,.4245,-.454,-.8909,-.0117,-.3429,-.9332,-.107,.3252,-.845,.4245,-.004,-.997,.0773,-.454,-.8909,-.0117,.3252,-.845,.4245,.7449,-.63,.2194,-.004,-.997,.0773,-.735,-.5121,-.4444,-.62,.6084,-.4954,.2564,.1898,-.9477,.0127,.995,-.0989,.7103,.7009,.0644,-.62,.6084,-.4954,-.0052,.5935,-.8048,-.8218,.5357,-.194,.2564,.1898,-.9477,.7884,.5038,-.353,.7103,.7009,.0644,.1123,-.9102,.3986,-.6339,-.7055,.3168,-.8483,-.5227,-.084,-.673,-.7307,.1149,-.7873,.6037,-.125,-.8483,-.5227,-.084,.6259,-.7231,.2922,-.6339,-.7055,.3168,.1123,-.9102,.3986,1e-4,-.9701,.2428,1e-4,-.9701,.2428,.1123,-.9102,.3986,-.1342,.8426,.5215,.0149,.9492,-.3144,-.1342,.8426,.5215,-.0644,.788,-.6122,.0149,.9492,-.3144,.3183,.9472,.0371,.5784,.7269,.3702,.8227,.2228,.523,.5784,.7269,.3702,.9998,.0172,.0107,.9858,.054,-.1587,.9409,.0015,-.3387,-.6045,.3612,-.71,-.792,.2069,-.5744,-.3364,.1065,-.9357,-.6917,-.1666,-.7027,-.6523,.2805,-.7041,-.8629,.027,-.5047,-.5163,.8563,-.0108,-.6546,.7475,-.1127,-.4319,.8438,-.3185,-.9853,.1342,.1058,-.9384,.3304,-.1006,-.9492,.2922,-.1166,-.9859,-.0472,-.1602,-.9541,.0927,-.2847,-.3912,.7088,-.587,-.1093,.5375,-.8361,-.2564,.8313,-.4931,-.8855,-.1135,-.4505,-.8224,.5681,.0307,-.9839,.1768,-.0232,-.9882,.1512,.025,-.4086,.8999,.1521,-.4557,.8877,.0657,-.5036,.821,.2689,-.6529,.1313,.746,-.5264,.5661,.6343,0,.6491,.7607,-.1123,-.9102,.3986,-.7762,-.6101,.1591,-.1974,-.9296,.3112,-.5234,.852,.0029,-.9047,.4189,.0779,-.8745,.4819,-.0536,-.6357,-.3938,-.6639,-.6293,.1505,-.7624,-.8147,.2545,-.521,0,-.9943,-.1068,.096,-.9952,.0168,-.0179,-.9987,-.0472,-.4736,.8767,-.0841,-.8043,-.2411,-.5431,-.8385,.2692,-.4738,0,-.9582,-.2861,0,-.947,-.3213,-.5262,-.7718,-.3569,-.4199,-.7721,-.4769,-.8221,-.4447,-.3555,-.4469,-.708,-.5468,-.8095,.4146,-.4156,-.3741,.9118,-.1692,.0644,.788,-.6122,-.9495,-.2552,-.1822,-.7645,-.4974,-.41,-.8442,-.3655,-.392,.1342,.8426,.5215,-.5784,.7269,.3702,-.3183,.9472,.0371,.1342,.8426,.5215,-.9227,-.0039,-.3856,-.8455,-.3156,-.4308,-.538,.7596,-.3653,-.6817,.7027,-.2037,-.766,.5062,-.3962,-.3,-.8295,-.471,-.513,-.764,-.3911,0,-.9397,-.3419,0,-.947,-.3213,-.0508,-.9982,-.0317,-.1506,-.9883,-.0255,-.1438,-.9888,-.0399,-.1617,.2076,-.9648,-.0569,.9397,-.3372,.7873,.6037,-.125,-.202,-.7794,-.5931,-.3741,.9118,-.1692,-.8227,.2228,.523,.1342,.8426,.5215,-.7093,.7042,.0291,-.8627,.4128,-.292,-.7093,.7042,.0291,-.3741,.9118,-.1692,-.8095,.4146,-.4156,-.7093,.7042,.0291,-.3424,.9179,.2002,.1342,.8426,.5215,.0644,.788,-.6122,-.3741,.9118,-.1692,.1342,.8426,.5215,-.0149,.9492,-.3144,-.3183,.9472,.0371,-.7093,.7042,.0291,-.8227,.2228,.523,-.8095,.4146,-.4156,-.7093,.7042,.0291,-.6259,-.7231,.2922,-.9648,-.2626,-.0146,-.1123,-.9102,.3986,-.3741,.9118,-.1692,-.3741,.9118,-.1692,-.9387,-.3441,-.0186,-.8986,.3366,.2811,-.4848,-.2516,.8376,-.9445,-.1086,.31,-.878,-.2721,.3937,-.698,-.7131,-.0649,-.3252,-.845,.4245,-.6214,-.7821,-.0468,-.9709,-.1577,.1803,-.2564,.1898,-.9477,-.9807,-.1884,-.0525,-.6243,-.7808,-.0229,.0371,-.9669,-.2521,0,-.8779,.4788,0,-.9883,.1528,.3429,-.9332,-.107,0,-.8779,.4788,-.7371,-.5938,-.3225,-.7449,-.63,.2194,.004,-.997,.0773,.454,-.8909,-.0117,.735,-.5121,-.4444,0,-.9883,.1528,0,-.9991,-.0409,0,-.9877,-.1564,0,-.9582,-.2861,0,-.9996,-.0269,-.0103,-.9999,-.0099,.6339,-.7055,.3168,.673,-.7307,.1149,1e-4,-.9999,.01,-.9648,-.2626,-.0146,-.7143,.4766,-.5124,-.7958,.4521,-.4028,-.7583,.4174,-.5007,-.7148,.4981,-.4908,-.7621,.4001,-.509,-.7511,.4262,-.5041,-.7805,.4955,-.381,-.8396,.3897,-.3783,-.4936,.7218,-.4851,-.5345,.6125,-.5823,-.7544,.4163,-.5074,-.7964,.4564,-.3968,-.675,.6157,-.4064,-.7508,.5438,.3749,-.3296,.9096,-.2528,-.6478,.5614,-.5149,-.4122,.5902,-.6941,0,-.9306,-.366,-.6197,.3147,-.7189,-.061,-.9862,-.1539,0,.4029,-.9152,0,.6945,-.7195,.3223,.7949,-.514,.5604,-.7382,-.3754,0,-.6864,-.7272,0,-.9771,-.2127,.9451,.2589,-.1994,-.3,-.8295,-.471,-.061,-.9862,-.1539,0,.6945,-.7195,-.7093,.7042,.0291,-.83,.5525,.0758,-.8737,.4757,-.1013,-.7093,.7042,.0291,-.1372,-.9902,.0268,-.6808,-.7302,.057,-.9724,-.224,-.0644,-.7935,.5929,.1367,-.9702,-.2373,-.0494,-.9667,-.2554,-.0109,.6787,.4693,-.5648,-.0378,.5371,-.8426,-.0228,-.6433,-.7653,-.9648,-.2626,-.0146,-.1617,.2076,-.9648,-.7127,-.6944,.0992,-.6829,-.5925,-.4273,-.8037,.5896,-.0798,.6546,-.5958,-.4653,-.0228,-.6433,-.7653,-.8037,.5896,-.0798,.673,-.7307,.1149,.7873,.6037,-.125,.6546,-.5958,-.4653,-.6829,-.5925,-.4273,-.7127,-.6944,.0992,0,-.9926,-.1218,0,-.9877,-.1564,-.9648,-.2626,-.0146,.8483,-.5227,-.084,-.9648,-.2626,-.0146,-.9958,.0705,.0586,-.4735,.8807,-.0098,-.7093,.7042,.0291,.2391,-.9679,-.0771,0,-.9943,-.1068,-.9836,-.1547,.0929,-.0563,-.976,-.2101,-.8037,.5896,-.0798,-.7244,.4897,-.4851,-.7244,.4897,-.4851,.6787,.4693,-.5648,.7873,.6037,-.125,.6787,.4693,-.5648,.6546,-.5958,-.4653,-.7244,.4897,-.4851,.3429,-.9332,-.107,.8218,.5357,-.194,.454,-.8909,-.0117,.62,.6084,-.4954,.0052,.5935,-.8048,-.0324,-.619,-.7847,.454,-.8909,-.0117,.735,-.5121,-.4444,-.7449,-.63,.2194,-.9709,-.1577,.1803,-.3252,-.845,.4245,-.9709,-.1577,.1803,-.7449,-.63,.2194,-.7103,.7009,.0644,-.7884,.5038,-.353,-.7371,-.5938,-.3225,-.7371,-.5938,-.3225,-.7449,-.63,.2194,-.3252,-.845,.4245,.3429,-.9332,-.107,.454,-.8909,-.0117,-.3252,-.845,.4245,.454,-.8909,-.0117,.004,-.997,.0773,-.3252,-.845,.4245,.004,-.997,.0773,-.7449,-.63,.2194,.735,-.5121,-.4444,.62,.6084,-.4954,-.2564,.1898,-.9477,-.9709,-.1577,.1803,-.7103,.7009,.0644,.62,.6084,-.4954,.8218,.5357,-.194,-.0127,.995,-.0989,.8218,.5357,-.194,.3429,-.9332,-.107,-.2564,.1898,-.9477,-.7103,.7009,.0644,-.7884,.5038,-.353,-.1123,-.9102,.3986,.8483,-.5227,-.084,.6339,-.7055,.3168,.673,-.7307,.1149,.6339,-.7055,.3168,.8483,-.5227,-.084,-.6259,-.7231,.2922,-1e-4,-.9701,.2428,.6339,-.7055,.3168,-1e-4,-.9701,.2428,-.1123,-.9102,.3986,-.1123,-.9102,.3986,-1e-4,-.9701,.2428,-.0149,.9492,-.3144,.1342,.8426,.5215,0,-.9991,-.0409,0,-1,.0034,0,-.9996,-.0269,0,-.9974,-.072,.1342,.8426,.5215,-.0149,.9492,-.3144,.0644,.788,-.6122,-.3183,.9472,.0371,-.5784,.7269,.3702,-.5784,.7269,.3702,-.8227,.2228,.523,-.9998,.0172,.0107,-.9858,.054,-.1587,-.9409,.0015,-.3387,-.8483,-.5227,-.084,.3741,.9118,-.1692,.7093,.7042,.0291,.3741,.9118,-.1692,.0324,-.619,-.7847,.0324,-.619,-.7847,0,.4029,-.9152,.061,-.9862,-.1539,0,-.9771,-.2127,.6197,.3147,-.7189,.3,-.8295,-.471,.3,-.8295,-.471,.061,-.9862,-.1539,-.6546,-.5958,-.4653,.9648,-.2626,-.0146,.1617,.2076,-.9648,.0228,-.6433,-.7653,.8037,.5896,-.0798,.0228,-.6433,-.7653,.6829,-.5925,-.4273,.0378,.5371,-.8426,-.6787,.4693,-.5648,-.735,-.5121,-.4444,.9709,-.1577,.1803,.2564,.1898,-.9477,.7103,.7009,.0644,-.8218,.5357,-.194,-.62,.6084,-.4954,-.3429,-.9332,-.107,-.8218,.5357,-.194,.2564,.1898,-.9477,-.0052,.5935,-.8048,.7884,.5038,-.353,-.6339,-.7055,.3168,-.673,-.7307,.1149,-.8483,-.5227,-.084,.7127,-.6944,.0992,.6259,-.7231,.2922,0,-.9974,-.072,0,-.9943,-.1068,0,-.9582,-.2861,0,-.9306,-.366,0,-.9397,-.3419,0,-.9397,-.3419,0,-.947,-.3213,.8483,-.5227,-.084,-.3741,.9118,-.1692,-.7093,.7042,.0291,0,-.9582,-.2861,0,-.8779,.4788,0,-.9883,.1528,-.0324,-.619,-.7847,-.0324,-.619,-.7847,0,-.9991,-.0409,0,-1,.0034,0,-.9996,-.0269,0,-.9306,-.366,-.6197,.3147,-.7189,0,.4029,-.9152,-.061,-.9862,-.1539,0,-.9771,-.2127,-.6197,.3147,-.7189,-.3,-.8295,-.471,-.3,-.8295,-.471,-.061,-.9862,-.1539,0,-.6864,-.7272,0,.6945,-.7195,.6546,-.5958,-.4653,-.1617,.2076,-.9648,-.9648,-.2626,-.0146,-.8037,.5896,-.0798,-.0228,-.6433,-.7653,-.6829,-.5925,-.4273,0,-.9926,-.1218,-.1617,.2076,-.9648,0,-.9926,-.1218,0,-.9943,-.1068,0,-.9991,-.0409,-.0378,.5371,-.8426,-.0378,.5371,-.8426,.6787,.4693,-.5648,.735,-.5121,-.4444,-.7371,-.5938,-.3225,-.2564,.1898,-.9477,-.7103,.7009,.0644,.0052,.5935,-.8048,.62,.6084,-.4954,.8218,.5357,-.194,-.2564,.1898,-.9477,.0052,.5935,-.8048,-.7884,.5038,-.353,.7873,.6037,-.125,.673,-.7307,.1149,.8483,-.5227,-.084,-.7127,-.6944,.0992,-.6259,-.7231,.2922,0,-.9974,-.072,.8629,.027,-.5047,.9541,.0927,-.2847,.0423,.8017,-.5962,.6523,.2805,-.7041,.8629,.027,-.5047,.1986,.9778,-.0673,.9384,.3304,-.1006,-.0968,.3392,-.9357,.4653,.5798,-.6688,.6347,.7612,-.1328,.2797,.8186,.5017,.1526,.218,-.9639,.7575,.1842,-.6263,.9266,.3649,-.0907,.582,.6776,.4494,.3468,-.0521,-.9365,.826,-.27,-.4949,.9951,-.0887,.0424,.8061,.1121,.581,.3811,-.3616,-.8508,.7899,-.4602,-.4053,.9412,-.3014,.1528,.3984,-.4144,-.8182,.4319,.8438,-.3185,.3912,.7088,-.587,.6546,.7475,-.1127,.4319,.8438,-.3185,.792,.2069,-.5744,.6523,.2805,-.7041,.9384,.3304,-.1006,.9492,.2922,-.1166,.792,.2069,-.5744,.9492,.2922,-.1166,.792,.2069,-.5744,.7737,.4172,.4768,.9492,.2922,-.1166,.792,.2069,-.5744,.9492,.2922,-.1166,.792,.2069,-.5744,.6045,.3612,-.71,.9492,.2922,-.1166,.9492,.2922,-.1166,.6546,.7475,-.1127,.3912,.7088,-.587,.6045,.3612,-.71,-.8629,.027,-.5047,-.1986,.9778,-.0673,-.0423,.8017,-.5962,-.6523,.2805,-.7041,-.2797,.8186,.5017,.0968,.3392,-.9357,-.9384,.3304,-.1006,-.6347,.7612,-.1328,-.4653,.5798,-.6688,-.582,.6776,.4494,-.1526,.218,-.9639,-.9266,.3649,-.0907,-.7575,.1842,-.6263,-.7737,.4172,.4768,-.3468,-.0521,-.9365,-.9951,-.0887,.0424,-.826,-.27,-.4949,-.8061,.1121,.581,-.3811,-.3616,-.8508,-.9412,-.3014,.1528,-.7899,-.4602,-.4053,-.6045,.3612,-.71,-.3984,-.4144,-.8182,-.3912,.7088,-.587,-.4319,.8438,-.3185,-.4319,.8438,-.3185,-.6546,.7475,-.1127,-.792,.2069,-.5744,-.6523,.2805,-.7041,-.9384,.3304,-.1006,-.9492,.2922,-.1166,-.792,.2069,-.5744,-.9492,.2922,-.1166,-.792,.2069,-.5744,-.9492,.2922,-.1166,-.792,.2069,-.5744,-.9492,.2922,-.1166,-.792,.2069,-.5744,-.6045,.3612,-.71,-.9492,.2922,-.1166,-.6546,.7475,-.1127,-.9492,.2922,-.1166,-.6045,.3612,-.71,-.3912,.7088,-.587,.8629,.027,-.5047,.6523,.2805,-.7041,.9541,.0927,-.2847,.9384,.3304,-.1006,.6045,.3612,-.71,.3912,.7088,-.587,.4319,.8438,-.3185,-.9541,.0927,-.2847,-.8629,.027,-.5047,-.8629,.027,-.5047,-.6523,.2805,-.7041,-.9541,.0927,-.2847,-.9384,.3304,-.1006,-.3912,.7088,-.587,-.4319,.8438,-.3185]),!0),this.setVerticesData(r.VertexBuffer.UVKind,new Float32Array([.2272,.4586,.2256,.4595,.2209,.4541,.2282,.4655,.224,.4718,.2228,.4707,.2007,.4612,.2043,.4543,.2054,.4553,.2263,.4651,.209,.4737,.2032,.4682,.2049,.4681,.216,.4749,.2099,.4726,.2215,.4527,.2129,.4522,.2124,.4507,.2159,.4734,.5093,.3704,.5157,.3325,.5674,.3392,.395,.4428,.4459,.4407,.3951,.4993,.6627,.4483,.663,.4992,.5899,.4992,.7046,.447,.7587,.4212,.7764,.4993,.3705,.1809,.4423,.1635,.4459,.211,.557,.372,.6007,.3769,.5915,.4349,.1738,.4562,.156,.4873,.1397,.4792,.4148,.0077,.4677,.0052,.4674,.0821,.5461,.4365,.1481,.4419,.1768,.402,.2001,.4294,.1443,.3345,.0056,.3135,.0748,.1628,.1367,.5001,.2177,.256,.2775,.3262,.2144,.367,.1183,.5002,.1202,.4766,.9349,.9386,.9829,.9399,.971,.8989,.3371,.3124,.313,.2413,.337,.4548,.3652,.4492,.3755,.4993,.9549,.9931,.9255,.9466,.9663,.9843,.2268,.3905,.2464,.4711,.2486,.4502,.2908,.4471,.0049,.3889,.1198,.3834,.1014,.4435,.6767,.1599,.594,.136,.6131,.083,.9449,.056,.9458,.0419,.9568,.0427,.2799,.2147,.3215,.4994,.275,.4995,.2853,.471,.9382,.9949,.8964,.9734,.9255,.9466,.3405,.4273,.2971,.3931,.2853,.471,.321,.4538,.3405,.4273,.9255,.9466,.9837,.937,.9255,.9466,.9749,.8952,.9793,.9663,.9672,.9874,.9009,.9679,.9387,.9959,.3405,.4273,.321,.4538,.9266,.0656,.9489,.0809,.9256,.0773,.2853,.471,.2431,.4996,.3784,.2319,.6749,.4005,.8533,.4191,.6812,.2492,.7633,.3302,.7082,.3558,.8018,.2885,.7491,.1953,.7701,.2789,.7724,.264,.58,.3057,.5308,.2951,.563,.2118,.2523,.1633,.9892,.4019,.8046,.2498,.951,.2253,.9434,.4994,.8401,.4993,.9704,.0331,.9665,.0465,.9379,.0465,.9424,.012,.969,.02,.8636,.1228,.3388,.1768,.4255,.0972,.1804,.082,.6363,.0228,.7544,.0621,.7367,.0906,.9571,.0229,.9571,.0334,.9432,.0321,.3537,.1968,.2081,.4754,.1877,.4719,.1992,.4696,.223,.4512,.2316,.4571,.2121,.4496,.203,.4535,.236,.4118,.2166,.4997,.2188,.4806,.1924,.4853,.1988,.4613,.2302,.466,.2243,.4723,.2162,.4756,.1874,.4998,.1651,.4999,.1655,.4928,.1531,.5,.1057,.4785,.0912,.5004,.0459,.4724,.1111,.5003,.1112,.4793,.1047,.5002,1.1516,.0757,1.1462,.0747,1.1435,.0531,1.1259,.0794,1.1276,.044,1.1315,.0496,1.1393,.0679,1.1384,.0578,1.1323,.0772,1.1465,.0477,.2024,.4616,.3399,.4994,.3405,.4273,.4123,.3712,.3405,.4273,.3565,.3799,.4713,.1445,.4667,.2085,.4598,.3696,.4767,.2968,.4246,.3025,.8875,.0545,.8864,.0589,.8716,.0548,.3386,.1901,.9143,.0619,.9114,.0682,.9021,.0585,.931,.017,.9439,.0194,.947,.0279,.9639,.0287,.9488,.0414,.952,.0288,.9575,.0406,.9424,.0457,.9298,.0459,.2936,.0344,.3537,.1968,.3386,.1901,.3537,.1968,.4642,.3337,.498,.4401,.4407,.4992,.4871,.4992,.3405,.4273,.3267,.1059,.6246,.319,.6253,.2269,.5401,.4992,.9353,.0271,.947,.0279,.9009,.0629,.9342,.056,.9303,.0412,.9575,.0406,.952,.0288,.9565,.0299,.9009,.0629,.9632,.0503,.9379,.0486,.9394,.0397,.8733,.0539,.8712,.0594,.8556,.053,.9379,.0486,.9194,.0279,.9199,.0683,.9628,.0861,.9317,.0833,.9317,.0833,.9103,.0722,.9199,.0683,.8927,.0597,.8915,.0638,.8927,.0597,.8927,.0597,.9199,.0683,.9628,.0861,.9379,.0486,.9632,.0503,.9628,.0861,.9311,.0599,.9379,.0486,.9628,.0861,.9199,.0683,.9311,.0599,.9194,.0279,.9227,.0249,.9449,.0413,.9299,.0425,.9262,.028,.9115,.0613,.9009,.0481,.9334,.0568,.9449,.0413,.9055,.0278,.9262,.028,.9489,.0809,.9456,.0547,.9575,.0576,.9488,.0414,.9575,.0406,.9575,.0576,.9553,.0447,.9456,.0547,.9489,.0809,.9369,.0606,.9369,.0606,.9489,.0809,.9255,.9466,.9784,.9631,.9255,.9466,.9837,.937,.9784,.9631,.9672,.9874,.9554,.9958,.9387,.9959,.9554,.9958,.4152,.3385,.3451,.3473,.2874,.3618,.2213,.5451,.226,.5397,.2275,.5406,.2285,.5337,.2266,.5341,.2231,.5286,.2011,.5381,.2028,.5378,.2059,.544,.2093,.5256,.2102,.5267,.2053,.5313,.2163,.5244,.2162,.5259,.2134,.547,.2219,.5465,.2129,.5485,.2242,.5274,.5094,.6279,.5673,.659,.5158,.6656,.3952,.5558,.446,.5577,.6626,.5501,.7586,.5773,.7045,.5514,.7177,.4992,.3711,.8167,.4462,.7868,.4426,.8341,.5914,.5634,.6006,.6213,.557,.6263,.14,.5208,.1562,.5126,.1744,.5433,.4149,.9891,.4258,.9,.4675,.9151,.5461,.5618,.149,.5577,.2008,.5698,.0777,.8345,.0093,.6853,.1461,.6642,.2191,.742,.2154,.6318,.1206,.5237,.9367,.9386,.9738,.8998,.9847,.9411,.3378,.6858,.3139,.7566,.2784,.6722,.3372,.5439,.957,.9946,.9683,.9857,.9272,.9483,.2276,.6084,.1779,.5971,.2466,.528,.2911,.5517,.2489,.5489,.1029,.5563,.1216,.6158,.0084,.6111,.0093,.6853,.6126,.9145,.5937,.8617,.6762,.8379,.9568,.071,.9458,.0711,.9458,.057,.281,.783,.2854,.5279,.9403,.9965,.9272,.9483,.8984,.9753,.2976,.6056,.3408,.5713,.2854,.5279,.3212,.5449,.3408,.5713,.3654,.5494,.9272,.9483,.9854,.9383,.9763,.8965,.9272,.9483,.9804,.9674,.9678,.9882,.902,.967,.9391,.9959,.3212,.5449,.3408,.5713,.9307,.0415,.9343,.0303,.9571,.036,.2854,.5279,.2854,.5279,.3789,.766,.6748,.5979,.8531,.5795,.708,.6425,.763,.6682,.6808,.7489,.8013,.7098,.625,.7711,.7696,.7194,.7719,.7343,.5799,.6924,.5629,.786,.2536,.8341,.9888,.597,.9501,.7733,.804,.7485,.9888,.597,.9431,.0469,.9705,.0549,.9705,.0689,.9655,.0811,.9377,.0813,.9501,.7733,.8624,.8753,.1821,.9148,.0777,.8345,.6355,.9745,.7358,.9071,.9554,.0732,.9418,.0746,.9431,.062,.3544,.8008,.2083,.524,.1995,.5298,.1881,.5276,.2234,.548,.232,.5421,.2035,.5458,.2126,.5497,.2366,.5872,.219,.5187,.1925,.5142,.1992,.5381,.2305,.5331,.2245,.527,.2036,.5311,.2047,.545,.2164,.5237,.1656,.507,.0477,.5288,.1065,.5219,.1116,.5212,1.1268,.0775,1.1292,.0491,1.1327,.0542,1.1443,.0496,1.1477,.0436,1.1528,.0787,1.1382,.0584,1.1383,.0685,1.1461,.0771,1.1292,.0491,.3408,.5713,.4126,.6271,.3569,.6186,.3408,.5713,.4714,.853,.4669,.7893,.5309,.703,.46,.6287,.4769,.7012,.425,.6956,.8757,.0303,.891,.0322,.8903,.0367,.3544,.8008,.3393,.8076,.9179,.0402,.9053,.0386,.9176,.0333,.9287,.075,.9256,.0601,.9462,.0852,.9418,.0724,.9495,.0765,.9399,.0853,.932,.0463,.9445,.0484,.2944,.9623,.1821,.9148,.3544,.8008,.3396,.8208,.3544,.8008,.4644,.6645,.498,.5583,.3408,.5713,.3275,.8912,.4149,.9891,.6245,.6792,.7484,.8027,.9462,.0852,.9345,.0853,.9059,.0341,.9351,.0564,.9495,.0765,.9444,.086,.9399,.0853,.9059,.0341,.9521,.0484,.9283,.0587,.9268,.0497,.8446,.0444,.8603,.0382,.8623,.0437,.9268,.0497,.9081,.0702,.9091,.0299,.9211,.0149,.9521,.0125,.9211,.0149,.9091,.0299,.8996,.0258,.8806,.034,.8818,.0381,.8818,.0381,.9091,.0299,.9521,.0125,.9521,.0484,.9268,.0497,.9521,.0125,.9268,.0497,.9202,.0384,.9521,.0125,.9202,.0384,.9091,.0299,.9081,.0702,.9114,.0732,.9453,.0415,.9581,.0485,.9392,.0636,.9069,.0469,.9267,.0366,.933,.05,.9267,.0366,.9422,.0157,.9453,.0415,.9392,.0636,.9232,.0767,.9571,.036,.9561,.0608,.944,.0589,.9418,.0724,.944,.0589,.9561,.0608,.957,.0515,.957,.0628,.944,.0589,.9382,.0501,.9571,.036,.9571,.036,.9382,.0501,.9803,.9644,.9272,.9483,.8624,.8753,.7534,.9356,.6355,.9745,.4675,.9917,.9272,.9483,.9803,.9644,.9854,.9383,.9678,.9882,.9558,.9963,.9558,.9963,.9391,.9959,.4155,.6597,.3457,.6511,.2881,.6367,.9618,.0535,.2853,.471,.3405,.4273,.2853,.471,.9319,.0271,.9319,.0271,1.1516,.0757,1.1323,.0772,1.1259,.0794,1.1462,.0747,1.1393,.0679,1.1393,.0679,1.1323,.0772,.8728,.0504,.3537,.1968,.3386,.1901,.9256,.0313,.947,.0279,.9256,.0313,.9298,.0459,.9303,.0412,.9342,.056,.8556,.0485,.9503,.0278,.9449,.0413,.9262,.028,.9334,.0568,.9115,.0613,.9586,.0633,.9334,.0568,.9449,.0413,.9009,.0481,.9055,.0278,.9456,.0547,.9488,.0414,.9575,.0576,.9424,.0457,.9553,.0447,.4675,.9917,.4149,.9891,.0777,.8345,.0477,.5288,.0084,.6111,.0084,.6111,.0093,.6853,.9624,.0605,.2854,.5279,.3408,.5713,.0777,.8345,.9888,.597,.9501,.7733,.9319,.0638,.9319,.0638,.8624,.8753,.7534,.9356,.6355,.9745,.0477,.5288,1.1321,.076,1.1268,.0775,1.1461,.0771,1.1528,.0787,1.1321,.076,1.1383,.0685,1.1383,.0685,1.1461,.0771,1.1477,.0436,1.1292,.0491,.8751,.0348,.3393,.8076,.9631,.0853,.9462,.0852,.9256,.0601,.932,.0463,.2944,.9623,.3393,.8076,.2944,.9623,.4149,.9891,.8624,.8753,.9303,.071,.9303,.071,.9351,.0564,.8445,.0489,.8818,.0381,.9453,.0415,.9392,.0636,.9069,.0639,.9069,.0469,.9267,.0366,.9453,.0415,.9069,.0639,.9232,.0767,.9495,.0765,.9418,.0724,.9561,.0608,.9445,.0484,.957,.0515,.4675,.9917,1.3107,.408,1.3026,.408,1.3043,.4035,1.3167,.4033,1.3107,.408,1.3097,.4034,1.2973,.4041,1.2989,.4014,1.3048,.3994,1.3093,.3993,1.3152,.4014,1.2998,.3988,1.3049,.3958,1.3093,.3957,1.3143,.3987,1.3,.3961,1.3046,.392,1.3097,.3919,1.3149,.3934,1.2993,.3935,1.304,.3885,1.3104,.3886,1.2981,.3916,1.3029,.3859,1.3107,.3859,1.2967,.3904,1.3029,.3859,1.3193,.3972,1.3167,.4033,1.2973,.4041,1.2942,.3974,1.3193,.3972,1.2942,.3974,1.3193,.3972,1.3142,.3961,1.2942,.3974,1.3193,.3972,1.2942,.3974,1.3193,.3972,1.317,.3902,1.2942,.3974,1.2942,.3974,1.2967,.3904,1.3107,.3859,1.317,.3902,1.3108,.3635,1.3098,.3682,1.3043,.3681,1.3167,.3683,1.3152,.3701,1.2989,.3701,1.2973,.3674,1.3093,.3722,1.3048,.3721,1.3143,.3728,1.2998,.3727,1.3093,.3758,1.3049,.3757,1.3142,.3755,1.3,.3754,1.3097,.3796,1.3046,.3795,1.3149,.3781,1.2993,.378,1.3104,.3829,1.3039,.3831,1.317,.3814,1.2981,.3799,1.3107,.3857,1.3028,.3857,1.3028,.3857,1.2967,.3811,1.3193,.3744,1.3167,.3683,1.2973,.3674,1.2942,.3741,1.3193,.3744,1.2942,.3741,1.3193,.3744,1.2942,.3741,1.3193,.3744,1.2942,.3741,1.3193,.3744,1.317,.3814,1.2942,.3741,1.2967,.3811,1.2942,.3741,1.317,.3814,1.3107,.3857,1.3107,.408,1.3167,.4033,1.3026,.408,1.2973,.4041,1.317,.3902,1.3107,.3859,1.3029,.3859,1.3026,.3635,1.3108,.3635,1.3108,.3635,1.3167,.3683,1.3026,.3635,1.2973,.3674,1.3107,.3857,1.3028,.3857]),!1),this.setVerticesData(r.VertexBuffer.ColorKind,new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]),!1),this.setVerticesData(r.VertexBuffer.MatricesWeightsKind,new Float32Array([.8687,.0196,.0558,0,.8733,.0167,.0533,0,.8707,.0058,.0044,.0589,.8799,.0229,.04,0,.8971,.012,.0213,0,.898,.0097,.022,0,.9108,.0154,.0172,0,.892,.0234,.0412,0,.8939,.0198,.0391,0,.8828,.0187,.0391,0,.923,.0019,0,0,.922,.0019,.0048,0,.9205,.001,.0064,0,.9153,.0065,0,0,.9205,.0046,0,0,.8663,.0066,.0058,.062,.8782,.017,.0546,0,.8748,.0205,.0567,0,.9138,.0088,0,0,.6609,.0832,.0792,.0717,.7729,.0679,.0579,.0074,.2011,.0175,.6817,0,.4091,.2321,.1502,.0598,.4554,.1505,.1166,.093,.4502,.3028,.0542,.0467,.6804,.1572,.0602,.0207,.5031,.1533,.1533,.1277,.5562,.1609,.0732,.0732,.0103,.7209,.0602,.1554,.6649,.036,.2525,0,.0629,.0629,.8451,0,.9835,0,0,0,.049,.9072,0,0,.9369,.0078,0,0,.5923,.2122,.0718,.0377,.6286,.0691,.0218,.2116,.3969,.2695,.1537,.0832,.8978,.068,0,0,.9864,0,0,0,.9551,.0266,0,0,.8043,.0741,.074,0,.7466,.0712,.0711,7e-4,.006,.5246,.3186,.0568,.4072,.1699,.1461,.1167,.7783,.1805,.0153,0,.6627,.1727,.1483,0,.8064,.0711,.0999,0,.4562,.2641,.2484,0,.7472,.1499,.0194,.0193,.4001,.2053,.1408,.1118,.9902,0,0,0,.8218,.0731,.0212,.0082,.063,.8858,0,0,.37,.0914,.5106,0,.9502,.0466,0,0,.8647,.1266,0,0,.0529,.4368,.343,.1345,.0543,.4559,.3697,.0871,.0366,.6893,.1568,.0762,.8618,.0648,.0041,0,.6804,.0096,.2563,0,.1189,.5325,.1801,.1096,.429,.2343,.1356,.1054,.4563,.309,.0653,.0355,.0637,.3668,.4259,.1081,.1189,.5325,.1801,.1096,.0615,.3736,.4293,.101,.553,.0644,.3484,0,.8532,.0569,.0408,0,.8068,.0606,.0864,0,.0256,.6323,.1497,.153,.9804,0,0,0,.3117,.5804,.0939,0,.3878,.5794,0,0,.6971,.1044,.0453,.0157,.4231,.2343,.1433,.0755,.3275,.1586,.1431,.0827,.1173,.8804,0,0,.0573,.9417,0,0,.9367,.0411,0,0,.6322,.1075,.2163,0,.6876,.104,.0992,.0254,.8006,.0936,.0141,.0076,.0366,.6893,.1568,.0762,.0682,.373,.3999,.1209,.0971,.4455,.1546,.2457,.1189,.5325,.1801,.1096,.0971,.4455,.1546,.2457,.2653,.0411,.624,0,.0366,.6893,.1568,.0762,.0529,.4368,.343,.1345,.0971,.4455,.1546,.2457,.1189,.5325,.1801,.1096,.0543,.4559,.3697,.0871,.1189,.5325,.1801,.1096,.0366,.6893,.1568,.0762,.0584,.3979,.4174,.0928,.0615,.3736,.4293,.101,.0971,.4455,.1546,.2457,.0682,.373,.3999,.1209,.0971,.4455,.1546,.2457,.0529,.4368,.343,.1345,.5245,.4742,0,0,.9835,0,0,0,.9569,.0199,0,0,.0366,.6893,.1568,.0762,.8847,.0428,0,0,.1147,.8585,0,0,.9167,0,0,0,.1037,.0511,.8187,0,.0066,.9293,0,0,.2178,.6023,.0984,.0776,.8322,.1059,0,0,.5409,.4327,0,0,.0015,.8187,.0662,.0142,.8383,.1528,0,0,.0371,.9549,0,0,.1955,.0904,.6646,0,.7981,.0546,.0509,.0283,.2173,.1704,.5519,0,.6624,.1127,.0894,.0639,5e-4,.9202,0,0,.7851,.1678,0,0,.3612,.2013,.1691,.1691,.9921,0,0,0,.9653,0,0,0,.014,.9672,0,0,.1619,.8376,0,0,.9766,0,0,0,.9981,0,0,0,.0021,.9725,0,0,.3204,.2204,.2204,.0707,.9513,.004,0,0,.3793,.5357,.0016,0,.7274,.0681,.053,.053,.1627,.1543,.1421,.1421,.2215,.2073,.2073,.0941,.2943,.2065,.1449,.0902,.526,.471,0,0,.5,.4997,0,0,.988,0,0,0,.9569,.0199,0,0,.9268,0,0,0,.9401,.0078,0,0,.9275,.0028,0,0,.86,.0088,.006,.0667,.8575,.0291,.0612,0,.8717,.0235,.0586,0,.8908,.0269,.0424,0,.6712,.0327,.2421,0,.9316,0,0,0,.9194,0,0,0,.9541,0,0,0,.9122,.0179,.0149,0,.8779,.0259,.0403,0,.8971,.0126,.0206,0,.9162,.0051,0,0,.9668,0,0,0,.9893,0,0,0,.9857,0,0,0,.9938,0,0,0,.0729,.9218,0,0,.9964,0,0,0,.9884,0,0,0,.9302,.0694,0,0,.8568,.1348,0,0,.0032,.972,0,0,.0032,.972,0,0,.0729,.9218,0,0,.0896,.8696,0,0,.9302,.0694,0,0,.6282,.1383,.1016,.0658,.6299,.1255,.1096,.0822,.3878,.5794,0,0,.2302,2e-4,.7059,8e-4,.8568,.1348,0,0,.0822,.8695,0,0,.9105,.0129,.0179,0,.6307,.1473,.0974,.0292,.0971,.4455,.1546,.2457,.0848,.055,.5855,.1933,.0971,.4455,.1546,.2457,.6618,.1442,.0586,.0516,.0182,.136,.7313,.0718,.8798,.0744,0,0,.5345,.2362,.0852,.0475,.1534,.1224,.676,0,.6424,.1348,.1868,0,.9986,0,0,0,.9971,0,0,0,.0351,.9567,0,0,.9367,.0411,0,0,.096,.9035,0,0,.1356,.863,0,0,.0228,.9633,0,0,.0215,.9637,0,0,.1027,.8961,0,0,.1356,.863,0,0,.9569,.0199,0,0,.1027,.8961,0,0,.0215,.9637,0,0,.1173,.8804,0,0,.096,.9035,0,0,.0228,.9633,0,0,.8714,.0414,.0414,0,.9569,.0199,0,0,.9367,.0411,0,0,.9569,.0199,0,0,.0102,.2431,.0498,.6093,.4133,.2043,.1507,.071,.5674,.1248,.1134,.0117,.4602,.2483,.0721,.0527,.0971,.4455,.1546,.2457,.7122,.219,0,0,.7161,.1104,.1475,0,.0023,.7792,.0154,.1352,.4586,.1996,.1425,.0259,.0388,.9552,0,0,.1356,.863,0,0,.0388,.9552,0,0,.0351,.9567,0,0,.9971,0,0,0,.1173,.8804,0,0,.0215,.9637,0,0,.0351,.9567,0,0,.0388,.9552,0,0,.7851,.1678,0,0,.0021,.9725,0,0,.9817,0,0,0,.9975,0,0,0,.9973,0,0,0,.9983,0,0,0,.0021,.9725,0,0,.9981,0,0,0,.1619,.8376,0,0,.5409,.4327,0,0,.8383,.1528,0,0,.8383,.1528,0,0,.0615,.9383,0,0,.1619,.8376,0,0,.9766,0,0,0,.977,0,0,0,.9766,0,0,0,.9766,0,0,0,.1619,.8376,0,0,.5409,.4327,0,0,.0021,.9725,0,0,.7851,.1678,0,0,.5409,.4327,0,0,.014,.9672,0,0,.0021,.9725,0,0,.5409,.4327,0,0,.1619,.8376,0,0,.014,.9672,0,0,.9981,0,0,0,.9983,0,0,0,.0371,.9549,0,0,.9911,0,0,0,.0615,.9383,0,0,.9983,0,0,0,.9973,0,0,0,.9817,0,0,0,.0371,.9549,0,0,.977,0,0,0,.0615,.9383,0,0,.9835,0,0,0,.526,.471,0,0,.9513,.004,0,0,.1027,.8961,0,0,.1173,.8804,0,0,.9513,.004,0,0,.5245,.4742,0,0,.526,.471,0,0,.9835,0,0,0,.5,.4997,0,0,.5,.4997,0,0,.9835,0,0,0,.1189,.5325,.1801,.1096,.0584,.3979,.4174,.0928,.1189,.5325,.1801,.1096,.0543,.4559,.3697,.0871,.0584,.3979,.4174,.0928,.0615,.3736,.4293,.101,.0637,.3668,.4259,.1081,.0682,.373,.3999,.1209,.0637,.3668,.4259,.1081,.0169,.662,.0498,.196,.0664,.81,.0046,.0377,.1481,.7805,0,0,.8709,.0058,.0039,.0589,.8734,.0167,.0533,0,.8689,.0196,.0558,0,.88,.0229,.0401,0,.883,.0187,.0391,0,.8981,.0097,.0221,0,.911,.0148,.0173,0,.9107,.0124,.018,0,.8942,.0191,.0392,0,.9232,.002,0,0,.9206,.0047,0,0,.9206,6e-4,.0065,0,.9154,.0065,0,0,.9139,.0088,0,0,.8784,.0163,.0546,0,.8665,.0067,.0052,.0621,.8751,.0198,.0568,0,.8972,.012,.0213,0,.6609,.0832,.0792,.0717,.2011,.0175,.6817,0,.773,.0679,.0579,.0074,.4091,.2321,.1502,.0598,.4554,.1505,.1166,.093,.6804,.1572,.0602,.0207,.6649,.0359,.2525,0,.7209,.0103,.0602,.1554,.1246,.1246,.0924,.6394,.9835,0,0,0,.9366,.0081,0,0,.0486,.9075,0,0,.3969,.2695,.1537,.0832,.6286,.0691,.0218,.2116,.5923,.2122,.0718,.0377,.9553,.0262,0,0,.9865,0,0,0,.8981,.0675,0,0,.8043,.0741,.074,0,.3788,.5362,.0015,0,.006,.5244,.3189,.0568,.4072,.1699,.1461,.1167,.7791,.1793,.0157,0,.807,.0703,.1001,0,.4001,.2053,.1408,.1118,.7472,.1499,.0194,.0193,.458,.2618,.2489,0,.8219,.0732,.0211,.0077,.3707,.0904,.5108,0,.8651,.126,0,0,.0529,.4369,.343,.1345,.0366,.6893,.1568,.0763,.0543,.4559,.3697,.0871,.8618,.0648,.0041,0,.6804,.0096,.2562,0,.0631,.8859,0,0,.1189,.5326,.1801,.1096,.0637,.3668,.4259,.1081,.0615,.3737,.4293,.101,.1189,.5326,.1801,.1096,.5536,.0637,.3486,0,.6644,.1704,.1488,0,.8533,.0569,.0409,0,.0256,.6323,.1497,.1531,.8069,.0606,.0865,0,.39,.5765,0,0,.318,.572,.0958,0,.9804,0,0,0,.7472,.1499,.0194,.0193,.3275,.1586,.143,.0828,.4231,.2343,.1434,.0754,.6971,.1044,.0453,.0157,.9364,.0415,0,0,.0572,.9418,0,0,.1171,.8806,0,0,.6323,.1075,.2162,0,.0366,.6893,.1568,.0763,.0682,.373,.3999,.1209,.1189,.5326,.1801,.1096,.0971,.4455,.1546,.2457,.2654,.0411,.624,0,.0971,.4455,.1546,.2457,.0366,.6893,.1568,.0763,.0529,.4369,.343,.1345,.0971,.4455,.1546,.2457,.429,.2343,.1356,.1054,.1189,.5326,.1801,.1096,.0543,.4559,.3697,.0871,.0366,.6893,.1568,.0763,.1189,.5326,.1801,.1096,.0584,.3979,.4174,.0928,.0615,.3737,.4293,.101,.0971,.4455,.1546,.2457,.0682,.373,.3999,.1209,.0529,.4369,.343,.1345,.0971,.4455,.1546,.2457,.5244,.4743,0,0,.9571,.0195,0,0,.9835,0,0,0,.0366,.6893,.1568,.0763,.0366,.6893,.1568,.0763,.1148,.8584,0,0,.9167,0,0,0,.1037,.0511,.8187,0,.8322,.1059,0,0,.2178,.6023,.0984,.0776,.0066,.9293,0,0,.5409,.4327,0,0,.0023,.7792,.0154,.1352,.8383,.1528,0,0,.0371,.9549,0,0,.1955,.0904,.6646,0,.2173,.1704,.5519,0,.6623,.1127,.0894,.0639,5e-4,.9202,0,0,.3612,.2013,.1691,.1691,.7851,.1678,0,0,5e-4,.9202,0,0,.9766,0,0,0,.1619,.8376,0,0,.014,.9672,0,0,.0021,.9725,0,0,.9981,0,0,0,.3612,.2013,.1691,.1691,.3204,.2204,.2204,.0707,.7274,.0681,.053,.053,.4001,.2053,.1408,.1118,.1627,.1543,.1421,.1421,.2943,.2065,.1449,.0902,.5261,.4708,0,0,.1026,.8963,0,0,.988,0,0,0,.9571,.0195,0,0,.9269,0,0,0,.9277,.0024,0,0,.9402,.0074,0,0,.8602,.0088,.0055,.0667,.8577,.0291,.0613,0,.8911,.0262,.0426,0,.872,.0228,.0587,0,.6716,.0318,.2422,0,.9194,0,0,0,.9542,0,0,0,.9124,.0173,.015,0,.878,.0259,.0404,0,.8972,.0126,.0207,0,.9222,.0015,.0048,0,.8923,.0228,.0413,0,.9163,.0051,0,0,.9857,0,0,0,.9884,0,0,0,.0732,.9213,0,0,.8572,.1343,0,0,.0032,.972,0,0,.0822,.8695,0,0,.0941,.8631,0,0,.6285,.1265,.1098,.0825,.6282,.1383,.1016,.0658,.9302,.0694,0,0,.2352,.0015,.6991,.0024,.39,.5765,0,0,.8572,.1343,0,0,.0822,.8695,0,0,.0971,.4455,.1546,.2457,.0848,.055,.5855,.1933,.6618,.1442,.0586,.0516,.0971,.4455,.1546,.2457,.0181,.1357,.7318,.0717,.8795,.0746,0,0,.7981,.0546,.0509,.0283,.5345,.2362,.0852,.0475,.1534,.1223,.676,0,.6424,.1348,.1868,0,.0346,.957,0,0,.9971,0,0,0,.9986,0,0,0,.9571,.0195,0,0,.9364,.0415,0,0,.0961,.9035,0,0,.0232,.9631,0,0,.1357,.8629,0,0,.021,.964,0,0,.9986,0,0,0,.1357,.8629,0,0,.1026,.8963,0,0,.1171,.8806,0,0,.021,.964,0,0,.0232,.9631,0,0,.0961,.9035,0,0,.8714,.0414,.0414,0,.7274,.0681,.053,.053,.9571,.0195,0,0,.951,.0043,0,0,.9571,.0195,0,0,.0102,.2431,.0497,.6093,.4133,.2043,.1507,.071,.0971,.4455,.1546,.2457,.7121,.2191,0,0,.8043,.0741,.074,0,.7161,.1104,.1475,0,.8187,.0662,.0015,.0142,.1357,.8629,0,0,.0391,.955,0,0,.0391,.955,0,0,.0346,.957,0,0,.1171,.8806,0,0,.0346,.957,0,0,.021,.964,0,0,.0391,.955,0,0,.7851,.1678,0,0,.9817,0,0,0,.0021,.9725,0,0,.9983,0,0,0,.9973,0,0,0,.9975,0,0,0,.0021,.9725,0,0,.9981,0,0,0,.1619,.8376,0,0,.8383,.1528,0,0,.5409,.4327,0,0,.8383,.1528,0,0,.1619,.8376,0,0,.0615,.9383,0,0,.977,0,0,0,.9766,0,0,0,.9766,0,0,0,.1619,.8376,0,0,.5409,.4327,0,0,.7851,.1678,0,0,.0021,.9725,0,0,.5409,.4327,0,0,.0021,.9725,0,0,.014,.9672,0,0,.5409,.4327,0,0,.014,.9672,0,0,.1619,.8376,0,0,.9981,0,0,0,.9983,0,0,0,.0371,.9549,0,0,.8383,.1528,0,0,.0615,.9383,0,0,.9983,0,0,0,.9817,0,0,0,.9911,0,0,0,.9817,0,0,0,.7851,.1678,0,0,.0371,.9549,0,0,.0615,.9383,0,0,.977,0,0,0,.9835,0,0,0,.951,.0043,0,0,.5261,.4708,0,0,.1026,.8963,0,0,.5261,.4708,0,0,.951,.0043,0,0,.5244,.4743,0,0,.5,.4997,0,0,.5261,.4708,0,0,.5,.4997,0,0,.9835,0,0,0,.9835,0,0,0,.5,.4997,0,0,.0584,.3979,.4174,.0928,.1189,.5326,.1801,.1096,.3204,.2204,.2204,.0707,.2215,.2073,.2073,.0941,.1627,.1543,.1421,.1421,.7466,.0712,.0711,7e-4,.1189,.5326,.1801,.1096,.0584,.3979,.4174,.0928,.0543,.4559,.3697,.0871,.0615,.3737,.4293,.101,.0637,.3668,.4259,.1081,.0637,.3668,.4259,.1081,.0682,.373,.3999,.1209,.0169,.662,.0498,.196,.0664,.81,.0046,.0377,.1482,.7805,0,0,.9513,.004,0,0,.0366,.6893,.1568,.0762,.0971,.4455,.1546,.2457,.0366,.6893,.1568,.0762,.9975,0,0,0,.9975,0,0,0,.0032,.972,0,0,.8568,.1348,0,0,.9302,.0694,0,0,.0729,.9218,0,0,.3878,.5794,0,0,.3878,.5794,0,0,.8568,.1348,0,0,.0215,.9637,0,0,.9569,.0199,0,0,.9367,.0411,0,0,.9986,0,0,0,.1356,.863,0,0,.9986,0,0,0,.0228,.9633,0,0,.9971,0,0,0,.0351,.9567,0,0,.9981,0,0,0,.8383,.1528,0,0,.0371,.9549,0,0,.0615,.9383,0,0,.9817,0,0,0,.9983,0,0,0,.7851,.1678,0,0,.9817,0,0,0,.0371,.9549,0,0,.9973,0,0,0,.977,0,0,0,.526,.471,0,0,.1027,.8961,0,0,.9513,.004,0,0,.096,.9035,0,0,.5245,.4742,0,0,.7466,.0712,.0711,7e-4,.8043,.0741,.074,0,.4001,.2053,.1408,.1118,.9884,0,0,0,.9804,0,0,0,.9804,0,0,0,.7472,.1499,.0194,.0193,.951,.0043,0,0,.0366,.6893,.1568,.0763,.0971,.4455,.1546,.2457,.4001,.2053,.1408,.1118,5e-4,.9202,0,0,.3612,.2013,.1691,.1691,.9975,0,0,0,.9975,0,0,0,.3204,.2204,.2204,.0707,.2215,.2073,.2073,.0941,.1627,.1543,.1421,.1421,.9884,0,0,0,.0732,.9213,0,0,.0032,.972,0,0,.8572,.1343,0,0,.9302,.0694,0,0,.0732,.9213,0,0,.39,.5765,0,0,.39,.5765,0,0,.8572,.1343,0,0,.6282,.1383,.1016,.0658,.0822,.8695,0,0,.021,.964,0,0,.9364,.0415,0,0,.9571,.0195,0,0,.1357,.8629,0,0,.9986,0,0,0,.0232,.9631,0,0,.8714,.0414,.0414,0,.9364,.0415,0,0,.8714,.0414,.0414,0,.8043,.0741,.074,0,.3204,.2204,.2204,.0707,.9971,0,0,0,.9971,0,0,0,.0346,.957,0,0,.9981,0,0,0,.9766,0,0,0,.0371,.9549,0,0,.0615,.9383,0,0,.9973,0,0,0,.9983,0,0,0,.9817,0,0,0,.0371,.9549,0,0,.9973,0,0,0,.977,0,0,0,.1171,.8806,0,0,.1026,.8963,0,0,.951,.0043,0,0,.0961,.9035,0,0,.5244,.4743,0,0,.7466,.0712,.0711,7e-4,.898,.0097,.022,0,.9138,.0088,0,0,.9097,.0156,0,0,.8828,.0187,.0391,0,.898,.0097,.022,0,.8996,.004,.0249,0,.9205,.0046,0,0,.9165,.0095,0,0,.9069,.0208,0,0,.8987,.0292,0,0,.8859,.0136,.0387,0,.9132,.014,0,0,.9037,9e-4,.026,0,.8956,.0351,0,0,.8867,.0088,.0413,0,.9108,.0025,.0173,0,.8995,.0075,.032,0,.8899,.0054,.0435,0,.8799,.005,7e-4,.052,.9093,.007,.0195,0,.8959,.0141,.0367,0,.8833,.0114,.0512,0,.9093,.0105,.0194,0,.8939,.0198,.0391,0,.8782,.017,.0546,0,.9105,.0129,.0179,0,.8939,.0198,.0391,0,.8733,.0167,.0533,0,.8828,.0187,.0391,0,.9205,.0046,0,0,.9205,.001,.0064,0,.8733,.0167,.0533,0,.9205,.001,.0064,0,.8733,.0167,.0533,0,.8847,.0061,.0463,0,.9205,.001,.0064,0,.8733,.0167,.0533,0,.9205,.001,.0064,0,.8733,.0167,.0533,0,.8707,.0058,.0044,.0589,.9205,.001,.0064,0,.9205,.001,.0064,0,.9105,.0129,.0179,0,.8782,.017,.0546,0,.8707,.0058,.0044,.0589,.8981,.0097,.0221,0,.8997,.004,.0249,0,.9098,.0157,0,0,.883,.0187,.0391,0,.886,.0136,.0388,0,.9167,.0096,0,0,.9206,.0047,0,0,.8989,.0293,0,0,.9071,.0209,0,0,.8869,.0088,.0414,0,.9134,.014,0,0,.8958,.0352,0,0,.9039,5e-4,.0261,0,.8849,.0061,.0464,0,.911,.002,.0174,0,.8901,.0049,.0436,0,.8997,.007,.0321,0,.8801,.005,2e-4,.052,.9094,.0066,.0196,0,.8835,.0109,.0513,0,.8961,.0135,.0368,0,.8709,.0058,.0039,.0589,.9095,.01,.0195,0,.8784,.0163,.0546,0,.8942,.0191,.0392,0,.8942,.0191,.0392,0,.9107,.0124,.018,0,.8734,.0167,.0533,0,.883,.0187,.0391,0,.9206,.0047,0,0,.9206,6e-4,.0065,0,.8734,.0167,.0533,0,.9206,6e-4,.0065,0,.8734,.0167,.0533,0,.9206,6e-4,.0065,0,.8734,.0167,.0533,0,.9206,6e-4,.0065,0,.8734,.0167,.0533,0,.8709,.0058,.0039,.0589,.9206,6e-4,.0065,0,.9107,.0124,.018,0,.9206,6e-4,.0065,0,.8709,.0058,.0039,.0589,.8784,.0163,.0546,0,.898,.0097,.022,0,.8828,.0187,.0391,0,.9138,.0088,0,0,.9205,.0046,0,0,.8707,.0058,.0044,.0589,.8782,.017,.0546,0,.8939,.0198,.0391,0,.9139,.0088,0,0,.8981,.0097,.0221,0,.8981,.0097,.0221,0,.883,.0187,.0391,0,.9139,.0088,0,0,.9206,.0047,0,0,.8784,.0163,.0546,0,.8942,.0191,.0392,0]),!1),this.setVerticesData(r.VertexBuffer.MatricesIndicesKind,new Float32Array([11,12,15,0,11,12,15,0,11,12,13,15,11,12,15,0,11,12,15,0,11,12,15,0,11,13,15,0,11,13,15,0,11,13,15,0,11,12,15,0,11,15,0,0,11,13,15,0,11,13,15,0,11,15,0,0,11,15,0,0,11,12,13,15,11,13,15,0,11,13,15,0,11,15,0,0,27,25,15,5,27,15,5,23,5,6,27,0,9,11,15,25,9,25,27,11,9,11,25,12,5,8,28,2,8,5,2,28,8,25,5,2,2,5,8,28,5,6,28,0,2,5,28,0,23,0,0,0,17,23,0,0,23,27,0,0,27,5,25,8,5,8,25,27,8,5,25,27,11,13,0,0,11,0,0,0,11,13,0,0,17,20,23,0,17,20,23,27,6,17,23,27,25,8,27,5,11,13,15,0,11,13,15,0,11,13,15,0,11,13,15,0,13,11,16,15,11,17,13,16,11,0,0,0,15,11,23,13,11,15,0,0,11,13,15,0,11,13,0,0,11,13,0,0,9,11,12,15,9,11,12,15,9,11,12,15,15,23,27,0,15,17,23,0,9,11,12,15,11,9,15,12,11,9,12,16,9,11,12,15,9,11,12,15,9,11,12,15,11,13,15,0,11,12,15,0,11,12,15,0,9,11,12,15,13,0,0,0,11,13,15,0,11,13,0,0,6,27,25,23,27,6,23,17,27,6,17,23,23,24,0,0,23,24,0,0,23,24,0,0,15,17,23,0,11,12,9,16,11,12,9,16,9,11,12,15,9,11,12,15,9,11,12,15,9,11,12,15,9,11,12,15,11,12,15,0,9,11,12,15,9,11,12,15,9,11,12,15,9,11,12,15,9,11,12,15,9,11,12,15,9,11,12,15,9,11,12,15,9,11,12,15,9,11,12,15,9,11,12,15,9,11,12,15,9,11,12,15,23,24,0,0,23,0,0,0,23,24,0,0,9,11,12,15,11,12,0,0,15,23,0,0,5,0,0,0,5,6,28,0,5,6,0,0,5,6,7,28,5,6,0,0,6,7,0,0,3,6,7,8,6,7,0,0,6,7,0,0,5,6,27,0,27,23,5,6,6,23,27,0,17,15,23,11,8,28,0,0,6,7,0,0,8,28,6,3,28,0,0,0,28,0,0,0,6,7,0,0,6,7,0,0,7,0,0,0,7,0,0,0,6,7,0,0,8,6,3,25,23,24,0,0,17,23,27,0,17,11,16,15,17,9,27,26,25,6,3,8,6,25,3,8,23,24,0,0,23,24,0,0,24,0,0,0,23,24,0,0,11,0,0,0,11,13,0,0,11,13,0,0,11,12,13,15,11,12,15,0,11,13,15,0,11,13,15,0,11,13,15,0,11,0,0,0,11,0,0,0,11,0,0,0,11,13,15,0,11,12,15,0,11,12,15,0,11,15,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,13,0,0,13,0,0,0,13,0,0,0,11,13,0,0,11,13,0,0,11,13,0,0,11,13,0,0,11,13,0,0,11,13,0,0,11,13,0,0,13,12,11,16,13,11,12,15,11,13,0,0,11,12,13,15,11,13,0,0,11,13,0,0,11,13,15,0,11,9,12,16,9,11,12,15,9,11,15,27,9,11,12,15,15,11,27,9,6,17,23,27,23,27,0,0,27,15,9,25,15,23,27,0,15,23,27,0,24,0,0,0,24,0,0,0,23,24,0,0,23,24,0,0,23,24,0,0,23,24,0,0,23,24,0,0,23,24,0,0,23,24,0,0,23,24,0,0,23,24,0,0,23,24,0,0,23,24,0,0,23,24,0,0,23,24,0,0,23,24,0,0,17,20,23,0,23,24,0,0,23,24,0,0,23,24,0,0,9,15,23,27,25,9,27,8,9,11,25,26,9,25,8,11,9,11,12,15,17,23,0,0,5,6,27,0,5,6,23,27,25,8,9,2,23,24,0,0,23,24,0,0,23,24,0,0,23,24,0,0,24,0,0,0,23,24,0,0,23,24,0,0,23,24,0,0,23,24,0,0,6,7,0,0,6,7,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,6,7,0,0,7,0,0,0,6,7,0,0,6,7,0,0,6,7,0,0,6,7,0,0,6,7,0,0,6,7,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,6,7,0,0,6,7,0,0,6,7,0,0,6,7,0,0,6,7,0,0,6,7,0,0,6,7,0,0,6,7,0,0,6,7,0,0,6,7,0,0,7,0,0,0,7,0,0,0,6,7,0,0,7,0,0,0,6,7,0,0,7,0,0,0,7,0,0,0,7,0,0,0,6,7,0,0,7,0,0,0,6,7,0,0,23,0,0,0,23,24,0,0,23,24,0,0,23,24,0,0,23,24,0,0,23,24,0,0,23,24,0,0,23,24,0,0,23,0,0,0,23,24,0,0,23,24,0,0,23,0,0,0,9,11,12,15,9,11,12,15,9,11,12,15,9,11,12,15,9,11,12,15,9,11,12,15,9,11,12,15,9,11,12,15,9,11,12,15,9,15,23,27,11,15,23,27,11,15,0,0,11,12,13,16,11,12,16,0,11,12,16,0,11,12,16,0,11,12,16,0,11,12,16,0,11,13,16,0,11,13,16,0,11,13,16,0,11,16,0,0,11,16,0,0,11,13,16,0,11,16,0,0,11,16,0,0,11,13,16,0,11,12,13,16,11,13,16,0,11,12,16,0,26,25,16,2,2,3,26,0,26,16,2,20,9,11,16,25,9,25,26,11,2,8,28,5,2,3,28,0,2,5,8,28,2,5,8,28,20,0,0,0,20,26,0,0,17,20,0,0,8,2,25,26,2,8,25,26,26,2,25,8,11,13,0,0,11,0,0,0,11,13,0,0,17,20,23,0,17,20,26,0,3,17,20,26,25,8,26,2,11,13,16,0,11,13,16,0,11,17,13,16,13,11,16,15,11,13,16,0,16,11,20,13,11,13,16,0,11,13,0,0,9,11,12,16,9,11,12,16,9,11,12,16,16,20,26,0,16,17,20,0,11,16,0,0,9,11,12,16,9,11,12,16,9,11,12,16,9,11,12,16,11,13,16,0,11,13,16,0,11,12,16,0,9,11,12,16,11,12,16,0,11,13,0,0,11,13,16,0,13,0,0,0,13,11,16,15,26,3,17,20,26,3,20,17,3,26,25,20,20,21,0,0,20,21,0,0,20,21,0,0,16,17,20,0,9,11,12,16,9,11,12,16,9,11,12,16,9,11,12,16,11,12,16,0,9,11,12,16,9,11,12,16,9,11,12,16,9,11,12,16,11,9,16,12,9,11,12,16,9,11,12,16,9,11,12,16,9,11,12,16,9,11,12,16,9,11,12,16,9,11,12,16,9,11,12,16,9,11,12,16,9,11,12,16,20,21,0,0,20,21,0,0,20,0,0,0,9,11,12,16,9,11,12,16,16,20,0,0,2,0,0,0,2,3,28,0,2,3,0,0,2,3,4,28,2,3,0,0,3,4,0,0,2,3,20,26,3,4,0,0,3,4,0,0,2,3,26,0,3,20,26,0,17,16,20,11,8,28,0,0,8,28,6,3,3,4,0,0,8,28,0,0,4,0,0,0,3,4,0,0,3,4,0,0,3,4,0,0,4,0,0,0,8,28,6,3,8,6,3,25,17,11,16,15,11,17,13,16,17,9,27,26,3,25,6,8,20,21,0,0,20,21,0,0,21,0,0,0,20,21,0,0,11,0,0,0,11,13,0,0,11,13,0,0,11,12,13,16,11,12,16,0,11,13,16,0,11,13,16,0,11,13,16,0,11,0,0,0,11,0,0,0,11,13,16,0,11,12,16,0,11,12,16,0,11,13,16,0,11,13,16,0,11,16,0,0,11,0,0,0,13,0,0,0,11,13,0,0,11,13,0,0,11,13,0,0,11,13,0,0,11,13,0,0,13,11,12,16,13,12,11,16,11,13,0,0,11,12,13,16,11,13,0,0,11,13,0,0,11,13,0,0,9,11,12,16,9,11,16,26,16,11,26,9,9,11,12,16,3,17,20,26,20,26,0,0,26,20,2,3,26,16,9,25,16,20,26,0,16,20,26,0,20,21,0,0,21,0,0,0,21,0,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,21,0,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,17,20,23,0,17,11,16,15,20,21,0,0,20,21,0,0,20,21,0,0,9,16,20,26,25,9,26,8,9,11,12,16,17,20,0,0,17,20,23,0,2,3,26,0,3,4,6,8,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,3,4,0,0,4,0,0,0,3,4,0,0,4,0,0,0,4,0,0,0,4,0,0,0,3,4,0,0,4,0,0,0,3,4,0,0,3,4,0,0,3,4,0,0,3,4,0,0,3,4,0,0,3,4,0,0,4,0,0,0,4,0,0,0,4,0,0,0,3,4,0,0,3,4,0,0,3,4,0,0,3,4,0,0,3,4,0,0,3,4,0,0,3,4,0,0,3,4,0,0,3,4,0,0,3,4,0,0,4,0,0,0,4,0,0,0,3,4,0,0,3,4,0,0,3,4,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,3,4,0,0,3,4,0,0,3,4,0,0,4,0,0,0,20,0,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,0,0,0,20,0,0,0,20,21,0,0,9,11,12,16,9,11,12,16,8,6,3,25,25,6,3,8,17,9,27,26,17,20,23,27,9,11,12,16,9,11,12,16,9,11,12,16,9,11,12,16,9,11,12,16,9,11,12,16,9,11,12,16,9,16,20,26,11,16,20,26,11,16,0,0,23,24,0,0,9,11,12,15,9,11,12,15,9,11,12,15,7,0,0,0,7,0,0,0,11,13,0,0,11,13,0,0,11,13,0,0,11,13,0,0,11,13,0,0,11,13,0,0,11,13,0,0,23,24,0,0,23,24,0,0,23,24,0,0,24,0,0,0,23,24,0,0,24,0,0,0,23,24,0,0,24,0,0,0,23,24,0,0,7,0,0,0,6,7,0,0,6,7,0,0,6,7,0,0,7,0,0,0,7,0,0,0,6,7,0,0,7,0,0,0,6,7,0,0,7,0,0,0,7,0,0,0,23,24,0,0,23,24,0,0,23,24,0,0,23,24,0,0,23,24,0,0,17,20,23,27,17,20,23,0,11,17,13,16,13,0,0,0,13,0,0,0,13,0,0,0,13,11,16,15,20,21,0,0,9,11,12,16,9,11,12,16,11,17,13,16,8,28,0,0,8,28,6,3,4,0,0,0,4,0,0,0,8,6,3,25,25,6,3,8,17,9,27,26,13,0,0,0,11,13,0,0,11,13,0,0,11,13,0,0,11,13,0,0,11,13,0,0,11,13,0,0,11,13,0,0,11,13,0,0,13,12,11,16,11,13,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,21,0,0,0,20,21,0,0,17,20,23,0,20,21,0,0,17,20,23,0,17,20,23,0,8,6,3,25,21,0,0,0,21,0,0,0,20,21,0,0,4,0,0,0,4,0,0,0,3,4,0,0,3,4,0,0,4,0,0,0,4,0,0,0,4,0,0,0,3,4,0,0,4,0,0,0,4,0,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,20,21,0,0,17,20,23,27,11,12,15,0,11,15,0,0,11,15,0,0,11,12,15,0,11,12,15,0,11,12,15,0,11,15,0,0,11,15,0,0,11,15,0,0,11,15,0,0,11,12,15,0,11,15,0,0,11,13,15,0,11,15,0,0,11,12,15,0,11,13,15,0,11,13,15,0,11,13,15,0,11,12,13,15,11,13,15,0,11,13,15,0,11,13,15,0,11,13,15,0,11,13,15,0,11,13,15,0,11,13,15,0,11,13,15,0,11,12,15,0,11,12,15,0,11,15,0,0,11,13,15,0,11,12,15,0,11,13,15,0,11,12,15,0,11,12,15,0,11,13,15,0,11,12,15,0,11,13,15,0,11,12,15,0,11,12,13,15,11,13,15,0,11,13,15,0,11,13,15,0,11,13,15,0,11,12,13,15,11,12,16,0,11,12,16,0,11,16,0,0,11,12,16,0,11,12,16,0,11,16,0,0,11,16,0,0,11,16,0,0,11,16,0,0,11,12,16,0,11,16,0,0,11,16,0,0,11,13,16,0,11,12,16,0,11,13,16,0,11,13,16,0,11,13,16,0,11,12,13,16,11,13,16,0,11,13,16,0,11,13,16,0,11,12,13,16,11,13,16,0,11,13,16,0,11,13,16,0,11,13,16,0,11,13,16,0,11,12,16,0,11,12,16,0,11,16,0,0,11,13,16,0,11,12,16,0,11,13,16,0,11,12,16,0,11,13,16,0,11,12,16,0,11,13,16,0,11,12,16,0,11,12,13,16,11,13,16,0,11,13,16,0,11,13,16,0,11,12,13,16,11,13,16,0,11,12,15,0,11,12,15,0,11,15,0,0,11,15,0,0,11,12,13,15,11,13,15,0,11,13,15,0,11,16,0,0,11,12,16,0,11,12,16,0,11,12,16,0,11,16,0,0,11,16,0,0,11,13,16,0,11,13,16,0]),!1),this.setIndices([0,1,2,3,4,5,6,7,8,3,9,1,10,11,12,13,10,14,15,2,16,17,16,8,4,13,18,19,20,21,22,23,24,25,26,27,28,29,30,26,25,28,31,32,33,34,35,36,37,38,39,40,41,42,43,36,27,44,45,46,47,48,49,50,39,38,51,52,53,50,54,55,56,57,58,59,52,60,61,62,63,64,65,66,46,45,67,68,69,70,71,72,73,47,53,45,48,47,72,44,39,55,74,75,76,77,78,79,60,51,80,81,82,83,84,85,86,87,70,88,89,70,90,91,62,61,92,64,84,93,94,95,96,56,97,56,96,57,98,99,56,70,100,101,102,103,104,68,70,105,82,106,68,60,107,59,28,25,108,30,29,109,110,111,112,111,113,109,74,114,110,115,110,116,117,118,119,115,111,110,120,80,51,109,113,121,113,122,123,29,112,111,124,109,121,125,109,124,126,127,128,129,130,126,131,123,122,31,132,133,120,49,134,135,136,137,138,139,140,141,31,33,113,111,115,142,143,144,145,69,146,46,147,148,70,69,88,149,88,69,37,143,38,106,150,151,152,151,150,72,45,44,153,37,148,152,142,151,153,144,143,154,68,155,68,151,155,148,37,46,154,146,69,145,147,149,46,149,147,143,142,152,143,37,153,69,145,149,68,154,69,142,144,11,153,6,11,147,145,15,147,17,7,154,3,0,148,7,6,154,155,4,145,146,0,155,156,13,10,13,156,142,156,151,155,151,156,157,158,159,159,158,160,152,159,143,159,38,143,161,162,163,54,164,165,55,165,73,161,166,162,167,168,169,170,171,172,173,174,169,175,172,174,174,172,169,176,169,172,11,6,177,81,61,178,62,179,22,180,181,182,24,63,62,133,42,183,119,118,184,32,183,184,22,185,23,180,185,22,51,60,52,33,184,186,187,33,186,186,184,118,188,189,190,60,80,191,192,193,194,102,104,193,195,196,140,197,198,79,199,200,201,140,202,203,120,134,204,60,205,107,132,206,80,207,33,107,187,107,33,185,208,20,185,19,23,209,23,19,210,24,23,23,209,210,210,209,211,22,212,180,19,21,34,118,21,20,187,59,107,40,133,213,132,213,133,213,132,120,214,117,215,75,74,215,114,74,137,209,43,216,19,34,43,117,214,21,217,218,78,194,219,189,220,221,78,222,223,224,194,193,225,226,227,228,229,230,231,232,233,228,234,235,236,237,238,239,229,240,241,241,242,238,243,244,238,245,246,247,248,249,250,251,252,253,254,255,228,256,257,258,259,260,257,261,257,262,110,114,116,122,116,114,263,264,257,265,266,267,268,269,270,140,139,271,272,273,274,102,275,276,66,277,278,131,137,136,32,184,33,184,183,119,183,75,119,42,76,75,76,42,41,279,280,281,282,56,283,56,284,285,208,186,20,20,186,118,185,20,19,180,286,208,185,180,208,286,187,208,187,186,208,182,287,286,182,286,180,287,59,286,187,286,59,88,288,287,288,52,287,59,287,52,88,287,182,149,67,288,88,149,288,53,288,67,53,52,288,46,67,149,67,45,53,117,21,118,35,34,21,214,35,21,108,35,214,29,28,108,36,35,108,289,290,291,292,293,294,295,296,297,290,293,292,298,299,300,301,302,299,303,289,304,297,303,305,306,294,302,307,308,309,310,24,311,27,26,312,30,313,314,26,315,314,316,317,318,319,320,321,322,323,324,325,326,327,328,216,27,329,324,330,331,332,333,323,322,50,334,333,335,50,322,336,337,338,339,340,341,342,343,178,63,344,345,346,330,347,348,349,350,351,352,353,354,333,353,348,353,333,355,336,322,329,356,357,358,359,360,361,341,362,334,363,82,81,364,365,366,367,350,368,369,370,350,371,343,372,373,364,344,374,375,376,377,378,337,337,339,377,379,337,380,350,381,382,383,384,385,349,386,350,82,387,349,341,340,388,314,389,312,30,125,390,391,392,393,392,390,394,358,395,393,396,397,393,398,395,399,396,393,392,334,362,400,390,401,394,402,403,394,313,390,392,124,404,390,125,124,390,405,406,407,407,408,409,403,410,411,316,318,326,400,412,413,414,356,415,416,417,418,419,317,316,394,396,392,420,421,422,423,424,351,330,425,426,350,367,351,427,351,367,324,323,422,106,349,428,150,428,429,329,348,353,430,425,324,429,428,420,430,422,421,431,432,349,349,432,428,425,330,324,431,351,424,423,427,426,330,426,427,422,429,420,422,430,324,351,427,423,349,351,431,420,298,433,433,295,430,426,305,304,434,305,426,291,292,431,295,434,425,431,292,306,423,304,291,301,435,432,298,420,435,420,428,435,432,435,428,436,158,157,160,158,436,429,422,436,436,422,323,437,162,438,54,336,439,336,352,439,438,162,166,440,441,442,443,444,445,442,446,447,446,443,448,446,442,443,443,442,449,433,300,296,81,178,343,372,310,450,451,452,453,372,63,24,454,327,326,399,455,456,318,455,454,310,311,457,451,310,457,334,342,341,317,458,455,459,458,317,458,456,455,460,461,462,341,463,464,465,466,467,467,384,383,468,469,418,470,360,359,471,472,473,474,475,418,476,477,400,341,388,478,479,400,362,480,388,317,459,317,388,457,309,481,457,311,307,482,307,311,210,311,24,311,210,482,210,211,482,310,451,483,307,321,308,456,309,308,459,388,340,484,326,485,479,326,484,484,400,479,486,393,395,357,399,395,415,358,487,482,211,216,328,321,307,398,308,486,360,488,489,461,490,466,491,361,360,492,493,494,466,495,467,496,497,498,499,500,501,502,497,503,504,505,506,507,508,509,501,500,510,510,509,511,512,509,513,514,515,516,517,518,519,520,521,522,523,497,524,525,526,527,528,529,530,531,532,533,393,397,487,403,487,397,530,534,535,536,537,538,539,540,541,542,543,418,544,545,546,383,547,548,345,549,550,551,552,415,318,317,455,455,399,454,454,399,357,357,356,327,356,553,554,555,556,557,558,559,337,337,560,561,481,309,458,309,456,458,457,307,309,451,481,562,457,481,451,562,481,459,459,481,458,452,562,563,452,451,562,563,562,340,459,340,562,367,563,564,564,563,342,340,342,563,367,452,563,427,564,347,367,564,427,335,347,564,335,564,342,330,427,347,347,335,348,398,456,308,320,308,321,486,308,320,486,320,389,313,391,389,319,312,389,15,0,2,9,3,5,177,6,8,0,3,1,14,10,12,18,13,14,17,15,16,7,17,8,5,4,18,36,25,27,315,28,30,315,26,28,43,34,36,44,37,39,133,40,42,216,43,27,37,44,46,51,47,49,160,50,38,47,51,53,39,50,55,178,61,63,163,71,73,72,47,45,71,48,72,73,44,55,137,74,76,565,77,79,61,81,566,182,567,88,568,82,68,125,30,109,214,110,112,215,74,110,215,117,119,49,120,51,121,113,123,109,29,111,569,126,128,570,129,126,114,131,122,32,31,133,76,135,137,196,138,140,68,106,151,157,152,150,73,72,44,10,142,11,144,153,11,17,147,15,148,147,7,146,154,0,153,148,6,3,154,4,15,145,0,4,155,13,142,10,156,152,157,159,38,159,160,73,161,163,55,54,165,176,571,169,572,573,172,574,575,169,576,577,174,171,176,172,12,11,177,22,24,62,32,133,183,578,188,190,579,60,580,192,102,193,581,195,140,78,582,79,583,140,584,213,120,204,120,132,80,204,40,213,110,214,215,119,75,215,131,114,137,211,209,216,209,19,43,585,217,78,188,194,189,77,586,78,587,229,231,230,229,241,588,589,590,591,592,257,593,594,595,596,597,257,598,599,600,601,140,602,183,42,75,135,76,41,112,108,214,112,29,108,25,36,108,304,289,291,306,292,294,434,295,297,291,290,292,433,298,300,298,301,299,305,303,304,434,297,305,301,306,302,319,27,312,315,30,314,312,26,314,328,319,321,329,322,324,603,604,327,319,328,27,348,329,330,334,605,333,160,323,50,342,334,335,54,50,336,372,343,63,606,352,607,335,333,348,608,353,609,352,336,329,415,356,358,610,359,361,343,611,81,452,367,612,106,82,349,313,30,390,486,391,393,487,358,393,456,398,399,613,334,400,614,615,394,391,313,392,616,405,407,617,407,409,487,403,618,479,316,326,619,620,415,543,416,418,150,106,428,157,150,429,352,329,353,421,420,433,421,433,430,423,426,304,425,434,426,424,291,431,430,295,425,432,431,306,424,423,291,306,301,432,301,298,435,429,436,157,323,160,436,352,621,438,164,54,439,622,623,442,624,443,625,626,442,627,628,446,629,630,443,631,295,433,296,310,372,24,318,454,326,632,460,462,362,341,633,465,467,383,417,468,418,634,635,359,636,637,418,484,638,400,639,479,362,640,484,641,398,486,395,358,357,395,642,415,487,328,482,216,482,328,307,643,360,489,462,461,466,644,645,360,646,499,501,647,501,510,530,648,649,650,651,530,530,652,653,654,530,655,656,657,658,659,660,418,454,357,327,327,356,661,391,486,389,314,313,389,320,319,389,662,663,664,665,666,667,668,669,664,664,670,671,672,667,671,669,673,670,670,674,675,676,671,675,673,677,674,674,678,679,675,679,680,677,681,678,679,678,682,680,679,683,681,684,682,682,685,686,684,687,688,689,690,672,691,692,669,693,672,676,669,694,673,695,676,696,673,697,677,698,696,680,677,699,681,700,680,701,681,702,684,684,703,704,683,705,706,707,708,709,710,711,708,709,712,713,714,715,709,711,716,714,715,717,712,718,719,715,716,720,718,719,721,717,722,723,719,724,722,718,723,725,721,722,726,727,724,728,726,727,729,725,730,731,727,732,733,729,734,711,735,736,712,737,738,716,711,712,717,739,740,720,716,717,721,741,742,724,720,721,725,743,744,745,724,725,729,746,729,747,748,726,749,750,667,751,664,672,752,667,753,754,664,667,664,671,676,672,671,664,669,670,671,670,675,696,676,675,670,673,674,675,674,679,696,675,680,674,677,678,683,679,682,755,680,683,678,681,682,683,682,756,682,684,757,758,759,709,760,761,708,762,709,763,708,714,709,708,711,714,709,715,712,714,718,715,714,716,718,715,719,717,718,722,719,720,724,718,719,723,721,723,722,727,722,724,726,723,727,725,726,764,727,727,765,729]),this.setMaterialByID("hamster36_1.Multimaterial#0"),this.subMeshes=[],new r.SubMesh(0,0,662,0,1998,this),new r.SubMesh(1,662,104,1998,276,this),e._selectionOctree&&e.createOrUpdateSelectionOctree(),(n=new QI.ShapeKeyGroup(this,"ENTIRE_MESH",new Uint32Array([3,4,5,6,7,8,15,16,17,24,25,26,27,28,29,36,37,38,42,43,44,48,49,50,54,55,56,426,427,428,429,430,431,435,436,437,441,442,443,444,445,446,459,460,461,462,463,464,465,466,467,468,469,470,531,532,533,867,868,869,870,871,872,879,880,881,882,883,884,888,889,890,891,892,893,897,898,899,900,901,902,906,907,908,909,910,911,1260,1261,1262,1266,1267,1268,1269,1270,1271,1275,1276,1277,1278,1279,1280,1290,1291,1292,1293,1294,1295,1296,1297,1298,1305,1306,1307,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2e3,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100,2101,2102,2103,2104,2105,2106,2107,2108,2109,2110,2111,2112,2113,2114,2115,2116,2117,2118,2119,2120,2121,2122,2123,2124,2125,2126,2127,2128,2129,2130,2131,2132,2133,2134,2135,2136,2137,2138,2139,2140,2141,2142,2143,2144,2145,2146,2147,2148,2149,2150,2151,2152,2153,2154,2155,2156,2157,2158,2159,2160,2161,2162,2163,2164,2165,2166,2167,2168,2169,2170,2171,2172,2173,2174,2175,2176,2177,2178,2179,2180,2181,2182,2183,2184,2185,2186,2187,2188,2189,2190,2191,2192,2193,2194,2195,2196,2197,2198,2199,2200,2201,2202,2203,2204,2205,2206,2207,2208,2209,2210,2211,2212,2213,2214,2215,2216,2217,2218,2219,2220,2221,2222,2223,2224,2225,2226,2227,2228,2229,2230,2231,2232,2233,2234,2235,2236,2237,2238,2239,2240,2241,2242,2243,2244,2245,2246,2247,2248,2249,2250,2251,2252,2253,2254,2255,2256,2257,2258,2259,2260,2261,2262,2263,2264,2265,2266,2267,2268,2269,2270,2271,2272,2273,2274,2275,2276,2277,2278,2279,2280,2281,2282,2283,2284,2285,2286,2287,2288,2289,2290,2291,2292,2293,2294,2295,2296,2297]),new Float32Array([.133,.2175,-.7706,.1466,.1928,-.7751,.1059,.2452,-.8041,.1436,.1633,-.8226,.1209,.2366,-.7813,.1046,.1894,-.8524,.0965,.2163,-.8482,.1524,.1725,-.7955,.0956,.2351,-.8317,.0965,.2202,-.857,.1005,.1626,-.8986,.1564,.1947,-.7724,.1594,.1716,-.797,.1497,.1617,-.8266,.1285,.1674,-.8506,.1251,.2446,-.7794,.1093,.2495,-.8068,.0982,.2397,-.8357,.1241,.1695,-.8439,-.1466,.1928,-.7751,-.133,.2175,-.7706,-.1209,.2366,-.7813,-.1059,.2452,-.8041,-.1241,.1695,-.8439,-.1436,.1633,-.8226,-.0965,.2163,-.8482,-.1046,.1894,-.8524,-.0956,.2351,-.8317,-.1524,.1725,-.7955,-.0965,.2202,-.857,-.1005,.1626,-.8986,-.1564,.1947,-.7724,-.1497,.1617,-.8266,-.1594,.1716,-.797,-.1285,.1674,-.8506,-.1251,.2446,-.7794,-.1093,.2495,-.8068,-.0982,.2397,-.8357,.1059,.2452,-.8041,.0956,.2351,-.8317,.117,.2371,-.8366,.1209,.2366,-.7813,.1059,.2452,-.8041,.1251,.2458,-.8109,.0965,.2163,-.8482,.1085,.2146,-.8516,.137,.2272,-.8396,.1452,.2359,-.8139,.1297,.2373,-.7843,.1209,.2084,-.8535,.1504,.2091,-.8377,.1585,.2178,-.812,.1421,.2312,-.7861,.1292,.1973,-.8523,.1535,.1877,-.8314,.1616,.1964,-.8057,.1523,.2068,-.781,.1311,.184,-.8484,.1481,.1734,-.8248,.1562,.1821,-.7991,.1277,.1755,-.8444,.1436,.1633,-.8226,.1524,.1725,-.7955,.1241,.1695,-.8439,.1436,.1633,-.8226,.133,.2175,-.7706,.1209,.2366,-.7813,.0965,.2163,-.8482,.1046,.1894,-.8524,.133,.2175,-.7706,.1046,.1894,-.8524,.133,.2175,-.7706,.1504,.22,-.7849,.1046,.1894,-.8524,.133,.2175,-.7706,.1046,.1894,-.8524,.133,.2175,-.7706,.1466,.1928,-.7751,.1046,.1894,-.8524,.1046,.1894,-.8524,.1241,.1695,-.8439,.1524,.1725,-.7955,.1466,.1928,-.7751,-.1059,.2452,-.8041,-.1251,.2458,-.8109,-.117,.2371,-.8366,-.1209,.2366,-.7813,-.1297,.2373,-.7843,-.1085,.2146,-.8516,-.0965,.2163,-.8482,-.1452,.2359,-.8139,-.137,.2272,-.8396,-.1421,.2312,-.7861,-.1209,.2084,-.8535,-.1585,.2178,-.812,-.1504,.2091,-.8377,-.1504,.22,-.7849,-.1292,.1973,-.8523,-.1616,.1964,-.8057,-.1535,.1877,-.8314,-.1523,.2068,-.781,-.1311,.184,-.8484,-.1562,.1821,-.7991,-.1481,.1734,-.8248,-.1466,.1928,-.7751,-.1277,.1755,-.8444,-.1524,.1725,-.7955,-.1436,.1633,-.8226,-.1436,.1633,-.8226,-.1241,.1695,-.8439,-.133,.2175,-.7706,-.1209,.2366,-.7813,-.0965,.2163,-.8482,-.1046,.1894,-.8524,-.133,.2175,-.7706,-.1046,.1894,-.8524,-.133,.2175,-.7706,-.1046,.1894,-.8524,-.133,.2175,-.7706,-.1046,.1894,-.8524,-.133,.2175,-.7706,-.1466,.1928,-.7751,-.1046,.1894,-.8524,-.1241,.1695,-.8439,-.1046,.1894,-.8524,-.1466,.1928,-.7751,-.1524,.1725,-.7955,.1059,.2452,-.8041,.1209,.2366,-.7813,.0956,.2351,-.8317,.0965,.2163,-.8482,.1466,.1928,-.7751,.1524,.1725,-.7955,.1436,.1633,-.8226,-.0956,.2351,-.8317,-.1059,.2452,-.8041,-.1059,.2452,-.8041,-.1209,.2366,-.7813,-.0956,.2351,-.8317,-.0965,.2163,-.8482,-.1524,.1725,-.7955,-.1436,.1633,-.8226])))._addShapeKey("EYES_CLOSED",new Float32Array([.1198,.2072,-.7626,.1334,.1825,-.7671,.0928,.2349,-.7962,.1305,.153,-.8147,.1078,.2263,-.7733,.0914,.1791,-.8445,.0834,.206,-.8403,.1393,.1623,-.7875,.0824,.2248,-.8238,.1282,.1907,-.8743,.1065,.1643,-.905,.1675,.2299,-.7711,.1592,.2199,-.8173,.1469,.2053,-.8472,.1302,.1905,-.8735,.1667,.2305,-.772,.1589,.2205,-.8177,.1449,.2063,-.8466,.1109,.1592,-.836,-.1334,.1825,-.7671,-.1198,.2072,-.7626,-.1078,.2263,-.7733,-.0928,.2349,-.7962,-.1109,.1592,-.836,-.1305,.153,-.8147,-.0834,.206,-.8403,-.0914,.1791,-.8445,-.0824,.2248,-.8238,-.1393,.1623,-.7875,-.1282,.1907,-.8743,-.1065,.1643,-.905,-.1675,.2299,-.7711,-.1469,.2053,-.8472,-.1592,.2199,-.8173,-.1302,.1905,-.8735,-.1667,.2305,-.772,-.1589,.2205,-.8177,-.1449,.2063,-.8466,.0928,.2349,-.7962,.0824,.2248,-.8238,.1038,.2268,-.8287,.1078,.2263,-.7733,.0928,.2349,-.7962,.1119,.2355,-.803,.0834,.206,-.8403,.0954,.2043,-.8437,.1239,.2169,-.8317,.132,.2256,-.806,.1166,.227,-.7763,.1078,.1982,-.8455,.1373,.1988,-.8298,.1454,.2075,-.804,.129,.2209,-.7782,.116,.187,-.8443,.1403,.1774,-.8235,.1484,.1861,-.7978,.1392,.1965,-.7731,.1179,.1737,-.8404,.135,.1631,-.8169,.143,.1718,-.7912,.1146,.1652,-.8365,.1305,.153,-.8147,.1393,.1623,-.7875,.1109,.1592,-.836,.1305,.153,-.8147,.1198,.2072,-.7626,.1078,.2263,-.7733,.0834,.206,-.8403,.0914,.1791,-.8445,.1198,.2072,-.7626,.0914,.1791,-.8445,.1198,.2072,-.7626,.1373,.2098,-.777,.0914,.1791,-.8445,.1198,.2072,-.7626,.0914,.1791,-.8445,.1198,.2072,-.7626,.1334,.1825,-.7671,.0914,.1791,-.8445,.0914,.1791,-.8445,.1109,.1592,-.836,.1393,.1623,-.7875,.1334,.1825,-.7671,-.0928,.2349,-.7962,-.1119,.2355,-.803,-.1038,.2268,-.8287,-.1078,.2263,-.7733,-.1166,.227,-.7763,-.0954,.2043,-.8437,-.0834,.206,-.8403,-.132,.2256,-.806,-.1239,.2169,-.8317,-.129,.2209,-.7782,-.1078,.1982,-.8455,-.1454,.2075,-.804,-.1373,.1988,-.8298,-.1373,.2098,-.777,-.116,.187,-.8443,-.1484,.1861,-.7978,-.1403,.1774,-.8235,-.1392,.1965,-.7731,-.1179,.1737,-.8404,-.143,.1718,-.7912,-.135,.1631,-.8169,-.1334,.1825,-.7671,-.1146,.1652,-.8365,-.1393,.1623,-.7875,-.1305,.153,-.8147,-.1305,.153,-.8147,-.1109,.1592,-.836,-.1198,.2072,-.7626,-.1078,.2263,-.7733,-.0834,.206,-.8403,-.0914,.1791,-.8445,-.1198,.2072,-.7626,-.0914,.1791,-.8445,-.1198,.2072,-.7626,-.0914,.1791,-.8445,-.1198,.2072,-.7626,-.0914,.1791,-.8445,-.1198,.2072,-.7626,-.1334,.1825,-.7671,-.0914,.1791,-.8445,-.1109,.1592,-.836,-.0914,.1791,-.8445,-.1334,.1825,-.7671,-.1393,.1623,-.7875,.0928,.2349,-.7962,.1078,.2263,-.7733,.0824,.2248,-.8238,.0834,.206,-.8403,.1334,.1825,-.7671,.1393,.1623,-.7875,.1305,.153,-.8147,-.0824,.2248,-.8238,-.0928,.2349,-.7962,-.0928,.2349,-.7962,-.1078,.2263,-.7733,-.0824,.2248,-.8238,-.0834,.206,-.8403,-.1393,.1623,-.7875,-.1305,.153,-.8147])),this.addShapeKeyGroup(n))}return __extends(hamster,a),hamster}(QI.Mesh);t.hamster=e,t.defineCameras=function defineCameras(t){if(Number(r.Engine.Version.substr(0,r.Engine.Version.lastIndexOf(".")))<2.3)throw"Babylon version too old";var e;r.Tools.Log("In hamster36_1.defineCameras"),(e=new r.FreeCamera("Camera",new r.Vector3(7.4811,5.3437,-6.5076),t)).setCameraRigMode(0,{interaxialDistance:.0637}),e.rotation=new r.Vector3(1.5708,0,0),e.fov=.8576,e.minZ=.1,e.maxZ=100,e.speed=1,e.inertia=.9,e.checkCollisions=!1,e.applyGravity=!1,e.ellipsoid=new r.Vector3(.2,.9,.2),t.setActiveCameraByID("Camera")},t.defineLights=function defineLights(t){if(Number(r.Engine.Version.substr(0,r.Engine.Version.lastIndexOf(".")))<2.3)throw"Babylon version too old";var e;r.Tools.Log("In hamster36_1.defineLights"),(e=new r.PointLight("Lamp",new r.Vector3(4.0762,5.9039,1.0055),t)).intensity=1,e.diffuse=new r.Color3(1,1,1),e.specular=new r.Color3(1,1,1)},t.freshenShadowRenderLists=function freshenShadowRenderLists(t){if(Number(r.Engine.Version.substr(0,r.Engine.Version.lastIndexOf(".")))<2.3)throw"Babylon version too old";r.Tools.Log("In hamster36_1.freshenShadowRenderLists");for(var e=[],o=0;o<t.meshes.length;o++)t.meshes[o].castShadows&&e.push(t.meshes[o]);for(o=0;o<t.lights.length;o++)t.lights[o]._shadowGenerator&&(t.lights[o]._shadowGenerator.getShadowMap().renderList=e)}}(hamster36_1||(hamster36_1={}));var OIMO=function(){};OIMO.SHAPE_SPHERE=1,OIMO.SHAPE_BOX=2,OIMO.WORLD_SCALE=1,OIMO.INV_SCALE=1,OIMO.TO_RAD=Math.PI/180,OIMO.TwoPI=2*Math.PI,OIMO.nextID=0,OIMO_ARRAY_TYPE||(OIMO_ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array),OIMO.World=function(t,e,o,i){switch(this.timeStep=t||1/60,this.numIterations=o||8,e||2){case 1:this.broadPhase=new OIMO.BruteForceBroadPhase;break;case 2:default:this.broadPhase=new OIMO.SAPBroadPhase;break;case 3:this.broadPhase=new OIMO.DBVTBroadPhase}this.enableRandomizer=!0,this.isNoStat=i||!1,this.rigidBodies=null,this.numRigidBodies=0,this.contacts=null,this.unusedContacts=null,this.numContacts=0,this.numContactPoints=0,this.joints=null,this.numJoints=0,this.numIslands=0,this.gravity=new OIMO.Vec3(0,-9.80665,0),this.performance=null,this.isNoStat||(this.performance=new OIMO.Performance(this));this.detectors=[];for(var n=this.detectors.length=15;n--;)this.detectors[n]=[],this.detectors[n].length=15;this.detectors[OIMO.SHAPE_SPHERE][OIMO.SHAPE_SPHERE]=new OIMO.SphereSphereCollisionDetector,this.detectors[OIMO.SHAPE_SPHERE][OIMO.SHAPE_BOX]=new OIMO.SphereBoxCollisionDetector(!1),this.detectors[OIMO.SHAPE_BOX][OIMO.SHAPE_SPHERE]=new OIMO.SphereBoxCollisionDetector(!0),this.detectors[OIMO.SHAPE_BOX][OIMO.SHAPE_BOX]=new OIMO.BoxBoxCollisionDetector,this.randX=65535,this.randA=98765,this.randB=123456789,this.maxIslandRigidBodies=64,this.islandRigidBodies=[],this.islandRigidBodies.length=this.maxIslandRigidBodies,this.islandStack=[],this.islandStack.length=this.maxIslandRigidBodies,this.maxIslandConstraints=128,this.islandConstraints=[],this.islandConstraints.length=this.maxIslandConstraints},OIMO.World.prototype={constructor:OIMO.World,clear:function(){for(this.randX=65535;null!==this.joints;)this.removeJoint(this.joints);for(;null!==this.contacts;)this.removeContact(this.contacts);for(;null!==this.rigidBodies;)this.removeRigidBody(this.rigidBodies);OIMO.nextID=0},addRigidBody:function(t){if(t.parent)throw new Error("It is not possible to be added to more than one world one of the rigid body");t.parent=this,t.awake();for(var e=t.shapes;null!==e;e=e.next)this.addShape(e);null!==this.rigidBodies&&((this.rigidBodies.prev=t).next=this.rigidBodies),this.rigidBodies=t,this.numRigidBodies++},removeRigidBody:function(t){var e=t;if(e.parent===this){e.awake();for(var o=e.jointLink;null!=o;){var i=o.joint;o=o.next,this.removeJoint(i)}for(var n=t.shapes;null!==n;n=n.next)this.removeShape(n);var s=e.prev,a=e.next;null!==s&&(s.next=a),null!==a&&(a.prev=s),this.rigidBodies==e&&(this.rigidBodies=a),e.prev=null,e.next=null,e.parent=null,this.numRigidBodies--}},getByName:function(t){for(var e=null,o=this.rigidBodies;null!==o;)" "!==o.name&&o.name===t&&(e=o),o=o.next;for(var i=this.joints;null!==i;)""!==i.name&&i.name===t&&(e=i),i=i.next;return e},addShape:function(t){if(!t.parent||!t.parent.parent)throw new Error("It is not possible to be added alone to shape world");t.proxy=this.broadPhase.createProxy(t),t.updateProxy(),this.broadPhase.addProxy(t.proxy)},removeShape:function(t){this.broadPhase.removeProxy(t.proxy),t.proxy=null},addJoint:function(t){if(t.parent)throw new Error("It is not possible to be added to more than one world one of the joint");null!=this.joints&&((this.joints.prev=t).next=this.joints),((this.joints=t).parent=this).numJoints++,t.awake(),t.attach()},removeJoint:function(t){var e=t,o=e.prev,i=e.next;null!==o&&(o.next=i),null!==i&&(i.prev=o),this.joints==e&&(this.joints=i),e.prev=null,e.next=null,this.numJoints--,this.numJoints<0&&this.numJoints,e.awake(),e.detach(),e.parent=null},worldscale:function(t){OIMO.WORLD_SCALE=t||100,OIMO.INV_SCALE=1/OIMO.WORLD_SCALE},step:function(){var t,e,o,i;this.isNoStat||(t=Date.now());for(var n=this.rigidBodies;null!==n;)n.addedToIsland=!1,n.sleeping&&(n.linearVelocity.testZero()||n.position.testDiff(n.sleepPosition)||n.orientation.testDiff(n.sleepOrientation))&&n.awake(),n=n.next;this.isNoStat||(e=Date.now()),this.broadPhase.detectPairs();for(var s=this.broadPhase.pairs,a=this.broadPhase.numPairs;a--;){var r,c,d,p=s[a];p.shape1.id<p.shape2.id?(r=p.shape1,c=p.shape2):(r=p.shape2,c=p.shape1),d=r.numContacts<c.numContacts?r.contactLink:c.contactLink;for(var l=!1;d;){if((B=d.contact).shape1==r&&B.shape2==c){l=B.persisting=!0;break}d=d.next}l||this.addContact(r,c)}for(this.isNoStat||(o=Date.now(),this.performance.broadPhaseTime=o-e),this.numContactPoints=0,B=this.contacts;null!==B;){if(!B.persisting){var u=B.shape1.aabb,y=B.shape2.aabb;if(u.minX>y.maxX||u.maxX<y.minX||u.minY>y.maxY||u.maxY<y.minY||u.minZ>y.maxZ||u.maxZ<y.minZ){var g=B.next;this.removeContact(B),B=g;continue}}var b1=B.body1,b2=B.body2;(b1.isDynamic&&!b1.sleeping||b2.isDynamic&&!b2.sleeping)&&B.updateManifold(),this.numContactPoints+=B.manifold.numPoints,B.persisting=!1,B.constraint.addedToIsland=!1,B=B.next}this.isNoStat||(i=Date.now(),this.performance.narrowPhaseTime=i-o);var m,f,A=1/this.timeStep;for(m=this.joints;null!==m;m=m.next)m.addedToIsland=!1;this.maxIslandRigidBodies<this.numRigidBodies&&(this.maxIslandRigidBodies=this.numRigidBodies<<1,this.islandRigidBodies=[],this.islandStack=[],this.islandRigidBodies.length=this.maxIslandRigidBodies,this.islandStack.length=this.maxIslandRigidBodies);var b=this.numJoints+this.numContacts;this.maxIslandConstraints<b&&(this.maxIslandConstraints=b<<1,this.islandConstraints=[],this.islandConstraints.length=this.maxIslandConstraints),e=Date.now(),this.numIslands=0;for(var v=this.rigidBodies;null!==v;v=v.next)if(!(v.addedToIsland||v.isStatic||v.sleeping))if(v.isLonely())v.isDynamic&&v.linearVelocity.addTime(this.gravity,this.timeStep),this.calSleep(v)?(v.sleepTime+=this.timeStep,.5<v.sleepTime?v.sleep():v.updatePosition(this.timeStep)):(v.sleepTime=0,v.updatePosition(this.timeStep)),this.numIslands++;else{var x=0,C=0,S=1;(this.islandStack[0]=v).addedToIsland=!0;do{if(n=this.islandStack[--S],this.islandStack[S]=null,n.sleeping=!1,!(this.islandRigidBodies[x++]=n).isStatic){for(var T=n.contactLink;null!==T;T=T.next){var B;if(!(f=(B=T.contact).constraint).addedToIsland&&B.touching)(this.islandConstraints[C++]=f).addedToIsland=!0,(g=T.body).addedToIsland||((this.islandStack[S++]=g).addedToIsland=!0)}for(var O=n.jointLink;null!==O;O=O.next)(f=O.joint).addedToIsland||((this.islandConstraints[C++]=f).addedToIsland=!0,!(g=O.body).addedToIsland&&g.isDynamic&&((this.islandStack[S++]=g).addedToIsland=!0))}}while(0!=S);for(var P=(new OIMO.Vec3).addTime(this.gravity,this.timeStep),M=x;M--;)(n=this.islandRigidBodies[M]).isDynamic&&n.linearVelocity.addEqual(P);if(this.enableRandomizer)for(M=C;M--;)if(0!==M){var I=(this.randX=this.randX*this.randA+this.randB&2147483647)/2147483648*M|0;f=this.islandConstraints[M],this.islandConstraints[M]=this.islandConstraints[I],this.islandConstraints[I]=f}for(M=C;M--;)this.islandConstraints[M].preSolve(this.timeStep,A);for(var N=this.numIterations;N--;)for(M=C;M--;)this.islandConstraints[M].solve();for(M=C;M--;)this.islandConstraints[M].postSolve(),this.islandConstraints[M]=null;var z=10;for(M=x;M--;)n=this.islandRigidBodies[M],this.calSleep(n)?(n.sleepTime+=this.timeStep,n.sleepTime<z&&(z=n.sleepTime)):z=n.sleepTime=0;if(.5<z)for(M=x;M--;)this.islandRigidBodies[M].sleep(),this.islandRigidBodies[M]=null;else for(M=x;M--;)this.islandRigidBodies[M].updatePosition(this.timeStep),this.islandRigidBodies[M]=null;this.numIslands++}for(n=this.rigidBodies;null!==n;)n.isDynamic&&(n.lastPosition.x=n.position.x,n.lastPosition.y=n.position.y,n.lastPosition.z=n.position.z),n=n.next;this.isNoStat||(o=Date.now(),this.performance.solvingTime=o-e,o=Date.now(),this.performance.upfps(),this.performance.totalTime=o-t,this.performance.updatingTime=this.performance.totalTime-(this.performance.broadPhaseTime+this.performance.narrowPhaseTime+this.performance.solvingTime))},addContact:function(t,e){var o;this.detectors[t.type][e.type]&&(null!==this.unusedContacts?(o=this.unusedContacts,this.unusedContacts=this.unusedContacts.next):o=new OIMO.Contact,o.attach(t,e),o.detector=this.detectors[t.type][e.type],o.detector,this.contacts&&((this.contacts.prev=o).next=this.contacts),this.contacts=o,this.numContacts++)},removeContact:function(t){var e=t.prev,o=t.next;o&&(o.prev=e),e&&(e.next=o),this.contacts==t&&(this.contacts=o),t.prev=null,t.next=null,t.detach(),t.next=this.unusedContacts,this.unusedContacts=t,this.numContacts--},checkContact:function(t,e){for(var o,i,n=this.contacts;null!==n;){if(o=n.body1.name||" ",i=n.body2.name||" ",o==t&&i==e||i==t&&o==e)return!!n.touching;n=n.next}return!1},calSleep:function(t){return!!t.allowSleep&&(!(.04<t.linearVelocity.len())&&!(.25<t.angularVelocity.len()))}},OIMO.RigidBody=function(t,e,o,i,n,s,a){var r=i||0,c=n||0,d=s||0,p=a||0,l=t||0,u=e||0,y=o||0;this.name=" ",this.BODY_DYNAMIC=1,this.BODY_STATIC=2,this.MAX_SHAPES=64,this.prev=null,this.next=null,this.type=0,this.massInfo=new OIMO.MassInfo,this.position=new OIMO.Vec3(l,u,y),this.lastPosition=new OIMO.Vec3(l,u,y),this.newPosition=new OIMO.Vec3(0,0,0),this.controlPos=!1,this.newOrientation=new OIMO.Quat,this.newRotation=new OIMO.Vec3(0,0,0),this.currentRotation=new OIMO.Vec3(0,0,0),this.controlRot=!1,this.controlRotInTime=!1,this.orientation=this.rotationAxisToQuad(r,c,d,p),this.linearVelocity=new OIMO.Vec3,this.angularVelocity=new OIMO.Vec3,this.matrix=new OIMO.Mat44,this.parent=null,this.contactLink=null,this.numContacts=0,this.shapes=null,this.numShapes=0,this.jointLink=null,this.numJoints=0,this.sleepPosition=new OIMO.Vec3,this.sleepOrientation=new OIMO.Quat,this.isStatic=!1,this.isDynamic=!1,this.rotation=new OIMO.Mat33,this.mass=NaN,this.inverseMass=NaN,this.inverseInertia=new OIMO.Mat33,this.localInertia=new OIMO.Mat33,this.inverseLocalInertia=new OIMO.Mat33,this.addedToIsland=!1,this.allowSleep=!0,this.sleepTime=0,this.sleeping=!1},OIMO.RigidBody.prototype={constructor:OIMO.RigidBody,addShape:function(t){if(t.parent)throw new Error("It is not possible that you add to the multi-rigid body the shape of one");null!=this.shapes&&((this.shapes.prev=t).next=this.shapes),((this.shapes=t).parent=this).parent&&this.parent.addShape(t),this.numShapes++},removeShape:function(t){var e=t;if(e.parent==this){var o=e.prev,i=e.next;null!=o&&(o.next=i),null!=i&&(i.prev=o),this.shapes==e&&(this.shapes=i),e.prev=null,e.next=null,e.parent=null,this.parent&&this.parent.removeShape(e),this.numShapes--}},setupMass:function(t,e){var o=void 0===e||e,i=t||this.BODY_DYNAMIC;this.type=i,this.isDynamic=i==this.BODY_DYNAMIC,this.isStatic=i==this.BODY_STATIC,this.mass=0,this.localInertia.init(0,0,0,0,0,0,0,0,0);for(var n=this.localInertia.elements,s=new OIMO.Mat33,a=new OIMO.Vec3,r=this.shapes;null!=r;r=r.next){r.calculateMassInfo(this.massInfo);var c=this.massInfo.mass,d=r.relativePosition.x,p=r.relativePosition.y,l=r.relativePosition.z;a.addScale(r.relativePosition,c),this.mass+=c,this.rotateInertia(r.relativeRotation,this.massInfo.inertia,s),this.localInertia.addEqual(s),n[0]+=c*(p*p+l*l),n[4]+=c*(d*d+l*l),n[8]+=c*(d*d+p*p);var u=c*d*p,y=c*p*l,g=c*l*d;n[1]-=u,n[3]-=u,n[2]-=y,n[6]-=y,n[5]-=g,n[7]-=g}if(this.inverseMass=1/this.mass,a.scaleEqual(this.inverseMass),o){for(this.position.addEqual(a),r=this.shapes;null!=r;r=r.next)r.relativePosition.subEqual(a);d=a.x,p=a.y,l=a.z,n[0]-=this.mass*(p*p+l*l),n[4]-=this.mass*(d*d+l*l),n[8]-=this.mass*(d*d+p*p),u=this.mass*d*p,y=this.mass*p*l,g=this.mass*l*d,n[1]+=u,n[3]+=u,n[2]+=y,n[6]+=y,n[5]+=g,n[7]+=g}this.inverseLocalInertia.invert(this.localInertia),i==this.BODY_STATIC&&(this.inverseMass=0,this.inverseLocalInertia.init(0,0,0,0,0,0,0,0,0)),this.syncShapes(),this.awake()},awake:function(){if(this.allowSleep&&this.sleeping){this.sleeping=!1,this.sleepTime=0;for(var t=this.contactLink;null!=t;)t.body.sleepTime=0,t.body.sleeping=!1,t=t.next;for(var e=this.jointLink;null!=e;)e.body.sleepTime=0,e.body.sleeping=!1,e=e.next;for(var o=this.shapes;null!=o;o=o.next)o.updateProxy()}},sleep:function(){if(this.allowSleep&&!this.sleeping){this.linearVelocity.init(),this.angularVelocity.init(),this.sleepPosition.copy(this.position),this.sleepOrientation.copy(this.orientation),this.sleepTime=0,this.sleeping=!0;for(var t=this.shapes;null!=t;t=t.next)t.updateProxy()}},isLonely:function(){return 0==this.numJoints&&0==this.numContacts},updatePosition:function(t){switch(this.type){case this.BODY_STATIC:this.linearVelocity.init(),this.angularVelocity.init(),this.controlPos&&(this.position.copy(this.newPosition),this.controlPos=!1),this.controlRot&&(this.orientation.copy(this.newOrientation),this.controlRot=!1);break;case this.BODY_DYNAMIC:this.controlPos&&(this.angularVelocity.init(),this.linearVelocity.init(),this.linearVelocity.x=(this.newPosition.x-this.position.x)/t,this.linearVelocity.y=(this.newPosition.y-this.position.y)/t,this.linearVelocity.z=(this.newPosition.z-this.position.z)/t,this.controlPos=!1),this.controlRot&&(this.angularVelocity.init(),this.orientation.copy(this.newOrientation),this.controlRot=!1),this.position.addTime(this.linearVelocity,t),this.orientation.addTime(this.angularVelocity,t);break;default:throw new Error("Invalid type.")}this.syncShapes()},rotateInertia:function(t,e,o){var i=t.elements,n=e.elements,s=i[0],a=i[3],r=i[6],c=i[1],d=i[4],p=i[7],l=i[2],u=i[5],y=i[8],g=n[0],m=n[3],f=n[6],b1=n[1],A=n[4],b=n[7],b2=n[2],v=n[5],x=n[8],C=s*g+c*m+l*f,S=s*b1+c*A+l*b,T=s*b2+c*v+l*x,B=a*g+d*m+u*f,O=a*b1+d*A+u*b,P=a*b2+d*v+u*x,M=r*g+p*m+y*f,I=r*b1+p*A+y*b,N=r*b2+p*v+y*x,z=o.elements;z[0]=C*s+S*c+T*l,z[1]=C*a+S*d+T*u,z[2]=C*r+S*p+T*y,z[3]=B*s+O*c+P*l,z[4]=B*a+O*d+P*u,z[5]=B*r+O*p+P*y,z[6]=M*s+I*c+N*l,z[7]=M*a+I*d+N*u,z[8]=M*r+I*p+N*y},syncShapes:function(){var t=this.orientation.s,e=this.orientation.x,o=this.orientation.y,i=this.orientation.z,n=2*e,s=2*o,a=2*i,r=e*n,c=o*s,d=i*a,p=e*s,l=o*a,u=e*a,y=t*n,g=t*s,m=t*a,f=this.rotation.elements;f[0]=1-c-d,f[1]=p-m,f[2]=u+g,f[3]=p+m,f[4]=1-r-d,f[5]=l-y,f[6]=u-g,f[7]=l+y,f[8]=1-r-c,this.rotateInertia(this.rotation,this.inverseLocalInertia,this.inverseInertia);for(var A=this.shapes;null!=A;A=A.next)A.position.mul(this.position,A.relativePosition,this.rotation),A.rotation.mul(A.relativeRotation,this.rotation),A.updateProxy()},applyImpulse:function(t,e){this.linearVelocity.addScale(e,this.inverseMass);var o=new OIMO.Vec3;o.sub(t,this.position).cross(o,e).mulMat(this.inverseInertia,o),this.angularVelocity.addEqual(o)},rotationVectToQuad:function(t){var e=OIMO.EulerToAxis(t.x*OIMO.TO_RAD,t.y*OIMO.TO_RAD,t.z*OIMO.TO_RAD);return this.rotationAxisToQuad(e[0],e[1],e[2],e[3])},rotationAxisToQuad:function(t,e,o,i){var n=e*e+o*o+i*i;0<n&&(e*=n=1/Math.sqrt(n),o*=n,i*=n);var s=Math.sin(.5*t),a=Math.cos(.5*t);return new OIMO.Quat(a,s*e,s*o,s*i)},setPosition:function(t){this.newPosition.init(t.x*OIMO.INV_SCALE,t.y*OIMO.INV_SCALE,t.z*OIMO.INV_SCALE),this.controlPos=!0},setQuaternion:function(t){this.newOrientation.init(t.w,t.x,t.y,t.z),this.controlRot=!0},setRotation:function(t){this.newOrientation=this.rotationVectToQuad(t),this.controlRot=!0},resetPosition:function(t,e,o){this.linearVelocity.init(),this.angularVelocity.init(),this.position.init(t*OIMO.INV_SCALE,e*OIMO.INV_SCALE,o*OIMO.INV_SCALE),this.awake()},resetQuaternion:function(t){this.angularVelocity.init(),this.orientation=new OIMO.Quat(t.w,t.x,t.y,t.z),this.awake()},resetRotation:function(t,e,o){this.angularVelocity.init(),this.orientation=this.rotationVectToQuad(new OIMO.Vec3(t,e,o)),this.awake()},getPosition:function(){return(new OIMO.Vec3).scale(this.position,OIMO.WORLD_SCALE)},getRotation:function(){return(new OIMO.Euler).setFromRotationMatrix(this.rotation)},getQuaternion:function(){return(new OIMO.Quaternion).setFromRotationMatrix(this.rotation)},getMatrix:function(){var t,e,o=this.matrix.elements;return this.sleeping?o[15]=1:(t=this.rotation.elements,o[0]=t[0],o[1]=t[3],o[2]=t[6],o[3]=0,o[4]=t[1],o[5]=t[4],o[6]=t[7],o[7]=0,o[8]=t[2],o[9]=t[5],o[10]=t[8],o[11]=0,e=this.position,o[12]=e.x*OIMO.WORLD_SCALE,o[13]=e.y*OIMO.WORLD_SCALE,o[14]=e.z*OIMO.WORLD_SCALE,o[15]=0),o}},OIMO.Body=function(t){var e=t||{};if(e.world){this.parent=e.world,this.name=e.name||"";var o=e.move||!1,i=e.noSleep||!1,n=e.pos||[0,0,0];n=n.map(function(t){return t*OIMO.INV_SCALE});var s=e.size||[1,1,1];s=s.map(function(t){return t*OIMO.INV_SCALE});var a=e.rot||[0,0,0];a=a.map(function(t){return t*OIMO.TO_RAD});for(var r=[],c=0;c<a.length/3;c++){var d=OIMO.EulerToAxis(a[c+0],a[c+1],a[c+2]);r.push(d[0]),r.push(d[1]),r.push(d[2]),r.push(d[3])}var p=e.sc||new OIMO.ShapeConfig;e.config&&(p.density=e.config[0]||1,p.friction=e.config[1]||.4,p.restitution=e.config[2]||.2,p.belongsTo=e.config[3]||1,p.collidesWith=e.config[4]||4294967295),e.massPos&&(e.massPos=e.massPos.map(function(t){return t*OIMO.INV_SCALE}),p.relativePosition.init(e.massPos[0],e.massPos[1],e.massPos[2])),e.massRot&&(e.massRot=e.massRot.map(function(t){return t*OIMO.TO_RAD}),p.relativeRotation=OIMO.EulerToMatrix(e.massRot[0],e.massRot[1],e.massRot[2])),this.body=new OIMO.RigidBody(n[0],n[1],n[2],r[0],r[1],r[2],r[3]);var l,u,y=[],g=e.type||"box";"string"==typeof g&&(g=[g]);for(c=0;c<g.length;c++){switch(l=3*c,u=4*c,g[c]){case"sphere":y[c]=new OIMO.SphereShape(p,s[l+0]);break;case"box":y[c]=new OIMO.BoxShape(p,s[l+0],s[l+1],s[l+2])}this.body.addShape(y[c]),0<c&&(y[c].relativePosition=new OIMO.Vec3(n[l+0],n[l+1],n[l+2]),r[u+0]&&(y[c].relativeRotation=[r[u+0],r[u+1],r[u+2],r[u+3]]))}o?(e.massPos||e.massRot?this.body.setupMass(1,!1):this.body.setupMass(1,!0),this.body.allowSleep=!i):this.body.setupMass(2),this.body.name=this.name,this.sleeping=this.body.sleeping,this.parent.addRigidBody(this.body)}},OIMO.Body.prototype={constructor:OIMO.Body,setPosition:function(t){this.body.setPosition(t)},setQuaternion:function(t){this.body.setQuaternion(t)},setRotation:function(t){this.body.setRotation(t)},getPosition:function(){return this.body.getPosition()},getRotation:function(){return this.body.getRotation()},getQuaternion:function(){return this.body.getQuaternion()},getMatrix:function(){return this.body.getMatrix()},getSleep:function(){return this.body.sleeping},resetPosition:function(t,e,o){this.body.resetPosition(t,e,o)},resetRotation:function(t,e,o){this.body.resetRotation(t,e,o)},awake:function(){this.body.awake()},remove:function(){this.parent.removeRigidBody(this.body)},checkContact:function(t){this.parent.checkContact(this.name,t)}},OIMO.Link=function(t){var e=t||{};if(e.world){this.parent=e.world,this.name=e.name||"";var o,i,n=e.type||"jointHinge",s=e.axe1||[1,0,0],a=e.axe2||[1,0,0],r=e.pos1||[0,0,0],c=e.pos2||[0,0,0];r=r.map(function(t){return t*OIMO.INV_SCALE}),c=c.map(function(t){return t*OIMO.INV_SCALE}),"jointDistance"===n?(o=e.min||0,i=e.max||10,o*=OIMO.INV_SCALE,i*=OIMO.INV_SCALE):(o=e.min||57.29578,i=e.max||0,o*=OIMO.TO_RAD,i*=OIMO.TO_RAD);var d=e.limit||null,p=e.spring||null,l=e.motor||null,u=new OIMO.JointConfig;switch(u.allowCollision=e.collision||!1,u.localAxis1.init(s[0],s[1],s[2]),u.localAxis2.init(a[0],a[1],a[2]),u.localAnchorPoint1.init(r[0],r[1],r[2]),u.localAnchorPoint2.init(c[0],c[1],c[2]),("string"==typeof e.body1||e.body1 instanceof String)&&(e.body1=e.world.getByName(e.body1)),("string"==typeof e.body2||e.body2 instanceof String)&&(e.body2=e.world.getByName(e.body2)),u.body1=e.body1,u.body2=e.body2,n){case"jointDistance":this.joint=new OIMO.DistanceJoint(u,o,i),null!==p&&this.joint.limitMotor.setSpring(p[0],p[1]),null!==l&&this.joint.limitMotor.setSpring(l[0],l[1]);break;case"jointHinge":this.joint=new OIMO.HingeJoint(u,o,i),null!==p&&this.joint.limitMotor.setSpring(p[0],p[1]),null!==l&&this.joint.limitMotor.setSpring(l[0],l[1]);break;case"jointPrisme":this.joint=new OIMO.PrismaticJoint(u,o,i);break;case"jointSlide":this.joint=new OIMO.SliderJoint(u,o,i);break;case"jointBall":this.joint=new OIMO.BallAndSocketJoint(u);break;case"jointWheel":this.joint=new OIMO.WheelJoint(u),null!==d&&this.joint.rotationalLimitMotor1.setLimit(d[0],d[1]),null!==p&&this.joint.rotationalLimitMotor1.setSpring(p[0],p[1]),null!==l&&this.joint.rotationalLimitMotor1.setSpring(l[0],l[1])}this.joint.name=this.name,this.parent.addJoint(this.joint)}},OIMO.Link.prototype={constructor:OIMO.Link,getPosition:function(){return this.joint.getPosition()},getMatrix:function(){return this.joint.getMatrix()},remove:function(){this.parent.removeJoint(this.joint)},awake:function(){this.joint.awake()}},OIMO.Performance=function(t){this.parent=t,this.infos=new OIMO_ARRAY_TYPE(13),this.f=[0,0,0],this.fps=0,this.broadPhaseTime=0,this.narrowPhaseTime=0,this.solvingTime=0,this.updatingTime=0,this.totalTime=0},OIMO.Performance.prototype={upfps:function(){this.f[1]=Date.now(),this.f[1]-1e3>this.f[0]&&(this.f[0]=this.f[1],this.fps=this.f[2],this.f[2]=0),this.f[2]++},show:function(){return["Oimo.js DEV.1.1.2a<br><br>","FPS: "+this.fps+" fps<br><br>","rigidbody "+this.parent.numRigidBodies+"<br>","contact &nbsp;&nbsp;"+this.parent.numContacts+"<br>","paircheck "+this.parent.broadPhase.numPairChecks+"<br>","contact &nbsp;&nbsp;"+this.parent.numContactPoints+"<br>","island &nbsp;&nbsp;&nbsp;"+this.parent.numIslands+"<br><br>","Time in ms <br>","broad-phase &nbsp;"+this.broadPhaseTime+"<br>","narrow-phase "+this.narrowPhaseTime+"<br>","solving &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+this.solvingTime+"<br>","updating &nbsp;&nbsp;&nbsp;&nbsp;"+this.updatingTime+"<br>","total &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+this.totalTime].join("\n")},toArray:function(){return this.infos[0]=this.parent.broadPhase.types,this.infos[1]=this.parent.numRigidBodies,this.infos[2]=this.parent.numContacts,this.infos[3]=this.parent.broadPhase.numPairChecks,this.infos[4]=this.parent.numContactPoints,this.infos[5]=this.parent.numIslands,this.infos[6]=this.broadPhaseTime,this.infos[7]=this.narrowPhaseTime,this.infos[8]=this.solvingTime,this.infos[9]=this.updatingTime,this.infos[10]=this.totalTime,this.infos[11]=this.fps,this.infos}},OIMO.Mat44=function(t,e,o,i,n,s,a,r,c,d,p,l,u,y,g,m){this.elements=new OIMO_ARRAY_TYPE(16);var f=this.elements;f[0]=void 0!==t?t:1,f[4]=e||0,f[8]=o||0,f[12]=i||0,f[1]=n||0,f[5]=void 0!==s?s:1,f[9]=a||0,f[13]=r||0,f[2]=c||0,f[6]=d||0,f[10]=void 0!==p?p:1,f[14]=l||0,f[3]=u||0,f[7]=y||0,f[11]=g||0,f[15]=void 0!==m?m:1},OIMO.Mat44.prototype={constructor:OIMO.Mat44,set:function(t,e,o,i,n,s,a,r,c,d,p,l,u,y,g,m){var f=this.elements;return f[0]=t,f[4]=e,f[8]=o,f[12]=i,f[1]=n,f[5]=s,f[9]=a,f[13]=r,f[2]=c,f[6]=d,f[10]=p,f[14]=l,f[3]=u,f[7]=y,f[11]=g,f[15]=m,this}},OIMO.Mat33=function(t,e,o,i,n,s,a,r,c){this.elements=new OIMO_ARRAY_TYPE(9);this.elements;this.init(void 0!==t?t:1,e||0,o||0,i||0,void 0!==n?n:1,s||0,a||0,r||0,void 0!==c?c:1)},OIMO.Mat33.prototype={constructor:OIMO.Mat33,init:function(t,e,o,i,n,s,a,r,c){var d=this.elements;return d[0]=t,d[1]=e,d[2]=o,d[3]=i,d[4]=n,d[5]=s,d[6]=a,d[7]=r,d[8]=c,this},add:function(t,e){var o=this.elements,i=t.elements,n=e.elements;return o[0]=i[0]+n[0],o[1]=i[1]+n[1],o[2]=i[2]+n[2],o[3]=i[3]+n[3],o[4]=i[4]+n[4],o[5]=i[5]+n[5],o[6]=i[6]+n[6],o[7]=i[7]+n[7],o[8]=i[8]+n[8],this},addEqual:function(t){var e=this.elements,o=t.elements;return e[0]+=o[0],e[1]+=o[1],e[2]+=o[2],e[3]+=o[3],e[4]+=o[4],e[5]+=o[5],e[6]+=o[6],e[7]+=o[7],e[8]+=o[8],this},sub:function(t,e){var o=this.elements,i=t.elements,n=e.elements;return o[0]=i[0]-n[0],o[1]=i[1]-n[1],o[2]=i[2]-n[2],o[3]=i[3]-n[3],o[4]=i[4]-n[4],o[5]=i[5]-n[5],o[6]=i[6]-n[6],o[7]=i[7]-n[7],o[8]=i[8]-n[8],this},subEqual:function(t){var e=this.elements,o=t.elements;return e[0]-=o[0],e[1]-=o[1],e[2]-=o[2],e[3]-=o[3],e[4]-=o[4],e[5]-=o[5],e[6]-=o[6],e[7]-=o[7],e[8]-=o[8],this},scale:function(t,e){var o=this.elements,i=t.elements;return o[0]=i[0]*e,o[1]=i[1]*e,o[2]=i[2]*e,o[3]=i[3]*e,o[4]=i[4]*e,o[5]=i[5]*e,o[6]=i[6]*e,o[7]=i[7]*e,o[8]=i[8]*e,this},scaleEqual:function(t){var e=this.elements;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,this},mul:function(t,e){var o=this.elements,i=t.elements,n=e.elements,s=i[0],a=i[3],r=i[6],c=i[1],d=i[4],p=i[7],l=i[2],u=i[5],y=i[8],g=n[0],m=n[3],f=n[6],b1=n[1],A=n[4],b=n[7],b2=n[2],v=n[5],x=n[8];return o[0]=s*g+c*m+l*f,o[1]=s*b1+c*A+l*b,o[2]=s*b2+c*v+l*x,o[3]=a*g+d*m+u*f,o[4]=a*b1+d*A+u*b,o[5]=a*b2+d*v+u*x,o[6]=r*g+p*m+y*f,o[7]=r*b1+p*A+y*b,o[8]=r*b2+p*v+y*x,this},mulScale:function(t,e,o,i,n){var s=n||!1,a=this.elements,r=t.elements;return s?(a[0]=e*r[0],a[1]=e*r[1],a[2]=e*r[2],a[3]=o*r[3],a[4]=o*r[4],a[5]=o*r[5],a[6]=i*r[6],a[7]=i*r[7],a[8]=i*r[8]):(a[0]=r[0]*e,a[1]=r[1]*o,a[2]=r[2]*i,a[3]=r[3]*e,a[4]=r[4]*o,a[5]=r[5]*i,a[6]=r[6]*e,a[7]=r[7]*o,a[8]=r[8]*i),this},mulRotate:function(t,e,o,i,n,s){var a=s||!1,r=Math.sin(e),c=Math.cos(e),c1=1-c,d=o*o*c1+c,p=o*i*c1-n*r,l=o*n*c1+i*r,u=i*o*c1+n*r,y=i*i*c1+c,g=i*n*c1-o*r,m=n*o*c1-i*r,f=n*i*c1+o*r,A=n*n*c1+c,b=t.elements,v=b[0],x=b[3],C=b[6],S=b[1],T=b[4],B=b[7],O=b[2],P=b[5],M=b[8],I=this.elements;return a?(I[0]=d*v+p*x+l*C,I[1]=d*S+p*T+l*B,I[2]=d*O+p*P+l*M,I[3]=u*v+y*x+g*C,I[4]=u*S+y*T+g*B,I[5]=u*O+y*P+g*M,I[6]=m*v+f*x+A*C,I[7]=m*S+f*T+A*B,I[8]=m*O+f*P+A*M):(I[0]=v*d+S*u+O*m,I[1]=v*p+S*y+O*f,I[2]=v*l+S*g+O*A,I[3]=x*d+T*u+P*m,I[4]=x*p+T*y+P*f,I[5]=x*l+T*g+P*A,I[6]=C*d+B*u+M*m,I[7]=C*p+B*y+M*f,I[8]=C*l+B*g+M*A),this},transpose:function(t){var e=this.elements,o=t.elements;return e[0]=o[0],e[1]=o[3],e[2]=o[6],e[3]=o[1],e[4]=o[4],e[5]=o[7],e[6]=o[2],e[7]=o[5],e[8]=o[8],this},setQuat:function(t){var e=this.elements,o=2*t.x,i=2*t.y,n=2*t.z,s=t.x*o,a=t.y*i,r=t.z*n,c=t.x*i,d=t.y*n,p=t.x*n,l=t.s*o,u=t.s*i,y=t.s*n;return e[0]=1-a-r,e[1]=c-y,e[2]=p+u,e[3]=c+y,e[4]=1-s-r,e[5]=d-l,e[6]=p-u,e[7]=d+l,e[8]=1-s-a,this},invert:function(t){var e=this.elements,o=t.elements,i=o[0],n=o[3],s=o[6],a=o[1],r=o[4],c=o[7],d=o[2],p=o[5],l=o[8],u=r*l-c*p,y=c*d-a*l,g=a*p-r*d,m=i*u+n*y+s*g;return 0!=m&&(m=1/m),e[0]=m*u,e[1]=m*y,e[2]=m*g,e[3]=m*(p*s-n*l),e[4]=m*(i*l-d*s),e[5]=m*(d*n-i*p),e[6]=m*(n*c-r*s),e[7]=m*(a*s-i*c),e[8]=m*(i*r-a*n),this},copy:function(t){var e=this.elements,o=t.elements;return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=o[7],e[8]=o[8],this},toEuler:function(){var t=this.elements,e=t[0],o=t[3],i=t[6],n=(t[1],t[4]),s=t[7],a=(t[2],t[5]),r=t[8],c=new OIMO.Vec3;new OIMO.Quat;return c.y=Math.asin(function clamp(t){return Math.min(Math.max(t,-1),1)}(i)),Math.abs(i)<.99999?(c.x=Math.atan2(-s,r),c.z=Math.atan2(-o,e)):(c.x=Math.atan2(a,n),c.z=0),c},clone:function(){var t=this.elements;return new OIMO.Mat33(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},toString:function(){var t=this.elements;return"Mat33|"+t[0].toFixed(4)+", "+t[1].toFixed(4)+", "+t[2].toFixed(4)+"|\n     |"+t[3].toFixed(4)+", "+t[4].toFixed(4)+", "+t[5].toFixed(4)+"|\n     |"+t[6].toFixed(4)+", "+t[7].toFixed(4)+", "+t[8].toFixed(4)+"|"}},OIMO.Quat=function(t,e,o,i){this.s=void 0!==t?t:1,this.x=e||0,this.y=o||0,this.z=i||0},OIMO.Quat.prototype={constructor:OIMO.Quat,init:function(t,e,o,i){return this.s=void 0!==t?t:1,this.x=e||0,this.y=o||0,this.z=i||0,this},add:function(t,e){return this.s=t.s+e.s,this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addTime:function(t,e){var o=t.x,i=t.y,n=t.z,s=this.s,a=this.x,r=this.y,c=this.z,d=(o*s+i*c-n*r)*(e*=.5),p=(-o*c+i*s+n*a)*e,l=(o*r-i*a+n*s)*e;s+=(-o*a-i*r-n*c)*e,a+=d,r+=p,c+=l;var u=1/Math.sqrt(s*s+a*a+r*r+c*c);return this.s=s*u,this.x=a*u,this.y=r*u,this.z=c*u,this},sub:function(t,e){return this.s=t.s-e.s,this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},scale:function(t,e){return this.s=t.s*e,this.x=t.x*e,this.y=t.y*e,this.z=t.z*e,this},mul:function(t,e){var o=t.x,i=t.y,n=t.z,s=t.s,a=e.x,r=e.y,c=e.z,d=e.s;return this.x=o*d+s*a+i*c-n*r,this.y=i*d+s*r+n*a-o*c,this.z=n*d+s*c+o*r-i*a,this.s=s*d-o*a-i*r-n*c,this},arc:function(t,e){var o=t.x,i=t.y,n=t.z,s=e.x,a=e.y,r=e.z,c=o*s+i*a+n*r;if(-1==c)return s=i*o-n*n,a=-n*i-o*o,r=o*n+i*i,c=1/Math.sqrt(s*s+a*a+r*r),this.s=0,this.x=s*c,this.y=a*c,this.z=r*c,this;var d=i*r-n*a,p=n*s-o*r,l=o*a-i*s;return this.s=Math.sqrt(.5*(1+c)),c=.5/this.s,this.x=d*c,this.y=p*c,this.z=l*c,this},normalize:function(t){var e=Math.sqrt(t.s*t.s+t.x*t.x+t.y*t.y+t.z*t.z);return 0<e&&(e=1/e),this.s=t.s*e,this.x=t.x*e,this.y=t.y*e,this.z=t.z*e,this},invert:function(t){return this.s=t.s,this.x=-t.x,this.y=-t.y,this.z=-t.z,this},length:function(){return Math.sqrt(this.s*this.s+this.x*this.x+this.y*this.y+this.z*this.z)},copy:function(t){return this.s=t.s,this.x=t.x,this.y=t.y,this.z=t.z,this},testDiff:function(t){return this.s!==t.s||this.x!==t.x||this.y!==t.y||this.z!==t.z},clone:function(t){return new OIMO.Quat(this.s,this.x,this.y,this.z)},toString:function(){return"Quat["+this.s.toFixed(4)+", ("+this.x.toFixed(4)+", "+this.y.toFixed(4)+", "+this.z.toFixed(4)+")]"},setFromAxisAngle:function(t,e){var o=e/2,i=Math.sin(o);return this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this.s=Math.cos(o),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var o=this.x,i=this.y,n=this.z,s=this.s,a=s*t.s+o*t.x+i*t.y+n*t.z;if(a<0?(this.s=-t.s,this.x=-t.x,this.y=-t.y,this.z=-t.z,a=-a):this.copy(t),1<=a)return this.s=s,this.x=o,this.y=i,this.z=n,this;var r=Math.acos(a),c=Math.sqrt(1-a*a);if(Math.abs(c)<.001)return this.s=.5*(s+this.s),this.x=.5*(o+this.x),this.y=.5*(i+this.y),this.z=.5*(n+this.z),this;var d=Math.sin((1-e)*r)/c,p=Math.sin(e*r)/c;return this.s=s*d+this.s*p,this.x=o*d+this.x*p,this.y=i*d+this.y*p,this.z=n*d+this.z*p,this},setFromRotationMatrix:function(t){var e,o=t.elements,i=o[0],n=o[1],s=o[2],a=o[3],r=o[4],c=o[5],d=o[6],p=o[7],l=o[8],u=i+r+l;return 0<u?(e=.5/Math.sqrt(u+1),this.s=.25/e,this.x=(p-c)*e,this.y=(s-d)*e,this.z=(a-n)*e):r<i&&l<i?(e=2*Math.sqrt(1+i-r-l),this.s=(p-c)/e,this.x=.25*e,this.y=(n+a)/e,this.z=(s+d)/e):l<r?(e=2*Math.sqrt(1+r-i-l),this.s=(s-d)/e,this.x=(n+a)/e,this.y=.25*e,this.z=(c+p)/e):(e=2*Math.sqrt(1+l-i-r),this.s=(a-n)/e,this.x=(s+d)/e,this.y=(c+p)/e,this.z=.25*e),this}},OIMO.Quaternion=function(t,e,o,i){this.x=t||0,this.y=e||0,this.z=o||0,this.w=void 0!==i?i:1},OIMO.Quaternion.prototype={constructor:OIMO.Quaternion,setFromRotationMatrix:function(t){var e,o=t.elements,i=o[0],n=o[1],s=o[2],a=o[3],r=o[4],c=o[5],d=o[6],p=o[7],l=o[8],u=i+r+l;return 0<u?(e=.5/Math.sqrt(u+1),this.w=.25/e,this.x=(p-c)*e,this.y=(s-d)*e,this.z=(a-n)*e):r<i&&l<i?(e=2*Math.sqrt(1+i-r-l),this.w=(p-c)/e,this.x=.25*e,this.y=(n+a)/e,this.z=(s+d)/e):l<r?(e=2*Math.sqrt(1+r-i-l),this.w=(s-d)/e,this.x=(n+a)/e,this.y=.25*e,this.z=(c+p)/e):(e=2*Math.sqrt(1+l-i-r),this.w=(a-n)/e,this.x=(s+d)/e,this.y=(c+p)/e,this.z=.25*e),this}},OIMO.Vec3=function(t,e,o){this.x=t||0,this.y=e||0,this.z=o||0},OIMO.Vec3.prototype={constructor:OIMO.Vec3,init:function(t,e,o){return this.x=t||0,this.y=e||0,this.z=o||0,this},set:function(t,e,o){return this.x=t,this.y=e,this.z=o,this},add:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addEqual:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},addTime:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},subEqual:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},addScale:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},scale:function(t,e){return this.x=t.x*e,this.y=t.y*e,this.z=t.z*e,this},scaleEqual:function(t){return this.x*=t,this.y*=t,this.z*=t,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},cross:function(t,e){var o=t.x,i=t.y,n=t.z,s=e.x,a=e.y,r=e.z;return this.x=i*r-n*a,this.y=n*s-o*r,this.z=o*a-i*s,this},mul:function(t,e,o){var i=o.elements;return this.x=t.x+e.x*i[0]+e.y*i[1]+e.z*i[2],this.y=t.y+e.x*i[3]+e.y*i[4]+e.z*i[5],this.z=t.z+e.x*i[6]+e.y*i[7]+e.z*i[8],this},mulMat:function(t,e){var o=t.elements,i=o[0]*e.x+o[1]*e.y+o[2]*e.z,n=o[3]*e.x+o[4]*e.y+o[5]*e.z,s=o[6]*e.x+o[7]*e.y+o[8]*e.z;return this.x=i,this.y=n,this.z=s,this},normalize:function(t){var e=t.x,o=t.y,i=t.z,n=e*e+o*o+i*i;return 0<n&&(n=1/Math.sqrt(n),this.x=e*n,this.y=o*n,this.z=i*n),this},invert:function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this},length:function(){var t=this.x,e=this.y,o=this.z;return Math.sqrt(t*t+e*e+o*o)},len:function(){var t=this.x,e=this.y,o=this.z;return t*t+e*e+o*o},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},applyQuaternion:function(t){var e=this.x,o=this.y,i=this.z,n=t.x,s=t.y,a=t.z,r=t.s,c=r*e+s*i-a*o,d=r*o+a*e-n*i,p=r*i+n*o-s*e,l=-n*e-s*o-a*i;return this.x=c*r+l*-n+d*-a-p*-s,this.y=d*r+l*-s+p*-n-c*-a,this.z=p*r+l*-a+c*-s-d*-n,this},testZero:function(){return 0!==this.x||0!==this.y||0!==this.z},testDiff:function(t){return this.x!==t.x||this.y!==t.y||this.z!==t.z},clone:function(){return new OIMO.Vec3(this.x,this.y,this.z)},toString:function(){return"Vec3["+this.x.toFixed(4)+", "+this.y.toFixed(4)+", "+this.z.toFixed(4)+"]"}},OIMO.Euler=function(t,e,o,i){this._x=t||0,this._y=e||0,this._z=o||0,this._order=i||OIMO.Euler.DefaultOrder},OIMO.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],OIMO.Euler.DefaultOrder="XYZ",OIMO.clamp=function(t,e,o){return t<e?e:o<t?o:t},OIMO.Euler.prototype={constructor:OIMO.Euler,_x:0,_y:0,_z:0,_order:OIMO.Euler.DefaultOrder,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get order(){return this._order},set order(t){this._order=t,this.onChangeCallback()},set:function(t,e,o,i){return this._x=t,this._y=e,this._z=o,this._order=i||this._order,this.onChangeCallback(),this},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e){var o=OIMO.clamp,i=t.elements,n=i[0],s=i[1],a=i[2],r=i[3],c=i[4],d=i[5],p=i[6],l=i[7],u=i[8];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(o(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-d,u),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(l,c),this._z=0)):"YXZ"===e?(this._x=Math.asin(-o(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(a,u),this._z=Math.atan2(r,c)):(this._y=Math.atan2(-p,n),this._z=0)):"ZXY"===e?(this._x=Math.asin(o(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(-p,u),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(r,n))):"ZYX"===e?(this._y=Math.asin(-o(p,-1,1)),Math.abs(p)<.99999?(this._x=Math.atan2(l,u),this._z=Math.atan2(r,n)):(this._x=0,this._z=Math.atan2(-s,c))):"YZX"===e?(this._z=Math.asin(o(r,-1,1)),Math.abs(r)<.99999?(this._x=Math.atan2(-d,c),this._y=Math.atan2(-p,n)):(this._x=0,this._y=Math.atan2(a,u))):"XZY"===e&&(this._z=Math.asin(-o(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(l,c),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-d,u),this._y=0)),this._order=e,this.onChangeCallback(),this},setFromQuaternion:function(t,e,o){var i=OIMO.clamp,n=t.x*t.x,s=t.y*t.y,a=t.z*t.z,r=t.s*t.s;return"XYZ"===(e=e||this._order)?(this._x=Math.atan2(2*(t.x*t.s-t.y*t.z),r-n-s+a),this._y=Math.asin(i(2*(t.x*t.z+t.y*t.s),-1,1)),this._z=Math.atan2(2*(t.z*t.s-t.x*t.y),r+n-s-a)):"YXZ"===e?(this._x=Math.asin(i(2*(t.x*t.s-t.y*t.z),-1,1)),this._y=Math.atan2(2*(t.x*t.z+t.y*t.s),r-n-s+a),this._z=Math.atan2(2*(t.x*t.y+t.z*t.s),r-n+s-a)):"ZXY"===e?(this._x=Math.asin(i(2*(t.x*t.s+t.y*t.z),-1,1)),this._y=Math.atan2(2*(t.y*t.s-t.z*t.x),r-n-s+a),this._z=Math.atan2(2*(t.z*t.s-t.x*t.y),r-n+s-a)):"ZYX"===e?(this._x=Math.atan2(2*(t.x*t.s+t.z*t.y),r-n-s+a),this._y=Math.asin(i(2*(t.y*t.s-t.x*t.z),-1,1)),this._z=Math.atan2(2*(t.x*t.y+t.z*t.s),r+n-s-a)):"YZX"===e?(this._x=Math.atan2(2*(t.x*t.s-t.z*t.y),r-n+s-a),this._y=Math.atan2(2*(t.y*t.s-t.x*t.z),r+n-s-a),this._z=Math.asin(i(2*(t.x*t.y+t.z*t.s),-1,1))):"XZY"===e&&(this._x=Math.atan2(2*(t.x*t.s+t.y*t.z),r-n+s-a),this._y=Math.atan2(2*(t.x*t.z+t.y*t.s),r+n-s-a),this._z=Math.asin(i(2*(t.z*t.s-t.x*t.y),-1,1))),this._order=e,!1!==o&&this.onChangeCallback(),this},reorder:function(){var e=new OIMO.Quat;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){},clone:function(){return new OIMO.Euler(this._x,this._y,this._z,this._order)}},OIMO.EulerToAxis=function(t,e,o){var c1=Math.cos(.5*e),i=Math.sin(.5*e),c2=Math.cos(.5*o),n=Math.sin(.5*o),c3=Math.cos(.5*t),s=Math.sin(.5*t),a=c1*c2,r=i*n,c=a*c3-r*s,d=a*s+r*c3,p=i*c2*c3+c1*n*s,l=c1*n*c3-i*c2*s,u=2*Math.acos(c),y=d*d+p*p+l*l;return y<.001?(d=1,p=l=0):(d/=y=Math.sqrt(y),p/=y,l/=y),[u,d,p,l]},OIMO.EulerToMatrix=function(t,e,o){var ch=Math.cos(e),i=Math.sin(e),n=Math.cos(o),s=Math.sin(o),a=Math.cos(t),r=Math.sin(t),c=new OIMO.Mat33,d=c.elements;return d[0]=ch*n,d[1]=i*r-ch*s*a,d[2]=ch*s*r+i*a,d[3]=s,d[4]=n*a,d[5]=-n*r,d[6]=-i*n,d[7]=i*s*a+ch*r,d[8]=-i*s*r+ch*a,c},OIMO.MatrixToEuler=function(t){var e,o,i,n=t.elements;return.998<n[3]?(o=Math.atan2(n[2],n[8]),i=Math.PI/2,e=0):n[3]<-.998?(o=Math.atan2(n[2],n[8]),i=-Math.PI/2,e=0):(o=Math.atan2(-n[6],n[0]),e=Math.atan2(-n[5],n[4]),i=Math.asin(n[3])),[e,o,i]},OIMO.unwrapDegrees=function(t){return 180<(t%=360)&&(t-=360),t<-180&&(t+=360),t},OIMO.unwrapRadian=function(t){return(t%=OIMO.TwoPI)>Math.PI&&(t-=OIMO.TwoPI),t<-Math.PI&&(t+=OIMO.TwoPI),t},OIMO.Distance3d=function(p1,p2){var t=p2[0]-p1[0],e=p2[1]-p1[1],o=p2[2]-p1[2];return Math.sqrt(t*t+e*e+o*o)},OIMO.Constraint=function(){this.parent=null,this.body1=null,this.body2=null,this.addedToIsland=!1},OIMO.Constraint.prototype={constructor:OIMO.Constraint,preSolve:function(t,e){throw new Error("Inheritance error.")},solve:function(){throw new Error("Inheritance error.")},postSolve:function(){throw new Error("Inheritance error.")}},OIMO.Joint=function(t){OIMO.Constraint.call(this),this.name="",this.JOINT_DISTANCE=1,this.JOINT_BALL_AND_SOCKET=2,this.JOINT_HINGE=3,this.JOINT_z1054=4,this.JOINT_SLIDER=5,this.JOINT_PRISMATIC=6,this.type=0,this.prev=null,this.next=null,this.body1=t.body1,this.body2=t.body2,this.localAnchorPoint1=(new OIMO.Vec3).copy(t.localAnchorPoint1),this.localAnchorPoint2=(new OIMO.Vec3).copy(t.localAnchorPoint2),this.relativeAnchorPoint1=new OIMO.Vec3,this.relativeAnchorPoint2=new OIMO.Vec3,this.anchorPoint1=new OIMO.Vec3,this.anchorPoint2=new OIMO.Vec3,this.allowCollision=t.allowCollision,this.b1Link=new OIMO.JointLink(this),this.b2Link=new OIMO.JointLink(this),this.matrix=new OIMO.Mat44},OIMO.Joint.prototype=Object.create(OIMO.Constraint.prototype),OIMO.Joint.prototype.updateAnchorPoints=function(){var p1=this.body1.position,p2=this.body2.position,t=this.body1.rotation.elements,e=this.body2.rotation.elements,o=this.localAnchorPoint1.x,i=this.localAnchorPoint1.y,n=this.localAnchorPoint1.z,s=this.localAnchorPoint2.x,a=this.localAnchorPoint2.y,r=this.localAnchorPoint2.z,c=o*t[0]+i*t[1]+n*t[2],d=o*t[3]+i*t[4]+n*t[5],p=o*t[6]+i*t[7]+n*t[8],l=s*e[0]+a*e[1]+r*e[2],u=s*e[3]+a*e[4]+r*e[5],y=s*e[6]+a*e[7]+r*e[8];this.relativeAnchorPoint1.x=c,this.relativeAnchorPoint1.y=d,this.relativeAnchorPoint1.z=p,this.relativeAnchorPoint2.x=l,this.relativeAnchorPoint2.y=u,this.relativeAnchorPoint2.z=y;var g=c+p1.x,m=d+p1.y,f=p+p1.z,A=l+p2.x,b=u+p2.y,v=y+p2.z;this.anchorPoint1.x=g,this.anchorPoint1.y=m,this.anchorPoint1.z=f,this.anchorPoint2.x=A,this.anchorPoint2.y=b,this.anchorPoint2.z=v},OIMO.Joint.prototype.attach=function(){this.b1Link.body=this.body2,this.b2Link.body=this.body1,null!=this.body1.jointLink?(this.b1Link.next=this.body1.jointLink).prev=this.b1Link:this.b1Link.next=null,this.body1.jointLink=this.b1Link,this.body1.numJoints++,null!=this.body2.jointLink?(this.b2Link.next=this.body2.jointLink).prev=this.b2Link:this.b2Link.next=null,this.body2.jointLink=this.b2Link,this.body2.numJoints++},OIMO.Joint.prototype.detach=function(){var t=this.b1Link.prev,e=this.b1Link.next;null!=t&&(t.next=e),null!=e&&(e.prev=t),this.body1.jointLink==this.b1Link&&(this.body1.jointLink=e),this.b1Link.prev=null,this.b1Link.next=null,this.b1Link.body=null,this.body1.numJoints--,t=this.b2Link.prev,e=this.b2Link.next,null!=t&&(t.next=e),null!=e&&(e.prev=t),this.body2.jointLink==this.b2Link&&(this.body2.jointLink=e),this.b2Link.prev=null,this.b2Link.next=null,this.b2Link.body=null,this.body2.numJoints--,this.b1Link.body=null,this.b2Link.body=null},OIMO.Joint.prototype.awake=function(){this.body1.awake(),this.body2.awake()},OIMO.Joint.prototype.preSolve=function(t,e){},OIMO.Joint.prototype.solve=function(){},OIMO.Joint.prototype.postSolve=function(){},OIMO.Joint.prototype.getPosition=function(){return[(new OIMO.Vec3).scale(this.anchorPoint1,OIMO.WORLD_SCALE),(new OIMO.Vec3).scale(this.anchorPoint2,OIMO.WORLD_SCALE)]},OIMO.Joint.prototype.getMatrix=function(){var t=this.matrix.elements,p1=this.anchorPoint1,p2=this.anchorPoint2;return t[0]=p1.x*OIMO.WORLD_SCALE,t[1]=p1.y*OIMO.WORLD_SCALE,t[2]=p1.z*OIMO.WORLD_SCALE,t[3]=0,t[4]=p2.x*OIMO.WORLD_SCALE,t[5]=p2.y*OIMO.WORLD_SCALE,t[6]=p2.z*OIMO.WORLD_SCALE,t[7]=0,t},OIMO.JointConfig=function(){this.body1=null,this.body2=null,this.localAnchorPoint1=new OIMO.Vec3,this.localAnchorPoint2=new OIMO.Vec3,this.localAxis1=new OIMO.Vec3,this.localAxis2=new OIMO.Vec3,this.allowCollision=!1},OIMO.JointLink=function(t){this.prev=null,this.next=null,this.body=null,this.joint=t},OIMO.LimitMotor=function(t,e){this.axis=t,this.angle=0,this.lowerLimit=e?0:1,this.upperLimit=0,this.motorSpeed=0,this.maxMotorForce=0,this.frequency=0,this.dampingRatio=0},OIMO.LimitMotor.prototype={constructor:OIMO.LimitMotor,setLimit:function(t,e){this.lowerLimit=t,this.upperLimit=e},setMotor:function(t,e){this.motorSpeed=t,this.maxMotorForce=e},setSpring:function(t,e){this.frequency=t,this.dampingRatio=e}},OIMO.BallAndSocketJoint=function(t){OIMO.Joint.call(this,t),this.type=this.JOINT_BALL_AND_SOCKET,this.lc=new OIMO.LinearConstraint(this)},OIMO.BallAndSocketJoint.prototype=Object.create(OIMO.Joint.prototype),OIMO.BallAndSocketJoint.prototype.preSolve=function(t,e){this.updateAnchorPoints(),this.lc.preSolve(t,e)},OIMO.BallAndSocketJoint.prototype.solve=function(){this.lc.solve()},OIMO.BallAndSocketJoint.prototype.postSolve=function(){},OIMO.DistanceJoint=function(t,e,o){OIMO.Joint.call(this,t),this.type=this.JOINT_DISTANCE,this.normal=new OIMO.Vec3,this.limitMotor=new OIMO.LimitMotor(this.normal,!0),this.limitMotor.lowerLimit=e,this.limitMotor.upperLimit=o,this.t=new OIMO.TranslationalConstraint(this,this.limitMotor)},OIMO.DistanceJoint.prototype=Object.create(OIMO.Joint.prototype),OIMO.DistanceJoint.prototype.preSolve=function(t,e){this.updateAnchorPoints();var o=this.anchorPoint2.x-this.anchorPoint1.x,i=this.anchorPoint2.y-this.anchorPoint1.y,n=this.anchorPoint2.z-this.anchorPoint1.z,s=Math.sqrt(o*o+i*i+n*n);0<s&&(s=1/s),this.normal.init(o*s,i*s,n*s),this.t.preSolve(t,e)},OIMO.DistanceJoint.prototype.solve=function(){this.t.solve()},OIMO.DistanceJoint.prototype.postSolve=function(){},OIMO.HingeJoint=function(t,e,o){var i;OIMO.Joint.call(this,t),this.type=this.JOINT_HINGE,this.localAxis1=(new OIMO.Vec3).normalize(t.localAxis1),this.localAxis2=(new OIMO.Vec3).normalize(t.localAxis2),this.localAxis1X=this.localAxis1.x,this.localAxis1Y=this.localAxis1.y,this.localAxis1Z=this.localAxis1.z,this.localAngAxis1X=this.localAxis1Y*this.localAxis1X-this.localAxis1Z*this.localAxis1Z,this.localAngAxis1Y=-this.localAxis1Z*this.localAxis1Y-this.localAxis1X*this.localAxis1X,this.localAngAxis1Z=this.localAxis1X*this.localAxis1Z+this.localAxis1Y*this.localAxis1Y,i=1/Math.sqrt(this.localAngAxis1X*this.localAngAxis1X+this.localAngAxis1Y*this.localAngAxis1Y+this.localAngAxis1Z*this.localAngAxis1Z),this.localAngAxis1X*=i,this.localAngAxis1Y*=i,this.localAngAxis1Z*=i,this.localAxis2X=this.localAxis2.x,this.localAxis2Y=this.localAxis2.y,this.localAxis2Z=this.localAxis2.z;var n=(new OIMO.Mat33).setQuat((new OIMO.Quat).arc(this.localAxis1,this.localAxis2)).elements;this.localAngAxis2X=this.localAngAxis1X*n[0]+this.localAngAxis1Y*n[1]+this.localAngAxis1Z*n[2],this.localAngAxis2Y=this.localAngAxis1X*n[3]+this.localAngAxis1Y*n[4]+this.localAngAxis1Z*n[5],this.localAngAxis2Z=this.localAngAxis1X*n[6]+this.localAngAxis1Y*n[7]+this.localAngAxis1Z*n[8],this.nor=new OIMO.Vec3,this.tan=new OIMO.Vec3,this.bin=new OIMO.Vec3,this.limitMotor=new OIMO.LimitMotor(this.nor,!1),this.limitMotor.lowerLimit=e,this.limitMotor.upperLimit=o,this.lc=new OIMO.LinearConstraint(this),this.r3=new OIMO.Rotational3Constraint(this,this.limitMotor,new OIMO.LimitMotor(this.tan,!0),new OIMO.LimitMotor(this.bin,!0))},OIMO.HingeJoint.prototype=Object.create(OIMO.Joint.prototype),OIMO.HingeJoint.prototype.preSolve=function(t,e){var o,i,n,s;this.updateAnchorPoints(),o=this.body1.rotation.elements;var a=this.localAxis1X*o[0]+this.localAxis1Y*o[1]+this.localAxis1Z*o[2],r=this.localAxis1X*o[3]+this.localAxis1Y*o[4]+this.localAxis1Z*o[5],c=this.localAxis1X*o[6]+this.localAxis1Y*o[7]+this.localAxis1Z*o[8],d=this.localAngAxis1X*o[0]+this.localAngAxis1Y*o[1]+this.localAngAxis1Z*o[2],p=this.localAngAxis1X*o[3]+this.localAngAxis1Y*o[4]+this.localAngAxis1Z*o[5],l=this.localAngAxis1X*o[6]+this.localAngAxis1Y*o[7]+this.localAngAxis1Z*o[8];o=this.body2.rotation.elements;var u=this.localAxis2X*o[0]+this.localAxis2Y*o[1]+this.localAxis2Z*o[2],y=this.localAxis2X*o[3]+this.localAxis2Y*o[4]+this.localAxis2Z*o[5],g=this.localAxis2X*o[6]+this.localAxis2Y*o[7]+this.localAxis2Z*o[8],m=this.localAngAxis2X*o[0]+this.localAngAxis2Y*o[1]+this.localAngAxis2Z*o[2],f=this.localAngAxis2X*o[3]+this.localAngAxis2Y*o[4]+this.localAngAxis2Z*o[5],A=this.localAngAxis2X*o[6]+this.localAngAxis2Y*o[7]+this.localAngAxis2Z*o[8],b=a*this.body2.inverseMass+u*this.body1.inverseMass,v=r*this.body2.inverseMass+y*this.body1.inverseMass,x=c*this.body2.inverseMass+g*this.body1.inverseMass;0<(i=Math.sqrt(b*b+v*v+x*x))&&(i=1/i);var C=(v*=i)*(b*=i)-(x*=i)*x,S=-x*v-b*b,T=b*x+v*v,B=v*(T*=i=1/Math.sqrt(C*C+S*S+T*T))-x*(S*=i),O=x*(C*=i)-b*T,P=b*S-v*C;this.nor.init(b,v,x),this.tan.init(C,S,T),this.bin.init(B,O,P),this.limitMotor.angle=b*(p*A-l*f)+v*(l*m-d*A)+x*(d*f-p*m)<0?-this.acosClamp(d*m+p*f+l*A):this.acosClamp(d*m+p*f+l*A),i=r*g-c*y,n=c*u-a*g,s=a*y-r*u,this.r3.limitMotor2.angle=C*i+S*n+T*s,this.r3.limitMotor3.angle=B*i+O*n+P*s,this.r3.preSolve(t,e),this.lc.preSolve(t,e)},OIMO.HingeJoint.prototype.solve=function(){this.r3.solve(),this.lc.solve()},OIMO.HingeJoint.prototype.postSolve=function(){},OIMO.HingeJoint.prototype.acosClamp=function(t){return 1<t?0:t<-1?Math.PI:Math.acos(t)},OIMO.PrismaticJoint=function(t,e,o){OIMO.Joint.call(this,t),this.type=this.JOINT_PRISMATIC,this.localAxis1=(new OIMO.Vec3).normalize(t.localAxis1),this.localAxis2=(new OIMO.Vec3).normalize(t.localAxis2),this.localAxis1X=this.localAxis1.x,this.localAxis1Y=this.localAxis1.y,this.localAxis1Z=this.localAxis1.z,this.localAxis2X=this.localAxis2.x,this.localAxis2Y=this.localAxis2.y,this.localAxis2Z=this.localAxis2.z,this.nor=new OIMO.Vec3,this.tan=new OIMO.Vec3,this.bin=new OIMO.Vec3,this.ac=new OIMO.AngularConstraint(this,(new OIMO.Quat).arc(this.localAxis1,this.localAxis2)),this.limitMotor=new OIMO.LimitMotor(this.nor,!0),this.limitMotor.lowerLimit=e,this.limitMotor.upperLimit=o,this.t3=new OIMO.Translational3Constraint(this,this.limitMotor,new OIMO.LimitMotor(this.tan,!0),new OIMO.LimitMotor(this.bin,!0))},OIMO.PrismaticJoint.prototype=Object.create(OIMO.Joint.prototype),OIMO.PrismaticJoint.prototype.preSolve=function(t,e){var o,i;this.updateAnchorPoints(),o=this.body1.rotation.elements;var n=this.localAxis1X*o[0]+this.localAxis1Y*o[1]+this.localAxis1Z*o[2],s=this.localAxis1X*o[3]+this.localAxis1Y*o[4]+this.localAxis1Z*o[5],a=this.localAxis1X*o[6]+this.localAxis1Y*o[7]+this.localAxis1Z*o[8];o=this.body2.rotation.elements;var r=this.localAxis2X*o[0]+this.localAxis2Y*o[1]+this.localAxis2Z*o[2],c=this.localAxis2X*o[3]+this.localAxis2Y*o[4]+this.localAxis2Z*o[5],d=this.localAxis2X*o[6]+this.localAxis2Y*o[7]+this.localAxis2Z*o[8],p=n*this.body2.inverseMass+r*this.body1.inverseMass,l=s*this.body2.inverseMass+c*this.body1.inverseMass,u=a*this.body2.inverseMass+d*this.body1.inverseMass;0<(i=Math.sqrt(p*p+l*l+u*u))&&(i=1/i);var y=(l*=i)*(p*=i)-(u*=i)*u,g=-u*l-p*p,m=p*u+l*l,f=l*(m*=i=1/Math.sqrt(y*y+g*g+m*m))-u*(g*=i),A=u*(y*=i)-p*m,b=p*g-l*y;this.nor.init(p,l,u),this.tan.init(y,g,m),this.bin.init(f,A,b),this.ac.preSolve(t,e),this.t3.preSolve(t,e)},OIMO.PrismaticJoint.prototype.solve=function(){this.ac.solve(),this.t3.solve()},OIMO.PrismaticJoint.prototype.postSolve=function(){},OIMO.SliderJoint=function(t,e,o){var i;OIMO.Joint.call(this,t),this.type=this.JOINT_SLIDER,this.localAxis1=(new OIMO.Vec3).normalize(t.localAxis1),this.localAxis2=(new OIMO.Vec3).normalize(t.localAxis2),this.localAxis1X=this.localAxis1.x,this.localAxis1Y=this.localAxis1.y,this.localAxis1Z=this.localAxis1.z,this.localAngAxis1X=this.localAxis1Y*this.localAxis1X-this.localAxis1Z*this.localAxis1Z,this.localAngAxis1Y=-this.localAxis1Z*this.localAxis1Y-this.localAxis1X*this.localAxis1X,this.localAngAxis1Z=this.localAxis1X*this.localAxis1Z+this.localAxis1Y*this.localAxis1Y,i=1/Math.sqrt(this.localAngAxis1X*this.localAngAxis1X+this.localAngAxis1Y*this.localAngAxis1Y+this.localAngAxis1Z*this.localAngAxis1Z),this.localAngAxis1X*=i,this.localAngAxis1Y*=i,this.localAngAxis1Z*=i,this.localAxis2X=this.localAxis2.x,this.localAxis2Y=this.localAxis2.y,this.localAxis2Z=this.localAxis2.z;var n=(new OIMO.Mat33).setQuat((new OIMO.Quat).arc(this.localAxis1,this.localAxis2)).elements;this.localAngAxis2X=this.localAngAxis1X*n[0]+this.localAngAxis1Y*n[1]+this.localAngAxis1Z*n[2],this.localAngAxis2Y=this.localAngAxis1X*n[3]+this.localAngAxis1Y*n[4]+this.localAngAxis1Z*n[5],this.localAngAxis2Z=this.localAngAxis1X*n[6]+this.localAngAxis1Y*n[7]+this.localAngAxis1Z*n[8],this.nor=new OIMO.Vec3,this.tan=new OIMO.Vec3,this.bin=new OIMO.Vec3,this.rotationalLimitMotor=new OIMO.LimitMotor(this.nor,!1),this.r3=new OIMO.Rotational3Constraint(this,this.rotationalLimitMotor,new OIMO.LimitMotor(this.tan,!0),new OIMO.LimitMotor(this.bin,!0)),this.translationalLimitMotor=new OIMO.LimitMotor(this.nor,!0),this.translationalLimitMotor.lowerLimit=e,this.translationalLimitMotor.upperLimit=o,this.t3=new OIMO.Translational3Constraint(this,this.translationalLimitMotor,new OIMO.LimitMotor(this.tan,!0),new OIMO.LimitMotor(this.bin,!0))},OIMO.SliderJoint.prototype=Object.create(OIMO.Joint.prototype),OIMO.SliderJoint.prototype.preSolve=function(t,e){var o,i,n,s;this.updateAnchorPoints(),o=this.body1.rotation.elements;var a=this.localAxis1X*o[0]+this.localAxis1Y*o[1]+this.localAxis1Z*o[2],r=this.localAxis1X*o[3]+this.localAxis1Y*o[4]+this.localAxis1Z*o[5],c=this.localAxis1X*o[6]+this.localAxis1Y*o[7]+this.localAxis1Z*o[8],d=this.localAngAxis1X*o[0]+this.localAngAxis1Y*o[1]+this.localAngAxis1Z*o[2],p=this.localAngAxis1X*o[3]+this.localAngAxis1Y*o[4]+this.localAngAxis1Z*o[5],l=this.localAngAxis1X*o[6]+this.localAngAxis1Y*o[7]+this.localAngAxis1Z*o[8];o=this.body2.rotation.elements;var u=this.localAxis2X*o[0]+this.localAxis2Y*o[1]+this.localAxis2Z*o[2],y=this.localAxis2X*o[3]+this.localAxis2Y*o[4]+this.localAxis2Z*o[5],g=this.localAxis2X*o[6]+this.localAxis2Y*o[7]+this.localAxis2Z*o[8],m=this.localAngAxis2X*o[0]+this.localAngAxis2Y*o[1]+this.localAngAxis2Z*o[2],f=this.localAngAxis2X*o[3]+this.localAngAxis2Y*o[4]+this.localAngAxis2Z*o[5],A=this.localAngAxis2X*o[6]+this.localAngAxis2Y*o[7]+this.localAngAxis2Z*o[8],b=a*this.body2.inverseMass+u*this.body1.inverseMass,v=r*this.body2.inverseMass+y*this.body1.inverseMass,x=c*this.body2.inverseMass+g*this.body1.inverseMass;0<(i=Math.sqrt(b*b+v*v+x*x))&&(i=1/i);var C=(v*=i)*(b*=i)-(x*=i)*x,S=-x*v-b*b,T=b*x+v*v,B=v*(T*=i=1/Math.sqrt(C*C+S*S+T*T))-x*(S*=i),O=x*(C*=i)-b*T,P=b*S-v*C;this.nor.init(b,v,x),this.tan.init(C,S,T),this.bin.init(B,O,P),this.rotationalLimitMotor.angle=b*(p*A-l*f)+v*(l*m-d*A)+x*(d*f-p*m)<0?-this.acosClamp(d*m+p*f+l*A):this.acosClamp(d*m+p*f+l*A),i=r*g-c*y,n=c*u-a*g,s=a*y-r*u,this.r3.limitMotor2.angle=C*i+S*n+T*s,this.r3.limitMotor3.angle=B*i+O*n+P*s,this.r3.preSolve(t,e),this.t3.preSolve(t,e)},OIMO.SliderJoint.prototype.solve=function(){this.r3.solve(),this.t3.solve()},OIMO.SliderJoint.prototype.postSolve=function(){},OIMO.SliderJoint.prototype.acosClamp=function(t){return 1<t?0:t<-1?Math.PI:Math.acos(t)},OIMO.WheelJoint=function(t){var e;OIMO.Joint.call(this,t),this.type=this.JOINT_z1054,this.localAxis1=(new OIMO.Vec3).normalize(t.localAxis1),this.localAxis2=(new OIMO.Vec3).normalize(t.localAxis2),this.localAxis1X=this.localAxis1.x,this.localAxis1Y=this.localAxis1.y,this.localAxis1Z=this.localAxis1.z,this.localAxis2X=this.localAxis2.x,this.localAxis2Y=this.localAxis2.y,this.localAxis2Z=this.localAxis2.z;var o=this.localAxis1X*this.localAxis2X+this.localAxis1Y*this.localAxis2Y+this.localAxis1Z*this.localAxis2Z;if(-1<o&&o<1)this.localAngAxis1X=this.localAxis2X-o*this.localAxis1X,this.localAngAxis1Y=this.localAxis2Y-o*this.localAxis1Y,this.localAngAxis1Z=this.localAxis2Z-o*this.localAxis1Z,this.localAngAxis2X=this.localAxis1X-o*this.localAxis2X,this.localAngAxis2Y=this.localAxis1Y-o*this.localAxis2Y,this.localAngAxis2Z=this.localAxis1Z-o*this.localAxis2Z,e=1/Math.sqrt(this.localAngAxis1X*this.localAngAxis1X+this.localAngAxis1Y*this.localAngAxis1Y+this.localAngAxis1Z*this.localAngAxis1Z),this.localAngAxis1X*=e,this.localAngAxis1Y*=e,this.localAngAxis1Z*=e,e=1/Math.sqrt(this.localAngAxis2X*this.localAngAxis2X+this.localAngAxis2Y*this.localAngAxis2Y+this.localAngAxis2Z*this.localAngAxis2Z),this.localAngAxis2X*=e,this.localAngAxis2Y*=e,this.localAngAxis2Z*=e;else{this.localAngAxis1X=this.localAxis1Y*this.localAxis1X-this.localAxis1Z*this.localAxis1Z,this.localAngAxis1Y=-this.localAxis1Z*this.localAxis1Y-this.localAxis1X*this.localAxis1X,this.localAngAxis1Z=this.localAxis1X*this.localAxis1Z+this.localAxis1Y*this.localAxis1Y,e=1/Math.sqrt(this.localAngAxis1X*this.localAngAxis1X+this.localAngAxis1Y*this.localAngAxis1Y+this.localAngAxis1Z*this.localAngAxis1Z),this.localAngAxis1X*=e,this.localAngAxis1Y*=e,this.localAngAxis1Z*=e;var i=(new OIMO.Mat33).setQuat((new OIMO.Quat).arc(this.localAxis1,this.localAxis2)).elements;this.localAngAxis2X=this.localAngAxis1X*i[0]+this.localAngAxis1Y*i[1]+this.localAngAxis1Z*i[2],this.localAngAxis2Y=this.localAngAxis1X*i[3]+this.localAngAxis1Y*i[4]+this.localAngAxis1Z*i[5],this.localAngAxis2Z=this.localAngAxis1X*i[6]+this.localAngAxis1Y*i[7]+this.localAngAxis1Z*i[8]}this.nor=new OIMO.Vec3,this.tan=new OIMO.Vec3,this.bin=new OIMO.Vec3,this.translationalLimitMotor=new OIMO.LimitMotor(this.tan,!0),this.translationalLimitMotor.frequency=8,this.translationalLimitMotor.dampingRatio=1,this.rotationalLimitMotor1=new OIMO.LimitMotor(this.tan,!1),this.rotationalLimitMotor2=new OIMO.LimitMotor(this.bin,!1),this.t3=new OIMO.Translational3Constraint(this,new OIMO.LimitMotor(this.nor,!0),this.translationalLimitMotor,new OIMO.LimitMotor(this.bin,!0)),this.t3.weight=1,this.r3=new OIMO.Rotational3Constraint(this,new OIMO.LimitMotor(this.nor,!0),this.rotationalLimitMotor1,this.rotationalLimitMotor2)},OIMO.WheelJoint.prototype=Object.create(OIMO.Joint.prototype),OIMO.WheelJoint.prototype.preSolve=function(t,e){var o,i;this.updateAnchorPoints(),o=this.body1.rotation.elements;var n=this.localAxis1X*o[0]+this.localAxis1Y*o[1]+this.localAxis1Z*o[2],s=this.localAxis1X*o[3]+this.localAxis1Y*o[4]+this.localAxis1Z*o[5],a=this.localAxis1X*o[6]+this.localAxis1Y*o[7]+this.localAxis1Z*o[8],r=this.localAngAxis1X*o[0]+this.localAngAxis1Y*o[1]+this.localAngAxis1Z*o[2],c=this.localAngAxis1X*o[3]+this.localAngAxis1Y*o[4]+this.localAngAxis1Z*o[5],d=this.localAngAxis1X*o[6]+this.localAngAxis1Y*o[7]+this.localAngAxis1Z*o[8];o=this.body2.rotation.elements;var p=this.localAxis2X*o[0]+this.localAxis2Y*o[1]+this.localAxis2Z*o[2],l=this.localAxis2X*o[3]+this.localAxis2Y*o[4]+this.localAxis2Z*o[5],u=this.localAxis2X*o[6]+this.localAxis2Y*o[7]+this.localAxis2Z*o[8],y=this.localAngAxis2X*o[0]+this.localAngAxis2Y*o[1]+this.localAngAxis2Z*o[2],g=this.localAngAxis2X*o[3]+this.localAngAxis2Y*o[4]+this.localAngAxis2Z*o[5],m=this.localAngAxis2X*o[6]+this.localAngAxis2Y*o[7]+this.localAngAxis2Z*o[8];this.r3.limitMotor1.angle=n*p+s*l+a*u,this.rotationalLimitMotor1.angle=n*(c*u-d*l)+s*(d*p-r*u)+a*(r*l-c*p)<0?-this.acosClamp(r*p+c*l+d*u):this.acosClamp(r*p+c*l+d*u),this.rotationalLimitMotor2.angle=p*(g*a-m*s)+l*(m*n-y*a)+u*(y*s-g*n)<0?this.acosClamp(y*n+g*s+m*a):-this.acosClamp(y*n+g*s+m*a);var f=l*a-u*s,A=u*n-p*a,b=p*s-l*n;0<(i=Math.sqrt(f*f+A*A+b*b))&&(i=1/i);var v=(A*=i)*u-(b*=i)*l,x=b*p-(f*=i)*u,C=f*l-A*p;0<(i=Math.sqrt(v*v+x*x+C*C))&&(i=1/i),v*=i,x*=i,C*=i;var S=s*b-a*A,T=a*f-n*b,B=n*A-s*f;0<(i=Math.sqrt(S*S+T*T+B*B))&&(i=1/i),S*=i,T*=i,B*=i,this.nor.init(f,A,b),this.tan.init(v,x,C),this.bin.init(S,T,B),this.r3.preSolve(t,e),this.t3.preSolve(t,e)},OIMO.WheelJoint.prototype.solve=function(){this.r3.solve(),this.t3.solve()},OIMO.WheelJoint.prototype.postSolve=function(){},OIMO.WheelJoint.prototype.acosClamp=function(t){return 1<t?0:t<-1?Math.PI:Math.acos(t)},OIMO.AngularConstraint=function(t,e){this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.d00=NaN,this.d01=NaN,this.d02=NaN,this.d10=NaN,this.d11=NaN,this.d12=NaN,this.d20=NaN,this.d21=NaN,this.d22=NaN,this.ax=NaN,this.ay=NaN,this.az=NaN,this.velx=NaN,this.vely=NaN,this.velz=NaN,this.joint=t,this.targetOrientation=(new OIMO.Quat).invert(e),this.relativeOrientation=new OIMO.Quat,this.b1=t.body1,this.b2=t.body2,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.impx=0,this.impy=0,this.impz=0},OIMO.AngularConstraint.prototype={constructor:OIMO.AngularConstraint,preSolve:function(t,e){var o=this.i1.elements,i=this.i2.elements;this.i1e00=o[0],this.i1e01=o[1],this.i1e02=o[2],this.i1e10=o[3],this.i1e11=o[4],this.i1e12=o[5],this.i1e20=o[6],this.i1e21=o[7],this.i1e22=o[8],this.i2e00=i[0],this.i2e01=i[1],this.i2e02=i[2],this.i2e10=i[3],this.i2e11=i[4],this.i2e12=i[5],this.i2e20=i[6],this.i2e21=i[7],this.i2e22=i[8];var n=this.i1e00+this.i2e00,s=this.i1e01+this.i2e01,a=this.i1e02+this.i2e02,r=this.i1e10+this.i2e10,c=this.i1e11+this.i2e11,d=this.i1e12+this.i2e12,p=this.i1e20+this.i2e20,l=this.i1e21+this.i2e21,u=this.i1e22+this.i2e22,y=1/(n*(c*u-l*d)+r*(l*a-s*u)+p*(s*d-c*a));this.d00=(c*u-d*l)*y,this.d01=(a*l-s*u)*y,this.d02=(s*d-a*c)*y,this.d10=(d*p-r*u)*y,this.d11=(n*u-a*p)*y,this.d12=(a*r-n*d)*y,this.d20=(r*l-c*p)*y,this.d21=(s*p-n*l)*y,this.d22=(n*c-s*r)*y,this.relativeOrientation.invert(this.b1.orientation),this.relativeOrientation.mul(this.targetOrientation,this.relativeOrientation),this.relativeOrientation.mul(this.b2.orientation,this.relativeOrientation),y=2*this.relativeOrientation.s,this.velx=this.relativeOrientation.x*y,this.vely=this.relativeOrientation.y*y,this.velz=this.relativeOrientation.z*y;var g=Math.sqrt(this.velx*this.velx+this.vely*this.vely+this.velz*this.velz);.02<g?(g=(.02-g)/g*e*.05,this.velx*=g,this.vely*=g,this.velz*=g):(this.velx=0,this.vely=0,this.velz=0),this.a1.x+=this.impx*this.i1e00+this.impy*this.i1e01+this.impz*this.i1e02,this.a1.y+=this.impx*this.i1e10+this.impy*this.i1e11+this.impz*this.i1e12,this.a1.z+=this.impx*this.i1e20+this.impy*this.i1e21+this.impz*this.i1e22,this.a2.x-=this.impx*this.i2e00+this.impy*this.i2e01+this.impz*this.i2e02,this.a2.y-=this.impx*this.i2e10+this.impy*this.i2e11+this.impz*this.i2e12,this.a2.z-=this.impx*this.i2e20+this.impy*this.i2e21+this.impz*this.i2e22},solve:function(){var t=this.a2.x-this.a1.x-this.velx,e=this.a2.y-this.a1.y-this.vely,o=this.a2.z-this.a1.z-this.velz,i=t*this.d00+e*this.d01+o*this.d02,n=t*this.d10+e*this.d11+o*this.d12,s=t*this.d20+e*this.d21+o*this.d22;this.impx+=i,this.impy+=n,this.impz+=s,this.a1.x+=i*this.i1e00+n*this.i1e01+s*this.i1e02,this.a1.y+=i*this.i1e10+n*this.i1e11+s*this.i1e12,this.a1.z+=i*this.i1e20+n*this.i1e21+s*this.i1e22,this.a2.x-=i*this.i2e00+n*this.i2e01+s*this.i2e02,this.a2.y-=i*this.i2e10+n*this.i2e11+s*this.i2e12,this.a2.z-=i*this.i2e20+n*this.i2e21+s*this.i2e22}},OIMO.LinearConstraint=function(t){this.m1=NaN,this.m2=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.d00=NaN,this.d01=NaN,this.d02=NaN,this.d10=NaN,this.d11=NaN,this.d12=NaN,this.d20=NaN,this.d21=NaN,this.d22=NaN,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.ax1x=NaN,this.ax1y=NaN,this.ax1z=NaN,this.ay1x=NaN,this.ay1y=NaN,this.ay1z=NaN,this.az1x=NaN,this.az1y=NaN,this.az1z=NaN,this.ax2x=NaN,this.ax2y=NaN,this.ax2z=NaN,this.ay2x=NaN,this.ay2y=NaN,this.ay2z=NaN,this.az2x=NaN,this.az2y=NaN,this.az2z=NaN,this.vel=NaN,this.velx=NaN,this.vely=NaN,this.velz=NaN,this.joint=t,this.r1=t.relativeAnchorPoint1,this.r2=t.relativeAnchorPoint2,this.p1=t.anchorPoint1,this.p2=t.anchorPoint2,this.b1=t.body1,this.b2=t.body2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.impx=0,this.impy=0,this.impz=0},OIMO.LinearConstraint.prototype={constructor:OIMO.LinearConstraint,preSolve:function(t,e){this.r1x=this.r1.x,this.r1y=this.r1.y,this.r1z=this.r1.z,this.r2x=this.r2.x,this.r2y=this.r2.y,this.r2z=this.r2.z,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass;var o=this.i1.elements,i=this.i2.elements;this.i1e00=o[0],this.i1e01=o[1],this.i1e02=o[2],this.i1e10=o[3],this.i1e11=o[4],this.i1e12=o[5],this.i1e20=o[6],this.i1e21=o[7],this.i1e22=o[8],this.i2e00=i[0],this.i2e01=i[1],this.i2e02=i[2],this.i2e10=i[3],this.i2e11=i[4],this.i2e12=i[5],this.i2e20=i[6],this.i2e21=i[7],this.i2e22=i[8],this.ax1x=this.r1z*this.i1e01+-this.r1y*this.i1e02,this.ax1y=this.r1z*this.i1e11+-this.r1y*this.i1e12,this.ax1z=this.r1z*this.i1e21+-this.r1y*this.i1e22,this.ay1x=-this.r1z*this.i1e00+this.r1x*this.i1e02,this.ay1y=-this.r1z*this.i1e10+this.r1x*this.i1e12,this.ay1z=-this.r1z*this.i1e20+this.r1x*this.i1e22,this.az1x=this.r1y*this.i1e00+-this.r1x*this.i1e01,this.az1y=this.r1y*this.i1e10+-this.r1x*this.i1e11,this.az1z=this.r1y*this.i1e20+-this.r1x*this.i1e21,this.ax2x=this.r2z*this.i2e01+-this.r2y*this.i2e02,this.ax2y=this.r2z*this.i2e11+-this.r2y*this.i2e12,this.ax2z=this.r2z*this.i2e21+-this.r2y*this.i2e22,this.ay2x=-this.r2z*this.i2e00+this.r2x*this.i2e02,this.ay2y=-this.r2z*this.i2e10+this.r2x*this.i2e12,this.ay2z=-this.r2z*this.i2e20+this.r2x*this.i2e22,this.az2x=this.r2y*this.i2e00+-this.r2x*this.i2e01,this.az2y=this.r2y*this.i2e10+-this.r2x*this.i2e11,this.az2z=this.r2y*this.i2e20+-this.r2x*this.i2e21;var n=this.m1+this.m2,s=0,a=0,r=0,c=n,d=0,p=0,l=0,u=n;n+=this.i1e11*this.r1z*this.r1z-(this.i1e21+this.i1e12)*this.r1y*this.r1z+this.i1e22*this.r1y*this.r1y,s+=(this.i1e20*this.r1y+this.i1e12*this.r1x)*this.r1z-this.i1e10*this.r1z*this.r1z-this.i1e22*this.r1x*this.r1y,a+=(this.i1e10*this.r1y-this.i1e11*this.r1x)*this.r1z-this.i1e20*this.r1y*this.r1y+this.i1e21*this.r1x*this.r1y,r+=(this.i1e02*this.r1y+this.i1e21*this.r1x)*this.r1z-this.i1e01*this.r1z*this.r1z-this.i1e22*this.r1x*this.r1y,c+=this.i1e00*this.r1z*this.r1z-(this.i1e20+this.i1e02)*this.r1x*this.r1z+this.i1e22*this.r1x*this.r1x,d+=(this.i1e01*this.r1x-this.i1e00*this.r1y)*this.r1z-this.i1e21*this.r1x*this.r1x+this.i1e20*this.r1x*this.r1y,p+=(this.i1e01*this.r1y-this.i1e11*this.r1x)*this.r1z-this.i1e02*this.r1y*this.r1y+this.i1e12*this.r1x*this.r1y,l+=(this.i1e10*this.r1x-this.i1e00*this.r1y)*this.r1z-this.i1e12*this.r1x*this.r1x+this.i1e02*this.r1x*this.r1y,u+=this.i1e00*this.r1y*this.r1y-(this.i1e10+this.i1e01)*this.r1x*this.r1y+this.i1e11*this.r1x*this.r1x,n+=this.i2e11*this.r2z*this.r2z-(this.i2e21+this.i2e12)*this.r2y*this.r2z+this.i2e22*this.r2y*this.r2y,s+=(this.i2e20*this.r2y+this.i2e12*this.r2x)*this.r2z-this.i2e10*this.r2z*this.r2z-this.i2e22*this.r2x*this.r2y,a+=(this.i2e10*this.r2y-this.i2e11*this.r2x)*this.r2z-this.i2e20*this.r2y*this.r2y+this.i2e21*this.r2x*this.r2y,r+=(this.i2e02*this.r2y+this.i2e21*this.r2x)*this.r2z-this.i2e01*this.r2z*this.r2z-this.i2e22*this.r2x*this.r2y,c+=this.i2e00*this.r2z*this.r2z-(this.i2e20+this.i2e02)*this.r2x*this.r2z+this.i2e22*this.r2x*this.r2x,d+=(this.i2e01*this.r2x-this.i2e00*this.r2y)*this.r2z-this.i2e21*this.r2x*this.r2x+this.i2e20*this.r2x*this.r2y,p+=(this.i2e01*this.r2y-this.i2e11*this.r2x)*this.r2z-this.i2e02*this.r2y*this.r2y+this.i2e12*this.r2x*this.r2y,l+=(this.i2e10*this.r2x-this.i2e00*this.r2y)*this.r2z-this.i2e12*this.r2x*this.r2x+this.i2e02*this.r2x*this.r2y;var y=1/(n*(c*(u+=this.i2e00*this.r2y*this.r2y-(this.i2e10+this.i2e01)*this.r2x*this.r2y+this.i2e11*this.r2x*this.r2x)-l*d)+r*(l*a-s*u)+p*(s*d-c*a));this.d00=(c*u-d*l)*y,this.d01=(a*l-s*u)*y,this.d02=(s*d-a*c)*y,this.d10=(d*p-r*u)*y,this.d11=(n*u-a*p)*y,this.d12=(a*r-n*d)*y,this.d20=(r*l-c*p)*y,this.d21=(s*p-n*l)*y,this.d22=(n*c-s*r)*y,this.velx=this.p2.x-this.p1.x,this.vely=this.p2.y-this.p1.y,this.velz=this.p2.z-this.p1.z;var g=Math.sqrt(this.velx*this.velx+this.vely*this.vely+this.velz*this.velz);.005<g?(g=(.005-g)/g*e*.05,this.velx*=g,this.vely*=g,this.velz*=g):(this.velx=0,this.vely=0,this.velz=0),this.impx*=.95,this.impy*=.95,this.impz*=.95,this.l1.x+=this.impx*this.m1,this.l1.y+=this.impy*this.m1,this.l1.z+=this.impz*this.m1,this.a1.x+=this.impx*this.ax1x+this.impy*this.ay1x+this.impz*this.az1x,this.a1.y+=this.impx*this.ax1y+this.impy*this.ay1y+this.impz*this.az1y,this.a1.z+=this.impx*this.ax1z+this.impy*this.ay1z+this.impz*this.az1z,this.l2.x-=this.impx*this.m2,this.l2.y-=this.impy*this.m2,this.l2.z-=this.impz*this.m2,this.a2.x-=this.impx*this.ax2x+this.impy*this.ay2x+this.impz*this.az2x,this.a2.y-=this.impx*this.ax2y+this.impy*this.ay2y+this.impz*this.az2y,this.a2.z-=this.impx*this.ax2z+this.impy*this.ay2z+this.impz*this.az2z},solve:function(){var t=this.l2.x-this.l1.x+this.a2.y*this.r2z-this.a2.z*this.r2y-this.a1.y*this.r1z+this.a1.z*this.r1y-this.velx,e=this.l2.y-this.l1.y+this.a2.z*this.r2x-this.a2.x*this.r2z-this.a1.z*this.r1x+this.a1.x*this.r1z-this.vely,o=this.l2.z-this.l1.z+this.a2.x*this.r2y-this.a2.y*this.r2x-this.a1.x*this.r1y+this.a1.y*this.r1x-this.velz,i=t*this.d00+e*this.d01+o*this.d02,n=t*this.d10+e*this.d11+o*this.d12,s=t*this.d20+e*this.d21+o*this.d22;this.impx+=i,this.impy+=n,this.impz+=s,this.l1.x+=i*this.m1,this.l1.y+=n*this.m1,this.l1.z+=s*this.m1,this.a1.x+=i*this.ax1x+n*this.ay1x+s*this.az1x,this.a1.y+=i*this.ax1y+n*this.ay1y+s*this.az1y,this.a1.z+=i*this.ax1z+n*this.ay1z+s*this.az1z,this.l2.x-=i*this.m2,this.l2.y-=n*this.m2,this.l2.z-=s*this.m2,this.a2.x-=i*this.ax2x+n*this.ay2x+s*this.az2x,this.a2.y-=i*this.ax2y+n*this.ay2y+s*this.az2y,this.a2.z-=i*this.ax2z+n*this.ay2z+s*this.az2z}},OIMO.Rotational3Constraint=function(t,e,o,i){this.cfm1=NaN,this.cfm2=NaN,this.cfm3=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.ax1=NaN,this.ay1=NaN,this.az1=NaN,this.ax2=NaN,this.ay2=NaN,this.az2=NaN,this.ax3=NaN,this.ay3=NaN,this.az3=NaN,this.a1x1=NaN,this.a1y1=NaN,this.a1z1=NaN,this.a2x1=NaN,this.a2y1=NaN,this.a2z1=NaN,this.a1x2=NaN,this.a1y2=NaN,this.a1z2=NaN,this.a2x2=NaN,this.a2y2=NaN,this.a2z2=NaN,this.a1x3=NaN,this.a1y3=NaN,this.a1z3=NaN,this.a2x3=NaN,this.a2y3=NaN,this.a2z3=NaN,this.lowerLimit1=NaN,this.upperLimit1=NaN,this.limitVelocity1=NaN,this.limitState1=0,this.enableMotor1=!1,this.motorSpeed1=NaN,this.maxMotorForce1=NaN,this.maxMotorImpulse1=NaN,this.lowerLimit2=NaN,this.upperLimit2=NaN,this.limitVelocity2=NaN,this.limitState2=0,this.enableMotor2=!1,this.motorSpeed2=NaN,this.maxMotorForce2=NaN,this.maxMotorImpulse2=NaN,this.lowerLimit3=NaN,this.upperLimit3=NaN,this.limitVelocity3=NaN,this.limitState3=0,this.enableMotor3=!1,this.motorSpeed3=NaN,this.maxMotorForce3=NaN,this.maxMotorImpulse3=NaN,this.k00=NaN,this.k01=NaN,this.k02=NaN,this.k10=NaN,this.k11=NaN,this.k12=NaN,this.k20=NaN,this.k21=NaN,this.k22=NaN,this.kv00=NaN,this.kv11=NaN,this.kv22=NaN,this.dv00=NaN,this.dv11=NaN,this.dv22=NaN,this.d00=NaN,this.d01=NaN,this.d02=NaN,this.d10=NaN,this.d11=NaN,this.d12=NaN,this.d20=NaN,this.d21=NaN,this.d22=NaN,this.limitMotor1=e,this.limitMotor2=o,this.limitMotor3=i,this.b1=t.body1,this.b2=t.body2,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse1=0,this.motorImpulse1=0,this.limitImpulse2=0,this.motorImpulse2=0,this.limitImpulse3=0,this.motorImpulse3=0},OIMO.Rotational3Constraint.prototype={constructor:OIMO.Rotational3Constraint,preSolve:function(t,e){this.ax1=this.limitMotor1.axis.x,this.ay1=this.limitMotor1.axis.y,this.az1=this.limitMotor1.axis.z,this.ax2=this.limitMotor2.axis.x,this.ay2=this.limitMotor2.axis.y,this.az2=this.limitMotor2.axis.z,this.ax3=this.limitMotor3.axis.x,this.ay3=this.limitMotor3.axis.y,this.az3=this.limitMotor3.axis.z,this.lowerLimit1=this.limitMotor1.lowerLimit,this.upperLimit1=this.limitMotor1.upperLimit,this.motorSpeed1=this.limitMotor1.motorSpeed,this.maxMotorForce1=this.limitMotor1.maxMotorForce,this.enableMotor1=0<this.maxMotorForce1,this.lowerLimit2=this.limitMotor2.lowerLimit,this.upperLimit2=this.limitMotor2.upperLimit,this.motorSpeed2=this.limitMotor2.motorSpeed,this.maxMotorForce2=this.limitMotor2.maxMotorForce,this.enableMotor2=0<this.maxMotorForce2,this.lowerLimit3=this.limitMotor3.lowerLimit,this.upperLimit3=this.limitMotor3.upperLimit,this.motorSpeed3=this.limitMotor3.motorSpeed,this.maxMotorForce3=this.limitMotor3.maxMotorForce,this.enableMotor3=0<this.maxMotorForce3;var o=this.i1.elements,i=this.i2.elements;this.i1e00=o[0],this.i1e01=o[1],this.i1e02=o[2],this.i1e10=o[3],this.i1e11=o[4],this.i1e12=o[5],this.i1e20=o[6],this.i1e21=o[7],this.i1e22=o[8],this.i2e00=i[0],this.i2e01=i[1],this.i2e02=i[2],this.i2e10=i[3],this.i2e11=i[4],this.i2e12=i[5],this.i2e20=i[6],this.i2e21=i[7],this.i2e22=i[8];var n=this.limitMotor1.frequency,s=this.limitMotor2.frequency,a=this.limitMotor3.frequency,r=0<n,c=0<s,d=0<a,p=this.lowerLimit1<=this.upperLimit1,l=this.lowerLimit2<=this.upperLimit2,u=this.lowerLimit3<=this.upperLimit3,y=this.limitMotor1.angle;p?(this.lowerLimit1==this.upperLimit1?(0!=this.limitState1&&(this.limitState1=0,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-y):y<this.lowerLimit1?(-1!=this.limitState1&&(this.limitState1=-1,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-y):y>this.upperLimit1?(1!=this.limitState1&&(this.limitState1=1,this.limitImpulse1=0),this.limitVelocity1=this.upperLimit1-y):(this.limitState1=2,this.limitImpulse1=0,this.limitVelocity1=0),r||(.02<this.limitVelocity1?this.limitVelocity1-=.02:this.limitVelocity1<-.02?this.limitVelocity1+=.02:this.limitVelocity1=0)):(this.limitState1=2,this.limitImpulse1=0);var g=this.limitMotor2.angle;l?(this.lowerLimit2==this.upperLimit2?(0!=this.limitState2&&(this.limitState2=0,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-g):g<this.lowerLimit2?(-1!=this.limitState2&&(this.limitState2=-1,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-g):g>this.upperLimit2?(1!=this.limitState2&&(this.limitState2=1,this.limitImpulse2=0),this.limitVelocity2=this.upperLimit2-g):(this.limitState2=2,this.limitImpulse2=0,this.limitVelocity2=0),c||(.02<this.limitVelocity2?this.limitVelocity2-=.02:this.limitVelocity2<-.02?this.limitVelocity2+=.02:this.limitVelocity2=0)):(this.limitState2=2,this.limitImpulse2=0);var m=this.limitMotor3.angle;if(u?(this.lowerLimit3==this.upperLimit3?(0!=this.limitState3&&(this.limitState3=0,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-m):m<this.lowerLimit3?(-1!=this.limitState3&&(this.limitState3=-1,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-m):m>this.upperLimit3?(1!=this.limitState3&&(this.limitState3=1,this.limitImpulse3=0),this.limitVelocity3=this.upperLimit3-m):(this.limitState3=2,this.limitImpulse3=0,this.limitVelocity3=0),d||(.02<this.limitVelocity3?this.limitVelocity3-=.02:this.limitVelocity3<-.02?this.limitVelocity3+=.02:this.limitVelocity3=0)):(this.limitState3=2,this.limitImpulse3=0),this.enableMotor1&&(0!=this.limitState1||r)?this.maxMotorImpulse1=this.maxMotorForce1*t:(this.motorImpulse1=0,this.maxMotorImpulse1=0),this.enableMotor2&&(0!=this.limitState2||c)?this.maxMotorImpulse2=this.maxMotorForce2*t:(this.motorImpulse2=0,this.maxMotorImpulse2=0),this.enableMotor3&&(0!=this.limitState3||d)?this.maxMotorImpulse3=this.maxMotorForce3*t:(this.motorImpulse3=0,this.maxMotorImpulse3=0),this.a1x1=this.ax1*this.i1e00+this.ay1*this.i1e01+this.az1*this.i1e02,this.a1y1=this.ax1*this.i1e10+this.ay1*this.i1e11+this.az1*this.i1e12,this.a1z1=this.ax1*this.i1e20+this.ay1*this.i1e21+this.az1*this.i1e22,this.a2x1=this.ax1*this.i2e00+this.ay1*this.i2e01+this.az1*this.i2e02,this.a2y1=this.ax1*this.i2e10+this.ay1*this.i2e11+this.az1*this.i2e12,this.a2z1=this.ax1*this.i2e20+this.ay1*this.i2e21+this.az1*this.i2e22,this.a1x2=this.ax2*this.i1e00+this.ay2*this.i1e01+this.az2*this.i1e02,this.a1y2=this.ax2*this.i1e10+this.ay2*this.i1e11+this.az2*this.i1e12,this.a1z2=this.ax2*this.i1e20+this.ay2*this.i1e21+this.az2*this.i1e22,this.a2x2=this.ax2*this.i2e00+this.ay2*this.i2e01+this.az2*this.i2e02,this.a2y2=this.ax2*this.i2e10+this.ay2*this.i2e11+this.az2*this.i2e12,this.a2z2=this.ax2*this.i2e20+this.ay2*this.i2e21+this.az2*this.i2e22,this.a1x3=this.ax3*this.i1e00+this.ay3*this.i1e01+this.az3*this.i1e02,this.a1y3=this.ax3*this.i1e10+this.ay3*this.i1e11+this.az3*this.i1e12,this.a1z3=this.ax3*this.i1e20+this.ay3*this.i1e21+this.az3*this.i1e22,this.a2x3=this.ax3*this.i2e00+this.ay3*this.i2e01+this.az3*this.i2e02,this.a2y3=this.ax3*this.i2e10+this.ay3*this.i2e11+this.az3*this.i2e12,this.a2z3=this.ax3*this.i2e20+this.ay3*this.i2e21+this.az3*this.i2e22,this.k00=this.ax1*(this.a1x1+this.a2x1)+this.ay1*(this.a1y1+this.a2y1)+this.az1*(this.a1z1+this.a2z1),this.k01=this.ax1*(this.a1x2+this.a2x2)+this.ay1*(this.a1y2+this.a2y2)+this.az1*(this.a1z2+this.a2z2),this.k02=this.ax1*(this.a1x3+this.a2x3)+this.ay1*(this.a1y3+this.a2y3)+this.az1*(this.a1z3+this.a2z3),this.k10=this.ax2*(this.a1x1+this.a2x1)+this.ay2*(this.a1y1+this.a2y1)+this.az2*(this.a1z1+this.a2z1),this.k11=this.ax2*(this.a1x2+this.a2x2)+this.ay2*(this.a1y2+this.a2y2)+this.az2*(this.a1z2+this.a2z2),this.k12=this.ax2*(this.a1x3+this.a2x3)+this.ay2*(this.a1y3+this.a2y3)+this.az2*(this.a1z3+this.a2z3),this.k20=this.ax3*(this.a1x1+this.a2x1)+this.ay3*(this.a1y1+this.a2y1)+this.az3*(this.a1z1+this.a2z1),this.k21=this.ax3*(this.a1x2+this.a2x2)+this.ay3*(this.a1y2+this.a2y2)+this.az3*(this.a1z2+this.a2z2),this.k22=this.ax3*(this.a1x3+this.a2x3)+this.ay3*(this.a1y3+this.a2y3)+this.az3*(this.a1z3+this.a2z3),this.kv00=this.k00,this.kv11=this.k11,this.kv22=this.k22,this.dv00=1/this.kv00,this.dv11=1/this.kv11,this.dv22=1/this.kv22,r&&2!=this.limitState1){var f=6.2831853*n,A=f*f*t,b=e/(A+2*this.limitMotor1.dampingRatio*f);this.cfm1=this.kv00*b,this.limitVelocity1*=A*b}else this.cfm1=0,this.limitVelocity1*=.05*e;c&&2!=this.limitState2?(b=e/((A=(f=6.2831853*s)*f*t)+2*this.limitMotor2.dampingRatio*f),this.cfm2=this.kv11*b,this.limitVelocity2*=A*b):(this.cfm2=0,this.limitVelocity2*=.05*e),d&&2!=this.limitState3?(b=e/((A=(f=6.2831853*a)*f*t)+2*this.limitMotor3.dampingRatio*f),this.cfm3=this.kv22*b,this.limitVelocity3*=A*b):(this.cfm3=0,this.limitVelocity3*=.05*e),this.k00+=this.cfm1,this.k11+=this.cfm2,this.k22+=this.cfm3;var v=1/(this.k00*(this.k11*this.k22-this.k21*this.k12)+this.k10*(this.k21*this.k02-this.k01*this.k22)+this.k20*(this.k01*this.k12-this.k11*this.k02));this.d00=(this.k11*this.k22-this.k12*this.k21)*v,this.d01=(this.k02*this.k21-this.k01*this.k22)*v,this.d02=(this.k01*this.k12-this.k02*this.k11)*v,this.d10=(this.k12*this.k20-this.k10*this.k22)*v,this.d11=(this.k00*this.k22-this.k02*this.k20)*v,this.d12=(this.k02*this.k10-this.k00*this.k12)*v,this.d20=(this.k10*this.k21-this.k11*this.k20)*v,this.d21=(this.k01*this.k20-this.k00*this.k21)*v,this.d22=(this.k00*this.k11-this.k01*this.k10)*v,this.limitImpulse1*=.95,this.motorImpulse1*=.95,this.limitImpulse2*=.95,this.motorImpulse2*=.95,this.limitImpulse3*=.95,this.motorImpulse3*=.95;var x=this.limitImpulse1+this.motorImpulse1,C=this.limitImpulse2+this.motorImpulse2,S=this.limitImpulse3+this.motorImpulse3;this.a1.x+=x*this.a1x1+C*this.a1x2+S*this.a1x3,this.a1.y+=x*this.a1y1+C*this.a1y2+S*this.a1y3,this.a1.z+=x*this.a1z1+C*this.a1z2+S*this.a1z3,this.a2.x-=x*this.a2x1+C*this.a2x2+S*this.a2x3,this.a2.y-=x*this.a2y1+C*this.a2y2+S*this.a2y3,this.a2.z-=x*this.a2z1+C*this.a2z2+S*this.a2z3},solve_:function(){var t=this.a2.x-this.a1.x,e=this.a2.y-this.a1.y,o=this.a2.z-this.a1.z;this.limitVelocity3=30;var i=t*this.ax1+e*this.ay1+o*this.az1-this.limitVelocity1,n=t*this.ax2+e*this.ay2+o*this.az2-this.limitVelocity2,s=t*this.ax3+e*this.ay3+o*this.az3-this.limitVelocity3,a=i*this.d00+n*this.d01+s*this.d02,r=i*this.d10+n*this.d11+s*this.d12,c=i*this.d20+n*this.d21+s*this.d22;this.limitImpulse1+=a,this.limitImpulse2+=r,this.limitImpulse3+=c,this.a1.x+=a*this.a1x1+r*this.a1x2+c*this.a1x3,this.a1.y+=a*this.a1y1+r*this.a1y2+c*this.a1y3,this.a1.z+=a*this.a1z1+r*this.a1z2+c*this.a1z3,this.a2.x-=a*this.a2x1+r*this.a2x2+c*this.a2x3,this.a2.y-=a*this.a2y1+r*this.a2y2+c*this.a2y3,this.a2.z-=a*this.a2z1+r*this.a2z2+c*this.a2z3},solve:function(){var t=this.a2.x-this.a1.x,e=this.a2.y-this.a1.y,o=this.a2.z-this.a1.z,i=t*this.ax1+e*this.ay1+o*this.az1,n=t*this.ax2+e*this.ay2+o*this.az2,s=t*this.ax3+e*this.ay3+o*this.az3,a=this.motorImpulse1,r=this.motorImpulse2,c=this.motorImpulse3,d=0,p=0,l=0;this.enableMotor1&&(d=(i-this.motorSpeed1)*this.dv00,this.motorImpulse1+=d,this.motorImpulse1>this.maxMotorImpulse1?this.motorImpulse1=this.maxMotorImpulse1:this.motorImpulse1<-this.maxMotorImpulse1&&(this.motorImpulse1=-this.maxMotorImpulse1),d=this.motorImpulse1-a),this.enableMotor2&&(p=(n-this.motorSpeed2)*this.dv11,this.motorImpulse2+=p,this.motorImpulse2>this.maxMotorImpulse2?this.motorImpulse2=this.maxMotorImpulse2:this.motorImpulse2<-this.maxMotorImpulse2&&(this.motorImpulse2=-this.maxMotorImpulse2),p=this.motorImpulse2-r),this.enableMotor3&&(l=(s-this.motorSpeed3)*this.dv22,this.motorImpulse3+=l,this.motorImpulse3>this.maxMotorImpulse3?this.motorImpulse3=this.maxMotorImpulse3:this.motorImpulse3<-this.maxMotorImpulse3&&(this.motorImpulse3=-this.maxMotorImpulse3),l=this.motorImpulse3-c),i+=d*this.kv00+p*this.k01+l*this.k02,n+=d*this.k10+p*this.kv11+l*this.k12,s+=d*this.k20+p*this.k21+l*this.kv22,i-=this.limitVelocity1+this.limitImpulse1*this.cfm1,n-=this.limitVelocity2+this.limitImpulse2*this.cfm2,s-=this.limitVelocity3+this.limitImpulse3*this.cfm3;var u=this.limitImpulse1,y=this.limitImpulse2,g=this.limitImpulse3,m=i*this.d00+n*this.d01+s*this.d02,f=i*this.d10+n*this.d11+s*this.d12,A=i*this.d20+n*this.d21+s*this.d22;this.limitImpulse1+=m,this.limitImpulse2+=f,this.limitImpulse3+=A;var b,v=0;switch((2==this.limitState1||this.limitImpulse1*this.limitState1<0)&&(n+=(m=-u)*this.k10,s+=m*this.k20,v|=1),(2==this.limitState2||this.limitImpulse2*this.limitState2<0)&&(i+=(f=-y)*this.k01,s+=f*this.k21,v|=2),(2==this.limitState3||this.limitImpulse3*this.limitState3<0)&&(i+=(A=-g)*this.k02,n+=A*this.k12,v|=4),v){case 1:b=1/(this.k11*this.k22-this.k12*this.k21),f=(this.k22*n+-this.k12*s)*b,A=(-this.k21*n+this.k11*s)*b;break;case 2:b=1/(this.k00*this.k22-this.k02*this.k20),m=(this.k22*i+-this.k02*s)*b,A=(-this.k20*i+this.k00*s)*b;break;case 3:A=s/this.k22;break;case 4:b=1/(this.k00*this.k11-this.k01*this.k10),m=(this.k11*i+-this.k01*n)*b,f=(-this.k10*i+this.k00*n)*b;break;case 5:f=n/this.k11;break;case 6:m=i/this.k00}this.limitImpulse1=m+u,this.limitImpulse2=f+y,this.limitImpulse3=A+g;var x=d+m,C=p+f,S=l+A;this.a1.x+=x*this.a1x1+C*this.a1x2+S*this.a1x3,this.a1.y+=x*this.a1y1+C*this.a1y2+S*this.a1y3,this.a1.z+=x*this.a1z1+C*this.a1z2+S*this.a1z3,this.a2.x-=x*this.a2x1+C*this.a2x2+S*this.a2x3,this.a2.y-=x*this.a2y1+C*this.a2y2+S*this.a2y3,this.a2.z-=x*this.a2z1+C*this.a2z2+S*this.a2z3,t=this.a2.x-this.a1.x,e=this.a2.y-this.a1.y,o=this.a2.z-this.a1.z,n=t*this.ax2+e*this.ay2+o*this.az2}},OIMO.RotationalConstraint=function(t,e){this.cfm=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.motorDenom=NaN,this.invMotorDenom=NaN,this.invDenom=NaN,this.ax=NaN,this.ay=NaN,this.az=NaN,this.a1x=NaN,this.a1y=NaN,this.a1z=NaN,this.a2x=NaN,this.a2y=NaN,this.a2z=NaN,this.enableLimit=!1,this.lowerLimit=NaN,this.upperLimit=NaN,this.limitVelocity=NaN,this.limitState=0,this.enableMotor=!1,this.motorSpeed=NaN,this.maxMotorForce=NaN,this.maxMotorImpulse=NaN,this.limitMotor=e,this.b1=t.body1,this.b2=t.body2,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse=0,this.motorImpulse=0},OIMO.RotationalConstraint.prototype={constructor:OIMO.RotationalConstraint,preSolve:function(t,e){this.ax=this.limitMotor.axis.x,this.ay=this.limitMotor.axis.y,this.az=this.limitMotor.axis.z,this.lowerLimit=this.limitMotor.lowerLimit,this.upperLimit=this.limitMotor.upperLimit,this.motorSpeed=this.limitMotor.motorSpeed,this.maxMotorForce=this.limitMotor.maxMotorForce,this.enableMotor=0<this.maxMotorForce;var o=this.i1.elements,i=this.i2.elements;this.i1e00=o[0],this.i1e01=o[1],this.i1e02=o[2],this.i1e10=o[3],this.i1e11=o[4],this.i1e12=o[5],this.i1e20=o[6],this.i1e21=o[7],this.i1e22=o[8],this.i2e00=i[0],this.i2e01=i[1],this.i2e02=i[2],this.i2e10=i[3],this.i2e11=i[4],this.i2e12=i[5],this.i2e20=i[6],this.i2e21=i[7],this.i2e22=i[8];var n=this.limitMotor.frequency,s=0<n,a=this.lowerLimit<=this.upperLimit,r=this.limitMotor.angle;if(a?(this.lowerLimit==this.upperLimit?(0!=this.limitState&&(this.limitState=0,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-r):r<this.lowerLimit?(-1!=this.limitState&&(this.limitState=-1,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-r):r>this.upperLimit?(1!=this.limitState&&(this.limitState=1,this.limitImpulse=0),this.limitVelocity=this.upperLimit-r):(this.limitState=2,this.limitImpulse=0,this.limitVelocity=0),s||(.02<this.limitVelocity?this.limitVelocity-=.02:this.limitVelocity<-.02?this.limitVelocity+=.02:this.limitVelocity=0)):(this.limitState=2,this.limitImpulse=0),this.enableMotor&&(0!=this.limitState||s)?this.maxMotorImpulse=this.maxMotorForce*t:(this.motorImpulse=0,this.maxMotorImpulse=0),this.a1x=this.ax*this.i1e00+this.ay*this.i1e01+this.az*this.i1e02,this.a1y=this.ax*this.i1e10+this.ay*this.i1e11+this.az*this.i1e12,this.a1z=this.ax*this.i1e20+this.ay*this.i1e21+this.az*this.i1e22,this.a2x=this.ax*this.i2e00+this.ay*this.i2e01+this.az*this.i2e02,this.a2y=this.ax*this.i2e10+this.ay*this.i2e11+this.az*this.i2e12,this.a2z=this.ax*this.i2e20+this.ay*this.i2e21+this.az*this.i2e22,this.motorDenom=this.ax*(this.a1x+this.a2x)+this.ay*(this.a1y+this.a2y)+this.az*(this.a1z+this.a2z),this.invMotorDenom=1/this.motorDenom,s&&2!=this.limitState){var c=6.2831853*n,d=c*c*t,p=e/(d+2*this.limitMotor.dampingRatio*c);this.cfm=this.motorDenom*p,this.limitVelocity*=d*p}else this.cfm=0,this.limitVelocity*=.05*e;this.invDenom=1/(this.motorDenom+this.cfm),this.limitImpulse*=.95,this.motorImpulse*=.95;var l=this.limitImpulse+this.motorImpulse;this.a1.x+=l*this.a1x,this.a1.y+=l*this.a1y,this.a1.z+=l*this.a1z,this.a2.x-=l*this.a2x,this.a2.y-=l*this.a2y,this.a2.z-=l*this.a2z},solve:function(){var t,e,o=this.ax*(this.a2.x-this.a1.x)+this.ay*(this.a2.y-this.a1.y)+this.az*(this.a2.z-this.a1.z);if(this.enableMotor){t=(o-this.motorSpeed)*this.invMotorDenom;var i=this.motorImpulse;this.motorImpulse+=t,this.motorImpulse>this.maxMotorImpulse?this.motorImpulse=this.maxMotorImpulse:this.motorImpulse<-this.maxMotorImpulse&&(this.motorImpulse=-this.maxMotorImpulse),o-=(t=this.motorImpulse-i)*this.motorDenom}else t=0;if(2!=this.limitState){e=(o-this.limitVelocity-this.limitImpulse*this.cfm)*this.invDenom;var n=this.limitImpulse;this.limitImpulse+=e,this.limitImpulse*this.limitState<0&&(this.limitImpulse=0),e=this.limitImpulse-n}else e=0;var s=e+t;this.a1.x+=s*this.a1x,this.a1.y+=s*this.a1y,this.a1.z+=s*this.a1z,this.a2.x-=s*this.a2x,this.a2.y-=s*this.a2y,this.a2.z-=s*this.a2z}},OIMO.Translational3Constraint=function(t,e,o,i){this.m1=NaN,this.m2=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.ax1=NaN,this.ay1=NaN,this.az1=NaN,this.ax2=NaN,this.ay2=NaN,this.az2=NaN,this.ax3=NaN,this.ay3=NaN,this.az3=NaN,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.t1x1=NaN,this.t1y1=NaN,this.t1z1=NaN,this.t2x1=NaN,this.t2y1=NaN,this.t2z1=NaN,this.l1x1=NaN,this.l1y1=NaN,this.l1z1=NaN,this.l2x1=NaN,this.l2y1=NaN,this.l2z1=NaN,this.a1x1=NaN,this.a1y1=NaN,this.a1z1=NaN,this.a2x1=NaN,this.a2y1=NaN,this.a2z1=NaN,this.t1x2=NaN,this.t1y2=NaN,this.t1z2=NaN,this.t2x2=NaN,this.t2y2=NaN,this.t2z2=NaN,this.l1x2=NaN,this.l1y2=NaN,this.l1z2=NaN,this.l2x2=NaN,this.l2y2=NaN,this.l2z2=NaN,this.a1x2=NaN,this.a1y2=NaN,this.a1z2=NaN,this.a2x2=NaN,this.a2y2=NaN,this.a2z2=NaN,this.t1x3=NaN,this.t1y3=NaN,this.t1z3=NaN,this.t2x3=NaN,this.t2y3=NaN,this.t2z3=NaN,this.l1x3=NaN,this.l1y3=NaN,this.l1z3=NaN,this.l2x3=NaN,this.l2y3=NaN,this.l2z3=NaN,this.a1x3=NaN,this.a1y3=NaN,this.a1z3=NaN,this.a2x3=NaN,this.a2y3=NaN,this.a2z3=NaN,this.lowerLimit1=NaN,this.upperLimit1=NaN,this.limitVelocity1=NaN,this.limitState1=0,this.enableMotor1=!1,this.motorSpeed1=NaN,this.maxMotorForce1=NaN,this.maxMotorImpulse1=NaN,this.lowerLimit2=NaN,this.upperLimit2=NaN,this.limitVelocity2=NaN,this.limitState2=0,this.enableMotor2=!1,this.motorSpeed2=NaN,this.maxMotorForce2=NaN,this.maxMotorImpulse2=NaN,this.lowerLimit3=NaN,this.upperLimit3=NaN,this.limitVelocity3=NaN,this.limitState3=0,this.enableMotor3=!1,this.motorSpeed3=NaN,this.maxMotorForce3=NaN,this.maxMotorImpulse3=NaN,this.k00=NaN,this.k01=NaN,this.k02=NaN,this.k10=NaN,this.k11=NaN,this.k12=NaN,this.k20=NaN,this.k21=NaN,this.k22=NaN,this.kv00=NaN,this.kv11=NaN,this.kv22=NaN,this.dv00=NaN,this.dv11=NaN,this.dv22=NaN,this.d00=NaN,this.d01=NaN,this.d02=NaN,this.d10=NaN,this.d11=NaN,this.d12=NaN,this.d20=NaN,this.d21=NaN,this.d22=NaN,this.limitMotor1=e,this.limitMotor2=o,this.limitMotor3=i,this.b1=t.body1,this.b2=t.body2,this.p1=t.anchorPoint1,this.p2=t.anchorPoint2,this.r1=t.relativeAnchorPoint1,this.r2=t.relativeAnchorPoint2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse1=0,this.motorImpulse1=0,this.limitImpulse2=0,this.motorImpulse2=0,this.limitImpulse3=0,this.motorImpulse3=0,this.cfm1=0,this.cfm2=0,this.cfm3=0,this.weight=-1},OIMO.Translational3Constraint.prototype={constructor:OIMO.Translational3Constraint,preSolve:function(t,e){this.ax1=this.limitMotor1.axis.x,this.ay1=this.limitMotor1.axis.y,this.az1=this.limitMotor1.axis.z,this.ax2=this.limitMotor2.axis.x,this.ay2=this.limitMotor2.axis.y,this.az2=this.limitMotor2.axis.z,this.ax3=this.limitMotor3.axis.x,this.ay3=this.limitMotor3.axis.y,this.az3=this.limitMotor3.axis.z,this.lowerLimit1=this.limitMotor1.lowerLimit,this.upperLimit1=this.limitMotor1.upperLimit,this.motorSpeed1=this.limitMotor1.motorSpeed,this.maxMotorForce1=this.limitMotor1.maxMotorForce,this.enableMotor1=0<this.maxMotorForce1,this.lowerLimit2=this.limitMotor2.lowerLimit,this.upperLimit2=this.limitMotor2.upperLimit,this.motorSpeed2=this.limitMotor2.motorSpeed,this.maxMotorForce2=this.limitMotor2.maxMotorForce,this.enableMotor2=0<this.maxMotorForce2,this.lowerLimit3=this.limitMotor3.lowerLimit,this.upperLimit3=this.limitMotor3.upperLimit,this.motorSpeed3=this.limitMotor3.motorSpeed,this.maxMotorForce3=this.limitMotor3.maxMotorForce,this.enableMotor3=0<this.maxMotorForce3,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass;var o=this.i1.elements,i=this.i2.elements;this.i1e00=o[0],this.i1e01=o[1],this.i1e02=o[2],this.i1e10=o[3],this.i1e11=o[4],this.i1e12=o[5],this.i1e20=o[6],this.i1e21=o[7],this.i1e22=o[8],this.i2e00=i[0],this.i2e01=i[1],this.i2e02=i[2],this.i2e10=i[3],this.i2e11=i[4],this.i2e12=i[5],this.i2e20=i[6],this.i2e21=i[7],this.i2e22=i[8];var n=this.p2.x-this.p1.x,s=this.p2.y-this.p1.y,a=this.p2.z-this.p1.z,r=n*this.ax1+s*this.ay1+a*this.az1,c=n*this.ax2+s*this.ay2+a*this.az2,d=n*this.ax3+s*this.ay3+a*this.az3,p=this.limitMotor1.frequency,l=this.limitMotor2.frequency,u=this.limitMotor3.frequency,y=0<p,g=0<l,m=0<u,f=this.lowerLimit1<=this.upperLimit1,A=this.lowerLimit2<=this.upperLimit2,b=this.lowerLimit3<=this.upperLimit3;(y&&20<r||r<-20)&&(y=!1),(g&&20<c||c<-20)&&(g=!1),(m&&20<d||d<-20)&&(m=!1),f?(this.lowerLimit1==this.upperLimit1?(0!=this.limitState1&&(this.limitState1=0,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-r,y||(r=this.lowerLimit1)):r<this.lowerLimit1?(-1!=this.limitState1&&(this.limitState1=-1,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-r,y||(r=this.lowerLimit1)):r>this.upperLimit1?(1!=this.limitState1&&(this.limitState1=1,this.limitImpulse1=0),this.limitVelocity1=this.upperLimit1-r,y||(r=this.upperLimit1)):(this.limitState1=2,this.limitImpulse1=0,this.limitVelocity1=0),y||(.005<this.limitVelocity1?this.limitVelocity1-=.005:this.limitVelocity1<-.005?this.limitVelocity1+=.005:this.limitVelocity1=0)):(this.limitState1=2,this.limitImpulse1=0),A?(this.lowerLimit2==this.upperLimit2?(0!=this.limitState2&&(this.limitState2=0,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-c,g||(c=this.lowerLimit2)):c<this.lowerLimit2?(-1!=this.limitState2&&(this.limitState2=-1,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-c,g||(c=this.lowerLimit2)):c>this.upperLimit2?(1!=this.limitState2&&(this.limitState2=1,this.limitImpulse2=0),this.limitVelocity2=this.upperLimit2-c,g||(c=this.upperLimit2)):(this.limitState2=2,this.limitImpulse2=0,this.limitVelocity2=0),g||(.005<this.limitVelocity2?this.limitVelocity2-=.005:this.limitVelocity2<-.005?this.limitVelocity2+=.005:this.limitVelocity2=0)):(this.limitState2=2,this.limitImpulse2=0),b?(this.lowerLimit3==this.upperLimit3?(0!=this.limitState3&&(this.limitState3=0,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-d,m||(d=this.lowerLimit3)):d<this.lowerLimit3?(-1!=this.limitState3&&(this.limitState3=-1,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-d,m||(d=this.lowerLimit3)):d>this.upperLimit3?(1!=this.limitState3&&(this.limitState3=1,this.limitImpulse3=0),this.limitVelocity3=this.upperLimit3-d,m||(d=this.upperLimit3)):(this.limitState3=2,this.limitImpulse3=0,this.limitVelocity3=0),m||(.005<this.limitVelocity3?this.limitVelocity3-=.005:this.limitVelocity3<-.005?this.limitVelocity3+=.005:this.limitVelocity3=0)):(this.limitState3=2,this.limitImpulse3=0),this.enableMotor1&&(0!=this.limitState1||y)?this.maxMotorImpulse1=this.maxMotorForce1*t:(this.motorImpulse1=0,this.maxMotorImpulse1=0),this.enableMotor2&&(0!=this.limitState2||g)?this.maxMotorImpulse2=this.maxMotorForce2*t:(this.motorImpulse2=0,this.maxMotorImpulse2=0),this.enableMotor3&&(0!=this.limitState3||m)?this.maxMotorImpulse3=this.maxMotorForce3*t:(this.motorImpulse3=0,this.maxMotorImpulse3=0);var v=r*this.ax1+c*this.ax2+d*this.ax2,x=r*this.ay1+c*this.ay2+d*this.ay2,C=r*this.az1+c*this.az2+d*this.az2,S=this.m2/(this.m1+this.m2);0<=this.weight&&(S=this.weight);var T=1-S;this.r1x=this.r1.x+v*S,this.r1y=this.r1.y+x*S,this.r1z=this.r1.z+C*S,this.r2x=this.r2.x-v*T,this.r2y=this.r2.y-x*T,this.r2z=this.r2.z-C*T,this.t1x1=this.r1y*this.az1-this.r1z*this.ay1,this.t1y1=this.r1z*this.ax1-this.r1x*this.az1,this.t1z1=this.r1x*this.ay1-this.r1y*this.ax1,this.t2x1=this.r2y*this.az1-this.r2z*this.ay1,this.t2y1=this.r2z*this.ax1-this.r2x*this.az1,this.t2z1=this.r2x*this.ay1-this.r2y*this.ax1,this.l1x1=this.ax1*this.m1,this.l1y1=this.ay1*this.m1,this.l1z1=this.az1*this.m1,this.l2x1=this.ax1*this.m2,this.l2y1=this.ay1*this.m2,this.l2z1=this.az1*this.m2,this.a1x1=this.t1x1*this.i1e00+this.t1y1*this.i1e01+this.t1z1*this.i1e02,this.a1y1=this.t1x1*this.i1e10+this.t1y1*this.i1e11+this.t1z1*this.i1e12,this.a1z1=this.t1x1*this.i1e20+this.t1y1*this.i1e21+this.t1z1*this.i1e22,this.a2x1=this.t2x1*this.i2e00+this.t2y1*this.i2e01+this.t2z1*this.i2e02,this.a2y1=this.t2x1*this.i2e10+this.t2y1*this.i2e11+this.t2z1*this.i2e12,this.a2z1=this.t2x1*this.i2e20+this.t2y1*this.i2e21+this.t2z1*this.i2e22,this.t1x2=this.r1y*this.az2-this.r1z*this.ay2,this.t1y2=this.r1z*this.ax2-this.r1x*this.az2,this.t1z2=this.r1x*this.ay2-this.r1y*this.ax2,this.t2x2=this.r2y*this.az2-this.r2z*this.ay2,this.t2y2=this.r2z*this.ax2-this.r2x*this.az2,this.t2z2=this.r2x*this.ay2-this.r2y*this.ax2,this.l1x2=this.ax2*this.m1,this.l1y2=this.ay2*this.m1,this.l1z2=this.az2*this.m1,this.l2x2=this.ax2*this.m2,this.l2y2=this.ay2*this.m2,this.l2z2=this.az2*this.m2,this.a1x2=this.t1x2*this.i1e00+this.t1y2*this.i1e01+this.t1z2*this.i1e02,this.a1y2=this.t1x2*this.i1e10+this.t1y2*this.i1e11+this.t1z2*this.i1e12,this.a1z2=this.t1x2*this.i1e20+this.t1y2*this.i1e21+this.t1z2*this.i1e22,this.a2x2=this.t2x2*this.i2e00+this.t2y2*this.i2e01+this.t2z2*this.i2e02,this.a2y2=this.t2x2*this.i2e10+this.t2y2*this.i2e11+this.t2z2*this.i2e12,this.a2z2=this.t2x2*this.i2e20+this.t2y2*this.i2e21+this.t2z2*this.i2e22,this.t1x3=this.r1y*this.az3-this.r1z*this.ay3,this.t1y3=this.r1z*this.ax3-this.r1x*this.az3,this.t1z3=this.r1x*this.ay3-this.r1y*this.ax3,this.t2x3=this.r2y*this.az3-this.r2z*this.ay3,this.t2y3=this.r2z*this.ax3-this.r2x*this.az3,this.t2z3=this.r2x*this.ay3-this.r2y*this.ax3,this.l1x3=this.ax3*this.m1,this.l1y3=this.ay3*this.m1,this.l1z3=this.az3*this.m1,this.l2x3=this.ax3*this.m2,this.l2y3=this.ay3*this.m2,this.l2z3=this.az3*this.m2,this.a1x3=this.t1x3*this.i1e00+this.t1y3*this.i1e01+this.t1z3*this.i1e02,this.a1y3=this.t1x3*this.i1e10+this.t1y3*this.i1e11+this.t1z3*this.i1e12,this.a1z3=this.t1x3*this.i1e20+this.t1y3*this.i1e21+this.t1z3*this.i1e22,this.a2x3=this.t2x3*this.i2e00+this.t2y3*this.i2e01+this.t2z3*this.i2e02,this.a2y3=this.t2x3*this.i2e10+this.t2y3*this.i2e11+this.t2z3*this.i2e12,this.a2z3=this.t2x3*this.i2e20+this.t2y3*this.i2e21+this.t2z3*this.i2e22;var B=this.m1+this.m2;if(this.k00=(this.ax1*this.ax1+this.ay1*this.ay1+this.az1*this.az1)*B,this.k01=(this.ax1*this.ax2+this.ay1*this.ay2+this.az1*this.az2)*B,this.k02=(this.ax1*this.ax3+this.ay1*this.ay3+this.az1*this.az3)*B,this.k10=(this.ax2*this.ax1+this.ay2*this.ay1+this.az2*this.az1)*B,this.k11=(this.ax2*this.ax2+this.ay2*this.ay2+this.az2*this.az2)*B,this.k12=(this.ax2*this.ax3+this.ay2*this.ay3+this.az2*this.az3)*B,this.k20=(this.ax3*this.ax1+this.ay3*this.ay1+this.az3*this.az1)*B,this.k21=(this.ax3*this.ax2+this.ay3*this.ay2+this.az3*this.az2)*B,this.k22=(this.ax3*this.ax3+this.ay3*this.ay3+this.az3*this.az3)*B,this.k00+=this.t1x1*this.a1x1+this.t1y1*this.a1y1+this.t1z1*this.a1z1,this.k01+=this.t1x1*this.a1x2+this.t1y1*this.a1y2+this.t1z1*this.a1z2,this.k02+=this.t1x1*this.a1x3+this.t1y1*this.a1y3+this.t1z1*this.a1z3,this.k10+=this.t1x2*this.a1x1+this.t1y2*this.a1y1+this.t1z2*this.a1z1,this.k11+=this.t1x2*this.a1x2+this.t1y2*this.a1y2+this.t1z2*this.a1z2,this.k12+=this.t1x2*this.a1x3+this.t1y2*this.a1y3+this.t1z2*this.a1z3,this.k20+=this.t1x3*this.a1x1+this.t1y3*this.a1y1+this.t1z3*this.a1z1,this.k21+=this.t1x3*this.a1x2+this.t1y3*this.a1y2+this.t1z3*this.a1z2,this.k22+=this.t1x3*this.a1x3+this.t1y3*this.a1y3+this.t1z3*this.a1z3,this.k00+=this.t2x1*this.a2x1+this.t2y1*this.a2y1+this.t2z1*this.a2z1,this.k01+=this.t2x1*this.a2x2+this.t2y1*this.a2y2+this.t2z1*this.a2z2,this.k02+=this.t2x1*this.a2x3+this.t2y1*this.a2y3+this.t2z1*this.a2z3,this.k10+=this.t2x2*this.a2x1+this.t2y2*this.a2y1+this.t2z2*this.a2z1,this.k11+=this.t2x2*this.a2x2+this.t2y2*this.a2y2+this.t2z2*this.a2z2,this.k12+=this.t2x2*this.a2x3+this.t2y2*this.a2y3+this.t2z2*this.a2z3,this.k20+=this.t2x3*this.a2x1+this.t2y3*this.a2y1+this.t2z3*this.a2z1,this.k21+=this.t2x3*this.a2x2+this.t2y3*this.a2y2+this.t2z3*this.a2z2,this.k22+=this.t2x3*this.a2x3+this.t2y3*this.a2y3+this.t2z3*this.a2z3,this.kv00=this.k00,this.kv11=this.k11,this.kv22=this.k22,this.dv00=1/this.kv00,this.dv11=1/this.kv11,this.dv22=1/this.kv22,y&&2!=this.limitState1){var O=6.2831853*p,P=O*O*t,M=e/(P+2*this.limitMotor1.dampingRatio*O);this.cfm1=this.kv00*M,this.limitVelocity1*=P*M}else this.cfm1=0,this.limitVelocity1*=.05*e;g&&2!=this.limitState2?(M=e/((P=(O=6.2831853*l)*O*t)+2*this.limitMotor2.dampingRatio*O),this.cfm2=this.kv11*M,this.limitVelocity2*=P*M):(this.cfm2=0,this.limitVelocity2*=.05*e),m&&2!=this.limitState3?(M=e/((P=(O=6.2831853*u)*O*t)+2*this.limitMotor3.dampingRatio*O),this.cfm3=this.kv22*M,this.limitVelocity3*=P*M):(this.cfm3=0,this.limitVelocity3*=.05*e),this.k00+=this.cfm1,this.k11+=this.cfm2,this.k22+=this.cfm3;var I=1/(this.k00*(this.k11*this.k22-this.k21*this.k12)+this.k10*(this.k21*this.k02-this.k01*this.k22)+this.k20*(this.k01*this.k12-this.k11*this.k02));this.d00=(this.k11*this.k22-this.k12*this.k21)*I,this.d01=(this.k02*this.k21-this.k01*this.k22)*I,this.d02=(this.k01*this.k12-this.k02*this.k11)*I,this.d10=(this.k12*this.k20-this.k10*this.k22)*I,this.d11=(this.k00*this.k22-this.k02*this.k20)*I,this.d12=(this.k02*this.k10-this.k00*this.k12)*I,this.d20=(this.k10*this.k21-this.k11*this.k20)*I,this.d21=(this.k01*this.k20-this.k00*this.k21)*I,this.d22=(this.k00*this.k11-this.k01*this.k10)*I;var N=this.limitImpulse1+this.motorImpulse1,z=this.limitImpulse2+this.motorImpulse2,w=this.limitImpulse3+this.motorImpulse3;this.l1.x+=N*this.l1x1+z*this.l1x2+w*this.l1x3,this.l1.y+=N*this.l1y1+z*this.l1y2+w*this.l1y3,this.l1.z+=N*this.l1z1+z*this.l1z2+w*this.l1z3,this.a1.x+=N*this.a1x1+z*this.a1x2+w*this.a1x3,this.a1.y+=N*this.a1y1+z*this.a1y2+w*this.a1y3,this.a1.z+=N*this.a1z1+z*this.a1z2+w*this.a1z3,this.l2.x-=N*this.l2x1+z*this.l2x2+w*this.l2x3,this.l2.y-=N*this.l2y1+z*this.l2y2+w*this.l2y3,this.l2.z-=N*this.l2z1+z*this.l2z2+w*this.l2z3,this.a2.x-=N*this.a2x1+z*this.a2x2+w*this.a2x3,this.a2.y-=N*this.a2y1+z*this.a2y2+w*this.a2y3,this.a2.z-=N*this.a2z1+z*this.a2z2+w*this.a2z3},solve:function(){var t=this.l2.x-this.l1.x+this.a2.y*this.r2z-this.a2.z*this.r2y-this.a1.y*this.r1z+this.a1.z*this.r1y,e=this.l2.y-this.l1.y+this.a2.z*this.r2x-this.a2.x*this.r2z-this.a1.z*this.r1x+this.a1.x*this.r1z,o=this.l2.z-this.l1.z+this.a2.x*this.r2y-this.a2.y*this.r2x-this.a1.x*this.r1y+this.a1.y*this.r1x,i=t*this.ax1+e*this.ay1+o*this.az1,n=t*this.ax2+e*this.ay2+o*this.az2,s=t*this.ax3+e*this.ay3+o*this.az3,a=this.motorImpulse1,r=this.motorImpulse2,c=this.motorImpulse3,d=0,p=0,l=0;this.enableMotor1&&(d=(i-this.motorSpeed1)*this.dv00,this.motorImpulse1+=d,this.motorImpulse1>this.maxMotorImpulse1?this.motorImpulse1=this.maxMotorImpulse1:this.motorImpulse1<-this.maxMotorImpulse1&&(this.motorImpulse1=-this.maxMotorImpulse1),d=this.motorImpulse1-a),this.enableMotor2&&(p=(n-this.motorSpeed2)*this.dv11,this.motorImpulse2+=p,this.motorImpulse2>this.maxMotorImpulse2?this.motorImpulse2=this.maxMotorImpulse2:this.motorImpulse2<-this.maxMotorImpulse2&&(this.motorImpulse2=-this.maxMotorImpulse2),p=this.motorImpulse2-r),this.enableMotor3&&(l=(s-this.motorSpeed3)*this.dv22,this.motorImpulse3+=l,this.motorImpulse3>this.maxMotorImpulse3?this.motorImpulse3=this.maxMotorImpulse3:this.motorImpulse3<-this.maxMotorImpulse3&&(this.motorImpulse3=-this.maxMotorImpulse3),l=this.motorImpulse3-c),i+=d*this.kv00+p*this.k01+l*this.k02,n+=d*this.k10+p*this.kv11+l*this.k12,s+=d*this.k20+p*this.k21+l*this.kv22,i-=this.limitVelocity1+this.limitImpulse1*this.cfm1,n-=this.limitVelocity2+this.limitImpulse2*this.cfm2,s-=this.limitVelocity3+this.limitImpulse3*this.cfm3;var u=this.limitImpulse1,y=this.limitImpulse2,g=this.limitImpulse3,m=i*this.d00+n*this.d01+s*this.d02,f=i*this.d10+n*this.d11+s*this.d12,A=i*this.d20+n*this.d21+s*this.d22;this.limitImpulse1+=m,this.limitImpulse2+=f,this.limitImpulse3+=A;var b,v=0;switch((2==this.limitState1||this.limitImpulse1*this.limitState1<0)&&(n+=(m=-u)*this.k10,s+=m*this.k20,v|=1),(2==this.limitState2||this.limitImpulse2*this.limitState2<0)&&(i+=(f=-y)*this.k01,s+=f*this.k21,v|=2),(2==this.limitState3||this.limitImpulse3*this.limitState3<0)&&(i+=(A=-g)*this.k02,n+=A*this.k12,v|=4),v){case 1:b=1/(this.k11*this.k22-this.k12*this.k21),f=(this.k22*n+-this.k12*s)*b,A=(-this.k21*n+this.k11*s)*b;break;case 2:b=1/(this.k00*this.k22-this.k02*this.k20),m=(this.k22*i+-this.k02*s)*b,A=(-this.k20*i+this.k00*s)*b;break;case 3:A=s/this.k22;break;case 4:b=1/(this.k00*this.k11-this.k01*this.k10),m=(this.k11*i+-this.k01*n)*b,f=(-this.k10*i+this.k00*n)*b;break;case 5:f=n/this.k11;break;case 6:m=i/this.k00}this.limitImpulse1=u+m,this.limitImpulse2=y+f,this.limitImpulse3=g+A;var x=d+m,C=p+f,S=l+A;this.l1.x+=x*this.l1x1+C*this.l1x2+S*this.l1x3,this.l1.y+=x*this.l1y1+C*this.l1y2+S*this.l1y3,this.l1.z+=x*this.l1z1+C*this.l1z2+S*this.l1z3,this.a1.x+=x*this.a1x1+C*this.a1x2+S*this.a1x3,this.a1.y+=x*this.a1y1+C*this.a1y2+S*this.a1y3,this.a1.z+=x*this.a1z1+C*this.a1z2+S*this.a1z3,this.l2.x-=x*this.l2x1+C*this.l2x2+S*this.l2x3,this.l2.y-=x*this.l2y1+C*this.l2y2+S*this.l2y3,this.l2.z-=x*this.l2z1+C*this.l2z2+S*this.l2z3,this.a2.x-=x*this.a2x1+C*this.a2x2+S*this.a2x3,this.a2.y-=x*this.a2y1+C*this.a2y2+S*this.a2y3,this.a2.z-=x*this.a2z1+C*this.a2z2+S*this.a2z3}},OIMO.TranslationalConstraint=function(t,e){this.cfm=NaN,this.m1=NaN,this.m2=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.motorDenom=NaN,this.invMotorDenom=NaN,this.invDenom=NaN,this.ax=NaN,this.ay=NaN,this.az=NaN,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.t1x=NaN,this.t1y=NaN,this.t1z=NaN,this.t2x=NaN,this.t2y=NaN,this.t2z=NaN,this.l1x=NaN,this.l1y=NaN,this.l1z=NaN,this.l2x=NaN,this.l2y=NaN,this.l2z=NaN,this.a1x=NaN,this.a1y=NaN,this.a1z=NaN,this.a2x=NaN,this.a2y=NaN,this.a2z=NaN,this.lowerLimit=NaN,this.upperLimit=NaN,this.limitVelocity=NaN,this.limitState=0,this.enableMotor=!1,this.motorSpeed=NaN,this.maxMotorForce=NaN,this.maxMotorImpulse=NaN,this.limitMotor=e,this.b1=t.body1,this.b2=t.body2,this.p1=t.anchorPoint1,this.p2=t.anchorPoint2,this.r1=t.relativeAnchorPoint1,this.r2=t.relativeAnchorPoint2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse=0,this.motorImpulse=0},OIMO.TranslationalConstraint.prototype={constructor:OIMO.TranslationalConstraint,preSolve:function(t,e){this.ax=this.limitMotor.axis.x,this.ay=this.limitMotor.axis.y,this.az=this.limitMotor.axis.z,this.lowerLimit=this.limitMotor.lowerLimit,this.upperLimit=this.limitMotor.upperLimit,this.motorSpeed=this.limitMotor.motorSpeed,this.maxMotorForce=this.limitMotor.maxMotorForce,this.enableMotor=0<this.maxMotorForce,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass;var o=this.i1.elements,i=this.i2.elements;this.i1e00=o[0],this.i1e01=o[1],this.i1e02=o[2],this.i1e10=o[3],this.i1e11=o[4],this.i1e12=o[5],this.i1e20=o[6],this.i1e21=o[7],this.i1e22=o[8],this.i2e00=i[0],this.i2e01=i[1],this.i2e02=i[2],this.i2e10=i[3],this.i2e11=i[4],this.i2e12=i[5],this.i2e20=i[6],this.i2e21=i[7],this.i2e22=i[8];var n=this.p2.x-this.p1.x,s=this.p2.y-this.p1.y,a=this.p2.z-this.p1.z,r=n*this.ax+s*this.ay+a*this.az,c=this.limitMotor.frequency,d=0<c;(d&&20<r||r<-20)&&(d=!1),this.lowerLimit<=this.upperLimit?(this.lowerLimit==this.upperLimit?(0!=this.limitState&&(this.limitState=0,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-r,d||(r=this.lowerLimit)):r<this.lowerLimit?(-1!=this.limitState&&(this.limitState=-1,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-r,d||(r=this.lowerLimit)):r>this.upperLimit?(1!=this.limitState&&(this.limitState=1,this.limitImpulse=0),this.limitVelocity=this.upperLimit-r,d||(r=this.upperLimit)):(this.limitState=2,this.limitImpulse=0,this.limitVelocity=0),d||(.005<this.limitVelocity?this.limitVelocity-=.005:this.limitVelocity<-.005?this.limitVelocity+=.005:this.limitVelocity=0)):(this.limitState=2,this.limitImpulse=0),this.enableMotor&&(0!=this.limitState||d)?this.maxMotorImpulse=this.maxMotorForce*t:(this.motorImpulse=0,this.maxMotorImpulse=0);var p=r*this.ax,l=r*this.ay,u=r*this.az,y=this.m1/(this.m1+this.m2),g=1-y;if(this.r1x=this.r1.x+p*y,this.r1y=this.r1.y+l*y,this.r1z=this.r1.z+u*y,this.r2x=this.r2.x-p*g,this.r2y=this.r2.y-l*g,this.r2z=this.r2.z-u*g,this.t1x=this.r1y*this.az-this.r1z*this.ay,this.t1y=this.r1z*this.ax-this.r1x*this.az,this.t1z=this.r1x*this.ay-this.r1y*this.ax,this.t2x=this.r2y*this.az-this.r2z*this.ay,this.t2y=this.r2z*this.ax-this.r2x*this.az,this.t2z=this.r2x*this.ay-this.r2y*this.ax,this.l1x=this.ax*this.m1,this.l1y=this.ay*this.m1,this.l1z=this.az*this.m1,this.l2x=this.ax*this.m2,this.l2y=this.ay*this.m2,this.l2z=this.az*this.m2,this.a1x=this.t1x*this.i1e00+this.t1y*this.i1e01+this.t1z*this.i1e02,this.a1y=this.t1x*this.i1e10+this.t1y*this.i1e11+this.t1z*this.i1e12,this.a1z=this.t1x*this.i1e20+this.t1y*this.i1e21+this.t1z*this.i1e22,this.a2x=this.t2x*this.i2e00+this.t2y*this.i2e01+this.t2z*this.i2e02,this.a2y=this.t2x*this.i2e10+this.t2y*this.i2e11+this.t2z*this.i2e12,this.a2z=this.t2x*this.i2e20+this.t2y*this.i2e21+this.t2z*this.i2e22,this.motorDenom=this.m1+this.m2+this.ax*(this.a1y*this.r1z-this.a1z*this.r1y+this.a2y*this.r2z-this.a2z*this.r2y)+this.ay*(this.a1z*this.r1x-this.a1x*this.r1z+this.a2z*this.r2x-this.a2x*this.r2z)+this.az*(this.a1x*this.r1y-this.a1y*this.r1x+this.a2x*this.r2y-this.a2y*this.r2x),this.invMotorDenom=1/this.motorDenom,d&&2!=this.limitState){var m=6.2831853*c,f=m*m*t,A=e/(f+2*this.limitMotor.dampingRatio*m);this.cfm=this.motorDenom*A,this.limitVelocity*=f*A}else this.cfm=0,this.limitVelocity*=.05*e;this.invDenom=1/(this.motorDenom+this.cfm);var b=this.limitImpulse+this.motorImpulse;this.l1.x+=b*this.l1x,this.l1.y+=b*this.l1y,this.l1.z+=b*this.l1z,this.a1.x+=b*this.a1x,this.a1.y+=b*this.a1y,this.a1.z+=b*this.a1z,this.l2.x-=b*this.l2x,this.l2.y-=b*this.l2y,this.l2.z-=b*this.l2z,this.a2.x-=b*this.a2x,this.a2.y-=b*this.a2y,this.a2.z-=b*this.a2z},solve:function(){var t,e,o=this.ax*(this.l2.x-this.l1.x)+this.ay*(this.l2.y-this.l1.y)+this.az*(this.l2.z-this.l1.z)+this.t2x*this.a2.x-this.t1x*this.a1.x+this.t2y*this.a2.y-this.t1y*this.a1.y+this.t2z*this.a2.z-this.t1z*this.a1.z;if(this.enableMotor){t=(o-this.motorSpeed)*this.invMotorDenom;var i=this.motorImpulse;this.motorImpulse+=t,this.motorImpulse>this.maxMotorImpulse?this.motorImpulse=this.maxMotorImpulse:this.motorImpulse<-this.maxMotorImpulse&&(this.motorImpulse=-this.maxMotorImpulse),o-=(t=this.motorImpulse-i)*this.motorDenom}else t=0;if(2!=this.limitState){e=(o-this.limitVelocity-this.limitImpulse*this.cfm)*this.invDenom;var n=this.limitImpulse;this.limitImpulse+=e,this.limitImpulse*this.limitState<0&&(this.limitImpulse=0),e=this.limitImpulse-n}else e=0;var s=e+t;this.l1.x+=s*this.l1x,this.l1.y+=s*this.l1y,this.l1.z+=s*this.l1z,this.a1.x+=s*this.a1x,this.a1.y+=s*this.a1y,this.a1.z+=s*this.a1z,this.l2.x-=s*this.l2x,this.l2.y-=s*this.l2y,this.l2.z-=s*this.l2z,this.a2.x-=s*this.a2x,this.a2.y-=s*this.a2y,this.a2.z-=s*this.a2z}},OIMO.Contact=function(){this.shape1=null,this.shape2=null,this.body1=null,this.body2=null,this.prev=null,this.next=null,this.persisting=!1,this.sleeping=!1,this.detector=null,this.constraint=null,this.touching=!1,this.b1Link=new OIMO.ContactLink(this),this.b2Link=new OIMO.ContactLink(this),this.s1Link=new OIMO.ContactLink(this),this.s2Link=new OIMO.ContactLink(this),this.manifold=new OIMO.ContactManifold,this.buffer=[],this.buffer.length=4,this.buffer[0]=new OIMO.ImpulseDataBuffer,this.buffer[1]=new OIMO.ImpulseDataBuffer,this.buffer[2]=new OIMO.ImpulseDataBuffer,this.buffer[3]=new OIMO.ImpulseDataBuffer,this.points=this.manifold.points,this.constraint=new OIMO.ContactConstraint(this.manifold)},OIMO.Contact.prototype={constructor:OIMO.Contact,mixRestitution:function(t,e){return Math.sqrt(t*e)},mixFriction:function(t,e){return Math.sqrt(t*e)},updateManifold:function(){this.constraint.restitution=this.mixRestitution(this.shape1.restitution,this.shape2.restitution),this.constraint.friction=this.mixFriction(this.shape1.friction,this.shape2.friction);for(var t=this.manifold.numPoints,e=t;e--;){var o=this.buffer[e],i=this.points[e];o.lp1X=i.localPoint1.x,o.lp1Y=i.localPoint1.y,o.lp1Z=i.localPoint1.z,o.lp2X=i.localPoint2.x,o.lp2Y=i.localPoint2.y,o.lp2Z=i.localPoint2.z,o.impulse=i.normalImpulse}this.manifold.numPoints=0,this.detector.detectCollision(this.shape1,this.shape2,this.manifold);var n=this.manifold.numPoints;if(0!=n)for(this.touching=!0,e=n;e--;){for(var s=(i=this.points[e]).localPoint1.x,a=i.localPoint1.y,r=i.localPoint1.z,c=i.localPoint2.x,d=i.localPoint2.y,p=i.localPoint2.z,l=-1,u=4e-4,y=t;y--;){var g=(o=this.buffer[y]).lp1X-s,m=o.lp1Y-a,f=o.lp1Z-r,A=g*g+m*m+f*f,b=(g=o.lp2X-c)*g+(m=o.lp2Y-d)*m+(f=o.lp2Z-p)*f;A<b?A<u&&(u=A,l=y):b<u&&(u=b,l=y)}if(-1!=l){var v=this.buffer[l];this.buffer[l]=this.buffer[--t],this.buffer[t]=v,i.normalImpulse=v.impulse,i.warmStarted=!0}else i.normalImpulse=0,i.warmStarted=!1}else this.touching=!1},attach:function(t,e){this.shape1=t,this.shape2=e,this.body1=t.parent,this.body2=e.parent,this.manifold.body1=this.body1,this.manifold.body2=this.body2,this.constraint.body1=this.body1,this.constraint.body2=this.body2,this.constraint.attach(),this.s1Link.shape=e,this.s1Link.body=this.body2,this.s2Link.shape=t,this.s2Link.body=this.body1,null!=t.contactLink?(this.s1Link.next=t.contactLink).prev=this.s1Link:this.s1Link.next=null,t.contactLink=this.s1Link,t.numContacts++,null!=e.contactLink?(this.s2Link.next=e.contactLink).prev=this.s2Link:this.s2Link.next=null,e.contactLink=this.s2Link,e.numContacts++,this.b1Link.shape=e,this.b1Link.body=this.body2,this.b2Link.shape=t,this.b2Link.body=this.body1,null!=this.body1.contactLink?(this.b1Link.next=this.body1.contactLink).prev=this.b1Link:this.b1Link.next=null,this.body1.contactLink=this.b1Link,this.body1.numContacts++,null!=this.body2.contactLink?(this.b2Link.next=this.body2.contactLink).prev=this.b2Link:this.b2Link.next=null,this.body2.contactLink=this.b2Link,this.body2.numContacts++,this.prev=null,this.next=null,this.persisting=!0,this.sleeping=this.body1.sleeping&&this.body2.sleeping,this.manifold.numPoints=0},detach:function(){var t=this.s1Link.prev,e=this.s1Link.next;null!==t&&(t.next=e),null!==e&&(e.prev=t),this.shape1.contactLink==this.s1Link&&(this.shape1.contactLink=e),this.s1Link.prev=null,this.s1Link.next=null,this.s1Link.shape=null,this.s1Link.body=null,this.shape1.numContacts--,t=this.s2Link.prev,e=this.s2Link.next,null!==t&&(t.next=e),null!==e&&(e.prev=t),this.shape2.contactLink==this.s2Link&&(this.shape2.contactLink=e),this.s2Link.prev=null,this.s2Link.next=null,this.s2Link.shape=null,this.s2Link.body=null,this.shape2.numContacts--,t=this.b1Link.prev,e=this.b1Link.next,null!==t&&(t.next=e),null!==e&&(e.prev=t),this.body1.contactLink==this.b1Link&&(this.body1.contactLink=e),this.b1Link.prev=null,this.b1Link.next=null,this.b1Link.shape=null,this.b1Link.body=null,this.body1.numContacts--,t=this.b2Link.prev,e=this.b2Link.next,null!==t&&(t.next=e),null!==e&&(e.prev=t),this.body2.contactLink==this.b2Link&&(this.body2.contactLink=e),this.b2Link.prev=null,this.b2Link.next=null,this.b2Link.shape=null,this.b2Link.body=null,this.body2.numContacts--,this.manifold.body1=null,this.manifold.body2=null,this.constraint.body1=null,this.constraint.body2=null,this.constraint.detach(),this.shape1=null,this.shape2=null,this.body1=null,this.body2=null}},OIMO.ContactConstraint=function(t){OIMO.Constraint.call(this),this.manifold=t,this.restitution=NaN,this.friction=NaN,this.p1=null,this.p2=null,this.lv1=null,this.lv2=null,this.av1=null,this.av2=null,this.i1=null,this.i2=null,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.m1=NaN,this.m2=NaN,this.num=0,this.ps=t.points,this.cs=new OIMO.ContactPointDataBuffer,this.cs.next=new OIMO.ContactPointDataBuffer,this.cs.next.next=new OIMO.ContactPointDataBuffer,this.cs.next.next.next=new OIMO.ContactPointDataBuffer},OIMO.ContactConstraint.prototype=Object.create(OIMO.Constraint.prototype),OIMO.ContactConstraint.prototype.attach=function(){this.p1=this.body1.position,this.p2=this.body2.position,this.lv1=this.body1.linearVelocity,this.av1=this.body1.angularVelocity,this.lv2=this.body2.linearVelocity,this.av2=this.body2.angularVelocity,this.i1=this.body1.inverseInertia,this.i2=this.body2.inverseInertia},OIMO.ContactConstraint.prototype.detach=function(){this.p1=null,this.p2=null,this.lv1=null,this.lv2=null,this.av1=null,this.av2=null,this.i1=null,this.i2=null},OIMO.ContactConstraint.prototype.preSolve=function(t,e){this.m1=this.body1.inverseMass,this.m2=this.body2.inverseMass;var o=this.i1.elements,i=this.i2.elements;this.i1e00=o[0],this.i1e01=o[1],this.i1e02=o[2],this.i1e10=o[3],this.i1e11=o[4],this.i1e12=o[5],this.i1e20=o[6],this.i1e21=o[7],this.i1e22=o[8],this.i2e00=i[0],this.i2e01=i[1],this.i2e02=i[2],this.i2e10=i[3],this.i2e11=i[4],this.i2e12=i[5],this.i2e20=i[6],this.i2e21=i[7],this.i2e22=i[8];var n=this.p1.x,s=this.p1.y,a=this.p1.z,r=this.p2.x,c=this.p2.y,d=this.p2.z,p=this.m1+this.m2;this.num=this.manifold.numPoints;for(var l=this.cs,u=0;u<this.num;u++){var y,g,m,f,A,b,v=this.ps[u],x=(y=v.position.x)-n,C=(g=v.position.y)-s,S=(m=v.position.z)-a,T=y-r,B=g-c,O=m-d;l.rp1X=x,l.rp1Y=C,l.rp1Z=S,l.rp2X=T,l.rp2Y=B,l.rp2Z=O,l.norImp=v.normalImpulse,l.tanImp=v.tangentImpulse,l.binImp=v.binormalImpulse;var P=v.normal.x,M=v.normal.y,I=v.normal.z,N=this.lv2.x+this.av2.y*O-this.av2.z*B-(this.lv1.x+this.av1.y*S-this.av1.z*C),z=this.lv2.y+this.av2.z*T-this.av2.x*O-(this.lv1.y+this.av1.z*x-this.av1.x*S),w=this.lv2.z+this.av2.x*B-this.av2.y*T-(this.lv1.z+this.av1.x*C-this.av1.y*x),_=P*N+M*z+I*w,R=N-_*P,L=z-_*M,F=w-_*I,D=R*R+L*L+F*F;.04<D?D=1/Math.sqrt(D):(R=M*P-I*I,L=-I*M-P*P,F=P*I+M*M,D=1/Math.sqrt(R*R+L*L+F*F));var E=M*(F*=D)-I*(L*=D),k=I*(R*=D)-P*F,j=P*L-M*R;l.norX=P,l.norY=M,l.norZ=I,l.tanX=R,l.tanY=L,l.tanZ=F,l.binX=E,l.binY=k,l.binZ=j,l.norU1X=P*this.m1,l.norU1Y=M*this.m1,l.norU1Z=I*this.m1,l.norU2X=P*this.m2,l.norU2Y=M*this.m2,l.norU2Z=I*this.m2,l.tanU1X=R*this.m1,l.tanU1Y=L*this.m1,l.tanU1Z=F*this.m1,l.tanU2X=R*this.m2,l.tanU2Y=L*this.m2,l.tanU2Z=F*this.m2,l.binU1X=E*this.m1,l.binU1Y=k*this.m1,l.binU1Z=j*this.m1,l.binU2X=E*this.m2,l.binU2Y=k*this.m2,l.binU2Z=j*this.m2;var V=C*I-S*M,G=S*P-x*I,W=x*M-C*P,Y=B*I-O*M,U=O*P-T*I,X=T*M-B*P,Z=C*F-S*L,q=S*R-x*F,Q=x*L-C*R,J=B*F-O*L,K=O*R-T*F,$=T*L-B*R,tt=C*j-S*k,et=S*E-x*j,ot=x*k-C*E,it=B*j-O*k,nt=O*E-T*j,st=T*k-B*E,at=V*this.i1e00+G*this.i1e01+W*this.i1e02,rt=V*this.i1e10+G*this.i1e11+W*this.i1e12,ht=V*this.i1e20+G*this.i1e21+W*this.i1e22,ct=Y*this.i2e00+U*this.i2e01+X*this.i2e02,dt=Y*this.i2e10+U*this.i2e11+X*this.i2e12,pt=Y*this.i2e20+U*this.i2e21+X*this.i2e22,lt=Z*this.i1e00+q*this.i1e01+Q*this.i1e02,ut=Z*this.i1e10+q*this.i1e11+Q*this.i1e12,yt=Z*this.i1e20+q*this.i1e21+Q*this.i1e22,gt=J*this.i2e00+K*this.i2e01+$*this.i2e02,mt=J*this.i2e10+K*this.i2e11+$*this.i2e12,ft=J*this.i2e20+K*this.i2e21+$*this.i2e22,At=tt*this.i1e00+et*this.i1e01+ot*this.i1e02,bt=tt*this.i1e10+et*this.i1e11+ot*this.i1e12,vt=tt*this.i1e20+et*this.i1e21+ot*this.i1e22,xt=it*this.i2e00+nt*this.i2e01+st*this.i2e02,Ct=it*this.i2e10+nt*this.i2e11+st*this.i2e12,St=it*this.i2e20+nt*this.i2e21+st*this.i2e22;l.norT1X=V,l.norT1Y=G,l.norT1Z=W,l.tanT1X=Z,l.tanT1Y=q,l.tanT1Z=Q,l.binT1X=tt,l.binT1Y=et,l.binT1Z=ot,l.norT2X=Y,l.norT2Y=U,l.norT2Z=X,l.tanT2X=J,l.tanT2Y=K,l.tanT2Z=$,l.binT2X=it,l.binT2Y=nt,l.binT2Z=st,l.norTU1X=at,l.norTU1Y=rt,l.norTU1Z=ht,l.tanTU1X=lt,l.tanTU1Y=ut,l.tanTU1Z=yt,l.binTU1X=At,l.binTU1Y=bt,l.binTU1Z=vt,l.norTU2X=ct,l.norTU2Y=dt,l.norTU2Z=pt,l.tanTU2X=gt,l.tanTU2Y=mt,l.tanTU2Z=ft,l.binTU2X=xt,l.binTU2Y=Ct,l.binTU2Z=St,y=V*this.i1e00+G*this.i1e01+W*this.i1e02,f=(g=V*this.i1e10+G*this.i1e11+W*this.i1e12)*S-(m=V*this.i1e20+G*this.i1e21+W*this.i1e22)*C,A=m*x-y*S,b=y*C-g*x,y=Y*this.i2e00+U*this.i2e01+X*this.i2e02;var Tt=1/(p+P*(f+=(g=Y*this.i2e10+U*this.i2e11+X*this.i2e12)*O-(m=Y*this.i2e20+U*this.i2e21+X*this.i2e22)*B)+M*(A+=m*T-y*O)+I*(b+=y*B-g*T));y=Z*this.i1e00+q*this.i1e01+Q*this.i1e02,f=(g=Z*this.i1e10+q*this.i1e11+Q*this.i1e12)*S-(m=Z*this.i1e20+q*this.i1e21+Q*this.i1e22)*C,A=m*x-y*S,b=y*C-g*x,y=J*this.i2e00+K*this.i2e01+$*this.i2e02;var Bt=1/(p+R*(f+=(g=J*this.i2e10+K*this.i2e11+$*this.i2e12)*O-(m=J*this.i2e20+K*this.i2e21+$*this.i2e22)*B)+L*(A+=m*T-y*O)+F*(b+=y*B-g*T));y=tt*this.i1e00+et*this.i1e01+ot*this.i1e02,f=(g=tt*this.i1e10+et*this.i1e11+ot*this.i1e12)*S-(m=tt*this.i1e20+et*this.i1e21+ot*this.i1e22)*C,A=m*x-y*S,b=y*C-g*x,y=it*this.i2e00+nt*this.i2e01+st*this.i2e02;var Ot=1/(p+E*(f+=(g=it*this.i2e10+nt*this.i2e11+st*this.i2e12)*O-(m=it*this.i2e20+nt*this.i2e21+st*this.i2e22)*B)+k*(A+=m*T-y*O)+j*(b+=y*B-g*T));if(l.norDen=Tt,l.tanDen=Bt,l.binDen=Ot,v.warmStarted){var Pt=v.normalImpulse;this.lv1.x+=l.norU1X*Pt,this.lv1.y+=l.norU1Y*Pt,this.lv1.z+=l.norU1Z*Pt,this.av1.x+=at*Pt,this.av1.y+=rt*Pt,this.av1.z+=ht*Pt,this.lv2.x-=l.norU2X*Pt,this.lv2.y-=l.norU2Y*Pt,this.lv2.z-=l.norU2Z*Pt,this.av2.x-=ct*Pt,this.av2.y-=dt*Pt,this.av2.z-=pt*Pt,l.norImp=Pt,l.tanImp=0,_=l.binImp=0}else l.norImp=0,l.tanImp=0,l.binImp=0;-1<_&&(_=0);var Mt=this.restitution*-_,It=-(v.penetration+.005)*e*.05;Mt<It&&(Mt=It),l.norTar=Mt,l.last=u==this.num-1,l=l.next}},OIMO.ContactConstraint.prototype.solve=function(){for(var t=this.lv1.x,e=this.lv1.y,o=this.lv1.z,i=this.lv2.x,n=this.lv2.y,s=this.lv2.z,a=this.av1.x,r=this.av1.y,c=this.av1.z,d=this.av2.x,p=this.av2.y,l=this.av2.z,u=this.cs;;){var y,g,m,f,A=u.norImp,b=u.tanImp,v=u.binImp,x=-A*this.friction,C=i-t,S=n-e,T=s-o;y=b,m=v;var B=(b+=g=(C*u.tanX+S*u.tanY+T*u.tanZ+d*u.tanT2X+p*u.tanT2Y+l*u.tanT2Z-a*u.tanT1X-r*u.tanT1Y-c*u.tanT1Z)*u.tanDen)*b+(v+=f=(C*u.binX+S*u.binY+T*u.binZ+d*u.binT2X+p*u.binT2Y+l*u.binT2Z-a*u.binT1X-r*u.binT1Y-c*u.binT1Z)*u.binDen)*v;if(x*x<B&&(b*=B=x/Math.sqrt(B),v*=B),g=b-y,f=v-m,t+=u.tanU1X*g+u.binU1X*f,e+=u.tanU1Y*g+u.binU1Y*f,o+=u.tanU1Z*g+u.binU1Z*f,a+=u.tanTU1X*g+u.binTU1X*f,r+=u.tanTU1Y*g+u.binTU1Y*f,c+=u.tanTU1Z*g+u.binTU1Z*f,i-=u.tanU2X*g+u.binU2X*f,n-=u.tanU2Y*g+u.binU2Y*f,s-=u.tanU2Z*g+u.binU2Z*f,d-=u.tanTU2X*g+u.binTU2X*f,p-=u.tanTU2Y*g+u.binTU2Y*f,l-=u.tanTU2Z*g+u.binTU2Z*f,y=A,0<(A+=g=((i-t)*u.norX+(n-e)*u.norY+(s-o)*u.norZ+d*u.norT2X+p*u.norT2Y+l*u.norT2Z-a*u.norT1X-r*u.norT1Y-c*u.norT1Z-u.norTar)*u.norDen)&&(A=0),g=A-y,t+=u.norU1X*g,e+=u.norU1Y*g,o+=u.norU1Z*g,a+=u.norTU1X*g,r+=u.norTU1Y*g,c+=u.norTU1Z*g,i-=u.norU2X*g,n-=u.norU2Y*g,s-=u.norU2Z*g,d-=u.norTU2X*g,p-=u.norTU2Y*g,l-=u.norTU2Z*g,u.norImp=A,u.tanImp=b,u.binImp=v,u.last)break;u=u.next}this.lv1.x=t,this.lv1.y=e,this.lv1.z=o,this.lv2.x=i,this.lv2.y=n,this.lv2.z=s,this.av1.x=a,this.av1.y=r,this.av1.z=c,this.av2.x=d,this.av2.y=p,this.av2.z=l},OIMO.ContactConstraint.prototype.postSolve=function(){for(var t=this.cs,e=this.num;e--;){var o=this.ps[e];o.normal.x=t.norX,o.normal.y=t.norY,o.normal.z=t.norZ,o.tangent.x=t.tanX,o.tangent.y=t.tanY,o.tangent.z=t.tanZ,o.binormal.x=t.binX,o.binormal.y=t.binY,o.binormal.z=t.binZ,o.normalImpulse=t.norImp,o.tangentImpulse=t.tanImp,o.binormalImpulse=t.binImp,o.normalDenominator=t.norDen,o.tangentDenominator=t.tanDen,o.binormalDenominator=t.binDen,t=t.next}},OIMO.ContactLink=function(t){this.prev=null,this.next=null,this.shape=null,this.body=null,this.contact=t},OIMO.ContactManifold=function(){this.body1=null,this.body2=null,this.numPoints=0,this.points=[],this.points.length=4,this.points[0]=new OIMO.ManifoldPoint,this.points[1]=new OIMO.ManifoldPoint,this.points[2]=new OIMO.ManifoldPoint,this.points[3]=new OIMO.ManifoldPoint},OIMO.ContactManifold.prototype={constructor:OIMO.ContactManifold,reset:function(t,e){this.body1=t.parent,this.body2=e.parent,this.numPoints=0},addPoint:function(t,e,o,i,n,s,a,r){var c=this.points[this.numPoints++];c.position.x=t,c.position.y=e,c.position.z=o;var d=this.body1.rotation,p=t-this.body1.position.x,l=e-this.body1.position.y,u=o-this.body1.position.z,y=d.elements;c.localPoint1.x=p*y[0]+l*y[3]+u*y[6],c.localPoint1.y=p*y[1]+l*y[4]+u*y[7],c.localPoint1.z=p*y[2]+l*y[5]+u*y[8],d=this.body2.rotation,p=t-this.body2.position.x,l=e-this.body2.position.y,u=o-this.body2.position.z,c.localPoint2.x=p*y[0]+l*y[3]+u*y[6],c.localPoint2.y=p*y[1]+l*y[4]+u*y[7],c.localPoint2.z=p*y[2]+l*y[5]+u*y[8],c.normalImpulse=0,r?(c.normal.x=-i,c.normal.y=-n,c.normal.z=-s):(c.normal.x=i,c.normal.y=n,c.normal.z=s),c.penetration=a,c.warmStarted=!1}},OIMO.ContactPointDataBuffer=function(){this.norX=NaN,this.norY=NaN,this.norZ=NaN,this.tanX=NaN,this.tanY=NaN,this.tanZ=NaN,this.binX=NaN,this.binY=NaN,this.binZ=NaN,this.rp1X=NaN,this.rp1Y=NaN,this.rp1Z=NaN,this.rp2X=NaN,this.rp2Y=NaN,this.rp2Z=NaN,this.norU1X=NaN,this.norU1Y=NaN,this.norU1Z=NaN,this.norU2X=NaN,this.norU2Y=NaN,this.norU2Z=NaN,this.tanU1X=NaN,this.tanU1Y=NaN,this.tanU1Z=NaN,this.tanU2X=NaN,this.tanU2Y=NaN,this.tanU2Z=NaN,this.binU1X=NaN,this.binU1Y=NaN,this.binU1Z=NaN,this.binU2X=NaN,this.binU2Y=NaN,this.binU2Z=NaN,this.norT1X=NaN,this.norT1Y=NaN,this.norT1Z=NaN,this.norT2X=NaN,this.norT2Y=NaN,this.norT2Z=NaN,this.tanT1X=NaN,this.tanT1Y=NaN,this.tanT1Z=NaN,this.tanT2X=NaN,this.tanT2Y=NaN,this.tanT2Z=NaN,this.binT1X=NaN,this.binT1Y=NaN,this.binT1Z=NaN,this.binT2X=NaN,this.binT2Y=NaN,this.binT2Z=NaN,this.norTU1X=NaN,this.norTU1Y=NaN,this.norTU1Z=NaN,this.norTU2X=NaN,this.norTU2Y=NaN,this.norTU2Z=NaN,this.tanTU1X=NaN,this.tanTU1Y=NaN,this.tanTU1Z=NaN,this.tanTU2X=NaN,this.tanTU2Y=NaN,this.tanTU2Z=NaN,this.binTU1X=NaN,this.binTU1Y=NaN,this.binTU1Z=NaN,this.binTU2X=NaN,this.binTU2Y=NaN,this.binTU2Z=NaN,this.norImp=NaN,this.tanImp=NaN,this.binImp=NaN,this.norDen=NaN,this.tanDen=NaN,this.binDen=NaN,this.norTar=NaN,this.next=null,this.last=!1},OIMO.ImpulseDataBuffer=function(){this.lp1X=NaN,this.lp1Y=NaN,this.lp1Z=NaN,this.lp2X=NaN,this.lp2Y=NaN,this.lp2Z=NaN,this.impulse=NaN},OIMO.ManifoldPoint=function(){this.warmStarted=!1,this.position=new OIMO.Vec3,this.localPoint1=new OIMO.Vec3,this.localPoint2=new OIMO.Vec3,this.normal=new OIMO.Vec3,this.tangent=new OIMO.Vec3,this.binormal=new OIMO.Vec3,this.normalImpulse=0,this.tangentImpulse=0,this.binormalImpulse=0,this.normalDenominator=0,this.tangentDenominator=0,this.binormalDenominator=0,this.penetration=0},OIMO.MassInfo=function(){this.mass=0,this.inertia=new OIMO.Mat33},OIMO.Shape=function(t){this.id=OIMO.nextID++,this.prev=null,this.next=null,this.type=0,this.proxy=null,this.parent=null,this.contactLink=null,this.numContacts=0,this.position=new OIMO.Vec3,this.rotation=new OIMO.Mat33,this.relativePosition=(new OIMO.Vec3).copy(t.relativePosition),this.relativeRotation=(new OIMO.Mat33).copy(t.relativeRotation),this.aabb=new OIMO.AABB,this.density=t.density,this.friction=t.friction,this.restitution=t.restitution,this.belongsTo=t.belongsTo,this.collidesWith=t.collidesWith},OIMO.Shape.prototype={constructor:OIMO.Shape,calculateMassInfo:function(t){throw new Error("Inheritance error.")},updateProxy:function(){throw new Error("Inheritance error.")}},OIMO.ShapeConfig=function(){this.relativePosition=new OIMO.Vec3,this.relativeRotation=new OIMO.Mat33,this.friction=.4,this.restitution=.2,this.density=1,this.belongsTo=1,this.collidesWith=4294967295},OIMO.BoxShape=function(t,e,o,i){OIMO.Shape.call(this,t),this.width=e,this.height=o,this.depth=i,this.halfWidth=.5*e,this.halfHeight=.5*o,this.halfDepth=.5*i,this.dimentions=new OIMO_ARRAY_TYPE(18),this.elements=new OIMO_ARRAY_TYPE(24),this.type=OIMO.SHAPE_BOX},OIMO.BoxShape.prototype=Object.create(OIMO.Shape.prototype),OIMO.BoxShape.prototype.calculateMassInfo=function(t){var e=this.width*this.height*this.depth*this.density;t.mass=e,t.inertia.init(e*(this.height*this.height+this.depth*this.depth)/12,0,0,0,e*(this.width*this.width+this.depth*this.depth)/12,0,0,0,e*(this.width*this.width+this.height*this.height)/12)},OIMO.BoxShape.prototype.updateProxy=function(){var t=this.rotation.elements,e=this.dimentions;e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e[9]=t[0]*this.halfWidth,e[10]=t[3]*this.halfWidth,e[11]=t[6]*this.halfWidth,e[12]=t[1]*this.halfHeight,e[13]=t[4]*this.halfHeight,e[14]=t[7]*this.halfHeight,e[15]=t[2]*this.halfDepth,e[16]=t[5]*this.halfDepth,e[17]=t[8]*this.halfDepth;var o=e[9],i=e[10],n=e[11],s=e[12],a=e[13],r=e[14],c=e[15],d=e[16],p=e[17],l=this.position.x,u=this.position.y,y=this.position.z,g=this.elements;g[0]=l+o+s+c,g[1]=u+i+a+d,g[2]=y+n+r+p,g[3]=l+o+s-c,g[4]=u+i+a-d,g[5]=y+n+r-p,g[6]=l+o-s+c,g[7]=u+i-a+d,g[8]=y+n-r+p,g[9]=l+o-s-c,g[10]=u+i-a-d,g[11]=y+n-r-p,g[12]=l-o+s+c,g[13]=u-i+a+d,g[14]=y-n+r+p,g[15]=l-o+s-c,g[16]=u-i+a-d,g[17]=y-n+r-p,g[18]=l-o-s+c,g[19]=u-i-a+d,g[20]=y-n-r+p,g[21]=l-o-s-c,g[22]=u-i-a-d,g[23]=y-n-r-p;var m=e[9]<0?-e[9]:e[9],h=e[10]<0?-e[10]:e[10],f=e[11]<0?-e[11]:e[11];m=e[12]<0?m-e[12]:m+e[12],h=e[13]<0?h-e[13]:h+e[13],f=e[14]<0?f-e[14]:f+e[14],m=e[15]<0?m-e[15]:m+e[15],h=e[16]<0?h-e[16]:h+e[16],f=e[17]<0?f-e[17]:f+e[17],this.aabb.init(this.position.x-m-.005,this.position.x+m+.005,this.position.y-h-.005,this.position.y+h+.005,this.position.z-f-.005,this.position.z+f+.005),null!==this.proxy&&this.proxy.update()},OIMO.SphereShape=function(t,e){OIMO.Shape.call(this,t),this.radius=e,this.type=OIMO.SHAPE_SPHERE},OIMO.SphereShape.prototype=Object.create(OIMO.Shape.prototype),OIMO.SphereShape.prototype.calculateMassInfo=function(t){var e=4/3*Math.PI*this.radius*this.radius*this.radius*this.density,o=(t.mass=e)*this.radius*this.radius*2/5;t.inertia.init(o,0,0,0,o,0,0,0,o)},OIMO.SphereShape.prototype.updateProxy=function(){this.aabb.init(this.position.x-this.radius-.005,this.position.x+this.radius+.005,this.position.y-this.radius-.005,this.position.y+this.radius+.005,this.position.z-this.radius-.005,this.position.z+this.radius+.005),null!==this.proxy&&this.proxy.update()},OIMO.CollisionDetector=function(){this.flip=!1},OIMO.CollisionDetector.prototype={constructor:OIMO.CollisionDetector,detectCollision:function(t,e,o){throw new Error("Inheritance error.")}},OIMO.BoxBoxCollisionDetector=function(){OIMO.CollisionDetector.call(this),this.clipVertices1=new OIMO_ARRAY_TYPE(24),this.clipVertices2=new OIMO_ARRAY_TYPE(24),this.used=new OIMO_ARRAY_TYPE(8),this.INF=1/0},OIMO.BoxBoxCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype),OIMO.BoxBoxCollisionDetector.prototype.detectCollision=function(t,e,o){var b1,b2;t.id<e.id?(b1=t,b2=e):(b1=e,b2=t);var i,n,s,a,r,c,d,p,l,u,y,g,m,f,A,b,v,x,C,S,T,B,O,P,M,I,N,z,w,_,R,L,F,D,E,k=b1.elements,j=b2.elements,V=b1.dimentions,G=b2.dimentions,p1=b1.position,p2=b2.position,W=p1.x,Y=p1.y,U=p1.z,X=p2.x,Z=p2.y,q=p2.z,Q=X-W,J=Z-Y,K=q-U,$=b1.halfWidth,tt=b1.halfHeight,et=b1.halfDepth,ot=b2.halfWidth,h2=b2.halfHeight,it=b2.halfDepth,nt=V[0],st=V[1],at=V[2],rt=V[3],ht=V[4],ct=V[5],dt=V[6],pt=V[7],lt=V[8],ut=V[9],yt=V[10],gt=V[11],mt=V[12],ft=V[13],At=V[14],bt=V[15],vt=V[16],xt=V[17],Ct=G[0],St=G[1],Tt=G[2],Bt=G[3],Ot=G[4],Pt=G[5],Mt=G[6],It=G[7],Nt=G[8],zt=G[9],wt=G[10],_t=G[11],Ht=G[12],Rt=G[13],Lt=G[14],Ft=G[15],Dt=G[16],Et=G[17],kt=st*Tt-at*St,jt=at*Ct-nt*Tt,Vt=nt*St-st*Ct,Gt=st*Pt-at*Ot,Wt=at*Bt-nt*Pt,Yt=nt*Ot-st*Bt,Ut=st*Nt-at*It,Xt=at*Mt-nt*Nt,Zt=nt*It-st*Mt,qt=ht*Tt-ct*St,Qt=ct*Ct-rt*Tt,Jt=rt*St-ht*Ct,Kt=ht*Pt-ct*Ot,$t=ct*Bt-rt*Pt,te=rt*Ot-ht*Bt,ee=ht*Nt-ct*It,oe=ct*Mt-rt*Nt,ie=rt*It-ht*Mt,ne=pt*Tt-lt*St,se=lt*Ct-dt*Tt,ae=dt*St-pt*Ct,re=pt*Pt-lt*Ot,he=lt*Bt-dt*Pt,ce=dt*Ot-pt*Bt,de=pt*Nt-lt*It,pe=lt*Mt-dt*Nt,le=dt*It-pt*Mt,ue=!1,ye=!1,ge=!1,me=!1,fe=!1,Ae=!1,be=!1,ve=!1,xe=!1;if((i=0<(R=nt*Q+st*J+at*K))||(R=-R),(F=nt*Ct+st*St+at*Tt)<0&&(F=-F),(D=nt*Bt+st*Ot+at*Pt)<0&&(D=-D),(E=nt*Mt+st*It+at*Nt)<0&&(E=-E),!(0<(b=R-(L=$)-(F*ot+D*h2+E*it))||((n=0<(R=rt*Q+ht*J+ct*K))||(R=-R),(F=rt*Ct+ht*St+ct*Tt)<0&&(F=-F),(D=rt*Bt+ht*Ot+ct*Pt)<0&&(D=-D),(E=rt*Mt+ht*It+ct*Nt)<0&&(E=-E),0<(v=R-(L=tt)-(F*ot+D*h2+E*it))||((s=0<(R=dt*Q+pt*J+lt*K))||(R=-R),(F=dt*Ct+pt*St+lt*Tt)<0&&(F=-F),(D=dt*Bt+pt*Ot+lt*Pt)<0&&(D=-D),(E=dt*Mt+pt*It+lt*Nt)<0&&(E=-E),0<(x=R-(L=et)-(F*ot+D*h2+E*it))||((a=0<(R=Ct*Q+St*J+Tt*K))||(R=-R),(F=Ct*nt+St*st+Tt*at)<0&&(F=-F),(D=Ct*rt+St*ht+Tt*ct)<0&&(D=-D),(E=Ct*dt+St*pt+Tt*lt)<0&&(E=-E),0<(C=1*(R-(L=F*$+D*tt+E*et)-ot))||((r=0<(R=Bt*Q+Ot*J+Pt*K))||(R=-R),(F=Bt*nt+Ot*st+Pt*at)<0&&(F=-F),(D=Bt*rt+Ot*ht+Pt*ct)<0&&(D=-D),(E=Bt*dt+Ot*pt+Pt*lt)<0&&(E=-E),0<(S=1*(R-(L=F*$+D*tt+E*et)-h2))||((c=0<(R=Mt*Q+It*J+Nt*K))||(R=-R),(F=Mt*nt+It*st+Nt*at)<0&&(F=-F),(D=Mt*rt+It*ht+Nt*ct)<0&&(D=-D),(E=Mt*dt+It*pt+Nt*lt)<0&&(E=-E),0<(T=1*(R-(L=F*$+D*tt+E*et)-it))))))))){if(1e-5<(R=kt*kt+jt*jt+Vt*Vt)){if((d=0<(R=(kt*=R=1/Math.sqrt(R))*Q+(jt*=R)*J+(Vt*=R)*K))||(R=-R),(F=kt*rt+jt*ht+Vt*ct)<0&&(F=-F),(D=kt*dt+jt*pt+Vt*lt)<0&&(D=-D),L=F*tt+D*et,(F=kt*Bt+jt*Ot+Vt*Pt)<0&&(F=-F),(D=kt*Mt+jt*It+Vt*Nt)<0&&(D=-D),0<(B=R-L-(F*h2+D*it)))return}else d=!1,ue=!(B=0);if(1e-5<(R=Gt*Gt+Wt*Wt+Yt*Yt)){if((p=0<(R=(Gt*=R=1/Math.sqrt(R))*Q+(Wt*=R)*J+(Yt*=R)*K))||(R=-R),(F=Gt*rt+Wt*ht+Yt*ct)<0&&(F=-F),(D=Gt*dt+Wt*pt+Yt*lt)<0&&(D=-D),L=F*tt+D*et,(F=Gt*Ct+Wt*St+Yt*Tt)<0&&(F=-F),(D=Gt*Mt+Wt*It+Yt*Nt)<0&&(D=-D),0<(O=R-L-(F*ot+D*it)))return}else p=!1,ye=!(O=0);if(1e-5<(R=Ut*Ut+Xt*Xt+Zt*Zt)){if((l=0<(R=(Ut*=R=1/Math.sqrt(R))*Q+(Xt*=R)*J+(Zt*=R)*K))||(R=-R),(F=Ut*rt+Xt*ht+Zt*ct)<0&&(F=-F),(D=Ut*dt+Xt*pt+Zt*lt)<0&&(D=-D),L=F*tt+D*et,(F=Ut*Ct+Xt*St+Zt*Tt)<0&&(F=-F),(D=Ut*Bt+Xt*Ot+Zt*Pt)<0&&(D=-D),0<(P=R-L-(F*ot+D*h2)))return}else l=!1,ge=!(P=0);if(1e-5<(R=qt*qt+Qt*Qt+Jt*Jt)){if((u=0<(R=(qt*=R=1/Math.sqrt(R))*Q+(Qt*=R)*J+(Jt*=R)*K))||(R=-R),(F=qt*nt+Qt*st+Jt*at)<0&&(F=-F),(D=qt*dt+Qt*pt+Jt*lt)<0&&(D=-D),L=F*$+D*et,(F=qt*Bt+Qt*Ot+Jt*Pt)<0&&(F=-F),(D=qt*Mt+Qt*It+Jt*Nt)<0&&(D=-D),0<(M=R-L-(F*h2+D*it)))return}else u=!1,me=!(M=0);if(1e-5<(R=Kt*Kt+$t*$t+te*te)){if((y=0<(R=(Kt*=R=1/Math.sqrt(R))*Q+($t*=R)*J+(te*=R)*K))||(R=-R),(F=Kt*nt+$t*st+te*at)<0&&(F=-F),(D=Kt*dt+$t*pt+te*lt)<0&&(D=-D),L=F*$+D*et,(F=Kt*Ct+$t*St+te*Tt)<0&&(F=-F),(D=Kt*Mt+$t*It+te*Nt)<0&&(D=-D),0<(I=R-L-(F*ot+D*it)))return}else y=!1,fe=!(I=0);if(1e-5<(R=ee*ee+oe*oe+ie*ie)){if((g=0<(R=(ee*=R=1/Math.sqrt(R))*Q+(oe*=R)*J+(ie*=R)*K))||(R=-R),(F=ee*nt+oe*st+ie*at)<0&&(F=-F),(D=ee*dt+oe*pt+ie*lt)<0&&(D=-D),L=F*$+D*et,(F=ee*Ct+oe*St+ie*Tt)<0&&(F=-F),(D=ee*Bt+oe*Ot+ie*Pt)<0&&(D=-D),0<(N=R-L-(F*ot+D*h2)))return}else g=!1,Ae=!(N=0);if(1e-5<(R=ne*ne+se*se+ae*ae)){if((m=0<(R=(ne*=R=1/Math.sqrt(R))*Q+(se*=R)*J+(ae*=R)*K))||(R=-R),(F=ne*nt+se*st+ae*at)<0&&(F=-F),(D=ne*rt+se*ht+ae*ct)<0&&(D=-D),L=F*$+D*tt,(F=ne*Bt+se*Ot+ae*Pt)<0&&(F=-F),(D=ne*Mt+se*It+ae*Nt)<0&&(D=-D),0<(z=R-L-(F*h2+D*it)))return}else m=!1,be=!(z=0);if(1e-5<(R=re*re+he*he+ce*ce)){if((f=0<(R=(re*=R=1/Math.sqrt(R))*Q+(he*=R)*J+(ce*=R)*K))||(R=-R),(F=re*nt+he*st+ce*at)<0&&(F=-F),(D=re*rt+he*ht+ce*ct)<0&&(D=-D),L=F*$+D*tt,(F=re*Ct+he*St+ce*Tt)<0&&(F=-F),(D=re*Mt+he*It+ce*Nt)<0&&(D=-D),0<(w=R-L-(F*ot+D*it)))return}else f=!1,ve=!(w=0);if(1e-5<(R=de*de+pe*pe+le*le)){if((A=0<(R=(de*=R=1/Math.sqrt(R))*Q+(pe*=R)*J+(le*=R)*K))||(R=-R),(F=de*nt+pe*st+le*at)<0&&(F=-F),(D=de*rt+pe*ht+le*ct)<0&&(D=-D),L=F*$+D*tt,(F=de*Ct+pe*St+le*Tt)<0&&(F=-F),(D=de*Bt+pe*Ot+le*Pt)<0&&(D=-D),0<(_=R-L-(F*ot+D*h2)))return}else A=!1,xe=!(_=0);var Ce=b,Se=b,Te=0,Be=i;Se<v&&(Se=Ce=v,Te=1,Be=n),Se<x&&(Se=Ce=x,Te=2,Be=s),Se<C&&(Se=Ce=C,Te=3,Be=a),Se<S&&(Se=Ce=S,Te=4,Be=r),Se<T&&(Se=Ce=T,Te=5,Be=c),Se<B-.01&&!ue&&(Se=(Ce=B)-.01,Te=6,Be=d),Se<O-.01&&!ye&&(Se=(Ce=O)-.01,Te=7,Be=p),Se<P-.01&&!ge&&(Se=(Ce=P)-.01,Te=8,Be=l),Se<M-.01&&!me&&(Se=(Ce=M)-.01,Te=9,Be=u),Se<I-.01&&!fe&&(Se=(Ce=I)-.01,Te=10,Be=y),Se<N-.01&&!Ae&&(Se=(Ce=N)-.01,Te=11,Be=g),Se<z-.01&&!be&&(Se=(Ce=z)-.01,Te=12,Be=m),Se<w-.01&&!ve&&(Se=(Ce=w)-.01,Te=13,Be=f),Se<_-.01&&!xe&&(Ce=_,Te=14,Be=A);var Oe=0,Pe=0,Me=0,Ie=0,Ne=0,ze=0,we=0,_e=0,He=0,Re=0,Le=0,Fe=0,De=0,Ee=0,ke=0,je=0,Ve=0,Ge=0,We=!1;if(0==Te?(Be?(Re=W+ut,Le=Y+yt,Fe=U+gt,Oe=nt,Pe=st,Me=at):(Re=W-ut,Le=Y-yt,Fe=U-gt,Oe=-nt,Pe=-st,Me=-at),De=mt,Ee=ft,ke=At,Ie=-rt,Ne=-ht,ze=-ct,je=bt,Ve=vt,Ge=xt,we=-dt,_e=-pt,He=-lt):1==Te?(Be?(Re=W+mt,Le=Y+ft,Fe=U+At,Oe=rt,Pe=ht,Me=ct):(Re=W-mt,Le=Y-ft,Fe=U-At,Oe=-rt,Pe=-ht,Me=-ct),De=ut,Ee=yt,ke=gt,Ie=-nt,Ne=-st,ze=-at,je=bt,Ve=vt,Ge=xt,we=-dt,_e=-pt,He=-lt):2==Te?(Be?(Re=W+bt,Le=Y+vt,Fe=U+xt,Oe=dt,Pe=pt,Me=lt):(Re=W-bt,Le=Y-vt,Fe=U-xt,Oe=-dt,Pe=-pt,Me=-lt),De=ut,Ee=yt,ke=gt,Ie=-nt,Ne=-st,ze=-at,je=mt,Ve=ft,Ge=At,we=-rt,_e=-ht,He=-ct):3==Te?(We=!0,Be?(Re=X-zt,Le=Z-wt,Fe=q-_t,Oe=-Ct,Pe=-St,Me=-Tt):(Re=X+zt,Le=Z+wt,Fe=q+_t,Oe=Ct,Pe=St,Me=Tt),De=Ht,Ee=Rt,ke=Lt,Ie=-Bt,Ne=-Ot,ze=-Pt,je=Ft,Ve=Dt,Ge=Et,we=-Mt,_e=-It,He=-Nt):4==Te?(We=!0,Be?(Re=X-Ht,Le=Z-Rt,Fe=q-Lt,Oe=-Bt,Pe=-Ot,Me=-Pt):(Re=X+Ht,Le=Z+Rt,Fe=q+Lt,Oe=Bt,Pe=Ot,Me=Pt),De=zt,Ee=wt,ke=_t,Ie=-Ct,Ne=-St,ze=-Tt,je=Ft,Ve=Dt,Ge=Et,we=-Mt,_e=-It,He=-Nt):5==Te?(We=!0,Be?(Re=X-Ft,Le=Z-Dt,Fe=q-Et,Oe=-Mt,Pe=-It,Me=-Nt):(Re=X+Ft,Le=Z+Dt,Fe=q+Et,Oe=Mt,Pe=It,Me=Nt),De=zt,Ee=wt,ke=_t,Ie=-Ct,Ne=-St,ze=-Tt,je=Ht,Ve=Rt,Ge=Lt,we=-Bt,_e=-Ot,He=-Pt):6==Te?(Oe=kt,Pe=jt,Me=Vt,Ie=nt,Ne=st,ze=at,we=Ct,_e=St,He=Tt):7==Te?(Oe=Gt,Pe=Wt,Me=Yt,Ie=nt,Ne=st,ze=at,we=Bt,_e=Ot,He=Pt):8==Te?(Oe=Ut,Pe=Xt,Me=Zt,Ie=nt,Ne=st,ze=at,we=Mt,_e=It,He=Nt):9==Te?(Oe=qt,Pe=Qt,Me=Jt,Ie=rt,Ne=ht,ze=ct,we=Ct,_e=St,He=Tt):10==Te?(Oe=Kt,Pe=$t,Me=te,Ie=rt,Ne=ht,ze=ct,we=Bt,_e=Ot,He=Pt):11==Te?(Oe=ee,Pe=oe,Me=ie,Ie=rt,Ne=ht,ze=ct,we=Mt,_e=It,He=Nt):12==Te?(Oe=ne,Pe=se,Me=ae,Ie=dt,Ne=pt,ze=lt,we=Ct,_e=St,He=Tt):13==Te?(Oe=re,Pe=he,Me=ce,Ie=dt,Ne=pt,ze=lt,we=Bt,_e=Ot,He=Pt):14==Te&&(Oe=de,Pe=pe,Me=le,Ie=dt,Ne=pt,ze=lt,we=Mt,_e=It,He=Nt),5<Te){var Ye,Ue,Xe,Ze,qe,Qe,Je,Ke,$e,to,eo;Be||(Oe=-Oe,Pe=-Pe,Me=-Me),(Ue=Oe*(Qe=k[0])+Pe*(Je=k[1])+Me*(Ke=k[2]))<(Ye=Oe*(Xe=k[3])+Pe*(Ze=k[4])+Me*(qe=k[5]))&&(Ue=Ye,Qe=Xe,Je=Ze,Ke=qe),Ue<(Ye=Oe*(Xe=k[6])+Pe*(Ze=k[7])+Me*(qe=k[8]))&&(Ue=Ye,Qe=Xe,Je=Ze,Ke=qe),Ue<(Ye=Oe*(Xe=k[9])+Pe*(Ze=k[10])+Me*(qe=k[11]))&&(Ue=Ye,Qe=Xe,Je=Ze,Ke=qe),Ue<(Ye=Oe*(Xe=k[12])+Pe*(Ze=k[13])+Me*(qe=k[14]))&&(Ue=Ye,Qe=Xe,Je=Ze,Ke=qe),Ue<(Ye=Oe*(Xe=k[15])+Pe*(Ze=k[16])+Me*(qe=k[17]))&&(Ue=Ye,Qe=Xe,Je=Ze,Ke=qe),Ue<(Ye=Oe*(Xe=k[18])+Pe*(Ze=k[19])+Me*(qe=k[20]))&&(Ue=Ye,Qe=Xe,Je=Ze,Ke=qe),Ue<(Ye=Oe*(Xe=k[21])+Pe*(Ze=k[22])+Me*(qe=k[23]))&&(Ue=Ye,Qe=Xe,Je=Ze,Ke=qe),Ue=Oe*($e=j[0])+Pe*(to=j[1])+Me*(eo=j[2]),(Ye=Oe*(Xe=j[3])+Pe*(Ze=j[4])+Me*(qe=j[5]))<Ue&&(Ue=Ye,$e=Xe,to=Ze,eo=qe),(Ye=Oe*(Xe=j[6])+Pe*(Ze=j[7])+Me*(qe=j[8]))<Ue&&(Ue=Ye,$e=Xe,to=Ze,eo=qe),(Ye=Oe*(Xe=j[9])+Pe*(Ze=j[10])+Me*(qe=j[11]))<Ue&&(Ue=Ye,$e=Xe,to=Ze,eo=qe),(Ye=Oe*(Xe=j[12])+Pe*(Ze=j[13])+Me*(qe=j[14]))<Ue&&(Ue=Ye,$e=Xe,to=Ze,eo=qe),(Ye=Oe*(Xe=j[15])+Pe*(Ze=j[16])+Me*(qe=j[17]))<Ue&&(Ue=Ye,$e=Xe,to=Ze,eo=qe),(Ye=Oe*(Xe=j[18])+Pe*(Ze=j[19])+Me*(qe=j[20]))<Ue&&(Ue=Ye,$e=Xe,to=Ze,eo=qe),(Ye=Oe*(Xe=j[21])+Pe*(Ze=j[22])+Me*(qe=j[23]))<Ue&&(Ue=Ye,$e=Xe,to=Ze,eo=qe);var oo=((Xe=$e-Qe)*(Ie-we*(F=Ie*we+Ne*_e+ze*He))+(Ze=to-Je)*(Ne-_e*F)+(qe=eo-Ke)*(ze-He*F))/(1-F*F);o.addPoint(Qe+Ie*oo+Oe*Ce*.5,Je+Ne*oo+Pe*Ce*.5,Ke+ze*oo+Me*Ce*.5,Oe,Pe,Me,Ce,!1)}else{var io,no,so,ao,ro,ho,co,po,lo,uo,yo,go,mo,fo,Ao,bo,vo,xo,Co,So,To,Bo=1,Oo=0,Po=0;We?((Oo=nt*Oe+st*Pe+at*Me)<Bo&&(Bo=Oo,Po=0),-Oo<Bo&&(Bo=-Oo,Po=1),(Oo=rt*Oe+ht*Pe+ct*Me)<Bo&&(Bo=Oo,Po=2),-Oo<Bo&&(Bo=-Oo,Po=3),(Oo=dt*Oe+pt*Pe+lt*Me)<Bo&&(Bo=Oo,Po=4),-Oo<Bo&&(Bo=-Oo,Po=5),0==Po?(io=k[0],no=k[1],so=k[2],ao=k[6],ro=k[7],ho=k[8],co=k[9],po=k[10],lo=k[11],uo=k[3],yo=k[4],go=k[5]):1==Po?(io=k[15],no=k[16],so=k[17],ao=k[21],ro=k[22],ho=k[23],co=k[18],po=k[19],lo=k[20],uo=k[12],yo=k[13],go=k[14]):2==Po?(io=k[12],no=k[13],so=k[14],ao=k[0],ro=k[1],ho=k[2],co=k[3],po=k[4],lo=k[5],uo=k[15],yo=k[16],go=k[17]):3==Po?(io=k[21],no=k[22],so=k[23],ao=k[9],ro=k[10],ho=k[11],co=k[6],po=k[7],lo=k[8],uo=k[18],yo=k[19],go=k[20]):4==Po?(io=k[12],no=k[13],so=k[14],ao=k[18],ro=k[19],ho=k[20],co=k[6],po=k[7],lo=k[8],uo=k[0],yo=k[1],go=k[2]):5==Po&&(io=k[3],no=k[4],so=k[5],ao=k[6],ro=k[7],ho=k[8],co=k[21],po=k[22],lo=k[23],uo=k[15],yo=k[16],go=k[17])):((Oo=Ct*Oe+St*Pe+Tt*Me)<Bo&&(Bo=Oo,Po=0),-Oo<Bo&&(Bo=-Oo,Po=1),(Oo=Bt*Oe+Ot*Pe+Pt*Me)<Bo&&(Bo=Oo,Po=2),-Oo<Bo&&(Bo=-Oo,Po=3),(Oo=Mt*Oe+It*Pe+Nt*Me)<Bo&&(Bo=Oo,Po=4),-Oo<Bo&&(Bo=-Oo,Po=5),0==Po?(io=j[0],no=j[1],so=j[2],ao=j[6],ro=j[7],ho=j[8],co=j[9],po=j[10],lo=j[11],uo=j[3],yo=j[4],go=j[5]):1==Po?(io=j[15],no=j[16],so=j[17],ao=j[21],ro=j[22],ho=j[23],co=j[18],po=j[19],lo=j[20],uo=j[12],yo=j[13],go=j[14]):2==Po?(io=j[12],no=j[13],so=j[14],ao=j[0],ro=j[1],ho=j[2],co=j[3],po=j[4],lo=j[5],uo=j[15],yo=j[16],go=j[17]):3==Po?(io=j[21],no=j[22],so=j[23],ao=j[9],ro=j[10],ho=j[11],co=j[6],po=j[7],lo=j[8],uo=j[18],yo=j[19],go=j[20]):4==Po?(io=j[12],no=j[13],so=j[14],ao=j[18],ro=j[19],ho=j[20],co=j[6],po=j[7],lo=j[8],uo=j[0],yo=j[1],go=j[2]):5==Po&&(io=j[3],no=j[4],so=j[5],ao=j[9],ro=j[10],ho=j[11],co=j[21],po=j[22],lo=j[23],uo=j[15],yo=j[16],go=j[17])),this.clipVertices1[0]=io,this.clipVertices1[1]=no,this.clipVertices1[2]=so,this.clipVertices1[3]=ao,this.clipVertices1[4]=ro,this.clipVertices1[5]=ho,this.clipVertices1[6]=co,this.clipVertices1[7]=po,this.clipVertices1[8]=lo,this.clipVertices1[9]=uo,this.clipVertices1[10]=yo,this.clipVertices1[11]=go,fo=0,F=((bo=this.clipVertices1[9])-Re-De)*Ie+((vo=this.clipVertices1[10])-Le-Ee)*Ne+((xo=this.clipVertices1[11])-Fe-ke)*ze;for(var Mo=0;Mo<4;Mo++)Ao=3*Mo,D=((Co=this.clipVertices1[Ao])-Re-De)*Ie+((So=this.clipVertices1[Ao+1])-Le-Ee)*Ne+((To=this.clipVertices1[Ao+2])-Fe-ke)*ze,0<F?0<D?(Ao=3*fo,fo++,this.clipVertices2[Ao]=Co,this.clipVertices2[Ao+1]=So,this.clipVertices2[Ao+2]=To):(Ao=3*fo,fo++,oo=F/(F-D),this.clipVertices2[Ao]=bo+(Co-bo)*oo,this.clipVertices2[Ao+1]=vo+(So-vo)*oo,this.clipVertices2[Ao+2]=xo+(To-xo)*oo):0<D&&(Ao=3*fo,fo++,oo=F/(F-D),this.clipVertices2[Ao]=bo+(Co-bo)*oo,this.clipVertices2[Ao+1]=vo+(So-vo)*oo,this.clipVertices2[Ao+2]=xo+(To-xo)*oo,Ao=3*fo,fo++,this.clipVertices2[Ao]=Co,this.clipVertices2[Ao+1]=So,this.clipVertices2[Ao+2]=To),bo=Co,vo=So,xo=To,F=D;if(0!=(mo=fo)){for(fo=0,Ao=3*(mo-1),F=((bo=this.clipVertices2[Ao])-Re-je)*we+((vo=this.clipVertices2[Ao+1])-Le-Ve)*_e+((xo=this.clipVertices2[Ao+2])-Fe-Ge)*He,Mo=0;Mo<mo;Mo++)Ao=3*Mo,D=((Co=this.clipVertices2[Ao])-Re-je)*we+((So=this.clipVertices2[Ao+1])-Le-Ve)*_e+((To=this.clipVertices2[Ao+2])-Fe-Ge)*He,0<F?0<D?(Ao=3*fo,fo++,this.clipVertices1[Ao]=Co,this.clipVertices1[Ao+1]=So,this.clipVertices1[Ao+2]=To):(Ao=3*fo,fo++,oo=F/(F-D),this.clipVertices1[Ao]=bo+(Co-bo)*oo,this.clipVertices1[Ao+1]=vo+(So-vo)*oo,this.clipVertices1[Ao+2]=xo+(To-xo)*oo):0<D&&(Ao=3*fo,fo++,oo=F/(F-D),this.clipVertices1[Ao]=bo+(Co-bo)*oo,this.clipVertices1[Ao+1]=vo+(So-vo)*oo,this.clipVertices1[Ao+2]=xo+(To-xo)*oo,Ao=3*fo,fo++,this.clipVertices1[Ao]=Co,this.clipVertices1[Ao+1]=So,this.clipVertices1[Ao+2]=To),bo=Co,vo=So,xo=To,F=D;if(0!=(mo=fo)){for(fo=0,Ao=3*(mo-1),F=((bo=this.clipVertices1[Ao])-Re+De)*-Ie+((vo=this.clipVertices1[Ao+1])-Le+Ee)*-Ne+((xo=this.clipVertices1[Ao+2])-Fe+ke)*-ze,Mo=0;Mo<mo;Mo++)Ao=3*Mo,D=((Co=this.clipVertices1[Ao])-Re+De)*-Ie+((So=this.clipVertices1[Ao+1])-Le+Ee)*-Ne+((To=this.clipVertices1[Ao+2])-Fe+ke)*-ze,0<F?0<D?(Ao=3*fo,fo++,this.clipVertices2[Ao]=Co,this.clipVertices2[Ao+1]=So,this.clipVertices2[Ao+2]=To):(Ao=3*fo,fo++,oo=F/(F-D),this.clipVertices2[Ao]=bo+(Co-bo)*oo,this.clipVertices2[Ao+1]=vo+(So-vo)*oo,this.clipVertices2[Ao+2]=xo+(To-xo)*oo):0<D&&(Ao=3*fo,fo++,oo=F/(F-D),this.clipVertices2[Ao]=bo+(Co-bo)*oo,this.clipVertices2[Ao+1]=vo+(So-vo)*oo,this.clipVertices2[Ao+2]=xo+(To-xo)*oo,Ao=3*fo,fo++,this.clipVertices2[Ao]=Co,this.clipVertices2[Ao+1]=So,this.clipVertices2[Ao+2]=To),bo=Co,vo=So,xo=To,F=D;if(0!=(mo=fo)){for(fo=0,Ao=3*(mo-1),F=((bo=this.clipVertices2[Ao])-Re+je)*-we+((vo=this.clipVertices2[Ao+1])-Le+Ve)*-_e+((xo=this.clipVertices2[Ao+2])-Fe+Ge)*-He,Mo=0;Mo<mo;Mo++)Ao=3*Mo,D=((Co=this.clipVertices2[Ao])-Re+je)*-we+((So=this.clipVertices2[Ao+1])-Le+Ve)*-_e+((To=this.clipVertices2[Ao+2])-Fe+Ge)*-He,0<F?0<D?(Ao=3*fo,fo++,this.clipVertices1[Ao]=Co,this.clipVertices1[Ao+1]=So,this.clipVertices1[Ao+2]=To):(Ao=3*fo,fo++,oo=F/(F-D),this.clipVertices1[Ao]=bo+(Co-bo)*oo,this.clipVertices1[Ao+1]=vo+(So-vo)*oo,this.clipVertices1[Ao+2]=xo+(To-xo)*oo):0<D&&(Ao=3*fo,fo++,oo=F/(F-D),this.clipVertices1[Ao]=bo+(Co-bo)*oo,this.clipVertices1[Ao+1]=vo+(So-vo)*oo,this.clipVertices1[Ao+2]=xo+(To-xo)*oo,Ao=3*fo,fo++,this.clipVertices1[Ao]=Co,this.clipVertices1[Ao+1]=So,this.clipVertices1[Ao+2]=To),bo=Co,vo=So,xo=To,F=D;if(We){var Io=b1;b1=b2,b2=Io}if(0!=(mo=fo)){var No=b1!=t;if(4<mo){Ie=io-(bo=.25*(io+ao+co+uo)),Ne=no-(vo=.25*(no+ro+po+yo)),ze=so-(xo=.25*(so+ho+lo+go)),we=ao-bo,_e=ro-vo,He=ho-xo;var zo=0,wo=0,_o=0,Ho=0,Ro=-this.INF;for(Bo=this.INF,Mo=0;Mo<mo;Mo++)this.used[Mo]=!1,Ao=3*Mo,(Oo=(bo=this.clipVertices1[Ao])*Ie+(vo=this.clipVertices1[Ao+1])*Ne+(xo=this.clipVertices1[Ao+2])*ze)<Bo&&(Bo=Oo,zo=Mo),Ro<Oo&&(Ro=Oo,_o=Mo);for(this.used[zo]=!0,this.used[_o]=!0,Ro=-this.INF,Bo=this.INF,Mo=0;Mo<mo;Mo++)this.used[Mo]||(Ao=3*Mo,(Oo=(bo=this.clipVertices1[Ao])*we+(vo=this.clipVertices1[Ao+1])*_e+(xo=this.clipVertices1[Ao+2])*He)<Bo&&(Bo=Oo,wo=Mo),Ro<Oo&&(Ro=Oo,Ho=Mo));Ao=3*zo,(Oo=((bo=this.clipVertices1[Ao])-Re)*Oe+((vo=this.clipVertices1[Ao+1])-Le)*Pe+((xo=this.clipVertices1[Ao+2])-Fe)*Me)<0&&o.addPoint(bo,vo,xo,Oe,Pe,Me,Oo,No),Ao=3*wo,(Oo=((bo=this.clipVertices1[Ao])-Re)*Oe+((vo=this.clipVertices1[Ao+1])-Le)*Pe+((xo=this.clipVertices1[Ao+2])-Fe)*Me)<0&&o.addPoint(bo,vo,xo,Oe,Pe,Me,Oo,No),Ao=3*_o,(Oo=((bo=this.clipVertices1[Ao])-Re)*Oe+((vo=this.clipVertices1[Ao+1])-Le)*Pe+((xo=this.clipVertices1[Ao+2])-Fe)*Me)<0&&o.addPoint(bo,vo,xo,Oe,Pe,Me,Oo,No),Ao=3*Ho,(Oo=((bo=this.clipVertices1[Ao])-Re)*Oe+((vo=this.clipVertices1[Ao+1])-Le)*Pe+((xo=this.clipVertices1[Ao+2])-Fe)*Me)<0&&o.addPoint(bo,vo,xo,Oe,Pe,Me,Oo,No)}else for(Mo=0;Mo<mo;Mo++)Ao=3*Mo,(Oo=((bo=this.clipVertices1[Ao])-Re)*Oe+((vo=this.clipVertices1[Ao+1])-Le)*Pe+((xo=this.clipVertices1[Ao+2])-Fe)*Me)<0&&o.addPoint(bo,vo,xo,Oe,Pe,Me,Oo,No)}}}}}}},OIMO.SphereBoxCollisionDetector=function(t){OIMO.CollisionDetector.call(this),this.flip=t},OIMO.SphereBoxCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype),OIMO.SphereBoxCollisionDetector.prototype.detectCollision=function(t,e,o){var i,n;this.flip?(i=e,n=t):(i=t,n=e);var s,a,r,c,d,p=n.dimentions,l=i.position,u=l.x,y=l.y,g=l.z,m=n.position,f=m.x,A=m.y,b=m.z,v=i.radius,x=n.halfWidth,C=n.halfHeight,S=n.halfDepth,T=u-f,B=y-A,O=g-b,P=p[0]*T+p[1]*B+p[2]*O,M=p[3]*T+p[4]*B+p[5]*O,I=p[6]*T+p[7]*B+p[8]*O,N=0;x<P?P=x:P<-x?P=-x:N=1,C<M?M=C:M<-C?M=-C:N|=2,S<I?I=S:I<-S?I=-S:N|=4,7==N?(O=I<0?S+I:S-I,(T=P<0?x+P:x-P)<(B=M<0?C+M:C-M)?T<O?(c=T-x,P<0?(P=-x,T=p[0],B=p[1],O=p[2]):(P=x,T=-p[0],B=-p[1],O=-p[2])):(c=O-S,I<0?(I=-S,T=p[6],B=p[7],O=p[8]):(I=S,T=-p[6],B=-p[7],O=-p[8])):B<O?(c=B-C,M<0?(M=-C,T=p[3],B=p[4],O=p[5]):(M=C,T=-p[3],B=-p[4],O=-p[5])):(c=O-S,I<0?(I=-S,T=p[6],B=p[7],O=p[8]):(I=S,T=-p[6],B=-p[7],O=-p[8])),s=f+P*p[0]+M*p[3]+I*p[6],a=A+P*p[1]+M*p[4]+I*p[7],r=b+P*p[2]+M*p[5]+I*p[8],i.hitListeners&&(this.flip?OIMO.notifyHitListeners(i.hitListeners,u+v*T,y+v*B,g+v*O,-T,-B,-O,c-v,n,null):OIMO.notifyHitListeners(i.hitListeners,u+v*T,y+v*B,g+v*O,T,B,O,c-v,n,null)),o.addPoint(u+v*T,y+v*B,g+v*O,T,B,O,c-v,this.flip)):(s=f+P*p[0]+M*p[3]+I*p[6],a=A+P*p[1]+M*p[4]+I*p[7],r=b+P*p[2]+M*p[5]+I*p[8],0<(c=(T=s-l.x)*T+(B=a-l.y)*B+(O=r-l.z)*O)&&c<v*v&&(T*=d=1/(c=Math.sqrt(c)),B*=d,O*=d,i.hitListeners&&(this.flip?OIMO.notifyHitListeners(i.hitListeners,u+v*T,y+v*B,g+v*O,-T,-B,-O,c-v,n,null):OIMO.notifyHitListeners(i.hitListeners,u+v*T,y+v*B,g+v*O,T,B,O,c-v,n,null)),o.addPoint(u+v*T,y+v*B,g+v*O,T,B,O,c-v,this.flip)))},OIMO.SphereSphereCollisionDetector=function(){OIMO.CollisionDetector.call(this)},OIMO.SphereSphereCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype),OIMO.SphereSphereCollisionDetector.prototype.detectCollision=function(t,e,o){var i=t,n=e;if(0!==i.collidesWith&&0!==n.collidesWith&&0!=(i.belongsTo&n.collidesWith)){var p1=i.position,p2=n.position,s=p2.x-p1.x,a=p2.y-p1.y,r=p2.z-p1.z,c=s*s+a*a+r*r,r1=i.radius,d=r1+n.radius;if(0<c&&c<d*d){var p=1/(c=Math.sqrt(c));s*=p,a*=p,r*=p,o.addPoint(p1.x+s*r1,p1.y+a*r1,p1.z+r*r1,s,a,r,c-d,!1)}}},OIMO.AABB=function(t,e,o,i,n,s){this.minX=t||0,this.maxX=e||0,this.minY=o||0,this.maxY=i||0,this.minZ=n||0,this.maxZ=s||0},OIMO.AABB.prototype={constructor:OIMO.AABB,init:function(t,e,o,i,n,s){this.minX=t,this.maxX=e,this.minY=o,this.maxY=i,this.minZ=n,this.maxZ=s},combine:function(t,e){this.minX=t.minX<e.minX?t.minX:e.minX,this.maxX=t.maxX>e.maxX?t.maxX:e.maxX,this.minY=t.minY<e.minY?t.minY:e.minY,this.maxY=t.maxY>e.maxY?t.maxY:e.maxY,this.minZ=t.minZ<e.minZ?t.minZ:e.minZ,this.maxZ=t.maxZ>e.maxZ?t.maxZ:e.maxZ},surfaceArea:function(){var h=this.maxY-this.minY,t=this.maxZ-this.minZ;return 2*((this.maxX-this.minX)*(h+t)+h*t)},intersectsWithPoint:function(t,e,o){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY&&o>=this.minZ&&o<=this.maxZ}},OIMO.Proxy=function(t){this.shape=t,this.aabb=t.aabb},OIMO.Proxy.prototype={constructor:OIMO.Proxy,update:function(){throw new Error("Inheritance error.")}},OIMO.BasicProxy=function(t){OIMO.Proxy.call(this,t)},OIMO.BasicProxy.prototype=Object.create(OIMO.Proxy.prototype),OIMO.BasicProxy.prototype.update=function(){},OIMO.BroadPhase=function(){this.types=0,this.numPairChecks=0,this.numPairs=0,this.bufferSize=256,this.pairs=[],this.pairs.length=this.bufferSize;for(var t=this.bufferSize;t--;)this.pairs[t]=new OIMO.Pair},OIMO.BroadPhase.prototype={constructor:OIMO.BroadPhase,createProxy:function(t){throw new Error("Inheritance error.")},addProxy:function(t){throw new Error("Inheritance error.")},removeProxy:function(t){throw new Error("Inheritance error.")},isAvailablePair:function(t,e){var o,b1=t.parent,b2=e.parent;if(b1==b2||!b1.isDynamic&&!b2.isDynamic||0==(t.belongsTo&e.collidesWith)||0==(e.belongsTo&t.collidesWith))return!1;for(o=b1.numJoints<b2.numJoints?b1.jointLink:b2.jointLink;null!=o;){var i=o.joint;if(!i.allowCollision&&(i.body1==b1&&i.body2==b2||i.body1==b2&&i.body2==b1))return!1;o=o.next}return!0},detectPairs:function(){for(;0<this.numPairs;){var t=this.pairs[--this.numPairs];t.shape1=null,t.shape2=null}this.numPairChecks=0,this.collectPairs()},collectPairs:function(){throw new Error("Inheritance error.")},addPair:function(t,e){if(this.numPairs==this.bufferSize){var o=this.bufferSize<<1,i=[];i.length=this.bufferSize;for(var n=0,s=this.bufferSize;n<s;n++)i[n]=this.pairs[n];for(n=this.newBufferSize,n=this.bufferSize,s=o;n<s;n++)i[n]=new OIMO.Pair;this.pairs=i,this.bufferSize=o}var a=this.pairs[this.numPairs++];a.shape1=t,a.shape2=e}},OIMO.BruteForceBroadPhase=function(){OIMO.BroadPhase.call(this),this.types=1,this.numProxies=0,this.maxProxies=256,this.proxies=[],this.proxies.length=256},OIMO.BruteForceBroadPhase.prototype=Object.create(OIMO.BroadPhase.prototype),OIMO.BruteForceBroadPhase.prototype.createProxy=function(t){return new OIMO.BasicProxy(t)},OIMO.BruteForceBroadPhase.prototype.addProxy=function(t){if(this.numProxies==this.maxProxies){this.maxProxies*=2;var e=[];e.length=this.maxProxies;for(var o=this.numProxies;o--;)e[o]=this.proxies[o];this.proxies=e}this.proxies[this.numProxies++]=t},OIMO.BruteForceBroadPhase.prototype.removeProxy=function(t){for(var e=this.numProxies;e--;)if(this.proxies[e]==t)return this.proxies[e]=this.proxies[--this.numProxies],void(this.proxies[this.numProxies]=null)},OIMO.BruteForceBroadPhase.prototype.collectPairs=function(){this.numPairChecks=this.numProxies*(this.numProxies-1)>>1;for(var t=this.numProxies;t--;)for(var p1=this.proxies[t],b1=p1.aabb,e=p1.shape,o=this.numProxies;o--;)if(o!==t){var p2=this.proxies[o],b2=p2.aabb,i=p2.shape;if(b1.maxX<b2.minX||b1.minX>b2.maxX||b1.maxY<b2.minY||b1.minY>b2.maxY||b1.maxZ<b2.minZ||b1.minZ>b2.maxZ||!this.isAvailablePair(e,i))continue;this.addPair(e,i)}},OIMO.Pair=function(){this.shape1=null,this.shape2=null},OIMO.SAPAxis=function(){this.numElements=0,this.bufferSize=256,this.elements=[],this.elements.length=this.bufferSize,this.stack=new OIMO_ARRAY_TYPE(64)},OIMO.SAPAxis.prototype={constructor:OIMO.SAPAxis,addElements:function(t,e){if(this.numElements+2>=this.bufferSize){this.bufferSize*=2;for(var o=[],i=this.numElements;i--;)o[i]=this.elements[i]}this.elements[this.numElements++]=t,this.elements[this.numElements++]=e},removeElements:function(t,e){for(var o=-1,i=-1,n=0,s=this.numElements;n<s;n++){var a=this.elements[n];if(a==t||a==e){if(-1!=o){i=n;break}o=n}}for(n=o+1,s=i;n<s;n++)this.elements[n-1]=this.elements[n];for(n=i+1,s=this.numElements;n<s;n++)this.elements[n-2]=this.elements[n];this.elements[--this.numElements]=null,this.elements[--this.numElements]=null},sort:function(){for(var t=0,e=1;this.numElements>>e!=0;)e++;e=e*this.numElements>>2,t=0;for(var o=!1,i=this.elements,n=1,s=this.numElements;n<s;n++){var a=i[n],r=a.value,c=i[n-1];if(c.value>r){var d=n;do{if(i[d]=c,0==--d)break;c=i[d-1]}while(c.value>r);if(i[d]=a,e<(t+=n-d)){o=!0;break}}}if(o){t=2;var p=this.stack;for(p[0]=0,p[1]=this.numElements-1;0<t;){var l=p[--t],u=p[--t],y=l-u;if(16<y){var g=u+Math.floor(.5*y);for(a=i[g],i[g]=i[l],r=(i[l]=a).value,n=u-1,d=l;;){for(var m,f;(m=i[++n]).value<r;);for(;r<(f=i[--d]).value&&d!=u;);if(d<=n)break;i[n]=f,i[d]=m}i[l]=i[n],i[n]=a,l-n<n-u?(p[t++]=u,p[t++]=n-1,p[t++]=n+1,p[t++]=l):(p[t++]=n+1,p[t++]=l,p[t++]=u,p[t++]=n-1)}else for(n=u+1;n<=l;n++)if(r=(a=i[n]).value,(c=i[n-1]).value>r){d=n;do{if(i[d]=c,0==--d)break;c=i[d-1]}while(c.value>r);i[d]=a}}}},calculateTestCount:function(){for(var t=1,e=0,o=1,i=this.numElements;o<i;o++)this.elements[o].max?t--:(e+=t,t++);return e}},OIMO.SAPBroadPhase=function(){OIMO.BroadPhase.call(this),this.types=2,this.numElementsD=0,this.numElementsS=0,this.axesD=[],this.axesS=[],this.axesD.length=3,this.axesS.length=3,this.axesD[0]=new OIMO.SAPAxis,this.axesD[1]=new OIMO.SAPAxis,this.axesD[2]=new OIMO.SAPAxis,this.axesS[0]=new OIMO.SAPAxis,this.axesS[1]=new OIMO.SAPAxis,this.axesS[2]=new OIMO.SAPAxis,this.index1=0,this.index2=1},OIMO.SAPBroadPhase.prototype=Object.create(OIMO.BroadPhase.prototype),OIMO.SAPBroadPhase.prototype.createProxy=function(t){return new OIMO.SAPProxy(this,t)},OIMO.SAPBroadPhase.prototype.addProxy=function(t){var e=t;e.isDynamic()?(this.axesD[0].addElements(e.min[0],e.max[0]),this.axesD[1].addElements(e.min[1],e.max[1]),this.axesD[2].addElements(e.min[2],e.max[2]),e.belongsTo=1,this.numElementsD+=2):(this.axesS[0].addElements(e.min[0],e.max[0]),this.axesS[1].addElements(e.min[1],e.max[1]),this.axesS[2].addElements(e.min[2],e.max[2]),e.belongsTo=2,this.numElementsS+=2)},OIMO.SAPBroadPhase.prototype.removeProxy=function(t){var e=t;if(0!=e.belongsTo){switch(e.belongsTo){case 1:this.axesD[0].removeElements(e.min[0],e.max[0]),this.axesD[1].removeElements(e.min[1],e.max[1]),this.axesD[2].removeElements(e.min[2],e.max[2]),this.numElementsD-=2;break;case 2:this.axesS[0].removeElements(e.min[0],e.max[0]),this.axesS[1].removeElements(e.min[1],e.max[1]),this.axesS[2].removeElements(e.min[2],e.max[2]),this.numElementsS-=2}e.belongsTo=0}},OIMO.SAPBroadPhase.prototype.collectPairs=function(){if(0!=this.numElementsD){var t,e,o,i,n=this.axesD[this.index1],s=this.axesD[this.index2];n.sort(),s.sort(),n.calculateTestCount()<=s.calculateTestCount()?((s=this.axesS[this.index1]).sort(),t=n.elements,e=s.elements):((n=this.axesS[this.index2]).sort(),t=s.elements,e=n.elements,this.index1^=this.index2,this.index2^=this.index1,this.index1^=this.index2);for(var a=0,r=0;a<this.numElementsD;){var c,d;if(r==this.numElementsS)c=t[a],d=!0,a++;else{var p=t[a],l=e[r];p.value<l.value?(c=p,d=!0,a++):(c=l,d=!1,r++)}if(c.max){var u=c.pair;if(d){if(u==o){o=o.pair;continue}c=o}else{if(u==i){i=i.pair;continue}c=i}do{if((b=c.pair)===u){c.pair=b.pair;break}c=b}while(c)}else{for(var y=c.proxy.shape,g=c.min1.value,m=c.max1.value,f=c.min2.value,A=c.max2.value,b=o;null!=b;b=b.pair){var v=b.proxy.shape;this.numPairChecks++,g>b.max1.value||m<b.min1.value||f>b.max2.value||A<b.min2.value||!this.isAvailablePair(y,v)||this.addPair(y,v)}if(d){for(b=i;null!=b;b=b.pair)v=b.proxy.shape,this.numPairChecks++,g>b.max1.value||m<b.min1.value||f>b.max2.value||A<b.min2.value||!this.isAvailablePair(y,v)||this.addPair(y,v);c.pair=o,o=c}else c.pair=i,i=c}}this.index2=3^(this.index1|this.index2)}},OIMO.SAPElement=function(t,e){this.proxy=t,this.pair=null,this.min1=null,this.max1=null,this.min2=null,this.max2=null,this.max=e,this.value=0},OIMO.SAPProxy=function(t,e){OIMO.Proxy.call(this,e),this.belongsTo=0,this.max=[],this.min=[],this.sap=t,this.min[0]=new OIMO.SAPElement(this,!1),this.max[0]=new OIMO.SAPElement(this,!0),this.min[1]=new OIMO.SAPElement(this,!1),this.max[1]=new OIMO.SAPElement(this,!0),this.min[2]=new OIMO.SAPElement(this,!1),this.max[2]=new OIMO.SAPElement(this,!0),this.max[0].pair=this.min[0],this.max[1].pair=this.min[1],this.max[2].pair=this.min[2],this.min[0].min1=this.min[1],this.min[0].max1=this.max[1],this.min[0].min2=this.min[2],this.min[0].max2=this.max[2],this.min[1].min1=this.min[0],this.min[1].max1=this.max[0],this.min[1].min2=this.min[2],this.min[1].max2=this.max[2],this.min[2].min1=this.min[0],this.min[2].max1=this.max[0],this.min[2].min2=this.min[1],this.min[2].max2=this.max[1]},OIMO.SAPProxy.prototype=Object.create(OIMO.Proxy.prototype),OIMO.SAPProxy.prototype.isDynamic=function(){var t=this.shape.parent;return t.isDynamic&&!t.sleeping},OIMO.SAPProxy.prototype.update=function(){this.min[0].value=this.aabb.minX,this.max[0].value=this.aabb.maxX,this.min[1].value=this.aabb.minY,this.max[1].value=this.aabb.maxY,this.min[2].value=this.aabb.minZ,this.max[2].value=this.aabb.maxZ,(1==this.belongsTo&&!this.isDynamic()||2==this.belongsTo&&this.isDynamic())&&(this.sap.removeProxy(this),this.sap.addProxy(this))},OIMO.DBVT=function(){this.root=null,this.freeNodes=[],this.freeNodes.length=16384,this.numFreeNodes=0,this.aabb=new OIMO.AABB},OIMO.DBVT.prototype={constructor:OIMO.DBVT,moveLeaf:function(t){this.deleteLeaf(t),this.insertLeaf(t)},insertLeaf:function(t){if(null!=this.root){for(var e,o,i=t.aabb,n=this.root;null==n.proxy;){var c1=n.child1,c2=n.child2,s=n.aabb,a=c1.aabb,r=c2.aabb;e=s.surfaceArea(),this.aabb.combine(i,s);var c=2*(o=this.aabb.surfaceArea()),d=2*(o-e),p=d;this.aabb.combine(i,a),null!=c1.proxy?p+=this.aabb.surfaceArea():p+=this.aabb.surfaceArea()-a.surfaceArea();var l=d;if(this.aabb.combine(i,r),null!=c2.proxy?l+=this.aabb.surfaceArea():l+=this.aabb.surfaceArea()-r.surfaceArea(),p<l){if(c<p)break;n=c1}else{if(c<l)break;n=c2}}var u,y=n.parent;for((u=0<this.numFreeNodes?this.freeNodes[--this.numFreeNodes]:new OIMO.DBVTNode).parent=y,u.child1=t,u.child2=n,u.aabb.combine(t.aabb,n.aabb),u.height=n.height+1,n.parent=u,t.parent=u,n==this.root?this.root=u:y.child1==n?y.child1=u:y.child2=u;u=this.balance(u),this.fix(u),null!=(u=u.parent););}else this.root=t},getBalance:function(t){return null!=t.proxy?0:t.child1.height-t.child2.height},print:function(t,e,o){var i=null==t.proxy;i&&(o=this.print(t.child1,e+1,o));for(var n=2*e;0<=n;n--)o+=" ";return o+=(i?this.getBalance(t):"["+t.proxy.aabb.minX+"]")+"\n",i&&(o=this.print(t.child2,e+1,o)),o},deleteLeaf:function(t){if(t!=this.root){var e,o=t.parent;if(e=o.child1==t?o.child2:o.child1,o!=this.root){var i=o.parent;for((e.parent=i).child1==o?i.child1=e:i.child2=e,this.numFreeNodes<16384&&(this.freeNodes[this.numFreeNodes++]=o);i=this.balance(i),this.fix(i),null!=(i=i.parent););}else(this.root=e).parent=null}else this.root=null},balance:function(t){var e=t.height;if(e<2)return t;var o,i=t.parent,n=t.child1,s=t.child2,a=n.height,r=s.height,c=a-r;if(1<c){var d=n.child1,p=n.child2,l=d.height,u=p.height;return u<l?((n.child2=t).parent=n,((t.child1=p).parent=t).aabb.combine(p.aabb,s.aabb),o=u-r,t.height=u-(o&o>>31)+1,n.aabb.combine(d.aabb,t.aabb),o=l-e,n.height=l-(o&o>>31)+1):((n.child1=t).parent=n,((t.child1=d).parent=t).aabb.combine(d.aabb,s.aabb),o=l-r,t.height=l-(o&o>>31)+1,n.aabb.combine(t.aabb,p.aabb),o=e-u,n.height=e-(o&o>>31)+1),null!=i?i.child1==t?i.child1=n:i.child2=n:this.root=n,n.parent=i,n}if(c<-1){var y=s.child1,g=s.child2,m=y.height,f=g.height;return f<m?((s.child2=t).parent=s,((t.child2=g).parent=t).aabb.combine(n.aabb,g.aabb),o=a-f,t.height=a-(o&o>>31)+1,s.aabb.combine(y.aabb,t.aabb),o=m-e,s.height=m-(o&o>>31)+1):((s.child1=t).parent=s,((t.child2=y).parent=t).aabb.combine(n.aabb,y.aabb),o=a-m,t.height=a-(o&o>>31)+1,s.aabb.combine(t.aabb,g.aabb),o=e-f,s.height=e-(o&o>>31)+1),null!=i?i.child1==t?i.child1=s:i.child2=s:this.root=s,s.parent=i,s}return t},fix:function(t){var c1=t.child1,c2=t.child2;t.aabb.combine(c1.aabb,c2.aabb);var e=c1.height,h2=c2.height;t.height=e<h2?h2+1:e+1}},OIMO.DBVTBroadPhase=function(){OIMO.BroadPhase.call(this),this.types=3,this.numLeaves=0,this.maxLeaves=0,this.tree=new OIMO.DBVT,this.maxStack=256,this.stack=[],this.stack.length=this.maxStack,this.maxLeaves=256,this.leaves=[],this.leaves.length=this.maxLeaves},OIMO.DBVTBroadPhase.prototype=Object.create(OIMO.BroadPhase.prototype),OIMO.DBVTBroadPhase.prototype.createProxy=function(t){return new OIMO.DBVTProxy(t)},OIMO.DBVTBroadPhase.prototype.addProxy=function(t){var e=t;if(this.tree.insertLeaf(e.leaf),this.numLeaves==this.maxLeaves){this.maxLeaves*=2;var o=[];o.length=this.maxLeaves;for(var i=0;i<this.numLeaves;i++)o[i]=this.leaves[i];this.leaves=o}this.leaves[this.numLeaves++]=e.leaf},OIMO.DBVTBroadPhase.prototype.removeProxy=function(t){var e=t;this.tree.deleteLeaf(e.leaf);for(var o=0;o<this.numLeaves;o++)if(this.leaves[o]==e.leaf)return this.leaves[o]=this.leaves[--this.numLeaves],void(this.leaves[this.numLeaves]=null)},OIMO.DBVTBroadPhase.prototype.collectPairs=function(){if(!(this.numLeaves<2))for(var t=0;t<this.numLeaves;t++){var e=this.leaves[t],o=e.proxy.aabb,i=e.aabb;if(o.minX<i.minX||o.maxX>i.maxX||o.minY<i.minY||o.maxY>i.maxY||o.minZ<i.minZ||o.maxZ>i.maxZ){this.tree.deleteLeaf(e),i.minX=o.minX-.1,i.maxX=o.maxX+.1,i.minY=o.minY-.1,i.maxY=o.maxY+.1,i.minZ=o.minZ-.1,i.maxZ=o.maxZ+.1,this.tree.insertLeaf(e),this.collide(e,this.tree.root)}}},OIMO.DBVTBroadPhase.prototype.collide=function(t,e){var o=2;for(this.stack[0]=t,this.stack[1]=e;0<o;){var i=this.stack[--o],n=this.stack[--o],s=null!=i.proxy,a=null!=n.proxy;if(this.numPairChecks++,s&&a){var r=i.proxy.shape,c=n.proxy.shape,b1=r.aabb,b2=c.aabb;if(r==c||b1.maxX<b2.minX||b1.minX>b2.maxX||b1.maxY<b2.minY||b1.minY>b2.maxY||b1.maxZ<b2.minZ||b1.minZ>b2.maxZ||!this.isAvailablePair(r,c))continue;this.addPair(r,c)}else{if(b1=i.aabb,b2=n.aabb,b1.maxX<b2.minX||b1.minX>b2.maxX||b1.maxY<b2.minY||b1.minY>b2.maxY||b1.maxZ<b2.minZ||b1.minZ>b2.maxZ)continue;if(o+4>=this.maxStack){this.maxStack*=2;var d=[];d.length=this.maxStack;for(var p=0;p<o;p++)d[p]=this.stack[p];this.stack=d}a||!s&&i.aabb.surfaceArea()>n.aabb.surfaceArea()?(this.stack[o++]=i.child1,this.stack[o++]=n,this.stack[o++]=i.child2,this.stack[o++]=n):(this.stack[o++]=i,this.stack[o++]=n.child1,this.stack[o++]=i,this.stack[o++]=n.child2)}}},OIMO.DBVTNode=function(){this.child1=null,this.child2=null,this.parent=null,this.proxy=null,this.height=0,this.aabb=new OIMO.AABB},OIMO.DBVTProxy=function(t){OIMO.Proxy.call(this,t),this.leaf=new OIMO.DBVTNode,this.leaf.proxy=this},OIMO.DBVTProxy.prototype=Object.create(OIMO.Proxy.prototype),OIMO.DBVTProxy.prototype.update=function(){},function(t){var C,e;C=t.Graphics||(t.Graphics={}),e=function(){function z3(){var t=this;this.lights=new Array,this.objs=[],this.boxNum=0,this.objectsByMeshID=[],this.aspectRatio=1,this.pubsub=new Pubsub,this.pointerDownLongTimerID=0,this.pointerDownLongTime=300,this.materials={},this._onCameraMoveObservable=new BABYLON.Observable,this._onCameraStopObservable=new BABYLON.Observable,this._onCameraStartObservable=new BABYLON.Observable,this._lastCameraPosition=BABYLON.Vector3.Zero(),this._needNotifyCameraStopObservers=!1,this.fovCoef=.4,this.onWindowResize=function(){t.engine.resize(),t.pubsub.broadcast(z3.SCREEN_RESIZED),t.aspectRatio=t.canvas.width/t.canvas.height},this.lastPointerX=-1,this.lastPointerY=-1,this.pointerDown=!1,this.camDx=0,this.camDy=0,this.camDragPaused=!1,this.camAcc=1,this.camMaxSpeed=4,this.cameraTarget=BABYLON.Vector3.Zero(),this._tranlatingCam=!1,this.moveCameraBorder=0,this._cameraDragging=!1,this._moveCameraPointerX=0,this._moveCameraPointerY=0,this.zoomForce=0,this.zoomInited=!1,this.maxCameraZoomPos=-8,this.minCameraZoomPos=-100,this.identityMatrix=BABYLON.Matrix.Identity(),this._viewportMatrixCache=BABYLON.Matrix.Identity(),this._matrix=BABYLON.Matrix.Identity()}return z3.GetMesh=function(t){var e=z3,o=e.meshes[t];if(!o){var i=e._instance,n=i.createMeshFunctions[t];n&&(n(i.scene,e.meshes,i.materials,e.drawTextureFunctions,i.tileSets),o=e.meshes[t])}return o},z3.GetMaterial=function(t){var e=z3,o=e._instance,i=o.materials[t];if(!i){var n=o.createMaterialFunctions[t];n&&(n(o.scene,e.meshes,o.materials,null,o.tileSets),i=o.materials[t])}return i},Object.defineProperty(z3.prototype,"groundColor",{get:function(){return this.lights[0].groundColor.r},set:function(t){this.lights[0].groundColor.r=t,this.lights[0].groundColor.g=t,this.lights[0].groundColor.b=t},enumerable:!1,configurable:!0}),Object.defineProperty(z3.prototype,"specular",{get:function(){return this.lights[0].specular.r},set:function(t){this.lights[0].specular.r=t,this.lights[0].specular.g=t,this.lights[0].specular.b=t},enumerable:!1,configurable:!0}),Object.defineProperty(z3.prototype,"diffuse",{get:function(){return this.lights[0].diffuse.r},set:function(t){this.lights[0].diffuse.r=t,this.lights[0].diffuse.g=t,this.lights[0].diffuse.b=t},enumerable:!1,configurable:!0}),z3.prototype.subscribe=function(t,e,o){this.pubsub.subscribe(t,e,o)},z3.prototype.unsubscribe=function(t,e,o){this.pubsub.unsubscribe(t,e,o)},z3.prototype.createScene=function(t){return new BABYLON.Scene(t)},z3.prototype.init=function(t){z3._instance=this;var e,p,o=t.models,i=t.textures,l=(t.createMeshFunctions,t.createTextureFunctions),u=t.spsData,y=t.tileSetData,g=t.onFinishFunc,n=t.highlightLayer,s=t.rootURL?t.rootURL:"";this.createMeshFunctions=t.createMeshFunctions,this.createMaterialFunctions=t.createMaterialFunctions,t.scene?(e=(p=t.scene).getEngine(),this.canvas=e.getRenderingCanvas()):t.engine?(e=t.engine,p=new BABYLON.Scene(e),this.canvas=e.getRenderingCanvas()):(this.canvas=t.canvas,n?(e=new BABYLON.Engine(this.canvas,!0,{stencil:!0}),(p=new BABYLON.Scene(e)).setRenderingAutoClearDepthStencil(1,!1,!1,!1),p.setRenderingAutoClearDepthStencil(2,!1,!1,!1)):(e=new BABYLON.Engine(this.canvas,!0,{stencil:!1}),p=new BABYLON.Scene(e))),this.aspectRatio=this.canvas.width/this.canvas.height,p._internalPick=function(t,e,o){if(!BABYLON.PickingInfo)return null;for(var i=null,n=0;n<this.meshes.length;n++){var s=this.meshes[n];if(e){if(!e(s))continue}else if(!s.isEnabled()||!s.isVisible||!s.isPickable)continue;if(!(i&&i.pickedMesh.renderingGroupId>s.renderingGroupId)){var a=t(s.getWorldMatrix()),r=s.intersects(a,o);if(r&&r.hit&&(o||null==i||!(r.distance>=i.distance)||s.renderingGroupId!=i.pickedMesh.renderingGroupId)&&(i=r,o))break}}return i||new BABYLON.PickingInfo}.bind(p),e.onResizeObservable.add(function(){a.setFovByAspectRatio()}),p.clearColor=new BABYLON.Color4(1,1,1),p.clearColor=new BABYLON.Color4(230/255,156/255,32/255),this.scene=p;var a=this;this.addBJSPointerObservables();var r=new BABYLON.FreeCamera("FreeCamera",new BABYLON.Vector3(0,.5,-10),p);r.rotationQuaternion=BABYLON.Quaternion.Identity(),r.noRotationConstraint=!0,r.minZ=.5,this.camera=r,this.setFovByAspectRatio(),this.camera.position.z=1/this.fovCoef*-30;var c=1,d=.75,m=1,f=-1,A=.32,b=new BABYLON.HemisphericLight("light1",new BABYLON.Vector3(0,1,-1),p);b.intensity=m,b.groundColor=new BABYLON.Color3(c,c,c),b.specular=new BABYLON.Color3(1,1,1),b.diffuse=new BABYLON.Color3(d,d,d),this.lights.push(b);var v=new BABYLON.DirectionalLight("light2",new BABYLON.Vector3(0,-1,f),p);v.intensity=A,v.specular=new BABYLON.Color3(1,1,1),this.lights.push(v),this.engine=e,this.scene=p,this.camera=this.camera,this.initEvents();var x=this;this.loadAssets(this.scene,o,i,function(d){requestAnimationFrame(function(){for(var t=z3.meshes,e=z3.drawTextureFunctions,o=z3.onSuccessRemoveMeshes,i=0;i<d.length;i++)o(d[i],t);for(i=0;i<l.length;i++)l[i](e);var n={};for(i=0;i<y.length;i++){for(var s=y[i],a=new C.TileSet(s.tileSetName,p,s.numRows,s.numCols),r=0;r<s.tileDrawNames.length;r++){var c=s.tileDrawNames[r];a.drawTile(c,e[c])}a.drawTileSet(),n[s.tileSetName]=a}x.tileSets=n,requestAnimationFrame(function(){var t=new C.z1079(x.scene);t.init(u,0),x.spsManagerManager=t,g&&g(),x.pubsub.broadcast(z3.AFTER_LOADED)})})},s),p.pointerMovePredicate=function(t){var e=t.isReady()&&t.isEnabled()&&(t.enablePointerMoveEvents||null!==t.actionManager&&void 0!==t.actionManager);return e}},z3.prototype.onPickDown=function(t){var e=this.getObjectByPickInfo(t.pickInfo);e&&e.onPickDown&&e.onPickDown(t)},z3.prototype.onPointerDown=function(t){var e=this;if(t.pickInfo.pickedMesh){var o=e.getObjectByPickInfo(t.pickInfo);if(o){var i=o.constructor.name;this.pubsub.broadcast(z3.POINTER_DOWN+"/"+i,t,o),o.accType&&this.pubsub.broadcast(z3.POINTER_DOWN+"/z1044"+o.accType,t,o),e.pointerDownLongTimerID=setTimeout(function(){e.pubsub.broadcast(z3.POINTER_DOWN_LONG+"/"+i,t,o),e.pubsub.broadcast(z3.POINTER_DOWN_LONG,t,o),e.pointerDownLongTimerID=0},e.pointerDownLongTime)}this.pubsub.broadcast(z3.POINTER_DOWN,t,o)}},z3.prototype.onPointerUp=function(t){if(t.pickInfo.pickedMesh){var e=this.getObjectByPickInfo(t.pickInfo);if(e){var o=e.constructor.name;this.pubsub.broadcast(z3.POINTER_UP+"/"+o,t,e)}this.pubsub.broadcast(z3.POINTER_UP,t,e)}},z3.prototype.onPointerMove=function(t){if(t.pickInfo.pickedMesh){var e=this.getObjectByPickInfo(t.pickInfo);if(e){var o=e.constructor.name;this.pubsub.broadcast(z3.POINTER_MOVE+"/"+o,t,e)}this.pubsub.broadcast(z3.POINTER_MOVE,t,e)}this.pointerDownLongTimerID&&(clearTimeout(this.pointerDownLongTimerID),this.pointerDownLongTimerID=0)},z3.prototype.addBJSPointerObservables=function(){this.scene.onPointerObservable.add(this.onPickDown,BABYLON.PointerEventTypes.POINTERDOWN,!1,this),this.scene.onPointerObservable.add(this.onPointerUp,BABYLON.PointerEventTypes.POINTERUP,!1,this),this.scene.onPointerObservable.add(this.onPointerDown,BABYLON.PointerEventTypes.POINTERDOWN,!1,this),this.scene.onPointerObservable.add(this.onPointerMove,BABYLON.PointerEventTypes.POINTERMOVE,!1,this)},z3.prototype.removeBJSPointerObservables=function(){this.scene.onPointerObservable.removeCallback(this.onPickDown,this),this.scene.onPointerObservable.removeCallback(this.onPointerUp,this),this.scene.onPointerObservable.removeCallback(this.onPointerDown,this),this.scene.onPointerObservable.removeCallback(this.onPointerMove,this)},z3.prototype.loadAssets=function(t,e,o,i,n){void 0===i&&(i=null),void 0===n&&(n="");for(var s=new BABYLON.AssetsManager(t),a=0;a<e.length;a++){var r=e[a];s.addMeshTask("load "+r,"",n+"data/",r+".json")}for(a=0;a<o.length;a++){r=o[a];s.addTextureTask("load "+r,n+"assets/textures/"+r)}s.onFinish=i,s.useDefaultLoadingScreen=!1,s.load()},z3.onSuccessRemoveMeshes=function(t,e){var o=t.loadedMeshes;if(o)for(var i=0;i<o.length;i++){var n=o[i];(e[n.name]=n).getScene().removeMesh(n)}},z3.prototype.getz1069anceByName=function(t){var e=z3.meshes[t],o=e.createInstance(t);return e.isVisible=!1,o},z3.prototype.getMeshCloneByName=function(t){return z3.meshes[t].clone(t)},z3.prototype.initObject=function(t,e,o){void 0===o&&(o=!1),this.loadModel(e,o)},z3.prototype.addBox=function(t,e,o,i,n,s,a){void 0===n&&(n=.3),void 0===s&&(s=.3),void 0===a&&(a=.3),this.boxNum++;var r=BABYLON.MeshBuilder.CreateBox("testBox"+this.boxNum,{size:1},this.scene),c=new BABYLON.StandardMaterial("",this.scene);return c.diffuseColor=new BABYLON.Color3(n,s,a),c.freeze(),r.material=c,r.scaling.x=t,r.scaling.y=t,r.scaling.z=t,r.position.x=e,r.position.y=o,r.position.z=i,r},z3.prototype.addTestCylinder=function(t,e,o,i,n,s){void 0===t&&(t="testCylinder"),null==this.testCylinder&&(this.testCylinder=BABYLON.Mesh.CreateCylinder("testCylinder",1,1,1,12,1,this.scene),this.scene.removeMesh(this.testCylinder));var a=this.testCylinder.createInstance(t);return a.position.x=i,a.position.y=n,a.position.z=s,a.scaling.x=2*e,a.scaling.y=o,a.scaling.z=2*e,a},z3.prototype.addTestBox=function(t,e,o,i,n){this.boxNum++,null==this.testBox&&(this.testBox=BABYLON.MeshBuilder.CreateBox("testBox"+this.boxNum,{size:1},this.scene),this.testBox.renderingGroupId=1,this.testBox.material=new BABYLON.StandardMaterial("",this.scene),this.scene.removeMesh(this.testBox));var s=this.testBox.createInstance("testBox");return s.scaling.x=t,s.scaling.y=t,s.scaling.z=t,s.position.x=e,s.position.y=o,s.position.z=i,s},z3.prototype.addTestSphere=function(t,e,o,i,n,s,a){void 0===t&&(t="testSphere"),void 0===o&&(o=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===a&&(a=6),null==this.testSphere&&(this.testSphere=BABYLON.MeshBuilder.CreateSphere(t,{segments:4,diameter:1},this.scene),this.testSphere.material=new BABYLON.StandardMaterial("",this.scene),this.testSphere.material.wireframe=!0,this.testSphere.renderingGroupId=1,this.scene.removeMesh(this.testSphere));var r=this.testSphere.createInstance(t);return r.scaling.x=2*e,r.scaling.y=2*e,r.scaling.z=2*e,r.position.x=o,r.position.y=i,r.position.z=n,r},z3.prototype.registerOnCameraMove=function(t,e){void 0===e&&(e=null),this._onCameraMoveObservable.add(t,-1,!1,e)},z3.prototype.unregisterOnCameraMove=function(t,e){void 0===e&&(e=null),this._onCameraMoveObservable.removeCallback(t,e)},z3.prototype.registerOnCameraStop=function(t,e){void 0===e&&(e=null),this._onCameraStopObservable.add(t,-1,!1,e)},z3.prototype.unregisterOnCameraStop=function(t){this._onCameraStopObservable.removeCallback(t)},z3.prototype.registerOnCameraStart=function(t,e){void 0===e&&(e=null),this._onCameraStartObservable.add(t,-1,!1,e)},z3.prototype.unregisterOnCameraStart=function(t){this._onCameraStartObservable.removeCallback(t)},z3.prototype.renderScene=function(){var t=this.scene.activeCamera;t.position.equalsWithEpsilon(this._lastCameraPosition,1e-4)?(this._needNotifyCameraStopObservers&&(this._onCameraStopObservable.notifyObservers(this.scene),this._needNotifyCameraStopObservers=!1,this.zoomForce),this._lastCameraPosition.copyFrom(t.position)):(this._needNotifyCameraStopObservers||this._onCameraStartObservable.notifyObservers(this.scene),this._needNotifyCameraStopObservers=!0,this._onCameraMoveObservable.notifyObservers(this.scene),this._lastCameraPosition.copyFrom(t.position),this.pubsub.broadcast(z3.CAMERA_MOVE)),this.scene.render()},z3.prototype.addToScene=function(t){this.scene.addMesh(t)},z3.prototype.setFovByAspectRatio=function(){this.canvas.height>this.canvas.width?this.camera.fov=this.fovCoef*(this.canvas.width/this.canvas.height):this.camera.fov=this.fovCoef*(this.canvas.height/this.canvas.width)},z3.prototype.initEvents=function(){window.addEventListener("resize",this.onWindowResize,!1)},z3.prototype.loadModel=function(t,e){void 0===e&&(e=!1);var o,i=t.modelName,n=t.color,s=t.texturePath,a=this.scene,r=t.constructor.name;o=this.materials[r+n+s];var c=z3.meshes[i];if(!c){var d=z3.meshes[r+"_front"],p=z3.meshes[r+"_back"];c=BABYLON.Mesh.MergeMeshes([d,p])}if(!o)if((o=new BABYLON.StandardMaterial("material_"+r+n+s,a)).backFaceCulling=!1,s){var l=new BABYLON.Texture(s,this.scene);o.diffuseTexture=l,this.materials[r+n+s]=o}else o=c.material;o.checkReadyOnlyOnce=!0,t.material=o,c.material=o,c=e?c.createInstance(i):c.clone();var u=(t.mesh=c).position;if(t.body){c.rotationQuaternion=new BABYLON.Quaternion;var y=t.body.position;u.x=y.x,u.y=y.y,u.z=y.z;var g=new BABYLON.Quaternion,m=t.body.orientation;g.x=m.x,g.y=m.y,g.z=m.z,g.w=m.s,c.rotationQuaternion=g}else u.x=t.x,u.y=t.y,u.z=t.z;this.objectsByMeshID[c.uniqueId]=t},z3.prototype.addForUpdate=function(t){-1===this.objs.indexOf(t)?this.objs.push(t):this.objs},z3.prototype.removeFromUpdate=function(t){-1!==this.objs.indexOf(t)&&this.objs.splice(this.objs.indexOf(t),1)},z3.prototype.removeObject=function(t,e){void 0===e&&(e=null)},z3.prototype.addObject=function(t,e){void 0===e&&(e=null),null==e&&(e=t.mesh),this.objectsByMeshID[e.uniqueId]=t},z3.prototype.getObjectByMesh=function(t){return this.objectsByMeshID[t.uniqueId]},z3.prototype.getObjectByPickInfo=function(t){if(t&&t.pickedMesh){if(n=this.objectsByMeshID[t.pickedMesh.uniqueId])return n;for(var e=this.spsManagerManager.pickablez1080s,o=0;o<e.length;o++){var i=e[o];if(t.pickedMesh==i.sps.mesh){var n,s=i.sps.pickedParticles[t.faceId].idx;if(!(n=i.accByShapeID[s]))continue;return n.constructor.name==C.z1068.name&&n.parent&&(n=n.parent),n}}}},z3.prototype.excludeMeshFromLights=function(t){for(var e=0;e<this.lights.length;e++)this.lights[e].excludedMeshes.push(t)},z3.prototype.hitPlanePred=function(t){return t==this.hitPlane},z3.prototype.getPlanePositionAtScreenXY=function(t,e,o,i){var n=this.scene;this.hitPlane||(this.hitPlane=BABYLON.MeshBuilder.CreatePlane("",{size:100},n),this.hitPlane.isVisible=!1),this.hitPlane.isPickable=!0,this.hitPlane.position.z!=o&&(this.hitPlane.position.z=o,this.hitPlane.computeWorldMatrix(!0));var s=n.pick(t,e,this.hitPlanePred.bind(this));s.hit&&(i.x=s.pickedPoint.x,i.y=s.pickedPoint.y,i.z=s.pickedPoint.z),this.hitPlane.isPickable=!1},z3.prototype.getHitMesh=function(t,e,o,i){void 0===t&&(t=1),void 0===i&&(i=!1),z3.hitMesh||((z3.hitMesh=BABYLON.MeshBuilder.CreatePlane("",{size:1},this.scene)).isVisible=!1,this.scene.removeMesh(z3.hitMesh));var n=z3.hitMesh.createInstance("hitMesh"),s=.5*t,a=.5*t,r=.5*t;e&&(a=.5*e),o&&(r=.5*o);var c=new BABYLON.BoundingInfo(new BABYLON.Vector3(-s,-a,-r),new BABYLON.Vector3(s,a,r));return n.setBoundingInfo(c),n.isPickable=!1,i?n.showBoundingBox=!0:(n.isVisible=!1,this.scene.removeMesh(n)),n},z3.drawEllipse=function(t,e,o,i,n){n.translate(t,e),n.scale(o,i),n.beginPath(),n.arc(0,0,1,0,2*Math.PI),n.closePath(),n.scale(1/o,1/i),n.translate(-t,-e)},Object.defineProperty(z3.prototype,"isPointerDown",{get:function(){return this.pointerDown},enumerable:!1,configurable:!0}),Object.defineProperty(z3.prototype,"fov",{get:function(){return this.camera.fov},set:function(t){this.camera.fov=t},enumerable:!1,configurable:!0}),z3.prototype.initDragCamera=function(){this.scene.onPointerObservable.add(this.setPointerDown.bind(this),BABYLON.PointerEventTypes.POINTERDOWN),document.addEventListener("pointerup",this.setPointerUp.bind(this)),this._bindedCheckDragCamera=this.checkDragCamera.bind(this),this.scene.registerBeforeRender(this._bindedCheckDragCamera)},z3.prototype.pauseDragCamera=function(t){this.camDragPaused=t},z3.prototype.setPointerDown=function(){this.pointerDown=!0,this._tranlatingCam&&(this.scene.unregisterBeforeRender(this._bindedCheckTranslateCamera),this._tranlatingCam=!1)},z3.prototype.setPointerUp=function(){this.pointerDownLongTimerID&&(clearTimeout(this.pointerDownLongTimerID),this.pointerDownLongTimerID=0),this.pointerDown=!1},z3.prototype.setCameraPosition=function(t,e,o){this.scene.unregisterBeforeRender(this._bindedCheckTranslateCamera),this.camera.position.x=t,this.camera.position.y=e,null!=o&&(this.camera.position.z=o)},z3.prototype.translateCameraTo=function(t,e){this._bindedCheckTranslateCamera||(this._bindedCheckTranslateCamera=this.checkTranslateCamera.bind(this)),this.scene.unregisterBeforeRender(this._bindedCheckTranslateCamera),this.cameraTarget.x=t,this.cameraTarget.y=e,this._tranlatingCam=!0,this.scene.registerBeforeRender(this._bindedCheckTranslateCamera)},z3.prototype.checkTranslateCamera=function(){var t=this.camera.position,e=this.cameraTarget.x-t.x,o=this.cameraTarget.y-t.y;t.x+=.1*e,t.y+=.1*o,e*e+o*o<1e-4&&(this.scene.unregisterBeforeRender(this._bindedCheckTranslateCamera),this._tranlatingCam=!1)},z3.prototype.setMoveCameraPointer=function(t,e,o){void 0===o&&(o=!1),this._moveCameraPointerX=t,this._moveCameraPointerY=e,o&&(this.lastPointerX=t,this.lastPointerY=e)},z3.prototype.checkDragCamera=function(){var t=this._moveCameraPointerX,e=this._moveCameraPointerY,o=this.scene.activeCamera.fov;if(this.moveCameraBorder){var i=this.moveCameraBorder,n=this.camAcc;t>this.canvas.width-i?(this.camDx-=n,this.camDx=Math.max(this.camDx,-this.camMaxSpeed)):t<i&&(this.camDx+=n,this.camDx=Math.min(this.camDx,this.camMaxSpeed)),e>this.canvas.height-i?(this.camDy-=n,this.camDy=Math.max(this.camDy,-this.camMaxSpeed)):e<i&&(this.camDy+=n,this.camDy=Math.min(this.camDy,this.camMaxSpeed))}!this.camDragPaused&&-1<this.lastPointerX&&this.pointerDown?(this.camDx=t-this.lastPointerX,this.camDy=e-this.lastPointerY):(this.camDx*=.9,this.camDy*=.9);var s=-this.camera.position.z/this.canvas.height*o;this.camera.position.x-=this.camDx*s,this.camera.position.y+=this.camDy*s,this.lastPointerX=t,this.lastPointerY=e;this.fovCoef;this.camBoundsMin&&(this.camera.position.x<this.camBoundsMin.x&&(this.camera.position.x=this.camBoundsMin.x),this.camera.position.y<this.camBoundsMin.y&&(this.camera.position.y=this.camBoundsMin.y),this.camera.position.z,this.camBoundsMin.z),this.camBoundsMax&&(this.camera.position.x>this.camBoundsMax.x&&(this.camera.position.x=this.camBoundsMax.x),this.camera.position.y>this.camBoundsMax.y&&(this.camera.position.y=this.camBoundsMax.y),this.camera.position.z,this.camBoundsMax.z),this.pointerDown?(1e-4<this.camDx||this.camDx<-1e-4||1e-4<this.camDy||this.camDy<-1e-4)&&(this._cameraDragging=!0):1e-4<this.camDx||this.camDx<-1e-4||1e-4<this.camDy||this.camDy<-1e-4||this._cameraDragging&&(this.pubsub.broadcast(z3.CAMERA_DRAG_STOPPED,this.camera.position),this._cameraDragging=!1),this.camDragPaused=!1},z3.prototype.zoomCameraWithWheel=function(t){var e=t.deltaY;1<e?e=1:e<-1&&(e=-1),e*=30,this.zoomInited||this.initZoomCamera();var o=(-this.camera.position.z+.5*this.maxCameraZoomPos)/1e3;o<.001&&(o=.001),this.zoomForce+=.5*(e*o-this.zoomForce)},z3.prototype.zoomCamera=function(t,e){void 0===e&&(e=.5);var o=this.scene.activeCamera.fov;this.zoomInited||this.initZoomCamera();var i=(-this.camera.position.z+.5*this.maxCameraZoomPos)/1e3*o;i<.001&&(i=.001),this.zoomForce+=(t*i-this.zoomForce)*e},z3.prototype.rotateCameraYAxis=function(t){var e=this.camera,o=BABYLON.Quaternion.RotationYawPitchRoll(t,0,0);e.rotationQuaternion.multiplyInPlace(o)},z3.prototype.rotateCameraXAxis=function(t){var e=this.camera,o=BABYLON.Quaternion.RotationYawPitchRoll(0,t,0);e.rotationQuaternion.multiplyInPlace(o)},z3.prototype.initZoomCamera=function(){this.scene.registerBeforeRender(function(){var t=this.scene.activeCamera;t.position.z-=this.zoomForce;var e=this.maxCameraZoomPos,o=this.minCameraZoomPos;t.position.z>e&&(t.position.z=e),t.position.z<o&&(t.position.z=o),this.zoomForce*=.9;this.zoomForce&&this.zoomForce<1e-5&&-1e-5<this.zoomForce&&(this.zoomForce=0,this.pubsub.broadcast(z3.CAMERA_ZOOM_STOPPED,this.camera.position))}.bind(this)),this.zoomInited=!0},z3.prototype.takeScreenshot=function(e){var o=this,i=function(){};return BABYLON.Tools.CreateScreenshotUsingRenderTarget(this.engine,this.camera,320,function(t){o.b64toBlob(t,e,i)})},z3.prototype.takeScreenshotDataURI=function(t){return BABYLON.Tools.CreateScreenshotUsingRenderTarget(this.engine,this.camera,320,t)},z3.prototype.checkForDupMeshesOnScene=function(){for(var t=this.scene.meshes,e=0;e<t.length;e++)for(var o=t[e],i=e+1;i<t.length;i++){if(o==t[i])o.name}},z3.GetNodeScaleToMatrixRef=function(t,e){var o=z3.tempVecs[0];for(o.x=1,o.y=1,o.z=1;t&&t.scaling;)o.x*=t.scaling.x,o.y*=t.scaling.y,o.z*=t.scaling.z,t=t.parent;BABYLON.Matrix.ScalingToRef(o.x,o.y,o.z,e)},z3.GetNodeScaleToVectorRef=function(t,e){var o=e;for(o.x=1,o.y=1,o.z=1;t&&t.scaling;)o.x*=t.scaling.x,o.y*=t.scaling.y,o.z*=t.scaling.z,t=t.parent},z3.prototype.getScreenPoint=function(t){var e=this.canvas,o=this.scene.getTransformMatrix(),i=this.scene.activeCamera.viewport,n=BABYLON.Vector3.Project(t,this.identityMatrix,o,i);return n.x=n.x*e.clientWidth,n.y=n.y*e.clientHeight,n},z3.prototype.projectToRef=function(t,e,o,i,n){var s=i.width,ch=i.height,a=i.x,r=i.y,c=this._viewportMatrixCache;BABYLON.Matrix.FromValuesToRef(s/2,0,0,0,0,-ch/2,0,0,0,0,.5,0,a+s/2,ch/2+r,.5,1,c);var d=this._matrix;return e.multiplyToRef(o,d),d.multiplyToRef(c,d),BABYLON.Vector3.TransformCoordinatesToRef(t,d,n)},z3.prototype.getScreenPointToRef=function(t,e,o){var i=this.canvas,n=this.scene.getTransformMatrix(),s=this.scene.activeCamera.viewport;return o||(o=this.identityMatrix),this.projectToRef(t,o,n,s,e),e.x*=i.clientWidth,e.y*=i.clientHeight,e},Object.defineProperty(z3.prototype,"targetMesh",{get:function(){return this._targetMesh},set:function(t){this._targetMesh=t,this._camera2&&(this._camera2.lockedTarget=t)},enumerable:!1,configurable:!0}),z3.prototype.switchCameras=function(){this._camera2||(this._camera2=new BABYLON.ArcRotateCamera("ArcRotateCamera",.75*-Math.PI,1.2,15,new BABYLON.Vector3(0,0,0),this.scene),this._camera2.wheelPrecision=70,this._camera2.lockedTarget=this._targetMesh),this.scene.activeCamera==this._camera2?(this._camera2.detachControl(this.canvas),this.scene.activeCamera=this.camera,this._bindedZoomWithWheel&&this.addZoomCameraWithMouseWheel(),this.scene.registerBeforeRender(this._bindedCheckDragCamera)):(this._bindedZoomWithWheel&&this.removeZoomCameraWithMouseWheel(),this._camera2.attachControl(this.canvas,!0),this.scene.activeCamera=this._camera2,this._camera2.lockedTarget=this._targetMesh,this.scene.unregisterBeforeRender(this._bindedCheckDragCamera))},z3.prototype.addZoomCameraWithMouseWheel=function(){this._bindedZoomWithWheel||(this._bindedZoomWithWheel=this.zoomCameraWithWheel.bind(this)),this.canvas.addEventListener("wheel",this._bindedZoomWithWheel,!1)},z3.prototype.removeZoomCameraWithMouseWheel=function(){this.canvas.removeEventListener("wheel",this._bindedZoomWithWheel,!1)},z3.prototype.registerWithz1080s=function(t){this.spsManagerManager.registerWithz1080s(t)},z3.prototype.scalez1080s=function(t,e){void 0===t&&(t=1),this.spsManagerManager.scalez1080s(t,e)},z3.prototype.setParentz1080s=function(t,e){this.spsManagerManager.setParentz1080s(t,e)},z3.prototype.b64toBlob=function(t,e,o){var i=new Image;i.onerror=o,i.onload=function onload(){var t=document.createElement("canvas");t.width=i.width,t.height=i.height,t.getContext("2d").drawImage(i,0,0,t.width,t.height),t.toBlob(e)},i.src=t},z3.POINTER_DOWN=1,z3.POINTER_UP=2,z3.POINTER_EXIT=3,z3.POINTER_ENTER=4,z3.POINTER_MOVE=5,z3.AFTER_LOADED=6,z3.POINTER_DOWN_LONG=7,z3.CAMERA_DRAG_STOPPED=10,z3.CAMERA_ZOOM_STOPPED=11,z3.CAMERA_MOVE=12,z3.SCREEN_RESIZED=13,z3.meshes={},z3.drawTextureFunctions={},z3.tempVecs=[BABYLON.Vector3.Zero()],z3}(),C.z3=e}(z2||(z2={})),function(t){!function(t){var a=function SubInfo(t,e){this.callback=null,this.scope=null,this.callback=t,this.scope=e};t.SubInfo=a;var e=function(){function Pubsub(){this.subs={}}return Pubsub.prototype.subscribe=function(t,e,o){this.subs[t]||(this.subs[t]=[]);for(var i=0,n=this.subs[t];i<n.length;i++){var s=n[i];if(s.callback==e&&s.scope==o)return}this.subs[t].push(new a(e,o))},Pubsub.prototype.unsubscribe=function(t,e,o){var i=this.subs[t];if(i&&i.length)if(e){for(var n=-1,s=0;s<i.length;s++){var a=i[s];if(a.callback===e&&a.scope===o){n=s;break}}0<=n&&i.splice(n,1)}else i.length=0},Pubsub.prototype.broadcast=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var i=this.subs[t];if(i)for(var n=0,s=i;n<s.length;n++){var a=s[n];a.callback.apply(a.scope,e)}},Pubsub}();t.Pubsub=e}(t.Events||(t.Events={}))}(z2||(z2={})),function(t){var e,o;e=t.Helpers||(t.Helpers={}),o=function(){function ObjectPool(){}return ObjectPool.subscribe=function(t,e,o){void 0===o&&(o=""),o=o.toLowerCase(),ObjectPool.pubsub.subscribe(o,t,e)},ObjectPool.unsubscribe=function(t,e,o){void 0===o&&(o=""),o=o.toLowerCase(),ObjectPool.pubsub.unsubscribe(o,t,e)},ObjectPool.getNumObjectsRemaining=function(t){t=t.toLowerCase();var e=ObjectPool.objMaxCounts[t],o=ObjectPool.objNumInUse[t];return-1==e?-1:e-o},ObjectPool.addClass=function(t,e,o,i){void 0===o&&(o=null),void 0===i&&(i=-1),t=t.toLowerCase(),ObjectPool.classes[t]=e,ObjectPool.objMaxCounts[t]=i,ObjectPool.objNumInUse[t]=0,o&&(ObjectPool.initParams[t.toLowerCase()]=o)},ObjectPool.get=function(t,e,o,i){void 0===e&&(e=null),void 0===o&&(o=!1),void 0===i&&(i=!1),ObjectPool.pubsub.broadcast("before_get",t,e),t=t.toLowerCase(),ObjectPool.pubsub.broadcast("before_get_"+t,t,e);var n=ObjectPool.classes[t];if(null!=n){var s,a=!1,r=ObjectPool.recycled[t];if(r&&0<r.length&&!i?s=r.pop():(a=!0,(s=new n)._className!=t&&(s._className=t),null==s._inObjectPool&&(s._inObjectPool=!1)),s._inObjectPool=!1,ObjectPool.objNumInUse[s._className]++,o)return ObjectPool.pubsub.broadcast(t,s,a),ObjectPool.pubsub.broadcast("",s),s;var c=ObjectPool.initParams[t];if(c&&e){var d={};for(var p in c)d[p]=c[p];for(var p in e)d[p]=e[p];s.init(d)}else e?s.init(e):c&&s.init(c);return ObjectPool.pubsub.broadcast(t,s,a),ObjectPool.pubsub.broadcast("",s),s}},ObjectPool.recycle=function(t){if(t._className&&!t._inObjectPool){ObjectPool.objNumInUse[t._className]--;var e=ObjectPool.recycled[t._className];e||(e=[],ObjectPool.recycled[t._className]=e),t._inObjectPool=!0,e.push(t),ObjectPool.pubsub.broadcast("recycled",t)}},ObjectPool.remove=function(t){for(var e=ObjectPool.recycled[t._className],o=0;o<e.length;o++)if(e[o]===t)return e.splice(o,1),void(t._inObjectPool=!1)},ObjectPool.recycled={},ObjectPool.classes={},ObjectPool.objMaxCounts={},ObjectPool.objNumInUse={},ObjectPool.initParams={},ObjectPool.pubsub=new t.Events.Pubsub,ObjectPool}(),e.ObjectPool=o}(z2||(z2={})),function(t){var e,o,i;e=t.Graphics||(t.Graphics={}),o=t.Helpers.ObjectPool,i=function(){function z1068(){this.onChangeObservable=new BABYLON.Observable,this.solidParticleIndex=-1,this.isOnScene=!1,this.renderingGroupID=0,this.position=BABYLON.Vector3.Zero(),this.scaling=BABYLON.Vector3.One(),this.rotationQuaternion=BABYLON.Quaternion.Identity(),this.rotation=BABYLON.Vector3.Zero(),this.worldMatrix=BABYLON.Matrix.Identity(),this.shapeName="",this.color=new BABYLON.Color4(1,1,1,1),this.tileNum=0,this.textureName="",this.forceUpdate=!1,this.shapeEnabled=!0,this.uvDirty=!0,this.requestDepthSort=!1,this.onAfterDepthSort=void 0,this.onBeforeDepthSort=void 0,this.id="SPP"+z1068.count++}return z1068.prototype.setTileNum=function(t){this.tileNum=t,this.forceUpdate=!0,this.onChangeObservable.notifyObservers(this)},z1068.prototype.setTexture=function(t){this.textureName=t,this.forceUpdate=!0,this.onChangeObservable.notifyObservers(this)},z1068.prototype.translate=function(t,e,o){this.position.x+=t,this.position.y+=e,this.position.z+=o,this.onChangeObservable.notifyObservers(this)},z1068.prototype.setPosition=function(t,e,o,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=0),void 0===i&&(i=!1),t==this.position.x&&e==this.position.y&&o==this.position.z||(this.position.x=t,this.position.y=e,this.position.z=o,this.worldMatrix.setTranslation(this.position),i||this.onChangeObservable.notifyObservers(this))},z1068.prototype.setRotation=function(t,e,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=0),t==this.rotation.x&&e==this.rotation.y&&o==this.rotation.z||(this.rotation.x=t,this.rotation.y=e,this.rotation.z=o,BABYLON.Quaternion.RotationYawPitchRollToRef(e,t,o,this.rotationQuaternion),this.rotationQuaternion.toRotationMatrix(this.worldMatrix),this.worldMatrix.setTranslation(this.position),this.onChangeObservable.notifyObservers(this))},z1068.prototype.setRotationMatrix=function(t){this.worldMatrix.copyFrom(t),this.worldMatrix.setTranslation(this.position),BABYLON.Quaternion.FromRotationMatrixToRef(t,this.rotationQuaternion),this.onChangeObservable.notifyObservers(this)},z1068.prototype.setColor=function(t,e,o,i){var n=this;n.color.r==t&&n.color.g==e&&n.color.b==o&&n.color.a==i||(n.color.r=t,n.color.g=e,n.color.b=o,null!=i&&(n.color.a=i),n.onChangeObservable.notifyObservers(n))},z1068.prototype.setScale=function(t,e,o){var i=this.scaling;!i||i.x==t&&i.y==e&&i.z==o||(i.x=t,i.y=e,i.z=o,this.onChangeObservable.notifyObservers(this))},z1068.prototype.init=function(t){var e=0,o=0,i=0,n=0,s=0,a=0,r=1,c=1,d=1;null!=t.x&&(e=t.x),null!=t.y&&(o=t.y),null!=t.z&&(i=t.z),null!=t.rx&&(n=t.rx),null!=t.ry&&(s=t.ry),null!=t.rz&&(a=t.rz),null!=t.sx&&(r=t.sx),null!=t.sy&&(c=t.sy),null!=t.sz&&(d=t.sz),null!=t.name?this.shapeName=t.name:null!=t.shapeName&&(this.shapeName=t.shapeName),null!=t.renderingGroupID&&null!=t.renderingGroupID&&(this.renderingGroupID=t.renderingGroupID),t.skipAddToScene||this.addToScene(),t.color&&this.setColor(t.color.r,t.color.g,t.color.b),t.textureName&&this.setTexture(t.textureName),this.scaling.x=r,this.scaling.y=c,this.scaling.z=d,this.setRotation(n,s,a),this.setPosition(e,o,i)},z1068.prototype.recycle=function(){this.onChangeObservable.notifyObservers(this,2),this.onChangeObservable.clear(),o.recycle(this)},z1068.prototype.addToScene=function(){this.isOnScene||(this.isOnScene=!0,this.onChangeObservable.notifyObservers(this))},z1068.prototype.removeFromScene=function(){this.isOnScene&&(this.isOnScene=!1,this.onChangeObservable.notifyObservers(this))},z1068.prototype.getDirectionToRef=function(t,e){BABYLON.Vector3.TransformNormalToRef(t,this.worldMatrix,e)},z1068.prototype.getDirection=function(t){return BABYLON.Vector3.TransformNormal(t,this.worldMatrix)},z1068.prototype.onPickDown=function(t){this.onPickDownObservable&&this.onPickDownObservable.notifyObservers({eventData:t,obj:this})},z1068.prototype.addPickDownObserver=function(t,e,o){void 0===o&&(o=!1),this.onPickDownObservable?this.onPickDownObservable.removeCallback(t):this.onPickDownObservable=new BABYLON.Observable,this.onPickDownObservable.add(t,-1,o,e)},z1068.prototype.setBodyRotationQuaternion=function(t){var e=t.w,o=t.x,i=t.y,n=t.z,s=this.body.orientation;s.s=e;var a=2*(s.x=o),r=2*(s.y=i),c=2*(s.z=n),d=o*a,p=i*r,l=n*c,u=o*r,y=i*c,g=o*c,m=e*a,f=e*r,A=e*c,b=this.body.rotation.elements,v=this.body.shapes.rotation.elements;v[0]=b[0]=1-p-l,v[1]=b[1]=u-A,v[2]=b[2]=g+f,v[3]=b[3]=u+A,v[4]=b[4]=1-d-l,v[5]=b[5]=y-m,v[6]=b[6]=g-f,v[7]=b[7]=y+m,v[8]=b[8]=1-d-p,this.body.shapes.updateProxy()},z1068.count=0,z1068}(),e.z1068=i}(z2||(z2={})),function(t){var u,e,o;u=t.Graphics||(t.Graphics={}),e=t.Helpers.ObjectPool,o=function(){function z1069(){this.isOnScene=!1,this.renderingGroupID=0,this.rotation=BABYLON.Vector3.Zero(),this.rotationQuaternion=BABYLON.Quaternion.Identity(),this.worldMatrix=BABYLON.Matrix.Identity(),this.shapeName="",this.color=new BABYLON.Color4(1,1,1,1),this.forceUpdate=!1,this.id="MI"+z1069.count++}return z1069.prototype.setTexture=function(t){this.textureName=t},z1069.prototype.translate=function(t,e,o){this.position.x+=t,this.position.y+=e,this.position.z+=o},z1069.prototype.setPosition=function(t,e,o,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=0),void 0===i&&(i=!1),t==this.position.x&&e==this.position.y&&o==this.position.z||(this.position.x=t,this.position.y=e,this.position.z=o,this.worldMatrix.setTranslation(this.position))},z1069.prototype.setRotation=function(t,e,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=0),t==this.rotation.x&&e==this.rotation.y&&o==this.rotation.z||(this.rotation.x=t,this.rotation.y=e,this.rotation.z=o,BABYLON.Quaternion.RotationYawPitchRollToRef(e,t,o,this.rotationQuaternion),this.rotationQuaternion.toRotationMatrix(this.worldMatrix),this.worldMatrix.setTranslation(this.position))},z1069.prototype.setColor=function(t,e,o,i){var n=this;n.color.r==t&&n.color.g==e&&n.color.b==o&&n.color.a==i||(n.color.r=t,n.color.g=e,n.color.b=o,this.inst.instancedBuffers.color.r=t,this.inst.instancedBuffers.color.g=e,this.inst.instancedBuffers.color.b=o,null!=i&&(n.color.a=i,this.inst.instancedBuffers.color.a=i))},z1069.prototype.setScale=function(t,e,o){var i=this.scaling;!i||i.x==t&&i.y==e&&i.z==o||(i.x=t,i.y=e,i.z=o)},z1069.prototype.init=function(t){if(!this.inst){this.scene=t.scene;var e=t.meshName,o=u.z3.GetMesh(e);this.sourceMesh=o,this.inst=o.createInstance(t.name),this.inst.instancedBuffers.color=new BABYLON.Color4(1,Math.random(),Math.random(),1),this.inst.rotationQuaternion=this.rotationQuaternion,this.position=this.inst.position,this.scaling=this.inst.scaling,this.color=this.inst.instancedBuffers.color,t.isPickable?this.inst.isPickable=!0:this.inst.isPickable=!1,this.scene||(this.scene=this.inst.getScene()),this.scene.removeMesh(this.inst)}var i=0,n=0,s=0,a=0,r=0,c=0,d=1,p=1,l=1;null!=t.x&&(i=t.x),null!=t.y&&(n=t.y),null!=t.z&&(s=t.z),null!=t.rx&&(a=t.rx),null!=t.ry&&(r=t.ry),null!=t.rz&&(c=t.rz),null!=t.sx&&(d=t.sx),null!=t.sy&&(p=t.sy),null!=t.sz&&(l=t.sz),null!=t.name&&(this.shapeName=t.name),t.skipAddToScene||this.addToScene(),t.color&&this.setColor(t.color.r,t.color.g,t.color.b),t.tileName&&this.setUVFromTileName(t.tileName),this.scaling.x=d,this.scaling.y=p,this.scaling.z=l,this.setRotation(a,r,c),this.setPosition(i,n,s)},z1069.prototype.recycle=function(){e.recycle(this)},z1069.prototype.addToScene=function(){this.isOnScene||(this.isOnScene=!0,this.scene.addMesh(this.inst))},z1069.prototype.removeFromScene=function(){this.isOnScene&&(this.isOnScene=!1,this.scene.removeMesh(this.inst))},z1069.prototype.getDirectionToRef=function(t,e){BABYLON.Vector3.TransformNormalToRef(t,this.worldMatrix,e)},z1069.prototype.getDirection=function(t){return BABYLON.Vector3.TransformNormal(t,this.worldMatrix)},z1069.prototype.onPickDown=function(t){this.onPickDownObservable&&this.onPickDownObservable.notifyObservers({eventData:t,obj:this})},z1069.prototype.addPickDownObserver=function(t,e,o){void 0===o&&(o=!1),this.onPickDownObservable?this.onPickDownObservable.removeCallback(t):this.onPickDownObservable=new BABYLON.Observable,this.onPickDownObservable.add(t,-1,o,e)},z1069.prototype.setBodyRotationQuaternion=function(t){var e=t.w,o=t.x,i=t.y,n=t.z,s=this.body.orientation;s.s=e;var a=2*(s.x=o),r=2*(s.y=i),c=2*(s.z=n),d=o*a,p=i*r,l=n*c,u=o*r,y=i*c,g=o*c,m=e*a,f=e*r,A=e*c,b=this.body.rotation.elements,v=this.body.shapes.rotation.elements;v[0]=b[0]=1-p-l,v[1]=b[1]=u-A,v[2]=b[2]=g+f,v[3]=b[3]=u+A,v[4]=b[4]=1-d-l,v[5]=b[5]=y-m,v[6]=b[6]=g-f,v[7]=b[7]=y+m,v[8]=b[8]=1-d-p,this.body.shapes.updateProxy()},z1069.prototype.setUVFromTileName=function(t){u.TileSet.TileInfos[t].tileSet.setUVFromTileName(t,this.inst.instancedBuffers.tileOffset)},z1069.count=0,z1069}(),u.z1069=o}(z2||(z2={})),function(t){var u,e,o;u=t.Graphics||(t.Graphics={}),e=t.Helpers.ObjectPool,o=function(){function z1070(){this.isOnScene=!1,this.renderingGroupID=0,this.rotation=BABYLON.Vector3.Zero(),this.rotationQuaternion=BABYLON.Quaternion.Identity(),this.worldMatrix=BABYLON.Matrix.Identity(),this.shapeName="",this.color=new BABYLON.Color4(1,1,1,1),this.forceUpdate=!1,this._tempArr=[1,1,1,1],this._tempArr2=[1,1,1,1],0==z1070.count&&z1070.MatrixOffScene.setTranslationFromFloats(999,999,999),this.id="MT"+z1070.count++}return z1070.prototype.setTexture=function(t){this.textureName=t},z1070.prototype.translate=function(t,e,o){this.position.x+=t,this.position.y+=e,this.position.z+=o,this.worldMatrix.setTranslation(this.position),this.sourceMesh.thinInstanceSetMatrixAt(this.instID,this.worldMatrix,!0)},z1070.prototype.setPosition=function(t,e,o,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=0),void 0===i&&(i=!1),t==this.position.x&&e==this.position.y&&o==this.position.z||(this.position.x=t,this.position.y=e,this.position.z=o,this.worldMatrix.setTranslation(this.position),this.sourceMesh.thinInstanceSetMatrixAt(this.instID,this.worldMatrix,!0))},z1070.prototype.setRotation=function(t,e,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=0),t==this.rotation.x&&e==this.rotation.y&&o==this.rotation.z||(this.rotation.x=t,this.rotation.y=e,this.rotation.z=o,BABYLON.Quaternion.RotationYawPitchRollToRef(e,t,o,this.rotationQuaternion),this.rotationQuaternion.toRotationMatrix(this.worldMatrix),this.worldMatrix.setTranslation(this.position),this.sourceMesh.thinInstanceSetMatrixAt(this.instID,this.worldMatrix,!0))},z1070.prototype.setColor=function(t,e,o,i){void 0===i&&(i=1);var n=this;n.color.r==t&&n.color.g==e&&n.color.b==o&&n.color.a==i||(n.color.r=t,n.color.g=e,n.color.b=o,null!=i&&(n.color.a=i),this._tempArr[0]=t,this._tempArr[1]=e,this._tempArr[2]=o,this._tempArr[3]=i,this.sourceMesh.thinInstanceSetAttributeAt("color",this.instID,this._tempArr,!0))},z1070.prototype.setUVFromTileName=function(t){var e=u.TileSet.TileInfos[t].tileSet,o=z1070.babVec4;e.setUVFromTileName(t,o),this._tempArr2[0]=o.x,this._tempArr2[1]=o.y,this._tempArr2[2]=o.z,this._tempArr2[3]=o.w,this.sourceMesh.thinInstanceSetAttributeAt("tileOffset",this.instID,this._tempArr2,!0)},z1070.prototype.setScale=function(t,e,o){var i=this.scaling;!i||i.x==t&&i.y==e&&i.z==o||(i.x=t,i.y=e,i.z=o)},z1070.prototype.init=function(t){if(!this.sourceMesh){this.scene=t.scene;var e=t.sourceMesh,o=t.meshName;o&&(e=u.z3.GetMesh(o)),this.sourceMesh=e,this.instID=e.thinInstanceAdd(this.worldMatrix,!0),this.color=new BABYLON.Color4,this.position=BABYLON.Vector3.Zero(),this.scaling=BABYLON.Vector3.One()}var i=0,n=0,s=0,a=0,r=0,c=0,d=1,p=1,l=1;null!=t.x&&(i=t.x),null!=t.y&&(n=t.y),null!=t.z&&(s=t.z),null!=t.rx&&(a=t.rx),null!=t.ry&&(r=t.ry),null!=t.rz&&(c=t.rz),null!=t.sx&&(d=t.sx),null!=t.sy&&(p=t.sy),null!=t.sz&&(l=t.sz),null!=t.name&&(this.shapeName=t.name),t.skipAddToScene||this.addToScene(),t.tileName&&this.setUVFromTileName(t.tileName),t.color&&this.setColor(t.color.r,t.color.g,t.color.b),this.scaling.x=d,this.scaling.y=p,this.scaling.z=l,this.setRotation(a,r,c),this.setPosition(i,n,s)},z1070.prototype.recycle=function(){e.recycle(this)},z1070.prototype.addToScene=function(){this.isOnScene||(this.isOnScene=!0,this.sourceMesh.thinInstanceSetMatrixAt(this.instID,this.worldMatrix,!0))},z1070.prototype.removeFromScene=function(){this.isOnScene&&(this.isOnScene=!1,this.sourceMesh.thinInstanceSetMatrixAt(this.instID,z1070.MatrixOffScene,!0))},z1070.prototype.getDirectionToRef=function(t,e){BABYLON.Vector3.TransformNormalToRef(t,this.worldMatrix,e)},z1070.prototype.getDirection=function(t){return BABYLON.Vector3.TransformNormal(t,this.worldMatrix)},z1070.prototype.onPickDown=function(t){this.onPickDownObservable&&this.onPickDownObservable.notifyObservers({eventData:t,obj:this})},z1070.prototype.addPickDownObserver=function(t,e,o){void 0===o&&(o=!1),this.onPickDownObservable?this.onPickDownObservable.removeCallback(t):this.onPickDownObservable=new BABYLON.Observable,this.onPickDownObservable.add(t,-1,o,e)},z1070.prototype.setBodyRotationQuaternion=function(t){var e=t.w,o=t.x,i=t.y,n=t.z,s=this.body.orientation;s.s=e;var a=2*(s.x=o),r=2*(s.y=i),c=2*(s.z=n),d=o*a,p=i*r,l=n*c,u=o*r,y=i*c,g=o*c,m=e*a,f=e*r,A=e*c,b=this.body.rotation.elements,v=this.body.shapes.rotation.elements;v[0]=b[0]=1-p-l,v[1]=b[1]=u-A,v[2]=b[2]=g+f,v[3]=b[3]=u+A,v[4]=b[4]=1-d-l,v[5]=b[5]=y-m,v[6]=b[6]=g-f,v[7]=b[7]=y+m,v[8]=b[8]=1-d-p,this.body.shapes.updateProxy()},z1070.babVec4=BABYLON.Vector4.Zero(),z1070.count=0,z1070.MatrixOffScene=BABYLON.Matrix.Identity(),z1070}(),u.z1070=o}(z2||(z2={})),function(t){!function(t){var e=function ITileSetData(){this.width=1024,this.height=1024};t.ITileSetData=e;var i=function TileInfo(t,e,o){this.column=0,this.row=0,this.name=t,this.tileSet=e,this.drawFunc=o};t.TileInfo=i;var o=function(){function TileSet(t,e,o,i,n,s){void 0===o&&(o=4),void 0===i&&(i=4),void 0===n&&(n=1024),void 0===s&&(s=1024),this.name="",this.numRows=4,this.numCols=4,this.width=1024,this.height=1024,this.tileWidth=256,this.tileHeight=256,this._numTiles=0,this.tileInfosByName={},this.name=t,this.scene=e,this.tileWidth=this.width/i,this.tileHeight=this.height/o,this.numRows=o,this.numCols=i,this.width=n,this.height=s}return Object.defineProperty(TileSet.prototype,"numTiles",{get:function(){return this._numTiles},set:function(t){this._numTiles=t},enumerable:!1,configurable:!0}),TileSet.prototype.drawTile=function(t,e){if(!this.tileInfosByName[t]){var o=new i(t,this,e);this.addTextureToTileSet(o),this.tileInfosByName[t]=o,TileSet.TileInfos[t]=o}},TileSet.prototype.createTextureCanvas=function(){if(""==this.name&&this.name,!this.textureCanvas){var t,e=this.numCols*this.tileWidth,o=this.numRows*this.tileHeight;this.textureCanvas=document.createElement("canvas"),TileSet.numCanvases++,this.textureCanvas.id="canvas"+TileSet.numCanvases,this.textureCanvas.width=e,this.textureCanvas.height=o,(t=this.textureCanvas.getContext("2d")).save(),t.restore()}},TileSet.prototype.addTextureToTileSet=function(t){""==this.name&&this.name,this.numTiles||(this.tileInfos=[]),this.tileInfos.push(t),this.numTiles++},TileSet.prototype.updateTile=function(t){var e=this.textureCanvas.getContext("2d"),o=this.tileWidth,i=this.tileHeight,n=this.tileInfos.indexOf(t),s=Math.floor(n/this.numCols),a=n%this.numCols,r=o*(t.column=a),c=i*(t.row=s);e.save(),e.translate(r,c),e.beginPath(),e.rect(0,0,o,i),e.clip(),t.drawFunc(e,o,i),e.restore()},TileSet.prototype.drawTileSet=function(){if(this.numTiles&&!this.textureCanvas){this.createTextureCanvas();for(var t=this.textureCanvas.getContext("2d"),e=this.tileWidth,o=this.tileHeight,i=0;i<this.tileInfos.length;i++){var n=this.tileInfos[i],s=Math.floor(i/this.numCols),a=i%this.numCols,r=e*(n.column=a),c=o*(n.row=s);t.save(),t.translate(r,c),t.beginPath(),t.rect(0,0,e,o),t.clip(),n.drawFunc(t,e,o),t.restore()}}},TileSet.prototype.setUVFromTileName=function(t,e){var o=this.tileInfosByName[t],i=o.column,n=this.numRows-1-o.row,s=1/this.numCols,a=1/this.numRows;e.x=i*s,e.y=n*a,e.z=e.x+s,e.w=e.y+a},TileSet.prototype.setUVFromTileName2=function(t,e){var o=this.tileInfosByName[t];if(o){var i=o.column,n=this.numRows-1-o.row;e.x=(i*this.tileWidth+0)/this.width,e.y=(n*this.tileHeight+0)/this.height,e.z=(this.tileWidth-0)/this.width,e.w=(this.tileHeight-0)/this.height}},TileSet.prototype.getTexture=function(){return this.texture||(this.texture=new BABYLON.Texture("data:"+this.textureCanvas.id,this.scene,!1,!0,null,null,null,this.textureCanvas.toDataURL())),this.texture},TileSet.TileInfos={},TileSet.numCanvases=0,TileSet}();t.TileSet=o}(t.Graphics||(t.Graphics={}))}(z2||(z2={})),function(t){var T,e;T=t.HSM||(t.HSM={}),e=function(){function z1071(){this.tempHSMs={}}return z1071.prototype.getHSM=function(t,e,o){var i="";return e&&(i=e.id),this.tempHSMs[t+"_"+i]||(this.tempHSMs[t+"_"+i]=new T.HSM(t,e,null,o)),this.tempHSMs[t+"_"+i]},z1071.prototype.load=function(t,e,o){void 0===e&&(e=null),void 0===o&&(o=!1);var i=t.getName(),n=new T.HSM(i,e,null,o);return this.createStates(t),e.isMenuItem&&e.isMenuItem,this.initStates(e,n,t,o),n},z1071.prototype.createStates=function(t){var e=t.getStates();if(e)for(var o=0,i=e;o<i.length;o++){var n=i[o];this.createStates(new n)}},z1071.prototype.createDecisionTree=function(t,e,o){var i=new T.z1086;if(t.nodes){i.nodes=[];for(var n=0;n<t.nodes.length;n++)i.nodes[n]=this.createDecisionTree(t.nodes[n],e,o);return i}if(t.previousState&&t.previousState,t.condition&&(i.condition=new t.condition),t.state||t.previousState){var s;if(t.actions)for(var a=0;a<t.actions.length;a++)t.actions[a],s||(s=new z1072),s.push(T.z641.getz767(t.actions[a]));t.previousState?i.transitionInfo=new T.z1089Info(null,t.level,s,!0):i.transitionInfo=new T.z1089Info(this.getHSM(t.state.name,e,o),t.level,s)}return t.trueNode&&(i.trueNode=this.createDecisionTree(t.trueNode,e,o)),t.falseNode&&(i.falseNode=this.createDecisionTree(t.falseNode,e,o)),i},z1071.prototype.initStates=function(t,e,o,i){void 0===i&&(i=!1);var n=o.getName();if(!e.initted){var s=o.getUpdatez156(),a=o.getEnterz156(),r=o.getExitz156(),c=o.getz1089s(),d=o.getListeners(),p=o.getStates(),l=o.getChildernListeners();if(e.setHistoryLength(o.historyLength),o.getInitialState()&&(e.initialState=this.getHSM(o.getInitialState().name,t,i)),s)for(var u=0;u<s.length;u++)s[u],e.actions.push(T.z641.getz767(s[u]));if(a)for(u=0;u<a.length;u++)a[u],e.entryz156.push(T.z641.getz767(a[u]));if(r)for(u=0;u<r.length;u++)r[u],e.exitz156.push(T.z641.getz767(r[u]));if(p)for(var y=0,g=p;y<g.length;y++){var m=g[y],f=this.getHSM(m.name,t,i);e.states.push(f);var A=new m;this.initStates(t,f,A),l&&this.addListeners(t,f,l,A,i)}if(c)for(u=0;u<c.length;u++){var b=c[u],v=null;if(b.actions){v=[];for(var x=0;x<b.actions.length;x++)v.push(T.z641.getz767(b.actions[x]))}var C=this.createDecisionTree(b,t,i),S=new T.z1087("",C,v,0,t);"z141"==n&&S.decisionTreeRoot.trueNode,e.transitions.push(S)}d&&this.addListeners(t,e,d,null,i),e.initted=!0}},z1071.prototype.addListeners=function(t,e,o,i,n){for(var s=0;s<o.length;s++){var a=o[s];if(i)if(i.allowEvents){if(-1===i.allowEvents.indexOf(a.event))continue}else if(i.ignoreEvents&&-1!==i.ignoreEvents.indexOf(a.event))continue;var r=0,c=null;if(a.state.name!=e.name){if(a.actions){c=[];for(var d=0;d<a.actions.length;d++)c.push(T.z641.getz767(a.actions[d]))}a.level&&(r=a.level);var p=this.getHSM(a.state.name,t,n),l=null;a.condition&&(l=new a.condition);var u=new T.z1088("TransListener"+e.name+"To"+p.name,p,a.event,l,c,r,t);e.transitions.push(u)}}},z1071}(),T.z1071=e}(z2||(z2={})),function(t){var e,o;e=t.HSM||(t.HSM={}),o=function(){function z49(){this.id="",this.historyLength=0}return z49.prototype.getEnterz156=function(){return this.enterz156},z49.prototype.getUpdatez156=function(){return this.updatez156},z49.prototype.getExitz156=function(){return this.exitz156},z49.prototype.getStates=function(){return this.states},z49.prototype.getz1089s=function(){return this.transitions},z49.prototype.getInitialState=function(){return this.initialState},z49.prototype.getListeners=function(){return this.listeners},z49.prototype.getChildernListeners=function(){return this.childrenListeners},z49.prototype.getName=function(){return this.constructor.name},z49.prototype.addState=function(t){this.states||(this.states=[]),this.states.push(t)},z49.prototype.addChildrenListener=function(t){this.childrenListeners||(this.childrenListeners=[]),this.childrenListeners.push(t)},z49.prototype.copyUpdatez156FromState=function(t){this.updatez156=this.updatez156.concat((new t).updatez156)},z49}(),e.z49=o}(z2||(z2={})),function(t){var e,o;e=t.HSM||(t.HSM={}),o=function(){function HSMManager(){this.states={},this.childStates={},this.childListeners={},this.hsmBuilder=new e.z1071}return HSMManager.prototype.addState=function(t,e,o,i,n){this.states[t]=e,o&&(this.childStates[t]=o),i&&(this.childListeners[t]=i)},HSMManager.prototype.createState=function(t,e,o){var i=new this.states[t],n=this.childStates[t],s=this.childListeners[t];if(n)for(var a=0;a<n.length;a++)i.addState(n[a]);if(s)for(a=0;a<s.length;a++)i.addChildrenListener(s[a]);return this.hsmBuilder.load(i,e,o)},HSMManager}(),e.HSMManager=o}(z2||(z2={})),function(t){var e,o;e=t.HSM||(t.HSM={}),o=function(){function z641(){}return z641.getz767=function(t){var e=t.name,o=z641.objs,i=o[e];return null==i&&(i=new t,o[e]=i),i},z641.getz767ByName=function(t){var e=z641.objs,o=e[t];return null==o&&(o=new z0.z156[t],e[t]=o),o},z641.objs=[],z641}(),e.z641=o}(z2||(z2={})),function(t){var e,o;e=t.HSM||(t.HSM={}),o=function(){function z767(){}return z767.prototype.update=function(t,e){void 0===t&&(t=null)},z767.tempVecs=[new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3],z767.tempQuats=[new OIMO.Quat,new OIMO.Quat,new OIMO.Quat,new OIMO.Quat],z767.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],z767.tempBabQuats=[BABYLON.Quaternion.Zero(),BABYLON.Quaternion.Zero()],z767.tempBabMats=[BABYLON.Matrix.Identity(),BABYLON.Matrix.Identity(),BABYLON.Matrix.Identity()],z767}(),e.z767=o}(z2||(z2={})),function(t){var e,o;e=t.HSM||(t.HSM={}),o=function(){function z770(){this.pass=!1}return z770.prototype.test=function(t,e){return!1},z770.prototype.update=function(t){},z770.tempVecs=[new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3],z770.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],z770}(),e.z770=o}(z2||(z2={})),function(t){var e,o;e=t.Debug||(t.Debug={}),o=function(){function RayViewer(t){this.line=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],this.mesh=BABYLON.Mesh.CreateLines("line",this.line,t,!0),this.mesh.renderingGroupId=2,this.mesh.material.checkReadyOnlyOnce=!0,this.mesh.color=new BABYLON.Color3(1,1,1),this.mesh.alwaysSelectAsActiveMesh=!0}return RayViewer.prototype.update=function(t,e,o){void 0===o&&(o=1);var i=this.line[0],n=this.line[1];i.x=t.x,i.y=t.y,i.z=t.z,n.x=i.x+e.x*o,n.y=i.y+e.y*o,n.z=i.z+e.z*o,BABYLON.Mesh.CreateLines(null,this.line,null,null,this.mesh)},RayViewer}(),e.RayViewer=o}(z2||(z2={})),function(t){!function(M){var I=[new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3],O=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()];M.GetRandomNum=function GetRandomNum(t,e){var o=e-t;return t+Math.random()*o},M.mod=function mod(t,e){return(t%e+e)%e},M.getVectorBetweenToRef=function getVectorBetweenToRef(t,e,o){o.x=e.x-t.x,o.y=e.y-t.y,o.z=e.z-t.z},M.distanceSquared=function distanceSquared(t,e){var o=t.x-e.x,i=t.y-e.y,n=t.z-e.z;return o*o+i*i+n*n},M.distanceSquaredXZ=function distanceSquaredXZ(t,e){var o=t.x-e.x,i=t.z-e.z;return o*o+i*i},M.distanceSquaredXY=function distanceSquaredXY(t,e){var o=t.x-e.x,i=t.y-e.y;return o*o+i*i},M.map=function map(t,e,o,i,n){return(t-e)/(o-e)*(n-i)+i},M.getAngDiff=function getAngDiff(t,e){var o=t-e;return(o%=2*Math.PI)>Math.PI?o-=2*Math.PI:o<-Math.PI&&(o+=2*Math.PI),o},M.fixAngle=function fixAngle(t){return(t%=2*Math.PI)<0?t+2*Math.PI:t},M.angleBetween=function angleBetween(t,e){var o=0;return(o=(t=(t%=2*Math.PI)<0?t+2*Math.PI:t)<(e=(e%=2*Math.PI)<0?e+2*Math.PI:e)?e-t:t-e)>Math.PI&&(o=2*Math.PI-o),o},M.lerpVec3ToRef=function lerpVec3ToRef(t,e,o,i){i.x=t.x+(e.x-t.x)*o,i.y=t.y+(e.y-t.y)*o,i.z=t.z+(e.z-t.z)*o},M.nlerpVec3ToRef=function nlerpVec3ToRef(t,e,o,i){i.x=t.x+(e.x-t.x)*o,i.y=t.y+(e.y-t.y)*o,i.z=t.z+(e.z-t.z)*o,i.normalize(i)},M.slerpVec3ToRef=function slerpVec3ToRef(t,e,o,i){var n=t.dot(e),s=Math.acos(n)*o,a=t.x*n,r=t.y*n,c=t.z*n;i.x=e.x-a,i.y=e.y-r,i.z=e.z-c,i.normalize(i);var d=Math.cos(s),p=Math.sin(s),l=t.x*d,u=t.y*d,y=t.z*d;i.x*=p,i.y*=p,i.z*=p,i.x+=l,i.y+=u,i.z+=y},M.lerpNumber=function lerpNumber(t,e,o){return t+(e-t)*o},M.getWorldMatrixFromAxes=function getWorldMatrixFromAxes(t,e,o){var i=O[1],n=O[2];void 0===e&&((e=O[3]).x=0,e.y=1,e.z=0),BABYLON.Vector3.CrossToRef(e,t,n),n.normalize(),BABYLON.Vector3.CrossToRef(n,t,i),i.normalize(),BABYLON.Matrix.FromXYZAxesToRef(n,t,i,o)},M.TransformNormalToRef=function TransformNormalToRef(t,e,o){var i=e._m,n=t.x,s=t.y,a=t.z;o.x=n*i[0]+s*i[4]+a*i[8],o.y=n*i[1]+s*i[5]+a*i[9],o.z=n*i[2]+s*i[6]+a*i[10]},M.RotationAxisToRef=function RotationAxisToRef(t,e,o){var i=Math.sin(-e),n=Math.cos(-e),c1=1-n,s=o._m;s[0]=t.x*t.x*c1+n,s[1]=t.x*t.y*c1-t.z*i,s[2]=t.x*t.z*c1+t.y*i,s[3]=0,s[4]=t.y*t.x*c1+t.z*i,s[5]=t.y*t.y*c1+n,s[6]=t.y*t.z*c1-t.x*i,s[7]=0,s[8]=t.z*t.x*c1-t.y*i,s[9]=t.z*t.y*c1+t.x*i,s[10]=t.z*t.z*c1+n,s[11]=0,s[15]=1,o._markAsUpdated()},M.Dot=function Dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},M.getCircleCircleIntersection=function getCircleCircleIntersection(t,e,o,i,n,r1,s,a){var r,c,d,p,h,l,u,y,g;return c=i-t,d=n-e,o+r1<(p=Math.sqrt(d*d+c*c))?0:p<Math.abs(o-r1)?0:(y=t+c*(r=(o*o-r1*r1+p*p)/(2*p))/p,g=e+d*r/p,l=(h=Math.sqrt(o*o-r*r))/p*-d,u=c*(h/p),s.x=y+l,a.x=y-l,s.y=g+u,a.y=g-u,1)},M.getTargetAroundCircle=function getTargetAroundCircle(t,e,o,i,n,s,a,r,c,d,p){void 0===d&&(d=0),void 0===p&&(p=null);var l=I[0],u=I[1],y=i-t,g=n-e,m=Math.sqrt(y*y+g*g),f=t+.5*(i-t),A=e+.5*(n-e);if(p&&(p.x=f,p.y=A),M.getCircleCircleIntersection(i,n,s+o,f,A,.5*m+o,l,u)){var b=!1;if(d&&(0<d?(c.x=l.x,c.y=l.y):(c.x=u.x,c.y=u.y),b=!0),!b){var v=a-l.x,x=r-l.y;v*v+x*x<(v=a-u.x)*v+(x=r-u.y)*x?(c.x=l.x,c.y=l.y):(c.x=u.x,c.y=u.y),b=!0}if(b){var C=I[2],S=I[3],T=I[4],B=I[5],O=I[6],P=I[7];return l.x=a,l.y=r,l.z=0,S.x=y/m,S.y=g/m,S.z=0,T.x=0,T.y=0,T.z=1,C.cross(S,T),B.x=t,B.y=e,B.z=0,M.getLocalPositionFromGlobalToRef(B,C,S,T,c,O),M.getLocalPositionFromGlobalToRef(B,C,S,T,l,P),O.y<P.y}}return!1},M.round=function round(t,e){var o=1;return e<1&&(t*=o=10,e*=o),Math.round(t/e)*e/o},M.roundToDecimalPlace=function roundToDecimalPlace(t,e){var o=Math.pow(10,e);return Math.round(t*o)/o},M.isAngleBetween=function isAngleBetween(t,e,o){if(t=(t%=2*Math.PI)<0?t+2*Math.PI:t,(e=(e%=2*Math.PI)<0?e+2*Math.PI:e)<(o=(o%=2*Math.PI)<0?o+2*Math.PI:o)){if(e<t&&t<o)return!0}else if(o<t&&t<e)return!0;return!1},M.WithinEpsilon=function WithinEpsilon(t,e,o){void 0===o&&(o=1401298e-51);var i=t-e;return-o<=i&&i<=o},M.getOIMOLocalPositionFromGlobalToRef=function getOIMOLocalPositionFromGlobalToRef(t,e,o){var i=t.rotation.elements,n=t.position,s=e.x-n.x,a=e.y-n.y,r=e.z-n.z;o.x=s*i[0]+a*i[3]+r*i[6],o.y=s*i[1]+a*i[4]+r*i[7],o.z=s*i[2]+a*i[5]+r*i[8]},M.getOIMOTranformCoordinatesToRef=function getOIMOTranformCoordinatesToRef(t,e,o){var i=t.rotation.elements,n=e.x,s=e.y,a=e.z;o.x=n*i[0]+s*i[1]+a*i[2],o.y=n*i[3]+s*i[4]+a*i[5],o.z=n*i[6]+s*i[7]+a*i[8]},M.getOIMOGlobalPositionFromLocalToRef=function getOIMOGlobalPositionFromLocalToRef(t,e,o){var i=t.rotation.elements,n=t.position,s=e.x,a=e.y,r=e.z;o.x=s*i[0]+a*i[1]+r*i[2]+n.x,o.y=s*i[3]+a*i[4]+r*i[5]+n.y,o.z=s*i[6]+a*i[7]+r*i[8]+n.z},M.getLocalPositionFromGlobalToRef=function getLocalPositionFromGlobalToRef(t,e,o,i,n,s){var a=n.x-t.x,r=n.y-t.y,c=n.z-t.z;s.x=a*e.x+r*e.y+c*e.z,s.y=a*o.x+r*o.y+c*o.z,s.z=a*i.x+r*i.y+c*i.z},M.setBodyRotationQuaternion=function setBodyRotationQuaternion(t,e){var o=e.w,i=e.x,n=e.y,s=e.z,a=t.orientation;a.s=o;var r=2*(a.x=i),c=2*(a.y=n),d=2*(a.z=s),p=i*r,l=n*c,u=s*d,y=i*c,g=n*d,m=i*d,f=o*r,A=o*c,b=o*d,v=t.rotation.elements,x=t.shapes.rotation.elements;x[0]=v[0]=1-l-u,x[1]=v[1]=y-b,x[2]=v[2]=m+A,x[3]=v[3]=y+b,x[4]=v[4]=1-p-u,x[5]=v[5]=g-f,x[6]=v[6]=m-A,x[7]=v[7]=g+f,x[8]=v[8]=1-p-l,t.shapes.updateProxy()},M.ArrayLerpToRef=function ArrayLerpToRef(t,e,o,i){for(var n=i.length,s=0;s<n;s++)i[s]=t[s]*(1-o)+e[s]*o},M.RayIntersectsTriangle=function RayIntersectsTriangle(t,e,o,i,n){var s=i.subtract(o),a=n.subtract(o),h=BABYLON.Vector3.Cross(e,a),r=BABYLON.Vector3.Dot(s,h);if(!(-1e-5<r&&r<1e-5)){var c=1/r,d=t.subtract(o),p=c*BABYLON.Vector3.Dot(d,h);if(!(p<0||1<p)){var l=BABYLON.Vector3.Cross(d,s),u=c*BABYLON.Vector3.Dot(e,l);if(!(u<0||1<p+u)){var y=c*BABYLON.Vector3.Dot(a,l);return 0<y?y:void 0}}}};BABYLON.Matrix.Identity();M.GetClosestPointToLineToRef=function GetClosestPointToLineToRef(t,e,o,i,n){var s=0,a=3,r=Number.MAX_VALUE,c=Number.MAX_VALUE,d=t.length,p=e.x,l=e.y,u=e.z;if(null==i||null==n){if(6<d)for(var y=0;y<d;y+=3){var g=(S=p-t[y])*S+(T=l-t[y+1])*T+(B=u-t[y+2])*B;g<r?(a=s,c=r,r=g,s=y):g<c&&(c=g,a=y)}if(c==Number.MAX_VALUE)return o.x=t[0],o.y=t[1],o.z=t[2],o;i=s,n=a}var m=O[0],f=O[1],A=O[2],b=O[3],v=t[i],x=t[i+1],C=t[i+2];b.x=p-v,b.y=l-x,b.z=u-C,m.x=t[n]-v,m.y=t[n+1]-x,m.z=t[n+2]-C,m.normalize(),b.normalize(),BABYLON.Vector3.CrossToRef(b,m,A),BABYLON.Vector3.CrossToRef(m,A,f);var S=e.x-v,T=e.y-x,B=e.z-C;b.x=S*m.x+T*m.y+B*m.z,b.y=S*f.x+T*f.y+B*f.z,b.z=S*A.x+T*A.y+B*A.z,S=b.x,T=0,B=b.z,o.x=S*m.x+T*f.x+B*A.x,o.y=S*m.y+T*f.y+B*A.y,o.z=S*m.z+T*f.z+B*A.z,o.x+=v,o.y+=x,o.z+=C},M.GetClosestPointToLine2ToRef=function GetClosestPointToLine2ToRef(t,e,o,i){var n=O[0],s=O[1],a=O[2],r=O[3],c=t.x,d=t.y,p=t.z,l=o.x,u=o.y,y=o.z;r.x=l-c,r.y=u-d,r.z=y-p,n.x=e.x-c,n.y=e.y-d,n.z=e.z-p,n.normalize(),r.normalize(),BABYLON.Vector3.CrossToRef(r,n,a),BABYLON.Vector3.CrossToRef(n,a,s);var g=o.x-c,m=o.y-d,f=o.z-p;r.x=g*n.x+m*n.y+f*n.z,r.y=g*s.x+m*s.y+f*s.z,r.z=g*a.x+m*a.y+f*a.z,g=r.x,m=0,f=r.z,i.x=g*n.x+m*s.x+f*a.x,i.y=g*n.y+m*s.y+f*a.y,i.z=g*n.z+m*s.z+f*a.z,i.x+=c,i.y+=d,i.z+=p},M.PointIsInRect=function PointIsInRect(t,e,o,i,n,s){return!(t<o-.5*n||o+.5*n<t||e<o-.5*s||i+.5*s<e)};var a=BABYLON.Vector3.Zero();M.LimitPointToCircsInRectXZ=function LimitPointToCircsInRectXZ(t,e,o,i,n,s){void 0===s&&(s=.15),a.x=t.x,a.y=t.z,a.z=0,M.LimitPointToCircsInRectXY(a,e,o,i,n,s),t.x=a.x,t.z=a.y},M.LimitPointToCircsInRectXY=function LimitPointToCircsInRectXY(t,e,o,i,n,s){void 0===s&&(s=.15);var a=t.x-e,r=t.y-o,c=a*a+r*r,d=.5*i,p=.5*n,l=t.x,u=t.y,y=t;if(i==n)(f=d-s)*f<c&&((A=O[1]).x=l-e,A.y=u-o,A.z=0,A.normalize(),y.x=e+A.x*f,y.y=o+A.y*f);else if(i<n){var g=.5*(n-i);-g<r&&r<g?d-s<a?y.x=e+d-s:a<-d+s&&(y.x=e-d+s):r<0?(f=d-s)*f<c&&((A=O[1]).x=l-e,A.y=u-(o-g),A.z=0,A.normalize(),y.x=e+A.x*f,y.y=o-g+A.y*f):0<r&&(f=d-s)*f<c&&((A=O[1]).x=l-e,A.y=u-(o+g),A.z=0,A.normalize(),y.x=e+A.x*f,y.y=o+g+A.y*f)}else if(n<i){var m=.5*(i-n);if(-m<a&&a<m)p-s<r?y.y=o+p-s:r<-p+s&&(y.y=o-p+s);else if(a<0)(f=p-s)*f<c&&((A=O[1]).x=l-(e-m),A.y=u-o,A.z=0,A.normalize(),y.x=e-m+A.x*f,y.y=o+A.y*f);else if(0<a){var f,A;(f=p-s)*f<c&&((A=O[1]).x=l-(e+m),A.y=u-o,A.z=0,A.normalize(),y.x=e+m+A.x*f,y.y=o+A.y*f)}}},M.Get2DLineIntersection=function Get2DLineIntersection(t,e,o,i,n,s,a,r,c){var d,p,l,u,y,g;return g=((l=a-n)*(e-s)-(u=r-s)*(t-n))/(-l*(p=i-e)+(d=o-t)*u),0<=(y=(-p*(t-n)+d*(e-s))/(-l*p+d*u))&&y<=1&&0<=g&&g<=1&&(c&&(c.x=t+g*d,c.y=e+g*p),!0)},M.RotatePoint2D=function RotatePoint2D(t,e,o){var i=t.x,n=t.y,s=Math.sin(e),a=Math.cos(e);o.x=i*a-n*s,o.y=i*s+n*a}}(t.z1||(t.z1={}))}(z2||(z2={})),function(t){var e,o;e=t.DataStructures||(t.DataStructures={}),o=function(){function z1072(){this.data=new Array,this.length=0}return z1072.prototype.clean=function(){for(var t=this.length;t<this.data.length;t++)this.data[t]=null},z1072.prototype.push=function(t){this.data[this.length]=t,this.length++},z1072.prototype.removeIndex=function(t){if(0<=t){for(var e=t;e<this.length-1;e++)this.data[e]=this.data[e+1];this.length--}},z1072.prototype.remove=function(t){var e=this.indexOf(t);if(0<=e){for(var o=e;o<this.length-1;o++)this.data[o]=this.data[o+1];this.length--}},z1072.prototype.pop=function(){return 0<this.length?(this.length--,this.data[this.length]):null},z1072.prototype.unshift=function(t,e){void 0===e&&(e=Number.MAX_VALUE);var o=this.length;e<o&&(o=e);for(var i=o;0<i;i--)this.data[i]=this.data[i-1];this.data[0]=t,e>this.length&&this.length++},z1072.prototype.shift=function(){if(0<this.length){for(var t=this.data[0],e=0;e>this.length;e++)this.data[e]=this.data[e+1];return this.length--,t}return null},z1072.prototype.getAtIndex=function(t){if(t<this.length)return this.data[t]},z1072.prototype.indexOf=function(t){var e=this.data.indexOf(t);return e>=this.length&&(e=-1),e},z1072.prototype.append=function(t){for(var e=t.data,o=t.length,i=this.data,n=0;n<o;n++)i[this.length]=e[n],this.length++},z1072.prototype.prepend=function(t){var e=t.data,o=t.length,i=this.data;if(0<o){0<this.length&&this.length;for(var n=this.length+o-1;o<=n;n--)i[n]=i[n-o];for(n=0;n<o;n++)i[n]=e[n];this.length+=o}},z1072.prototype.checkForDups=function(){for(var t=this.length,e=this.data,o={},i=!1,n=0;n<t;n++){var s=e[n].constructor.name;"String"==s&&(s=e[n]),o[s]=(o[s]||0)+1,1<o[s]&&(i=!0)}return i},z1072}(),e.z1072=o}(z2||(z2={})),function(t){var e,o;e=t.DataStructures||(t.DataStructures={}),o=function(){function z1072Set(){this.data=new e.z1072,this._dict=[],this._currentFrame=-1}return Object.defineProperty(z1072Set.prototype,"length",{get:function(){return this.data.length},enumerable:!1,configurable:!0}),z1072Set.prototype.push=function(t,e,o){return o!=this._currentFrame&&(this.clear(),this._currentFrame=o),this._dict[e]!=o&&(this._dict[e]=o,this.data.push(t),!0)},z1072Set.prototype.remove=function(t,e){e&&(this._dict[e]=-1),this.data.remove(t)},z1072Set.prototype.clear=function(){this.data.length=0},z1072Set.prototype.pop=function(){return this.data.pop()},z1072Set.prototype.getAtIndex=function(t){return this.data.data[t]},z1072Set}(),e.z1072Set=o}(z2||(z2={}));var iro,Dexie,net,z1072=z2.DataStructures.z1072,z1072Set=z2.DataStructures.z1072Set,z1080=z2.Graphics.z1080,z1068=z2.Graphics.z1068,z3=z2.Graphics.z3,z1069=z2.Graphics.z1069,z1070=z2.Graphics.z1070,TileSet=z2.Graphics.TileSet,TileInfo=z2.Graphics.TileInfo,ObjectPool=z2.Helpers.ObjectPool,Pubsub=z2.Events.Pubsub,HSM=z2.HSM.HSM,z1071=z2.HSM.z1071,HSMManager=z2.HSM.HSMManager,z767=z2.HSM.z767,z641=z2.HSM.z641,z770=z2.HSM.z770,z49=z2.HSM.z49,RayViewer=z2.Debug.RayViewer,AxisViewer=z2.Debug.AxisViewer,ABHSM=z2.HSM,z1=z2.z1,ABGraphics=z2.Graphics;!function(S){S.version="v1.3.21";var t=function(){function App(){var n=this;this.baseURL="https://hammyhome.com",this.world=null,this.time=0,this.objs=[],this.graph=null,this.habStorage=null,this.stateFactory=null,this.objsOnScene=[],this.pointerDownPosition=new z1085(0,0,0,!1),this.pointerDownObject=null,this.pointerMovePosition=BABYLON.Vector3.Zero(),this.pointerMoveIsBelowBedding=!1,this.lastFramePointerMoved=0,this.pickInfo=null,this.graphicsHelper=null,this.pathHelper=null,this.updateOnce=[],this.updateOnceNextFrame=[],this.updateOnceAfterRender=[],this.foodManager=null,this.frameNum=0,this.pubsub=new Pubsub,this.hsm=[],this.mainInputState=S.z150,this.translateCameraOnObjectClick=!1,this.embedVersion=!1,this.chromeExt=!1,this.doTouch=!0,this.bindedHandleMultiTouch=void 0,this.isPointerDown=!1,this.pointerDownID=-1,this.pointerDownStartPos=BABYLON.Vector2.Zero(),this._pointerDownHasMoved=!1,this._cageLastModified=0,this._cageLastViewed=0,this.distSqForPointerMove=9,this.interactMenuVisible=!0,this._homeIsLoaded=!1,this.testing=!1,this.rootURL="",this._savingCage=!1,this._cageURL="",this.zoomLevel=1,this._tempArr=[],this._tempVec=BABYLON.Vector3.Zero(),this.bindedAddPointerObservables=void 0,this.pointer1Pos=BABYLON.Vector2.Zero(),this.lastPointer1Pos=BABYLON.Vector2.Zero(),this.pointer2Pos=BABYLON.Vector2.Zero(),this.lastPointer2Pos=BABYLON.Vector2.Zero(),this.lastPointerDist=0,this.lastPointBtw=BABYLON.Vector2.Zero(),this.lastFrameHandleMultiTouch=0,this._multiTouch=!1,this._removingHab=!1,this.orphans=new z1072,this.pointerActiveTime=Date.now(),this.pointerInactiveNotificationTime=1e4,this.pointerInactiveNotificationSent=!1,this.pointerActiveNotificationSent=!0,this._updatePhysics=1,this._physicsFPS=60,this.loop=function(){var t=n.graphicsHelper.canvas,e=n.graphicsHelper.engine;t.width===t.clientWidth&&t.height===t.clientHeight||e.resize(),60==n._physicsFPS?n.update():(1==n._updatePhysics&&n.update(),n._updatePhysics*=-1),n.graphicsHelper.renderScene(),Date.now()-n.pointerActiveTime>n.pointerInactiveNotificationTime?n.pointerInactiveNotificationSent||(n.pubsub.broadcast(S.AppEvents.POINTER_INACTIVE),n.pointerInactiveNotificationSent=!0,n.pointerActiveNotificationSent=!1):n.pointerActiveNotificationSent||(n.pubsub.broadcast(S.AppEvents.POINTER_ACTIVE),n.pointerActiveNotificationSent=!0,n.pointerInactiveNotificationSent=!1)},this.update=function(){var t=S.app.hsm;S.app.frameNum++;for(var e=0;e<t.length;e++)for(var o=t[e].update().actions,i=0;i<o.length;i++)o.getAtIndex(i).update(n)},this._pointerDownObj=void 0,this._lastPointerDownObj=void 0,this.selectedCage=void 0,this._defaultURL="./",this._history=[],this.bindedHandleMultiTouch=this.handleMultiTouch.bind(this)}return App.AddEntityConfig=function(t){App.EntityConfigs.push(t)},App.Subscribe=function(t,e){App._Subs.push({event:t,callback:e})},Object.defineProperty(App.prototype,"pointerDownHasMoved",{get:function(){return this._pointerDownHasMoved},set:function(t){t!=this._pointerDownHasMoved&&(this._pointerDownHasMoved=t)},enumerable:!1,configurable:!0}),App.prototype.isHomeLoaded=function(){return this._homeIsLoaded},App.prototype.getCageID=function(){return this.habStorage.cageID},App.prototype.getz1064Items=function(){return this.menuItemInfo},App.prototype.loadObjectsFromString=function(t){S.z1073.LoadObjectsFromString(t),S.app.pubsub.broadcast(S.AppEvents.AFTER_z1048_LOAD)},App.prototype.subscribe=function(t,e,o){this.pubsub.subscribe(t,e,o)},App.prototype.unsubscribe=function(t,e,o){this.pubsub.unsubscribe(t,e,o)},App.prototype.getScene=function(){return this.graphicsHelper.scene},App.prototype.start=function(e){for(var t=0;t<App._Subs.length;t++){var o=App._Subs[t];this.pubsub.subscribe(o.event,o.callback)}this.initOimoPhysics(),this.initObjectPool();var i=[],n=[],s=[],a=[],r={},c={},d={},p=[],l=[],u=function(t,e,o){var i=0;(n=new BABYLON.StandardMaterial("",t)).specularColor.r=i,n.specularColor.g=i,n.specularColor.b=i,n.freeze(),o.default0=n;i=.1;(n=new BABYLON.StandardMaterial("",t)).specularColor.r=i,n.specularColor.g=i,n.specularColor.b=i,n.freeze(),o.lowSpecMat=n;var n;i=.7;(n=new BABYLON.StandardMaterial("",t)).specularColor.r=i,n.specularColor.g=i,n.specularColor.b=i,n.specularPower=8,n.freeze(),o.hiSpecMat=n};c.default0=u,c.lowSpecMat=u,c.hiSpecMat=u,this.menuItemInfo=p;var y=App.EntityConfigs,g=!1,m=!1,f=window.location.search.substring(1);if(""!=f)try{if(URLSearchParams){var A=new URLSearchParams(window.location.search);A.has("utm_source")&&("chrome_ext"==A.get("utm_source")?(g=!0,this.chromeExt=g,document.body.classList.add("small_ui")):"itchio"==A.get("utm_source")&&(m=!0)),A.has("hh")?this.json=S.z1073.ConvertCrushedQueryStringToJSON(decodeURIComponent(A.get("hh"))):this.json=S.z1073.ConvertCrushedQueryStringToJSON(decodeURIComponent(f))}else this.json=S.z1073.ConvertCrushedQueryStringToJSON(decodeURIComponent(f))}catch(t){}var b=!1;g||m||!window.parent||window.location===window.parent.location||(document.getElementById("main").classList.add("embed"),document.body.classList.add("embed"),b=!0,this.embedVersion=!0);for(var v=0;v<y.length;v++)y[v].initObjectPool&&y[v].initObjectPool(this.world),y[v].getSPSData&&y[v].getSPSData(a),y[v].getSceneFileNames&&y[v].getSceneFileNames(i),y[v].getCreateMaterialFunctions&&y[v].getCreateMaterialFunctions(c),y[v].getCreateMeshFunctions&&y[v].getCreateMeshFunctions(r),y[v].getTextureDrawFunctions&&n.push(y[v].getTextureDrawFunctions),b||y[v].getz1064Items&&y[v].getz1064Items(p),y[v].getTileSetData&&y[v].getTileSetData(l),y[v].getChildSPSData&&y[v].getChildSPSData(d);if(this.spsData=a,this.graph=new Graph,this.graphicsHelper=new z3,this.json||this.testing)return this.initGraphics({engine:e,models:i,textures:s,createMaterialFunctions:c,createMeshFunctions:r,createTextureFunctions:n,spsData:a,tileSetData:l,childSPSData:d,rootURL:this.rootURL});var x=this,C=this.graphicsHelper.createScene(e);return this.habStorage=new S.z1074,this.habStorage.getCageRecords(function(t){x.initGraphics({cage:t,scene:C,engine:e,models:i,textures:s,createMaterialFunctions:c,createMeshFunctions:r,createTextureFunctions:n,spsData:a,tileSetData:l,childSPSData:d,rootURL:x.rootURL})}),C},App.prototype.initGraphics=function(t){var e=null;if(t.cage)e=t.cage.parts;else if(this.json)e=this.json.names;else{this.starter=new S.z1067,e=this.starter.getStarterCageJSON().names}if(e){for(var o={},i=0;i<e.length;i++){var n=e[i];n.pname&&(n=n.pname),o[n]?o[n]++:o[n]=1}var s=t.childSPSData;for(var a in o)if(s[a]){var r=s[a],c=o[a];for(var d in r){var p=r[d];o[d]?o[d]+=c*p:o[d]=c*p}}var l=t.spsData;for(i=0;i<l.length;i++){var u=l[i];u.renderingGroupID!=App.menuRenderingGroupID&&(o[u.shapeName]?u.numInstances=o[u.shapeName]:u.numInstances=0)}}return this.graphicsHelper.subscribe(z3.AFTER_LOADED,this.init,this),this.graphicsHelper.init(t),this.graphicsHelper.scene.pointerDownPredicate=function(t){var e=t.isPickable&&t.isReady()&&t.isEnabled();return e=e||"hamsterBody"==t.name},this.graphicsHelper.scene},App.prototype.deleteStrayParts=function(){for(var t=0;t<this.objsOnScene.length;t++){var e=this.objsOnScene[t];2<=e.position.z?this.builder.deletePart(e):900<=e.position.y&&this.builder.deletePart(e)}},App.prototype.addPart=function(t){this.habStorage.cageID?this.habStorage.addPart(t):this.saveCage()},App.prototype.editPart=function(t){this.habStorage.cageID?this.habStorage.editPart(t):this.saveCage()},App.prototype.updateHamsAccess=function(t){var e=t;e.accType==S.z1044.z1056&&e.isOnScene&&e.updateNumHamsAccess();var o=t;if(o.accType==S.z1044.z1045&&o.isOnScene&&o.updateNumHamsAccess(),t.bones){for(var i=S.Bowl.activeObjects,n=0;n<i.length;n++)i[n].updateNumHamsAccess();i=S.WaterBottle.activeObjects;for(n=0;n<i.length;n++)i[n].updateNumHamsAccess()}},App.prototype.editCageName=function(t){this.getCageID()?(this.habStorage.editCageName(t),S.app.starter.updateCageName(t)):this.saveCage()},App.prototype.deletePart=function(t){this.habStorage.cageID?this.habStorage.deletePart(t):this.saveCage()},App.prototype.saveCage=function(){return __awaiter(this,void 0,void 0,function(){var e,o,i,n;return __generator(this,function(t){switch(t.label){case 0:return this._savingCage?[2]:this.getCageID()?[2]:(this._savingCage=!0,e=document.getElementById("title-input"),o=e.value,[4,this.habStorage.createNew(o)]);case 1:return t.sent(),[4,S.app.saveDataItem(S.AppSettings.GetInstance())];case 2:t.sent(),i=0,t.label=3;case 3:return i<this.objsOnScene.length?(n=this.objsOnScene[i]).saveToDB?[4,this.habStorage._addPart(n)]:[3,5]:[3,6];case 4:t.sent(),t.label=5;case 5:return i++,[3,3];case 6:return this.starter.onAfterCageAdded(this.getCageID()),this._savingCage=!1,[2]}})})},App.prototype.getCageURL=function(){this.objsOnScene.unshift(S.AppSettings.GetInstance());var t=S.z1073.ExportToCrushedQueryString(this.objsOnScene);return this.objsOnScene.shift(),this._cageURL=this.baseURL+"?hh="+encodeURIComponent(t),this._cageURL},App.prototype.setUIZoomLevel=function(){var t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,o="18px",i="20px",n="20px",s=1,a=.5*e-42+"px";S.app.chromeExt||S.app.embedVersion&&e<=400?(s=.75,o="0px",n=i="6px"):t<=400?(s=.75,o="0px",i=n="6px"):1024<=t&&1024<=e&&(s=1.5,i=n="40px",o="30px"),S.app.zoomLevel=s;var r=document.getElementById("aBowman");r.style.transform="scale("+s+")",r.style.transformOrigin="0 100%";var c=document.getElementById("start");c.style.transform="scale("+s+")",c.style.transformOrigin="0 0",c.style.width=1/s*100+"%",c.style.height=1/s*100+"%";var d=document.querySelector(".header");d&&(d.style.transform="scale("+s+")",d.style.transformOrigin="0 0",d.style.width=1/s*100+"%");var p=document.getElementById("zoom-ctn");p&&(p.style.transform="scale("+s+")",p.style.transformOrigin="100% 100%",p.style.bottom=a,p.style.right="0px");var l=document.querySelector("#interact_menu");l.style.transform="scale("+s+")",l.style.bottom=o;var u=document.querySelector("#fab_btn_edit");if(u.style.transform="scale("+s+")",u.style.bottom=i,u.style.right=n,t<275?(l.style.pointerEvents="all",l.style.right="40px",l.style.left="-15px",l.style.justifyContent="start",l.children[0].style.marginLeft="auto"):(l.style.pointerEvents="",l.style.right="0px",l.style.left="0px",l.style.justifyContent="center",l.children[0].style.marginLeft=""),S.app.builder){var y=document.getElementById("nav-ctn-parts");y.style.bottom=1<s?"175px":"125px";var g=document.querySelector("#close-btn-edit");g.style.transform="scale("+s+")",g.style.bottom=i,g.style.right=n;var m=document.querySelector("#parts-cat-ctn");m.style.transform="scale("+s+")",m.style.bottom=o,t<650?(m.style.pointerEvents="all",s<1?(m.style.right="20px",m.style.left="-40px"):(m.style.right="80px",m.style.left="0px"),m.style.justifyContent="start",m.children[0].style.marginLeft="auto"):(m.style.pointerEvents="",m.style.right="0px",m.style.left="0px",m.style.justifyContent="center",m.children[0].style.marginLeft="")}},App.prototype.init=function(){var i=this,n=this,e=this.graphicsHelper;this.pointerDownPosition.x=0,this.pointerDownPosition.y=0,this.pointerDownPosition.z=0;var t="http://localhost:8001/dist/index_dev.html";window.location.href==t&&(this._defaultURL=t);var o=e.scene;if(this.foodManager=new S.FoodManager(o),this.stateFactory=new S.z109(App.EntityConfigs),this.testing){this.subscribe(S.AppEvents.AFTER_z1048_LOAD,function(){S.z1073.ExportToCrushedQueryString(this.objsOnScene)},this);var s=(new z1071).load(new S.z151,this);return this.hsm.push(s),S.z1073.subscribe(S.z1073.AFTER_LOAD_EVENT,function(){i.addz1062sToCages()},this),e.engine.runRenderLoop(this.loop),void this.pubsub.broadcast(S.AppEvents.AFTER_INIT)}var a=document.getElementById("main");a.classList.add("loading");var r=S.z1073.CreateHTMLElementFromString('<div id="main-bottom-menu">\n                    <div id="interact_menu">\n                        <div class="chip" id="move-btn">\n                            <span class="icon-arrows"></span>\n                        </div>\n                        <div class="chip selected" id="touch-btn">\n                            <span class="icon-hand-o-up"></span>\n                        </div>\n                        <div class="chip" id="feed-btn">\n                            <span class="icon-treats"></span>\n                        </div>\n                    </div>\n                    <div id="fab_btn_edit" class="fab noselect"><span class=\'icon-create\'></span></div>\n                </div>');a.appendChild(r),document.getElementById("start").style.visibility="visible",document.getElementById("main").style.visibility="visible",document.getElementById("splash").style.display="none";var c=S.z1073.CreateHTMLElementFromString('<div class="progress-bar">\n                <div class="progress-bar-outer">\n                    <span class="progress-bar-inner"></span>\n                </div>\n            </div>');document.getElementById("main").appendChild(c);var d=new S.Background;d.init(o,31,31,0,0,2.01,0,0,0,1,null,.5,.5),d.mesh.enablePointerMoveEvents=!0,o.addMesh(d.mesh),this.background=d;var p=BABYLON.Vector3.Zero(),l=BABYLON.Vector3.Zero();l.x=15.5,p.x=-15.5,l.y=15.5,p.y=-15.5,e.camBoundsMax=l,e.camBoundsMin=p,this.initInteractMenu(),this.graphicsHelper.subscribe(z3.POINTER_MOVE,this.onPointerMoveSetPosition),document.body.addEventListener("pointermove",function(t){n.pointerActiveTime=Date.now()}),document.body.addEventListener("pointerdown",function(t){n.pointerActiveTime=Date.now()}),window.addEventListener("resize",this.setUIZoomLevel,!1),this.pubsub.subscribe(S.AppEvents.POINTER_INACTIVE,function(){n.builder&&n.builder.isActive||n.shareMenu&&n.shareMenu.isActive||n.hideMainUI()},this),this.pubsub.subscribe(S.AppEvents.POINTER_ACTIVE,function(){n.builder&&n.builder.isActive||n.starter&&n.starter.isOpen||this.showMainUI()},this),this.addEventListeners(),e.initDragCamera(),S.z1073.subscribe(S.z1073.AFTER_LOAD_EVENT,function(){i.addz1062sToCages(),i.removeOrphans(),i.loadHamsMemory(),i._homeIsLoaded=!0},this),S.z1073.pubsub.subscribe(S.z1073.BEFORE_LOAD_EVENT,this.onLoadHomeStart),S.z1073.pubsub.subscribe(S.z1073.AFTER_LOAD_EVENT,this.onLoadHomeEnd),S.z1073.pubsub.subscribe(S.z1073.LOAD_PROGRESS_CHANGED,this.updateProgressBar);var u=BABYLON.MeshBuilder.CreateDisc("testTouchMesh",{radius:.1,tessellation:12});if(u.hasVertexAlpha=!0,this.touchMesh=new ABGraphics.TouchMesh(u,new BABYLON.StandardMaterial("",u.getScene()),200,1,1,1,.08),this.embedVersion){this.setUIZoomLevel(),document.getElementById("start").style.visibility="hidden",this.json?S.z1073.LoadObjectsFromJSON(this.json):(this.starter=new S.z1067,this.starter.loadStarterCage(0));s=(new z1071).load(new S.z153,this);this.hsm.push(s),e.engine.runRenderLoop(this.loop),this.pointerDownPosition.copyFrom(e.camera.position),this.pointerMovePosition.copyFrom(e.camera.position);for(var y=S.z1062.activeObjects,g=0;g<y.length;g++){(x=y[g]).isMenuItem||x.targets.pointerDownPosition.copyFrom(S.app.pointerDownPosition)}var m=this.graphicsHelper.spsManagerManager.spsManagers;for(var f in m){(b=m[f]).depthSort&&b.doDepthSort()}this.pubsub.broadcast(S.AppEvents.AFTER_INIT)}else{this.habStorage||(this.habStorage=new S.z1074),this.habStorage.subscribe(S.z1074.z1048_INFO_LOADED,function(t){t&&(document.getElementById("title-text").innerHTML=t.name,document.getElementById("title-input").value=t.name,null!=t.tx&&e.setCameraPosition(t.tx,t.ty,t.tz),i._cageLastModified=t.modified,i._cageLastViewed=t.lastViewed,i.starter.selectButton("button_"+t.id))},this),this.habStorage.subscribe(S.z1074.LOAD_PROGRESS_CHANGED,this.updateProgressBar),this.habStorage.subscribe(S.z1074.AFTER_LOAD_EVENT,function(t){t?(i.addz1062sToCages(),i.loadHamsMemory(),i.removeOrphans(),i._homeIsLoaded=!0,this.addToHistory("main")):(i.starter.openScreen(),i.starter.loadStarterCage(0)),i.onLoadHomeEnd()},this),this.habStorage.subscribe(S.z1074.BEFORE_LOAD_EVENT,function(t){i._homeIsLoaded=!1,i.onLoadHomeStart()},this);var A=this.graphicsHelper.spsManagerManager.spsManagers;for(var f in A){var b;(b=A[f]).depthSort&&this.habStorage.subscribe(S.z1074.AFTER_LOAD_EVENT,b.doDepthSort,b)}if(document.getElementById("fab_btn_edit").addEventListener("click",function(t){i.showBuildScreen(),i.addToHistory("build")}),this.preventMultipleTabIssues(),this.starter||(this.starter=new S.z1067),this.starter.init(),this.json){var v=this.json;S.z1073.LoadObjectsFromJSON(v),i.updateOnceNextFrame.push(function(){i.starter.addShared(v)}),window.history.pushState({},null,"")}else this.habStorage.load();this.initMainHeader(a);s=(new z1071).load(new S.z153,this);if(this.hsm.push(s),e.engine.runRenderLoop(this.loop),this.pointerDownPosition.copyFrom(e.camera.position),this.pointerMovePosition.copyFrom(e.camera.position),this.json&&!this.testing)for(y=S.z1062.activeObjects,g=0;g<y.length;g++){var x;(x=y[g]).isMenuItem||x.targets.pointerDownPosition.copyFrom(S.app.pointerDownPosition)}this.starter.closeScreen(),i.addToHistory("start"),window.addEventListener("popstate",function(t){i._history.pop();var e=i._history[i._history.length-1];if(window.history.pushState(e,null,n._defaultURL),"main"==e)n.builder.isActive?(o=i.hsm[0]).changeState(o.history.data[0].name):n.starter.closeScreen();else if("build"==e){var o;(o=i.hsm[0]).changeState(S.z155.name)}else n.starter.openScreen()}),this.graphicsHelper.subscribe(z3.CAMERA_DRAG_STOPPED,function(t){i.getCageID()&&i.saveDataItem(S.AppSettings.GetInstance())},this),this.graphicsHelper.subscribe(z3.CAMERA_ZOOM_STOPPED,function(t){i.getCageID()&&i.saveDataItem(S.AppSettings.GetInstance())},this),this.setUIZoomLevel(),this.pubsub.broadcast(S.AppEvents.AFTER_INIT)}},App.prototype.initInteractMenu=function(){var e=this;document.getElementById("feed-btn").addEventListener("click",function(t){e.hsm[0].changeState(S.z154.name),e.doTouch=!1}),document.getElementById("touch-btn").addEventListener("click",function(t){e.hsm[0].changeState(S.z150.name),e.doTouch=!0}),document.getElementById("move-btn").addEventListener("click",function(t){e.hsm[0].changeState(S.z152.name),e.doTouch=!1});document.getElementById("interact_menu").addEventListener("click",function(t){var e=t.target;if(e&&e.classList.contains("chip")){var o=e.parentNode.querySelector(".selected");o&&o!=e&&o.classList.remove("selected"),e.classList.add("selected")}})},App.prototype.initBuilder=function(t,e,o){var i=this,n=this.graphicsHelper;this.builder=new S.z1063(t,n,o),this.starter&&(this.builder.subscribe(S.z1063.ACCESSORY_CHANGED,this.starter.cageUpdated,this),this.builder.subscribe(S.z1063.ACCESSORY_ADDED,this.starter.cageUpdated,this)),this.builder.subscribe(S.z1063.ACCESSORY_DELETED,this.deletePart,this),this.builder.subscribe(S.z1063.ACCESSORY_ADDED,this.addPart,this),this.builder.subscribe(S.z1063.ACCESSORY_CHANGED,this.editPart,this),this.builder.subscribe(S.z1063.z1048_TITLE_UPDATED,this.editCageName,this),this.builder.subscribe(S.z1063.ACCESSORY_ADDED,this.updateHamsAccess,this),this.builder.subscribe(S.z1063.ACCESSORY_DELETED,this.updateHamsAccess,this),S.z1061Memory.subscribe(S.z1061Memory.EVENT_ADDED,this.updateHamsAccess,this),S.z1061Memory.subscribe(S.z1061Memory.EVENT_REMOVED,this.updateHamsAccess,this),this.builder.colorPicker2.subscribe(S.z1065.COLOR_ADDED,function(t){e.saveColors(t)},this),e.getColors(function(t){i.builder.colorPicker2.loadSavedColors(t)}),this.builder.bgPatternMenu.subscribe(S.z1066.PROP_CHANGED,function(t){S.app.saveDataItem(S.AppSettings.GetInstance())},this),this.setUIZoomLevel(),S.app.pubsub.broadcast(S.AppEvents.BUILDER_INITED,S.app.builder)},App.prototype.initMainHeader=function(t){var s=this,e=S.z1073.CreateHTMLElementFromString('\n                <div class=\'header noselect\'>\n                    <div class=\'back-btn\' id=\'main-back-btn\'>\n                        <span class=\'icon-angle-left\'></span>\n                    </div>\n                    <div class=\'title\'>\n                        <div id=\'title-text\'></div>\n                        <label id=\'title-input-label\' class="pure-material-textfield-outlined" style="display:none;">\n                            <input id=\'title-input\' placeholder=" " autocomplete="off" maxlength="30">\n                            <span>Name</span>\n                        </label>\n                    </div>\n                    \n                    <div class="header-middle-container">\n                        <div class="header-edit-btns">\n                            <div id="more-edit-options-btn">\n                                <span class="icon-more_vert"></span>\n                            </div>\n                        </div>\n                        <div id="more-edit-options-menu" class="drop-down-options noselect">\n                            <div id="bg-pattern-btn">Background Pattern</div>\n                            <div id="bg-color-btn">Background Color</div>\n                        </div>\n                    </div>\n                    \n                    <div class="header-btns-right">\n                        <div id="share-btn">\n                            <span class="icon-share"></span>\n                        </div>\n                        <div id="more-options-btn">\n                            <span class="icon-more_vert"></span>\n                        </div>\n                    </div>\n                    <div id="share-menu" class="share-dialog"></div>\n                    <div id="more-options-menu" class="drop-down-options noselect">\n                        <div id="delete-cage-btn"><span class="icon-trash"></span> Delete</div>\n                    </div>\n                </div>\n            ');t.appendChild(e);e.querySelector("#main-back-btn").addEventListener("click",function(t){s.starter.openScreen(),s.removeFromHistory("main"),s.addToHistory("start")});var i=this.background;e.querySelector("#title-input").addEventListener("keydown",function(t){13==t.which&&this.blur()}),document.getElementById("close-btn-start").addEventListener("click",function(t){s.addToHistory("main"),s.starter.closeScreen()}),document.getElementById("start").addEventListener("click",function(t){var e=t.target;if(e&&e.classList.contains("horiz-scroll-cont")){var o=e.children[e.children.length-1],i=o.offsetLeft+o.offsetWidth;t.x>i&&(s.addToHistory("main"),s.starter.closeScreen())}else e&&"IMG"==e.tagName||(s.addToHistory("main"),s.starter.closeScreen())});var o=new S.z1075;s.shareMenu=o;var n=document.getElementById("confirm-delete-dialog");n||((n=document.createElement("div")).id="confirm-delete-dialog",n.classList.add("dialog"),n.innerHTML='\n                <h3>Delete Cage</h3>\n                <p>Delete this cage permanently?</p>\n                <div class=\'action-group\'>\n                    <button id="confirm-delete-cage-btn">Delete</button>\n                    <button id="cancel-delete-cage-btn">Cancel</button>\n                </div>\n                ',t.appendChild(n));var a,r=function(){n.classList.remove("is-visible")},c=e.querySelector("#more-options-btn"),d=e.querySelector("#more-options-menu"),p=function(){d.classList.remove("is-visible")};c.addEventListener("pointerdown",function(){d.classList.contains("is-visible")?d.classList.remove("is-visible"):d.classList.add("is-visible")}),d.addEventListener("pointerup",function(t){"delete-cage-btn"==t.target.id&&(n.classList.contains("is-visible")?n.classList.remove("is-visible"):n.classList.add("is-visible")),p()}),document.body.addEventListener("pointerdown",function(t){var e=t.target;e!=c&&e!=d&&e.parentNode!=d&&p(),o.rootElement.classList.contains("is-visible")&&e!=o.buttonElement&&(o.rootElement.contains(e)||o.hide()),n.classList.contains("is-visible")&&(n.contains(e)||r()),s.builder&&s.builder.isActive&&(e!=l&&e!=u&&e.parentNode!=u&&y(),s.builder.bgPatternMenu.isVisible&&!s.builder.bgPatternMenu._rootElement.contains(e)&&s.builder.bgPatternMenu.hide()),a=e}),document.body.addEventListener("pointerup",function(t){a=null}),n.addEventListener("pointerup",function(t){var e=t.target;if(e==a)if("confirm-delete-cage-btn"==e.id){var o=s.getCageID();if(o)s.habStorage.deleteCage(o),s.removeHab();else{var i=document.getElementById("sharedHomes");if(i){var n=document.getElementById("main");i.style.display="none",n.classList.remove("shared-home"),n.classList.remove("starter-home"),s.starter.openScreen(),s.removeHab()}}r()}else"cancel-delete-cage-btn"==e.id&&r()});var l=e.querySelector("#more-edit-options-btn"),u=e.querySelector("#more-edit-options-menu"),y=function(){u.classList.remove("is-visible")};l.addEventListener("pointerdown",function(){u.classList.contains("is-visible")?y():u.classList.add("is-visible")}),u.addEventListener("pointerup",function(t){var e,o=t.target;"bg-pattern-btn"==o.id&&((e=s.builder.bgPatternMenu).isVisible?e.hide():(e.updateMenu(i.getOptions()),e.show())),"bg-color-btn"==o.id&&s.builder.showColorPickerForBackGround(),y()})},App.prototype.preventMultipleTabIssues=function(){window.addEventListener("blur",function(t){var e=S.app.getCageID();S.app.habStorage.getCageByID(e,function(t){t&&(S.app._cageLastModified=t.modified)})}),window.addEventListener("focus",function(t){var e=S.app.getCageID();S.app.habStorage.getCageByID(e,function(t){})}),document.addEventListener("visibilitychange",function(t){var e=S.app.getCageID();S.app.habStorage.getCageByID(e,function(t){t&&("hidden"==document.visibilityState?S.app._cageLastModified=t.modified:"visible"==document.visibilityState&&t.modified>S.app._cageLastModified&&(S.app.removeHab(),S.app.habStorage.loadCage(e)))})})},App.prototype.showBuildScreen=function(){S.app.builder||S.app.initBuilder(S.app.menuItemInfo,S.app.habStorage,S.app.background),S.app.hsm[0].changeState(S.z155.name)},App.prototype.hideMainUI=function(){document.querySelector("#main").classList.add("hide-ui")},App.prototype.showMainUI=function(){document.querySelector("#main").classList.remove("hide-ui")},App.prototype.runRenderLoop=function(){var t=this.graphicsHelper.engine;t&&(t.stopRenderLoop(this.loop),t.runRenderLoop(this.loop))},App.prototype.getOrphanThatIntersectWith=function(t,e){void 0===e&&(e=!0);for(var o=0;o<this.orphans.length;o++){var i=this.orphans.getAtIndex(o);if(i.intersectsAccesory(t,!0))return this.orphans.remove(i),i}},App.prototype.removeOrphans=function(){for(var t=0;t<this.orphans.length;t++){var e=this.orphans.getAtIndex(t);e.accType==S.z1044.z1058&&(e.recycle(),this.deletePart(e))}},App.prototype.addz1062sToCages=function(){for(var t=S.z1062.activeObjects,e=z641.getz767(S.z156.z677),o=this._tempArr,i=(this._tempVec,0);i<t.length;i++){var n=t[i];if(n.addToScene(),!n.isMenuItem&&!n.currentObject){var s=n.physics.middleBody.body.position,a=S.Cage.getClosestCage(s.x,s.y,s.z);if(a){if(!a.isInBox(s.x,s.y,s.z)){n.setPosition(a.position.x,a.position.y+.3,-1.5)}n.update(),e.update(n);var r=a.left+.3+(a.width-.6)*Math.random();S.app.testing&&(r=s.x);var c=a.getHeightAt(r,s.z),d=a.getPlatformUnder(r,s.y,s.z);d&&d.position.y>c&&(c=d.position.y);if(s.y>c+.15&&n.setPosition(r,c+.15,s.z),n.update(),!this.testing){var p=!0;if(n.targets.pointerDownPosition.copyFrom(S.app.pointerDownPosition),Math.random()<.5)if(o.length=0,a.getChildrenByType(S.z1044.z1054,o),0<o.length)o[0].placeHamOnWheel(n)&&(p=!1);p&&n.changeState(S.z112.name)}if(1<t.length)for(var l=0;l<t.length;l++){var u=t[l];if(u!=n&&u.currentObject==n.currentObject){var y=u.physics.middleBody.body.position;if(z1.distanceSquared(s,y)<.09){var g=n.cage,m=.3;0<s.z-g.position.z&&(m=-.3),n.setPosition(s.x,s.y+.05,s.z+m)}}}}}}},App.prototype.addEventListeners=function(){var o=this.graphicsHelper,i=this,t=document.getElementById("main");o.scene.registerAfterRender(function(){for(var t=i.updateOnceAfterRender,e=t.length,o=0;o<e;o++)t[o]();t.length=0});var e=S.z1073.CreateHTMLElementFromString("<div id='zoom-ctn' style='visibility:hidden'>\n                        <div class='zoom-in'>+</div>\n                        <div class='zoom-out'>-</div>\n                    </div>");t.appendChild(e);e.addEventListener("pointerup",function(t){var e=t.target;e.classList.contains("zoom-in")?o.zoomCamera(-200):e.classList.contains("zoom-out")&&o.zoomCamera(200)}),o.addZoomCameraWithMouseWheel(),this.hammerIt(t);var n=function(t){i.isPointerDown=!1};t.addEventListener("pointerdown",function(t){i.isPointerDown=!0,i.pointerDownStartPos.x=t.clientX,i.pointerDownStartPos.y=t.clientY,i.pointerDownHasMoved=!1,i.pointerDownID=t.pointerId}),t.addEventListener("pointerup",n),t.addEventListener("pointercancel",n),t.addEventListener("pointerleave",n),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&document.getElementById("mainCanvas").addEventListener("touchstart",function(t){10<t.pageX&&t.pageX<window.innerWidth-10||t.preventDefault()}),this.pubsub.subscribe("multitouch_end",this.addBJSPointerObservablesNextFrame,this),t.addEventListener("touchmove",function(t){i.getDragged()&&t.preventDefault()},{passive:!1})},App.prototype.addBJSPointerObservablesNextFrame=function(){if(!this.bindedAddPointerObservables){var t=this.graphicsHelper;this.bindedAddPointerObservables=t.addBJSPointerObservables.bind(t)}this.updateOnceNextFrame.push(this.bindedAddPointerObservables)},Object.defineProperty(App.prototype,"multiTouch",{get:function(){return this._multiTouch},enumerable:!1,configurable:!0}),App.prototype.handleMultiTouch=function(){var p1=this.pointer1Pos,t=this.lastPointer1Pos,p2=this.pointer2Pos,e=this.lastPointer2Pos,o=.5*(p2.x-p1.x)+p1.x,i=.5*(p2.y-p1.y)+p1.y,n=!1;this.lastFrameHandleMultiTouch!=S.app.frameNum-1&&(this.lastPointerDist=0,t.x=p1.x,t.y=p1.y,e.x=p2.x,e.y=p2.y,n=!0),this.lastFrameHandleMultiTouch=S.app.frameNum;var s=p1.x-t.x,a=p1.y-t.y;if(s*(p2.x-e.x)+a*(p2.y-e.y)<0){var r=p1.x-p2.x,c=p1.y-p2.y,d=r*r+c*c,p=Math.sqrt(d);if(0<this.lastPointerDist){var l=p-this.lastPointerDist;this.graphicsHelper.zoomCamera(20*-l)}this.lastPointerDist=p}t.x=p1.x,t.y=p1.y,e.x=p2.x,e.y=p2.y,this.lastPointBtw.x=o,this.lastPointBtw.y=i,this.graphicsHelper.setMoveCameraPointer(o,i,n)},App.prototype.hammerIt=function(t){var e=this,o=e.graphicsHelper,i=new Hammer(t);i.get("pinch").set({enable:!0});var n=0;i.on("pinch pinchend pinchstart",function(t){"pinchstart"==t.type&&(e._multiTouch=!0,o.removeBJSPointerObservables()),"pinchend"==t.type&&(e._multiTouch=!1,e.pubsub.broadcast("multitouch_end")),e._multiTouch&&(e.pointer1Pos.x=t.pointers[0].x,e.pointer1Pos.y=t.pointers[0].y,e.pointer2Pos.x=t.pointers[1].x,e.pointer2Pos.y=t.pointers[1].y,n!=S.app.frameNum&&e.updateOnce.push(e.bindedHandleMultiTouch)),n=S.app.frameNum})},App.prototype.isRemovingHab=function(){return this._removingHab},App.prototype.removeHab=function(){this.isHomeLoaded||this._homeIsLoaded,this._removingHab=!0;for(var t=S.z1062.activeObjects,e=t.length;0<t.length;)t[0].dbid=0,t[0].recycle();for(;0<S.app.objsOnScene.length;){var o=S.app.objsOnScene[0];o.dbid=0,o.recycle()}this.builder&&(e==S.z1062.objectCount&&this.builder.buildMenu.refreshMenuItem(S.z1062Config.objName,"hams").bones.hardReset());0<this.orphans.length&&(this.orphans.length=0),S.app.testing||(S.AppSettings.GetInstance().recycle(),S.app.habStorage.cageID=null),this._removingHab=!1,this._homeIsLoaded=!1;var i=ObjectPool.recycled.h;if(i)for(var n=0;n<i.length;n++)i[n].memory.erase()},App.prototype._onz1092SceneChange=function(t){if(t.getObjectCount){var e=this.objsOnScene,o=!1;if(-1!=(i=e.indexOf(t))&&(o=!0),t.isOnScene&&!o){e.push(t);var i,n=t;if(!t.isDragging)if(n.placementType&S.PlacementType.z1048)if(n.parent)-1<(i=this.orphans.indexOf(n))&&this.orphans.remove(n);else this.orphans.push(n);this.pubsub.broadcast(S.AppEvents.ACCESSORY_ADDED,t)}else!t.isOnScene&&o&&(e.splice(i,1),this.pubsub.broadcast(S.AppEvents.ACCESSORY_REMOVED,t))}},App.prototype.getObjOnSceneAt=function(t,e,o){var i=S.Cage.getCageAt(t,e,o);if(i&&i.getObjectAt){var n=i.getObjectAt(t,e,o,S.z1044.z1051|S.z1044.z1054|S.z1044.z1050);if(n)return n}return i||(i=S.Tube.getObjectAt(t,e,o)),i},App.prototype.initOimoPhysics=function(){var t=this._physicsFPS;this.world=new OIMO.World(1/(2*t),2,4),this.world.gravity.y*=4,this.world.isNoStat=!0,this.pubsub.broadcast(S.AppEvents.OIMO_WORLD_CREATED,this.world)},App.prototype.initBedding=function(){var t=[],e=[],o=this.graphicsHelper.spsManagerManager,i={},n=this.graphicsHelper.scene,s=new S.BeddingConfig;s.initObjectPool(this.world),s.getSPSData(t),s.getTileSetData(e),s.getTextureDrawFunctions(i);for(var a=S.app.graphicsHelper,r=a.tileSets,c=0;c<e.length;c++){for(var d=e[c],p=new TileSet(d.tileSetName,n,d.numRows,d.numCols),l=0;l<d.tileDrawNames.length;l++){var u=d.tileDrawNames[l];p.drawTile(u,i[u])}p.drawTileSet(),r[d.tileSetName]=p}s._createMeshes(n,z3.meshes,a.materials,null,r),o.addNewSPSMan(t),ObjectPool.unsubscribe(this.initBedding,this,"before_get_Bedding2x4"),ObjectPool.unsubscribe(this.initBedding,this,"before_get_Bedding3x4"),ObjectPool.unsubscribe(this.initBedding,this,"before_get_Bedding4x4"),ObjectPool.unsubscribe(this.initBedding,this,"before_get_BeddingSides")},App.prototype.initObjectPool=function(){ObjectPool.subscribe(function(t){S.app.graphicsHelper.registerWithz1080s(t),t.addOnChangeObserver&&!t.isMenuItem&&t.saveToDB&&(t.addOnChangeObserver(S.app._onz1092SceneChange,S.app),S.app._onz1092SceneChange(t))},this),ObjectPool.subscribe(this.initBedding,this,"before_get_bedding2x4"),ObjectPool.subscribe(this.initBedding,this,"before_get_bedding3x4"),ObjectPool.subscribe(this.initBedding,this,"before_get_bedding4x4"),ObjectPool.subscribe(this.initBedding,this,"before_get_beddingsides"),ObjectPool.addClass("OIMO.Vec3",OIMO.Vec3),ObjectPool.addClass("OIMO.Hole",OIMO.Hole),ObjectPool.addClass("z1068",z1068),ObjectPool.addClass("BABYLON.Vector3",BABYLON.Vector3),ObjectPool.addClass("Array",Array)},App.prototype.generateID=function(){return++App.lastID},App.prototype.registerOnPointerDown=function(t,e,o){var i=z3.POINTER_DOWN;""!=t?this.graphicsHelper.subscribe(i+"/"+t,e,o):this.graphicsHelper.subscribe(i,e,o)},App.prototype.unregisterOnPointerDown=function(t,e,o){var i=z3.POINTER_DOWN;""!=t?this.graphicsHelper.unsubscribe(i+"/"+t,e,o):this.graphicsHelper.unsubscribe(i,e,o)},App.prototype.registerOnPointerMove=function(t,e,o){var i=z3.POINTER_MOVE;""!=t?this.graphicsHelper.subscribe(i+"/"+t,e,o):this.graphicsHelper.subscribe(i,e,o)},App.prototype.unregisterOnPointerMove=function(t,e,o){var i=z3.POINTER_MOVE;""!=t?this.graphicsHelper.unsubscribe(i+"/"+t,e,o):this.graphicsHelper.unsubscribe(i,e,o)},App.prototype.registerOnPointerUp=function(t,e,o){var i=z3.POINTER_UP;""!=t?this.graphicsHelper.subscribe(i+"/"+t,e,o):this.graphicsHelper.subscribe(i,e,o)},App.prototype.unregisterOnPointerUp=function(t,e,o){var i=z3.POINTER_UP;""!=t?this.graphicsHelper.unsubscribe(i+"/"+t,e,o):this.graphicsHelper.unsubscribe(i,e,o)},Object.defineProperty(App.prototype,"pointerDownObj",{get:function(){return this._pointerDownObj},set:function(t){t!=this._pointerDownObj&&(this._pointerDownObj=t),null!=t&&(this._lastPointerDownObj=t)},enumerable:!1,configurable:!0}),App.prototype.onPointerDown=function(t,e){e&&!e.isMenuItem&&(e.shapeName||e.physics),this.pointerDownObj=e},App.prototype.onPointerUp=function(t,e){this.pointerDownObj=null;var o=e;o&&o.parent&&(o=o.parent),o&&o.parent&&(o=o.parent),o&&(o.accType,S.z1044.z1048),S.app.touchMesh&&(S.app.touchMesh._pointerDown=!1)},App.prototype.translateCameraToObject=function(t){var e=t.hitMeshes[0].position;this.graphicsHelper.translateCameraTo(e.x,e.y)},App.prototype.setClickPoint=function(t,e){if(!this.multiTouch&&!this.pointerDownHasMoved&&!e.isMenuItem){var o=t.pickInfo;if(o||(o=t),o&&o.pickedMesh&&e){if(e.droppedAtFrameNum&&e.droppedAtFrameNum==S.app.frameNum)return;S.app.translateCameraOnObjectClick&&this.translateCameraToObject(e);var i=S.app.pointerDownPosition;if(i.x=o.pickedPoint.x,i.y=o.pickedPoint.y,i.z=o.pickedPoint.z,S.app.pickInfo=o,e.checkCageConnections){var n=S.app.graphicsHelper.scene;S.app.graphicsHelper.getPlanePositionAtScreenXY(n.pointerX,n.pointerY,e.position.z-.5*e.depth,i)}}}},App.prototype.onPointerMoveSetPosition=function(t,e){var o=t.pickInfo;if(o||(o=t),o&&o.pickedMesh){var i=S.app.pointerMovePosition;i.x=o.pickedPoint.x,i.y=o.pickedPoint.y,i.z=o.pickedPoint.z,S.app.lastFramePointerMoved=S.app.frameNum;var n=t.event;if(S.app.isPointerDown){S.app.builder&&S.app.builder.isActive||!S.app.doTouch||"Background"==o.pickedMesh.id?S.app.touchMesh._pointerDown=!1:S.app.touchMesh.setPosition(i.x,i.y,i.z-.1);var s=S.app.pointerDownStartPos,a=s.x-n.clientX,r=s.y-n.clientY;a*a+r*r>S.app.distSqForPointerMove&&(S.app.pointerDownHasMoved=!0)}var c=e;c.parent&&(c=c.parent);var d=!1;if(e.accType==S.z1044.z1048&&c.bedding){var p=c.bedding.getHeightAt(i.x,i.z);i.y<p&&(d=!0)}S.app.pointerMoveIsBelowBedding=d}},App.prototype.dispose=function(){},App.prototype.getDragged=function(){if(this.builder)return this.builder.getDragged()},App.prototype.getSelectedz1062=function(){if(this.builder)return this.builder.getSelectedz1062()},App.prototype.saveDataItem=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this._removingHab?[2]:this.habStorage&&e?this.getCageID()?(S.app.starter.cageUpdated(),e.dbid?[2,this.habStorage._editPart(e)]:[2,this.habStorage._addPart(e)]):(this.saveCage(),[2]):[2]})})},App.prototype.createDebugText=function(t,e){var o=this._debugTextContainer;o||((o=document.createElement("div")).id="debug_text_container",o.style.position="absolute",o.style.top="200px",document.body.appendChild(o),this._debugTextContainer=o);var i=document.createElement("div");i.classList.add("debug_text"),o.appendChild(i),t.subscribe(e,function(t){i.innerHTML=e+": "+t},this)},App.prototype.loadHamsMemory=function(){for(var t=S.z1062.activeObjects,e=0;e<t.length;e++)t[e].memory.load()},App.prototype.showFPS=function(){var t=document.createElement("div");t.style.position="absolute",t.style.left="0px",t.style.bottom="0px",t.style.padding="2px",document.getElementById("main").appendChild(t);var e=0,o=S.app;setInterval(function(){t.innerHTML=""+(o.frameNum-e),e=o.frameNum},1e3)},App.prototype.datguiAdd=function(t,e,o,i){if(datgui)return datgui.add(t,e,o,i)},App.prototype.addToHistory=function(t){t!=this._history[this._history.length-1]&&(this._history.push(t),1==this._history.length?window.history.pushState({screen:t},null,this._defaultURL):window.history.replaceState({screen:t},null,this._defaultURL))},App.prototype.removeFromHistory=function(t){this._history[this._history.length-1]==t?(this._history.length--,window.history.replaceState({screen:t},null,this._defaultURL)):window.history},App.prototype.onLoadHomeStart=function(){document.getElementById("main").classList.add("loading")},App.prototype.onLoadHomeEnd=function(){document.getElementById("main").classList.remove("loading"),document.querySelector(".progress-bar-inner").style.width="0%"},App.prototype.updateProgressBar=function(t,e){document.querySelector(".progress-bar-inner").style.width=t/e*100+"%"},App.z1033=2,App.z1034=4,App.z1035=8,App.z1036=16,App.PhysicsGroupTriggerArea=32,App.z1037=64,App.PhysicsGroupBedding=128,App.PhysicsGroupDragger=256,App.z1039=4294967295,App.z1034Menu=512,App.z1033Menu=1024,App.PhysicsGroupDraggerMenu=2048,App.z10332Menu=4096,App.z1042=8192,App.z1037Mound=16384,App.lastID=0,App.menuRenderingGroupID=1,App.EntityConfigs=[],App._Subs=[],App}();S.App=t}(z0||(z0={}));var Hammer,ClipboardJS,SimpleScrollbar,QRCode,dat=dat||{},datgui=null;function createScene(t){return z0.app=new z0.App,document.getElementById("appVersion").innerHTML=z0.version,z0.app.start(t)}!function(t){var e=function(){function AppEvents(){}return AppEvents.GetUniqueID=function(){return++AppEvents.currentEventNum},AppEvents.currentEventNum=1,AppEvents.BUILDER_INITED=AppEvents.GetUniqueID(),AppEvents.FEED=AppEvents.GetUniqueID(),AppEvents.ACCESSORY_ADDED=AppEvents.GetUniqueID(),AppEvents.ACCESSORY_REMOVED=AppEvents.GetUniqueID(),AppEvents.AFTER_INIT=AppEvents.GetUniqueID(),AppEvents.AFTER_z1048_LOAD=AppEvents.GetUniqueID(),AppEvents.POINTER_INACTIVE=AppEvents.GetUniqueID(),AppEvents.POINTER_ACTIVE=AppEvents.GetUniqueID(),AppEvents.OIMO_WORLD_CREATED=AppEvents.GetUniqueID(),AppEvents}();t.AppEvents=e}(z0||(z0={})),function(o){var t=function(){function AppSettings(){this.saveToDB=!0,this.dbid=0,this.num=0,AppSettings.instance=this,AppSettings.count++,this.num=AppSettings.count}return AppSettings.GetInstance=function(){return AppSettings.instance?AppSettings.instance:ObjectPool.get(AppSettings.ShortName)},AppSettings.prototype.init=function(t){t.dbid&&(this.dbid=t.dbid),o.app.graphicsHelper.setCameraPosition(t.x,t.y,t.z),o.app.background&&(o.app.background.colorHex=t.bc,o.app.background.setPattern(t.bp))},AppSettings.prototype.getName=function(){return AppSettings.ShortName},AppSettings.prototype.getProps=function(){var t={};t.bp=o.app.background.patternName,t.bc=o.app.background.colorHex;var e=o.app.graphicsHelper.camera.position;return t.x=z1.roundToDecimalPlace(e.x,2),t.y=z1.roundToDecimalPlace(e.y,2),t.z=z1.roundToDecimalPlace(e.z,2),t},AppSettings.prototype.recycle=function(){this.dbid=0,ObjectPool.recycle(this)},AppSettings.ShortName="ap",AppSettings.count=0,AppSettings}();o.AppSettings=t,ObjectPool.addClass(t.ShortName,t,{x:0,y:0,z:-10,bp:"squares",bc:"#EBEBEB"})}(z0||(z0={})),function(t){var e=function(){function CanvasDraw(){}return CanvasDraw.CreateTextureFromDrawFunction=function(t,e,o,i,n,s){return void 0===i&&(i=256),void 0===n&&(n=256),CanvasDraw.textureCanvas||((CanvasDraw.textureCanvas=document.createElement("canvas")).id="HHtextureCanvas"),CanvasDraw.textureCanvas.width=i,CanvasDraw.textureCanvas.height=n,t(CanvasDraw.textureCanvas.getContext("2d"),i,n),new BABYLON.Texture("data:"+e,o,!1,!0,null,s,null,CanvasDraw.textureCanvas.toDataURL())},CanvasDraw.UpdateTextureFromDrawFunction=function(t,e,o,i,n,s){void 0===i&&(i=256),void 0===n&&(n=256),CanvasDraw.textureCanvas||((CanvasDraw.textureCanvas=document.createElement("canvas")).id="HHtextureCanvas"),CanvasDraw.textureCanvas.width=i,CanvasDraw.textureCanvas.height=n,e(CanvasDraw.textureCanvas.getContext("2d"),i,n),t.updateURL("data:"+o,CanvasDraw.textureCanvas.toDataURL(),s)},CanvasDraw.DrawSquares1Pattern=function(t,e,o,i,n){var s=i,a=n,r=.05*e,c=e/4,d=o/4;t.fillStyle=s,t.fillRect(0,0,e,o),t.fillStyle=a;for(var p=.5*c;p<e;p+=c)for(var l=.5*d;l<e;l+=d)t.fillRect(p-.5*r,l-.5*r,r,r)},CanvasDraw.DrawCircles1Pattern=function(t,e,o,i,n,s,a,r){var c=i,d=n,p=e/a,l=o/r;t.fillStyle=c,t.fillRect(0,0,e,o),t.fillStyle=d;for(var u=.5*p;u<e;u+=p)for(var y=.5*l;y<e;y+=l)z3.drawEllipse(u,y,s,s,t),t.fill()},CanvasDraw.DrawChevronPattern=function(t,e,o,i,n,s,a,r){void 0===a&&(a=1),void 0===r&&(r=1);var c=i,d=n;i&&(t.fillStyle=c,t.fillRect(0,0,e,o)),t.fillStyle=d;for(var p=e/a,l=o/r,u=0;u<a;u++)for(var y=0;y<r;y++){var g=u*p,m=y*l;t.save(),t.translate(g,m),CanvasDraw.DrawChevron(t,p,l,s),t.restore()}},CanvasDraw.DrawChevron=function(t,e,o,i){var n=e;t.save(),t.translate(.5*e,.25*o),t.beginPath(),t.rect(.5*-e,.25*-o,e,o),t.clip(),t.rotate(.25*Math.PI),t.beginPath(),t.rect(.5*-i,.5*-i,n,i),t.rotate(.5*Math.PI),t.rect(.5*-i,.5*-i,n,i),t.fill(),t.restore()},CanvasDraw.DrawStripes1Pattern=function(t,e,o,i,n){var s=i,a=n;t.fillStyle=s,t.fillRect(0,0,e,o),t.fillStyle=a;var r=2*e,c=.2*o;t.save(),t.translate(.5*e,.5*o),t.rotate(.25*Math.PI),t.rect(.5*-r,.5*-c,r,c),t.restore();r=c;t.save(),t.translate(e,0),t.rotate(.25*Math.PI),t.rect(.5*-r,.5*-c,r,c),t.restore(),t.save(),t.translate(0,o),t.rotate(.25*Math.PI),t.rect(.5*-r,.5*-c,r,c),t.restore(),t.fill()},CanvasDraw.DrawStripes2Pattern=function(t,e,o,i,n){var s=i,a=n;t.fillStyle=s,t.fillRect(0,0,e,o),t.fillStyle=a;var r=2*e,c=.1*o;t.save(),t.translate(.5*e,.5*o),t.rotate(.25*Math.PI),t.rect(.5*-r,.5*-c,r,c),t.rotate(.5*Math.PI),t.rect(.5*-r,.5*-c,r,c),t.fill(),t.restore()},CanvasDraw.DrawHeartsPattern=function(t,e,o,i,n,s,a,r,c){void 0===s&&(s=1),void 0===a&&(a=1),void 0===r&&(r=1),void 0===c&&(c=1);var d=i,p=n;i&&(t.fillStyle=d,t.fillRect(0,0,e,o)),t.fillStyle=p;for(var l=e/s,u=o/a,y=0;y<s;y++)for(var g=0;g<a;g++){var m=y*l,f=g*u;t.save(),t.translate(m,f),CanvasDraw.DrawHeart(t,l,u,r,c),t.restore()}},CanvasDraw.DrawTopLine=function(t,e,o,i,n){var s=i,a=n;i&&(t.fillStyle=s,t.fillRect(0,0,e,o)),t.fillStyle=a,t.save(),t.beginPath(),t.moveTo(0,0),t.fillRect(0,0,e,.1*o),t.restore()},CanvasDraw.DrawHeart=function(t,e,o,i,n){t.save(),t.translate(.5*e,.33*o),t.scale(i,n),t.beginPath(),t.moveTo(0,0),t.bezierCurveTo(.25*e,.25*-o,.5*e,.2*o,0,.5*o),t.bezierCurveTo(.5*-e,.2*o,.25*-e,.25*-o,0,0),t.fill(),t.restore()},CanvasDraw.DrawLeaf=function(t,e,o,i){t.moveTo(.5*-i,0),t.bezierCurveTo(-e,o,e,o,.5*i,0),t.bezierCurveTo(e,-o,-e,-o,.5*-i,0)},CanvasDraw.DrawLeafPattern=function(t,e,o,i,n){var s=i,a=n;t.fillStyle=s,t.fillRect(0,0,e,o),t.fillStyle=a;var r=CanvasDraw.DrawLeaf,c=.27*o,d=.2*e,p=e;t.save(),t.translate(.5*e,.5*o),t.rotate(.25*Math.PI),r(t,d,c,p),t.fill(),t.restore(),t.save(),t.rotate(.25*-Math.PI),r(t,d,c,p),t.fill(),t.restore(),t.save(),t.translate(e,0),t.rotate(.25*-Math.PI),r(t,d,c,p),t.fill(),t.restore(),t.save(),t.translate(0,o),t.rotate(.25*-Math.PI),r(t,d,c,p),t.fill(),t.restore(),t.save(),t.translate(e,o),t.rotate(.25*-Math.PI),r(t,d,c,p),t.fill(),t.restore()},CanvasDraw.DrawCurves1Pattern=function(t,e,o,i,n,s,a,r,c){void 0===s&&(s=1),void 0===a&&(a=1),void 0===r&&(r=1),void 0===c&&(c=1);var d=i,p=n;i&&(t.fillStyle=d,t.fillRect(0,0,e,o)),t.strokeStyle=p;for(var l=e/s,u=o/a,y=0;y<s;y++)for(var g=0;g<a;g++){var m=y*l,f=g*u;t.save(),t.translate(m,f),t.scale(r,c),CanvasDraw.DrawCurves1(t,l,u),t.restore()}},CanvasDraw.DrawCurves1=function(t,e,o){t.save(),t.translate(0,.25*o),t.lineWidth=.08*o,t.beginPath(),t.moveTo(0,0),t.bezierCurveTo(.5*e,0,0,.5*o,.5*e,.5*o),t.bezierCurveTo(e,.5*o,.5*e,0,e,0),t.stroke(),t.restore()},CanvasDraw.DrawPawPattern=function(t,e,o,i,n,s,a,r,c){void 0===s&&(s=1),void 0===a&&(a=1),void 0===r&&(r=1),void 0===c&&(c=1);var d=i,p=n;i&&(t.fillStyle=d,t.fillRect(0,0,e,o)),t.fillStyle=p;for(var l=e/s,u=o/a,y=0;y<s;y++)for(var g=0;g<a;g++){var m=y*l,f=g*u;t.save(),t.translate(m,f),t.scale(r,c),CanvasDraw.DrawPaw(t,l,u),t.restore()}},CanvasDraw.DrawPawToe=function(t,e,o){t.moveTo(0,0),t.bezierCurveTo(.5*e,.1*o,.5*e,.9*o,0,o),t.bezierCurveTo(.5*-e,.9*o,.5*-e,.1*o,0,0)},CanvasDraw.DrawPaw=function(t,e,o){var i=CanvasDraw.DrawPawToe,n=.2*e,s=.2*o,a=.3*e,r=.15*Math.PI;t.save(),t.translate(.5*e,.5*o),t.rotate(.25*Math.PI),t.save(),t.beginPath();var c=.15*-Math.PI;t.translate(Math.cos(c)*a*.9,Math.sin(c)*a*.9),t.rotate(r),i(t,.85*n,.85*s),t.fill(),t.restore(),t.save(),t.beginPath(),c=.37*-Math.PI,t.translate(Math.cos(c)*a,Math.sin(c)*a),t.rotate(.6*r),i(t,n,s),t.fill(),t.restore(),t.save(),t.beginPath(),c=.63*-Math.PI,t.translate(Math.cos(c)*a,Math.sin(c)*a),t.rotate(.6*-r),i(t,n,s),t.fill(),t.restore(),t.save(),t.beginPath(),c=.85*-Math.PI,t.translate(Math.cos(c)*a*.9,Math.sin(c)*a*.9),t.rotate(-r),i(t,.85*n,.85*s),t.fill(),t.restore();var d=.9*a,p=.9*a;t.beginPath(),t.translate(0,.15*-a),t.moveTo(0,0),t.bezierCurveTo(.5*p,.1*d,.9*p,.9*d,0,d),t.bezierCurveTo(.9*-p,.9*d,.5*-p,.1*d,0,0),t.fill(),t.restore()},CanvasDraw.DrawImage=function(t,e,o,i,n,s){var a=n,r=s;n&&(t.fillStyle=a,t.fillRect(0,0,o,i)),t.fillStyle=r,t.drawImage(e,0,0,o,i,0,0,o,i),t.save(),t.beginPath(),t.moveTo(0,0),t.fillRect(0,0,o,.1*i),t.restore()},CanvasDraw.DrawLogoPattern=function(t,e,o,i,n,s,a,r,c){void 0===s&&(s=0),void 0===a&&(a=0),void 0===r&&(r=1),void 0===c&&(c=1);var d=i,p=n;i&&(t.fillStyle=d,t.fillRect(0,0,e,o)),t.fillStyle=p,t.save(),t.scale(r,c),t.translate(s,a),CanvasDraw.DrawLogo2(t),t.restore()},CanvasDraw.DrawLogo2=function(t){t.save(),t.beginPath(),t.fillStyle="rgba(255, 255, 255, 0.702811)",t.lineWidth=.379418,t.lineCap="round",t.lineJoin="round",t.miterLimit=4,t.moveTo(106.06914,45.805051),t.bezierCurveTo(99.494517,45.805051,94.181347,47.508591,88.600527,50.133551),t.bezierCurveTo(82.496307,46.034521,74.593197,43.133881,68.473096,43.267071),t.bezierCurveTo(65.691226,43.327771,63.277701,44.014961,61.568826,45.501661),t.bezierCurveTo(56.919284,49.546841,58.069708,62.593111,61.724267,69.987871),t.bezierCurveTo(49.625238,80.288571,30.057364,100.78319,34.242427,122.54464),t.bezierCurveTo(42.596971,155.64349,71.514098,178.4049,106.06914,178.77825),t.fill(),t.beginPath(),t.fillStyle="rgba(255, 255, 255, 0.702811)",t.lineWidth=.379418,t.lineCap="round",t.lineJoin="round",t.miterLimit=4,t.moveTo(106.06914,45.805051),t.bezierCurveTo(112.64361,45.805051,117.95698,47.508591,123.5378,50.133551),t.bezierCurveTo(129.64201,46.034521,137.54506,43.133881,143.66511,43.267071),t.bezierCurveTo(146.44702,43.327771,148.86049,44.014961,150.56934,45.501661),t.bezierCurveTo(155.21898,49.546841,154.06858,62.593111,150.41397,69.987871),t.bezierCurveTo(162.51305,80.288571,182.08082,100.78319,177.89585,122.54464),t.bezierCurveTo(169.54145,155.64349,140.62433,178.4049,106.06914,178.77825),t.fill(),t.beginPath(),t.globalAlpha=1,t.fillStyle="rgba(255, 255, 255, 0.702811)",t.lineWidth=3.222255,t.lineCap="round",t.lineJoin="round",t.miterLimit=4,t.moveTo(106.0665,11.598095),t.bezierCurveTo(54.720938,11.598095,12.966484,53.352501,12.966486,104.6981),t.bezierCurveTo(12.966484,156.04376,54.720938,197.79812,106.0665,197.79812),t.bezierCurveTo(157.21867,197.79812,198.82553,156.35112,199.13877,105.2716),t.bezierCurveTo(199.157016,105.080975,199.166259,104.889596,199.16647,104.6981),t.bezierCurveTo(199.166262,104.497245,199.156116,104.296523,199.13607,104.09667),t.bezierCurveTo(198.80748,53.030191,157.20927,11.598085,106.06658,11.598095),t.moveTo(106.0665,23.778297),t.bezierCurveTo(150.83006,23.778297,186.98646,59.934721,186.98646,104.6981),t.bezierCurveTo(186.98646,149.46166,150.83006,185.62069,106.0665,185.62068),t.bezierCurveTo(61.302944,185.62068,25.143919,149.46166,25.143921,104.6981),t.bezierCurveTo(25.143919,59.934721,61.302944,23.778297,106.0665,23.778297),t.fill(),t.restore()},CanvasDraw.DrawLogo=function(t){t.save(),t.beginPath(),t.fillStyle="rgba(255, 255, 255, 0.702811)",t.lineWidth=.264922,t.lineCap="round",t.lineJoin="round",t.miterLimit=4,t.moveTo(105.6574,96.097261),t.bezierCurveTo(101.06724,96.097261,97.357681,97.286581,93.46123,99.119301),t.bezierCurveTo(89.19945,96.257421,83.68176,94.232291,79.40886,94.325281),t.bezierCurveTo(77.46663,94.367581,75.78157,94.847361,74.58848,95.885391),t.bezierCurveTo(71.342292,98.709651,72.14549,107.81819,74.697,112.98099),t.bezierCurveTo(66.249769,120.17274,52.58801,134.48149,55.509908,149.67481),t.bezierCurveTo(61.342832,172.78357,81.53201,188.67502,105.6574,188.93555),t.fill(),t.beginPath(),t.fillStyle="rgba(255, 255, 255, 0.702811)",t.lineWidth=.264922,t.lineCap="round",t.lineJoin="round",t.miterLimit=4,t.moveTo(105.6574,96.097261),t.bezierCurveTo(110.24756,96.097261,113.95713,97.286581,117.85358,99.119301),t.bezierCurveTo(122.11535,96.257421,127.63305,94.232291,131.90595,94.325281),t.bezierCurveTo(133.84818,94.367581,135.53323,94.847361,136.72633,95.885391),t.bezierCurveTo(139.97251,98.709651,139.16932,107.81819,136.61781,112.98099),t.bezierCurveTo(145.06503,120.17274,158.72679,134.48149,155.8049,149.67481),t.bezierCurveTo(149.97197,172.78357,129.78279,188.67502,105.6574,188.93555),t.fill(),t.beginPath(),t.globalAlpha=1,t.fillStyle="rgba(255, 255, 255, 0.702811)",t.lineWidth=2.249765,t.lineCap="round",t.lineJoin="round",t.miterLimit=4,t.moveTo(105.65561,72.214824),t.bezierCurveTo(69.807457,72.214824,40.655607,101.36666,40.655609,137.21482),t.bezierCurveTo(40.655607,173.06297,69.807457,202.21482,105.65561,202.21482),t.bezierCurveTo(141.36865,202.21482,170.41747,173.27764,170.63608,137.61521),t.bezierCurveTo(170.648872,137.482128,170.655379,137.348516,170.65558,137.21482),t.bezierCurveTo(170.655344,137.074574,170.648168,136.934426,170.63408,136.79489),t.bezierCurveTo(170.40478,101.14161,141.36196,72.214814,105.65557,72.214824),t.moveTo(105.65561,80.718724),t.bezierCurveTo(136.90837,80.718724,162.1517,105.96205,162.1517,137.21482),t.bezierCurveTo(162.1517,168.46758,136.90837,193.71287,105.65561,193.71286),t.bezierCurveTo(74.40285,193.71286,49.15756,168.46758,49.157562,137.21482),t.bezierCurveTo(49.15756,105.96205,74.40285,80.718724,105.65561,80.718724),t.fill(),t.beginPath(),t.globalAlpha=1,t.fillStyle="rgba(255, 255, 255, 0.722892)",t.lineWidth=2.157942,t.lineCap="round",t.lineJoin="miter",t.miterLimit=4,t.moveTo(105.65756,9.228492),t.lineTo(5.409515,81.072244),t.bezierCurveTo(3.579236,82.38407,3.158664,84.931108,4.470062,86.761694),t.bezierCurveTo(5.10006,87.641198,6.05372,88.234322,7.121137,88.410516),t.bezierCurveTo(8.188554,88.586711,9.282239,88.331535,10.161468,87.701154),t.lineTo(105.65756,19.261696),t.lineTo(201.15366,87.701154),t.bezierCurveTo(202.984247,89.012551,205.531287,88.591976,206.84311,86.761694),t.bezierCurveTo(208.154509,84.931109,207.733939,82.38407,205.90366,81.072244),t.fill(),t.restore()},CanvasDraw}();t.CanvasDraw=e}(z0||(z0={})),function(t){var e=function(){function z1073(){}return z1073.LoadObjectsFromString=function(t){var e=JSON.parse(t);z1073.LoadObjectsFromJSON(e)},z1073.LoadLastObjectInList=function(){var t=z1073._loadObjNames,e=z1073._loadObjProps,o=t.length-1,i=e[o];i.skipAddToScene=!1,ObjectPool.get(t[o],i),t.length--,e.length--,0<t.length?requestAnimationFrame(z1073.LoadLastObjectInList):z1073.pubsub.broadcast(z1073.AFTER_LOAD_EVENT),z1073.pubsub.broadcast(z1073.LOAD_PROGRESS_CHANGED,z1073._TotalObjectsToLoad-t.length,z1073._TotalObjectsToLoad)},z1073.subscribe=function(t,e,o){z1073.pubsub.subscribe(t,e,o)},z1073.LoadObjectsFromJSON=function(t){var e=z1073._loadObjNames,o=z1073._loadObjProps;if(!(0<e.length)){z1073.pubsub.broadcast(z1073.BEFORE_LOAD_EVENT);for(var i=t.names.length-1;0<=i;i--)e.push(t.names[i]),o.push(t.props[i]);z1073._TotalObjectsToLoad=e.length,z1073.LoadLastObjectInList()}},z1073.ExportObjectsToJSON=function(t){for(var e={},o=[],i=[],n=0;n<t.length;n++){var s=t[n];s.saveToDB&&(o.push(s.getName()),i.push(s.getProps()))}e.names=o,e.props=i;var a={},r=[],c=[],d=[];for(var p in a.names=r,a.props=c,ObjectPool.classes){for(var l=0,u=0;u<o.length;u++){var y=o[u].toLowerCase();y==p&&(0==l&&r.push(y),l++,c.push(i[u]))}0<l&&(d.push(l),c.push("|"))}return e},z1073.ExportObjectsToString=function(t){var e=z1073.ExportObjectsToJSON(t);return JSON.stringify(e)},z1073.RemoveQuotesFromString=function(t){return t.replace(/\"/g,"")},z1073.ConvertJSONtoQueryString=function(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(JSON.stringify(e[t]))}).join("&")},z1073.ExportToQueryString=function(t){var e=z1073.ExportObjectsToJSON(t);return z1073.ConvertJSONtoQueryString(e)},z1073.ExportToCrushedQueryString=function(t){var e=z1073.ExportObjectsToString(t);return JSONCrush(e)},z1073.ConvertQueryStringToJSON=function(t){var e=z1073.GetQueryStringValue("names",t),o=z1073.GetQueryStringValue("props",t),i={};return i.names=JSON.parse(decodeURIComponent(e)),i.props=JSON.parse(decodeURIComponent(o)),i},z1073.ConvertCrushedQueryStringToJSON=function(t){var e=JSONUncrush(t);return JSON.parse(e)},z1073.LoadObjectsFromQueryString=function(t){var e=z1073.ConvertQueryStringToJSON(t);z1073.LoadObjectsFromJSON(e)},z1073.LoadObjectsFromCrushedQueryString=function(t){var e=z1073.ConvertCrushedQueryStringToJSON(t);z1073.LoadObjectsFromJSON(e)},z1073.GetQueryStringValue=function(t,e){for(var o=e.split("&"),i=0;i<o.length;i++){var n=o[i].split("=");if(decodeURIComponent(n[0])==t)return decodeURIComponent(n[1])}},z1073.z1093=function(t){for(var e=[],o=0;o<t.length;o++){var i=t.charCodeAt(o);e[o]=33<=i&&i<=126?String.fromCharCode(33+(i+14)%94):String.fromCharCode(i)}return e.join("")},z1073.GetHexFromVec3=function(t){var e=255*t.x|0,o=255*t.y|0,i=255*t.z|0;return"#"+BABYLON.Scalar.ToHex(e)+BABYLON.Scalar.ToHex(o)+BABYLON.Scalar.ToHex(i)+BABYLON.Scalar.ToHex(255)},z1073.GetHexFromColor3=function(t){var e=255*t.r,o=255*t.g,i=255*t.b;return"#"+BABYLON.Scalar.ToHex(e)+BABYLON.Scalar.ToHex(o)+BABYLON.Scalar.ToHex(i)},z1073.SetVec3FromHex=function(t,e){var o=parseInt(t.substring(1,3),16)/255,i=parseInt(t.substring(3,5),16)/255,n=parseInt(t.substring(5,7),16)/255;e.x=o,e.y=i,e.z=n},z1073.SetColor3FromHex=function(t,e){var o=parseInt(t.substring(1,3),16)/255,i=parseInt(t.substring(3,5),16)/255,n=parseInt(t.substring(5,7),16)/255;e.r=o,e.g=i,e.b=n},z1073.SetColor3FromRBG=function(t,e){var o=-1<t.indexOf(",")?",":" ",i=t.substr(4).split(")")[0].split(o);e.r=+i[0]/255,e.g=+i[1]/255,e.b=+i[2]/255},z1073.setHSLFromColor3=function(t,e){var h,o,i=t.r,n=t.g,s=t.b,a=Math.max(i,n,s),r=Math.min(i,n,s),c=(a+r)/2;if(a==r)h=o=0;else{var d=a-r;switch(o=.5<c?d/(2-a-r):d/(a+r),a){case i:h=(n-s)/d+(n<s?6:0);break;case n:h=(s-i)/d+2;break;case s:h=(i-n)/d+4}h/=6}e.h=360*h,e.s=100*o,e.l=100*c},z1073.setColor3FromHSL=function(h,t,e,o){t/=100,e/=100;var i=(1-Math.abs(2*e-1))*t,n=i*(1-Math.abs(h/60%2-1)),s=e-i/2,a=0,r=0,c=0;0<=h&&h<60?(a=i,r=n,c=0):60<=h&&h<120?(a=n,r=i,c=0):120<=h&&h<180?(a=0,r=i,c=n):180<=h&&h<240?(a=0,r=n,c=i):240<=h&&h<300?(a=n,r=0,c=i):300<=h&&h<360&&(a=i,r=0,c=n),o.r=a+s,o.g=r+s,o.b=c+s},z1073.HSLToRGB=function(h,t,e){t/=100,e/=100;var o=(1-Math.abs(2*e-1))*t,i=o*(1-Math.abs(h/60%2-1)),n=e-o/2,s=0,a=0,r=0;return 0<=h&&h<60?(s=o,a=i,r=0):60<=h&&h<120?(s=i,a=o,r=0):120<=h&&h<180?(s=0,a=o,r=i):180<=h&&h<240?(s=0,a=i,r=o):240<=h&&h<300?(s=i,a=0,r=o):300<=h&&h<360&&(s=o,a=0,r=i),"rgb("+(s=Math.round(255*(s+n)))+","+(a=Math.round(255*(a+n)))+","+(r=Math.round(255*(r+n)))+")"},z1073.GetClosestz1092=function(t,e){for(var o,i=9999,n=0;n<t.length;n++){var s=z1.distanceSquared(t[n].position,e);s<i&&(i=s,o=t[n])}return o},z1073.GetClosestPositionByIndex=function(t,e){for(var o=Number.MAX_VALUE,i=-1,n=0;n<t.length;n++){var s=z1.distanceSquared(t[n],e);s<o&&(o=s,i=n)}return i},z1073.IsTouchEnabled=function(){if("ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints)return!0},z1073.CreateHTMLElementFromString=function(t){return z1073._tempDiv.innerHTML=t.trim(),z1073._tempDiv.firstChild},z1073.IsNodeConnectedToAccType=function(t,e,o){void 0===o&&(o=0);for(var i=0;i<t.connections.length;i++){var n=t.connections[i],s=n.data.obj;if(s&&s.accType==e){if(!o)return n;if(o<0&&n.y-t.y<o)return n;if(0<o&&n.y-t.y>o)return n}var a=n.data.obj2;if(a&&a.accType==e){if(!o)return n;if(o<0&&n.y-t.y<o)return n;if(0<o&&n.y-t.y>o)return n}}},z1073.BEFORE_LOAD_EVENT=1,z1073.AFTER_LOAD_EVENT=2,z1073.LOAD_PROGRESS_CHANGED=3,z1073._loadObjNames=[],z1073._loadObjProps=[],z1073.pubsub=new Pubsub,z1073._TotalObjectsToLoad=0,z1073._tempDiv=document.createElement("div"),z1073}();t.z1073=e}(z0||(z0={})),function(i){var n,t;(t=n||(n={}))[t.ADD_PART=1]="ADD_PART",t[t.EDIT_PART=2]="EDIT_PART",t[t.DELETE_PART=3]="DELETE_PART",t[t.NEW_z1048=4]="NEW_z1048";var o=function DBCommand(){},e=function(){function z1074(){this._cageID=0,this._commands=[],this.pubsub=new Pubsub,this._processingCommands=!1;var t=new Dexie("ham");t.version(1).stores({cages:"++id, name",parts:"++id, cid, pname",settings:"name, value"}),this.db=t,ObjectPool.addClass(o.name,o),this.saveLastViewedTime()}return Object.defineProperty(z1074.prototype,"cageID",{get:function(){return this._cageID},set:function(t){this._cageID=t},enumerable:!1,configurable:!0}),z1074.prototype.saveLastViewedTime=function(){var t=this;setInterval(function(){t._cageID&&t.db.cages.update(t._cageID,{lastViewed:Date.now()})},1e4)},z1074.prototype.load=function(){var e=this,o=0;this.db.settings.where({name:"cageID"}).first(function(t){t&&(o=t.value)}).then(function(){o?e.loadCage(o):e.pubsub.broadcast(z1074.AFTER_LOAD_EVENT,null)}).catch(function(t){e.pubsub.broadcast(z1074.AFTER_LOAD_EVENT,null)})},z1074.prototype.createNew=function(t){void 0===t&&(t=""),this.cageID=null;var e=this;return this.db.cages.add({name:t}).then(function(t){t&&(e.cageID=t,e.db.settings.put({name:"cageID",value:t}))}).catch(function(t){})},z1074.prototype.updateScreenshot=function(t,e){return this.db.cages.update(t,{screenshot:e})},z1074.prototype.getCageByID=function(t,e){this.db.cages.get({id:t}).then(e)},z1074.prototype.saveColors=function(t){this.db.settings.put({name:"colors",value:t})},z1074.prototype.getColors=function(e){this.db.settings.get({name:"colors"}).then(function(t){t&&e(t.value)})},z1074.prototype.getCages=function(){return this.db.cages.toArray()},z1074.prototype.loadCage=function(e){if(e!=this.cageID){this.pubsub.broadcast(z1074.BEFORE_LOAD_EVENT,e);var o,i=this,t=this.db,n=0,s=0;this.db.cages.where("id").equals(e).first(function(t){(o=t)||(e=0),i.cageID=e,i.pubsub.broadcast(z1074.z1048_INFO_LOADED,o)}).then(function(){i.db.parts.where("cid").equals(e).count(function(t){n=t}).then(function(){i.db.parts.where("cid").equals(e).each(function(t){t.dbid=t.id,t.skipAddToScene=!1,t.cid==i.cageID?(ObjectPool.get(t.pname,t),s++,i.pubsub.broadcast(z1074.LOAD_PROGRESS_CHANGED,s,n)):t.cid}).then(function(){t.settings.put({name:"cageID",value:e}).then(function(){i.pubsub.broadcast(z1074.AFTER_LOAD_EVENT,o)}).catch(function(t){})})})})}},z1074.prototype.getCageRecords=function(o,t){var i=this.db;t?i.cages.get({id:t},function(e){return i.parts.where({cid:t}).toArray(function(t){return e.parts=t,e})}):i.settings.where({name:"cageID"}).first(function(t){if(t)return i.cages.get({id:t.value},function(e){return i.parts.where({cid:e.id}).toArray(function(t){return e.parts=t,o(e),e})});o()}).catch(function(t){o()})},z1074.prototype._processCommands=function(){var t=this;if(!this._processingCommands){var e=this.db,o=this,i=!1;o._processingCommands=!0,e.transaction("rw",e.cages,e.parts,e.settings,function(){return __awaiter(t,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return 0<o._commands.length?(e=o._commands.shift()).action!=n.DELETE_PART?[3,1]:(o._deletePart(e.acc),[3,5]):[3,6];case 1:return e.action!=n.EDIT_PART?[3,2]:(o._editPart(e.acc),[3,5]);case 2:return e.action!=n.ADD_PART?[3,3]:(o._addPart(e.acc),[3,5]);case 3:return e.action!=n.NEW_z1048?[3,5]:(i=!0,[4,o.createNew()]);case 4:t.sent(),t.label=5;case 5:return e.acc=null,e.action=null,ObjectPool.recycle(e),[3,0];case 6:return[2]}})})}).then(function(t){o._processingCommands=!1,i&&o.pubsub.broadcast(z1074.AFTER_NEW_EVENT,o.cageID),o.db.cages.update(o._cageID,{modified:Date.now()}).then(function(t){}).catch(function(t){})}).catch(function(t){o._processingCommands=!1})}},z1074.prototype.deletePart=function(t){var e=ObjectPool.get(o.name);e.action=n.DELETE_PART,e.acc=t,this._commands.push(e),this._processCommands()},z1074.prototype._deletePart=function(t){var e=t.dbid;return this.db.parts.delete(e).then(function(){t.dbid=0})},z1074.prototype.addPart=function(t){if(this.cageID){var e=ObjectPool.get(o.name);e.action=n.ADD_PART,e.acc=t,this._commands.push(e),this._processCommands()}},z1074.prototype._addPart=function(e){var t=this.db,o={cid:this.cageID,pname:e.getName()},i=e.getProps();for(var n in i)o[n]=i[n];return t.parts.add(o).then(function(t){t&&(e.dbid=t)}).catch(function(t){})},z1074.prototype.editCageName=function(t,e){e||(e=this.cageID),e&&this.db.cages.update(e,{name:t}).then(function(t){}).catch(function(t){})},z1074.prototype.editPart=function(t){var e=ObjectPool.get(o.name);e.action=n.EDIT_PART,e.acc=t,this._commands.push(e),this._processCommands()},z1074.prototype._editPart=function(t){if(t&&t.dbid){var e=t.getProps();return this.db.parts.update(t.dbid,e).then(function(t){}).catch(function(t){})}},z1074.prototype.deleteCage=function(e){var o=this;o.db.parts.where("cid").equals(e).delete().then(function(t){o.db.cages.where("id").equals(e).delete().then(function(t){i.app.habStorage.cageID==e?(i.app.habStorage.cageID=null,o.db.settings.where("name").equals("cageID").delete().then(function(){o.pubsub.broadcast(z1074.AFTER_z1048_DELETED,e)})):o.pubsub.broadcast(z1074.AFTER_z1048_DELETED,e)})})},z1074.prototype.subscribe=function(t,e,o){this.pubsub.subscribe(t,e,o)},z1074.prototype.unsubscribe=function(t,e,o){this.pubsub.unsubscribe(t,e,o)},z1074.AFTER_LOAD_EVENT=1,z1074.BEFORE_LOAD_EVENT=2,z1074.AFTER_NEW_EVENT=3,z1074.AFTER_z1048_DELETED=4,z1074.z1048_INFO_LOADED=5,z1074.LOAD_PROGRESS_CHANGED=6,z1074}();i.z1074=e}(z0||(z0={})),function(s){var t=function(){function z1075(){this.links={},this.shareText="",this._visible=!1;var t=document.getElementById("share-menu");(this.rootElement=t).innerHTML="\n                <div>\n                    <div class='social-share-btns'>\n                        <a class='share-btn share-btn-twitter' href='' rel='nofollow' target='_blank'>\n                        <i class='icon-twitter'></i>\n                        Tweet\n                        </a>\n                        <a class='share-btn share-btn-facebook' href='' rel='nofollow' target='_blank'>\n                        <i class='icon-facebook-official'></i>\n                        Share\n                        </a>\n                      \x3c!---  <a class='share-btn share-btn-pinterest' href='' rel='nofollow' target='_blank'>\n                        <i class='icon-pinterest'></i>\n                        Save\n                        </a>\n                        --\x3e\n                        <a class='share-btn share-btn-reddit' href='' rel='nofollow' target='_blank'>\n                        <i class='icon-reddit-alien'></i>\n                        Share\n                        </a>\n                        \n                        <a class='share-btn share-btn-email' href='' rel='nofollow' target='_blank'>\n                        <i class='icon-email'></i>\n                        Share\n                        </a>\n                        <a id='shareQRCodeBtn' class='share-btn'>\n                            <i class='icon-qr_code_2'></i>\n                            QR Code\n                        </a>\n                    </div>\n                    <div style=\"display:flex;\">\n                        <label class=\"pure-material-textfield-outlined\">\n                            <input id=\"textBoxShareURL\" value=\"\" readonly>\n                            <span style=\"color:white\">Share Link</span>\n                            <button id=\"copyShareURLBtn\" data-clipboard-target=\"#textBoxShareURL\">\n                                Copy\n                            </button>\n                        </label>\n                    </div>\n                    <div style=\"display:flex;\">\n                        <label class=\"pure-material-textfield-outlined\">\n                            <input id=\"textBoxEmbedCode\" value=\"\" readonly>\n                            <span style=\"color:white\">Embed Code</span>\n                            <button id=\"copyEmbedCodeBtn\" data-clipboard-target=\"#textBoxEmbedCode\">\n                                Copy\n                            </button>\n                        </label>\n                    </div>\n                </div>   \n                <div style=\"padding:10px\">\n                    <canvas id=\"canvasQRCode\" style=\"padding:5px;\" />\n                </div>\n                ",new ClipboardJS(t.querySelectorAll(".pure-material-textfield-outlined button")),this.links.twitter=t.querySelector(".share-btn-twitter"),this.links.facebook=t.querySelector(".share-btn-facebook"),this.links.reddit=t.querySelector(".share-btn-reddit"),this.links.email=t.querySelector(".share-btn-email"),this.textBoxShareLink=t.querySelector("#textBoxShareURL"),this.textBoxEmbedCode=t.querySelector("#textBoxEmbedCode");var e=document.getElementById("share-btn");e.addEventListener("pointerdown",this.toggle.bind(this)),this.buttonElement=e,this.logoImage=new Image,this.logoImage.src="./images/splash.png",document.getElementById("shareQRCodeBtn").addEventListener("click",this.showQRCode.bind(this))}return Object.defineProperty(z1075.prototype,"isActive",{get:function(){return this._visible},enumerable:!1,configurable:!0}),z1075.prototype.toggle=function(){var t=this.rootElement;t.classList.contains("is-visible")?(t.classList.remove("is-visible"),this._visible=!1):(this.buildShareLinks(),t.classList.add("is-visible"),this._visible=!0),t.children[0].style.display="block",t.children[1].style.display="none"},z1075.prototype.hide=function(){this._visible=!1,this.rootElement.classList.remove("is-visible"),this.rootElement.children[0].style.display="block",this.rootElement.children[1].style.display="none"},z1075.prototype.buildShareLinks=function(){var t=s.app.getCageURL(),e=""+t,o=encodeURIComponent(e);if(this.shareText!=e){var i=encodeURIComponent("#HammyHome "+e);this.links.twitter.href="https://twitter.com/intent/tweet?text="+i,this.links.facebook.href="https://www.facebook.com/sharer/sharer.php?u="+o,this.links.reddit.href="http://www.reddit.com/submit?url="+o+"&amp;title=Hammy Home";var n="Check out the home I made for my hamsters at HammyHome.com! %0D%0A%0D%0A"+o;this.links.email.href="mailto:?subject=HammyHome&body="+n,this.textBoxShareLink.value=t,this.shareText=e,this.textBoxEmbedCode.value='<iframe width="500" height="300" frameborder="0" src="'+t+'"></iframe>'}},z1075.prototype.showQRCode=function(){this.rootElement.children[0].style.display="none",this.rootElement.children[1].style.display="block";var t=""+s.app.getCageURL(),e=document.getElementById("canvasQRCode"),o={width:Math.min(.6*document.body.clientHeight,document.body.clientWidth-40,400)};QRCode.toCanvas(e,t,o,function(t){})},z1075}();s.z1075=t}(z0||(z0={})),function(t){var e=function(){function z1076(t,e,o){this._randSinAng=0,this.speed=0,this.value=0,this.min=0,this.max=1,this.speed=o,this.min=t,this.max=e,this.update()}return z1076.prototype.update=function(){var t=2*(Math.random()-.5);this._randSinAng+=t*this.speed;var e=.5*(this.max-this.min);this.value=this.min+e+e*Math.sin(this._randSinAng)},z1076}();t.z1076=e}(z0||(z0={})),function(t){var e=function(){function z1077(t){void 0===t&&(t=1),this._randSinAng=0,this.speed=0,this.x=0,this.y=0,this.speed=t,this.update()}return z1077.prototype.update=function(){var t=2*(Math.random()-.5);this._randSinAng+=t*this.speed,this.x=Math.cos(this._randSinAng),this.y=Math.sin(this._randSinAng)},z1077}();t.z1077=e}(z0||(z0={})),function(n){var t=function(){function z109(t){this.hsmMan=new HSMManager;for(var e=[],o=[],i=0;i<t.length;i++)t[i].getz49s&&t[i].getz49s(e),t[i].getListenerSetups&&t[i].getListenerSetups(o);this.hsmMan.addState(n.z66.name,n.z66),this.hsmMan.addState(n.z88.name,n.z88,e,o,!0),this.hsmMan.addState(n.z89.name,n.z89)}return z109.prototype.createState=function(t,e,o){return void 0===o&&(o=!1),this.hsmMan.createState(t,e,o)},z109}();n.z109=t}(z0||(z0={})),function(t){var e,o;e=t.Debug||(t.Debug={}),o=function(){function AxisViewer(t,e){void 0===e&&(e=1),this.xline=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],this.yline=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],this.zline=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],this.scaleLines=1,e&&(this.scaleLines=e),this.xmesh=BABYLON.Mesh.CreateLines("xline",this.xline,t,!0),this.ymesh=BABYLON.Mesh.CreateLines("yline",this.yline,t,!0),this.zmesh=BABYLON.Mesh.CreateLines("zline",this.zline,t,!0),this.xmesh.renderingGroupId=1,this.ymesh.renderingGroupId=1,this.zmesh.renderingGroupId=1,this.xmesh.alwaysSelectAsActiveMesh=!0,this.ymesh.alwaysSelectAsActiveMesh=!0,this.zmesh.alwaysSelectAsActiveMesh=!0,this.xmesh.color=new BABYLON.Color3(1,0,0),this.ymesh.color=new BABYLON.Color3(0,1,0),this.zmesh.color=new BABYLON.Color3(0,0,1)}return AxisViewer.prototype.update=function(t,e,o,i){var n=this.scaleLines,s=this.xline[0],a=this.xline[1];s.x=t.x,s.y=t.y,s.z=t.z,a.x=s.x+e.x*n,a.y=s.y+e.y*n,a.z=s.z+e.z*n,BABYLON.Mesh.CreateLines(null,this.xline,null,null,this.xmesh),s=this.yline[0],a=this.yline[1],s.x=t.x,s.y=t.y,s.z=t.z,a.x=s.x+o.x*n,a.y=s.y+o.y*n,a.z=s.z+o.z*n,BABYLON.Mesh.CreateLines(null,this.yline,null,null,this.ymesh),s=this.zline[0],a=this.zline[1],s.x=t.x,s.y=t.y,s.z=t.z,a.x=s.x+i.x*n,a.y=s.y+i.y*n,a.z=s.z+i.z*n,BABYLON.Mesh.CreateLines(null,this.zline,null,null,this.zmesh)},AxisViewer}(),e.AxisViewer=o}(z2||(z2={})),function(t){var e,o;e=t.Debug||(t.Debug={}),o=function(){function BodyViewer(t,e){this.xline=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],this.yline=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],this.zline=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],this.body=t,this.xmesh=BABYLON.Mesh.CreateLines("xline",this.xline,e,!0),this.ymesh=BABYLON.Mesh.CreateLines("yline",this.yline,e,!0),this.zmesh=BABYLON.Mesh.CreateLines("zline",this.zline,e,!0),this.xmesh.renderingGroupId=1,this.ymesh.renderingGroupId=1,this.zmesh.renderingGroupId=1,this.xmesh.alwaysSelectAsActiveMesh=!0,this.ymesh.alwaysSelectAsActiveMesh=!0,this.zmesh.alwaysSelectAsActiveMesh=!0,this.xmesh.material.checkReadyOnlyOnce=!0,this.xmesh.color=new BABYLON.Color3(1,0,0),this.ymesh.material.checkReadyOnlyOnce=!0,this.ymesh.color=new BABYLON.Color3(0,1,0),this.zmesh.material.checkReadyOnlyOnce=!0,this.zmesh.color=new BABYLON.Color3(0,0,1);var o=this;e.registerBeforeRender(function(){o.update()})}return BodyViewer.prototype.update=function(){var t=this.body,e=t.position,o=t.rotation.elements,i=this.xline[0],n=this.xline[1];i.x=e.x,i.y=e.y,i.z=e.z,n.x=i.x+o[0],n.y=i.y+o[3],n.z=i.z+o[6],BABYLON.Mesh.CreateLines(null,this.xline,null,null,this.xmesh),i=this.yline[0],n=this.yline[1],i.x=e.x,i.y=e.y,i.z=e.z,n.x=i.x+o[1],n.y=i.y+o[4],n.z=i.z+o[7],BABYLON.Mesh.CreateLines(null,this.yline,null,null,this.ymesh),i=this.zline[0],n=this.zline[1],i.x=e.x,i.y=e.y,i.z=e.z,n.x=i.x+o[2],n.y=i.y+o[5],n.z=i.z+o[8],BABYLON.Mesh.CreateLines(null,this.zline,null,null,this.zmesh)},BodyViewer}(),e.BodyViewer=o}(z2||(z2={})),function(t){var e,o;e=t.Debug||(t.Debug={}),o=function(s){function BoneAxisViewer(t,e,o,i){void 0===o&&(o=1);var n=s.call(this,t,o)||this;return n.xaxis=new BABYLON.Vector3(1,0,0),n.yaxis=new BABYLON.Vector3(0,1,0),n.zaxis=new BABYLON.Vector3(0,0,1),n.right=new BABYLON.Vector3(1,0,0),n.up=new BABYLON.Vector3(0,1,0),n.forward=new BABYLON.Vector3(0,0,1),n.pos=BABYLON.Vector3.Zero(),n.bone=e,n.mesh=i,n}return __extends(BoneAxisViewer,s),BoneAxisViewer.prototype.update=function(){var t=this.bone;t.getAbsolutePositionToRef(this.mesh,this.pos),t.getDirectionToRef(this.right,this.mesh,this.xaxis),t.getDirectionToRef(this.up,this.mesh,this.yaxis),t.getDirectionToRef(this.forward,this.mesh,this.zaxis),s.prototype.update.call(this,this.pos,this.xaxis,this.yaxis,this.zaxis)},BoneAxisViewer}(e.AxisViewer),e.BoneAxisViewer=o}(z2||(z2={})),function(t){var u,e;u=t.Graphics||(t.Graphics={}),e=function(){function z1079(t){this.spsManagers=[],this.pickablez1080s=[],this.spsMansToBuild=[],this._buildSPSMeshArr=[],this.scene=t}return z1079.prototype.init=function(t,e){void 0===e&&(e=0);for(var o=this.scene,i={},n=0;n<t.length;n++){var s=t[n],a=this.getz1080Key(s),r=i[a];if(s.renderingGroupID||e){if(e!=s.renderingGroupID)continue}else;if(r||(r=this.createz1080(s,a,o),i[a]=r),r.addMesh(s.shapeName,s.meshName,s.numInstances,s.maxInstances),s.applyMaterialToSPS){var c=u.z3.GetMaterial(s.applyMaterialToSPS);c&&!r.material&&(r.material=c)}s.wireframe&&(r.material||(r.material=new BABYLON.StandardMaterial("",o)),r.material.wireframe=!0)}for(var d in i)this.spsMansToBuild.push(i[d]);var p=this.spsManagers;o.registerBeforeRender(function(){for(var t=p.length,e=0;e<t;e++)p[e].update()}),this.buildMeshesByRenderingGroupID(e)},z1079.prototype.addNewSPSMan=function(t,e,o,i){void 0===e&&(e=0),void 0===o&&(o=!1),void 0===i&&(i=null);for(var n=this.scene,s={},a=0;a<t.length;a++){var r=t[a],c=this.getz1080Key(r),d=s[c];if(r.renderingGroupID||e){if(e!=r.renderingGroupID)continue}else;if(d||(d=this.createz1080(r,c,n),s[c]=d),d.addMesh(r.shapeName,r.meshName,r.numInstances,r.maxInstances),r.applyMaterialToSPS){var p=u.z3.GetMaterial(r.applyMaterialToSPS);p&&!d.material&&(d.material=p)}r.wireframe&&(d.material||(d.material=new BABYLON.StandardMaterial("",n)),d.material.wireframe=!0)}for(var l in s)this.spsMansToBuild.push(s[l]);o?this.buildMeshesByRenderingGroupIDOnePerFrame(e,i):this.buildMeshesByRenderingGroupID(e)},z1079.prototype.buildMeshesByRenderingGroupID=function(t){for(var e=0;e<this.spsMansToBuild.length;e++){var o=this.spsMansToBuild[e];o.mesh||o.renderingGroupID==t&&(o.material||(o.material=u.z3.GetMaterial("default0")),o.buildMesh(),1==o.mesh.renderingGroupId&&o.mesh.unfreezeWorldMatrix(),this.spsManagers.push(o),(o.mesh.isPickable||o.mesh.enablePointerMoveEvents)&&this.pickablez1080s.push(o))}},z1079.prototype.buildMeshesByRenderingGroupIDOnePerFrame=function(t,e){for(var o=0;o<this.spsMansToBuild.length;o++){var i=this.spsMansToBuild[o];i.mesh||i.renderingGroupID==t&&(i.material||(i.material=u.z3.GetMaterial("default0")),this._buildSPSMeshArr.push(i))}this._bindedBuildSPSMehes||(this._bindedBuildSPSMehes=this._buildSPSMeshes.bind(this)),this._callback=e,this._buildSPSMeshes()},z1079.prototype._buildSPSMeshes=function(){var t=this._buildSPSMeshArr.length-1;if(!(t<0)){var e=this._buildSPSMeshArr[t];e.buildMesh(),1==e.mesh.renderingGroupId&&e.mesh.unfreezeWorldMatrix(),this.spsManagers.push(e),(e.mesh.isPickable||e.mesh.enablePointerMoveEvents)&&this.pickablez1080s.push(e),this._buildSPSMeshArr.length--,0<t?requestAnimationFrame(this._bindedBuildSPSMehes):this._callback&&this._callback()}},z1079.prototype.doDepthSort=function(t){void 0===t&&(t=!1);for(var e=0;e<this.spsManagers.length;e++)this.spsManagers[e].needsToBeSorted=!0},z1079.prototype.getz1080Key=function(t){var e="spsMan";return t.isPickable&&(e+="Pick",t.hideButton&&(e+="hide")),t.enablePointerMoveEvents&&(e+="PointerMove"),t.computeVertex&&(e+="Computeverts"),t.computeTextures&&(e+="ComputeTextures"),t.hasAlpha&&(e+="Alpha"),t.depthSort&&(e+="DepthSort"),t.renderingGroupID&&(e+="Render"+t.renderingGroupID),t.applyMaterialToSPS&&(e+=t.applyMaterialToSPS),t.tileSheetCols&&(e+="Tsc"+t.tileSheetCols),t.tileSheetRows&&(e+="Tsr"+t.tileSheetRows),t.disableBackFaceCulling&&(e+="NoBFC"),t.tileWidth&&(e+="TWidth"+t.tileWidth),t.tileHeight&&(e+="THeight"+t.tileHeight),e},z1079.prototype.createz1080=function(t,e,o){void 0===e&&(e="");var i={isPickable:!1,enablePointerMoveEvents:!1,isHidden:!1,hasVertexAlpha:!1,computeColor:!0,computeTexture:!1,computeParticleVertex:!1,renderingGroupID:0,disableBackFaceCulling:!1,depthSort:!1};return t.isPickable&&(i.isPickable=!0,t.hideButton&&(i.isHidden=!0,i.computeColor=!1)),t.enablePointerMoveEvents&&(i.enablePointerMoveEvents=!0),t.computeVertex&&(i.computeParticleVertex=!0),t.hasAlpha&&(i.hasVertexAlpha=!0),t.computeTextures&&(i.computeTexture=!0),t.renderingGroupID&&(i.renderingGroupID=t.renderingGroupID),t.depthSort&&(i.depthSort=!0),t.disableBackFaceCulling&&(i.disableBackFaceCulling=!0),new u.z1080(e,o,i)},z1079.prototype.scalez1080s=function(t,e){void 0===t&&(t=1);for(var o=0;o<this.spsManagers.length;o++){var i=this.spsManagers[o];i.renderingGroupID==e&&i.mesh.scaling.scaleInPlace(t)}},z1079.prototype.setParentz1080s=function(t,e){for(var o=0;o<this.spsManagers.length;o++){var i=this.spsManagers[o];i.renderingGroupID==e&&(i.mesh.parent=t,i.mesh.unfreezeWorldMatrix())}},z1079.prototype.registerWithz1080s=function(t){if(t.shapeName&&t.onChangeObservable){for(var e=0;e<this.spsManagers.length;e++){var o=this.spsManagers[e];o.renderingGroupID,t.renderingGroupID==o.renderingGroupID&&o.shapeInfos[t.shapeName.toLocaleLowerCase()]&&(t.onChangeObservable.add(o.addToUpdateSet,-1,!1,o),o.addToUpdateSet(t),!0)}t.renderingGroupID}},z1079.prototype.getz1080=function(t){for(var e=0;e<this.spsManagers.length;e++)if(this.spsManagers[e].name==t)return this.spsManagers[e]},z1079}(),u.z1079=e}(z2||(z2={})),function(t){var e,o;e=t.Graphics||(t.Graphics={}),o=function(){function MeshBuilder(){}return MeshBuilder.createTray=function(t,e,o,i,n,s){var a=[],r=.5*e,c=.5*i,d=[];d.push(new BABYLON.Vector3(0,0,0)),d.push(new BABYLON.Vector3(0,0,0)),d.push(new BABYLON.Vector3(0,0,0)),d.push(new BABYLON.Vector3(0,0,0)),a.push(d);var p=.2;(d=[]).push(new BABYLON.Vector3(r-n-p,0,c-n-p)),d.push(new BABYLON.Vector3(r-n-p,0,-c+n+p)),d.push(new BABYLON.Vector3(-r+n+p,0,-c+n+p)),d.push(new BABYLON.Vector3(-r+n+p,0,c-n-p)),a.push(d),p=.3,(d=[]).push(new BABYLON.Vector3(r-n,p,c-n)),d.push(new BABYLON.Vector3(r-n,p,-c+n)),d.push(new BABYLON.Vector3(-r+n,p,-c+n)),d.push(new BABYLON.Vector3(-r+n,p,c-n)),a.push(d);(d=[]).push(new BABYLON.Vector3(1*r,o,1*c)),d.push(new BABYLON.Vector3(1*r,o,1*-c)),d.push(new BABYLON.Vector3(1*-r,o,1*-c)),d.push(new BABYLON.Vector3(1*-r,o,1*c)),a.push(d);(d=[]).push(new BABYLON.Vector3(r+.2,o,c+.2)),d.push(new BABYLON.Vector3(r+.2,o,-c-.2)),d.push(new BABYLON.Vector3(-r-.2,o,-c-.2)),d.push(new BABYLON.Vector3(-r-.2,o,c+.2)),a.push(d);return(d=[]).push(new BABYLON.Vector3(r+.2,o-.2,c+.2)),d.push(new BABYLON.Vector3(r+.2,o-.2,-c-.2)),d.push(new BABYLON.Vector3(-r-.2,o-.2,-c-.2)),d.push(new BABYLON.Vector3(-r-.2,o-.2,c+.2)),a.push(d),BABYLON.Mesh.CreateRibbon(t,a,!1,!0,0,s,!1)},MeshBuilder.createSidesForGroundMesh=function(t,e,o,i,n,s,a){void 0===o&&(o=!1),void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===s&&(s=!1),void 0===a&&(a=0);var r=t.subdivisionsX,c=t.subdivisionsY,d=t.getScene(),p=[],l=[],u=[];t.updateMeshPositions(function(t){for(var e=(r+1)*(c+1),o=0;o<t.length;o+=3){var i=o/3,n=t[o+1],s=i%(r+1);0!=s&&s!=r||p.push(n),i<=r?l.push(n):e-(r+1)*(1+a)<=i&&i<e-(r+1)*a&&(l.push(n),u.push(o+1))}});var y=t._width,g=t._height,m=[],f=y/r,A=g/c,b=0,v=e-t.position.y,x=g/2,C=0,S=0,T=[];for(S=r;0<=S;S--)b=f*S-y/2,i||T.push(new BABYLON.Vector3(b,l[S],x));for(C=0;C<=c;C++)x=-C*A+g/2,n||T.push(new BABYLON.Vector3(-y/2,p[2*C],x));for(S=0;S<=r;S++)b=f*S-y/2,o||T.push(new BABYLON.Vector3(b,l[S+r+1],x+a*A));for(C=c;0<=C;C--)x=-C*A+g/2,s||T.push(new BABYLON.Vector3(y/2,p[2*C+1],x));for(m.push(T),T=[],S=r;0<=S;S--)b=f*S-y/2,i||T.push(new BABYLON.Vector3(b,v,x));for(C=0;C<=c;C++)x=-C*A+g/2,n||T.push(new BABYLON.Vector3(-y/2,v,x));for(S=0;S<=r;S++)b=f*S-y/2,o||T.push(new BABYLON.Vector3(b,v,x+a*A));for(C=c;0<=C;C--)x=-C*A+g/2,s||T.push(new BABYLON.Vector3(y/2,v,x));m.push(T);var B=BABYLON.MeshBuilder.CreateRibbon("gr",{pathArray:m,updatable:!0},d);B.position.copyFrom(t.position);var O=B.getVerticesData(BABYLON.VertexBuffer.PositionKind),P=[];P[0]=[],P[1]=[];for(var M=t,I=1e5,N=0;N<O.length;N+=3){var z=O[N+1];if(0<z){var w=O[N],_=O[N+2],R=Math.round((w+M._maxX)*M.subdivisionsX/M._width),L=Math.round(-(_+M._maxZ)*M.subdivisionsY/M._height+M.subdivisionsY)*(M._subdivisionsX+1)+R,F=P[0],D=P[1];null==F[L]?(F[L]=N+1,0):null==D[L]&&(D[L]=N+1)}z<I&&(I=z)}return{mesh:B,sidesIndMap:P,groundInd:u}},MeshBuilder.updateHeightGroundSides=function(t,e,o,i,n,s){var a=e.getVerticesData(BABYLON.VertexBuffer.PositionKind),r=Math.round((i+t._maxX)*t.subdivisionsX/t._width),c=o[Math.round(-(n+t._maxZ)*t.subdivisionsY/t._height+t.subdivisionsY)*(t._subdivisionsX+1)+r];if(c){for(var d=0;d<c.length;d++){a[c[d]]=s}e.updateVerticesData(BABYLON.VertexBuffer.PositionKind,a,!1,!1)}},MeshBuilder.generateLandscape=function(t,e,o,i,n,s,a,r){void 0===a&&(a=0),void 0===r&&(r=0);var c=BABYLON.MeshBuilder.CreateGround("gd",{width:t-2*a,height:e-2*a,subdivisionsX:o,subdivisionsY:i,updatable:!0},s);var d=MeshBuilder.generatePerlinNoise(2*(o+1),2*(i+1),{octaveCount:1,amplitude:n,persistence:.2});return c.updateMeshPositions(function(t){t.length;for(var e=0;e<t.length;e+=3){var o=d[e];t[e+1]=o+r}}),c.updateCoordinateHeights(),c.refreshBoundingInfo(),c},MeshBuilder.generatePerlinNoise=function(t,e,o){var i,n=(o=o||{}).octaveCount||4,s=o.amplitude||.1,a=o.persistence||.2,r=MeshBuilder.generateWhiteNoise(t,e),c=new Array(n);for(i=0;i<n;++i)c[i]=MeshBuilder.generateSmoothNoise(i,t,e,r);var d=new Array(t*e);for(i=n-1;0<=i;--i){s*=a;for(var p=0;p<d.length;++p)d[p]=d[p]||0,d[p]+=c[i][p]*s}for(i=0;i<d.length;++i);return d},MeshBuilder.generateSmoothNoise=function(t,e,o,i){for(var n=MeshBuilder.interpolate,s=new Array(e*o),a=Math.pow(2,t),r=1/a,c=0,d=0;d<o;++d)for(var p=Math.floor(d/a)*a,l=(p+a)%o,u=(d-p)*r,y=0;y<e;++y){var g=Math.floor(y/a)*a,m=(g+a)%e,f=(y-g)*r,A=n(i[p*e+g],i[l*e+g],u),b=n(i[p*e+m],i[l*e+m],u);s[c]=n(A,b,f),c+=1}return s},MeshBuilder.generateWhiteNoise=function(t,e){for(var o=new Array(t*e),i=0;i<o.length;++i)o[i]=Math.random();return o},MeshBuilder.interpolate=function(t,e,o){return t*(1-o)+o*e},MeshBuilder.removeDuplicateVertices=function(t){for(var e=t.getVerticesData(BABYLON.VertexBuffer.PositionKind),o=t.getVerticesData(BABYLON.VertexBuffer.NormalKind),i=t.getIndices(),n=[],s=[],a=[],r=0,c=[],d=0;d<i.length;d+=3){for(var p=[i[d],i[d+1],i[d+2]],l=[],u=0;u<3;u++){l[u]="";for(var y=0;y<3;y++)Math.abs(e[3*p[u]+y])<1e-4&&(e[3*p[u]+y]=0),l[u]+=e[3*p[u]+y]+"|";l[u]=l[u].slice(0,-1)}if(l[0]!=l[1]&&l[0]!=l[2]&&l[1]!=l[2])for(u=0;u<3;u++){var g=c.indexOf(l[u]);if(g<0){c.push(l[u]),g=r++;for(y=0;y<3;y++)n.push(e[3*p[u]+y]),s.push(o[3*p[u]+y])}a.push(g)}}var m=new BABYLON.VertexData;m.positions=n,m.indices=a,m.normals=s,m.applyToMesh(t)},MeshBuilder.createFrame=function(t,e,o,i,n,s,a,r,c,d,p){var l;(void 0===r&&(r=!1),void 0===c&&(c=!1),void 0===d&&(d=!1),void 0===p&&(p=!1),r)||((l=o.createInstance(i+"top")).scaling.y=n,l.rotation.z=.5*Math.PI,l.position.y=.5*s-.5*a,e&&(l.parent=e));c||((l=o.createInstance(i+"right")).scaling.y=s,l.position.x=.5*n-.5*a,e&&(l.parent=e));d||((l=o.createInstance(i+"bottom")).scaling.y=n,l.rotation.z=.5*-Math.PI,l.position.y=.5*-s+.5*a,e&&(l.parent=e));p||((l=o.createInstance(i+"left")).scaling.y=s,l.rotation.y=Math.PI,l.position.x=.5*-n+.5*a,e&&(l.parent=e))},MeshBuilder.createBoxWithFrames=function(t,e,o,i,n,s,a,r,c,d,p,l,u,y,g){void 0===l&&(l=!1),void 0===u&&(u=!1),void 0===y&&(y=!1),void 0===g&&(g=!1);var m=e,f=new BABYLON.Mesh("",t);if(!y){f.rotation.x=.5*Math.PI,f.position.y=.5*s,MeshBuilder.createFrame(t,f,m,"bottom",o,n,s);for(var A=f.getChildMeshes(!0),b=0;b<A.length;b++)A[b].setParent(null),d&&d.push(A[b]),a&&a.push(A[b])}if(!l){f.rotation.x=.5*-Math.PI,f.position.y=i-.5*s,MeshBuilder.createFrame(t,f,m,"top",o,n,s);for(A=f.getChildMeshes(!0),b=0;b<A.length;b++)A[b].setParent(null),r&&r.push(A[b]),a&&a.push(A[b])}if(!g){f.rotation.x=0,f.rotation.y=.5*-Math.PI,f.position.x=.5*-o+.5*s,f.position.y=.5*i,MeshBuilder.createFrame(t,f,m,"left",n,i,s,!0,!1,!0,!1);for(A=f.getChildMeshes(!0),b=0;b<A.length;b++)A[b].setParent(null),p&&p.push(A[b]),a&&a.push(A[b])}if(!u){f.rotation.x=0,f.rotation.y=.5*Math.PI,f.position.x=.5*o-.5*s,f.position.y=.5*i,MeshBuilder.createFrame(t,f,m,"right",n,i,s,!0,!1,!0,!1);for(A=f.getChildMeshes(!0),b=0;b<A.length;b++)A[b].setParent(null),c&&c.push(A[b]),a&&a.push(A[b])}},MeshBuilder.CreateSPSPlane=function(t,e,r,c,d,o,i,n,s,a,p,l,u,y,g,m){void 0===l&&(l=null),void 0===u&&(u=0),void 0===y&&(y=1),void 0===g&&(g=0),void 0===m&&(m=1);var f=r*c,A=BABYLON.Mesh.CreatePlane("plane",d,t),b=new BABYLON.SolidParticleSystem("SPS",t);b.addShape(A,f),b.buildMesh().material=e,A.dispose(),b.initParticles=function(){for(var t=d,e=t*c*.5-.5*t,o=t*r*.5-.5*t,i=0,n=0;n<r;n++)for(var s=0;s<c;s++){var a=this.particles[i];a.position.x=s*t-e,a.position.y=n*t-o,a.position.z=0,l?(a.uvs.x=l[4*i],a.uvs.z=l[4*i+1],a.uvs.y=l[4*i+2],a.uvs.w=l[4*i+3]):(a.uvs.x=u,a.uvs.z=y,a.uvs.y=g,a.uvs.w=m),i++}},b.initParticles(),b.setParticles();var v=c*d*.5,x=r*d*.5,C=new BABYLON.BoundingInfo(new BABYLON.Vector3(-v,-x,0),new BABYLON.Vector3(v,x,0));return b.mesh.setBoundingInfo(C),b.mesh.position.x=o,b.mesh.position.y=i,b.mesh.position.z=n,b.mesh.rotation.x=s,b.mesh.rotation.y=a,b.mesh.rotation.z=p,b.computeParticleRotation=!1,b.computeParticleColor=!1,b},MeshBuilder.CreateSPSBox=function(t,e,o,i,n,s,a,r,c,d,p,l,u){void 0===a&&(a=0),void 0===r&&(r=0),void 0===c&&(c=0),void 0===d&&(d=0),void 0===p&&(p=1),void 0===l&&(l=0),void 0===u&&(u=1);var y=MeshBuilder.CreateSPSPlane,g=n/o,m=i/o;return{front:y(t,e,g,m,o,a,r,c-.5*s,0,Math.PI,0,null,d,p,l,u),back:y(t,e,g,m,o,a,r,c+.5*s,0,0,0,null,d,p,l,u),left:y(t,e,g=n/o,m=s/o,o,a-.5*i,r,c,0,.5*-Math.PI,0,null,d,p,l,u),right:y(t,e,g,m,o,a+.5*i,r,c,0,.5*Math.PI,0,null,d,p,l,u),top:y(t,e,g=s/o,m=i/o,o,a,r+.5*n,c,.5*-Math.PI,0,0,null,d,p,l,u),bottom:y(t,e,g,m,o,a,r-.5*n,c,.5*Math.PI,0,0,null,d,p,l,u)}},MeshBuilder.CreateInstanceWithUnitBox=function(t,e,o,i,n){var s=t.createInstance(e);return s.scaling.x=o,s.scaling.y=i,s.scaling.z=n,s},MeshBuilder.CreateBox=function(t,e,o,i,n){var s=MeshBuilder.CreateInstanceWithUnitBox,a=s(t,"bottom",e,n,i),r=s(t,"left",o,n,i),c=s(t,"right",o,n,i),d=s(t,"front",e,n,o),p=s(t,"back",e,n,o),l=.5*n;r.rotation.z=.5*Math.PI,r.position.x=.5*-e+l,r.position.y=.5*o,c.rotation.z=.5*-Math.PI,c.position.x=.5*e-l,c.position.y=.5*o,d.rotation.x=.5*-Math.PI,d.position.y=.5*o,d.position.z=.5*-i+l,p.rotation.x=.5*Math.PI,p.position.y=.5*o,p.position.z=.5*i-l,a.position.y=l},MeshBuilder.createMeshesOnBox=function(t,e,o,i,n,s,a,r,c,d,p,l,u,y,g,m,f,A,b){void 0===u&&(u=!1),void 0===y&&(y=!1),void 0===g&&(g=!1),void 0===m&&(m=!1),void 0===f&&(f=!1),void 0===A&&(A=!1),void 0===b&&(b=0);var v=s[0].getScene(),x=new BABYLON.Mesh("",v),C=MeshBuilder.createMeshesOnPlane,S=[];d||(d=0);var T=0;if(x.position.x=.5*-e+a+n,x.position.y=.5*o+r-n,x.position.z=.5*-i+c-d,x.rotation.x=.5*-Math.PI,!f){C(n,t,T,e,o,s,x,S,p,l,b);for(var B=0;B<S.length;B++)S[B].setParent(null);T+=e*o}if(b&&S.length>=b)return S;if(x.position.x=.5*e+a-n,x.position.y=.5*o+r-n,x.position.z=.5*i+c+d,x.rotation.y=Math.PI,!A){C(n,t,T,e,o,s,x,S,p,l,b);for(B=0;B<S.length;B++)S[B].setParent(null);T+=e*o}if(b&&S.length>=b)return S;if(x.position.x=.5*e+a+d,x.position.y=.5*o+r-n,x.position.z=.5*-i+c+n,x.rotation.y=.5*-Math.PI,!y){C(n,t,T,i,o,s,x,S,p,l,b);for(B=0;B<S.length;B++)S[B].setParent(null);T+=i*o}if(b&&S.length>=b)return S;if(x.position.x=.5*-e+a-d,x.position.y=.5*o+r-n,x.position.z=.5*i+c-n,x.rotation.y=.5*Math.PI,!m){C(n,t,T,i,o,s,x,S,p,l,b);for(B=0;B<S.length;B++)S[B].setParent(null);T+=i*o}if(b&&S.length>=b)return S;if(x.position.x=.5*e+a-n,x.position.y=.5*o+r+d,x.position.z=.5*i+c-n,x.rotation.x=0,!u){C(n,t,T,i,e,s,x,S,p,l,b);for(B=0;B<S.length;B++)S[B].setParent(null);T+=i*e}if(b&&S.length>=b)return S;if(x.position.x=.5*-e+a+n,x.position.y=.5*-o+r-d,x.position.z=.5*i+c-n,x.rotation.x=-Math.PI,!g){C(n,t,T,i,e,s,x,S,p,l,b);for(B=0;B<S.length;B++)S[B].setParent(null)}return S},MeshBuilder.createMeshesOnPlane=function(t,e,o,i,n,s,a,r,c,d,p){void 0===p&&(p=0),o||(o=0);var l=.5*-t,u=.5*t,y=Math.floor(n/t),g=Math.floor(i/t),m=y,f=g;p&&(f=Math.min(p,g),m=Math.ceil(p/f));var A=f*t,b=m*t;0===c?l+=.5*(i-A):1===c&&(l+=i-A),0===d?u-=.5*(n-b):1===d&&(u-=n-b);for(var v=0,x=0;x<y;x++)for(var C=0;C<g;C++){var S=e[x*g+C+o];if(null!==S){var T=s[S].createInstance(s[S].name+"inst");if(T.position.x=t*C+l,T.position.z=-t*x+u,a&&(T.parent=a),r.push(T),v++,p&&p<=v)return}}},MeshBuilder.CreatePlaneInstance=function(t){MeshBuilder.unitPlane||(MeshBuilder.unitPlane=BABYLON.MeshBuilder.CreatePlane("unitPlane",{size:1},t),t.removeMesh(MeshBuilder.unitPlane));var e=MeshBuilder.unitPlane.createInstance("unitPlaneInst");return t.removeMesh(e),e},MeshBuilder.CreateTube=function(t,e,o){void 0===t&&(t="");var i=12;e.tesselation&&(i=e.tesselation);var n=2*Math.PI,s=n/i,a=[],r=e.radius,c=e.radius;e.topRadius&&(c=e.topRadius);for(var d=e.height,p=[],l=0;l<n;l+=s){var u=r*Math.sin(l),y=r*Math.cos(l),g=0;p.push(new BABYLON.Vector3(u,g,y))}a.push(p);for(p=[],l=0;l<n;l+=s){u=c*Math.sin(l),y=c*Math.cos(l),g=d;p.push(new BABYLON.Vector3(u,g,y))}return a.push(p),BABYLON.Mesh.CreateRibbon(t,a,!1,!0,0,o)},MeshBuilder}(),e.MeshBuilder=o}(z2||(z2={})),function(t){var A,g,e;A=t.Graphics||(t.Graphics={}),g=function ShapeInfo(t,e,o){this.maxInstances=0,this.nextIndex=0,this.numOnScene=0,this.recycledIndexes=[],this.particleIndexes=[],this.name="",this.count=0,this.name=t,this.meshName=e,this.count=o},e=function(){function z1080(t,e,o){void 0===t&&(t=""),this.name="",this.shapeInfos={},this.shapeNum=0,this.hasVertexAlpha=!1,this.accByShapeID=[],this.depthSort=!1,this._needsToBeSorted=!1,this.lastSortFrame=-1,this.computeColor=!1,this.computeTexture=!1,this.computeParticleVertex=!1,this.renderingGroupID=0,this.isVisible=!0,this.frameNum=0,this.isPickable=!1,this.enablePointerMoveEvents=!1,this.useEmissiveTexture=!1,this.useOpacityTexture=!1,this.backFaceCulling=!0,this.pubsub=new Pubsub,this.expandable=!1,this.canRemakeBigger=!0,this.updateSet=new z1072Set,this.remakeCount=0,this.tempArr=[],o.renderingGroupID&&(this.renderingGroupID=o.renderingGroupID),this.name=t,this.isPickable=o.isPickable,this.enablePointerMoveEvents=o.enablePointerMoveEvents,o.hasVertexAlpha&&(this.hasVertexAlpha=o.hasVertexAlpha,this.depthSort=!0),o.depthSort&&(this.depthSort=!0),o.disableBackFaceCulling&&(this.backFaceCulling=!1),this.computeColor=o.computeColor,this.computeTexture=o.computeTexture,this.computeParticleVertex=o.computeParticleVertex,this.depthSort&&this.depthSort,this.scene=e,o.isHidden&&(this.isVisible=!1),this.createSPS()}return Object.defineProperty(z1080.prototype,"needsToBeSorted",{get:function(){return this._needsToBeSorted},set:function(t){this._needsToBeSorted=t},enumerable:!1,configurable:!0}),z1080.prototype.createSPS=function(){this.sps?this.sps:(this.sps=new BABYLON.SolidParticleSystem("SPS",this.scene,{isPickable:this.isPickable,enableDepthSort:this.depthSort}),this.computeParticleVertex&&(this.sps.updateParticleVertex=this.updateParticleVertex.bind(this)),this.sps.updateParticle=function(t){return t},this.sps.recomputeNormals=!1,this.sps.computeParticleColor=this.computeColor,this.sps.computeBoundingBox=!1,this.sps.computeParticleVertex=this.computeParticleVertex,this.sps.initParticles=function(){for(var t=0;t<this.particles.length;t++)this.particles[t]})},z1080.prototype.addToUpdateSet=function(t,e){if(t.shapeEnabled||-1!=t.solidParticleIndex)if(e&&2==e.mask){this.updateSet.remove(t,t.id),t.isOnScene=!1,this.setParticle(t);var o=this.shapeInfos[t.shapeName.toLocaleLowerCase()];if(o){var i=o.recycledIndexes;-1==i.indexOf(t.solidParticleIndex)&&i.push(t.solidParticleIndex),t.solidParticleIndex=-1}}else this.updateSet.push(t,t.id,this.frameNum)},z1080.prototype.updateParticles=function(){if(0<this.updateSet.length){var t=this.updateSet;this.mesh.unfreezeNormals();for(var e=0,o=0;o<t.length;o++)this.setParticle(t.getAtIndex(o),!1),e++;e&&this.sps.setParticles(0,0),this.updateSet.clear(),this.mesh.freezeNormals()}},z1080.prototype.addMesh=function(t,e,o,i){t=t.toLocaleLowerCase();var n=!1,s=this.shapeInfos[t];if(s?n=!0:(s=new g(t,e,o),i&&(s.maxInstances=i),this.shapeInfos[t]=s,this.shapeNum++),o){var a=this.sps.particles.length;if(n){var r=this.mesh.parent;for(var c in this.shapeInfos[t].count+=o,this.sps.dispose(),this.sps=null,this.createSPS(),this.shapeInfos){var d=this.sps.particles.length,p=this.shapeInfos[c];p.particleIndexes.length=0,p.numOnScene=0;for(var l=d;l<d+p.count;l++)p.particleIndexes.push(l);var u=A.z3.GetMesh(p.meshName);this.sps.addShape(u,p.count),this.scene.removeMesh(u)}this.buildMesh(),r&&(this.mesh.parent=r,this.mesh.unfreezeWorldMatrix());for(l=this.tempArr.length=0;l<this.accByShapeID.length;l++)this.accByShapeID[l]&&this.tempArr.push(this.accByShapeID[l]);for(l=this.accByShapeID.length=0;l<this.tempArr.length;l++){var y=this.tempArr[l];y.uvDirty=!0,y.forceUpdate=!0,this.setParticle(y)}this.remakeCount++}else{for(l=a;l<a+o;l++)s.particleIndexes.push(l);if(0<o){u=A.z3.GetMesh(s.meshName);this.sps.addShape(u,o),this.scene.removeMesh(u)}}}},z1080.prototype.doDepthSort=function(t){if(void 0===t&&(t=!1),!t){if(!this.depthSort)return;if(this.lastSortFrame==this.frameNum)return;if(!this.needsToBeSorted&&this.frameNum%15!=0)return}return this.pubsub.broadcast(z1080.BEFORE_DEPTH_SORT_EVENT,this),this.sps.depthSortParticles=!0,this.sps.setParticles(),this.sps.depthSortParticles=!1,this.pubsub.broadcast(z1080.AFTER_DEPTH_SORT_EVENT,this),this.needsToBeSorted=!1,this.lastSortFrame=this.frameNum,!0},z1080.prototype.updateParticleVertex=function(t,e,o){var i=this.accByShapeID[t.idx];i&&i.updateVertex(e,o)},z1080.prototype.setParticle=function(t,e){void 0===e&&(e=!0);var o=t.shapeName.toLocaleLowerCase();if(this.shapeInfos[o]){this.depthSort&&(t.onBeforeDepthSort||t.onAfterDepthSort)&&!t.depthSortRegistered&&(t.onBeforeDepthSort&&this.pubsub.subscribe(z1080.BEFORE_DEPTH_SORT_EVENT,t.onBeforeDepthSort,t),t.onAfterDepthSort&&this.pubsub.subscribe(z1080.AFTER_DEPTH_SORT_EVENT,t.onAfterDepthSort,t),t.depthSortRegistered=!0);var i=this.sps,n=this.shapeInfos[o];if(-1!=t.solidParticleIndex||t.shapeEnabled){-1==t.solidParticleIndex&&(0<n.recycledIndexes.length?t.solidParticleIndex=n.recycledIndexes.pop():(t.solidParticleIndex=n.nextIndex,n.nextIndex++)),(this.expandable||this.canRemakeBigger)&&null==n.particleIndexes[t.solidParticleIndex]&&(this.addMesh(o,n.meshName,n.maxInstances-(n.nextIndex-1)),i=this.sps);var s=n.particleIndexes[t.solidParticleIndex];this.accByShapeID[s]=t;var a=i.particles[s];if(a){t.rotationQuaternion&&(a.rotationQuaternion||(a.rotationQuaternion=BABYLON.Quaternion.Identity()));var r=!1;if(!1!==t.isOnScene||!1!==a.alive){t.isOnScene!==a.alive&&(t.isOnScene?n.numOnScene++:n.numOnScene--,r=!0),r||a.position.equals(t.position)||(r=!0),r||a.rotationQuaternion.equals(t.rotationQuaternion)||(r=!0),r||!t.scaling||a.scaling.equals(t.scaling)||(r=!0),!r&&t.forceUpdate&&(r=!0),t.dirtyHeights&&(t.mesh.updateCoordinateHeights(),t.dirtyHeights=!1);var c=a.color,d=t.color;if(this.computeColor&&(r||c.r==d.r&&c.g==d.g&&c.b==d.b||(r=!0)),r){if(t.isOnScene){var p;if(this.computeTexture&&this.material&&t.uvDirty)if(""!=t.textureName&&t.textureName)(p=A.TileSet.TileInfos[t.textureName].tileSet)&&(p.setUVFromTileName(t.textureName,a.uvs),t.uvDirty=!1);else(p=A.TileSet.TileInfos[t.textureName].tileSet)&&(p.setUVFromTileNum(t.tileNum,a.uvs),t.uvDirty=!1);t.scaling&&a.scaling.copyFrom(t.scaling),a.color.copyFrom(t.color),a.alive=!0,a.isVisible=!0,a.position.copyFrom(t.position),a.rotationQuaternion.copyFrom(t.rotationQuaternion)}else a.position.x=9999;if(i.computeParticleTexture=this.computeTexture,i.computeParticleColor=this.computeColor,i.computeParticleVertex=this.computeParticleVertex,t.uvs&&(a.uvs.x=t.uvs.x,a.uvs.y=t.uvs.y,a.uvs.z=t.uvs.z,a.uvs.w=t.uvs.w),t.textureScale){var l=a.uvs.z-a.uvs.x,u=a.uvs.w-a.uvs.y,y=a.uvs.x+.5*l,g=a.uvs.y+.5*u,m=t.textureScale.x*l,f=t.textureScale.y*u;a.uvs.x=y-.5*m,a.uvs.z=y+.5*m,a.uvs.y=g-.5*f,a.uvs.w=g+.5*f}i.computeParticleVertex?i.setParticles(a.idx,a.idx):i.setParticles(a.idx,a.idx,e),this.depthSort&&t.requestDepthSort&&(this.needsToBeSorted=!0,t.requestDepthSort=!1),t.isOnScene||(a.alive=!1,a.isVisible=!1),t.forceUpdate=!1}}else r=!0}}}},z1080.prototype.buildMesh=function(){var t=this.sps,e=t.buildMesh();this.depthSort,e.name="mesh"+this.name,e.id="mesh"+this.name,this.renderingGroupID&&(e.renderingGroupId=this.renderingGroupID),this.enablePointerMoveEvents&&(e.enablePointerMoveEvents=!0),this.material&&(e.material=this.material),this.computeTexture&&(this.material||(this.material=new BABYLON.StandardMaterial("mat1",this.scene),e.material=this.material)),this.useEmissiveTexture&&(this.material.emissiveTexture=this.material.diffuseTexture||this.material.opacityTexture,this.material.diffuseTexture=null,this.material.disableLighting=!0),t.computeParticleTexture=this.computeTexture,t.computeParticleColor=this.computeColor,e.hasVertexAlpha=this.hasVertexAlpha,e.freezeWorldMatrix(),t.isAlwaysVisible=!0;for(var o=0;o<t.particles.length;o++)t.particles[o].position.x=9999;t.setParticles();for(o=0;o<t.particles.length;o++)t.particles[o].alive=!1;if(t.computeBoundingBox=!1,this.isPickable){var i=new BABYLON.BoundingInfo(new BABYLON.Vector3(-1e3,-1e3,-1e3),new BABYLON.Vector3(1e3,1e3,1e3));t.mesh.setBoundingInfo(i)}return this.mesh=t.mesh,e.isVisible=this.isVisible,this.backFaceCulling||(e.material||(e.material=new BABYLON.StandardMaterial("",this.scene)),e.material.backFaceCulling=this.backFaceCulling),this.mesh},z1080.prototype.update=function(){this.mesh&&(this.frameNum++,this.updateParticles(),this.needsToBeSorted&&this.doDepthSort())},z1080.prototype.getShapeInfo=function(t){return this.shapeInfos[t.toLowerCase()]},z1080.BEFORE_DEPTH_SORT_EVENT=1,z1080.AFTER_DEPTH_SORT_EVENT=2,z1080}(),A.z1080=e}(z2||(z2={})),function(t){var A,e;A=t.Graphics||(t.Graphics={}),e=function(){function TouchMesh(t,e,o,i,n,s,a){void 0===o&&(o=100),void 0===i&&(i=1),void 0===n&&(n=1),void 0===s&&(s=1),void 0===a&&(a=.5),this.meshes=[],this._curIndex=0,this._active=!1,this._colorAlpha=.5,this._colorR=1,this._colorG=1,this._colorB=1,this.trailLength=0,this.maxDistBetween=.02,this._lastX=0,this._lastY=0,this._lastZ=0,this._pointerDown=!1,t.position.x=0,t.position.y=0,t.position.z=0;var r=t;e&&(r.material=e),this._colorAlpha=a,this._colorR=i,this._colorG=n,this._colorB=s,r.thinInstanceRegisterAttribute("color",4),this.trailLength=o,this.mesh=r,this._bindedFadeMeshes=this.fadeMeshes.bind(this)}return TouchMesh.prototype.setPosition=function(t,e,o){if(this.trailLength>this.meshes.length){var i=this.meshes.length,n=new A.z1070;n.init({name:"touchMesh"+i,sourceMesh:this.mesh}),(this.meshes[i]=n).setColor(1,1,1,0)}else this.trailLength;var s=t-this._lastX,a=e-this._lastY,r=s*s+a*a,c=this._colorAlpha;r<4e-4&&(c*=50*(p=Math.sqrt(r)));var d=this.maxDistBetween;if(this._active&&this._pointerDown&&d*d<r)for(var p,l=s/(p=Math.sqrt(r)),u=a/p,y=Math.floor(p/d),g=0;g<y;g++){var m=this._lastX+l*d*(g+1),f=this._lastY+u*d*(g+1);this.meshes[this._curIndex].setPosition(m,f,o),this.meshes[this._curIndex].setColor(this._colorR,this._colorG,this._colorB,c),this._curIndex++,this._curIndex>=this.meshes.length&&(this._curIndex=0)}this._lastX=t,this._lastY=e,this._lastZ=o,this.meshes[this._curIndex].setPosition(t,e,o),this.meshes[this._curIndex].setColor(this._colorR,this._colorG,this._colorB,c),this._curIndex++,this._curIndex>=this.meshes.length&&(this._curIndex=0),this._active||requestAnimationFrame(this._bindedFadeMeshes),this._pointerDown=!0},TouchMesh.prototype.fadeMeshes=function(){for(var t=0,e=0;e<this.meshes.length;e++){var o=this.meshes[e],i=o.color;if(0<i.a){var n=i.a-.001;n<0&&(n=0),o.setColor(i.r,i.g,i.b,n),t++}}0<t?(this._active=!0,requestAnimationFrame(this._bindedFadeMeshes)):this._active=!1},TouchMesh}(),A.TouchMesh=e}(z2||(z2={}));var z2,z1081=function(){function z1081(t,i){var n,s=this;this.slider=void 0,this.isDragging=!1,this._isDown=!1,this._velocityX=0,this._scrollLeft=0,this._smoothStopBinded=void 0,this._mouseDownTime=0,this._mouseUpTime=0,i||(i=document.querySelector(t)),this.slider=i;var a=this;this._smoothStopBinded=this.smoothStop.bind(this),i.addEventListener("mousedown",function(t){a._isDown=!0,i.classList.add("active"),n=t.pageX-i.offsetLeft,a._scrollLeft=i.scrollLeft,a._mouseDownTime=Date.now()}),i.addEventListener("mouseleave",function(){a._isDown=!1,i.classList.remove("active"),s.isDragging&&setTimeout(function(){a.isDragging=!1},0)}),i.addEventListener("mouseup",function(){a._isDown=!1,i.classList.remove("active"),a._mouseUpTime=Date.now(),a._mouseUpTime-a._mouseDownTime<200&&Math.abs(a._velocityX)<.1&&(a.isDragging=!1),a.isDragging&&setTimeout(function(){a.isDragging=!1},0),a._scrollLeft=i.scrollLeft,a.smoothStop()}),i.addEventListener("mousemove",function(t){if(a._isDown){t.preventDefault();var e=t.pageX-i.offsetLeft-n,o=i.scrollLeft;i.scrollLeft=a._scrollLeft-e,s._velocityX=i.scrollLeft-o,e&&(a.isDragging=!0)}})}return z1081.prototype.smoothStop=function(){this._velocityX*=.9,.001<Math.abs(this._velocityX)&&!this._isDown&&(requestAnimationFrame(this._smoothStopBinded),this._scrollLeft+=this._velocityX,this.slider.scrollLeft=Math.round(this._scrollLeft))},z1081}(),z1082=function(){function z1082(t,e,o){this._targPos=0,this._currentPos=0,this._bindedScrollTo=void 0,this._scrollAmount=290,this.createHTML(t),this._navDiv=document.querySelector(e);var i=this.refreshButtons.bind(this);window.addEventListener("resize",i),this._navDiv.addEventListener("scroll",i),this._navDiv.addEventListener("touchmove",i),this.refreshButtons(),this._bindedScrollTo=this._scrollTo.bind(this),this._leftBtn.addEventListener("click",this._scrollLeft.bind(this)),this._rightBtn.addEventListener("click",this._scrollRight.bind(this)),new ResizeObserver(this.refreshButtons.bind(this)).observe(this._navDiv)}return z1082.prototype.refreshButtons=function(){this._currentPos=this._navDiv.scrollLeft;var t=this._navDiv.scrollWidth,e=this._navDiv.scrollLeft,o=this._navDiv.clientWidth;if(this._navDiv.children.length<=1)return this._leftBtn.style.opacity="0",void(this._rightBtn.style.opacity="0");this._leftBtn.style.opacity=0==e?"0":"1",this._rightBtn.style.opacity=t-1<=e+o?"0":"1"},z1082.prototype.createHTML=function(t){var e=document.querySelector(t),o=document.createElement("div"),i=document.createElement("span");o.classList.add("nav-btn-left"),o.classList.add("nav-btn"),i.classList.add("icon-angle-left"),o.appendChild(i),e.appendChild(o),this._leftBtn=o,o=document.createElement("div"),i=document.createElement("span"),o.classList.add("nav-btn-right"),o.classList.add("nav-btn"),i.classList.add("icon-angle-right"),o.appendChild(i),e.appendChild(o),this._rightBtn=o},z1082.prototype._isChildInView=function(t,e){var o=this._navDiv.scrollLeft,i=o+this._navDiv.clientWidth,n=t.offsetLeft,s=n+t.clientWidth;return o<=n&&s<=i||e&&(n<o&&o<s||i<s&&n<i)},z1082.prototype._getElementWidth=function(t){var e=t.currentStyle||window.getComputedStyle(t);return t.offsetWidth+(parseFloat(e.marginLeft)+parseFloat(e.marginRight))+(parseFloat(e.paddingLeft)+parseFloat(e.paddingRight))},z1082.prototype._getScrollAmount=function(t){void 0===t&&(t=1);var e=this._navDiv.children;if(0<t)for(var o=0;o<e.length;o++){var i=e[o];if(this._isChildInView(i,!0))return this._getElementWidth(i)}else for(o=e.length-1;0<=o;o--){i=e[o];if(this._isChildInView(i,!0))return this._getElementWidth(i)}},z1082.prototype._scrollLeft=function(t){this._scrollAmount=this._getScrollAmount(-1),this._targPos=Math.max(0,this._currentPos-this._scrollAmount),this._scrollTo(),t.stopPropagation()},z1082.prototype._scrollRight=function(t){this._scrollAmount=this._getElementWidth(this._navDiv.firstChild);var e=this._navDiv.scrollWidth-this._navDiv.clientWidth+1;this._targPos=Math.min(e,this._currentPos+this._scrollAmount),this._scrollTo(),t.stopPropagation()},z1082.prototype._scrollTo=function(){var t=.1*(this._targPos-this._currentPos);this._currentPos=this._currentPos+t,this._navDiv.scrollLeft=this._currentPos,.01<Math.abs(t)&&requestAnimationFrame(this._bindedScrollTo)},z1082}(),ProgressBar=function(){function ProgressBar(t,e){void 0===t&&(t=""),this.num=0,ProgressBar.count++,this.num=ProgressBar.count;var o=document.createElement("DIV");o.className="progressBar";var i=document.createElement("LABEL");i.innerHTML=t;var n=document.createElement("DIV");n.className="progressBarBG";var s=document.createElement("DIV");s.className="progressBarFG",o.appendChild(i),o.appendChild(n),n.appendChild(s),this.barDiv=s,this.rootElement=o,e&&e.appendChild(o)}return ProgressBar.prototype.update=function(t){this.barDiv.style.width=t+"%"},ProgressBar.prototype.subscribe=function(t,e){ProgressBar.pubsub.subscribe("valueChanged"+this.num,t,e)},ProgressBar.prototype.unsubscribe=function(t,e){ProgressBar.pubsub.unsubscribe("valueChanged"+this.num,t,e)},ProgressBar.count=0,ProgressBar.pubsub=new Pubsub,ProgressBar}(),z1083=function(){function z1083(){this.nodeLines=[],this.nodes=null,this.nodeMeshes=[],this.pathLines=[],this.path=null}return z1083.createNodeGrid=function(t,e,o,i,n,s,a,r,c,d,p){void 0===c&&(c=0),void 0===d&&(d=0),void 0===p&&(p=null);var l=z0.app,u=i-2*c,y=n-2*d;1<s&&(u=(i-2*c)/(s-1)),1<a&&(y=(n-2*d)/(a-1));for(var g=t+.5*-i+c,m=e,f=o+.5*-n+d,A=1.2*u,b=[],v=0;v<a;v++)for(var x=0;x<s;x++){var C=new GraphNode(g+x*u,m,f+v*y);if(b[v*s+x]=C,0<v){var S=b[(v-1)*s+x];if(C.addConnection(S,y),S.addConnection(C,y),0<x){var S=b[(v-1)*s+x-1];C.addConnection(S,A),S.addConnection(C,A)}if(x<s-1){S=b[(v-1)*s+x+1];C.addConnection(S,A),S.addConnection(C,A)}}if(0<x)(S=b[v*s+x-1])&&(C.addConnection(S,u),S.addConnection(C,u));C.data.obj=r,p&&(C.data.obj2=p),l.graph.addNode(C)}return b},z1083.resetNodeGrid=function(t,e,o,i,n,s,a,r,c,d,p){void 0===d&&(d=0),void 0===p&&(p=0);var l=n-2*d,u=s-2*p;1<a&&(l=(n-2*d)/(a-1)),1<r&&(u=(s-2*p)/(r-1));for(var y=e+.5*-n+d,g=o,m=i+.5*-s+p,f=1.2*l,A=0;A<r;A++)for(var b=0;b<a;b++){var v=y+b*l,x=g,C=m+A*u,S=t[A*a+b];S.x=v,S.y=x,S.z=C;if(0<A){var T=t[(A-1)*a+b];if(S.addConnection(T,u),T.addConnection(S,u),0<b){var T=t[(A-1)*a+b-1];S.addConnection(T,f),T.addConnection(S,f)}if(b<a-1){T=t[(A-1)*a+b+1];S.addConnection(T,f),T.addConnection(S,f)}}if(0<b)(T=t[A*a+b-1])&&(S.addConnection(T,l),T.addConnection(S,l));S.data.obj=c}return t},z1083.prototype.initDrawNodes=function(t,e){for(var o=0;o<2e3;o++){var i=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()];this.nodeLines[o]=i}this.nodes=t,this.updateDrawNodes(),this.nodeLineMesh=BABYLON.MeshBuilder.CreateLineSystem(null,{lines:this.nodeLines,updatable:!0,instance:null},e),this.nodeLineMesh.renderingGroupId=1,this.nodeLineMesh.isPickable=!1,this.nodeLineMesh.material.checkReadyOnlyOnce=!0},z1083.prototype.updateDrawNodes=function(){if(this.nodes){for(var t,e=this.nodes,o=e.length,i=0,n=0;n<this.nodeLines.length&&(t=this.nodeLines[n]);n++)t[0].x=0,t[0].y=0,t[0].z=0,t[1].x=0,t[1].y=0,t[1].z=0;for(n=0;n<o;n++)for(var s=e[n],a=0;a<s.connections.length;a++){t=this.nodeLines[i];var r=s.connections[a];t||(t=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],this.nodeLines[i]=t),t[0].x=s.x,t[0].y=s.y,t[0].z=s.z,t[1].x=r.x,t[1].y=r.y,t[1].z=r.z,i++}for(n=0;n<this.nodeMeshes.length;n++){(d=this.nodeMeshes[n])&&d.getScene().removeMesh(d)}var c=z0.app.graphicsHelper;for(n=0;n<e.length;n++){var d;s=e[n];(d=this.nodeMeshes[n])?(d.position.x=s.x,d.position.y=s.y,d.position.z=s.z,d.getScene().addMesh(d)):s.isWall()?this.nodeMeshes[n]=c.addBox(.05,s.x,s.y,s.z,0,0,0):this.nodeMeshes[n]=c.addTestBox(.05,s.x,s.y,s.z,0)}this.nodeLineMesh&&BABYLON.MeshBuilder.CreateLineSystem(null,{lines:this.nodeLines,updatable:!0,instance:this.nodeLineMesh},null)}},z1083.prototype.initDrawPath=function(t){for(var e=0;e<200;e++){var o=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()];this.pathLines[e]=o}this.pathLineMesh=BABYLON.MeshBuilder.CreateLineSystem(null,{lines:this.pathLines,updatable:!0,instance:null},t),this.pathLineMesh.renderingGroupId=2,this.pathLineMesh.isPickable=!1,this.pathLineMesh.material.checkReadyOnlyOnce=!0,this.pathLineMesh.color=new BABYLON.Color3(1,0,0)},z1083.prototype.updateDrawPath=function(t){for(var p1,p2,e=t.length,o=0;o<this.pathLines.length;o++){var i=this.pathLines[o];e<=1?(i[0].x=0,i[0].y=0,i[0].z=0,i[1].x=0,i[1].y=0,i[1].z=0):(o<e-1&&(p1=t[o],p2=t[o+1]),i||(i=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],this.pathLines[o]=i),i[0].x=p1.x,i[0].y=p1.y,i[0].z=p1.z,i[1].x=p2.x,i[1].y=p2.y,i[1].z=p2.z)}this.pathLineMesh&&BABYLON.MeshBuilder.CreateLineSystem(null,{lines:this.pathLines,updatable:!0,instance:this.pathLineMesh},null)},z1083.getSmoothPath=function(t,e,o,i){t.length=0;var n,s=e.length,a=0,r=0,c=0;if(o){var d=e[0],p=e[1];1<s?(a=(d.x+p.x+o.x)/3,c=(d.z+p.z+o.z)/3,r=(d.y+p.y+o.y)/3):(a=o.x+.5*(d.x-o.x),r=o.y+.5*(d.y-o.y),c=o.z+.5*(d.z-o.z)),t.push(a),t.push(r),t.push(c)}for(var l=0;l<s-2;l++)(n=e[l]).data.skip?(a=(n.x+e[l+1].x+e[l+2].x)/3,r=(n.y+e[l+1].y+e[l+2].y)/3,c=(n.z+e[l+1].z+e[l+2].z)/3):(a=n.x,r=n.y,c=n.z),t.push(a),t.push(r),t.push(c);if(i&&1<s){if((n=e[l]).data.skip){a=(e[s-2].x+e[s-1].x+i.x)/3,c=(e[s-2].z+e[s-1].z+i.z)/3;e[s-2].data.obj;r=n.y}else a=n.x,r=n.y,c=n.z;t.push(a),t.push(r),t.push(c)}t.length!=3*e.length&&t.length},z1083.getCurvePoints=function(t,e,o,i,n){void 0===o&&(o=.5),void 0===i&&(i=16),void 0===n&&(n=!1);for(var s,a,r,c,d,p,c1,c2,c3,c4,l,u=t,y=[],g=y.length=0;g<e.length;g++)y[2*g]=e.x,y[2*g+1]=e.z;n?(y.unshift(e[e.length-1].z),y.unshift(e[e.length-1].x),y.unshift(e[e.length-1].z),y.unshift(e[e.length-1].x),y.push(e[0].x),y.push(e[0].z)):(y.unshift(e[0].z),y.unshift(e[0].x),y.push(e[e.length-1].x),y.push(e[e.length-1].z));for(g=2;g<y.length-4;g+=2)for(var m=0;m<=i;m++)r=(y[g+2]-y[g-2])*o,c=(y[g+4]-y[g])*o,d=(y[g+3]-y[g-1])*o,p=(y[g+5]-y[g+1])*o,l=m/i,c1=2*Math.pow(l,3)-3*Math.pow(l,2)+1,c2=-2*Math.pow(l,3)+3*Math.pow(l,2),c3=Math.pow(l,3)-2*Math.pow(l,2)+l,c4=Math.pow(l,3)-Math.pow(l,2),s=c1*y[g]+c2*y[g+2]+c3*r+c4*c,a=c1*y[g+1]+c2*y[g+3]+c3*d+c4*p,u.push(s),u.push(a);return u},z1083.RemoveDiagonalsAround=function(t,e){void 0===e&&(e=null);for(var o=t.connections,i=0;i<o.length;i++)for(var n=o[i],s=n.connections,a=n.weights,r=0;r<s.length;r++){var c=s[r],d=a[r];-1!=o.indexOf(c)&&1<d&&(c.removeConnection(n),n.removeConnection(c),e&&(t!=c&&e.push(c),t!=n&&e.push(n)))}},z1083.ReconnectNodes=function(t){for(var e=0;e<t.length;e+=2){var o=t[e],i=t[e+1],n=o.x-i.x,s=o.y-i.y,a=o.z-i.z,r=Math.sqrt(n*n+s*s+a*a);o.addConnection(i,r),i.addConnection(o,r)}},z1083.RotateNodesToBody=function(t,e){for(var o=e.position.x,i=e.position.y,n=e.position.z,s=e.rotation.elements,a=0;a<t.length;a++){var r=t[a],c=r.x-o,d=r.y-i,p=r.z-n;r.x=c*s[0]+d*s[1]+p*s[2]+o,r.y=c*s[3]+d*s[4]+p*s[5]+i,r.z=c*s[6]+d*s[7]+p*s[8]+n}},z1083.TranslateNodes=function(t,e,o,i){for(var n=0;n<t.length;n++){var s=t[n];s.x+=e,s.y+=o,s.z+=i}},z1083}(),SmartNumber=function(){function SmartNumber(t,e,o){void 0===t&&(t=0),void 0===e&&(e=1),void 0===o&&(o=!1),this._value=0,this.lerpTheLerp=!1,this.lerpLerpAmount=1,this.targetLerpAmount=1,this.lerpAmount=1,this._debug=!1,this._targetValue=0,this._debug&&this._debug,this._debug=o,this._value=t,this.targetValue=t,1!=(this.lerpAmount=e)&&this.lerpAmount}return Object.defineProperty(SmartNumber.prototype,"targetValue",{get:function(){return this._targetValue},set:function(t){this._debug&&this._debug,isNaN(t),this._targetValue=t},enumerable:!1,configurable:!0}),Object.defineProperty(SmartNumber.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),SmartNumber.prototype.reset=function(){this._debug&&this._debug,this.targetValue=0,this._value=0},SmartNumber.prototype.update=function(){this._value=this._value+(this.targetValue-this.value)*this.lerpAmount,this.lerpTheLerp&&(this.lerpAmount=this.lerpAmount+(this.targetLerpAmount-this.lerpAmount)*this.lerpLerpAmount)},SmartNumber}(),z1084=function(a){function z1084(t,e,o,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===n&&(n=!1);var s=a.call(this,t,e,o,i)||this;return s._callback=null,s._callbackScope=null,s._debug=!1,n&&(s._debug=n),s}return __extends(z1084,a),Object.defineProperty(z1084.prototype,"x",{get:function(){return this._debug&&this._debug,this._x},set:function(t){this._debug&&this._debug,this._x=t,isNaN(t),this._callback&&this._callback.call(this._callbackScope),this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(z1084.prototype,"y",{get:function(){return this._y},set:function(t){this._debug&&this._debug,isNaN(t),this._y=t,this._callback&&this._callback.call(this._callbackScope),this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(z1084.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t,this._debug&&this._debug,isNaN(t),this._callback&&this._callback.call(this._callbackScope),this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(z1084.prototype,"w",{get:function(){return this._w},set:function(t){this._w=t,this._debug&&this._debug,isNaN(t),this._callback&&this._callback.call(this._callbackScope)},enumerable:!1,configurable:!0}),z1084.prototype.set=function(t,e,o,i){return this._debug&&this._debug,this._x=t,this._y=e,this._z=o,this._w=i,isNaN(t),this._callback&&this._callback.call(this._callbackScope),this.pubsub&&this.pubsub.broadcast("",this),this._isDirty=!0,this},z1084.prototype.copyFrom=function(t,e){return void 0===e&&(e=!1),this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._debug&&this._debug,isNaN(t.x)&&t.x,this._callback&&!e&&this._callback.call(this._callbackScope),this.pubsub&&this.pubsub.broadcast("",this),this._isDirty=!0,this},z1084.prototype.registerCallback=function(t,e){this._callbackScope=e,this._callback=t},z1084.prototype.subscribe=function(t,e){this.pubsub||(this.pubsub=new Pubsub),this.pubsub.subscribe("",t,e)},z1084.prototype.unsubscribe=function(t,e){this.pubsub.unsubscribe("",t,e)},z1084}(BABYLON.Quaternion),z1085=function(s){function z1085(t,e,o,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=0),void 0===i&&(i=!1);var n=s.call(this,t,e,o)||this;return n.prevX=0,n.prevY=0,n.prevZ=0,n.frameNum=0,n._callback=null,n._callbackScope=null,n._debug=!1,i&&(n._debug=i),n}return __extends(z1085,s),Object.defineProperty(z1085.prototype,"x",{get:function(){return this._x},set:function(t){this._debug&&t!=this._x&&this._debug,this._x=t,isNaN(t),this._callback&&this._callback.call(this._callbackScope)},enumerable:!1,configurable:!0}),Object.defineProperty(z1085.prototype,"y",{get:function(){return this._y},set:function(t){this._debug&&(this._y,this._debug),isNaN(t),this._y=t,this._callback&&this._callback.call(this._callbackScope)},enumerable:!1,configurable:!0}),Object.defineProperty(z1085.prototype,"z",{get:function(){return this._z},set:function(t){this._debug&&t!=this._z&&this._debug,this._z=t,isNaN(t),this._callback&&this._callback.call(this._callbackScope)},enumerable:!1,configurable:!0}),z1085.prototype.set=function(t,e,o){return this._debug&&(z1.roundToDecimalPlace(t,1)==z1.roundToDecimalPlace(this._x,1)&&z1.roundToDecimalPlace(e,1)==z1.roundToDecimalPlace(this._y,1)&&z1.roundToDecimalPlace(o,1)==z1.roundToDecimalPlace(this._z,1)||this._debug),this._x=t,this._y=e,this._z=o,this._callback&&this._callback.call(this._callbackScope),this.pubsub&&this.pubsub.broadcast("",this),this},z1085.prototype.copyFrom=function(t,e){return void 0===e&&(e=!1),this._debug&&(Math.round(t.x)==Math.round(this._x)&&Math.round(t.y)==Math.round(this._y)&&Math.round(t.z)==Math.round(this._z)||this._debug),this._x=t.x,this._y=t.y,this._z=t.z,isNaN(t.x)&&t.x,this._callback&&!e&&this._callback.call(this._callbackScope),this.pubsub&&this.pubsub.broadcast("",this),this},z1085.prototype.registerCallback=function(t,e){this._callbackScope=e,this._callback=t},z1085.prototype.subscribe=function(t,e){this.pubsub||(this.pubsub=new Pubsub),this.pubsub.subscribe("",t,e)},z1085.prototype.unsubscribe=function(t,e){this.pubsub.unsubscribe("",t,e)},z1085.prototype.updatePrev=function(){this.prevX=this._x,this.prevY=this._y,this.prevZ=this._z},z1085}(BABYLON.Vector3);!function(t){var e,o;e=t.HSM||(t.HSM={}),o=function(t){function z813(){return null!==t&&t.apply(this,arguments)||this}return __extends(z813,t),z813.prototype.test=function(t){return.98<Math.random()},z813}(e.z770),e.z813=o}(z2||(z2={})),function(t){var e,o;e=t.HSM||(t.HSM={}),o=function(e){function z769(){var t=null!==e&&e.apply(this,arguments)||this;return t.maxPasses=1,t.count=0,t}return __extends(z769,e),z769.prototype.test=function(t){return this.count<this.maxPasses&&(this.count++,!0)},z769}(e.z770),e.z769=o}(z2||(z2={})),function(t){!function(t){var e=function z1089Info(t,e,o,i){void 0===e&&(e=0),void 0===i&&(i=!1),this.level=0,this.returnToPreviousState=!1,this.state=t,this.level=e,this.actions=o,this.returnToPreviousState=i};t.z1089Info=e;var o=function(){function z1086(){}return z1086.prototype.makeDecision=function(t,e){if(this.nodes){for(var o=this.nodes,i=0;i<o.length;i++){var n=o[i].makeDecision(t,e);if(n)return n}return null}return this.transitionInfo?this.transitionInfo:this.test(t,e)?this.trueNode?this.trueNode.makeDecision(t,e):null:this.falseNode?this.falseNode.makeDecision(t,e):null},z1086.prototype.test=function(t,e){return this.condition.test(t,e)},z1086}();t.z1086=o}(t.HSM||(t.HSM={}))}(z2||(z2={})),function(t){var e,o;e=t.HSM||(t.HSM={}),o=function(){function z1089(t,e,o,i,n,s){if(void 0===i&&(i=null),void 0===n&&(n=0),void 0===s&&(s=null),this.name="",this.level=0,this.returnToPreviousState=!1,this.name=t,this.targetState=e,this.condition=o,this.level=n,this.owner=s,i){this.actions=new z1072;for(var a=0;a<i.length;a++)this.actions.push(i[a])}}return z1089.prototype.appendz156=function(t){this.actions&&t.append(this.actions)},z1089.prototype.getLevel=function(){return this.level},z1089.prototype.getTargetState=function(){return this.targetState},z1089.prototype.isTriggered=function(t){return this.condition.test(this.owner,t)},z1089}(),e.z1089=o}(z2||(z2={})),function(t){var e,o;e=t.HSM||(t.HSM={}),o=function(a){function z1087(t,e,o,i,n){void 0===o&&(o=null),void 0===i&&(i=0),void 0===n&&(n=null);var s=a.call(this,t,null,null,o,i,n)||this;return s.decisionTreeRoot=e,s}return __extends(z1087,a),z1087.prototype.isTriggered=function(t){var e=this.decisionTreeRoot.makeDecision(this.owner,t);return!!e&&(this.targetState=e.state,this.level=e.level,this.actions=e.actions,this.returnToPreviousState=e.returnToPreviousState,!0)},z1087}(e.z1089),e.z1087=o}(z2||(z2={})),function(t){!function(c){var n=function UpdateResult(){this.actions=new z1072,this.level=0,this.returnToPreviousState=!1};c.UpdateResult=n;var t=function(){function HSM(t,e,o,i){void 0===e&&(e=null),void 0===o&&(o=0),void 0===i&&(i=!1),this.id=0,this.name="",this.historyLength=0,this.actions=new z1072,this.entryz156=new z1072,this.exitz156=new z1072,this.transitions=new z1072,this.owner=null,this.initted=!1,this.numFramesInState=0,this.maxFramesInState=0,this._firstUpdate=!0,this.timeEnteredState=0,this.log=!1,this.arrLog=[],this.parent=null,this.initialState=null,this.states=new Array,this._currentState=null,this.updateResult=new n,this.id=++HSM.count,this.name=t,this.initialState=this,i&&(this.log=!0,this.arrLog=[]),this.owner=e,o&&(this.historyLength=o,this.history=new z1072)}return Object.defineProperty(HSM.prototype,"firstUpdate",{set:function(t){t&&(this.name,this.owner.frameNum),this._firstUpdate=t},enumerable:!1,configurable:!0}),HSM.prototype.getTimeInState=function(){return Date.now()-this.timeEnteredState},HSM.prototype.setHistoryLength=function(t){0<t&&(this.history||(this.history=new z1072)),this.historyLength=t},HSM.prototype.appendz767=function(t){t.append(this.actions)},HSM.prototype.prependz767=function(t){t.prepend(this.actions)},HSM.prototype.reset=function(){this.currentState&&this.currentState!=this&&this.currentState.reset(),this.firstUpdate=!0,this.currentState=null},HSM.prototype.appendEntryz767=function(t){t.append(this.entryz156)},HSM.prototype.appendExitz767=function(t){t.append(this.exitz156)},HSM.prototype.getz1089s=function(){return this.transitions},Object.defineProperty(HSM.prototype,"currentState",{get:function(){return this._currentState},set:function(t){this._currentState=t},enumerable:!1,configurable:!0}),HSM.prototype.appendStates=function(t){this.parent&&t.push(this),this.currentState&&this.currentState.appendStates(t)},HSM.prototype.update=function(){var t=this.updateResult;t.actions.length=0,t.transition=null,t.returnToPreviousState=!1,this._firstUpdate&&(this.numFramesInState=0,this.timeEnteredState=Date.now(),this.currentState||(this.currentState=this.initialState),this.appendEntryz767(t.actions),this.log&&this.writeToLog("enterCurrentState: "+this.name+", "+this.owner.frameNum)),this.numFramesInState++;var e,o=this.currentState;if(!this._firstUpdate)for(var i=o.getz1089s(),n=0;n<i.length;n++){var s=i.getAtIndex(n);if(!(s.level<=0&&o==this)&&(s.level,s.isTriggered(this.currentState))){if(-1==s.level&&s.targetState==this.currentState.currentState)continue;if(0==s.level&&s.targetState==this.currentState)break;0==s.level&&s.targetState,e=s;break}}if(this.appendz767(t.actions),e)"z14"!=this.name&&"z18"!=this.name||e.targetState&&"z18"==e.targetState.name&&this.name,this.log&&this.writeToLog("triggered transitions: "+e.name+", "+this.owner.frameNum),t.transition=e,t.level=e.getLevel(),t.returnToPreviousState=e.returnToPreviousState;else if(o!=this){var a=o.update();t.transition=a.transition,t.level=a.level,t.actions.append(a.actions)}if(t.transition)if(t.returnToPreviousState)if(0==this.historyLength)this.historyLength;else{var r=this.history.shift();r?(this.exitCurrentState(t,!0),t.transition.appendz156(t.actions),t.transition=null,this.currentState=r):(this.exitCurrentState(t,!0),t.transition.appendz156(t.actions),t.transition=null,this.currentState=this.initialState),this.enterCurrentState(t)}else if(0==t.level){var c=t.transition.getTargetState();this.exitCurrentState(t),t.transition.appendz156(t.actions),t.transition=null,this.currentState=c;a=this.currentState.update();t.actions.append(a.actions)}else if(0<t.level)this.currentState.appendExitz767(t.actions),t.level-=1;else{this.currentState.appendz767(t.actions);c=t.transition.getTargetState();this.currentState.exitCurrentState(t),t.transition.appendz156(t.actions),t.transition=null,this.currentState.currentState=c,this.currentState.enterCurrentState(t),this.currentState.currentState.appendz767(t.actions)}return this._firstUpdate=!1,t},HSM.prototype.addChild=function(t){(t.parent=this).states.push(t)},HSM.prototype.changeState=function(t){if(this.currentState&&this.currentState.name==t)return!1;if(!this.states)return!1;for(var e,o=0;o<this.states.length;o++)if(this.states[o].name==t){e=this.states[o];break}if(e){if(!this.currentState||this._firstUpdate)return this.currentState=e,!0;var i,n="forceStateChange",s=this.currentState.transitions;for(o=0;o<s.length;o++)if(s.getAtIndex(o).name==n){i=s.getAtIndex(o);break}if(!i){var a=new c.z769;i=new c.z1089(n,e,a),s.push(i)}var r=i.condition;return r.count=0,r.maxPasses=1,i.targetState=e,!0}if(this.currentState&&this.currentState!=this)this.currentState.changeState(t);else if(this.states&&1==this.states.length)return this.states[0].changeState(t);return!1},HSM.prototype.exitCurrentState=function(t,e){void 0===e&&(e=!1),this.currentState&&(this.log&&this.writeToLog("exitCurrentState: "+this.currentState.name+", "+this.owner.frameNum),this.currentState.currentState&&this.currentState!=this.currentState.currentState&&this.currentState.exitCurrentState(t),!e&&0<this.historyLength&&this.currentState!=this.history.getAtIndex(0)&&this.history.unshift(this.currentState,this.historyLength),this.currentState.appendExitz767(t.actions),this.currentState.reset())},HSM.prototype.enterCurrentState=function(t){this.currentState,this.currentState.timeEnteredState=Date.now(),this.currentState.appendEntryz767(t.actions),this.currentState.numFramesInState=0,this.currentState.appendz767(t.actions),this.log&&this.writeToLog("enterCurrentState: "+this.currentState.name+", "+this.owner.frameNum),this.currentState.currentState&&this.currentState!=this.currentState.currentState&&this.currentState.enterCurrentState(t)},HSM.prototype.writeToLog=function(t){this.arrLog.push(t)},HSM.count=0,HSM}();c.HSM=t}(t.HSM||(t.HSM={}))}(z2||(z2={})),function(t){var e,o;e=t.HSM||(t.HSM={}),o=function(c){function z1088(t,e,o,i,n,s,a){void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=0);var r=c.call(this,t,e,i,n,s,a)||this;return r.triggered=!1,r.frameNum=0,r.debug=!1,"TransListenerz120Toz37"==r.name&&(r.debug=!0),r.owner.pubsub.subscribe(o,function(){r.listener(o)},r),r}return __extends(z1088,c),z1088.prototype.listener=function(t){this.debug&&this.debug,this.triggered=!0,this.frameNum=this.owner.frameNum},z1088.prototype.isTriggered=function(t){return this.debug&&this.debug,this.triggered&&this.owner.frameNum>this.frameNum+1&&(this.frameNum,this.triggered=!1),!!this.triggered&&(this.owner.mesh&&this.owner,this.triggered=!1,!this.condition||this.condition.test(this.owner,t))},z1088}(e.z1089),e.z1088=o}(z2||(z2={})),BABYLON.Bone.prototype._getNegativeRotationToRef=function(t,e){var o=BABYLON.Bone._tmpMats[2];if(t.copyFrom(this.getAbsoluteTransform()),e){t.multiplyToRef(e.getWorldMatrix(),t);var i=BABYLON.Bone._tmpVecs[2];if(i.x=e.scaling.x,i.y=e.scaling.y,i.z=e.scaling.z,e.parent){BABYLON.Bone._tmpMats[5];for(var n=e.parent;n&&n.scaling;)i.x*=n.scaling.x,i.y*=n.scaling.y,i.z*=n.scaling.z,n=n.parent}BABYLON.Matrix.ScalingToRef(i.x,i.y,i.z,o)}return t.invert(),!isNaN(t.m[0])&&(o.m[0]*=this._scalingDeterminant,t.multiplyToRef(o,t),!0)},BABYLON.Bone._tmpVecs=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],BABYLON.Bone._tmpMats=[BABYLON.Matrix.Identity(),BABYLON.Matrix.Identity(),BABYLON.Matrix.Identity(),BABYLON.Matrix.Identity(),BABYLON.Matrix.Identity(),BABYLON.Matrix.Identity()];var BoneIKController=BABYLON.BoneIKController;BoneIKController.prototype.refreshBoneLengths=function(){var t=this.mesh;if(this._bone1.length){var e=BoneIKController._tmpVecs[2];if(e.x=t.scaling.x,e.y=t.scaling.y,e.z=t.scaling.z,t.parent)for(var o=t.parent;o&&o.scaling;)e.x*=o.scaling.x,e.y*=o.scaling.y,e.z*=o.scaling.z,o=o.parent;var i=this._bone1.getScale(),n=this._bone2.getScale();this._bone1Length=this._bone1.length*i.y*e.y,this._bone2Length=this._bone2.length*n.y*e.y}else if(this._bone1.children[0]){t.computeWorldMatrix(!0);var s=this._bone2.children[0].getAbsolutePosition(t),a=this._bone2.getAbsolutePosition(t),r=this._bone1.getAbsolutePosition(t);this._bone1Length=BABYLON.Vector3.Distance(s,a),this._bone2Length=BABYLON.Vector3.Distance(a,r)}},BoneIKController.prototype.update=function(){var t=this._bone1;if(t){this.mesh.parent&&this.mesh.parent.id!=this._meshParentID&&(this.refreshBoneLengths(),this._setMaxAngle(this.maxAngle),this._meshParentID=this.mesh.parent.id);var e=this.targetPosition,o=this.poleTargetPosition,i=BoneIKController._tmpMats[0],n=BoneIKController._tmpMats[1];this.targetMesh&&e.copyFrom(this.targetMesh.getAbsolutePosition()),this.poleTargetBone?this.poleTargetBone.getAbsolutePositionFromLocalToRef(this.poleTargetLocalOffset,this.mesh,o):this.poleTargetMesh&&BABYLON.Vector3.TransformCoordinatesToRef(this.poleTargetLocalOffset,this.poleTargetMesh.getWorldMatrix(),o);var s=BoneIKController._tmpVecs[0],a=BoneIKController._tmpVecs[1],r=BoneIKController._tmpVecs[2],c=BoneIKController._tmpVecs[3],d=BoneIKController._tmpVecs[4],p=BoneIKController._tmpQuat;t.getAbsolutePositionToRef(this.mesh,s),o.subtractToRef(s,d),0==d.x&&0==d.y&&0==d.z?d.y=1:d.normalize(),e.subtractToRef(s,c),c.normalize(),BABYLON.Vector3.CrossToRef(c,d,a),a.normalize(),BABYLON.Vector3.CrossToRef(c,a,r),r.normalize(),BABYLON.Matrix.FromXYZAxesToRef(r,c,a,i);var l=this._bone1Length,u=this._bone2Length,y=BABYLON.Vector3.Distance(s,e);0<this._maxReach&&(y=Math.min(this._maxReach,y));var g=(u*u+y*y-l*l)/(2*u*y),m=(y*y+l*l-u*u)/(2*y*l);1<g&&(g=1),1<m&&(m=1),g<-1&&(g=-1),m<-1&&(m=-1);var f=Math.acos(g),A=Math.acos(m),b=-f-A;if(this._rightHandedSystem)BABYLON.Matrix.RotationYawPitchRollToRef(0,0,this._adjustRoll,n),n.multiplyToRef(i,i),BABYLON.Matrix.RotationAxisToRef(this._bendAxis,A,n),n.multiplyToRef(i,i);else{var v=BoneIKController._tmpVecs[5];v.copyFrom(this._bendAxis),v.x*=-1,BABYLON.Matrix.RotationAxisToRef(v,-A,n),n.multiplyToRef(i,i)}this.poleAngle&&(BABYLON.Matrix.RotationAxisToRef(c,this.poleAngle,n),i.multiplyToRef(n,i)),this._bone1&&(this.slerpAmount<1?(this._slerping||BABYLON.Quaternion.FromRotationMatrixToRef(this._bone1Mat,this._bone1Quat),BABYLON.Quaternion.FromRotationMatrixToRef(i,p),BABYLON.Quaternion.SlerpToRef(this._bone1Quat,p,this.slerpAmount,this._bone1Quat),b=this._bone2Ang*(1-this.slerpAmount)+b*this.slerpAmount,this._bone1.setRotationQuaternion(this._bone1Quat,BABYLON.Space.WORLD,this.mesh),this._slerping=!0):(this._bone1.setRotationMatrix(i,BABYLON.Space.WORLD,this.mesh),this._bone1Mat.copyFrom(i),this._slerping=!1)),this._bone2.setAxisAngle(this._bendAxis,b,BABYLON.Space.LOCAL),this._bone2Ang=b}},BABYLON.BoneIKController._tmpVecs=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],BABYLON.BoneIKController._tmpQuat=BABYLON.Quaternion.Identity(),BABYLON.BoneIKController._tmpMats=[BABYLON.Matrix.Identity(),BABYLON.Matrix.Identity()],BABYLON.Skeleton.prototype.clone=function(t,e){var o=new BABYLON.Skeleton(t,e||t,this._scene);o.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var i=0;i<this.bones.length;i++){var n=this.bones[i],s=null,a=n.getParent();if(a){var r=this.bones.indexOf(a);s=o.bones[r]}var c=new BABYLON.Bone(n.name,o,s,n.getBaseMatrix().clone(),n.getRestPose().clone());c.length=n.length,BABYLON.Tools.DeepCopy(n.animations,c.animations)}if(this._ranges)for(var d in o._ranges={},this._ranges){var p=this._ranges[d];p&&(o._ranges[d]=p.clone())}return this._isDirty=!0,o},function(e){e.App.Subscribe(e.AppEvents.AFTER_INIT,function(){var t=z641.getz767(e.z156.z302);e.app.datguiAdd(t,"offsetXMoveBody",-.3,.3),e.app.datguiAdd(t,"offsetYMoveBody",-.3,.3);t=z641.getz767(e.z156.z633);e.app.datguiAdd(t,"fixStuckSwingForce",-.1,.1)})}(z0||(z0={})),function(e){var t=function(){function Entity(){this.isDraggable=!1,this.frameNum=0,this.pubsub=null,this.position=BABYLON.Vector3.Zero(),this.saveToDB=!0,this.id=""+e.app.generateID()}return Entity.prototype.init=function(t){},Entity.prototype.translate=function(t,e,o){this.setPosition(this.position.x+t,this.position.y+e,this.position.z+o)},Entity.prototype.setPosition=function(t,e,o){},Entity.prototype.setRotation=function(t,e,o){},Entity.prototype.rotateWithQuaternion=function(t){},Entity.prototype.setScale=function(t,e,o){},Entity.prototype.getName=function(){return this.constructor.name},Entity.prototype.getObjectCount=function(){return e[this.constructor.name].objectCount},Entity.prototype.addItemCount=function(t){e[this.constructor.name].objectCount+=t},Entity.prototype.recycle=function(){},Entity.prototype.getProps=function(){var t={};return t.x=z1.roundToDecimalPlace(this.position.x,2),t.y=z1.roundToDecimalPlace(this.position.y,2),t},Entity.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],Entity.tempBabQuats=[BABYLON.Quaternion.Zero(),BABYLON.Quaternion.Zero(),BABYLON.Quaternion.Zero(),BABYLON.Quaternion.Zero(),BABYLON.Quaternion.Zero()],Entity.tempMat=BABYLON.Matrix.Identity(),Entity.objectCount=-1,Entity}();e.Entity=t}(z0||(z0={})),function(t){var e;(e=t.PlacementType||(t.PlacementType={}))[e.NONE=2]="NONE",e[e.BUTTON=4]="BUTTON",e[e.GRID=16]="GRID",e[e.z1048=32]="z1048",e[e.FRONT=64]="FRONT",e[e.BACK=128]="BACK",e[e.MID=256]="MID",e[e.ALIGN_BOTTOM=512]="ALIGN_BOTTOM",e[e.ALIGN_BACK=1024]="ALIGN_BACK",e[e.FRONT_GLASS=2048]="FRONT_GLASS"}(z0||(z0={})),function(A){var e,t;(t=e=A.z1044||(A.z1044={}))[t.z1047=2]="z1047",t[t.z1048=4]="z1048",t[t.z1046=8]="z1046",t[t.z1049=16]="z1049",t[t.z1050=32]="z1050",t[t.z1051=64]="z1051",t[t.z1052=128]="z1052",t[t.CONNECTOR_z1048=256]="CONNECTOR_z1048",t[t.z1054=512]="z1054",t[t.z1045=1024]="z1045",t[t.z1055=2048]="z1055",t[t.z1056=4096]="z1056",t[t.z1057=8192]="z1057",t[t.z1058=16384]="z1058",t[t.z1059=32768]="z1059",t[t.SWING=65536]="SWING",t[t.z1060=131072]="z1060";var o=function(a){function z1092(){var t=null!==a&&a.apply(this,arguments)||this;return t.accType=0,t.skipConnect=!1,t.placementType=A.PlacementType.NONE,t.isOnScene=!1,t.width=0,t.height=0,t.depth=0,t.canTranslate=!0,t.canRotate=!0,t.canPaint=!0,t.canDelete=!0,t.solidParticleIndex=-1,t.color=new BABYLON.Color4(1,1,1,1),t.rotationQuaternion=BABYLON.Quaternion.Identity(),t.tileNum=0,t.textureName="",t.forceUpdate=!1,t.renderingGroupID=0,t.onChangeObservable=new BABYLON.Observable,t.intersectsWith=1,t.intersectGroup=1,t.world=void 0,t.body=void 0,t.isMenuItem=!1,t.isDragging=!1,t.dragPlaneZ=-4.5,t._dbid=0,t.droppedAtFrameNum=0,t.num=0,t._propsNeedToBeSaved=!1,t.uvDirty=!0,t.shape=void 0,t._connected=!1,t.shapeEnabled=!0,t._shapeName="",t._tempDropLoc=BABYLON.Vector3.Zero(),t}return __extends(z1092,a),Object.defineProperty(z1092.prototype,"parent",{get:function(){return this._parent},set:function(t){this.accType==e.z1058&&(t||this.accType),this._parent=t},enumerable:!1,configurable:!0}),Object.defineProperty(z1092.prototype,"dbid",{get:function(){return this._dbid},set:function(t){this._dbid=t},enumerable:!1,configurable:!0}),Object.defineProperty(z1092.prototype,"propsNeedToBeSaved",{get:function(){return this._propsNeedToBeSaved},set:function(t){this._propsNeedToBeSaved=t},enumerable:!1,configurable:!0}),z1092.prototype.init=function(t){if(this.isDragging&&(this.isDragging=!1),t.dbid&&(this.dbid=t.dbid),t.isMenuItem?this.isMenuItem=!0:t.world&&(this.world=t.world),null!=t.renderingGroupID&&null!=t.renderingGroupID&&(this.renderingGroupID=t.renderingGroupID),t.shapeName&&(this.shapeName=t.shapeName),t.c){var e=t.c.split(","),o=0;if(this._colors)for(var i in this._colors){var n=e[o];if(!n)break;A.z1073.SetColor3FromHex(n,this._colors[i]),o++}else A.z1073.SetColor3FromHex(e[0],this.color)}},z1092.prototype.setParentMesh=function(t){},z1092.prototype.addControlAnchor=function(){this.controlPositionLocal=BABYLON.Vector3.Zero(),this.controlAnchor=new BABYLON.TransformNode("controlAnchor")},z1092.prototype.setPosition=function(t,e,o,i){void 0===i&&(i=!1),t==this.position.x&&e==this.position.y&&o==this.position.z||(this.position.x=t,this.position.y=e,this.position.z=o,this.onChangeObservable.notifyObservers(this))},z1092.prototype.setRotation=function(t,e,o){t==this.rotation.x&&e==this.rotation.y&&o==this.rotation.z||(this.rotation.x=t,this.rotation.y=e,this.rotation.z=o,this.onChangeObservable.notifyObservers(this))},z1092.prototype._initColors=function(){if(this._colors)for(var t in this._colors){var e=this._colors[t];this.setColor(e.r,e.g,e.b,t)}else this.setColor(this.color.r,this.color.g,this.color.b)},z1092.prototype.getColors=function(){return this._colors},z1092.prototype.setColor=function(t,e,o,i){if(i&&this._colors){var n=this._colors[i];n.r==t&&n.g==e&&n.b==o||(n.r=t,n.g=e,n.b=o,this.onChangeObservable.notifyObservers(this),this.propsNeedToBeSaved=!0)}else this.color.r==t&&this.color.g==e&&this.color.b==o||(this.color.r=t,this.color.g=e,this.color.b=o,this.onChangeObservable.notifyObservers(this),this.propsNeedToBeSaved=!0)},z1092.prototype.setScale=function(t,e,o){var i=this.scaling;!i||i.x==t&&i.y==e&&i.z==o||(i.x=t,i.y=e,i.z=o,this.onChangeObservable.notifyObservers(this))},z1092.prototype.addToObject=function(t){},z1092.prototype.recycle=function(){this.parent&&this.parent.removeObject&&(this.parent.removeObject(this),this.parent=null);this.isDragging&&(this.isDragging=!1),this.disconnect(),this.hideBoundingBox(),this.removeFromScene(),A.app.graphicsHelper.removeFromUpdate(this),ObjectPool.recycle(this),this.removeFromActiveObjects(),this.onChangeObservable&&this.onChangeObservable.clear()},z1092.prototype.showSelected=function(){},z1092.prototype.hideSelected=function(){},z1092.prototype.showBoundingBox=function(){if(this.hitMeshes)for(var t=0;t<this.hitMeshes.length;t++)this.hitMeshes[t].showBoundingBox=!0},z1092.prototype.hideBoundingBox=function(){if(this.hitMeshes)for(var t=0;t<this.hitMeshes.length;t++)this.hitMeshes[t].showBoundingBox=!1},z1092.prototype.rotate=function(t){},z1092.prototype.rotateWithQuaternion=function(t){t.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion);var e=z1092.z4[0];this.rotationQuaternion.toEulerAnglesToRef(e),this.setRotation(e.x,e.y,e.z)},z1092.prototype.setBounds=function(t,e,o,i,n,s){this.boundsMin||(this.boundsMax=new BABYLON.Vector3(100,100,100),this.boundsMin=new BABYLON.Vector3(-100,-100,-100)),this.boundsMin.x=t,this.boundsMin.y=e,this.boundsMin.z=o,this.boundsMax.x=i,this.boundsMax.y=n,this.boundsMax.z=s},z1092.prototype.limitPosition=function(){if(this.boundsMax&&this.boundsMin&&this.hitMeshes){var t=this.boundsMin.x,e=this.boundsMax.x,o=this.boundsMin.z,i=this.boundsMax.z,n=this,s=A.Entity.z4,a=s[0],r=s[1],c=n.hitMeshes[0];c.computeWorldMatrix(!0);var d=c.getBoundingInfo().boundingBox;a.x=d.maximumWorld.x-d.centerWorld.x,a.y=d.maximumWorld.y-d.centerWorld.y,a.z=d.maximumWorld.z-d.centerWorld.z,r.x=d.minimumWorld.x-d.centerWorld.x,r.y=d.minimumWorld.y-d.centerWorld.y,r.z=d.minimumWorld.z-d.centerWorld.z;var p=e-a.x,l=t-r.x,u=i-a.z,y=o-r.z,g=!1,m=s[0];m.x=n.position.x,m.y=n.position.y,m.z=n.position.z,n.position.x<l?(m.x=l,g=!0):n.position.x>p&&(m.x=p,g=!0),n.position.z<y?(m.z=y,g=!0):n.position.z>u&&(m.z=u,g=!0),g&&(n.setPosition(m.x,m.y,m.z),n.disconnect(),n.updateNodes())}},z1092.prototype.checkConnections=function(){},z1092.prototype.disconnect=function(){},z1092.prototype.updateNodes=function(){},z1092.prototype.onAfterConnect=function(t){},z1092.prototype.onAfterDisconnect=function(t){},z1092.prototype.addToScene=function(){if(!this.isOnScene){if(this.isOnScene=!0,this.isMenuItem||this.addItemCount(-1),this.hitMeshes)for(var t=0;t<this.hitMeshes.length;t++);this.notifyOnChangeObservers()}},z1092.prototype.removeFromScene=function(){if(this.isOnScene){if(this.isMenuItem||this.addItemCount(1),this.hitMeshes)for(var t=0;t<this.hitMeshes.length;t++);this.isOnScene=!1,this.notifyOnChangeObservers()}},z1092.prototype.removeFromActiveObjects=function(){},z1092.prototype.notifyOnChangeObservers=function(){this.onChangeObservable.notifyObservers(this)},z1092.prototype.addOnChangeObserver=function(t,e){this.onChangeObservable.removeCallback(t,this),this.onChangeObservable.add(t,-1,!1,e)},z1092.prototype.faceCamera=function(t){},z1092.prototype.intersectsAccesory=function(t,e){if(void 0===e&&(e=!1),!this.hitMeshes)return!1;for(var o,i,n=0;n<this.hitMeshes.length;n++)if(o=this.hitMeshes[n],t!=this&&t.hitMeshes&&(e||this.intersectsWith&t.intersectGroup))for(var s=0;s<t.hitMeshes.length;s++){i=t.hitMeshes[s];o.position.x,o.position.y,i.position.x,i.position.y;if(o.intersectsMesh(i))return!0}return!1},z1092.prototype.intersectsAccesories=function(t,e){if(!this.hitMeshes)return!1;for(var o,i,n,s=0;s<this.hitMeshes.length;s++){o=this.hitMeshes[s];for(var a=0;a<t.length;a++)if((e&(n=t[a]).accType||null==e)&&n!=this&&n.hitMeshes&&this.intersectsWith&n.intersectGroup)for(var r=0;r<n.hitMeshes.length;r++){i=n.hitMeshes[r];o.position.x,o.position.y,i.position.x,i.position.y;if(o.intersectsMesh(i))return!0}}return!1},z1092.prototype.getAllIntersects=function(t,e,o){if(!this.hitMeshes)return!1;for(var i,n,s,a=!1,r=0;r<this.hitMeshes.length;r++){i=this.hitMeshes[r];for(var c=0;c<e.length;c++)if((o&(s=e[c]).accType||null==o)&&s!=this&&s.hitMeshes&&this.intersectsWith&s.intersectGroup)for(var d=0;d<s.hitMeshes.length;d++)n=s.hitMeshes[d],i.intersectsMesh(n)&&(t.push(s),a=!0)}return a},z1092.prototype.setPositionDrag=function(t,e,o,i){void 0===i&&(i=!1),i?(this.isDragging=!1,this.droppedAtFrameNum=A.app.frameNum):(this.isDragging=!0,this.parent&&this.parent.removeObject&&A.app.getDragged()==this&&this.parent.removeObject(this)),this.position.x=t,this.position.y=e,this.position.z=o,this._connected&&(this.disconnect(),this._connected=!1),this.setHitMesh(t,e,o),this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position),this.onChangeObservable.notifyObservers(this)},z1092.prototype.setBodyRotationQuaternion=function(t){var e=t.w,o=t.x,i=t.y,n=t.z,s=this.body.orientation;s.s=e;var a=2*(s.x=o),r=2*(s.y=i),c=2*(s.z=n),d=o*a,p=i*r,l=n*c,u=o*r,y=i*c,g=o*c,m=e*a,f=e*r,A=e*c,b=this.body.rotation.elements,v=this.body.shapes.rotation.elements;v[0]=b[0]=1-p-l,v[1]=b[1]=u-A,v[2]=b[2]=g+f,v[3]=b[3]=u+A,v[4]=b[4]=1-d-l,v[5]=b[5]=y-m,v[6]=b[6]=g-f,v[7]=b[7]=y+m,v[8]=b[8]=1-d-p,this.body.shapes.updateProxy()},z1092.prototype.findBestRotation=function(){},z1092.FindClosestsz1092=function(t,e){var o,i=t.physics.frontBody.body.position,n=Number.MAX_VALUE,s=e.activeObjects;if(s)for(var a=0;a<s.length;a++){var r=s[a],c=i.x-r.position.x,d=i.y-r.position.y,p=i.y-r.position.z,l=c*c+d*d+p*p;l<n&&(n=l,o=r)}return o},z1092.prototype.getGraphNodeAt=function(t,e,o,i,n,s,a,r){if(void 0===i&&(i=!1),void 0===n&&(n=null),void 0===s&&(s=0),void 0===a&&(a=null),this.parent)return this.parent.getGraphNodeAt(t,e,o,i,n,s)},z1092.prototype.getGraphNodesAtToRef=function(t,e,o,i,n,s,a,r,c){void 0===n&&(n=!1),void 0===s&&(s=null),void 0===a&&(a=0),void 0===r&&(r=0),void 0===c&&(c=Number.MAX_VALUE);for(var d,p=this.nodes,l=p.length,u=z1092.tempVecs[0],y=0;y<l;y++){var g=(d=p[y]).x-e,m=d.y-o,f=d.z-i,A=g*g+m*m+f*f;if(A<c*c&&r*r<A){if(n&&0==d.type)continue;if(s)if(u.x=g,u.y=m,u.z=f,u.normalize(u),u.dot(s)<a)continue;t.push(d)}}},z1092.prototype.isInBox=function(t,e,o,i){return void 0===i&&(i=0),!1},z1092.prototype.copyLook=function(t){if(this._colors)for(var e in t._colors){var o=t._colors[e];this.setColor(o.r,o.g,o.b,e)}else this.setColor(t.color.r,t.color.g,t.color.b)},Object.defineProperty(z1092.prototype,"shapeName",{get:function(){return this._shapeName},set:function(t){""!=this._shapeName&&this._shapeName,this._shapeName=t},enumerable:!1,configurable:!0}),z1092.prototype.getName=function(){return this._shapeName},z1092.prototype.getCenterAtPosToRef=function(t,e,o,i){i.x=t,i.y=e,i.z=o},z1092.prototype.getCenter=function(){return 0<this.hitMeshes.length?this.hitMeshes[0].position:this.position},z1092.prototype.updateCage=function(){},z1092.prototype.setHitMesh=function(t,e,o){if(this.hitMeshes&&this.hitMeshes[0]){var i=this.hitMeshes[0];i.position.x=t,i.position.y=e,i.position.z=o,i.computeWorldMatrix()}},z1092.prototype.isValidDropLocation=function(t,e,o,i){if(this.hitMeshes&&this.hitMeshes[0]){var n=this._tempDropLoc;this.getPositionOnMapFromDropToRef(t,e,o,n);var s=this.hitMeshes[0],a=s.position.x,r=s.position.y,c=s.position.z;this.setHitMesh(n.x,n.y,n.z);var d=this.intersectsAccesories(A.app.objsOnScene);return s.position.x=a,s.position.y=r,s.position.z=c,s.computeWorldMatrix(),!d}},z1092.prototype.setPositionOnMapFromDrop=function(t,e,o){var i=this._tempDropLoc;this.getPositionOnMapFromDropToRef(t,e,o,i),this.setPositionDrag(i.x,i.y,i.z,!0),this.setPosition(i.x,i.y,i.z),this.updateCage()},z1092.prototype.getPositionOnMapFromDropToRef=function(t,e,o,i){var n=this.mapPlacementInfo;if(t=1*z1.round((t+n.mapOffsetDropTargetX)/1,n.mapPlacementSizeX)+n.mapOffsetX,e=1*z1.round((e+n.mapOffsetDropTargetY)/1,n.mapPlacementSizeY)+n.mapOffsetY,this.placementType&A.PlacementType.ALIGN_BACK&&(o-=.5*this.depth),this.placementType&A.PlacementType.z1048){var s=this.hitMeshes[0].getBoundingInfo(),a=s.boundingBox.maximum.x,r=s.boundingBox.maximum.y,c=z1092.z4[2];this.getCenterAtPosToRef(t,e,o,c);var d=A.Cage.getCageAt(c.x,c.y,c.z);if(d){var p=d.position,l=p.x-.5*d.width,u=p.x+.5*d.width,y=p.y+d.height,g=d.floorY,m=t+a,f=e-r;t-a<l?t=l+a:u<m&&(t=u-a),y<e+r?e=y-r:f<g&&(e=g+r)}}i.x=t,i.y=e,i.z=o},z1092.prototype.getOptions=function(){return null},z1092.prototype.getProps=function(){var t=a.prototype.getProps.call(this);if(this.rotation&&(t.rz=z1.roundToDecimalPlace(this.rotation.z,2)),this._colors){var e=z1092.tempArray;for(var o in e.length=0,this._colors){var i=this._colors[o].toHexString();e.push(i)}for(var n=e.length,s=e.length-1;0<=s&&null==e[s];s--)n--;e.length=n,t.c=e.join()}else t.c=A.z1073.GetHexFromColor3(this.color);return this.propsNeedToBeSaved=!1,t},z1092.prototype.onPointerDown=function(t,e){},z1092.prototype.onPointerUp=function(t){},z1092.prototype.onPointerMove=function(t){},z1092.GetObjConnectedToNodeAt=function(t,e,o,i){for(var n=t.connections,s=n.length,a=0;a<s;a++){var r=n[a];if(r.data.obj){if(r.data.obj.isInBox&&r.data.obj.isInBox(e,o,i))return r.data.obj}else r.data.obj}},z1092.tempVecs=[new OIMO.Vec3],z1092.tempArray=[],z1092.activeObjects=[],z1092}(A.Entity);A.z1092=o}(z0||(z0={})),function(e){var t=function(){function z1090(){}return z1090.prototype.getSceneFileNames=function(t){t.push("accessories"),t.push("accessories2")},z1090.prototype.getCreateMeshFunctions=function(t){t.Panel=this._createMeshes},z1090.prototype.getCreateMaterialFunctions=function(t){t.accMat=this._createMeshes,t.discard_alpha2=this._createMeshes},z1090.prototype._createMeshes=function(t,e,o,i,n){var s=BABYLON.Mesh.CreatePlane("panel",1,t);e.Panel=s,t.removeMesh(s);var a=new BABYLON.StandardMaterial("accMat",t);a.specularColor.r=.1,a.specularColor.g=.1,a.specularColor.b=.1,a.diffuseTexture=n.accTileSet.getTexture(),o.accMat=a;var r=new BABYLON.CustomMaterial("chewMat",t);r.AddAttribute("tileOffset"),r.Vertex_Definitions("\n                attribute vec4 tileOffset;\n                varying vec4 vTileOffset;\n            "),r.Vertex_MainEnd("\n                vTileOffset = tileOffset;\n            "),r.Fragment_Definitions("\n                varying vec4 vTileOffset;\n            "),r.Fragment_Custom_Diffuse("\n                float fx = 1. - clamp(fract(vDiffuseUV.x), 0., 1.); \n                float fy = clamp(fract(vDiffuseUV.y), 0., 1.);\n                vec2 uvCoord = vec2(vTileOffset.x + fx * (vTileOffset.z-vTileOffset.x), vTileOffset.y + fy * (vTileOffset.w-vTileOffset.y));\n                baseColor = texture2D(diffuseSampler, uvCoord);\n                if(baseColor.x < .9 && baseColor.y < .9 && baseColor.z < .9){\n                    discard;\n                }\n                baseColor *= vColor;\n            "),r.diffuseColor=new BABYLON.Color3(1,1,1),r.backFaceCulling=!1,r.diffuseTexture=n.accTileSet2.getTexture(),o.discard_alpha2=r},z1090.prototype.getTileSetData=function(t){t.push({tileSetName:"accTileSet",numRows:2,numCols:2,width:1024,height:1024,tileDrawNames:["bridgeRainbowTexture","simpleWheelTexture","chewTile1"]}),t.push({tileSetName:"accTileSet2",numRows:4,numCols:4,width:1024,height:1024,tileDrawNames:["waterBottleLabel1","waterBottleLabel2","bowl1hearts","bowl2hearts"]}),t.push({tileSetName:"alphaTileSet",numRows:4,numCols:4,width:1024,height:1024,tileDrawNames:["tubeCrossTexture","tubeCurved2Texture","tubeCurvedTexture","tubeStraightTexture","tubeTeeTexture","wheel3Tile","backgroundTexture","waterTile","white50PercentAlphaTile"]})},z1090.prototype.getTextureDrawFunctions=function(t){var e=function(t,e,o){t.beginPath(),t.rect(0,0,e,o),t.fillStyle="rgba(255, 255, 255, .3)",t.fill()};t.backgroundTexture=e;e=function(t,e,o){t.beginPath(),t.rect(0,0,e,o),t.fillStyle="rgba(255, 255, 255, .5)",t.fill()};t.white50PercentAlphaTile=e},z1090.prototype.getSPSData=function(t){t.push({shapeName:"z1092MenuBGTubes",meshName:"Panel",numInstances:1,maxInstances:1,applyMaterialToSPS:"tubeMat",computeTextures:!0,renderingGroupID:e.App.menuRenderingGroupID})},z1090}();e.z1090=t,e.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(){function z1091(){this.accessory=null,this.triggerArea=null,this.triggerAreaMesh=void 0,this.pubsub=new Pubsub,this.world=null}return Object.defineProperty(z1091.prototype,"position",{get:function(){return this.triggerArea.position},enumerable:!1,configurable:!0}),z1091.prototype.init=function(t){},z1091.prototype.onTrigger=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},z1091.prototype.setPosition=function(t,e,o){},z1091.prototype.enable=function(){},z1091.prototype.disable=function(){},z1091.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],z1091.tempVecs=[new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3],z1091}();t.z1091=e}(z0||(z0={})),function(f){var t=function(m){function Bowl(){var t=m.call(this)||this;return t.accType=f.z1044.z1045,t._cage=null,t.num=0,t._numHamsAccess=0,t.curveRadius=0,t.thickness=.04,t.height=0,t.halfHeight=0,t.radius=0,t.shapes=[],t.foodMound=null,t.base=void 0,t.mapPlacementInfo=new f.MapPlacementInfo({mapPlacementSizeX:.25}),t._physicsEnabled=!1,t.centerGraphNode=new GraphNode(0,0,0),t.nodes=[],t.angBtwNodes=.25*Math.PI,t.bumper2=void 0,t.zpos=-1.17,t.maxz1062s=1,t._foodHeight=0,t.targetPosition=BABYLON.Vector3.Zero(),t.isDragging=!1,t.hamsters=new z1072,t._timeOutID=0,t._bindedSaveSettings=void 0,t._frameNumUpdateNumHamsAccess=-1,t._lastNumActiveHams=0,t.placementType=f.PlacementType.GRID|f.PlacementType.FRONT|f.PlacementType.ALIGN_BOTTOM|f.PlacementType.z1048,Bowl.count++,t.num=Bowl.count,t.boundsMax=new BABYLON.Vector3(100,100,100),t.boundsMin=new BABYLON.Vector3(-100,-100,-100),t.rotation=BABYLON.Vector3.Zero(),t.bindedKeepPosInside=t.keepPosInside.bind(t),t._colors={},t._colors.bowl=new BABYLON.Color3(1,1,1),t}return __extends(Bowl,m),Object.defineProperty(Bowl.prototype,"cage",{get:function(){return this._cage},set:function(t){this._cage=t},enumerable:!1,configurable:!0}),Object.defineProperty(Bowl.prototype,"numHamsAccess",{get:function(){return this._numHamsAccess},set:function(t){t!=this._numHamsAccess&&(this._numHamsAccess=t,this.dbid&&this._saveSettings())},enumerable:!1,configurable:!0}),Object.defineProperty(Bowl.prototype,"foodHeight",{get:function(){return this._foodHeight},set:function(t){this._foodHeight=t,this.body},enumerable:!1,configurable:!0}),Bowl.prototype.setColor=function(t,e,o,i){m.prototype.setColor.call(this,t,e,o,i),"bowl"==i?(this.shapes[0].setColor(t,e,o),this.shapes[1].setColor(t,e,o)):"label"==i&&this.shapes[2].setColor(t,e,o)},Bowl.prototype.init=function(t){m.prototype.init.call(this,t),this.controlAnchor||this.addControlAnchor();var e=this.shapeName+this.num;this.canRotate=!1,this.canTranslate=!0,this.addToActiveObjects(),t.isMenuItem&&(this.controlPositionLocal.y=.4,t.isMenuItem);var o=0;null!=t.ry&&(o=t.ry),t.radius&&(this.radius=t.radius),t.height&&(this.height=t.height,this.halfHeight=.5*this.height,this.curveRadius=this.height);var i=0,n=0;if(null!=t.x&&(i=t.x),null!=t.y&&(n=t.y),this.cage=t.cage,this.cage,this.isMenuItem||this.body)this._physicsEnabled||this.enablePhysics();else{this._physicsEnabled=!0,this.world=t.world;var s=[2,.1,.1,f.App.z1035,4294967295],a=new OIMO.Body({type:"bowl",size:[this.radius,this.height,this.curveRadius,this.thickness,this.radius],pos:[i,n,-1],rot:[0,180*o/Math.PI,0],move:!1,world:this.world,name:e+"_bowl",config:s});this.body=a.body,this.foodHeight=.9*this.height,this.navigator=new f.BowlNavigator,this.navigator.init({accessory:this}),this.foodMound||(this.foodMound=new f.FoodMound),this.body.shapes.updateProxy(),(this.body.shapes.entity=this).bumper2&&this.bumper2.shapes.updateProxy(),this.base&&this.base.body.shapes.updateProxy()}this.isMenuItem&&this.isMenuItem;var r=0;0<t.nf&&(r=t.nf);var c=0;if(0<t.nh&&(c=t.nh),this._numHamsAccess=t.nh,r&&0<c){var d=f.app._cageLastViewed;if(d){var p=(Date.now()-d)/6e4;(r-=Math.floor(3*c*p))<0&&(r=0)}}if(this.foodMound&&(this.foodMound.init({bowl:this,numFood:r,x:0,y:0,z:0,height:this.foodHeight,radius:this.radius-.12}),this.foodMound.height=this.foodHeight),this.shapes[0])this.shapes[0].init({name:this.shapeName+"_outside",renderingGroupID:this.renderingGroupID}),this.shapes[1].init({name:this.shapeName+"_inside",renderingGroupID:this.renderingGroupID}),this.shapes[2].init({name:this.shapeName+"_labeloutside",renderingGroupID:this.renderingGroupID});else{this.shapes[0]=ObjectPool.get("z1068",{name:this.shapeName+"_outside",renderingGroupID:this.renderingGroupID}),this.shapes[1]=ObjectPool.get("z1068",{name:this.shapeName+"_inside",renderingGroupID:this.renderingGroupID});var l=ObjectPool.get(this.shapeName+"_labeloutside_rg"+this.renderingGroupID,{name:this.shapeName+"_labeloutside",renderingGroupID:this.renderingGroupID});this.shapes[2]=l,this.isMenuItem&&!this.meshes&&(this.meshes=[],this.meshes.push(l.inst))}if(!this.isMenuItem&&!this.foodMoundCollider&&(this.foodMoundCollider=new f.FoodMoundCollider,this.foodMoundCollider.init({world:t.world,width:1.8*this.radius,depth:1.8*this.radius,radius:this.radius}),(this.foodMoundCollider.bowl=this).foodMound)){var u=this.foodMound.food;this.foodMound.height;var y=u[u.length-1];u[0];y&&this.foodMoundCollider.setHeightAt(y.position.y,this.position.x,this.position.z,2*this.radius)}if(this.shapes[0].textureName="white50PercentAlphaTile",this.shapes[1].textureName="white50PercentAlphaTile",this.shapes[2].textureName=t.textureName,this._initColors(),!this.hitMeshes&&!t.isMenuItem){this.hitMeshes=[];var g=f.app.graphicsHelper.getHitMesh(2*this.radius,this.height,2*this.radius);this.hitMeshes.push(g),g.rotationQuaternion=BABYLON.Quaternion.Identity()}if(this.setRotation(0,o,0),this.setPosition(i,n,-1),t.isMenuItem)t.skipAddToScene||this.addToScene();else if(!t.skipAddToScene){if(this.addToScene(),this.cage||(this.cage=f.Cage.getCageAt(i,n,-1)),!this.cage)return;this.cage.isReady?this.addToObject(this.cage):this.cage.pubsub.subscribe("ready",this.addToObject,this)}},Bowl.prototype.isPositionInBowl=function(t,e,o){var i=this.position,n=t-i.x,s=e-i.y,a=o-i.z;if(s<0)return!1;var r=n*n+a*a,c=this.radius;return r<c*c},Bowl.prototype.update=function(){if(!this.isDragging){var t=this.body;if(t){this.position.x=t.position.x,this.position.y=t.position.y-this.halfHeight,this.position.z=t.position.z,this.rotationQuaternion.x=t.orientation.x,this.rotationQuaternion.y=t.orientation.y,this.rotationQuaternion.z=t.orientation.z,this.rotationQuaternion.w=t.orientation.s,this.onChangeObservable.notifyObservers(this),this.setHitMesh(this.position.x,this.position.y,this.position.z,!1),this.hitMeshes[0].rotationQuaternion.copyFrom(this.rotationQuaternion)}}},Bowl.prototype.addToObject=function(t){this.cage!=t&&(this.parent=t,(this.cage=t)?(this.cage.addObject(this),this.cage.pubsub.unsubscribe("ready",this.addToObject,this)):this.foodMound.removeFromFoodTracker())},Bowl.prototype.setHitMesh=function(t,e,o,i){if(void 0===i&&(i=!0),this.hitMeshes&&this.hitMeshes[0]){var n=this.hitMeshes[0];n.position.x=t,n.position.y=e+this.halfHeight,n.position.z=o,i&&n.computeWorldMatrix()}},Bowl.prototype.setPosition=function(e,t,o,i){var n=this;void 0===i&&(i=!1),this.position.x=e,this.position.y=t,this.position.z=o,this.isMenuItem||this.updateCage();var s=t;if(this.cage&&s<this.cage.floorY&&(s=this.cage.floorY),this.position.x=e,this.position.y=s,this.position.z=o,this.body&&this._physicsEnabled){var a=this.body.position;a.x=e,a.y=s+this.halfHeight,a.z=o,this.body.syncShapes(),this.navigator.setPosition(a.x,a.y,a.z)}this.setHitMesh(e,t,o),this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position),this.cage,this.foodMound&&(this.foodMound.setPosition(e,s,o),this.foodMound.updateFoodTracker()),this.foodMoundCollider&&this.foodMoundCollider.setPosition(e,s+.03,o),this.shapes.forEach(function(t){t.setPosition(e,s+n.halfHeight,o)}),this.isMenuItem||(this.targetPosition.x=e,this.targetPosition.y=s+this.halfHeight,this.targetPosition.z=o),this.notifyOnChangeObservers()},Bowl.prototype.setRotation=function(t,e,o){this.rotation.x=t,this.rotation.y=e,this.rotation.z=o;var i=this.rotationQuaternion;BABYLON.Quaternion.RotationYawPitchRollToRef(e,t,o,i),this.body,this.onChangeObservable.notifyObservers(this)},Bowl.prototype.getGraphNodeAt=function(t,e,o){if(this.cage)return this.cage.getGraphNodeAt(t,e,o)},Bowl.prototype.updateCage=function(){var t=f.Cage.getCageAt(this.position.x,this.position.y+this.halfHeight,this.position.z);this.addToObject(t),this.platform=t?t.getPlatformUnder(this.position.x,this.position.y,this.position.z+.1):null},Bowl.prototype.recycle=function(){this.shapes&&this.shapes.forEach(function(t){t.isOnScene=!1,t.setPosition(9999,9999,9999)}),this.foodMoundCollider&&this.foodMoundCollider.resetHeights(),this._numHamsAccess=0,m.prototype.recycle.call(this)},Bowl.prototype.addToActiveObjects=function(){-1==Bowl.activeObjects.indexOf(this)&&Bowl.activeObjects.push(this)},Bowl.prototype.removeFromActiveObjects=function(){var t=Bowl.activeObjects.indexOf(this);-1!=t&&Bowl.activeObjects.splice(t,1)},Bowl.prototype.addToScene=function(){this.isOnScene||(m.prototype.addToScene.call(this),this.shapes.forEach(function(t){t.requestDepthSort=!0,t.addToScene()}),this.enablePhysics(),this.foodMound&&this.foodMound.addToScene())},Bowl.prototype.removeFromScene=function(){this.isOnScene&&(m.prototype.removeFromScene.call(this),this.shapes.forEach(function(t){t.removeFromScene()}),this.disablePhysics(),this.foodMound&&this.foodMound.removeFromScene())},Bowl.prototype.disablePhysics=function(){this.body&&this._physicsEnabled&&(this._physicsEnabled=!1,this.body.position.y=9999,this.body.syncShapes(),this.world.removeRigidBody(this.body),this.navigator.disable(),this.bumper2&&(this.bumper2.position.y=9999,this.bumper2.syncShapes(),this.world.removeRigidBody(this.bumper2)),this.base&&(f.app.graphicsHelper.removeFromUpdate(this.shapes[0]),this.world.removeRigidBody(this.base.body)))},Bowl.prototype.enablePhysics=function(){this.body&&!this._physicsEnabled&&(this.world.addRigidBody(this.body),this.navigator.enable(),this.bumper2&&this.world.addRigidBody(this.bumper2),this.base&&this.world.addRigidBody(this.base.body),this._physicsEnabled=!0)},Bowl.prototype.getFloorY=function(t,e,o){var i=e,n=this.cage;if(n||(n=f.Cage.getCageAt(t,e,o)),n){i=n.bedding?n.getAveYBetween(t-this.radius,t+this.radius)+.04:n.floorY;var s=n.getPlatformUnder(t,e,o);s&&s.position.y>=i&&(i=s.position.y+s.floorThickness),i<n.floorY&&(i=n.floorY)}return i},Bowl.prototype.setToFloor=function(t){var e=this.position.x,o=this.position.z,i=this.getFloorY(e,t,o);i!=this.position.y&&this.setPosition(e,i,o)},Bowl.prototype.setPositionDrag=function(e,o,i,t){var n=this;void 0===t&&(t=!1),this.isDragging||(this.shapes[0].requestDepthSort=!0,this.foodMound&&this.foodMound.removeFromFoodTracker()),t?(this.enablePhysics(),this.setPosition(e,o,i),this.setToFloor(o)):(this.disablePhysics(),this.shapes.forEach(function(t){t.setPosition(e,o+n.halfHeight,i)}),this.foodMound&&this.foodMound.setPosition(e,o,i),this.foodMoundCollider&&this.foodMoundCollider.setPosition(e,o+.03,i),m.prototype.setPositionDrag.call(this,e,o,i,t)),this.isDragging=!t},Bowl.prototype.isValidDropLocation=function(t,e,o,i){if(!m.prototype.isValidDropLocation.call(this,t,e,o))return!1;var n=this._tempDropLoc;return this.getPositionOnMapFromDropToRef(t,e,o,n),i&&i.dragPlatformY&&n.y<i.dragPlatformY&&(n.y=i.dragPlatformY),!!f.Cage.getCageAt(n.x,n.y,n.z)},Bowl.prototype.getPositionOnMapFromDropToRef=function(t,e,o,i){m.prototype.getPositionOnMapFromDropToRef.call(this,t,e,o,i),i.z=-1.2,i.y=this.getFloorY(i.x,i.y,i.z)},Bowl.prototype.setPositionOnMapFromDrop=function(t,e,o){var i=this._tempDropLoc;this.getPositionOnMapFromDropToRef(t,e,o,i),this.setPositionDrag(i.x,i.y,i.z,!0)},Bowl.prototype.addz1062=function(t){-1===this.hamsters.indexOf(t)&&this.hamsters.push(t)},Bowl.prototype.removez1062=function(t){this.hamsters.remove(t)},Bowl.prototype.keepPosInside=function(t){var e=t.x-this.position.x,o=t.y-this.position.y,i=t.z-this.position.z,n=e*e+i*i,s=this.radius-.05;if(s*s<n){var a=Math.sqrt(n),r=e/a,c=i/a;t.x=this.position.x+r*s,t.z=this.position.z+c*s}o<0&&(t.y=this.position.y+.05)},Bowl.prototype.isBodyFacing=function(t,e){void 0===e&&(e=.5);var o=Bowl.z4[0],i=Bowl.z4[1],n=t.body.position,s=this.position;o.x=s.x-n.x,o.y=0,o.z=s.z-n.z,o.normalize();var a=t.rotationElements;return a[5]<a[4]?(i.x=a[2],i.y=0,i.z=a[8]):(i.x=-a[1],i.y=0,i.z=-a[7]),i.normalize(),e<BABYLON.Vector3.Dot(o,i)},Bowl.prototype.saveFoodAmount=function(){!this._timeOutID&&this.isOnScene&&(this._bindedSaveSettings||(this._bindedSaveSettings=this._saveSettings.bind(this)),this._timeOutID=setTimeout(this._bindedSaveSettings,1e3))},Bowl.prototype._saveSettings=function(){f.app.saveDataItem(this),this._timeOutID=0},Bowl.prototype.addFood=function(t){this.foodMound.addFood(t);var e=t.position.x,o=t.position.y,i=t.position.z,n=e-this.position.x,s=o-this.position.y,a=i-this.position.z;s<0&&(o=this.position.y);var r=n*n+a*a,c=this.radius;if(c*c<r){var d=Math.sqrt(r),p=n/d,l=a/d;e=this.position.x+p*c,i=this.position.z+l*c}e==t.position.x&&o==t.position.y&&i==t.position.z||t.setPosition(e,o,i),this.saveFoodAmount()},Bowl.prototype.removeFood=function(t){this.foodMound.removeFood(t),this.saveFoodAmount()},Bowl.prototype.isInBox=function(t,e,o,i){return void 0===i&&(i=0),this.isPositionInBowl(t,e,o)},Bowl.prototype.getProps=function(){var t=m.prototype.getProps.call(this);return t.nf=this.foodMound.food.length,t.nh=this.numHamsAccess,t},Bowl.prototype.updateNumHamsAccess=function(){var t=f.z1062.activeObjects;if((this._frameNumUpdateNumHamsAccess!=f.app.frameNum||this._lastNumActiveHams!=t.length)&&!this.isDragging){this._frameNumUpdateNumHamsAccess=f.app.frameNum,this._lastNumActiveHams=t.length;for(var e=0,o=Bowl.tempArray,i=o.length=0;i<t.length;i++){var n=t[i];n.currentObject==this.cage?e++:(o.length=0,n.getPathToRef(this.position,o),0<o.length&&e++)}this.numHamsAccess=e}},Bowl.tempArray=[],Bowl.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],Bowl.count=0,Bowl.activeObjects=[],Bowl}(f.z1092);f.Bowl=t}(z0||(z0={})),function(t){var e=function(n){function Bowl1(){var t=n.call(this)||this;return t._colors.bowl=new BABYLON.Color3(.76,.71,.46),t._colors.top=new BABYLON.Color3(.64,.58,.28),t}return __extends(Bowl1,n),Bowl1.prototype.init=function(t){n.prototype.init.call(this,t),this.shapes.length},Bowl1.prototype.setColor=function(t,e,o,i){n.prototype.setColor.call(this,t,e,o,i),"top"==i&&this.shapes[2].setColor(t,e,o)},Bowl1.count=0,Bowl1}(t.Bowl);t.Bowl1=e}(z0||(z0={})),function(i){var t=function(){function Bowl1Config(){this.maxObjects=4,this.objName="b1",i.Bowl1.objectCount=this.maxObjects}return Bowl1Config.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,i.Bowl1,{shapeName:this.objName,world:t,x:0,y:0,z:0,radius:.35,height:.2,textureName:"bowl1hearts"}),ObjectPool.addClass(this.objName+"_labeloutside_rg0",z1069,{meshName:"bowl1_labeloutside_rg0",tileName:"bowl1hearts"}),ObjectPool.addClass(this.objName+"_labeloutside_rg1",z1069,{meshName:"bowl1_labeloutside_rg1",tileName:"bowl1hearts",renderingGroupID:1})},Bowl1Config.prototype.getCreateMeshFunctions=function(t){t.bowl1_labeloutside_rg0=this._createMeshes,t.bowl1_labeloutside_rg1=this._createMeshes},Bowl1Config.prototype._createMeshes=function(t,e,o){var i,n=e.bowl1_outside,s=e.bowl1_inside;n.position.x=0,n.position.y=0,n.position.z=0,s.position.x=0,s.position.y=0,s.position.z=0,(i=e.bowl1_labeloutside.clone("bowl1_labeloutside_rg0")).makeGeometryUnique(),i.material=o.discard_alpha2,i.registerInstancedBuffer("color",4),i.instancedBuffers.color=new BABYLON.Color4(1,1,1,1),i.registerInstancedBuffer("tileOffset",4),i.instancedBuffers.tileOffset=new BABYLON.Vector4(1,1,1,1),t.removeMesh(i),e.bowl1_labeloutside_rg0=i,(i=e.bowl1_labeloutside.clone("bowl1_labeloutside_rg1")).makeGeometryUnique(),i.material=o.discard_alpha2,i.registerInstancedBuffer("color",4),i.instancedBuffers.color=new BABYLON.Color4(1,1,1,1),i.registerInstancedBuffer("tileOffset",4),i.instancedBuffers.tileOffset=new BABYLON.Vector4(1,1,1,1),t.removeMesh(i),i.renderingGroupId=1,e.bowl1_labeloutside_rg1=i},Bowl1Config.prototype.getTextureDrawFunctions=function(t){t.bowl1hearts=function(t,e,o){i.CanvasDraw.DrawTopLine(t,e,.5*o,null,"rgba(255, 255, 255, 1)")}},Bowl1Config.prototype.getChildSPSData=function(t){t[this.objName]||(t[this.objName]={}),t[this.objName][this.objName+"_inside"]=1,t[this.objName][this.objName+"_outside"]=1},Bowl1Config.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"bowlButton",numInstances:this.maxObjects,maxInstances:this.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName+"_inside",meshName:"bowl1_inside",numInstances:this.maxObjects,maxInstances:this.maxObjects,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0}),t.push({shapeName:this.objName+"_outside",meshName:"bowl1_outside",numInstances:this.maxObjects,maxInstances:this.maxObjects,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0}),t.push({shapeName:this.objName,meshName:"bowlMenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:this.objName+"_inside",meshName:"bowl1_inside",numInstances:this.maxObjects,maxInstances:this.maxObjects,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:this.objName+"_outside",meshName:"bowl1_outside",numInstances:this.maxObjects,maxInstances:this.maxObjects,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0,renderingGroupID:i.App.menuRenderingGroupID})},Bowl1Config.prototype.getz1064Items=function(t){t.push(new i.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Bowls",order:0,offsetY:-.25,menuHeight:.5,menuWidth:.5}))},Bowl1Config}();i.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(n){function Bowl2(){var t=n.call(this)||this;return t._colors.bowl=new BABYLON.Color3(.76,.71,.46),t._colors.top=new BABYLON.Color3(0,1,0),t}return __extends(Bowl2,n),Bowl2.prototype.init=function(t){n.prototype.init.call(this,t),this.shapes.length},Bowl2.prototype.setColor=function(t,e,o,i){n.prototype.setColor.call(this,t,e,o,i),"top"==i&&this.shapes[2].setColor(t,e,o)},Bowl2.count=0,Bowl2}(t.Bowl);t.Bowl2=e}(z0||(z0={})),function(i){var t=function(){function Bowl2Config(){this.maxObjects=4,this.objName="b2",i.Bowl2.objectCount=this.maxObjects}return Bowl2Config.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,i.Bowl2,{shapeName:this.objName,world:t,x:0,y:0,z:0,radius:.35*.8,height:.2,bottomRadius:.4,textureName:"bowl2hearts"}),ObjectPool.addClass(this.objName+"_labeloutside_rg0",z1069,{meshName:"bowl2_labeloutside_rg0",tileName:"bowl2hearts"}),ObjectPool.addClass(this.objName+"_labeloutside_rg1",z1069,{meshName:"bowl2_labeloutside_rg1",tileName:"bowl2hearts",renderingGroupID:1})},Bowl2Config.prototype.getCreateMeshFunctions=function(t){t.bowl2_labeloutside_rg0=this._createMeshes,t.bowl2_labeloutside_rg1=this._createMeshes},Bowl2Config.prototype._createMeshes=function(t,e,o){var i;(i=e.bowl2_labeloutside.clone("bowl2_labeloutside_rg0")).makeGeometryUnique(),i.material=o.discard_alpha2,i.registerInstancedBuffer("color",4),i.instancedBuffers.color=new BABYLON.Color4(1,1,1,1),i.registerInstancedBuffer("tileOffset",4),i.instancedBuffers.tileOffset=new BABYLON.Vector4(1,1,1,1),t.removeMesh(i),e.bowl2_labeloutside_rg0=i,(i=e.bowl2_labeloutside.clone("bowl2_labeloutside_rg1")).makeGeometryUnique(),i.material=o.discard_alpha2,i.registerInstancedBuffer("color",4),i.instancedBuffers.color=new BABYLON.Color4(1,1,1,1),i.registerInstancedBuffer("tileOffset",4),i.instancedBuffers.tileOffset=new BABYLON.Vector4(1,1,1,1),t.removeMesh(i),i.renderingGroupId=1,e.bowl2_labeloutside_rg1=i},Bowl2Config.prototype.getTextureDrawFunctions=function(t){t.bowl2hearts=function(t,e,o){i.CanvasDraw.DrawTopLine(t,e,.65*o,null,"rgba(255, 255, 255, 1)")}},Bowl2Config.prototype.getChildSPSData=function(t){t[this.objName]||(t[this.objName]={}),t[this.objName][this.objName+"_inside"]=1,t[this.objName][this.objName+"_outside"]=1},Bowl2Config.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"bowlButton",numInstances:this.maxObjects,maxInstances:this.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName+"_inside",meshName:"bowl2_inside",numInstances:this.maxObjects,maxInstances:this.maxObjects,wireframe:!1,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0}),t.push({shapeName:this.objName+"_outside",meshName:"bowl2_outside",numInstances:this.maxObjects,maxInstances:this.maxObjects,wireframe:!1,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0}),t.push({shapeName:this.objName,meshName:"bowlMenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:this.objName+"_inside",meshName:"bowl2_inside",numInstances:this.maxObjects,maxInstances:this.maxObjects,wireframe:!1,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:this.objName+"_outside",meshName:"bowl2_outside",numInstances:this.maxObjects,maxInstances:this.maxObjects,wireframe:!1,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0,renderingGroupID:i.App.menuRenderingGroupID})},Bowl2Config.prototype.getz1064Items=function(t){t.push(new i.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Bowls",order:1,offsetY:-.25,menuHeight:.5,menuWidth:.5}))},Bowl2Config}();i.App.AddEntityConfig(new t)}(z0||(z0={})),function(e){var t=function(){function BowlConfig(){}return BowlConfig.prototype.getCreateMeshFunctions=function(t){t.bowlButton=this._createMeshes,t.bowlMenuButton=this._createMeshes},BowlConfig.prototype._createMeshes=function(t,e){var o=BABYLON.MeshBuilder.CreateBox("bowlButton",{height:.2,width:.7,depth:1},t);o.position.y+=.1,o.bakeCurrentTransformIntoVertices(),t.removeMesh(o),e.bowlButton=o;var i=BABYLON.MeshBuilder.CreatePlane("",{height:1,width:1},t);i.rotation.x+=.3,i.bakeCurrentTransformIntoVertices(),t.removeMesh(i),e.bowlMenuButton=i},BowlConfig.prototype.getSceneFileNames=function(t){},BowlConfig.prototype.getz49s=function(t){t.push(e.z142)},BowlConfig.prototype.getListenerSetups=function(t){t.push({event:e.BowlEvents.USE,state:e.z142})},BowlConfig}();e.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(){function BowlEvents(){}return BowlEvents.USE=t.AppEvents.GetUniqueID(),BowlEvents}();t.BowlEvents=e}(z0||(z0={})),function(yt){var t=function(e){function BowlNavigator(){var t=null!==e&&e.apply(this,arguments)||this;return t.z1045_Pivot_Radius=.5,t.z1045_Pivot_Area=.5*Math.PI,t._enabled=!0,t.updated=new z1072Set,t}return __extends(BowlNavigator,e),BowlNavigator.prototype.init=function(t){this.accessory=t.accessory;var e=this.accessory,o=e.shapeName+e.num;if(!this.triggerArea){this.world=e.world;var i=[.03,.01,1,yt.App.PhysicsGroupTriggerArea,yt.App.z1034],n=e.radius+.15;this.triggerArea=new OIMO.Body({type:"sphere",size:[n,n,n],pos:[0,0,0],rot:[0,0,0],move:!1,world:this.world,name:o+"_bowlBumper1",config:i}).body,this.triggerArea.shapes.pubsub=this.pubsub,this.triggerArea.shapes.disablePhysics=!0,this.pubsub.subscribe("hit",this.onTrigger.bind(this))}},BowlNavigator.prototype.setPosition=function(t,e,o){this.triggerArea.position.x=t,this.triggerArea.position.y=e,this.triggerArea.position.z=o,this.triggerArea.syncShapes(),this.triggerAreaMesh&&(this.triggerAreaMesh.position.x=this.triggerArea.position.x,this.triggerAreaMesh.position.y=this.triggerArea.position.y,this.triggerAreaMesh.position.z=this.triggerArea.position.z,this.triggerAreaMesh.isPickable=!1)},BowlNavigator.prototype.enable=function(){this._enabled||(this.world.addRigidBody(this.triggerArea),this._enabled=!0)},BowlNavigator.prototype.disable=function(){this._enabled&&(this.triggerArea.position.y=9999,this.triggerArea.syncShapes(),this.world.removeRigidBody(this.triggerArea),this._enabled=!1)},BowlNavigator.prototype.onTrigger=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=this.accessory,i=t[8].actor.rodent;if(!i.isDragging&&this.updated.push(i,i.id,yt.app.frameNum)&&!(i.isInState(yt.z132.name)||i.isInState(yt.z107.name)||i.isInState(yt.z100.name)||i.isInState(yt.z98.name)||i.isInState(yt.z111.name)||i.isInState(yt.z41.name)||i.isInState(yt.z43.name))){var n=!1;if(i.isInState(yt.z112.name)&&(n=!0),i.isInState(yt.z48.name)){var s=i.targetObject;if(s&&s.accType==yt.z1044.z1058){var a=z1.distanceSquared(s.position,this.accessory.position),r=o.radius;if(a<r*r)return void(i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null))}}var c=i.targets.destTarget,d=i.targets.pathTarget;if(i.isFollowingPath()){var p=i.path[i.pathIndex];.25<(a=z1.distanceSquaredXY(p,d))&&(d.x=p.x,d.y=p.y,d.z=p.z)}var l=i.physics.rearBody.testCollidesWith(yt.App.PhysicsGroupBedding),u=i.targets.moveToTarget,y=i.targets.lookToTarget,g=i.targets.standToTarget,m=i.targets.avoidTarget,f=o.position,A=z1.distanceSquaredXZ(d,f),b=u.x-f.x,v=u.y-f.y,x=u.z-f.z,C=b*b+x*x,S=o.radius,T=o.radius+.001,B=c.x-f.x,O=c.z-f.z,P=B*B+O*O,M=i.physics.frontBody.body.position,I=i.physics.middleBody.body.position,N=M.y-f.y;if(0<i.pivotArea&&i.pivotPoint.x==f.x&&I.y-f.y>o.height+i.size)return i.pivotArea=0,void(i.currentz1091=null);if(0<N&&!l&&(l=!0),!i.isInState(yt.z142.name)&&i.currentObject){var z=(o=o).parent,w=z.position.x-.5*z.width,_=z.position.x+.5*z.width,R=f.x-w,L=_-f.x,F=S+2*i.size,D=!1,E=!1,k=BowlNavigator.z4[0],j=BowlNavigator.z4[2];j.x=0,j.y=1;var V=j.z=0,G=0,W=0,Y=!1;o.hamsters.length<o.maxz1062s&&(Y=!0),i.targetObject==o?E=D=!0:(z.isInBox(c.x,c.y,c.z,1e-4)&&(E=!0),E&&P<S*S&&c.y>o.position.y&&(D=!0));if(D||A<.25&&d.y>o.position.y&&(i.incrementPathIndex(),A=z1.distanceSquaredXZ(d,f),i.path2Index<i.path2.length?(u.copyFrom(d),y.copyFrom(d),g.copyFrom(d)):(u.copyFrom(c),y.copyFrom(c),g.copyFrom(c)),b=u.x-f.x,v=u.y-f.y,C=b*b+(x=u.z-f.z)*x),!D&&I.y>f.y){var U=z1.distanceSquaredXZ(I,f),X=o.radius-.5*i.size;if(U<X*X)return i.usingObject=o,void i.pubsub.broadcast(yt.BowlEvents.USE)}if(l){if(D&&!Y)return k.x=M.x-f.x,k.y=0,k.z=M.z-f.z,k.normalize(),V=f.x+k.x*(S+i.size),G=f.z+o.height,W=f.x+k.z*(S+i.size),m.set(V,G,W),u.copyFrom(m),void(i.avoidingObject=o);var Z=S*S,q=b*b+x*x;if(i.targetPickUp&&i.targetPickUp.bowl!=o)i.targetPickUp;else if(D&&!n&&C<T*T&&u.y>o.position.y)return i.usingObject=o,void i.pubsub.broadcast(yt.BowlEvents.USE);if(q<Z&&v<0)return ut=!0,V=M.x,G=o.parent.floorY,W=M.z,m.set(V,G,W),u.copyFrom(m),y.copyFrom(m),g.copyFrom(m),void(i.avoidingObject=o);var Q=BowlNavigator.z4[3];Q.x=this.position.x,Q.y=this.position.y,Q.z=this.position.z;var J=BowlNavigator.z4[4];J.x=d.x-Q.x,J.y=0,J.z=d.z-Q.z;var K=BowlNavigator.z4[5];K.x=d.x-M.x,K.y=0,K.z=d.z-M.z;var $=BowlNavigator.z4[6];$.x=Q.x-M.x,$.y=0,$.z=Q.z-M.z;var tt=K.lengthSquared(),et=$.lengthSquared();if(K.normalize(),$.normalize(),BABYLON.Vector3.Dot(K,$)<0)return void(i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null));if(E&&tt<=et)return void(i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null));i.pivotRadius=this.z1045_Pivot_Radius,i.pivotRadiusMax=i.pivotRadius+2*i.size,i.pivotPoint.x=Q.x,i.pivotPoint.y=Q.y,i.pivotPoint.z=Q.z;var ot=BowlNavigator.z4[7];ot.x=-K.z,ot.z=K.x;var it=ot.x+M.x,nt=ot.z+M.z,st=it-Q.x,at=nt-Q.z,rt=st*st+at*at,ht=-ot.x+M.x,ct=-ot.z+M.z,dt=ht-Q.x,pt=ct-Q.z,lt=dt*dt+pt*pt;i.pivotMoveDir=lt<rt?1:-1,i.pivotArea=1*Math.PI,i.pivotArea=this.z1045_Pivot_Area,i.pivotAreaDir.x=K.x,i.pivotAreaDir.y=K.y,i.pivotAreaDir.z=K.z,i.pivotUpdateLook=!1,i.currentz1091=this}else{V=i.currentObject.position.x,G=o.position.y-2*i.size,W=i.currentObject.position.z;var ut=!1;C<S*S&&0<v&&(ut=!0),R<F&&b<0&&x<S&&0<v&&(ut=!0),L<F&&0<b&&x<S&&0<v&&(ut=!0),ut&&(F=o.radius+2*i.size,k.x=M.x-f.x,k.y=0,k.z=M.z-f.z,R<F?k.x<0&&(k.x=0):L<F&&0<k.x&&(k.x=0),k.normalize(),V=f.x+k.x*(o.radius+3*i.size),G=f.y+o.height+i.size,W=f.z+k.z*(o.radius+3*i.size),m.set(V,G,W),u.copyFrom(m),y.copyFrom(m),g.copyFrom(m),i.avoidingObject=o)}}}},BowlNavigator}(yt.z1091);yt.BowlNavigator=t}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z679(){return null!==t&&t.apply(this,arguments)||this}return __extends(z679,t),z679.prototype.update=function(t){var e=t.targets.moveToTarget,o=t.targets.standToTarget,i=t.targets.lookToTarget,n=t.usingObject;if(n){var s=n.position,a=z767.z4[0],r=t.physics.frontBody.body.position;a.x=s.x,a.y=s.y+n.height+t.size,a.z=s.z,e.x=a.x,e.y=a.y,e.z=a.z,i.x=a.x,i.y=a.y,i.z=a.z,o.x=a.x,o.y=a.y,o.z=a.z;var c=t.physics.frontBody.body.position,d=c.x-s.x,p=c.z-s.z,l=d*d+p*p;if(l>n.radius*n.radius){var u=z767.z4[1];u.x=r.x-s.x,u.y=0,u.z=r.z-s.z,u.normalize();var y=n.radius-.04;o.x=s.x+u.x*y,o.y=a.y,o.z=s.z+u.z*y,e.x=o.x,e.y=o.y,e.z=o.z,i.x=s.x+u.x*(y-t.size),i.y=a.y,i.z=s.z+u.z*(y-t.size);n.radius,t.size}else a.x=s.x,a.y=s.y+n.height+t.size,a.z=s.z,e.x=a.x,e.y=a.y,e.z=a.z,i.x=a.x,i.y=a.y,i.z=a.z,o.x=a.x,o.y=a.y,o.z=a.z}},z679}(z767),e.z679=o}(z0||(z0={})),function(S){var t,e;t=S.z156||(S.z156={}),e=function(t){function z660(){return null!==t&&t.apply(this,arguments)||this}return __extends(z660,t),z660.prototype.update=function(t){var e=t.targets.pathTarget,o=t.targets.moveToTarget,i=t.targets.standToTarget,n=t.targets.lookToTarget,s=t.physics.frontBody.body.position,a=t.usingObject;if(a&&a.accType==S.z1044.z1045){var r=a.position,c=z767.z4[0],d=z767.z4[1],p=a.parent;if(p){var l=p.position.x-.5*p.width,u=p.position.x+.5*p.width,y=r.x-l,g=u-r.x,m=a.radius+3*t.size;d.x=e.x-r.x,d.y=0,d.z=e.z-r.z,d.z<0&&(d.z=0),0==d.x&&0==d.z&&(d.x=s.x-r.x,d.z=s.z-r.z),y<m?d.x<0&&(d.z=1,d.x=0):g<m&&0<d.x&&(d.z=1,d.x=0),d.normalize();var f=a.radius,A=a.radius+4*t.size,b=s.x-r.x,v=s.z-r.z,x=b*b+v*v,C=t.size;x<f*f&&(A=a.radius+t.size,C=2*t.size),c.x=r.x+d.x*A,c.y=r.y+a.height+C,c.z=r.z+d.z*A,c.x>u?c.x=u:c.x<l&&(c.x=l),o.x=c.x,o.y=c.y,o.z=c.z,n.x=c.x,n.y=c.y,n.z=c.z,i.x=c.x,i.y=c.y,i.z=c.z}}},z660}(z767),t.z660=e}(z0||(z0={})),function(A){var t,e;t=A.z156||(A.z156={}),e=function(t){function z640(){return null!==t&&t.apply(this,arguments)||this}return __extends(z640,t),z640.prototype.update=function(t){if(t.physics.touchingAccTypes&A.z1044.z1045){var e=t.cage;if(e){for(var o,i=0,n=0;n<t.physics.touchingShapes.length;n++){var s=t.physics.touchingShapes.data.data[n];s.entity&&s.entity.accType==A.z1044.z1045&&(o=s.entity,i++)}if(o){var a=o.position,r=a.x-e.left,c=e.right-a.x,d=o.radius+2*t.size,p=t.targets.moveToTarget,l=t.targets.lookToTarget,u=t.targets.standToTarget,y=p.x-a.x,g=p.z-a.z,m=!1;if(a.x!=t.pivotPoint.x&&t.pivotPoint.z==a.z&&(m=!0),1<i&&(m=!0),r<d&&y<=0&&g<o.radius&&(m=!0),c<d&&0<=y&&g<o.radius&&(m=!0),m){var f=a.y+o.height+3*t.size;p.y<f&&(p.y=f,t.targets.avoidTarget.copyFrom(p),t.avoidingObject=o),l.y<f-t.size&&(l.y=f-t.size),u.y<f&&(u.y=f)}}}}},z640}(z767),t.z640=e}(z0||(z0={})),function(c){var t,e;t=c.z156||(c.z156={}),e=function(t){function z613(){return null!==t&&t.apply(this,arguments)||this}return __extends(z613,t),z613.prototype.update=function(t){for(var e=c.Bowl.activeObjects,o=t.targets.destTarget,i=0;i<e.length;i++){var n=e[i],s=n.body.position,a=o.x-s.x,r=(o.y,s.y,o.z-s.z);if(a*a+r*r<n.radius*n.radius){t.usingObject=n;break}}},z613}(z767),t.z613=e}(z0||(z0={})),function(d){var t,e;t=d.z156||(d.z156={}),e=function(t){function z612(){return null!==t&&t.apply(this,arguments)||this}return __extends(z612,t),z612.prototype.update=function(t){for(var e,o=d.Bowl.activeObjects,i=t.path[t.pathIndex],n=0;n<o.length;n++){var s=o[n],a=s.body.position,r=i.x-a.x,c=(i.y,a.y,i.z-a.z);if(r*r+c*c<s.radius*s.radius){e=s;break}}t.targetObject=e},z612}(z767),t.z612=e}(z0||(z0={})),function(u){var t,e;t=u.z156||(u.z156={}),e=function(e){function z561(){var t=null!==e&&e.apply(this,arguments)||this;return t.bodyIndex=1,t.speedFrac=1,t.easeAmount=1,t.skipTouchingGround=!1,t}return __extends(z561,e),z561.prototype.update=function(t){if(this.skipTouchingGround||t.isTouchingGround()){var e=u.app.world.timeStep,o=(t.focusDist,z767.tempVecs[0]),i=z767.tempVecs[1],n=(t.physics,t.speed,t.physics.bodies[this.bodyIndex]),s=n.body.position,a=n.target;i.copy(a),i.subEqual(s);var r=0;r=6.4*t.size,r*=this.speedFrac;var c=n.rotationElements,d=z767.z4[0];d.x=c[2],d.y=c[5],d.z=c[8];var p=n.body.position;if(o.x=a.x-p.x,o.y=a.y-p.y,o.z=a.z-p.z,o.normalize(o),!isNaN(o.x)&&!isNaN(o.y)&&!isNaN(o.z)){o.x*=r,o.y*=r,o.z*=r;var l=n.body.linearVelocity;o.x=32*(o.x-l.x)*e*this.easeAmount,o.y=32*(o.y-l.y)*e*this.easeAmount,o.z=32*(o.z-l.z)*e*this.easeAmount,l.addEqual(o),isNaN(l.x),isNaN(l.y),isNaN(l.z)}}},z561}(z767),t.z561=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z569(){var t=null!==e&&e.apply(this,arguments)||this;return t.bodyIndex=3,t.skipTouchingGround=!0,t.speedFrac=1,t}return __extends(z569,e),z569.prototype.update=function(t){e.prototype.update.call(this,t)},z569}(e.z561),e.z569=o}(z0||(z0={})),function(B){var t,e;t=B.z156||(B.z156={}),e=function(e){function z544(){var t=null!==e&&e.apply(this,arguments)||this;return t.bowlLegPoleAng=.33,t.pawAngX=0,t.pawAngY=0,t.pawAngZ=-1.2,t}return __extends(z544,e),z544.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==B.z1044.z1045&&!(t.food||(a=t.physics.rearBody.standAng.value/-1.4)<.2)){1<a&&(a=1),a<0&&(a=0);var o=t.physics.frontBody.body;if(!(o.position.y-(e.position.y+e.height)<0)){var i=(m=o.position.x-e.position.x)*m+(f=o.position.z-e.position.z)*f,n=e.radius+.75*t.size;if(!(n*n<i))if(e.isBodyFacing(t.physics.middleBody)){var s=a-.5;s<0&&(s=0),s*=2;var a,r=.75*-t.bones.head.yaw*s;1.2<r?r=1.2:r<-1.2&&(r=-1.2),t.bones.shoulder.pitch.targetValue=t.physics.frontBody.standAng.targetValue,1<(a=t.physics.frontBody.standAng.value/-1.4)&&(a=1);var c=Math.sin(a*Math.PI)*t.size*.75;if(t.bones.legFL.footOffsetX_.targetValue=c,t.bones.legFR.footOffsetX_.targetValue=c,!(0<t.walkForce)){var d=t.physics.headBody.body.position,p=t.usingObject.position,l=(i=(m=d.x-p.x)*m+(f=d.z-p.z)*f,t.usingObject.radius-.5*t.size);if(!(l*l<i)){var u=t.bones,y=z767.z4[1];y.copyFrom(e.position),y.y+=e.height;var g=z767.z4[0];g.copyFrom(e.position),g.y+=e.height;var m,f,A=z767.z4[1],b=t.physics.frontBody.body.position,v=(i=(m=b.x-e.position.x)*m+(f=b.z-e.position.z)*f,1/Math.sqrt(i));A.x=m*v,A.z=f*v,A.y=0;var x=z767.z4[2];x.x=0,x.y=1,x.z=0;var C=z767.z4[3];BABYLON.Vector3.CrossToRef(A,x,C),C.scaleInPlace(-.07),A.x*=e.radius-.07,A.y=.04,A.z*=e.radius-.07,g.addInPlace(A),this.marker&&this.marker.position.copyFrom(g),u.legFL.setTargetPositionFloats(g.x+C.x,g.y+C.y,g.z+C.z),u.legFR.setTargetPositionFloats(g.x-C.x,g.y-C.y,g.z-C.z),u.legFL.targetPoleAngle=-this.bowlLegPoleAng,u.legFR.targetPoleAngle=this.bowlLegPoleAng,u.legFL.targetPositionLerp=.8*t.adjustLerp,u.legFR.targetPositionLerp=.8*t.adjustLerp,u.legFL.updatePose(),u.legFR.updatePose();var S=t.bones.legFR,T=z767.z4[4];S.bone3.getRotationToRef(BABYLON.Space.LOCAL,null,T),T.x=this.pawAngX,T.y=this.pawAngY,T.z=this.pawAngZ,S.bone3.setRotation(T),(S=t.bones.legFL).bone3.getRotationToRef(BABYLON.Space.LOCAL,null,T),T.x=this.pawAngX,T.y=this.pawAngY,T.z=this.pawAngZ,S.bone3.setRotation(T)}}}}}},z544}(z767),t.z544=e}(z0||(z0={})),function(c){var t,e;t=c.z156||(c.z156={}),e=function(e){function z531(){var t=null!==e&&e.apply(this,arguments)||this;return t.bowl_stretch=.3,t.TEST_REACH_LERP=.3,t}return __extends(z531,e),z531.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==c.z1044.z1045)if(t.isTouchingGround())if(t.targetPickUp||t.food)if(t.food)1e-4<t.physics.stretchFrac&&t.physics.stretchJoints(.85*t.physics.stretchDist);else{var o=this.TEST_REACH_LERP,i=t.physics.headBody.body.position,n=e.position,s=z1.distanceSquared(n,i),a=e.radius+.8*t.size;if(a*a<s)1e-4<t.physics.stretchFrac&&t.physics.stretchJoints(.95*t.physics.stretchDist);else if(t.isFacingBowl(e)){var r=this.bowl_stretch;t.food,t.physics.stretchJoints(r,o)}else 1e-4<t.physics.stretchFrac&&t.physics.stretchJoints(.95*t.physics.stretchDist)}else 1e-4<t.physics.stretchFrac&&t.physics.stretchJoints(.95*t.physics.stretchDist);else 1e-4<t.physics.stretchFrac&&t.physics.stretchJoints(.95*t.physics.stretchDist)},z531}(z767),t.z531=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z504(){return null!==t&&t.apply(this,arguments)||this}return __extends(z504,t),z504.prototype.update=function(t){t.isFollowingPath()&&(t.targetObject&&t.cage&&t.usingObject==t.targetObject&&(t.path.length=0,t.path2.length=0))},z504}(z767),e.z504=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z446(){var t=null!==e&&e.apply(this,arguments)||this;return t.minTargetY=-.75,t.maxStrength=200,t.skipAngVelWalk=!1,t}return __extends(z446,e),z446.prototype.update=function(t){if(!this.skipAngVelWalk&&t.isTouchingGround()){var e=t.physics.rearBody.standAng.value,o=z767.tempVecs[0],i=z767.tempVecs[1],n=z767.tempVecs[2],s=z767.tempVecs[3],a=t.physics,r=a.frontBody.body,c=t.bones.head,d=r,p=t.physics.frontBody.rotationElements,l=d.position,u=t.targets.moveToTarget,y=t.targets.upVecTarget;i.copy(u),i.subEqual(l);var g=i.x,m=i.y,f=i.z;a.frontBody.tranformToUpSpace(y,i,i);var A=i.x,b=i.z,v=A*A+b*b,x=Math.atan2(A,b),C=.6*Math.PI;if(C<x){var S=Math.sqrt(v);i.x=Math.sin(C)*S,i.z=Math.cos(C)*S}else if(x<-C){S=Math.sqrt(v);i.x=Math.sin(-C)*S,i.z=Math.cos(-C)*S}a.frontBody.tranformFromUpSpace(y,i,i),g=i.x,m=i.y,f=i.z;var T=t.physics.groundXAxis,B=t.physics.groundYAxis,O=t.physics.groundZAxis,P=g*T.x+m*T.y+f*T.z,M=g*B.x+m*B.y+f*B.z,I=g*O.x+m*O.y+f*O.z;M<t.size*this.minTargetY&&(M=t.size*this.minTargetY),g=P*T.x+M*B.x+I*O.x,m=P*T.y+M*B.y+I*O.y,f=P*T.z+M*B.z+I*O.z;var N=t.physics.frontBody.rotationElements;A=g*N[0]+m*N[3]+f*N[6],b=g*N[2]+m*N[5]+f*N[8];var z=Math.atan2(A,b);t.turnAng=z,N=p;var w=!1,_=.2*Math.PI;if(c.yaw>=_&&z<-_?w=!0:c.yaw<=-_&&_<z&&(w=!0),!w){var R=u.x,L=u.y,F=u.z;R=g+r.position.x,L=m+r.position.y,F=f+r.position.z,o.x=R-r.position.x,o.y=L-r.position.y,o.z=F-r.position.z,o.normalize(o);var D=t.targets.dirTarget;D.x=o.x,D.y=o.y,D.z=o.z;var E=t.physics.frontBody.rotationElements;i.x=E[2],i.y=E[5],i.z=E[8],n.cross(o,i),n.normalize(n),s.cross(n,o),s.normalize(s);var k=s,j=o,V=n,G=i.x*k.x+i.y*k.y+i.z*k.z,W=i.x*j.x+i.y*j.y+i.z*j.z,Y=.1*-Math.atan2(G,W)*60,U=r.angularVelocity,X=z1.getAngDiff(c.yawTar,c.yaw);!(.5<X||X<-.5)||t.physics.middleBody.onGround||t.physics.frontBody.onGround?e<-1&&(Y*=.5):Y*=.5,V.scaleEqual(Y),i.sub(V,U);var Z=t.size*this.maxStrength;Z*Z<i.dot(i)&&(i.normalize(i),i.scaleEqual(Z)),U.addEqual(i)}this.pubsub&&this.pubsub.broadcast(t.id,t,w,t.targets.dirTarget)}},z446}(z767),e.z446=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(c){function z448(){return c.call(this)||this}return __extends(z448,c),z448.prototype.update=function(t){var e=t.usingObject;if(e){var o=t.physics.frontBody.body.position,i=e.position,n=o.x-i.x,s=(o.y,i.y,o.z-i.z),a=n*n+s*s,r=e.radius;r*r<a&&c.prototype.update.call(this,t)}},z448}(e.z446),e.z448=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z430(){return null!==t&&t.apply(this,arguments)||this}return __extends(z430,t),z430.prototype.update=function(t){var e=t.usingObject,o=t.physics.frontBody.body.position,i=t.physics.rearBody.body.position,n=e.body.position,s=o.x-n.x,a=o.z-n.z,r=Math.sqrt(s*s+a*a),c=s/r,d=a/r,p=e.radius+.5*t.size,l=n.x+c*p,u=i.y,y=n.z+d*p;t.targets.destTarget.set(l,u,y),t.targets.minStandY=n.y+e.height+3*t.size},z430}(z767),e.z430=o}(z0||(z0={})),function(S){var t,e;t=S.z156||(S.z156={}),e=function(e){function z375(){var t=e.call(this)||this;return t.increaseSpeed=1,t.threshold=.2*Math.PI,t}return __extends(z375,e),z375.prototype.update=function(t){if(t.isTouchingGround()){var e=t.size,o=(t.focusDist,z767.tempVecs[0]),i=(z767.tempVecs[1],z767.tempVecs[2],S.app.world.timeStep,t.physics),n=(i.frontBody,t.speed,t.bones.head,t.physics.rearBody.standAng.value,i.rearBody.body.position,t.usingObject.body.position,i.rearBody.body),s=t.physics.rearBody.rotationElements,a=n.position,r=t.physics.rearBody.target;o.x=r.x-a.x,o.y=r.y-a.y,o.z=r.z-a.z,1<o.x*o.x+o.z*o.z+o.y*o.y&&o.normalize(o),isNaN(o.x)||isNaN(o.y)||isNaN(o.z);var c=13*e*this.increaseSpeed*1;o.x*=c,o.z*=c,o.y*=c;var d=n.linearVelocity,p=d.x,l=d.y,u=d.z,y=p*s[0]+l*s[3]+u*s[6],g=p*s[1]+l*s[4]+u*s[7],m=p*s[2]+l*s[5]+u*s[8],f=o.x,A=o.y,b=o.z,v=f*s[0]+A*s[3]+b*s[6],x=f*s[1]+A*s[4]+b*s[7],C=f*s[2]+A*s[5]+b*s[8];v=.5*(v-y),x=.5*(x-g),C=.5*(C-m),i.localWalkForce.x=v,i.localWalkForce.y=x,i.localWalkForce.z=C,o.x=v*s[0]+x*s[1]+C*s[2],o.y=v*s[3]+x*s[4]+C*s[5],o.z=v*s[6]+x*s[7]+C*s[8],isNaN(o.x)||isNaN(o.y)||isNaN(o.z),isNaN(o.x)||isNaN(o.y)||isNaN(o.z),d.addEqual(o),t.walkForce=c}},z375}(z767),t.z375=e}(z0||(z0={})),function(C){var t,e;t=C.z156||(C.z156={}),e=function(e){function z374(){var t=e.call(this)||this;return t.increaseSpeed=1,t.threshold=.2*Math.PI,t}return __extends(z374,e),z374.prototype.update=function(t){this.applyForceToBodyAwayFromBowl(t,t.physics.frontBody),this.applyForceToBodyAwayFromBowl(t,t.physics.rearBody)},z374.prototype.applyForceToBodyAwayFromBowl=function(t,e){var o=C.app.world.timeStep,i=z767.tempVecs[0],n=t.usingObject.body.position,s=e.body,a=e.rotationElements,r=s.position;i.x=r.x-n.x,i.z=r.z-n.z,i.y=0;var c=s.linearVelocity,d=c.x,p=c.y,l=c.z,u=d*a[0]+p*a[3]+l*a[6],y=d*a[1]+p*a[4]+l*a[7],g=d*a[2]+p*a[5]+l*a[8],m=i.x,f=i.y,A=i.z,b=m*a[0]+f*a[3]+A*a[6],v=m*a[1]+f*a[4]+A*a[7],x=m*a[2]+f*a[5]+A*a[8];b=32*(b-u)*o,v=32*(v-y)*o,x=32*(x-g)*o,i.x=b*a[0]+v*a[1]+x*a[2],i.y=b*a[3]+v*a[4]+x*a[5],i.z=b*a[6]+v*a[7]+x*a[8],c.addEqual(i)},z374}(z767),t.z374=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z369(){var t=null!==e&&e.apply(this,arguments)||this;return t.walkSpeedFrac=1,t.threshold=.2*Math.PI,t.skipLinVelWalk=!1,t.maxStrength=70,t.uprightAng=.7,t}return __extends(z369,e),z369.prototype.update=function(t){var e;if(!this.skipLinVelWalk&&(t.walkForce=0,t.isTouchingGround()&&(t.physics.middleBody.onGround||t.physics.frontBody.onGround||(t.physics.frontBody.onGroundCount,t.physics.middleBody.onGroundCount),!t.rearObject||t.rearObject.isInTube||t.isUpright(this.uprightAng)))){var o=t.size,i=z767.tempVecs[0],n=z767.tempVecs[1],s=t.physics,a=s.frontBody,r=t.speed,c=t.bones.head,d=t.physics.rearBody.standAng.value,p=t.targets,l=p.moveToTarget,u=p.dirTarget,y=p.upVecTarget;n.copy(l);var g=s.headBody.body.position,m=s.frontBody.body.position,f=s.rearBody.body.position;t.standing&&(n.y=g.y),n.subEqual(g);var A=n.x*n.x+n.y*n.y+n.z*n.z,b=t.mesh.getWorldMatrix(),v=t.bones.hip.bone.getAbsoluteTransform(),x=z767.tempBabMats[0];x.copyFrom(v),x.multiplyToRef(b,x),x.invertToRef(x);var C=z767.z4[0],S=z767.z4[1],T=z767.z4[2];C.x=m.x,C.y=m.y,C.z=m.z,S.x=l.x,S.y=l.y,S.z=l.z,t.standing&&(S.y=g.y),S.subtractToRef(C,T),BABYLON.Vector3.TransformNormalToRef(T,x,T);var B=!1;T.x<0&&(B=!0);var O=a.rotationElements;Math.PI;this.threshold;var P=z1.getAngDiff(c.yawTar,c.yaw);T.x,T.x,T.z,T.z;Math.PI,i.x=u.x,i.y=u.y,i.z=u.z,i.x+=O[2],i.y+=O[5],i.z+=O[8],i.normalize(i);var M=!1,I=.4*Math.PI;P<I&&-I<P&&(M=!0);var N=t.focusRange,z=t.focusDist;t.isFollowingPath()&&(null===(e=t.path[t.pathIndex])||void 0===e?void 0:e.data.hitDist)&&(z=.5*t.path[t.pathIndex].data.hitDist);var w=z+N,_=w*w,R=!1,L=!1;t.id,B&&!M||_<A&&(R=!0),B&&d>.2*-Math.PI&&(L=!0);var F=0;if(L&&!t.physics.rearBody.onGround&&(L=!1),R){F=13*o*(1-y.y+1),A<.5*w*w*.5&&(F=6.4*o),F=(q=3.2*o)+(F-q)*r;!(.5<P||P<-.5)||t.physics.middleBody.onGround||t.physics.frontBody.onGround?d<-1.35?F*=.4:t.isUnderBedding()||t.standDown&&(F*=.4):F*=.4,this.walkSpeedFrac=t.walkSpeed,F*=this.walkSpeedFrac,i.x*=F,i.y*=F,i.z*=F,O=a.rotationElements;var D=(J=a.body.linearVelocity).x,E=J.y,k=J.z,j=D*O[0]+E*O[3]+k*O[6],V=D*O[2]+E*O[5]+k*O[8],G=i.x,W=i.y,Y=i.z,U=G*O[0]+W*O[3]+Y*O[6],X=G*O[1]+W*O[4]+Y*O[7],Z=G*O[2]+W*O[5]+Y*O[8];U=.5*(U-j)*t.adjustLerp,Z=.5*(Z-V)*t.adjustLerp,s.localWalkForce.x=U,s.localWalkForce.y=X,s.localWalkForce.z=Z,i.x=U*O[0]+X*O[1]+Z*O[2],i.y=U*O[3]+X*O[4]+Z*O[5],i.z=U*O[6]+X*O[7]+Z*O[8],(K=t.size*this.maxStrength)*K<i.dot(i)&&(i.normalize(i),i.scaleEqual(K)),J.addEqual(i),t.walkForce=F}else if(L){O=t.physics.rearBody.rotationElements;var q,Q=t.physics.rearBody.body.position;y.y;F=(q=-3.2*o)+((F=-6.5*o)-q)*r,i.x*=F,i.y*=F,i.z*=F;var J,K;D=(J=s.rearBody.body.linearVelocity).x,E=J.y,k=J.z,j=D*O[0]+E*O[3]+k*O[6],V=D*O[2]+E*O[5]+k*O[8],G=i.x,W=i.y,Y=i.z,U=G*O[0]+W*O[3]+Y*O[6],X=G*O[1]+W*O[4]+Y*O[7],Z=G*O[2]+W*O[5]+Y*O[8];U=.5*(U-j)*t.adjustLerp,Z=.5*(Z-V)*t.adjustLerp,s.localWalkForce.x=U,s.localWalkForce.y=X,s.localWalkForce.z=Z,i.x=U*O[0]+X*O[1]+Z*O[2],i.y=U*O[3]+X*O[4]+Z*O[5],i.z=U*O[6]+X*O[7]+Z*O[8],(K=t.size*this.maxStrength)*K<i.dot(i)&&(i.normalize(i),i.scaleEqual(K)),J.addEqual(i),t.walkForce=F}if(R||L||(t.walkForce=0),this.pubsub){Q=z767.tempVecs[3];R&&(Q.x=m.x,Q.y=m.y,Q.z=m.z),L&&(Q.x=f.x,Q.y=f.y,Q.z=f.z),i.normalize(i),this.pubsub.broadcast(t.id,t,Q,i,t.walkForce)}}},z369}(z767),e.z369=o}(z0||(z0={})),function(a){var t,e;t=a.z156||(a.z156={}),e=function(s){function z371(){return null!==s&&s.apply(this,arguments)||this}return __extends(z371,s),z371.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==a.z1044.z1045){var o=t.physics.frontBody.body.position,i=z1.distanceSquaredXZ(e.position,o),n=e.radius+.8*t.size;n*n<i?s.prototype.update.call(this,t):t.isFacingBowl(e)||s.prototype.update.call(this,t)}},z371}(t.z369),t.z371=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z352(){return null!==t&&t.apply(this,arguments)||this}return __extends(z352,t),z352.prototype.update=function(t){var e=z767.z4[0],o=z767.z4[1],i=z767.z4[2],n=z767.z4[3],s=z767.z4[4];o.x=0,o.y=1,o.z=0,i.y=0;var a=t.usingObject,r=t.targets.point1,c=a.body.position,d=t.targets.lookToTarget,p=t.targets.moveToTarget,l=r.x-c.x,u=r.z-c.z,y=Math.sqrt(l*l+u*u),g=l/y,m=u/y;i.x=g,i.z=m,BABYLON.Vector3.CrossToRef(i,o,e);var f=a.radius+t.size,A=2*t.size;n.x=c.x+g*f+e.x*A,n.y=c.y+a.height+t.size,n.z=c.z+m*f+e.z*A;var b=BABYLON.Vector3.DistanceSquared(d,n);s.x=c.x+g*f-e.x*A,s.y=c.y+a.height+t.size,s.z=c.z+m*f-e.z*A,b<BABYLON.Vector3.DistanceSquared(d,s)?(d.copyFrom(n),p.x=c.x+g*f+e.x*A*2,p.z=c.z+m*f+e.z*A*2):(d.copyFrom(s),p.x=c.x+g*f-e.x*A*2,p.z=c.z+m*f-e.z*A*2),p.y=c.y+a.height+t.size,t.targets.standToTarget.copyFrom(d),t.targets.standToTarget.y+=2*t.size},z352}(z767),e.z352=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z351(){return null!==t&&t.apply(this,arguments)||this}return __extends(z351,t),z351.prototype.update=function(t){var e=t.usingObject,o=t.physics.headBody.body.position,i=e.body.position,n=t.targets.lookToTarget,s=o.x-i.x,a=o.z-i.z,r=s*s+a*a,c=e.radius+t.size,d=c*c,p=i.y+e.height;if(n.y<p&&r<d){var l=e.radius,u=t.size;if(r<l*l)n.y=p;else{var y=Math.sqrt(r)-l;n.y=p-e.height*(y/u)}}},z351}(z767),e.z351=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z307(){return null!==t&&t.apply(this,arguments)||this}return __extends(z307,t),z307.prototype.update=function(t){var e=t.usingObject;t.pivotPoint.x=e.body.position.x,t.pivotPoint.y=e.body.position.y,t.pivotPoint.z=e.body.position.z,t.pivotRadius=e.radius-e.thickness},z307}(z767),e.z307=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z296(){return null!==t&&t.apply(this,arguments)||this}return __extends(z296,t),z296.prototype.update=function(t){var e=t.physics.rearBody,o=t.usingObject;if(o&&t.standing){var i=t.targets.targetDir,n=o.radius-1.75*t.size;e.target.x=o.position.x-i.x*n,e.target.y=o.position.y+.9*t.size,e.target.z=o.position.z-i.z*n}},z296}(z767),e.z296=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z280(){return null!==t&&t.apply(this,arguments)||this}return __extends(z280,t),z280.prototype.update=function(t){var e=t.usingObject;t.targets.standHeight.targetValue=e.position.y+e.height+2*t.size},z280}(z767),e.z280=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z279(){return null!==t&&t.apply(this,arguments)||this}return __extends(z279,t),z279.prototype.update=function(t){var e=t.usingObject;if(e){var o=e.body.position,i=t.physics.frontBody.body.position,n=(s=i.x-o.x)*s+(a=i.z-o.z)*a;t.targets.minStandY=e.position.y+e.height+2*t.size,t.targets.minStandY=e.position.y+e.height+1*t.size;var s,a,r=t.physics.rearBody.body.position,c=(s=r.x-o.x)*s+(a=r.z-o.z)*a,d=Math.sqrt(c),p=s/d,l=a/d,u=t.targets.standToTarget;t.targetPickUp||t.food,t.minStandDist=1,u.set(r.x-1.5*t.size*p,o.y+e.height+.5*t.size,r.z-1.5*t.size*l),t.yieldingToOther||!t.food&&t.targetPickUp&&r.y>o.y+.5*e.height+.2*t.size&&d<e.radius+.5*t.size&&t.targets.lookToTarget.y<o.y+e.height&&u.copyFrom(t.targets.lookToTarget);var y=e.radius+.3*t.size;t.yieldingToOther||n<y*y&&(t.targets.standToTargetFront.copyFrom(t.targets.lookToTarget),t.food||n<e.radius*e.radius&&t.targetPickUp&&t.targetPickUp.bowl==e&&(t.targets.minStandYFront=t.targets.lookToTarget.y,u.copyFrom(t.targets.lookToTarget)))}},z279}(z767),e.z279=o}(z0||(z0={})),function(tt){var t,e;t=tt.z156||(tt.z156={}),e=function(e){function z275(){var t=null!==e&&e.apply(this,arguments)||this;return t.extendBowlRadius=0,t.extendBowlHeight=0,t}return __extends(z275,e),z275.prototype.update=function(t){var e=this.extendBowlRadius,o=z767.z4[0],i=t.physics.frontBody.body,n=t.physics.rearBody.body,s=t.usingObject;if(s&&s.accType==tt.z1044.z1045){var a=s.body.position,r=s.parent;if(r){var c=i.position,d=n.position,p=c.x-a.x,l=c.z-a.z,u=p*p+l*l,y=d.x-a.x,g=d.z-a.z,m=y*y+g*g,f=t.targets.moveToTarget,A=t.physics.rearBody.target;f.x=a.x,f.y=a.y+s.height+t.size,f.z=a.z,o.x=t.targets.pathTarget.x,o.y=t.targets.pathTarget.y,o.z=t.targets.pathTarget.z;var b=t.targets.destTarget;r.isInBox(b.x,b.y,b.z)&&s.isPositionInBowl(b.x,b.y,b.z)&&(o.x=b.x,o.y=b.y,o.z=b.z),(t.food||o.equalsToFloats(a.x,a.y,a.z))&&(o.x=d.x,o.y=d.y,o.z=d.z);var v,x=o.x-a.x,C=o.z-a.z,S=x*x+C*C,T=Number.MAX_VALUE,B=Number.MAX_VALUE,O=1/Math.sqrt(S),P=x*O,M=C*O,I=s.radius+t.size+e;t.targetPickUp&&!t.food&&(I=s.radius+e);var N=y*(O=1/Math.sqrt(m)),z=g*O;t.yieldingToOther?(T=a.x+N*I,B=a.z+z*I):(T=a.x+P*I,B=a.z+M*I);var w=z767.z4[1],_=z767.z4[2];w.x=N,w.y=0,w.z=z,_.x=P,_.y=0,_.z=M;var R=BABYLON.Vector3.Dot(w,_);if(R<.7){var L=z767.z4[3];L.x=0,L.y=1,L.z=0,BABYLON.Vector3.CrossToRef(w,L,_);var F=.7*(_.x+w.x)*I+a.x,D=.7*(_.z+w.z)*I+a.z,E=.7*(-_.x+w.x)*I+a.x,k=.7*(-_.z+w.z)*I+a.z,j=F-o.x,V=D-o.z,G=j*j+V*V,W=E-o.x,Y=k-o.z;G<W*W+Y*Y?(T=F,B=D):(T=E,B=k)}v=a.y,u<m&&(A.x=T,A.z=B,A.y=v+this.extendBowlHeight);var U=t.targets.lookToTarget,X=t.getStandFrac();if(t.isFacingBowl(s))if(X<.2&&c.y<a.y+s.height&&u>s.radius*s.radius)U.x=a.x,U.y=a.y+s.height+t.size,U.z=a.z;else{var Z=z1.distanceSquaredXZ(s.position,t.physics.headBody.body.position),q=.5*t.size+s.radius;if(q*q<Z)U.x=a.x,U.y=a.y+s.height+t.size,U.z=a.z;else{var Q=t.targets.destTarget;U.x=Q.x,U.y=Q.y,U.z=Q.z}}if((t.targetPickUp||t.food)&&t.usingObject){var J=z767.z4[1],K=s.radius+t.size;J.x=s.position.x+N*K,J.z=s.position.z+z*K,J.y=s.position.y+s.height;var $=t.size;T>r.right-$&&(T=r.right-$),T<r.left+$&&(T=r.left+$),u<m&&(A.x=T,A.z=B,A.y=v+this.extendBowlHeight)}}}},z275}(z767),t.z275=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z274(){var t=null!==e&&e.apply(this,arguments)||this;return t.extendBowlRadius=0,t.extendBowlHeight=0,t}return __extends(z274,e),z274.prototype.update=function(t){var e=this.extendBowlRadius,o=z767.z4[0],i=t.physics.frontBody.body,n=t.physics.rearBody.body,s=t.usingObject;if(s){var a=s.body.position,r=s.parent,c=i.position,d=n.position,p=c.x-a.x,l=c.z-a.z,u=p*p+l*l,y=d.x-a.x,g=d.z-a.z,m=y*y+g*g,f=t.targets.moveToTarget,A=t.physics.rearBody.target;f.x=a.x,f.y=a.y+s.height+t.size,f.z=a.z,o.x=t.targets.pathTarget.x,o.y=t.targets.pathTarget.y,o.z=t.targets.pathTarget.z;var b=t.targets.destTarget;r.isInBox(b.x,b.y,b.z)&&(s.isPositionInBowl(b.x,b.y,b.z)?(o.x=b.x,o.y=b.y,o.z=b.z):b.z-a.z<0&&Math.abs(b.x-a.x)<s.radius&&(o.x=b.x,o.y=b.y,o.z=b.z)),t.food&&(o.x=d.x,o.y=d.y,o.z=d.z);var v=o.x-a.x,x=o.z-a.z,C=v*v+x*x,S=Number.MAX_VALUE,T=Number.MAX_VALUE,B=0,O=1/Math.sqrt(C),P=v*O,M=x*O,I=s.radius+t.size+e,N=y*(O=1/Math.sqrt(m)),z=g*O;S=a.x+N*I,T=a.z+z*I;var w=z767.z4[1],_=z767.z4[2];w.x=N,w.y=0,w.z=z,_.x=P,_.y=0,_.z=M;var R=BABYLON.Vector3.Dot(w,_);B=a.y;r.position.z,r.depth,t.size;if(u<m&&(A.x=S,A.z=T,A.y=B+this.extendBowlHeight),!t.food){var L=t.targets.lookToTarget,F=t.getStandFrac(),D=s.isBodyFacing(t.physics.middleBody,.3);if(D&&F<.2&&c.y<a.y+s.height&&u>s.radius*s.radius&&(L.x=a.x,L.y=a.y+s.height+t.size,L.z=a.z),!(R<.7)&&!t.food&&(t.targetPickUp||t.food)&&t.usingObject){!1;var E=z767.z4[1],k=s.radius+t.size;E.x=s.position.x+N*k,E.z=s.position.z+z*k,E.y=s.position.y+s.height;var j=t.targets.destTarget,V=E.x-j.x,G=E.z-j.z,W=Math.sqrt(V*V+G*G),Y=2.5*t.size-W;if(Y<0)Y<-.1&&(Y=-.1),B=t.size+E.y,T+=z*Y,(V=(S+=N*Y)-a.x)*V+(G=T-a.z)*G>s.radius*s.radius&&(S=a.x+N*s.radius,T=a.z+z*s.radius);u<m&&(A.x=S,A.z=T,A.y=B+this.extendBowlHeight)}}}},z274}(z767),e.z274=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z273(){return null!==t&&t.apply(this,arguments)||this}return __extends(z273,t),z273.prototype.update=function(t){var e=t.physics.frontBody.body,o=t.pivotPoint,i=t.targets.destTarget,n=t.targets.targetDir;n.x=i.x-o.x,n.z=i.z-o.z,n.y=0,n.normalize(),this.pubsub&&this.pubsub.broadcast("getDirection",t,e.position,n)},z273}(z767),e.z273=o}(z0||(z0={})),function(m){var t,e;t=m.z156||(m.z156={}),e=function(e){function z200(){var t=null!==e&&e.apply(this,arguments)||this;return t.tempAccs=[],t.tempVecs=[],t.tempPath=[],t.accType=0,t}return __extends(z200,e),z200.prototype.update=function(t){var e=t.cage,o=this.accType,i=t.targets.destTarget;if(0==t.path.length&&t.targetObject&&t.targetObject.accType==o&&!t.avoidingObject)if(t.cage)if(t.cage.isInside(i.x,i.y,i.z)){if(t.platformUnder&&i.y<t.platformUnder.position.y){if(t.setPathTo(i),0<t.path.length)return void((g=t.path[t.pathIndex])&&(t.targets.pathTarget.x=g.x,t.targets.pathTarget.y=g.y,t.targets.pathTarget.z=g.z));t.targetObject=null}t.targets.setTargetsToDestination()}else t.targetObject=null;else t.targets.setTargetsToDestination();if(e&&t.targetObject&&t.targetObject.accType==o)if(t.targetObject.cage==e)if(t.targetObject.isOnScene){if(!i.equalsWithEpsilon(t.targetObject.position,.01)){var n=z767.z4[0];n.copyFrom(t.targets.pathTarget),i.copyFrom(t.targetObject.position),0<t.path.length&&t.pathIndex<t.path.length&&t.targets.pathTarget.copyFrom(n)}}else t.memory.remove(t.targetObject),t.targetObject=null;else e.isInBox(i.x,i.y,i.z)?(t.memory.remove(t.targetObject),t.targetObject=null):t.targetObject.isOnScene||(t.memory.remove(t.targetObject),t.targetObject=null);if(!t.targetObject||t.targetObject.accType!=o){var s,a=null,r=t.memory.getAccessories(o),c=t.memory.getPositions(o);if(r){if(this.tempAccs.length=0,this.tempVecs.length=0,1==r.length)s=r[0],a=c[0];else if(e)for(var d=0;d<r.length;d++){var p=r[d];p.cage==e&&(this.tempAccs.push(p),this.tempVecs.push(c[d]))}if(0<this.tempAccs.length)if(1==this.tempAccs.length)s=this.tempAccs[0],a=this.tempVecs[0];else{var l=m.z1073.GetClosestPositionByIndex(this.tempVecs,t.position);s=this.tempAccs[l],a=this.tempVecs[l]}else if(1<r.length){var u=9999;for(l=0,d=0;d<r.length;d++){var y=c[d];t.getPathToRef(y,this.tempPath,r[d]),this.tempPath.length<u&&(u=this.tempPath.length,l=d)}s=r[l],a=c[l]}if(s){var g;if(t.targetObject=s,t.targets.destTarget.set(a.x,a.y,a.z),t.setPathTo(a),0==t.path.length)t.targets.setTargetsToDestination();else(g=t.path[t.pathIndex])&&(t.targets.pathTarget.x=g.x,t.targets.pathTarget.y=g.y,t.targets.pathTarget.z=g.z);t.targetObject.cage!=t.cage&&0==t.path.length&&(t.memory.remove(t.targetObject),t.targetObject=null)}}}},z200}(z767),t.z200=e}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(o){function z197(){var t=null!==o&&o.apply(this,arguments)||this;return t.accType=e.z1044.z1045,t}return __extends(z197,o),z197.prototype.update=function(t){if(o.prototype.update.call(this,t),!t.isFollowingPath()&&t.targetObject&&t.targetObject.targetPosition&&t.targetObject.isOnScene){var e=t.targetObject.targetPosition;t.cage&&t.cage.isInBox(e.x,e.y,e.z)&&(t.targets.destTarget.equals(e)||t.targets.destTarget.copyFrom(e))}},z197}(t.z200),t.z197=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z182(){return null!==t&&t.apply(this,arguments)||this}return __extends(z182,t),z182.prototype.update=function(t){},z182}(z767),e.z182=o}(z0||(z0={})),function(g){var t,e;t=g.z156||(g.z156={}),e=function(e){function z169(){var t=null!==e&&e.apply(this,arguments)||this;return t.pointLinSpeed=.2,t.pointAngSpeed=.04,t}return __extends(z169,e),z169.prototype.update=function(t){var e=t.targetObject;if(e&&e.accType==g.z1044.z1045){var o,i=t.targets.point1;o=this.pointLinSpeed;var n=this.pointAngSpeed;t.targets.randAng+=(2*Math.random()-1)*n;var s=Math.cos(t.targets.randAng)*o,a=Math.sin(t.targets.randAng)*o;i.x+=s,i.z+=a;var r=e.position;s=i.x-r.x,a=i.z-r.z,i.y=r.y+e.height;var c=t.physics.headBody.body.position;i.y>c.y-t.size&&(i.y=c.y-t.size);var d=s*s+a*a,p=e.radius-.2;if(p*p<d){var l=Math.sqrt(d),u=s/l,y=a/l;i.x=r.x+u*p,i.z=r.z+y*p}}},z169}(z767),t.z169=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1011(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1011,t),z1011.prototype.test=function(t){var e=t.usingObject;if(!e)return!1;if(!e.parent)return!1;var o=e.body.position,i=t.physics.rearBody.body.position,n=i.x-o.x,s=(i.y,o.y,i.z-o.z),a=n*n+s*s,r=e.radius;return a<r*r},z1011}(z770),e.z1011=o}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z1003(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1003,t),z1003.prototype.test=function(t){var e=t.memory.getAccessories(o.z1044.z1045);return!(!e||0==e.length)},z1003}(z770),t.z1003=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z959(){return null!==t&&t.apply(this,arguments)||this}return __extends(z959,t),z959.prototype.test=function(t){var e=t.usingObject;if(e){var o=t.targets.destTarget;return!e.isPositionInBowl(o.x,o.y,o.z)}},z959}(z770),e.z959=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z946(){return null!==t&&t.apply(this,arguments)||this}return __extends(z946,t),z946.prototype.test=function(t){var e=t.usingObject;if(!e||!e.isBodyFacing)return!1;var o=e.isBodyFacing(t.physics.middleBody);return o},z946}(z770),e.z946=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z933(){return null!==t&&t.apply(this,arguments)||this}return __extends(z933,t),z933.prototype.test=function(t){var e=t.usingObject;if(!e)return!1;var o=e.body.position,i=t.physics.frontBody.body.position,n=i.x-o.x,s=i.z-o.z,a=e.radius+.7*t.size;return a*a<n*n+s*s},z933}(z770),e.z933=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z921(){return null!==t&&t.apply(this,arguments)||this}return __extends(z921,t),z921.prototype.test=function(t){var e=t.usingObject;if(!e||!e.isBodyFacing)return!1;var o=t.physics.headBody.body.position,i=o.x-e.position.x,n=o.z-e.position.z;return i*i+n*n<e.radius*e.radius},z921}(z770),e.z921=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z920(){return null!==t&&t.apply(this,arguments)||this}return __extends(z920,t),z920.prototype.test=function(t){var e=t.usingObject;if(!e)return!1;var o=e.body.position,i=t.physics.headBody.body.position,n=i.x-o.x,s=i.z-o.z,a=e.radius+.7*t.size;return a*a<n*n+s*s},z920}(z770),e.z920=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z914(){return null!==t&&t.apply(this,arguments)||this}return __extends(z914,t),z914.prototype.test=function(t){var e=t.usingObject;if(!e)return!1;var o=e.body.position,i=t.physics.rearBody.body.position,n=e.radius-.5*t.size,s=n*n,a=i.x-o.x,r=i.z-o.z,c=a*a+r*r;return!(s<c)&&!(s<(c=(a=(i=t.physics.frontBody.body.position).x-o.x)*a+(r=i.z-o.z)*r))},z914}(z770),e.z914=o}(z0||(z0={})),function(r){var t,e;t=r.z768||(r.z768={}),e=function(t){function z908(){return null!==t&&t.apply(this,arguments)||this}return __extends(z908,t),z908.prototype.test=function(t){var e=t.usingObject;if(!e||e.accType!=r.z1044.z1045)return!1;var o=e.body.position,i=t.physics.middleBody.body.position,n=i.x-o.x,s=i.z-o.z,a=e.radius+.7*t.size;return a*a<n*n+s*s},z908}(z770),t.z908=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z868(){return null!==t&&t.apply(this,arguments)||this}return __extends(z868,t),z868.prototype.test=function(t){var e=t.usingObject;if(!e)return!1;var o=e.body.position,i=t.physics.rearBody.body.position,n=i.x-o.x,s=i.z-o.z,a=e.radius+.7*t.size;return a*a<n*n+s*s},z868}(z770),e.z868=o}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z838(){return null!==t&&t.apply(this,arguments)||this}return __extends(z838,t),z838.prototype.test=function(t){var e=t.usingObject;return!!e&&e.accType==o.z1044.z1045},z838}(z770),t.z838=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z812(){return null!==t&&t.apply(this,arguments)||this}return __extends(z812,t),z812.prototype.test=function(t){t.targetObject;return!1},z812}(z770),e.z812=o}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z802(){return null!==t&&t.apply(this,arguments)||this}return __extends(z802,t),z802.prototype.test=function(t){return!t.usingObject||(!!t.isInState(e.z111.name)||(!!t.isInState(e.z107.name)||(!!t.isInState(e.z100.name)||void 0)))},z802}(z770),t.z802=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z792(){return null!==t&&t.apply(this,arguments)||this}return __extends(z792,t),z792.prototype.test=function(t){var e=t.usingObject;if(e){var o=t.targets.destTarget,i=e.position,n=o.x-i.x,s=o.y-i.y,a=o.z-i.z;if(s<0)return!0;if(t.targetPickUp&&t.targetPickUp.bowl!=e)return!0;var r=n*n+a*a,c=e.radius;return c*c<r||!!(s>e.height&&t.cage.getPlatformUnder(o.x,o.y,o.z))}},z792}(z770),e.z792=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z779(){return null!==t&&t.apply(this,arguments)||this}return __extends(z779,t),z779.prototype.test=function(t){var e=t.usingObject;if(e){var o=t.targets.destTarget;return o=t.targets.moveToTarget,!e.isPositionInBowl(o.x,o.y,o.z)}},z779}(z770),e.z779=o}(z0||(z0={})),function(o){var t=function(e){function z149(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z406,o.z156.z514,o.z156.z761],t.updatez156=[o.z156.z679,o.z156.z574,o.z156.z687,o.z156.z685,o.z156.z610,o.z156.z209,o.z156.z460,o.z156.z446,o.z156.z590,o.z156.z214,o.z156.z369,o.z156.z362,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z379,o.z156.z442],t.transitions=[{condition:o.z768.z779,trueNode:{state:o.z66,level:1}},{condition:o.z768.z921,trueNode:{condition:o.z768.z812,falseNode:{state:o.z145}}},{condition:o.z768.z812,falseNode:{state:o.z145}}],t}return __extends(z149,e),z149}(z49);o.z149=t}(z0||(z0={})),function(o){var t=function(e){function z148(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z761],t.updatez156=[o.z156.z406,o.z156.z660,o.z156.z574,o.z156.z687,o.z156.z685,o.z156.z610,o.z156.z460,o.z156.z446,o.z156.z590,o.z156.z214,o.z156.z369,o.z156.z362,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z379,o.z156.z442],t.exitz156=[o.z156.z239],t.transitions=[{condition:o.z768.z838,falseNode:{state:o.z66,level:1}},{condition:o.z768.z908,trueNode:{state:o.z66,level:1}}],t}return __extends(z148,e),z148}(z49);o.z148=t}(z0||(z0={})),function(o){var t=function(e){function z147(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z725],t.updatez156=[o.z156.z169,o.z156.z582,o.z156.z210,o.z156.z724],t.transitions=[{condition:o.z768.z946,falseNode:{state:o.z112,actions:[o.z156.z629]}},{condition:o.z768.z976,trueNode:{state:o.z112,actions:[o.z156.z629]}},{condition:o.z768.z903,trueNode:{state:o.z102}},{condition:o.z768.z957,trueNode:{condition:o.z768.z853,trueNode:{state:o.z112},falseNode:{condition:o.z768.z951,trueNode:{state:o.z112}}}}],t}return __extends(z147,e),z147}(z49);o.z147=t}(z0||(z0={})),function(o){var t=function(e){function z146(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z307,o.z156.z741,o.z156.z239,o.z156.z382],t.updatez156=[o.z156.z205,o.z156.z273,o.z156.z258,o.z156.z536,o.z156.z386,o.z156.z394,o.z156.z209,o.z156.z687,o.z156.z296,o.z156.z564,o.z156.z461,o.z156.z446,o.z156.z590,o.z156.z214,o.z156.z362,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z379,o.z156.z442],t.exitz156=[o.z156.z502],t.transitions=[{condition:o.z768.z792,trueNode:{state:o.z148}},{condition:o.z768.z868,trueNode:{condition:o.z768.z933,trueNode:{state:o.z66,level:1}}}],t}return __extends(z146,e),z146}(z49);o.z146=t}(z0||(z0={})),function(o){var t=function(e){function z145(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z396,o.z156.z299],t.updatez156=[o.z156.z376,o.z156.z294,o.z156.z275,o.z156.z569,o.z156.z279,o.z156.z627,o.z156.z209,o.z156.z687,o.z156.z448,o.z156.z371,o.z156.z461,o.z156.z531,o.z156.z590,o.z156.z362,o.z156.z731,o.z156.z379,o.z156.z544,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739],t.transitions=[{condition:o.z768.z914,trueNode:{state:o.z146}},{condition:o.z768.z802,trueNode:{state:o.z66,level:1}},{condition:o.z768.z969,trueNode:{state:o.z66,level:1}},{condition:o.z768.z830,trueNode:{state:o.z144}},{condition:o.z768.z873,trueNode:{state:o.z66,level:1,actions:[o.z156.z502,o.z156.z501]}},{condition:o.z768.z792,trueNode:{state:o.z148,actions:[o.z156.z502]}}],t.exitz156=[o.z156.z377,o.z156.z485,o.z156.z491],t}return __extends(z145,e),z145}(z49);o.z145=t}(z0||(z0={})),function(o){var t=function(e){function z144(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[],t.updatez156=[o.z156.z382,o.z156.z294,o.z156.z274,o.z156.z627,o.z156.z209,o.z156.z461,o.z156.z574,o.z156.z565,o.z156.z446,o.z156.z369,o.z156.z279,o.z156.z590,o.z156.z362,o.z156.z731,o.z156.z379,o.z156.z544,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739],t.transitions=[{condition:o.z768.z830,falseNode:{state:o.z145}},{condition:o.z768.z873,trueNode:{state:o.z66,level:1,actions:[o.z156.z502]}},{condition:o.z768.z792,trueNode:{state:o.z148,actions:[o.z156.z502]}}],t.exitz156=[o.z156.z485,o.z156.z491],t}return __extends(z144,e),z144}(z49);o.z144=t}(z0||(z0={})),function(o){var t=function(e){function z143(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z197,o.z156.z314],t.updatez156=[o.z156.z504,o.z156.z197,o.z156.z208,o.z156.z209,o.z156.z532,o.z156.z733,o.z156.z734],t.transitions=[{condition:o.z768.z921,trueNode:{state:o.z147}},{condition:o.z768.z903,trueNode:{state:o.z102}},{condition:o.z768.z957,trueNode:{condition:o.z768.z853,trueNode:{state:o.z112},falseNode:{condition:o.z768.z951,trueNode:{state:o.z112}}}},{condition:o.z768.z1003,falseNode:{state:o.z112}},{condition:o.z768.z882,trueNode:{condition:o.z768.z880,falseNode:{state:o.z34,actions:[o.z156.z483,o.z156.z470]}}}],t}return __extends(z143,e),z143}(z49);o.z143=t}(z0||(z0={})),function(o){var t=function(e){function z142(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.states=[o.z149,o.z146,o.z145,o.z144,o.z148],t.updatez156=[],t.transitions=[{condition:o.z768.z950,trueNode:{state:o.z66,actions:[o.z156.z465]}}],t.exitz156=[o.z156.z517,o.z156.z465,o.z156.z495],t.initialState=o.z145,t}return __extends(z142,e),z142}(z49);o.z142=t}(z0||(z0={})),function(S){var t=function(A){function Bridge(t){var e=A.call(this)||this;return e.accType=S.z1044.z1050,e.nodes=void 0,e.num=0,e.world=void 0,e.body=void 0,e.bodySide1=void 0,e.bodySide2=void 0,e.bodyStepLeft=void 0,e.bodyStepRight=void 0,e.shapeStepLeft=void 0,e.shapeStepRight=void 0,e.boxSize=1,e.radius=.625,e.innerRadius=0,e._bodyOffsetY=0,e.worldMatrix=BABYLON.Matrix.Identity(),e.invWorldMatrix=BABYLON.Matrix.Identity(),e.floorThickness=0,e.sideNodesConnectedRight=!1,e.sideNodesConnectedLeft=!1,e._tempArray=[],Bridge.count++,e.shapeName="Bridge",e.num=Bridge.count,e.position=BABYLON.Vector3.Zero(),e.scaling=new BABYLON.Vector3(1,1,1),e.placementType=S.PlacementType.GRID|S.PlacementType.z1048|S.PlacementType.MID,e}return __extends(Bridge,A),Bridge.prototype.getWorldMatrix=function(){return this.worldMatrix},Bridge.prototype.addToActiveObjects=function(){-1==Bridge.activeObjects.indexOf(this)&&Bridge.activeObjects.push(this)},Bridge.prototype.removeFromActiveObjects=function(){var t=Bridge.activeObjects.indexOf(this);-1!=t&&Bridge.activeObjects.splice(t,1)},Bridge.prototype.init=function(t){A.prototype.init.call(this,t),this.boxSize=1,t.boxSize&&(this.boxSize=t.boxSize),this.canRotate=!1,this.canTranslate=!0,this.canDelete=!0,this.world=t.world,this.addToActiveObjects();this.width,this.height;t.width&&(t.width,this.width=t.width),this.mapPlacementInfo||(this.mapPlacementInfo=new S.MapPlacementInfo({mapOffsetY:-.5,mapOffsetDropTargetY:.5,mapPlacementSizeX:.5,offsetDragFromMenuY:-.5})),this.controlAnchor||this.addControlAnchor(),this.controlPositionLocal.x=0,this.controlPositionLocal.y=this.radius;var e=this.controlPositionLocal.z=0,o=0;null!=t.x&&(e=t.x),null!=t.y&&(o=t.y),this.floorThickness=.04,this.height=.5;if(this.depth=.6,t.isMenuItem&&(this.controlPositionLocal.y=.5,t.isMenuItem),t.isMenuItem);else if(!this.hitMeshes){this.hitMeshes=[];var i=this.width+.95,n=S.app.graphicsHelper.getHitMesh(i,.001,this.depth);n.rotationQuaternion=BABYLON.Quaternion.Identity(),this.hitMeshes.push(n);var s=[1,.4,.2,S.App.z1033,4294967295];this.radius=.55,this.innerRadius=.5;var a="bridge"+this.num;this.body=new OIMO.Body({size:[.55,.6,.5],pos:[0,0,0],rot:[90,0,0],world:this.world,type:"tube",move:!1,name:a+"_bridge",config:s}).body,(this.body.shapes.entity=this).body.shapes.minY=.33-this._bodyOffsetY,this.body.shapes.minX=Math.sqrt(.55*.55-this.body.shapes.minY*this.body.shapes.minY);this.bodySide1=new OIMO.Body({size:[.8,.05,.5],pos:[0,0,0],rot:[90,0,0],world:this.world,type:"tube",move:!1,name:a+"_bridge",config:s}).body,this.bodySide1.shapes.minY=-this._bodyOffsetY,this.bodySide1.shapes.minX=Math.sqrt(.55*.55-this.bodySide1.shapes.minY*this.bodySide1.shapes.minY),this.bodySide2=new OIMO.Body({size:[.8,.05,.5],pos:[0,0,0],rot:[90,0,0],world:this.world,type:"tube",move:!1,name:a+"_bridge",config:s}).body,this.bodySide2.shapes.minY=-this._bodyOffsetY,this.bodySide2.shapes.minX=Math.sqrt(.55*.55-this.bodySide2.shapes.minY*this.bodySide2.shapes.minY),this.bodyStepLeft=new OIMO.Body({size:[.03,.03,.6],pos:[0,0,0],rot:[0,0,0],world:this.world,type:"box",move:!1,name:a+"_bridge",config:s}).body,this.bodyStepRight=new OIMO.Body({size:[.03,.03,.6],pos:[0,0,0],rot:[0,0,0],world:this.world,type:"box",move:!1,name:a+"_bridge",config:s}).body,this.nodes=[];for(var r=0;r<5;r++){var c=new GraphNode(0,0,0);S.app.graph.addNode(c),this.nodes.push(c)}this.nodes[1].data.enterEvent=S.BridgeEvents.USE,this.nodes[1].data.enterNextNode=this.nodes[2],this.nodes[3].data.enterEvent=S.BridgeEvents.USE,this.nodes[3].data.enterNextNode=this.nodes[2],this.rightGraphNode=this.nodes[0],this.leftGraphNode=this.nodes[4],this.rightGraphNode.data.enterEvent=S.BridgeEvents.USE,this.rightGraphNode.data.enterNextNode=this.nodes[1],this.leftGraphNode.data.enterEvent=S.BridgeEvents.USE,this.leftGraphNode.data.enterNextNode=this.nodes[3];for(r=0;r<8;r++){(c=new GraphNode(0,0,0)).data.isSideNode=!0,S.app.graph.addNode(c),this.nodes.push(c)}this.updateNodes();for(r=0;r<4;r++){var d=this.nodes[r],p=this.nodes[r+1],l=Math.sqrt(z1.distanceSquared(d,p));d.addConnection(p,.1*l),p.addConnection(d,.1*l)}var u=5,y=this.rightGraphNode,g=this.nodes[u],m=this.nodes[u+1],f=.1*Math.sqrt(z1.distanceSquared(y,g));y.addConnection(g,f),g.addConnection(y,f),f=.01,g.addConnection(m,f),m.addConnection(g,f),g,u+=2,y=this.rightGraphNode,g=this.nodes[u],m=this.nodes[u+1],f=Math.sqrt(.1*z1.distanceSquared(y,g)),y.addConnection(g,f),g.addConnection(y,f),f=.01,g.addConnection(m,f),m.addConnection(g,f),g,u+=2,y=this.leftGraphNode,g=this.nodes[u],m=this.nodes[u+1],f=.1*Math.sqrt(z1.distanceSquared(y,g)),y.addConnection(g,f),g.addConnection(y,f),f=.01,g.addConnection(m,f),m.addConnection(g,f),g,u+=2,y=this.leftGraphNode,g=this.nodes[u],m=this.nodes[u+1],f=.1*Math.sqrt(z1.distanceSquared(y,g)),y.addConnection(g,f),g.addConnection(y,f),f=.01,g.addConnection(m,f),m.addConnection(g,f),g,u+=2;this.leftNavigator=new S.BridgeNavigator,this.leftNavigator.init({accessory:this,radius:.2}),this.rightNavigator=new S.BridgeNavigator,this.rightNavigator.init({accessory:this,radius:.2}),this.leftNavigator2=new S.BridgeNavigator,this.leftNavigator2.init({accessory:this,radius:.2}),this.rightNavigator2=new S.BridgeNavigator,this.rightNavigator2.init({accessory:this,radius:.2})}if(this.shapeSide1?(this.shapeSide1.init({name:"bridgeSide1",renderingGroupID:this.renderingGroupID}),this.shapeSide2.init({name:"bridgeSide1",renderingGroupID:this.renderingGroupID})):(this.shapeSide1=ObjectPool.get("z1068",{name:"BridgeSide1",renderingGroupID:this.renderingGroupID}),this.shapeSide2=ObjectPool.get("z1068",{name:"BridgeSide1",renderingGroupID:this.renderingGroupID}),this.shapeSide1.setTexture("bridgeRainbowTexture"),this.shapeSide2.setTexture("bridgeRainbowTexture")),t.skipAddToScene)this.removeFromScene();else{if(this.setPosition(e,o,0),this.addToScene(),this.isMenuItem||this.cage||(this.cage=S.Cage.getCageAt(this.position.x,this.position.y+.5*this.height,this.position.z)),!this.cage)return;this.cage.isReady?this.addToObject(this.cage):this.cage.pubsub.subscribe("ready",this.addToObject,this)}},Bridge.prototype.makeClimbOverSideNodesLeft=function(){var t=this.nodes[9],e=this.nodes[10];t.data.enterEvent=S.BridgeEvents.USE,(t.data.enterNextNode=e).data.enterEvent=S.BridgeEvents.USE,e.data.enterNextNode=t;t=this.nodes[11],e=this.nodes[12];t.data.enterEvent=S.BridgeEvents.USE,(t.data.enterNextNode=e).data.enterEvent=S.BridgeEvents.USE,e.data.enterNextNode=t},Bridge.prototype.makeClimbOverSideNodesRight=function(){var t=this.nodes[5],e=this.nodes[6];t.data.enterEvent=S.BridgeEvents.USE,(t.data.enterNextNode=e).data.enterEvent=S.BridgeEvents.USE,e.data.enterNextNode=t;t=this.nodes[7],e=this.nodes[8];t.data.enterEvent=S.BridgeEvents.USE,(t.data.enterNextNode=e).data.enterEvent=S.BridgeEvents.USE,e.data.enterNextNode=t},Bridge.prototype.initSideNodes=function(){for(var t=5;t<13;t++){var e=this.nodes[t];e.data.enterEvent=null,e.data.enterNextNode=null}},Bridge.prototype.updateNodes=function(){if(this.nodes){for(var t=this.radius+.15,e=Math.PI/4,o=0;o<5;o++){(i=this.nodes[o]).x=this.position.x+Math.cos(o*e+0)*t,i.y=this.position.y+Math.sin(o*e+0)*t+.04}for(o=0;o<this.nodes.length;o++){var i;(i=this.nodes[o]).data.obj=this.cage,i.data.obj2=this}this.rightGraphNode.x+=.1,this.rightGraphNode.y+=.45,this.leftGraphNode.x-=.1,this.leftGraphNode.y+=.45;var n=.5*this.depth+.2,s=n,a=5,r=.05,c=.05,d=0,p=0;if(this.initSideNodes(),this.cage){var l=this.cage.position.x-.5*this.cage.width,u=this.cage.position.x+.5*this.cage.width,y=this.position.x-this.boxSize,g=this.position.x+this.boxSize;Math.abs(l-y)<.1&&(this.makeClimbOverSideNodesLeft(),r=0,s=(d=.5)*this.depth+.2),Math.abs(u-g)<.1&&(this.makeClimbOverSideNodesRight(),c=0,n=(p=.5)*this.depth+.2)}this.nodes[a].x=this.rightGraphNode.x+c,this.nodes[a].y=this.position.y+p+.04,this.nodes[a].z=this.rightGraphNode.z+n,a++,this.nodes[a].x=this.rightGraphNode.x+c,this.nodes[a].y=this.position.y+p+.04,this.nodes[a].z=this.rightGraphNode.z+n+.1,a++,this.nodes[a].x=this.rightGraphNode.x+c,this.nodes[a].y=this.position.y+p+.04,this.nodes[a].z=this.rightGraphNode.z-n,a++,this.nodes[a].x=this.rightGraphNode.x+c,this.nodes[a].y=this.position.y+p+.04,this.nodes[a].z=this.rightGraphNode.z-n-.1,a++,this.nodes[a].x=this.leftGraphNode.x-r,this.nodes[a].y=this.position.y+d+.04,this.nodes[a].z=this.leftGraphNode.z+s,a++,this.nodes[a].x=this.leftGraphNode.x-r,this.nodes[a].y=this.position.y+d+.04,this.nodes[a].z=this.leftGraphNode.z+s+.1,a++,this.nodes[a].x=this.leftGraphNode.x-r,this.nodes[a].y=this.position.y+d+.04,this.nodes[a].z=this.leftGraphNode.z-s,a++,this.nodes[a].x=this.leftGraphNode.x-r,this.nodes[a].y=this.position.y+d+.04,this.nodes[a].z=this.leftGraphNode.z-s-.1}},Bridge.prototype.getCenterAtPosToRef=function(t,e,o,i){i.x=t,i.y=e+this.radius,i.z=o},Bridge.prototype.setPositionOnMapFromDrop=function(t,e,o){var i=this._tempDropLoc;this.getPositionOnMapFromDropToRef(t,e,o,i),t=i.x,e=i.y,o=i.z,this.setPositionDrag(t,e,o,!0),this.setPosition(t,e,o),this.updateCage()},Bridge.prototype.setHitMesh=function(t,e,o){if(this.hitMeshes&&this.hitMeshes[0]){var i=this.hitMeshes[0];i.position.x=t,i.position.y=e,i.position.z=o,i.computeWorldMatrix()}},Bridge.prototype.updateBodyPositions=function(){if(this.body){var t=this.position;(e=this.body.position).x=t.x,e.y=t.y+this._bodyOffsetY+.04,e.z=t.z,this.body.syncShapes(),(e=this.bodySide1.position).x=t.x,e.y=t.y+this._bodyOffsetY+.04,e.z=t.z-.5*this.depth,this.bodySide1.syncShapes(),(e=this.bodySide2.position).x=t.x,e.y=t.y+this._bodyOffsetY+.04,e.z=t.z+.5*this.depth,this.bodySide2.syncShapes();var e,o=this.body.shapes.minY+t.y+.04;(e=this.bodyStepLeft.position).x=t.x-this.body.shapes.minX,e.y=o,e.z=t.z,this.bodyStepLeft.syncShapes(),this.shapeStepLeft&&this.shapeStepLeft.position.copyFrom(e),(e=this.bodyStepRight.position).x=t.x+this.body.shapes.minX,e.y=o,e.z=t.z,this.bodyStepRight.syncShapes()}},Bridge.prototype.setPositionDrag=function(t,e,o,i){var n=t-this.position.x,s=e-this.position.y,a=o-this.position.z;A.prototype.setPositionDrag.call(this,t,e,o,i),this.updateBodyPositions(),this.nodes&&this._translateNodes(n,s,a),this.shapeSide1.setPosition(t,e,o-.5*this.depth),this.shapeSide2.setPosition(t,e,o+.5*this.depth),this.setHitMesh(t,e,o),i&&this.updateCage(),this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position)},Bridge.prototype.updateCage=function(){var t=S.Cage.getCageAt(this.position.x,this.position.y+.3,this.position.z);this.addToObject(t)},Bridge.prototype.setPosition=function(t,e,o,i){if(void 0===i&&(i=!1),!this.isMenuItem||this.position.x!=t||this.position.y!=e||this.position.z!=o){var n=this.position.x,s=this.position.y,a=this.position.z,r=(this.position.x=t)-n,c=(this.position.y=e)-s,d=(this.position.z=o)-a;if(this.position.x=t,this.position.y=e,this.position.z=o,this.nodes&&this._translateNodes(r,c,d),this.setHitMesh(t,e+.02,o),this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position),this.shapeSide1.setPosition(t,e+.02,o-.5*this.depth),this.shapeSide2.setPosition(t,e+.02,o+.5*this.depth),this.leftNavigator){var p=.15+.02,l=.5*this.depth;this.leftNavigator.setPosition(t-this.radius-.1,e+p,o-l),this.rightNavigator.setPosition(t+this.radius+.1,e+p,o-l),this.leftNavigator2.setPosition(t-this.radius-.1,e+p,o+l),this.rightNavigator2.setPosition(t+this.radius+.1,e+p,o+l)}if(!i&&this.body){this.updateBodyPositions(),this.disconnect();var u=S.Cage.getCageAt(t,e+.3,o);u!=this.cage?(this.cage&&this.cage.removeObject(this),u&&this.addToObject(u)):(this.updateNodes(),this.checkConnections())}this._connected=!0,this.worldMatrix.setTranslation(this.position),this.worldMatrix.invertToRef(this.invWorldMatrix),this.onChangeObservable.notifyObservers(this)}},Bridge.prototype._translateNodes=function(t,e,o){for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i];n.x+=t,n.y+=e,n.z+=o}},Bridge.prototype.getGraphNodeAt=function(t,e,o,i,n,s,a,r){void 0===i&&(i=!1),void 0===n&&(n=null),void 0===s&&(s=0),void 0===a&&(a=null);for(var c,d,p=this.nodes,l=p.length,u=Number.MAX_VALUE,y=Bridge.tempVecs[0],g=0;g<l;g++){var m=(c=p[g]).x-t,f=c.y-e,A=c.z-o,b=m*m+f*f+A*A;if((!(c.data.isSideNode&&0<c.x-this.position.x)||this.sideNodesConnectedRight)&&((!(c.data.isSideNode&&c.x-this.position.x<0)||this.sideNodesConnectedLeft)&&b<u)){if(i&&0==c.type)continue;if(n)if(y.x=m,y.y=f,y.z=A,y.normalize(y),y.dot(n)<s)continue;u=b,d=c}}return d},Bridge.prototype.addToScene=function(){this.isOnScene||(A.prototype.addToScene.call(this),this.shapeSide1.addToScene(),this.shapeSide2.addToScene(),this.body&&!this.body.parent&&this.world.addRigidBody(this.body))},Bridge.prototype.removeFromScene=function(){this.isOnScene&&(A.prototype.removeFromScene.call(this),this.shapeSide1.removeFromScene(),this.shapeSide2.removeFromScene(),this.isMenuItem||this.setPositionDrag(this.position.x,9999,this.position.z,!1),this.body&&this.body.parent&&(this.body.shapes.updateProxy(),this.body.shapes.position.y=this.body.position.y,this.world.removeRigidBody(this.body)))},Bridge.prototype.recycle=function(){A.prototype.recycle.call(this)},Bridge.prototype.disconnect=function(){if(this.body){this.skipConnect=!0;for(var t=this.nodes,e=t.length,o=0;o<e;o++)for(var i=t[o],n=0;n<i.connections.length;n++){var s=i.connections[n];if((!s.data.obj||s.data.obj.acc1!=this)&&(s.data.obj!=i.data.obj||s.data.obj2!=i.data.obj2)){if(i.removeConnection(s),s.removeConnection(i),n--,s.data.obj2&&s.data.obj2.accType==S.z1044.z1049?s.data.obj2.removeObject(this):s.data.obj&&s.data.obj.removeHoleAt?s.data.obj.removeHoleAt(i.x,i.y,i.z):s.data.connector&&s.data.connector.parent&&s.data.connector.parent.removeHoleAt&&s.data.connector.parent.removeHoleAt(i.x,i.y,i.z),s.data.tube){var a=s.data.tube;a.initNode(s),a.checkGroundConnections()}s.data.obj2&&s.data.obj2.onAfterDisconnect&&s.data.obj2.onAfterDisconnect(this),s.data.obj&&s.data.obj.onAfterDisconnect&&s.data.obj.onAfterDisconnect(this)}}this.skipConnect=!1,this.sideNodesConnectedLeft=!1,this.sideNodesConnectedRight=!1}},Bridge.prototype.onAfterDisconnect=function(t){t.accType==S.z1044.z1049&&t.removeObject(this)},Bridge.prototype.setColor=function(t,e,o,i){this.shapeSide1.setColor(t,e,o),this.shapeSide2.setColor(t,e,o),A.prototype.setColor.call(this,t,e,o,i)},Bridge.prototype.getNeighborAt=function(t,e,o){for(var i,n=this.position.x,s=this.position.y+.5*this.height,a=this.position.z,r=this.nodes,c=t-n,d=e-s,p=0;p<r.length;p++){var l=r[p],u=l.x-n,y=l.y-s,g=l.z-a;if(!(.3<g||g<-.3)&&(!(c<0&&0<u)&&!(0<c&&u<0)&&!(d<0&&0<y)&&!(0<d&&y<0)&&(i=S.z1092.GetObjConnectedToNodeAt(l,t,e,o))))return i}},Bridge.prototype.getProps=function(){return A.prototype.getProps.call(this)},Bridge.prototype.isValidDropLocation=function(t,e,o){var i=this._tempDropLoc;this.getPositionOnMapFromDropToRef(t,e,o,i);var n=S.Cage.getCageAt(i.x,i.y+.3,i.z);if(!n)return!1;var s=n.getObjectAt(i.x,i.y,i.z,S.z1044.z1046,1);if(s){var a=.5*this.width+.2,r=1,c=.5*s.width,d=s.height,p=s.position,l=p.x+.5*c+a,u=p.x-.5*c-a,y=p.y+d+.5*r,g=p.y-.5*r,m=i.x,f=i.y;if(u<m&&m<l&&g<f&&f<y)return!1}var A=n.getObjectAt(i.x,i.y,i.z,S.z1044.z1051,1);if(A){r=this.height;var b=A.boxSize;y=(C=A.position).y+.5*b;if((g=C.y-.5*r-r)<(f=i.y)&&f<y)return!1}var v=n.getObjectAt(i.x,i.y,i.z,S.z1044.z1050,1);if(v){r=this.height,b=v.height,y=(C=v.position).y+b+.5*r;if((g=C.y-.5*r)<(f=i.y)&&f<y)return!1}var x=n.getObjectAt(i.x,i.y,i.z,S.z1044.SWING,1);if(x){var C;r=this.height,b=x.height,y=(C=x.position).y+b+.5*r;if((g=C.y-.5*r)<(f=i.y)&&f<y)return!1}return!0},Bridge.prototype.addToObject=function(t){this.cage&&this.cage!=t&&this.cage.removeObject(this),this.parent=t,(this.cage=t)&&(this.disconnect(),t.addObject(this),this.updateNodes(),this.checkConnections())},Bridge.prototype.isInBox=function(t,e,o,i){void 0===i&&(i=0);var n=this.position,s=.5*this.width+i,a=.5*this.depth+i,r=n.x-s,c=n.x+s,d=n.y-i,p=n.y+this.boxSize+i,l=n.z-a,u=n.z+a;return!(t<r||c<t||e<d||p<e||o<l||u<o)},Bridge.prototype.getPointSideY=function(t,e,o,i){void 0===e&&(e=0),void 0===o&&(o=0),void 0===i&&(i=0);var n=Bridge.z4[0];n.x=t.x-this.position.x,n.y=t.y-this.position.y,n.z=t.z-this.position.z,isNaN(n.x);var s=this.boxSize+.5*e,a=i,r=.5*(this.depth+o);return n.x<-s||n.x>s?0:n.z<-r||n.z>r?0:n.y>a&&n.x*n.x+n.y*n.y>this.radius*this.radius?1:-1},Bridge.prototype.checkConnections=function(){this.checkTubeConnections(),this.checkCageConnections(),this.checkPlatformConnections(),this.checkRampConnections(),this.checkWheelConnection()},Bridge.prototype.checkTubeConnections=function(){if(this.cage){var t=this._tempArray;t.length=0,S.Tube.getObjectsAt(this.position.x,this.position.y+.5*this.boxSize,this.position.z,2*this.boxSize+.5,this.boxSize+.5,this._tempArray);for(var e=0;e<t.length;e++){var o=t[e];if(!o.skipConnect){var i=o.getGraphNodeAtClosestToOpening(this.position.x,this.position.y,this.position.z);if(1<i.connections.length){var n=i.connections[1];(n.data.obj2||n.data.obj).accType!=S.z1044.z1051&&(n.removeConnection(i),i.removeConnection(n))}o.checkGroundConnections()}}}},Bridge.prototype.checkCageConnectorConnections=function(){for(var t=this.cage.connectors,e=0;e<t.length;e++){var o=t[e];if(o.cage1==this.cage||o.cage2==this.cage){if(.5<Math.abs(o.position.x-this.leftGraphNode.x)&&.5<Math.abs(o.position.x-this.rightGraphNode.x))continue;if(o.position.y-this.position.y<0)continue;if(1<o.position.y-this.position.y)continue;t[e].refreshConnections()}}},Bridge.prototype.checkRightSideConnections=function(t,e){void 0===e&&(e=S.z1044.z1048|S.z1044.z1047);var o=!1,i=Bridge.z4[0];i.x=1,i.y=0,i.z=0;var n=this.nodes[6];i.x=0,i.y=0,i.z=1;var s=t.getGraphNodeAt(n.x,n.y,n.z,null,null,null,null,e);if(s&&-.1<s.y-this.position.y){var a=.5*Math.sqrt(z1.distanceSquared(n,s));s.addConnection(n,a),n.addConnection(s,a),o=this.sideNodesConnectedRight=!0}n=this.nodes[8];if((i.x=0,i.y=0,i.z=-1,s=t.getGraphNodeAt(n.x,n.y,n.z,null,null,null,null,e))&&-.1<s.y-this.position.y){a=.5*Math.sqrt(z1.distanceSquared(n,s));s.addConnection(n,a),n.addConnection(s,a),o=this.sideNodesConnectedRight=!0}return o},Bridge.prototype.checkLeftSideConnections=function(t,e){void 0===e&&(e=S.z1044.z1048|S.z1044.z1047);var o=!1,i=Bridge.z4[0];i.x=1,i.y=0,i.z=0;var n=this.nodes[10];i.x=0,i.y=0,i.z=1;var s=t.getGraphNodeAt(n.x,n.y,n.z,null,null,null,null,e);if(s&&-.1<s.y-this.position.y){var a=.5*Math.sqrt(z1.distanceSquared(n,s));s.addConnection(n,a),n.addConnection(s,a),o=this.sideNodesConnectedLeft=!0}n=this.nodes[12];if((i.x=0,i.y=0,i.z=-1,s=t.getGraphNodeAt(n.x,n.y,n.z,null,null,null,null,e))&&-.1<s.y-this.position.y){a=.5*Math.sqrt(z1.distanceSquared(n,s));s.addConnection(n,a),n.addConnection(s,a),o=this.sideNodesConnectedLeft=!0}return o},Bridge.prototype.checkBeddingConnections=function(){this.checkCageConnections(S.z1044.z1047)},Bridge.prototype.checkCageConnections=function(t){if(void 0===t&&(t=S.z1044.z1048|S.z1044.z1047),this.cage){this.checkCageConnectorConnections();var e=this.cage.position.y;.3<this.position.y-e&&(t=S.z1044.z1047);var o=this.rightGraphNode,i=Bridge.z4[0];i.x=1,i.y=0,i.z=0;var n=Bridge.tempArray;if(n.length=0,this.cage.getGraphNodesAtToRef(n,o.x,o.y,o.z,null,i,0,0,1.2,t),0<n.length)for(var s=0;s<n.length;s++){if(-.1<(r=n[s]).y-this.position.y){var a=Math.sqrt(z1.distanceSquared(o,r));r.addConnection(o,a),o.addConnection(r,a)}}else this.checkRightSideConnections(this.cage,t);o=this.leftGraphNode;if(i.x=-1,i.y=0,i.z=0,n.length=0,this.cage.getGraphNodesAtToRef(n,o.x,o.y,o.z,null,i,0,0,1.2,t),0<n.length)for(s=0;s<n.length;s++){var r;if(-.1<(r=n[s]).y-this.position.y){a=Math.sqrt(z1.distanceSquared(o,r));r.addConnection(o,a),o.addConnection(r,a)}}else this.checkLeftSideConnections(this.cage,t)}},Bridge.prototype.checkPlatformConnections=function(){if(this.cage)for(var t=this.cage.objs,e=this.position,o=(e.x,this.width,e.x,this.width,0);o<t.length;o++){var i=t[o];if(!i.skipConnect&&i.accType==S.z1044.z1049){var n=i.position,s=e.y-n.y;.15<s||s<-.15||this.checkPlatformConnection(i)&&i.addObject(this)}}},Bridge.prototype.checkWheelConnection=function(){if(this.cage)for(var t=this.cage.objs,e=0;e<t.length;e++)if(t[e].accType==S.z1044.z1054){var o=t[e],i=o.position.y-this.position.y;if(.3<i||i<-.3)return;var n=this.nodes[6],s=this.nodes[10],a=o.nodes[1],r=Math.sqrt(z1.distanceSquared(a,n));a.addConnection(n,r),n.addConnection(a,r);r=Math.sqrt(z1.distanceSquared(a,s));a.addConnection(s,r),s.addConnection(a,r)}},Bridge.prototype.checkRampConnections=function(){if(this.cage)for(var t=this.cage.objs,e=0;e<t.length;e++)t[e].accType==S.z1044.z1046&&this.checkRampConnection(t[e])},Bridge.prototype.checkRampConnection=function(t){if(!t.skipConnect&&!t.platformAbove){var e=t.position.x-this.position.x,o=t.position.y-this.position.y,i=this.nodes[this.nodes.length-2];this.nodes[this.nodes.length-1];i=this.rightGraphNode;var n=9,s=this.leftGraphNode,a=t.lowNode;0<e&&(s=i,n=5),o<0&&(a=t.highNode);var r=a.x-s.x,c=a.y-s.y,d=a.z-s.z;if(!(.5<c||c<-.5||.4<r||r<-.4)){for(var p=0;p<a.connections.length;p++){var l=a.connections[p];if(l.data.obj2&&l.data.obj2.accType==S.z1044.z1049){l.removeConnection(a),a.removeConnection(l);break}}var u=Math.sqrt(r*r+c*c+d*d);a.addConnection(s,.01*u),s.addConnection(a,.01*u),a.y<t.position.y?t._bridgeConnectedLow=this:t._bridgeConnectedHigh=this,s.x,this.position.x;s=this.nodes[n],u=.1*Math.sqrt(r*r+c*c+d*d);a.addConnection(s,u),s.addConnection(a,u),s=this.nodes[n+2];u=.1*Math.sqrt(r*r+c*c+d*d);return a.addConnection(s,u),s.addConnection(a,u),a}}},Bridge.prototype.checkPlatformConnection=function(t){if(t.skipConnect)return!1;var e=this.nodes,o=Bridge.z4[0],i=Bridge.z4[1];if(o.y=0,o.z=0,.15<(p=this.position.y-t.position.y)||p<-.15)return!1;for(var n=0,s=0;s<5;s+=4){var a=e[s];o.x=a.x-this.position.x,o.normalize();for(var r=0;r<t.nodes.length;r++){var c=t.nodes[r];if(c){var d=c.x-a.x,p=c.y-a.y,l=c.z-a.z,u=d*d;if(u<.4*.4)if(i.x=d,i.y=p,i.z=l,i.normalize(),0<BABYLON.Vector3.Dot(o,i)){var y=Math.sqrt(u);a.addConnection(c,y),c.addConnection(a,y),n++}}}}if(!n){var g=t.position.x+.5*t.width,m=t.position.x-.5*t.width;this.position.x<g&&this.checkRightSideConnections(t)&&n++,this.position.x>m&&this.checkLeftSideConnections(t)&&n++}return!!n},Bridge.getObjectsAt=function(t,e,o,i,n,s,a){var r,c=Bridge.activeObjects;a&&(c=a);for(var d=c.length,p=t-.5*i,l=t+.5*i,u=e-.5*n,y=e+.5*n,g=0;g<d;g++){var m=(r=c[g]).position.x-.5*r.width,f=r.position.x+.5*r.width,A=r.position.y,b=r.position.y;f<=p||l<=m||y<=b||A<=u||s.push(r)}},Bridge.tempVecs=[new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3],Bridge.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],Bridge.count=0,Bridge.activeObjects=[],Bridge.tempArray=[],Bridge}(S.z1092);S.Bridge=t}(z0||(z0={})),function(e){var t=function(){function BridgeConfig(){this.maxObjects=4,this.objName="br",e.Bridge.objectCount=this.maxObjects}return BridgeConfig.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,e.Bridge,{shapeName:this.objName,world:t,width:1})},BridgeConfig.prototype.getSceneFileNames=function(t){},BridgeConfig.prototype.getCreateMeshFunctions=function(t){t.BridgeMenuButton=this._createMeshes},BridgeConfig.prototype._createMeshes=function(t,e){var o=BABYLON.MeshBuilder.CreatePlane("BridgeMenuButton",{width:1.7,height:1.4},t);t.removeMesh(o),o.position.y=.4,o.bakeCurrentTransformIntoVertices(),e.BridgeMenuButton=o},BridgeConfig.prototype.getChildSPSData=function(t){t[this.objName]||(t[this.objName]={}),t[this.objName].BridgeSide1=2},BridgeConfig.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"bridge_bottom_4_1",numInstances:this.maxObjects,maxInstances:this.maxObjects}),t.push({shapeName:this.objName,meshName:"bridge_side_4",numInstances:this.maxObjects,maxInstances:this.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:"BridgeSide1",meshName:"bridge_side_4",numInstances:2*this.maxObjects,maxInstances:2*this.maxObjects,applyMaterialToSPS:"accMat",computeTextures:!0}),t.push({shapeName:this.objName,meshName:"bridge_bottom_4_1",numInstances:1,maxInstances:1,renderingGroupID:e.App.menuRenderingGroupID}),t.push({shapeName:"BridgeSide1",meshName:"bridge_side_4",numInstances:2,maxInstances:2,renderingGroupID:e.App.menuRenderingGroupID,applyMaterialToSPS:"accMat",computeTextures:!0}),t.push({shapeName:this.objName,meshName:"BridgeMenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:e.App.menuRenderingGroupID})},BridgeConfig.prototype.getTextureDrawFunctions=function(t){t.bridgeRainbowTexture=function(t,e,o){t.fillStyle="White",t.fillRect(0,0,e,o);var i=["rgba(255,0,0,.6)","rgba(255,127,0,.6)","rgba(255,255,0,.6)","rgba(0,255,0,.6)","rgba(0,0,255,.6)","rgba(75,0,130,.6)","rgba(148,0,211,.6)"],n=Math.round(.48*e);t.lineWidth=Math.round(e/39);for(var s=0;s<i.length;s++,n-=t.lineWidth-1)t.beginPath(),t.arc(.5*e,e,n,0,Math.PI,!0),t.strokeStyle=i[s],t.stroke()}},BridgeConfig.prototype.getz1064Items=function(t){t.push(new e.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Bridges",order:0,menuWidth:1.5,offsetY:-.4}))},BridgeConfig.prototype.getz49s=function(t){t.push(e.z19)},BridgeConfig.prototype.getListenerSetups=function(t){t.push({event:e.BridgeEvents.USE,state:e.z19})},BridgeConfig}();e.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(){function BridgeEvents(){}return BridgeEvents.USE=t.AppEvents.GetUniqueID(),BridgeEvents}();t.BridgeEvents=e}(z0||(z0={})),function(M){var t=function(e){function BridgeNavigator(){var t=null!==e&&e.apply(this,arguments)||this;return t.localPosition=BABYLON.Vector3.Zero(),t.pivotRadius=0,t.BR_Pivot_Radius=.2,t.BR_Pivot_Area=.5*Math.PI,t._enabled=!0,t.updated=new z1072Set,t}return __extends(BridgeNavigator,e),BridgeNavigator.prototype.init=function(t){this.accessory=t.accessory;var e=this.accessory,o=e.shapeName+e.num;if(!this.triggerArea){this.world=e.world;var i=[.03,.01,1,M.App.PhysicsGroupTriggerArea,M.App.z1034],n=t.radius;this.pivotRadius=.5*e.depth,this.triggerArea=new OIMO.Body({type:"sphere",size:[n,n,n],pos:[0,0,0],rot:[0,0,0],move:!1,world:this.world,name:o+"_BridgeBumper1",config:i}).body,this.triggerArea.shapes.pubsub=this.pubsub,this.triggerArea.shapes.disablePhysics=!0;this.localPosition.x=0,this.localPosition.y=0,this.localPosition.z=0,this.pubsub.subscribe("hit",this.onTrigger.bind(this))}},BridgeNavigator.prototype.setPosition=function(t,e,o){this.accessory;var i=this.localPosition;this.triggerArea.position.x=t+i.x,this.triggerArea.position.y=e+i.y,this.triggerArea.position.z=o+i.z,this.triggerArea.syncShapes(),this.triggerAreaMesh&&(this.triggerAreaMesh.position.x=this.triggerArea.position.x,this.triggerAreaMesh.position.y=this.triggerArea.position.y,this.triggerAreaMesh.position.z=this.triggerArea.position.z,this.triggerAreaMesh.isPickable=!1)},BridgeNavigator.prototype.enable=function(){this._enabled||(this.world.addRigidBody(this.triggerArea),this._enabled=!0)},BridgeNavigator.prototype.disable=function(){this._enabled&&(this.triggerArea.position.y=9999,this.triggerArea.syncShapes(),this.world.removeRigidBody(this.triggerArea),this._enabled=!1)},BridgeNavigator.prototype.onTrigger=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=this.accessory,i=t[8].actor.rodent;t[8].parent.name,t[7];if(this.updated.push(i,i.id,M.app.frameNum)&&(i.usingObject!=this.accessory&&!i.isInState(M.z90.name)&&!i.isInState(M.z130.name)&&(i.isInState(M.z15.name),i.isInState(M.z31.name),o.parent))){var n=i.physics.frontBody.body.position,s=i.targets.pathTarget,a=BridgeNavigator.z4[0];s||(s=i.targets.destTarget);var r=i.path[i.pathIndex];i.path[i.pathIndex+1];if(a.x=this.position.x,a.y=this.position.y,a.z=this.position.z,o.getPointSideY(s)<0&&i.path[i.pathIndex]&&!i.path[i.pathIndex].data.enterEvent&&i.path[i.pathIndex+1]&&!i.path[i.pathIndex+1].data.enterEvent)return i.incrementPathIndex(),void i.pathIndex;n.x,this.position.x,n.y,this.position.y,n.z,this.position.z,n.x,a.x,n.y,a.y;var c=n.z-a.z,d=(o.body.rotation.elements,BridgeNavigator.z4[1]);d.x=s.x-a.x,d.y=0,d.z=s.z-a.z;var p=BridgeNavigator.z4[2];p.x=s.x-n.x,p.y=0,p.z=s.z-n.z;var l=BridgeNavigator.z4[3];if(l.x=a.x-n.x,l.y=0,l.z=a.z-n.z,c>.5*o.depth+.5*i.size&&d.z>.5*o.depth)i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null);else if(c<-(.5*o.depth+.5*i.size)&&d.z<.5*-o.depth)i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null);else{var u=p.lengthSquared(),y=l.lengthSquared();p.normalize(),l.normalize();var g=BridgeNavigator.z4[4];l.scaleToRef(-1,g);var m=BridgeNavigator.z4[5];if(r&&r.data.obj2==o&&(m.y=0,m.z=0,m.x=1,this.position.x<o.position.x&&(m.x=-1),.7<BABYLON.Vector3.Dot(g,m)))i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null);else if(BABYLON.Vector3.Dot(p,l)<0)i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null);else if(u<=y)i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null);else{i.pivotRadius=.6,i.pivotRadiusMax=i.pivotRadius,i.pivotRadius=this.BR_Pivot_Radius,i.pivotRadiusMax=this.BR_Pivot_Radius,i.pivotPoint.x=a.x,i.pivotPoint.y=a.y,i.pivotPoint.z=a.z;var f=BridgeNavigator.z4[6];f.x=-p.z,f.z=p.x;var A=f.x+n.x,b=f.z+n.z,v=A-a.x,x=b-a.z,C=v*v+x*x,S=-f.x+n.x,T=-f.z+n.z,B=S-a.x,O=T-a.z,P=B*B+O*O;i.pivotMoveDir=P<C?1:-1,i.pivotArea=1*Math.PI,i.pivotArea=this.BR_Pivot_Area,i.pivotAreaDir.x=p.x,i.pivotAreaDir.y=p.y,i.pivotAreaDir.z=p.z,i.pivotUpdateLook=y<.09,i.pivotUpdateLook=!1,i.currentz1091=this}}}},BridgeNavigator}(M.z1091);M.BridgeNavigator=t}(z0||(z0={})),function(l){var t,e;t=l.z156||(l.z156={}),e=function(t){function z715(){return null!==t&&t.apply(this,arguments)||this}return __extends(z715,t),z715.prototype.update=function(t){var e=t.targets,o=e.pathTarget;t.path.length,t.pathIndex;t.path[t.pathIndex],t.path[t.pathIndex+1],t.path[t.pathIndex+2];var i=t.usingObject;if(i&&i.accType==l.z1044.z1050&&0<t.path2.length&&t.path2Index<t.path2.length){var n=t.physics.frontBody.body,s=e.pathNodeHitDist,a=s*s,r=n.position,c=t.path[t.pathIndex].x-r.x,d=t.path[t.pathIndex].y-r.y,p=t.path[t.pathIndex].z-r.z;c*c+d*d+p*p<a&&(t.path2Index+=3,t.pathIndex=Math.floor(t.path2Index/3)-1,t.pubsub.broadcast(l.z1061Events.NEW_PATH_NODE),t.path2Index>=t.path2.length&&t.targets.setTargetsToDestination()),t.path2Index<t.path2.length?o.copyFrom(t.path[t.pathIndex]):t.path2Index>=t.path2.length&&o.copyFrom(t.targets.destTarget)}},z715}(z767),t.z715=e}(z0||(z0={})),function(b){var t,e;t=b.z156||(b.z156={}),e=function(t){function z706(){return null!==t&&t.apply(this,arguments)||this}return __extends(z706,t),z706.prototype.update=function(t){if(t.avoidingOther=null,t.physics.collisionOtherFrac.targetValue=.5,!(t.pathIndex>=t.path.length)){var e=t.getClosestz1061(0);if(e&&t.usingObject&&t.usingObject.accType==b.z1044.z1050){var o=t.targets.targetDir,i=e.targets.targetDir,n=(BABYLON.Vector3.Dot(o,i),t.physics.middleBody.body.position),s=e.physics.middleBody.body.position,a=(m=n.x-s.x)*m+(f=n.y-s.y)*f+(A=n.z-s.z)*A,r=(n=t.physics.frontBody.body.position,s=e.physics.middleBody.body.position,(m=n.x-s.x)*m+(f=n.y-s.y)*f+(A=n.z-s.z)*A),c=(n=t.physics.rearBody.body.position,s=e.physics.middleBody.body.position,(m=n.x-s.x)*m+(f=n.y-s.y)*f+(A=n.z-s.z)*A),d=3*t.size,p=!1,l=!1,u=!1;if(r<d*d&&(p=!0),c<(d=3*t.size)*d&&(l=!0),a<(d=3*t.size)*d&&(u=!0),(p||l||u)&&(t.position.z>e.position.z&&(t.physics.collisionOtherFrac.targetValue=.4),t.avoidingOther=e),t.avoidingOther&&r<d){var y=e.physics.headBody.body.position,g=t.physics.headBody.body.position,m=g.x-y.x,f=g.y-y.y,A=g.z-y.z;g.z-y.z<0?t.targets.lookToTargetOffset.z=-t.size:t.targets.lookToTargetOffset.z=t.size}}}},z706}(z767),t.z706=e}(z0||(z0={})),function(c){var t,e;t=c.z156||(c.z156={}),e=function(t){function z625(){return null!==t&&t.apply(this,arguments)||this}return __extends(z625,t),z625.prototype.update=function(t){if(!t.isTouchingGround()){var e=t.usingObject;if(e&&e.accType==c.z1044.z1050){var o=t.physics.frontBody.body.position,i=t.path[t.pathIndex];if(i&&!(o.y>i.y)){var n=(i=o.x<e.position.x?e.leftGraphNode:e.rightGraphNode).x-o.x,s=i.y-o.y,a=i.z-o.z,r=n*n+a*a+s*s;e.depth,t.size;r<.25&&t.forceTouchGround()}}}},z625}(z767),t.z625=e}(z0||(z0={})),function(d){var t,e;t=d.z156||(d.z156={}),e=function(t){function z623(){return null!==t&&t.apply(this,arguments)||this}return __extends(z623,t),z623.prototype.update=function(t){if(!t.isTouchingGround()){var e=t.usingObject;if(e&&e.accType==d.z1044.z1050){var o=t.physics.frontBody.body.position,i=t.path[t.pathIndex];if(i&&!(o.y>i.y)){var n=(i=o.x<e.position.x?e.leftGraphNode:e.rightGraphNode).x-o.x,s=i.y-o.y,a=i.z-o.z,r=n*n+a*a+s*s,c=.5*e.depth-.5*t.size;a<-c||c<a||r<.09&&t.forceTouchGround()}}}},z623}(z767),t.z623=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z453(){return null!==t&&t.apply(this,arguments)||this}return __extends(z453,t),z453.prototype.update=function(t){if(t.standing){var e=t.targets.upVecTarget,o=z767.tempVecs[1];o.x=0,o.y=1,o.z=0;var i=z767.tempVecs[2];i.x=0,i.y=0,i.z=1;var n=t.physics.rearBody.body.rotation.elements,s=n[2],a=n[8],r=-Math.atan2(s,a)/(.5*Math.PI),c=Math.atan2(e.x,e.y);t.bones.hip.pitch.targetValue=Math.min(c*r,0)}},z453}(z767),e.z453=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z368(){var t=null!==e&&e.apply(this,arguments)||this;return t.maxStrength=70,t.uprightAng=2.5,t}return __extends(z368,e),z368.prototype.update=function(t){t.focusDist,e.prototype.update.call(this,t)},z368}(e.z369),e.z368=o}(z0||(z0={})),function(s){var t,e;t=s.z156||(s.z156={}),e=function(t){function z337(){return null!==t&&t.apply(this,arguments)||this}return __extends(z337,t),z337.prototype.update=function(t){var e=t.targets.pathTarget,o=t.usingObject;if(o&&o.accType==s.z1044.z1050&&t.path[t.pathIndex]){var i=t.path[t.pathIndex+1];if(i){var n=i.data.obj2||i.data.obj;if((n.accType==s.z1044.z1051||n.accType==s.z1044.z1052)&&n.position.y<o.position.y)return}t.path[t.pathIndex].data.obj!=o&&e.y<o.leftGraphNode.y&&(e.y=o.leftGraphNode.y,t.targets.setTargetsToPathTarget())}},z337}(z767),t.z337=e}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z330(){return null!==t&&t.apply(this,arguments)||this}return __extends(z330,t),z330.prototype.update=function(t){var e=t.usingObject;e&&e.accType==o.z1044.z1050&&(t.targets.moveToTarget.x=e.position.x,t.targets.moveToTarget.y=e.position.y+e.radius+1.5*t.size,t.targets.moveToTarget.z=e.position.z)},z330}(z767),t.z330=e}(z0||(z0={})),function(a){var t,e;t=a.z156||(a.z156={}),e=function(t){function z295(){return null!==t&&t.apply(this,arguments)||this}return __extends(z295,t),z295.prototype.update=function(t){var e=t.physics.rearBody,o=e.body.position;if(e.target.copyFrom(o),t.cage){var i=t.usingObject;if(i&&i.accType==a.z1044.z1050){var n=t.physics.rearBody.target,s=i.position;n.x=s.x,n.y=s.y+i.radius+t.size}}},z295}(z767),t.z295=e}(z0||(z0={})),function(c){var t,e;t=c.z156||(c.z156={}),e=function(t){function z253(){return null!==t&&t.apply(this,arguments)||this}return __extends(z253,t),z253.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==c.z1044.z1050){var o=t.path[t.pathIndex],i=t.targets.pathTarget,n=t.physics.frontBody.body.position,s=e.cage,a=s.position.x-.5*s.width,r=s.position.x+.5*s.width;o.x,o.x;if(o.data.enterEvent){n=t.physics.frontBody.body.position;1==e.getPointSideY(n,1)&&(o=t.path[t.pathIndex+1],t.path[t.pathIndex+2]&&(o=t.path[t.pathIndex+2]))}i.x=o.x,i.y=o.y+0,i.z=e.position.z,t.targets.setTargetsToPathTarget(),t.targets.moveToTarget.y+=.2}},z253}(z767),t.z253=e}(z0||(z0={})),function(c){var t,e;t=c.z156||(c.z156={}),e=function(t){function z251(){return null!==t&&t.apply(this,arguments)||this}return __extends(z251,t),z251.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==c.z1044.z1050){var o=t.path[t.pathIndex],i=t.targets.pathTarget,n=t.physics.frontBody.body.position,s=e.cage,a=s.position.x-.5*s.width,r=s.position.x+.5*s.width;o.x,o.x;if(o.data.enterEvent){n=t.physics.frontBody.body.position;0==e.getPointSideY(n,1,t.size)&&(o=t.path[t.pathIndex+1],t.path[t.pathIndex+2]&&(o=t.path[t.pathIndex+2]))}i.x=o.x,i.y=o.y+0,i.z=o.z+0,t.targets.setTargetsToPathTarget(),t.targets.moveToTarget.y+=.2}},z251}(z767),t.z251=e}(z0||(z0={})),function(d){var t,e;t=d.z156||(d.z156={}),e=function(t){function z249(){return null!==t&&t.apply(this,arguments)||this}return __extends(z249,t),z249.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==d.z1044.z1050){var o=t.path[t.pathIndex],i=t.path[t.pathIndex+2],n=t.targets.pathTarget,s=t.physics.frontBody.body.position,a=e.cage;if(a){var r=a.position.x-.5*a.width,c=a.position.x+.5*a.width;o.x,o.x;if(o.data.enterEvent){s=t.physics.frontBody.body.position;1==e.getPointSideY(s,1,2*-t.size)&&(o=t.path[t.pathIndex+1],n.x=o.x,n.y=o.y+0,n.z=o.z+0)}n.x=o.x,n.y=o.y+0,n.z=o.z+0,t.targets.setTargetsToPathTarget(),Math.abs(s.x-e.position.x)<e.radius&&i&&(t.targets.lookToTarget.x=i.x,t.targets.lookToTarget.y=i.y,t.targets.lookToTarget.z=i.z)}}},z249}(z767),t.z249=e}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z229(){return null!==t&&t.apply(this,arguments)||this}return __extends(z229,t),z229.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==n.z1044.z1050){var o=t.physics.middleBody.body.position,i=e.position;t.targets.upVecTarget.x=o.x-i.x,t.targets.upVecTarget.y=o.y-i.y,t.targets.upVecTarget.z=o.z-i.z,t.targets.upVecTarget.normalize(t.targets.upVecTarget)}},z229}(z767),t.z229=e}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z218(){return null!==t&&t.apply(this,arguments)||this}return __extends(z218,t),z218.prototype.update=function(t){if((!t.usingObject||t.usingObject.accType!=n.z1044.z1050)&&t.physics.touchingAccTypes&n.z1044.z1050){for(var e,o=0;o<t.physics.touchingShapes.length;o++){var i=t.physics.touchingShapes.data.data[o];i.entity&&i.entity.accType==n.z1044.z1050&&(e=i.entity,0)}e&&(t.usingObject=e)}},z218}(z767),t.z218=e}(z0||(z0={})),function(s){var t,e;t=s.z768||(s.z768={}),e=function(t){function z899(){return null!==t&&t.apply(this,arguments)||this}return __extends(z899,t),z899.prototype.test=function(t){var e=t.usingObject;if(!e||e.accType!=s.z1044.z1050)return!0;var o=t.physics.frontBody.body.position;if(1!=e.getPointSideY(o,1.5))return!0;var i=e.radius+1.5*t.size,n=o.x-e.position.x;return!(-i<n&&n<i)},z899}(z770),t.z899=e}(z0||(z0={})),function(s){var t,e;t=s.z768||(s.z768={}),e=function(t){function z896(){return null!==t&&t.apply(this,arguments)||this}return __extends(z896,t),z896.prototype.test=function(t){var e=t.usingObject;if(!e||e.accType!=s.z1044.z1050)return!1;var o=t.physics.frontBody.body.position;if(1!=e.getPointSideY(o,1.5,-t.size))return!1;var i=e.radius+0*t.size,n=o.x-e.position.x;return-i<n&&n<i},z896}(z770),t.z896=e}(z0||(z0={})),function(s){var t,e;t=s.z768||(s.z768={}),e=function(t){function z885(){return null!==t&&t.apply(this,arguments)||this}return __extends(z885,t),z885.prototype.test=function(t){var e=t.usingObject;if(!e||e.accType!=s.z1044.z1050)return!1;var o=t.physics.frontBody.body.position,i=.5*e.depth-.5*t.size,n=o.z-e.position.z;return-i<n&&n<i},z885}(z770),t.z885=e}(z0||(z0={})),function(s){var t,e;t=s.z768||(s.z768={}),e=function(t){function z884(){return null!==t&&t.apply(this,arguments)||this}return __extends(z884,t),z884.prototype.test=function(t){var e=t.usingObject;if(!e||e.accType!=s.z1044.z1050)return!1;var o=t.physics.frontBody.body.position,i=.5*e.depth+t.size,n=o.z-e.position.z;return!(-i<n&&n<i)},z884}(z770),t.z884=e}(z0||(z0={})),function(i){var t,e;t=i.z768||(i.z768={}),e=function(t){function z881(){return null!==t&&t.apply(this,arguments)||this}return __extends(z881,t),z881.prototype.test=function(t){var e=t.path[t.pathIndex];if(e){var o=e.data.obj2;if(o&&o.accType==i.z1044.z1050)return!0}return!1},z881}(z770),t.z881=e}(z0||(z0={})),function(n){var t,e;t=n.z768||(n.z768={}),e=function(t){function z879(){return null!==t&&t.apply(this,arguments)||this}return __extends(z879,t),z879.prototype.test=function(t){var e=t.path[t.pathIndex];if(e){var o=e.data.obj2;if(o&&o.accType==n.z1044.z1050){var i=e.z-o.position.z;if(i<.5*o.depth&&i>.5*-o.depth)return!0}}return!1},z879}(z770),t.z879=e}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z837(){return null!==t&&t.apply(this,arguments)||this}return __extends(z837,t),z837.prototype.test=function(t){return!(!t.usingObject||t.usingObject.accType!=e.z1044.z1050)},z837}(z770),t.z837=o}(z0||(z0={})),function(r){var t,e;t=r.z768||(r.z768={}),e=function(t){function z810(){return null!==t&&t.apply(this,arguments)||this}return __extends(z810,t),z810.prototype.test=function(t){var e=t.usingObject;if(!e||e.accType!=r.z1044.z1050)return!0;var o=t.path[t.pathIndex],i=t.path[t.pathIndex+1];if(!o)return!0;if(!o.data.obj2)return!0;if(o.data.obj2.accType!=r.z1044.z1050)return!0;if(!i)return!0;if(!i.data.obj2)return!0;if(i.data.obj2.accType!=r.z1044.z1050)return!0;var n=t.physics.frontBody.body.position;n.y,e.position.y;var s=n.x-e.position.x,a=e.radius+t.size;if(s<a&&-a<s&&e.getPointSideY(n,0,0)<1)return!0;return!1},z810}(z770),t.z810=e}(z0||(z0={})),function(i){var t,e;t=i.z768||(i.z768={}),e=function(t){function z801(){return null!==t&&t.apply(this,arguments)||this}return __extends(z801,t),z801.prototype.test=function(t){var e=t.usingObject;if(!e||e.accType!=i.z1044.z1050)return!0;var o=t.path[t.pathIndex];return o?!o.data.obj2||o.data.obj2.accType!=i.z1044.z1050:!(0<e.getPointSideY(t.targets.moveToTarget))},z801}(z770),t.z801=e}(z0||(z0={})),function(n){var t,e;t=n.z768||(n.z768={}),e=function(t){function z798(){return null!==t&&t.apply(this,arguments)||this}return __extends(z798,t),z798.prototype.test=function(t){var e=t.path[t.pathIndex],o=t.path[t.pathIndex+1];if(!e)return!1;if(!o)return!1;if(e.data.obj2&&e.data.obj2.accType==n.z1044.z1050&&o.data.obj2&&e.data.obj2.accType==n.z1044.z1050){var i=o.data.obj2;if(e.data.enterEvent==n.BridgeEvents.USE&&e.data.enterNextNode==o){if(e.z>i.position.z&&o.z>i.position.z&&o.z<e.z)return!0;if(e.z<i.position.z&&o.z<i.position.z&&o.z>e.z)return!0}}return!1},z798}(z770),t.z798=e}(z0||(z0={})),function(n){var t,e;t=n.z768||(n.z768={}),e=function(t){function z796(){return null!==t&&t.apply(this,arguments)||this}return __extends(z796,t),z796.prototype.test=function(t){var e=t.path[t.pathIndex],o=t.path[t.pathIndex+1];if(!e)return!1;if(!o)return!1;if(e.data.obj2&&e.data.obj2.accType==n.z1044.z1050&&o.data.obj2&&e.data.obj2.accType==n.z1044.z1050){var i=o.data.obj2;if(e.data.enterEvent==n.BridgeEvents.USE&&e.data.enterNextNode==o){if(e.z>i.position.z&&o.z>i.position.z&&o.z>e.z)return!0;if(e.z<i.position.z&&o.z<i.position.z&&o.z<e.z)return!0}}return!1},z796}(z770),t.z796=e}(z0||(z0={})),function(o){var t=function(e){function z44(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z258,o.z156.z400,o.z156.z483,o.z156.z272,o.z156.z382,o.z156.z501,o.z156.z720,o.z156.z726],t.updatez156=[o.z156.z724,o.z156.z295,o.z156.z330,o.z156.z382,o.z156.z495,o.z156.z483,o.z156.z536,o.z156.z542,o.z156.z386,o.z156.z393,o.z156.z581,o.z156.z209,o.z156.z455,o.z156.z532,o.z156.z327,o.z156.z265],t.transitions=[{condition:o.z768.z982,falseNode:{state:o.z37}},{condition:o.z768.z976,trueNode:{state:o.z112}},{condition:o.z768.z1014,trueNode:{condition:o.z768.z1015,trueNode:{state:o.z112}}}],t.exitz156=[o.z156.z502],t}return __extends(z44,e),z44}(z49);o.z44=t}(z0||(z0={})),function(o){var t=function(e){function z138(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.enterz156=[],t.updatez156=[o.z156.z218,o.z156.z687,o.z156.z229,o.z156.z453,o.z156.z461,o.z156.z446,o.z156.z590,o.z156.z214,o.z156.z368,o.z156.z564,o.z156.z362],t.exitz156=[],t.states=[],t.transitions=[{condition:o.z768.z899,trueNode:{state:o.z108,level:1,actions:[]}},{condition:o.z768.z943,trueNode:{state:o.z15,actions:[]}}],t}return __extends(z138,e),z138}(z49);o.z138=t}(z0||(z0={})),function(o){var t=function(e){function z130(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.enterz156=[o.z156.z220],t.updatez156=[o.z156.z253,o.z156.z599,o.z156.z625,o.z156.z461,o.z156.z446,o.z156.z590,o.z156.z214,o.z156.z369],t.exitz156=[],t.states=[],t.transitions=[{condition:o.z768.z885,trueNode:{state:o.z66,level:1,actions:[o.z156.z554,o.z156.z554]}}],t}return __extends(z130,e),z130}(z49);o.z130=t}(z0||(z0={})),function(o){var t=function(e){function z129(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.enterz156=[o.z156.z220],t.updatez156=[o.z156.z251,o.z156.z625,o.z156.z599,o.z156.z461,o.z156.z446,o.z156.z590,o.z156.z214,o.z156.z369],t.exitz156=[],t.states=[],t.transitions=[{condition:o.z768.z884,trueNode:{state:o.z66,level:1,actions:[o.z156.z554,o.z156.z554]}},{condition:o.z768.z879,trueNode:{state:o.z115}}],t}return __extends(z129,e),z129}(z49);o.z129=t}(z0||(z0={})),function(o){var t=function(e){function z115(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.enterz156=[o.z156.z220,o.z156.z406],t.updatez156=[o.z156.z249,o.z156.z616,o.z156.z599,o.z156.z623,o.z156.z461,o.z156.z446,o.z156.z590,o.z156.z214,o.z156.z368],t.exitz156=[],t.states=[],t.transitions=[{condition:o.z768.z896,trueNode:{state:o.z15,actions:[]}},{condition:o.z768.z810,trueNode:{state:o.z108,level:1,actions:[]}}],t}return __extends(z115,e),z115}(z49);o.z115=t}(z0||(z0={})),function(o){var t=function(e){function z19(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.enterz156=[o.z156.z319,o.z156.z406,o.z156.z481,o.z156.z466],t.updatez156=[o.z156.z362,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z379,o.z156.z442],t.exitz156=[o.z156.z465,o.z156.z494,o.z156.z320,o.z156.z466],t.states=[o.z115,o.z129,o.z130,o.z15,o.z138],t.transitions=[{condition:o.z768.z798,trueNode:{state:o.z130,level:-1}},{condition:o.z768.z796,trueNode:{state:o.z129,level:-1}},{condition:o.z768.z801,trueNode:{state:o.z108,actions:[]}}],t.initialState=o.z115,t}return __extends(z19,e),z19}(z49);o.z19=t}(z0||(z0={})),function(o){var t=function(e){function z15(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.enterz156=[],t.updatez156=[o.z156.z706,o.z156.z623,o.z156.z165,o.z156.z616,o.z156.z229,o.z156.z715,o.z156.z235,o.z156.z337,o.z156.z718,o.z156.z412,o.z156.z599,o.z156.z461,o.z156.z446,o.z156.z590,o.z156.z214,o.z156.z368],t.exitz156=[],t.states=[],t.transitions=[{condition:o.z768.z977,trueNode:{condition:o.z768.z936,trueNode:{state:o.z138}}},{condition:o.z768.z899,trueNode:{state:o.z108,level:1,actions:[]}}],t}return __extends(z15,e),z15}(z49);o.z15=t}(z0||(z0={})),function(F){var t=function(T){function Cage(t){var e=T.call(this)||this;return e.accType=F.z1044.z1048,e.food=[],e.pubsub=new Pubsub,e.avoidObjs=[],e.floorNodes=void 0,e.num=0,e.world=void 0,e.body=void 0,e.boxSize=0,e.floorY=0,e.bedding=null,e.beddingSideHeights=[],e.objs=[],e.isReady=!1,e.intersectsWith=2,e.intersectGroup=2,e.rotation=BABYLON.Vector3.Zero(),e.covers=[],e.connectors=[],e.worldMatrix=BABYLON.Matrix.Identity(),e.invWorldMatrix=BABYLON.Matrix.Identity(),e.floorThickness=0,e.centerGraphNode=void 0,e.wallThickness=0,e.glassThickness=.1,e.beds=[],e._bindedUpdateBeddingForLastObjectAdded=void 0,e._tempArray=[],e._tempVec=BABYLON.Vector3.Zero(),e._array=new z1072,e._tempAccArray=[],e._numObjectsByType=[],e._pointerDown=!1,e._prevPointerY=0,e._pointerDownBedding=!1,e._pointerId=0,Cage.count++,e.num=Cage.count,e.position=BABYLON.Vector3.Zero(),e.scaling=new BABYLON.Vector3(1,1,1),e.placementType=F.PlacementType.GRID|F.PlacementType.ALIGN_BOTTOM,e._colors={},e._colors.cage=new BABYLON.Color3(1,1,1),e._colors.bedding=new BABYLON.Color3(1,1,1),e.bindedKeepPosInside=e.keepPosInside.bind(e),e}return __extends(Cage,T),Cage.prototype.getWorldMatrix=function(){return this.worldMatrix},Object.defineProperty(Cage.prototype,"top",{get:function(){return this.position.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(Cage.prototype,"bottom",{get:function(){return this.position.y},enumerable:!1,configurable:!0}),Object.defineProperty(Cage.prototype,"left",{get:function(){return this.position.x-.5*this.width},enumerable:!1,configurable:!0}),Object.defineProperty(Cage.prototype,"right",{get:function(){return this.position.x+.5*this.width},enumerable:!1,configurable:!0}),Object.defineProperty(Cage.prototype,"front",{get:function(){return this.position.z-.5*this.depth},enumerable:!1,configurable:!0}),Object.defineProperty(Cage.prototype,"back",{get:function(){return this.position.z+.5*this.depth},enumerable:!1,configurable:!0}),Object.defineProperty(Cage.prototype,"holes",{get:function(){if(this.body)return this.body.shapes.holes},enumerable:!1,configurable:!0}),Cage.prototype.getObjectsByz1044=function(t,e,o){if(void 0===o&&(o=!1),!o&&!this._numObjectsByType[t])return!1;for(var i=!1,n=0;n<this.objs.length;n++)this.objs[n].accType&t&&(e.push(this.objs[n]),i=!0);return i},Cage.prototype.getObjectsAt=function(t,e,o,i,n,s){if(void 0===s&&(s=0),!this._numObjectsByType[n])return null;for(var a=0;a<this.objs.length;a++){var r=this.objs[a];n&r.accType&&r.isInBox(e,o,i,s)&&t.push(this.objs[a])}},Cage.prototype.getObjectAt=function(t,e,o,i,n){void 0===n&&(n=0);for(var s=0;s<this.objs.length;s++){var a=this.objs[s];if(i&a.accType&&a.isInBox(t,e,o,n))return this.objs[s]}},Cage.prototype.addToActiveObjects=function(){-1==Cage.activeObjects.indexOf(this)&&Cage.activeObjects.push(this)},Cage.prototype.removeFromActiveObjects=function(){var t=Cage.activeObjects.indexOf(this);-1!=t&&Cage.activeObjects.splice(t,1)},Cage.prototype.init=function(t){T.prototype.init.call(this,t);var e=F.app.graphicsHelper.scene;this.canRotate=!1,this.canTranslate=!0,this.canDelete=!0,this.world=t.world,this.addToActiveObjects();var o=this.height;t.width&&(this.width=t.width),t.depth&&(this.depth=t.depth),t.height&&(o=t.height,this.height=t.height),this.controlAnchor||this.addControlAnchor(),this.controlPositionLocal.x=0,this.controlPositionLocal.y=.5*this.height-.15,this.controlPositionLocal.z=.5*-this.depth,this.isMenuItem&&(this.controlPositionLocal.y=this.height-.4);var i=0,n=0;if(null!=t.x&&(i=t.x),null!=t.y&&(n=t.y),this.floorY=n,!this.isMenuItem){var s=Cage.getCageAt(i,n,0,0,this);if(s){var a=s.position.x-i,r=s.position.y-n;Math.abs(a)<.1&&Math.abs(r)<.1&&(this.removeFromActiveObjects(),this.recycle())}}if(!this.isMenuItem){var c=.15;if(0==this.beds.length){var d=ObjectPool.get(F.Bed.name);d.setPosition(this.left+.5,this.bottom+c,this.front+c),this.addObject(d),(d.parent=this).beds.push(d),(d=ObjectPool.get(F.Bed.name)).setPosition(this.right-.5,this.bottom+c,this.front+c),this.addObject(d),(d.parent=this).beds.push(d)}else this.beds[0].setPosition(this.left+.5,this.bottom+c,this.front+c),this.beds[1].setPosition(this.right-.5,this.bottom+c,this.front+c)}if(this.floorThickness=.05,this.floorY+=this.floorThickness,this._initColors(),t.isMenuItem);else if(!this.hitMeshes){this.hitMeshes=[];var p=F.app.graphicsHelper.getHitMesh(this.width-.01,this.height-.01,this.depth);p.rotationQuaternion=BABYLON.Quaternion.Identity(),this.hitMeshes.push(p);var l=[1,.4,.2,F.App.z1033,4294967295];c=.03;this.wallThickness=.05;var u=this.floorThickness,y=this.glassThickness;this.body=new OIMO.Body({holes:[],size:[this.width-.1,o,this.depth-.1-2*y],pos:[0,.5*o,0],rot:[0,0,0],world:this.world,config:l,type:"holey_box"}).body,this.body.shapes.floorThickness=u;var g=this.width-1,m=2*g+1;this.floorNodes=z1083.createNodeGrid(0,0,-.35,g,3*.7,m,4,this,0),this.frontPlaneMesh=z2.Graphics.MeshBuilder.CreatePlaneInstance(e),this.frontPlaneMesh.scaling.x=this.width-.1,this.frontPlaneMesh.scaling.y=this.height-.1,this.frontPlaneMesh.enablePointerMoveEvents=!0,this.frontPlaneMesh.isPickable=!1,this.frontPlaneMesh.isVisible=!1,F.app.graphicsHelper.addObject(this,this.frontPlaneMesh),this.pubsub.subscribe("ready",this.updateNodes,this)}if(t.c){var f=t.c,A=parseInt(f.substring(1,3),16)/255,b=parseInt(f.substring(3,5),16)/255,v=parseInt(f.substring(5,7),16)/255;this.setColor(A,b,v,"cage")}if(t.skipAddToScene?this.removeFromScene():(this.addToScene(),this.setPosition(i,n,0)),!this.isMenuItem&&t.bh){var x=t.bh;-1==x.indexOf("[")&&(x="["+x+"]");var C=JSON.parse(x);this.bedding&&this.bedding.setSideHeights(C),this.beddingSideHeights=C;var S=void 0;t.bc&&(S=t.bc),this.addBedding(!0,S)}this.pubsub.broadcast("ready")},Cage.prototype.addBedding=function(t,e){if(void 0===t&&(t=!1),void 0===e&&(e="#fffbaf"),!this.bedding){var o=this.width,i=this.depth,n=F.app.graphicsHelper.scene,s=BABYLON.Color3.FromHexString(e);this._colors.bedding=s;var a={x:0,y:0,z:0,floorY:.01,rx:0,ry:0,rz:0,padding:.03,heights:null,cage:this,world:this.world,scene:n,color:s},r=o+"x"+i;this.bedding=ObjectPool.get(F.Bedding.name+r,a),this.bedding&&(this.bedding.parent=this)}if(this.bedding){if(this.bedding.addToScene(),0<this.beddingSideHeights.length)this.bedding.setSideHeights(this.beddingSideHeights);else{this.bedding.resetSideHeights();for(var c=0;c<this.bedding.sideHeights.length;c++)this.beddingSideHeights[c]=this.bedding.sideHeights[c]}var d=this.floorY+.03;this.bedding.setPosition(this.position.x,d,this.position.z),F.app.updateOnceNextFrame.push(this.bedding.forceUpdateAll.bind(this.bedding))}if(!t){this.bedding.updateMaxHeights(!0);for(c=0;c<this.objs.length;c++){var p=this.objs[c];this.bedding.addToHeightAtX(0,p.position.x)}this.bedding.updateAll(!0),this.bedding.reconnect(),this.resetChildrenPositions(),F.app.saveDataItem(this)}},Cage.prototype.removeBedding=function(){var t=this.bedding;this.bedding=null,t.recycle();for(var e=0;e<this.food.length;e++){var o=this.food[e];o.bed&&o.setPosition(o.position.x,this.floorY,o.position.z)}F.app.saveDataItem(this)},Cage.prototype.getCoverAt=function(t,e,o){for(var i=this.covers,n=0;n<i.length;n++){var s=i[n].position,a=s.x-t,r=s.y-e,c=s.z-o;if(a*a+r*r+c*c<.25)return i[n]}},Cage.prototype.updateNodes=function(){this.bedding&&this.bedding.updateNodes(),this.centerGraphNode&&(this.centerGraphNode.x=this.position.x,this.centerGraphNode.y=this.floorY,this.centerGraphNode.z=this.position.z),this.isReady=!0},Cage.prototype.enableCovers=function(){for(var t=0;t<this.covers.length;t++)this.covers[t].enabled||(this.covers[t].enabled=!0)},Cage.prototype.updateCovers=function(){if(!this.isMenuItem){if(!this.covers.length){var t=!1;this.isMenuItem&&(t=!0);for(var e=0;e<this.width;e++){var o=ObjectPool.get(F.Cover.name,{name:F.Cover.name,color:this.color,renderingGroupID:this.renderingGroupID},!1,t);this.covers.push(o),o=ObjectPool.get(F.Cover.name,{name:F.Cover.name,color:this.color,renderingGroupID:this.renderingGroupID},!1,t),this.covers.push(o)}for(e=0;e<this.height;e++){o=ObjectPool.get(F.Cover.name,{name:F.Cover.name,color:this.color,renderingGroupID:this.renderingGroupID},!1,t);this.covers.push(o),o=ObjectPool.get(F.Cover.name,{name:F.Cover.name,color:this.color,renderingGroupID:this.renderingGroupID},!1,t),this.covers.push(o)}for(e=0;e<this.covers.length;e++){var i=this.covers[e];this.isOnScene?i.addToScene():i.removeFromScene()}}var n=this.position.x,s=this.position.y,a=this.position.z,r=0,c=Cage.tempBabMats[0];this.rotationQuaternion.toRotationMatrix(c);var d=c.m,p=Cage.tempQuats[1],l=Cage.tempVecs[1];l.x=0,l.y=0,l.z=1;var u=Cage.tempBabQuats[0],y=Cage.tempQuats[0];u.copyFrom(this.rotationQuaternion),y.x=u.x,y.y=u.y,y.z=u.z,y.s=u.w;var g=Cage.z4[0],m=Cage.z4[1];u.toEulerAnglesToRef(g),p.setFromAxisAngle(l,-Math.PI),p.mul(y,p),u.x=p.x,u.y=p.y,u.z=p.z,u.w=p.s,u.toEulerAnglesToRef(m);for(e=0;e<this.width;e++){var f=.5*-this.width+.5+1*e,A=this.height,b=.5*-this.width+.5+1*e,v=f*d[0]+A*d[4]+0*d[8]+n,x=f*d[1]+A*d[5]+0*d[9]+s,C=f*d[2]+A*d[6]+0*d[10]+a,S=b*d[0]+-.001*d[4]+0*d[8]+n,T=b*d[1]+-.001*d[5]+0*d[9]+s,B=b*d[2]+-.001*d[6]+0*d[10]+a;this.covers[r].setPosition(v,x,C),this.covers[r+1].setPosition(S,T,B),this.covers[r].setRotation(g.x,g.y,g.z),this.covers[r+1].setRotation(m.x,m.y,m.z),r+=2}p.setFromAxisAngle(l,.5*Math.PI),p.mul(y,p),u.x=p.x,u.y=p.y,u.z=p.z,u.w=p.s,u.toEulerAnglesToRef(g),p.setFromAxisAngle(l,.5*-Math.PI),p.mul(y,p),u.x=p.x,u.y=p.y,u.z=p.z,u.w=p.s,u.toEulerAnglesToRef(m);for(e=0;e<this.height;e++){var O=.5*-this.width,P=.5+1*e,M=.5*this.width,I=.5+1*e,N=O*d[0]+P*d[4]+0*d[8]+n,z=O*d[1]+P*d[5]+0*d[9]+s,w=O*d[2]+P*d[6]+0*d[10]+a,_=M*d[0]+I*d[4]+0*d[8]+n,R=M*d[1]+I*d[5]+0*d[9]+s,L=M*d[2]+I*d[6]+0*d[10]+a;this.covers[r].setPosition(N,z,w),this.covers[r+1].setPosition(_,R,L),this.covers[r].setRotation(g.x,g.y,g.z),this.covers[r+1].setRotation(m.x,m.y,m.z),r+=2}}},Cage.prototype.addObject=function(t){if(-1===this.objs.indexOf(t)){this.objs.push(t),this._addChildToCount(t);var e=t.food;if(e||t.foodMound&&(e=t.foodMound.food),e)for(var o=0;o<e.length;o++)this.addFood(e[o]);var i=F.z1062.activeObjects,n=Cage.z4[0];for(o=0;o<i.length;o++){var s=i[o];s.cage==this&&(n.copyFrom(t.position),n.z<this.front+.1?n.z=this.front+.1:n.z>this.back-.1&&(n.z=this.back-.1),n.y<this.bottom+.1?n.y=this.bottom+.1:n.y>this.top-.1&&(n.y=this.top-.1),n.x<this.left+.1?n.x=this.left+.1:n.x>this.right-.1&&(n.x=this.right-.1),s.memory.add(t,n))}this.bedding&&F.app.builder&&F.app.builder.isActive&&(this._bindedUpdateBeddingForLastObjectAdded||(this._bindedUpdateBeddingForLastObjectAdded=this._updateBeddingForLastObjectAdded.bind(this)),F.app.updateOnceNextFrame.push(this._bindedUpdateBeddingForLastObjectAdded))}},Cage.prototype._updateBeddingForLastObjectAdded=function(){var t=this.objs[this.objs.length-1];t&&this.bedding&&(this.bedding.updateMaxHeights(!0),this.bedding.addToHeightAtX(0,t.position.x),this.bedding.updateAll(!0),this.bedding.reconnect(),F.app.saveDataItem(this))},Cage.prototype.removeObject=function(t){var e=this.objs.indexOf(t);if(-1!==e){this._removeChildFromCount(t),this.objs.splice(e,1);var o=t.food;if(o||t.foodMound&&(o=t.foodMound.food),o)for(var i=0;i<o.length;i++)this.removeFood(o[i]);t.cage=null,t.parent==this&&(t.parent=null);var n=F.z1062.activeObjects;for(i=0;i<n.length;i++){var s=n[i];s.cage==this&&s.memory.remove(t)}this.bedding&&this.bedding.updateMaxHeights()}},Cage.prototype.setPositionOnMapFromDrop=function(t,e,o){if(T.prototype.setPositionOnMapFromDrop.call(this,t,e,o),this.objs){for(var i=this.objs,n=this._tempArray,s=n.length=0;s<i.length;s++)n[s]=i[s];for(s=0;s<n.length;s++){var a=n[s],r=a.position;a.setPositionOnMapFromDrop(r.x,r.y,r.z,!0)}}},Cage.prototype.setHitMesh=function(t,e,o){if(this.hitMeshes&&this.hitMeshes[0]){var i=this.hitMeshes[0];i.position.x=t,i.position.y=e+.5*this.height,i.position.z=o,i.computeWorldMatrix()}},Cage.prototype.setPositionDrag=function(t,e,o,i){var n=t-this.position.x,s=e-this.position.y,a=o-this.position.z;T.prototype.setPositionDrag.call(this,t,e,o,i),this.recycleConnectors(),this.floorY=e+this.floorThickness;var r=F.app.pointerDownPosition.x,c=F.app.pointerDownPosition.y,d=F.app.pointerDownPosition.z;if(this.isInside(r,c,d)&&(F.app.pointerDownPosition.x+=n,F.app.pointerDownPosition.y+=s,F.app.pointerDownPosition.z+=a),this.body){var p=this.body.position,l=this.position;p.x=l.x,p.y=l.y+.5*this.height,p.z=l.z;var u=this.body.shapes.position;u.x=l.x,u.y=l.y+.5*this.height,u.z=l.z,this.body.shapes.updateProxy()}if(this.enableCovers(),this.updateCovers(),this.bedding){var y=this.floorY+.03;this.bedding.setPosition(t,y,o)}if(this._translateChildrenDrag(n,s,a,i),this._translatez1062s(n,s,a),this.foodMoundCollider&&this.foodMoundCollider.translate(n,s,a),this.food)for(var g=0;g<this.food.length;g++){var m=this.food[g];m.platform||m.bowl||m.translate(n,s,a)}this.setHitMesh(t,e,o),this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position)},Cage.prototype.setPosition=function(t,e,o,i){void 0===i&&(i=!1);var n=t-this.position.x,s=e-this.position.y,a=o-this.position.z;this.position.x=t,this.position.y=e,this.position.z=o,this.floorY=e+this.floorThickness,this._translateNodes(n,s,a),this._translatez1062s(n,s,a),this.foodMoundCollider&&this.foodMoundCollider.translate(n,s,a);for(var r=0;r<this.beds.length;r++)this.beds[r].translate(n,s,a);if(this.setHitMesh(t,e,o),this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position),this.isMenuItem&&this.isMenuItem,this.bedding){var c=this.floorY+.03;this.bedding.setPosition(t,c,o)}if(this.updateCovers(),!i&&this.body){var d=this.body.position,p=this.position;d.x=p.x,d.y=p.y+.5*this.height,d.z=p.z;var l=this.body.shapes.position;if(l.x=p.x,l.y=p.y+.5*this.height,l.z=p.z,this.body.shapes.updateProxy(),this.floorNodes){var u=this.width-1,y=2*u+1;z1083.resetNodeGrid(this.floorNodes,this.position.x,this.floorY,this.position.z-.35,u,3*.7,y,4,this)}this.updateNodes(),this.checkConnections()}this._connected=!0,this.worldMatrix.setTranslation(this.position),this.worldMatrix.invertToRef(this.invWorldMatrix);var g=null;if(!this.isMenuItem)for(;g=F.app.getOrphanThatIntersectWith(this);)g.addToObject(this);if(this.frontPlaneMesh&&(this.frontPlaneMesh.position.x=t,this.frontPlaneMesh.position.y=e+.5*this.height,this.frontPlaneMesh.position.z=o-.5*this.depth+.1),this.isOnScene&&!i&&!this.isMenuItem){var m=Cage.tempArr;0<m.length&&(m.length=0),F.Tube.getObjectsAt(t,e+.5*this.height,o,this.width,this.height,m);for(r=0;r<m.length;r++){m[r].addToObject(this)}0<m.length&&(m.length=0)}this.onChangeObservable.notifyObservers(this)},Cage.prototype._translateNodes=function(t,e,o){},Cage.prototype._translateChildrenDrag=function(t,e,o,i){for(var n=0;n<this.objs.length;n++){var s=this.objs[n],a=s.position;s.bodies||s.draggerBody?s.parent==this&&s.translate(t,e,o):s.setPositionDrag(t+a.x,e+a.y,o+a.z,i,!0)}},Cage.prototype._translatez1062s=function(t,e,o){for(var i,n=F.z1062.activeObjects,s=0;s<n.length;s++)if((i=n[s]).cage==this){if(i.currentObject&&i.currentObject.accType==F.z1044.z1055)continue;i.translate(t,e,o)}},Cage.prototype.setRotation=function(t,e,o){T.prototype.setRotation.call(this,t,e,o)},Cage.prototype.rotate=function(t){},Cage.prototype.isInside=function(t,e,o,i){void 0===i&&(i=0);var n=this.body,s=(n.position,n.rotation.elements,n.position),a=t-s.x,r=e-s.y,c=o-s.z;if(this.width!=this.depth&&0!=this.rotation.y){var d=Cage.z4[0];d.x=t,d.y=e,d.z=o,BABYLON.Vector3.TransformCoordinatesToRef(d,this.invWorldMatrix,d),a=d.x,r=d.y-.5*this.height,c=d.z}var p=.5*this.width+i,l=.5*this.height+i,u=.5*this.depth+i;return a<=p&&-p<=a&&r<=l&&-l<=r&&c<=u&&-u<=c},Cage.prototype.isInBox=function(t,e,o,i){return this.isInside(t,e,o,i)},Cage.prototype.getGraphNodeAt=function(t,e,o,i,n,s,a,r){void 0===i&&(i=!1),void 0===n&&(n=null),void 0===s&&(s=0),void 0===a&&(a=null);var c,d,p=Number.MAX_VALUE;(null==r||r&F.z1044.z1047)&&(this.bedding&&(c=this.bedding.getGraphNodeAt(t,e,o,i,n,s,a))&&(p=(A=c.x-t)*A+(b=c.y-e)*b+(v=c.z-o)*v,d=F.z1044.z1047));if((null==r||r&F.z1044.z1048)&&this.floorNodes)for(var l,u=this.floorNodes,y=u.length,g=Cage.tempVecs[0],m=0;m<y;m++){if((l=u[m])!=a)if(l.deferTo&&(l=l.deferTo),(x=(A=l.x-t)*A+(b=l.y-e)*b+(v=l.z-o)*v)<p){if(i&&0==l.type)continue;if(n)if(g.x=A,g.y=b,g.z=v,g.normalize(g),g.dot(n)<s)continue;p=x,c=l,d=F.z1044.z1048}}if(null==r||r&F.z1044.z1049||r&F.z1044.z1046||r&F.z1044.z1050||r&F.z1044.SWING)for(m=0;m<this.objs.length;m++){var f=this.objs[m];if(f.accType,F.z1044.SWING,this.shouldGetChildGraphNodeAt(f,t,e,o,r)){var A,b,v,x,C=f.getGraphNodeAt(t,e,o,i,n,s);if(C)if((x=(A=C.x-t)*A+(b=C.y-e)*b+(v=C.z-o)*v)<p)p=x,c=C;else if(c&&(d==F.z1044.z1048||d==F.z1044.z1047)&&f.getPointSideY){var S=this._tempVec;S.x=t,S.y=e,S.z=o;var T=f.getPointSideY(S);if(T){var B=f.getPointSideY(c);B&&T!=B&&(p=x,c=C,d=f.accType)}}}}return c&&c.deferTo&&(c=c.deferTo),c},Cage.prototype.getGraphNodesAtToRef=function(t,e,o,i,n,s,a,r,c,d){void 0===n&&(n=!1),void 0===s&&(s=null),void 0===a&&(a=0),void 0===r&&(r=0),void 0===c&&(c=Number.MAX_VALUE),void 0===d&&(d=null),t.length=0;var p,l=this.floorNodes,u=l.length,y=Cage.tempVecs[0];if((null==d||d&F.z1044.z1047)&&this.bedding&&this.bedding.getGraphNodesAtToRef(t,e,o,i,n,s,a,r,c),null==d||d&F.z1044.z1048)for(var g=0;g<u;g++){var m=(p=l[g]).x-e,f=p.y-o,A=p.z-i,b=m*m+f*f+A*A;if(b<c*c&&r*r<b){if(n&&0==p.type)continue;if(s)if(y.x=m,y.y=f,y.z=A,y.normalize(y),y.dot(s)<a)continue;t.push(p)}}if(null==d||d&F.z1044.z1049||d&F.z1044.z1046||d&F.z1044.z1050)for(g=0;g<this.objs.length;g++){var v=this.objs[g];this.shouldGetChildGraphNodeAt(v,e,o,i,d)&&v.getGraphNodesAtToRef(t,e,o,i,n,s,a,r,c)}},Cage.prototype.shouldGetChildGraphNodeAt=function(t,e,o,i,n){if(t.skipConnect)return!1;var s=t.accType;if(0===s)return!1;if(s===F.z1044.z1046){if(!(null==n||n&F.z1044.z1046))return!1;var a=t,r=.33;if(e>t.position.x+.5*t.width+r)return!1;if(e<t.position.x-.5*t.width-r)return!1;if((d=Cage.z4[7]).x=e,d.y=o,d.z=i,a.getPointSideY(d,.5,.1)<1)return!1}else if(s==F.z1044.z1049){if(!(null==n||n&F.z1044.z1049))return!1;if(o-t.position.y<0)return!1;r=.33;if(e>t.position.x+.5*t.width+r)return!1;if(e<t.position.x-.5*t.width-r)return!1}else{if(s!==F.z1044.z1050){if(s===F.z1044.SWING){if(null==n||n&F.z1044.SWING){var c=t;return!(e>c.position.x+c.boxSize+.33)&&(!(e<c.position.x-c.boxSize-.33)&&!(o<c.position.y-.33))}return!1}return!1}if(!(null==n||n&F.z1044.z1050))return!1;var d,p=t;if(e>p.position.x+p.boxSize+.33)return!1;if(e<p.position.x-p.boxSize-.33)return!1;if(o<p.position.y-.33)return!1;if(e<p.position.x+p.radius&&e>p.position.x-p.radius&&((d=Cage.z4[7]).x=e,d.y=o,d.z=i,p.getPointSideY(d)<1))return!1}return!0},Cage.prototype.getUpVecAt=function(t,e,o){this.bedding.mesh.getNormalAtCoordinatesToRef(t,e,o)},Cage.prototype.getGroundY=function(t,e){return this.bedding?this.bedding.getHeightAt(t,e,!0):this.floorY},Cage.prototype.isCloseToTrafficArea=function(t,e,o,i){void 0===i&&(i=1);var n=this.getGraphNodeAt(t,e,o);if(!n)return!1;n.x;var s=e-n.y;n.z;return 0+s*s+0<i*i||void 0},Cage.isCloseToTrafficArea=function(t,e,o,i){void 0===i&&(i=1);for(var n=0;n<Cage.activeObjects.length;n++){if(Cage.activeObjects[n].isCloseToTrafficArea(t,e,o,i))return!0}},Cage.prototype.checkConnections=function(){this.checkTubeConnections(),this.checkCageConnections()},Cage.prototype.checkRampCeilingConnections=function(t){for(var e=this.position.y+this.height,o=0;o<this.objs.length;o++){var i=this.objs[o];i.accType==F.z1044.z1046&&(-.6<i.position.y-e&&i.connectToFloorAbove(t))}},Cage.prototype.checkCageConnections=function(){this._array.length=0,this._array.clean(),Cage.getAllCagesNextToCage(this._array,this);var t,e=this.position.y+this.height,o=this.position.x-.5*this.width,i=this.position.x+.5*this.width,n=this.position.y,s=(this.position.z,this.depth);for(s=this.position.z;t=this._array.pop();){var a=t.position.y+t.height,r=t.position.x-.5*t.width,c=t.position.x+.5*t.width;e<=t.position.y||(a<=n?t.checkRampCeilingConnections(this):c<=o?this.addConnectorsVertical(t,o,s,-1):i<=r&&this.addConnectorsVertical(t,i,s,1))}},Cage.prototype.checkCageConnection=function(t){var e=this.position.x-.5*this.width,o=this.position.x+.5*this.width,i=this.position.z,n=t.position.x-.5*t.width;t.position.x+.5*t.width<=e?this.addConnectorsVertical(t,e,i,-1):o<=n&&this.addConnectorsVertical(t,o,i,1)},Cage.prototype.addConnectorsVertical=function(t,e,o,i){for(var n=this.position.y+this.height,s=this.position.y,a=t.position.y+t.height,r=t.position.y,c=Math.max(r,s)+.5,d=Math.min(a,n),p=.5*Math.PI*i,l=c;l<d;l+=1){var u=ObjectPool.get("ConnectorCage",{x:e,y:l,z:o,rz:p,cage1:this,cage2:t});this.connectors.push(u),t.connectors.push(u)}},Cage.prototype.addConnectorsHorizontal=function(t,e,o,i){for(var n=this.position.x-.5*this.width,s=this.position.x+.5*this.width,a=t.position.x-.5*t.width,r=t.position.x+.5*t.width,c=Math.max(a,n)+.5,d=Math.min(r,s),p=1.5*-Math.PI+.5*Math.PI*i,l=c;l<d;l+=1){var u=ObjectPool.get("ConnectorCage",{x:l,y:e,z:o,rz:p,cage1:this,cage2:t});this.connectors.push(u),t.connectors.push(u)}},Cage.prototype.updateConnectorsAt=function(t,e,o){if(this.connectors&&this.connectors.length)for(var i=0;i<this.connectors.length;i++){var n=this.connectors[i],s=n.position.x-t,a=n.position.y-e,r=n.position.z-o;s*s+a*a+r*r<=.25&&n.refreshConnections()}},Cage.prototype.updateConnectors=function(){if(this.connectors&&this.connectors.length)for(var t=0;t<this.connectors.length;t++){this.connectors[t].refreshConnections()}},Cage.prototype.checkTubeConnections=function(){var t=this._tempAccArray;t.length=0,F.Tube.getObjectsAt(this.position.x,this.position.y+.5*this.height,this.position.z,this.width+2,this.height+2,this._tempAccArray);for(var e=0;e<t.length;e++)t[e].checkConnections()},Cage.prototype.checkNodeConnection=function(t){var e=t.x,o=t.y,i=t.z,n=this.getGraphNodeAt(e,o,i);if(n){if(0<t.connections.length)if(0<=t.connections.indexOf(n))return;var s=e-n.x,a=o-n.y,r=i-n.z,c=s*s+r*r;if(c<1&&a<.75){t.x=e,t.y=o,t.z=i;var d=Math.sqrt(c);n.addConnection(t,d),t.addConnection(n,d)}}},Cage.prototype.setBeddingHeight=function(t,e,o,i){void 0===i&&(i=.75),this.bedding&&this.bedding.setHeightAt(o,t,e,i)},Cage.prototype._addChildToCount=function(t){t.accType&&(null==this._numObjectsByType[t.accType]?this._numObjectsByType[t.accType]=1:this._numObjectsByType[t.accType]++)},Cage.prototype._removeChildFromCount=function(t){t.accType&&this._numObjectsByType[t.accType]--},Cage.prototype.getPlatformUnder=function(t,e,o){if(!this._numObjectsByType[F.z1044.z1049])return null;if(this.objs&&0<this.objs.length){for(var i=this.objs,n=null,s=1e4,a=0;a<i.length;a++){var r=i[a];if(r.accType==F.z1044.z1049){var c=r.position,d=e-c.y;if(!(d<0)){var p=t-c.x;p>.5*r.width||p<.5*-r.width||d*d<s&&(s=d*d,n=r)}}}return n}},Cage.prototype.getz1092Under=function(t,e,o,i){if(!this._numObjectsByType[i])return null;if(this.objs&&0<this.objs.length){for(var n=this.objs,s=null,a=1e4,r=0;r<n.length;r++){var c=n[r];if(c.accType==i){var d=c.position,p=e-d.y;if(!(p<0)){var l=.5*c.width||c.radius,u=t-d.x;l<u||u<-l||p*p<a&&(a=p*p,s=c)}}}return s}},Cage.prototype.getPlatformAbove=function(t,e,o){if(!this._numObjectsByType[F.z1044.z1049])return null;if(this.objs&&0<this.objs.length){for(var i=this.objs,n=null,s=1e4,a=0;a<i.length;a++){var r=i[a];if(r.accType==F.z1044.z1049){var c=r.position,d=e-c.y;if(!(0<d)){var p=t-c.x;p>.5*r.width||p<.5*-r.width||d*d<s&&(s=d*d,n=r)}}}return n}},Cage.prototype.getHeightAt=function(t,e){return this.bedding?Math.max(this.floorY,this.bedding.getHeightAt(t,e,!0)):this.floorY},Cage.prototype.getHoleAt=function(t,e,o){for(var i=this.body.shapes.holes,n=0;n<i.length;n++){var s=i[n],a=s.x-t,r=s.y-e,c=s.z-o;if(a*a+r*r+c*c<.03)return s}},Cage.prototype.removeHoleAt=function(t,e,o){var i=this.body.shapes.holes;if(i.length){var n=Cage.z4[8];this.worldMatrix,this.position,BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(t,e-.5*this.height,o,this.invWorldMatrix,n);for(var s=n.x,a=n.y,r=n.z,c=0;c<i.length;c++){var d=i[c],p=d.x-s,l=d.y-a,u=d.z-r;if(p*p+l*l+u*u<.03){s=d.x,a=d.y,r=d.z,!0,this.body.shapes.removeHole(d),ObjectPool.recycle(d);break}}var y=this.getCoverAt(t,e,o);y&&(y.enabled=!0)}},Cage.prototype.addHoleAt=function(t,e,o,i,n){if(!this.isDragging){var s=Cage.z4[4],a=Cage.z4[5],r=Cage.z4[6];s.x=t,s.y=e,s.z=o,this.getWallPositionAt(s,i,a,r);var c=this.body.position.x,d=this.body.position.y,p=this.body.position.z,l=t-a.x,u=e-a.y,y=o-a.z;if(!(.4*.4<=l*l+u*u+y*y)){var g,m=a.x-c,f=a.y-d,A=a.z-p,b=ObjectPool.get("OIMO.Hole");if(b.x=m,b.y=f,b.z=A,z1.TransformNormalToRef(b,this.invWorldMatrix,b),z1.TransformNormalToRef(r,this.invWorldMatrix,r),b.xside=r.x,b.yside=r.y,b.zside=r.z,this.getHoleAt(b.x,b.y,b.z))return b.toObj=null,ObjectPool.recycle(b),void((g=this.getCoverAt(t,e,o))&&g.enabled&&(g.enabled=!1));(g=this.getCoverAt(t,e,o))&&(g.enabled=!1),n&&(b.toObj=n),b.radius=.3,this.body.shapes.addHole(b),this.bedding&&r.y<-.9&&r.y}}},Cage.prototype.addToScene=function(){if(!this.isOnScene){T.prototype.addToScene.call(this),this.body&&!this.body.parent&&this.world.addRigidBody(this.body),this.bedding&&this.bedding.addToScene();for(var t=0;t<this.covers.length;t++)this.covers[t].addToScene();this.frontPlaneMesh&&this.frontPlaneMesh.getScene().addMesh(this.frontPlaneMesh)}},Cage.prototype.removeFromScene=function(){if(this.isOnScene){this.body&&this.body.shapes&&10==this.body.shapes.id&&(this.body.position,this.body.shapes.position),T.prototype.removeFromScene.call(this),this.disconnect(),this.body&&this.body.parent&&(this.body.position.y=9999,this.body.shapes.updateProxy(),this.body.shapes.position.y=this.body.position.y,this.world.removeRigidBody(this.body)),this.bedding&&this.bedding.removeFromScene();for(var t=0;t<this.covers.length;t++)this.covers[t].removeFromScene();for(this.frontPlaneMesh&&this.frontPlaneMesh.getScene().removeMesh(this.frontPlaneMesh);this.food.length;){this.food[0].recycle()}}},Cage.sortCagesByY=function(t,e){return t.position.y-e.position.y},Cage.getAllCagesNextToCage=function(t,e){var o=e.hitMeshes[0].position.x,i=e.hitMeshes[0].position.y,n=e.hitMeshes[0].position.z,s=e.width+.2,a=e.height+.2;Cage.activeObjects.sort(Cage.sortCagesByY);for(var r=0;r<Cage.activeObjects.length;r++){var c=Cage.activeObjects[r];c!=e&&(c.intersectsBox(o,i,n,s,a)&&t.push(c))}},Cage.prototype.intersectsBox=function(t,e,o,i,n,s){var a=this.hitMeshes[0].position.x-t,r=this.hitMeshes[0].position.y-e,c=this.hitMeshes[0].position.z-o;a<0&&(a*=-1),r<0&&(r*=-1),c<0&&(c*=-1);var d=.5*this.width+.5*i,p=.5*this.height+.5*n;return a<d&&r<p},Cage.getCageAt=function(t,e,o,i,n){void 0===i&&(i=0);for(var s=0;s<Cage.activeObjects.length;s++){var a=Cage.activeObjects[s];if((!n||n!=a)&&a.isInside(t,e,o,i))return a}},Cage.getClosestCage=function(t,e,o){var i,n=Number.MAX_VALUE,s=0,a=Cage.z4[0],r=Cage.z4[1];r.x=t,r.y=e,r.z=o;for(var c=0;c<Cage.activeObjects.length;c++){var d=Cage.activeObjects[c];a.x=d.position.x,a.y=d.position.y+.5*d.height,a.z=d.position.z,(s=BABYLON.Vector3.DistanceSquared(a,r))<n&&(n=s,i=d)}return i},Cage.prototype.getChildrenByType=function(t,e){for(var o=0;o<this.objs.length;o++){var i=this.objs[o];(t&i.accType||null==t)&&e.push(i)}},Cage.prototype.getChildrenAt=function(t,e,o,i,n,s,a){for(var r=t-.5*i,c=t+.5*i,d=e-.5*n,p=e+.5*n,l=0;l<this.objs.length;l++){var u=this.objs[l];if(a&u.accType||null==a){var y=.5*u.width;!y&&u.radius&&(y=u.radius);var g=u.position.x-y,m=u.position.x+y,f=u.position.y+u.height,A=u.position.y;if(m<=r||c<=g||p<=A||f<=d)continue;s.push(u)}}},Cage.getObjectsAt=function(t,e,o,i,n,s){for(var a,r=Cage.activeObjects,c=r.length,d=t-.5*i,p=t+.5*i,l=e-.5*n,u=e+.5*n,y=0;y<c;y++){var g=(a=r[y]).position.x-.5*a.width,m=a.position.x+.5*a.width,f=a.position.y+a.height,A=a.position.y;m<=d||p<=g||u<=A||f<=l||s.push(a)}},Cage.prototype.recycle=function(){this.recycleConnectors(),this.recycleHoles(),this.recycleCovers(),this.bedding&&(this.bedding.recycle(),ObjectPool.recycle(this.bedding),this.bedding=null),this.foodMoundCollider&&this.foodMoundCollider.resetHeights(),T.prototype.recycle.call(this)},Cage.prototype.disconnect=function(){if(this.body&&(this.bedding&&this.bedding.disconnect(),this.floorNodes))for(var t=this.floorNodes,e=t.length,o=null,i=0;i<e;i++){(o=t[i]).data.enterEvent=null,o.data.enterNextNode=null;for(var n=o.connections.length,s=0;s<n;s++){var a=o.connections[s];a.data.obj!=this&&(o.removeConnection(a),a.removeConnection(o),n--,s--,a.data.enterTarget&&(this.removeHoleAt(a.x,a.y,a.z),a.data.enterEvent=null,a.data.obj.updateNodes())),a.data.obj&&a.data.obj.removeHoleAt?a.data.obj.removeHoleAt(o.x,o.y,o.z):a.data.connector&&a.data.connector.parent&&a.data.connector.parent.removeHoleAt&&a.data.connector.parent.removeHoleAt(o.x,o.y,o.z),a.data.obj2&&a.data.obj2.onAfterDisconnect&&a.data.obj2.onAfterDisconnect(this),a.data.obj&&a.data.obj.onAfterDisconnect&&a.data.obj!=this&&a.data.obj.onAfterDisconnect(this)}o.x=9999,o.y=9999,o.z=9999}},Cage.prototype.getWallPositionAt=function(t,e,o,i){var n=t.x-this.position.x,s=t.y-(this.position.y+.5*this.height),a=t.z-this.position.z,r=e.x,c=e.y,d=e.z;if(o.copyFrom(t),this.width!=this.depth&&0!=this.rotation.y){var p=Cage.z4[8];p.x=t.x,p.y=t.y,p.z=t.z,BABYLON.Vector3.TransformCoordinatesToRef(p,this.invWorldMatrix,p),o.copyFrom(p),n=p.x,s=p.y-.5*this.height,a=p.z,BABYLON.Vector3.TransformNormalToRef(e,this.invWorldMatrix,p),r=p.x,c=p.y,d=p.z}var l=Cage.z4[7];l.x=0,l.y=0,l.z=0,.9<r||r<-.9?(l.x=0<n?1:-1,o.x=l.x*this.width*.5):.9<c||c<-.9?(l.y=0<s?1:-1,o.y=l.y*this.height*.5+.5*this.height):(.9<d||d<-.9)&&(l.z=0<a?1:-1,o.z=l.z*this.depth*.5),this.width!=this.depth&&0!=this.rotation.y?(BABYLON.Vector3.TransformCoordinatesToRef(o,this.worldMatrix,o),BABYLON.Vector3.TransformNormalToRef(l,this.worldMatrix,l)):l.x?o.x+=this.position.x:l.y?o.y+=this.position.y:l.z&&(o.z+=this.position.z),i&&i.copyFrom(l)},Cage.prototype.recycleHoles=function(){if(this.body){for(var t=this.body.shapes.holes,e=0;e<t.length;e++)t[e].toObj=null,ObjectPool.recycle(t[e]);t.length=0}},Cage.prototype.recycleConnectors=function(){for(var t=this.connectors;t.length;)t[0].recycle()},Cage.prototype.recycleCovers=function(){for(var t=0;t<this.covers.length;t++)this.covers[t].recycle();this.covers.length=0},Cage.prototype.setColor=function(t,e,o,i){if(T.prototype.setColor.call(this,t,e,o,i),"bedding"==i)this.bedding&&this.bedding.setColor(t,e,o,i);else if("cage"==i){for(var n=0;n<this.covers.length;n++)this.covers[n].setColor(t,e,o);this.color.r=t,this.color.g=e,this.color.b=o,this.onChangeObservable.notifyObservers(this)}},Cage.prototype.removeFood=function(t){var e=this.food.indexOf(t);-1!==e&&this.food.splice(e,1)},Cage.prototype.addFood=function(t){-1==this.food.indexOf(t)&&(this.food.push(t),t.cage=this)},Cage.prototype.getNeighborAt=function(t,e,o){for(var i,n=this.connectors,s=0;s<n.length;s++){if(i=n[s].getNeighborAt(t,e,o))return i}var a=this.position.x,r=this.position.y+.5*this.height,c=this.position.z,d=this.floorNodes;for(s=0;s<d.length;s++){(p=d[s]).x,p.y;if(!(.3<(l=p.z-c)||l<-.3)&&(i=F.z1092.GetObjConnectedToNodeAt(p,t,e,o)))return i}if(this.bedding)for(d=this.bedding.nodes,s=0;s<d.length;s++){var p,l;if(!(.3<(l=(p=d[s]).z-c)||l<-.3)&&(i=F.z1092.GetObjConnectedToNodeAt(p,t,e,o)))return i}},Cage.prototype.keepPosInside=function(t,e,o){void 0===e&&(e=.05),void 0===o&&(o=0);var i=.5*this.width-e,n=.5*this.depth-e,s=this.position.x-i,a=this.position.x+i,r=this.position.z-n,c=this.position.z+n,d=this.floorY+o,p=!1;this.bedding&&(d=this.bedding.position.y);var l=this.position.y+this.height;return t.x<s?(t.x=s,p=!0):t.x>a&&(t.x=a,p=!0),t.z<r?(t.z=r,p=!0):t.z>c&&(t.z=c,p=!0),t.y<d?(t.y=d,p=!0):t.y>l&&(t.y=l,p=!0),p},Cage.prototype.resetChildrenPositions=function(){if(F.app.isHomeLoaded())for(var t=0;t<this.objs.length;t++){var e=this.objs[t];if(e.placementType&F.PlacementType.ALIGN_BOTTOM){var o=e.position.y;e.setToFloor(o),o!=e.position.y&&e.dbid&&F.app.saveDataItem(e)}}},Cage.prototype.moveChildrenPositionsByChangeInBeddingHeight=function(){for(var t=0;t<this.objs.length;t++){var e=this.objs[t];if(e.placementType&F.PlacementType.ALIGN_BOTTOM){var o=e.position,i=this.bedding.getChangeInHeightAtX(o.x);e.translate(0,i,0)}}},Cage.prototype.getProps=function(){var t={};return t.x=z1.roundToDecimalPlace(this.position.x,2),t.y=z1.roundToDecimalPlace(this.position.y,2),this._colors.cage&&(t.c=this._colors.cage.toHexString()),this.bedding?(this.bedding.sideHeights.length&&(t.bh=this.bedding.sideHeights.join(",")),this._colors.bedding&&(t.bc=this._colors.bedding.toHexString())):t.bh=0,t},Cage.prototype.getCenterAtPosToRef=function(t,e,o,i){i.x=t,i.y=e+.5*this.height,i.z=o},Cage.prototype.isValidDropLocation=function(t,e,o){if(!T.prototype.isValidDropLocation.call(this,t,e,o))return!1;var i=this._tempDropLoc;this.getPositionOnMapFromDropToRef(t,e,o,i);var n=F.app.builder.background,s=n.mesh.position.x+.5*n.width,a=n.mesh.position.x-.5*n.width,r=n.mesh.position.y+.5*n.height,c=n.mesh.position.y-.5*n.height;if(t+.5*this.width>s)return!1;if(t-.5*this.width<a)return!1;if(e+this.height>r)return!1;if(e<c)return!1;var d=Cage.tempArr;d.length=0,F.Tube.getObjectsAt(i.x,i.y+.5*this.height,i.z,this.width+1,this.height+1,d);for(var p=0;p<d.length;p++){var l=d[p];if(1.5<l.boxSize&&l.parent!=this){var u=i.x-.5*this.width,y=i.y+this.height,g=i.y,m=i.x+.5*this.width,f=.5*l.boxSize;if(l.position.y<y+f&&l.position.y>g-f){var A=l.position.x-u;if(A<.5&&-.5<A)return!1;if((A=l.position.x-m)<.5&&-.5<A)return!1}if(l.position.x<m+f&&l.position.x>u-f){var b=l.position.y-g;if(b<.5&&-.5<b)return!1;if((b=l.position.y-y)<.5&&-.5<b)return!1}}}return!0},Cage.prototype.onPointerDown=function(t,e){if(!F.app.multiTouch&&!this._pointerDown&&this.bedding){this.bedding.updateMaxHeights(),this._pointerId=t.event.pointerId,this._pointerDown=!0;var o=this.position.z-.5*this.depth,i=Cage.z4[0];F.app.graphicsHelper.getPlanePositionAtScreenXY(t.event.clientX,t.event.clientY,o,i),this._prevPointerY=i.y,e!=this.bedding&&e!=this.bedding.sides||(this._pointerDownBedding=!0,F.app.graphicsHelper.pauseDragCamera(!0))}},Cage.prototype.onPointerUp=function(t){this._pointerId==t.pointerId&&this.bedding&&(this._pointerDownBedding&&(this.bedding.updateAll(!0),this.bedding.reconnect(),this.resetChildrenPositions(),F.app.saveDataItem(this)),this._pointerDown=!1,this._pointerDownBedding=!1,this._pointerId=-1)},Cage.prototype.onPointerMove=function(t){if(this._pointerId==t.pointerId&&!F.app.multiTouch&&this.bedding&&this._pointerDownBedding){var e=this.position.z-.5*this.depth,o=Cage.z4[0];F.app.graphicsHelper.getPlanePositionAtScreenXY(t.clientX,t.clientY,e,o);var i=o.y-this._prevPointerY;this.bedding.addToHeightAtX(i,o.x),this._prevPointerY=o.y,F.app.graphicsHelper.pauseDragCamera(!0)}},Cage.prototype.getMinYBetween=function(t,e){if(!this.bedding)return this.floorY;var o=this.bedding.getMinHeightBetween(t,e);return this.bedding.position.y+o},Cage.prototype.getAveYBetween=function(t,e){if(!this.bedding)return this.floorY;var o=this.bedding.getAveHeightBetween(t,e);return this.bedding.position.y+o},Cage.prototype.getTubesWithOpeningConnectors=function(t){if(0<this._numObjectsByType[F.z1044.z1051])for(var e=this.objs,o=0;o<e.length;o++){var i=e[o];i.accType==F.z1044.z1051&&(i.hasEnterNode&&-1==t.indexOf(i)&&t.push(i))}var n=this.holes;for(o=0;o<n.length;o++)n[o].toObj&&n[o].toObj.accType==F.z1044.z1051&&-1==t.indexOf(n[o].toObj)&&t.push(n[o].toObj)},Cage.prototype.getConnectedCages=function(t){for(var e=this.holes,o=0;o<e.length;o++)e[o].toObj&&e[o].toObj.accType==F.z1044.z1048&&-1==t.indexOf(e[o].toObj)&&t.push(e[o].toObj)},Cage.tempArr=[],Cage.tempVecs=[new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3],Cage.tempQuats=[new OIMO.Quat,new OIMO.Quat,new OIMO.Quat],Cage.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],Cage.tempBabMats=[BABYLON.Matrix.Identity()],Cage.count=0,Cage.activeObjects=[],Cage}(F.z1092);F.Cage=t}(z0||(z0={})),function(i){var t=function(o){function Cage2x2(t){var e=o.call(this,t)||this;return e.width=2,e.height=2,e.depth=4,e.mapPlacementInfo=new i.MapPlacementInfo({mapOffsetX:.5,mapOffsetY:-.5,mapOffsetDropTargetX:-.5,mapOffsetDropTargetY:.5,offsetDragFromMenuY:-1}),e}return __extends(Cage2x2,o),Cage2x2.prototype.showSelected=function(){},Cage2x2.prototype.hideSelected=function(){},Cage2x2}(i.Cage);i.Cage2x2=t}(z0||(z0={})),function(e){var t=function(){function Cage2x2Config(){this.objName="c1",e.Cage2x2.objectCount=Cage2x2Config.maxObjects}return Cage2x2Config.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,e.Cage2x2,{world:t,shapeName:this.objName})},Cage2x2Config.prototype.getSceneFileNames=function(t){},Cage2x2Config.prototype.getCreateMeshFunctions=function(t){t.Cage2x2MenuButton=this._createMeshes},Cage2x2Config.prototype._createMeshes=function(t,e){var o=BABYLON.MeshBuilder.CreatePlane("Cage2x2MenuButton",{width:2,height:2},t);t.removeMesh(o),o.position.y=1,o.bakeCurrentTransformIntoVertices(),e.Cage2x2MenuButton=o},Cage2x2Config.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"Cage2x2",numInstances:Cage2x2Config.maxObjects,maxInstances:Cage2x2Config.maxObjects,isPickable:!1}),t.push({shapeName:this.objName,meshName:"Cage2x2button",numInstances:Cage2x2Config.maxObjects,maxInstances:Cage2x2Config.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName,meshName:"Cage2x2",numInstances:1,maxInstances:1,renderingGroupID:e.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"Cage2x2MenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:e.App.menuRenderingGroupID})},Cage2x2Config.prototype.getTextureDrawFunctions=function(t){},Cage2x2Config.prototype.getz1064Items=function(t){t.push(new e.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Cages",order:1,menuHeight:2.3,menuWidth:2.3,offsetY:-1,offsetX:.25,offsetZ:-2}))},Cage2x2Config.maxObjects=8,Cage2x2Config}();e.Cage2x2Config=t,e.App.AddEntityConfig(new t)}(z0||(z0={})),function(i){var t=function(o){function Cage2x3(t){var e=o.call(this,t)||this;return e.width=2,e.height=3,e.depth=4,e.mapPlacementInfo=new i.MapPlacementInfo({mapOffsetX:.5,mapOffsetDropTargetX:-.5,mapOffsetY:-.5,mapOffsetDropTargetY:.5,offsetDragFromMenuY:-1.5}),i.z1073.SetColor3FromHex("#E4DEC2",e._colors.cage),e}return __extends(Cage2x3,o),Cage2x3.prototype.init=function(t){t.isMenuItem||t.c,o.prototype.init.call(this,t)},Cage2x3}(i.Cage);i.Cage2x3=t}(z0||(z0={})),function(e){var t=function(){function Cage2x3Config(){this.objName="c2",e.Cage2x3.objectCount=Cage2x3Config.maxObjects}return Cage2x3Config.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,e.Cage2x3,{world:t,shapeName:this.objName})},Cage2x3Config.prototype.getSceneFileNames=function(t){},Cage2x3Config.prototype.getCreateMeshFunctions=function(t){t.Cage2x3MenuButton=this._createMeshes},Cage2x3Config.prototype._createMeshes=function(t,e){var o=BABYLON.MeshBuilder.CreatePlane("Cage2x3MenuButton",{width:2,height:3},t);t.removeMesh(o),o.position.y=1.5,o.bakeCurrentTransformIntoVertices(),e.Cage2x3MenuButton=o},Cage2x3Config.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"Cage2x3",numInstances:Cage2x3Config.maxObjects,maxInstances:Cage2x3Config.maxObjects,isPickable:!1}),t.push({shapeName:this.objName,meshName:"Cage2x3button",numInstances:Cage2x3Config.maxObjects,maxInstances:Cage2x3Config.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName,meshName:"Cage2x3",numInstances:1,maxInstances:1,renderingGroupID:e.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"Cage2x3MenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:e.App.menuRenderingGroupID})},Cage2x3Config.prototype.getTextureDrawFunctions=function(t){},Cage2x3Config.prototype.getz1064Items=function(t){t.push(new e.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Cages",order:4,menuHeight:3.3,menuWidth:2.3,offsetY:-1.5,offsetX:.25,offsetZ:-2}))},Cage2x3Config.maxObjects=4,Cage2x3Config}();e.Cage2x3Config=t,e.App.AddEntityConfig(new t)}(z0||(z0={})),function(i){var t=function(o){function Cage2x4(t){var e=o.call(this,t)||this;return e.width=2,e.height=4,e.depth=4,e.mapPlacementInfo=new i.MapPlacementInfo({mapOffsetX:.5,mapOffsetY:-.5,mapOffsetDropTargetX:-.5,mapOffsetDropTargetY:.5,offsetDragFromMenuY:-2}),i.z1073.SetColor3FromHex("#CCCCFF",e._colors.cage),e}return __extends(Cage2x4,o),Cage2x4.prototype.init=function(t){t.isMenuItem||t.c,o.prototype.init.call(this,t)},Cage2x4.prototype.showSelected=function(){},Cage2x4.prototype.hideSelected=function(){},Cage2x4}(i.Cage);i.Cage2x4=t}(z0||(z0={})),function(e){var t=function(){function Cage2x4Config(){this.objName="c3",e.Cage2x4.objectCount=Cage2x4Config.maxObjects}return Cage2x4Config.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,e.Cage2x4,{world:t,shapeName:this.objName})},Cage2x4Config.prototype.getSceneFileNames=function(t){},Cage2x4Config.prototype.getCreateMeshFunctions=function(t){t.Cage2x4MenuButton=this._createMeshes},Cage2x4Config.prototype._createMeshes=function(t,e){var o=BABYLON.MeshBuilder.CreatePlane("Cage2x4MenuButton",{width:2,height:4},t);t.removeMesh(o),o.position.y=2,o.bakeCurrentTransformIntoVertices(),e.Cage2x4MenuButton=o},Cage2x4Config.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"Cage2x4",numInstances:Cage2x4Config.maxObjects,maxInstances:Cage2x4Config.maxObjects,isPickable:!1}),t.push({shapeName:this.objName,meshName:"Cage2x4button",numInstances:Cage2x4Config.maxObjects,maxInstances:Cage2x4Config.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName,meshName:"Cage2x4",numInstances:1,maxInstances:1,renderingGroupID:e.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"Cage2x4MenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:e.App.menuRenderingGroupID})},Cage2x4Config.prototype.getTextureDrawFunctions=function(t){},Cage2x4Config.prototype.getz1064Items=function(t){t.push(new e.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Cages",order:7,menuHeight:2.3,menuWidth:2.3,offsetY:-2,offsetX:.25,offsetZ:-2}))},Cage2x4Config.maxObjects=4,Cage2x4Config}();e.Cage2x4Config=t,e.App.AddEntityConfig(new t)}(z0||(z0={})),function(i){var t=function(o){function Cage3x2(t){var e=o.call(this,t)||this;return e.width=3,e.height=2,e.depth=4,e.mapPlacementInfo=new i.MapPlacementInfo({mapOffsetY:-.5,mapOffsetDropTargetY:.5,offsetDragFromMenuY:-1}),i.z1073.SetColor3FromHex("#E4DEC2",e._colors.cage),e}return __extends(Cage3x2,o),Cage3x2.prototype.init=function(t){t.isMenuItem||t.c,o.prototype.init.call(this,t)},Cage3x2}(i.Cage);i.Cage3x2=t}(z0||(z0={})),function(e){var t=function(){function Cage3x2Config(){this.objName="c4",e.Cage3x2.objectCount=Cage3x2Config.maxObjects}return Cage3x2Config.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,e.Cage3x2,{world:t,shapeName:this.objName})},Cage3x2Config.prototype.getSceneFileNames=function(t){},Cage3x2Config.prototype.getCreateMeshFunctions=function(t){t.Cage3x2MenuButton=this._createMeshes},Cage3x2Config.prototype._createMeshes=function(t,e){var o=BABYLON.MeshBuilder.CreatePlane("Cage3x2MenuButton",{width:3,height:2},t);t.removeMesh(o),o.position.y=1,o.bakeCurrentTransformIntoVertices(),e.Cage3x2MenuButton=o},Cage3x2Config.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"Cage3x2",numInstances:Cage3x2Config.maxObjects,maxInstances:Cage3x2Config.maxObjects,isPickable:!1}),t.push({shapeName:this.objName,meshName:"Cage3x2button",numInstances:Cage3x2Config.maxObjects,maxInstances:Cage3x2Config.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName,meshName:"Cage3x2",numInstances:1,maxInstances:1,renderingGroupID:e.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"Cage3x2MenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:e.App.menuRenderingGroupID})},Cage3x2Config.prototype.getTextureDrawFunctions=function(t){},Cage3x2Config.prototype.getz1064Items=function(t){t.push(new e.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Cages",order:2,menuHeight:2.3,menuWidth:3.3,offsetY:-1,offsetX:.25,offsetZ:-2}))},Cage3x2Config.maxObjects=4,Cage3x2Config}();e.Cage3x2Config=t,e.App.AddEntityConfig(new t)}(z0||(z0={})),function(i){var t=function(o){function Cage3x3(t){var e=o.call(this,t)||this;return e.width=3,e.height=3,e.depth=4,e.mapPlacementInfo=new i.MapPlacementInfo({mapOffsetY:-.5,mapOffsetDropTargetY:.5,offsetDragFromMenuY:-1.5}),i.z1073.SetColor3FromHex("#FFD3A7",e._colors.cage),e}return __extends(Cage3x3,o),Cage3x3.prototype.init=function(t){t.isMenuItem||t.c,o.prototype.init.call(this,t)},Cage3x3}(i.Cage);i.Cage3x3=t}(z0||(z0={})),function(e){var t=function(){function Cage3x3Config(){this.objName="c5",e.Cage3x3.objectCount=Cage3x3Config.maxObjects}return Cage3x3Config.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,e.Cage3x3,{world:t,shapeName:this.objName})},Cage3x3Config.prototype.getSceneFileNames=function(t){},Cage3x3Config.prototype.getCreateMeshFunctions=function(t){t.Cage3x3MenuButton=this._createMeshes},Cage3x3Config.prototype._createMeshes=function(t,e){var o=BABYLON.MeshBuilder.CreatePlane("Cage3x3MenuButton",{width:3,height:3},t);t.removeMesh(o),o.position.y=1.5,o.bakeCurrentTransformIntoVertices(),e.Cage3x3MenuButton=o},Cage3x3Config.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"Cage3x3",numInstances:Cage3x3Config.maxObjects,maxInstances:Cage3x3Config.maxObjects,isPickable:!1}),t.push({shapeName:this.objName,meshName:"Cage3x3button",numInstances:Cage3x3Config.maxObjects,maxInstances:Cage3x3Config.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName,meshName:"Cage3x3",numInstances:1,maxInstances:1,renderingGroupID:e.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"Cage3x3MenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:e.App.menuRenderingGroupID})},Cage3x3Config.prototype.getTextureDrawFunctions=function(t){},Cage3x3Config.prototype.getz1064Items=function(t){t.push(new e.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Cages",order:5,menuHeight:3.3,menuWidth:3.3,offsetY:-1.5,offsetX:.25,offsetZ:-2}))},Cage3x3Config.maxObjects=4,Cage3x3Config}();e.Cage3x3Config=t,e.App.AddEntityConfig(new t)}(z0||(z0={})),function(i){var t=function(o){function Cage3x4(t){var e=o.call(this,t)||this;return e.width=3,e.height=4,e.depth=4,e.mapPlacementInfo=new i.MapPlacementInfo({mapOffsetY:-.5,mapOffsetDropTargetY:.5,offsetDragFromMenuY:-2}),i.z1073.SetColor3FromHex("#F0CCFF",e._colors.cage),e}return __extends(Cage3x4,o),Cage3x4.prototype.init=function(t){t.isMenuItem||t.c,o.prototype.init.call(this,t)},Cage3x4}(i.Cage);i.Cage3x4=t}(z0||(z0={})),function(e){var t=function(){function Cage3x4Config(){this.objName="c6",e.Cage3x4.objectCount=Cage3x4Config.maxObjects}return Cage3x4Config.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,e.Cage3x4,{world:t,shapeName:this.objName})},Cage3x4Config.prototype.getSceneFileNames=function(t){},Cage3x4Config.prototype.getCreateMeshFunctions=function(t){t.Cage3x4MenuButton=this._createMeshes},Cage3x4Config.prototype._createMeshes=function(t,e){var o=BABYLON.MeshBuilder.CreatePlane("Cage3x4MenuButton",{width:3,height:4},t);t.removeMesh(o),o.position.y=2,o.bakeCurrentTransformIntoVertices(),e.Cage3x4MenuButton=o},Cage3x4Config.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"Cage3x4",numInstances:Cage3x4Config.maxObjects,maxInstances:Cage3x4Config.maxObjects,isPickable:!1}),t.push({shapeName:this.objName,meshName:"Cage3x4button",numInstances:Cage3x4Config.maxObjects,maxInstances:Cage3x4Config.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName,meshName:"Cage3x4",numInstances:1,maxInstances:1,renderingGroupID:e.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"Cage3x4MenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:e.App.menuRenderingGroupID})},Cage3x4Config.prototype.getTextureDrawFunctions=function(t){},Cage3x4Config.prototype.getz1064Items=function(t){t.push(new e.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Cages",order:8,menuHeight:4.3,menuWidth:3.3,offsetY:-2,offsetX:.25,offsetZ:-2}))},Cage3x4Config.maxObjects=4,Cage3x4Config}();e.Cage3x4Config=t,e.App.AddEntityConfig(new t)}(z0||(z0={})),function(i){var t=function(o){function Cage4x2(t){var e=o.call(this,t)||this;return e.width=4,e.height=2,e.depth=4,e.mapPlacementInfo=new i.MapPlacementInfo({mapOffsetX:.5,mapOffsetY:-.5,mapOffsetDropTargetX:-.5,mapOffsetDropTargetY:.5,offsetDragFromMenuY:-1}),i.z1073.SetColor3FromHex("#CCCCFF",e._colors.cage),e}return __extends(Cage4x2,o),Cage4x2}(i.Cage);i.Cage4x2=t}(z0||(z0={})),function(e){var t=function(){function Cage4x2Config(){this.objName="c7",e.Cage4x2.objectCount=Cage4x2Config.maxObjects}return Cage4x2Config.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,e.Cage4x2,{world:t,shapeName:this.objName})},Cage4x2Config.prototype.getSceneFileNames=function(t){},Cage4x2Config.prototype.getCreateMeshFunctions=function(t){t.Cage4x2MenuButton=this._createMeshes},Cage4x2Config.prototype._createMeshes=function(t,e){var o=BABYLON.MeshBuilder.CreatePlane("Cage4x2MenuButton",{width:4,height:2},t);t.removeMesh(o),o.position.y=1,o.bakeCurrentTransformIntoVertices(),e.Cage4x2MenuButton=o},Cage4x2Config.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"Cage4x2",numInstances:Cage4x2Config.maxObjects,maxInstances:Cage4x2Config.maxObjects,isPickable:!1}),t.push({shapeName:this.objName,meshName:"Cage4x2button",numInstances:Cage4x2Config.maxObjects,maxInstances:Cage4x2Config.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName,meshName:"Cage4x2",numInstances:1,maxInstances:1,renderingGroupID:e.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"Cage4x2MenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:e.App.menuRenderingGroupID})},Cage4x2Config.prototype.getTextureDrawFunctions=function(t){},Cage4x2Config.prototype.getz1064Items=function(t){t.push(new e.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Cages",order:3,menuHeight:2.3,menuWidth:4.6,offsetY:-1,offsetX:.25,offsetZ:-2}))},Cage4x2Config.maxObjects=4,Cage4x2Config}();e.Cage4x2Config=t,e.App.AddEntityConfig(new t)}(z0||(z0={})),function(i){var t=function(o){function Cage4x3(t){var e=o.call(this,t)||this;return e.width=4,e.height=3,e.depth=4,e.mapPlacementInfo=new i.MapPlacementInfo({mapOffsetX:.5,mapOffsetY:-.5,mapOffsetDropTargetX:-.5,mapOffsetDropTargetY:.5,offsetDragFromMenuY:-1.5}),i.z1073.SetColor3FromHex("#F0CCFF",e._colors.cage),e}return __extends(Cage4x3,o),Cage4x3.prototype.init=function(t){t.isMenuItem||t.c,o.prototype.init.call(this,t)},Cage4x3}(i.Cage);i.Cage4x3=t}(z0||(z0={})),function(e){var t=function(){function Cage4x3Config(){this.objName="c8",e.Cage4x3.objectCount=Cage4x3Config.maxObjects}return Cage4x3Config.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,e.Cage4x3,{world:t,shapeName:this.objName})},Cage4x3Config.prototype.getSceneFileNames=function(t){},Cage4x3Config.prototype.getCreateMeshFunctions=function(t){t.Cage4x3MenuButton=this._createMeshes},Cage4x3Config.prototype._createMeshes=function(t,e){var o=BABYLON.MeshBuilder.CreatePlane("Cage4x3MenuButton",{width:4,height:3},t);t.removeMesh(o),o.position.y=1.5,o.bakeCurrentTransformIntoVertices(),e.Cage4x3MenuButton=o},Cage4x3Config.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"Cage4x3",numInstances:Cage4x3Config.maxObjects,maxInstances:Cage4x3Config.maxObjects,isPickable:!1}),t.push({shapeName:this.objName,meshName:"Cage4x3button",numInstances:Cage4x3Config.maxObjects,maxInstances:Cage4x3Config.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName,meshName:"Cage4x3",numInstances:1,maxInstances:1,renderingGroupID:e.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"Cage4x3MenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:e.App.menuRenderingGroupID})},Cage4x3Config.prototype.getTextureDrawFunctions=function(t){},Cage4x3Config.prototype.getz1064Items=function(t){t.push(new e.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Cages",order:7,menuHeight:3.3,menuWidth:4.3,offsetY:-1.5,offsetX:.25,offsetZ:-2}))},Cage4x3Config.maxObjects=4,Cage4x3Config}();e.Cage4x3Config=t,e.App.AddEntityConfig(new t)}(z0||(z0={})),function(i){var t=function(o){function Cage4x4(t){var e=o.call(this,t)||this;return e.width=4,e.height=4,e.depth=4,e.mapPlacementInfo=new i.MapPlacementInfo({mapOffsetX:.5,mapOffsetY:-.5,mapOffsetDropTargetX:-.5,mapOffsetDropTargetY:.5,offsetDragFromMenuY:-2}),i.z1073.SetColor3FromHex("#FFCCCC",e._colors.cage),e}return __extends(Cage4x4,o),Cage4x4.prototype.init=function(t){t.isMenuItem||t.c,o.prototype.init.call(this,t)},Cage4x4}(i.Cage);i.Cage4x4=t}(z0||(z0={})),function(e){var t=function(){function Cage4x4Config(){this.objName="c9",e.Cage4x4.objectCount=Cage4x4Config.maxObjects}return Cage4x4Config.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,e.Cage4x4,{world:t,shapeName:this.objName})},Cage4x4Config.prototype.getSceneFileNames=function(t){},Cage4x4Config.prototype.getCreateMeshFunctions=function(t){t.Cage4x4MenuButton=this._createMeshes},Cage4x4Config.prototype._createMeshes=function(t,e){var o=BABYLON.MeshBuilder.CreatePlane("Cage4x4MenuButton",{width:4,height:4},t);t.removeMesh(o),o.position.y=2,o.bakeCurrentTransformIntoVertices(),e.Cage4x4MenuButton=o},Cage4x4Config.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"Cage4x4",numInstances:Cage4x4Config.maxObjects,maxInstances:Cage4x4Config.maxObjects,isPickable:!1}),t.push({shapeName:this.objName,meshName:"Cage4x4button",numInstances:Cage4x4Config.maxObjects,maxInstances:Cage4x4Config.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName,meshName:"Cage4x4",numInstances:1,maxInstances:1,renderingGroupID:e.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"Cage4x4MenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:e.App.menuRenderingGroupID})},Cage4x4Config.prototype.getTextureDrawFunctions=function(t){},Cage4x4Config.prototype.getz1064Items=function(t){t.push(new e.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Cages",order:9,menuHeight:4.3,menuWidth:4.3,offsetY:-2,offsetX:.25,offsetZ:-2}))},Cage4x4Config.maxObjects=4,Cage4x4Config}();e.Cage4x4Config=t,e.App.AddEntityConfig(new t)}(z0||(z0={})),function(e){var t=function(){function CageConfig(){}return CageConfig.prototype.initObjectPool=function(t){},CageConfig.prototype.getSceneFileNames=function(t){},CageConfig.prototype.getSPSData=function(t){},CageConfig.prototype.getTextureDrawFunctions=function(t){},CageConfig.prototype.getz1064Items=function(t){},CageConfig.prototype.getz49s=function(t){t.push(e.z141)},CageConfig}();e.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(){function CageHoleViewer(t,e){this.meshes=[],this.scene=e,this.cage=t,this.holes=t.body.shapes.holes;var o=this;e.registerBeforeRender(function(){o.update()})}return CageHoleViewer.prototype.update=function(){this.meshes.length,this.holes.length;for(var t=this.meshes.length;t<this.holes.length;t++)this.meshes.push(this._createMesh());for(t=this.holes.length;t<this.meshes.length;t++)this.meshes[t].position.y=999;var e,o,i=CageHoleViewer.tempVecs[0],n=CageHoleViewer.tempVecs[1],s=this.cage.getWorldMatrix(),a=.5*this.cage.height;for(t=0;t<this.holes.length;t++)e=this.meshes[t],o=this.holes[t],n.x=o.xside,n.y=o.yside,n.z=o.zside,i.x=o.x,i.y=o.y+a,i.z=o.z,BABYLON.Vector3.TransformCoordinatesToRef(i,s,i),BABYLON.Vector3.TransformNormalToRef(n,s,n),e.position.x=i.x,e.position.y=i.y,e.position.z=i.z,e.alignWithNormal(n)},CageHoleViewer.prototype._createMesh=function(){return BABYLON.MeshBuilder.CreateCylinder("",{height:.5,diameterTop:.1,diameterBottom:.5},this.scene)},CageHoleViewer.tempVecs=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],CageHoleViewer}();t.CageHoleViewer=e}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z677(){return null!==t&&t.apply(this,arguments)||this}return __extends(z677,t),z677.prototype.update=function(t){if(!t.isMenuItem){var e=t.physics.frontBody.body.position,o=n.Cage.getCageAt(e.x,e.y,e.z);if(t.currentObject&&t.currentObject==o)return t.rearObject!=t.currentObject&&(t.rearObject=t.currentObject),void(t.physics.stayInsideBody=t.currentObject.body);var i=t.currentObject;if(t.currentObject=o,!t.currentObject&&i&&(t.currentObject=i.getNeighborAt(e.x,e.y,e.z)),t.currentObject)t.rearObject!=t.currentObject&&(t.rearObject=t.currentObject),t.physics.stayInsideBody=t.currentObject.body,t.path[t.pathIndex]&&t.pathIndex==t.path.length-1&&t.pathIndex++,0<t.path.length&&(z1083.getSmoothPath(t.path2,t.path,t.path[0],t.path[t.path.length-1]),t.path2Index=3*(t.pathIndex+1))}},z677}(z767),t.z677=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z635(){return null!==t&&t.apply(this,arguments)||this}return __extends(z635,t),z635.prototype.update=function(t){var e=t.currentObject;if(e&&!(t.pathIndex>=t.path.length)){var o=2*t.size,i=e.position.x-.5*e.width+o,n=e.position.x+.5*e.width-o;if(!(t.physics.rearBody.body.position.y<e.bottom)){var s=t.path[t.pathIndex],a=z767.z4[0];t.position.y-s.y>3*t.size||(s.x>n?(a.x=n,a.y=t.position.y,a.z=-1.5,t.setPathTo(t.targets.destTarget,a)):s.x<i&&(a.x=i,a.y=t.position.y,a.z=-1.5,t.setPathTo(t.targets.destTarget,a)))}}},z635}(z767),e.z635=o}(z0||(z0={})),function(a){var t,e;t=a.z156||(a.z156={}),e=function(t){function z557(){return null!==t&&t.apply(this,arguments)||this}return __extends(z557,t),z557.prototype.update=function(t){var e=t.currentObject;if(e&&(e.parent&&(e=e.parent),e.accType==a.z1044.z1048)){var o=2*t.size,i=e.position.x-.5*e.width+o,n=e.position.x+.5*e.width-o,s=t.targets.lookToTarget;if(s.x>n||s.x,!(t.physics.rearBody.body.position.y<e.bottom))s=t.targets.moveToTarget,t.position.y-s.y>3*t.size||(s.x>n?s.x=n:s.x<i&&(s.x=i))}},z557}(z767),t.z557=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z928(){return null!==t&&t.apply(this,arguments)||this}return __extends(z928,t),z928.prototype.test=function(t){var e=t.currentObject;if(e){e.parent&&(e=e.parent);var o=t.physics.frontBody.body.position,i=e.isInside(o.x,o.y,o.z);return i}},z928}(z770),e.z928=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z809(){return null!==t&&t.apply(this,arguments)||this}return __extends(z809,t),z809.prototype.test=function(t,e){return 120<e.numFramesInState},z809}(z770),e.z809=o}(z0||(z0={})),function(o){var t=function(e){function z141(){var t=null!==e&&e.apply(this,arguments)||this;return t.ignoreEvents=[o.ConnectorCageEvents.ENTER],t.enterz156=[o.z156.z406,o.z156.z500,o.z156.z482,o.z156.z677],t.updatez156=[o.z156.z165,o.z156.z708,o.z156.z618,o.z156.z716,o.z156.z235,o.z156.z704,o.z156.z664,o.z156.z557,o.z156.z635,o.z156.z460,o.z156.z446,o.z156.z369,o.z156.z590,o.z156.z362,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z379],t.exitz156=[o.z156.z314,o.z156.z320,o.z156.z494],t.transitions=[{condition:o.z768.z962,trueNode:{state:o.z21,actions:[o.z156.z314]}},{condition:o.z768.z913,trueNode:{state:o.z66,actions:[]}},{condition:o.z768.z873,trueNode:{state:o.z65,actions:[]}},{condition:o.z768.z809,trueNode:{state:o.z108}}],t}return __extends(z141,e),z141}(z49);o.z141=t}(z0||(z0={})),function(l){var t=function(a){function HangingChew(t){var e=a.call(this)||this;return e.accType=l.z1044.z1059,e.pubsub=new Pubsub,e.num=0,e.world=void 0,e.boxSize=0,e.rotation=BABYLON.Vector3.Zero(),e.chews=[],e.meshes=[],e.joints=[],e.draggerBody=void 0,e.draggerJoint=void 0,e.numChews=4,e.bodyRadius=.1,e.shapeName2="",HangingChew.count++,e.num=HangingChew.count,e.position=BABYLON.Vector3.Zero(),e.scaling=new BABYLON.Vector3(1,1,1),e.placementType=l.PlacementType.GRID|l.PlacementType.z1048|l.PlacementType.FRONT_GLASS,e._colors={},e._colors["color 1"]=new BABYLON.Color3(1,0,0),e._colors["color 2"]=new BABYLON.Color3(1,1,0),e._colors["color 3"]=new BABYLON.Color3(0,1,0),e._colors["color 4"]=new BABYLON.Color3(0,0,1),e}return __extends(HangingChew,a),HangingChew.prototype.addToActiveObjects=function(){-1==HangingChew.activeObjects.indexOf(this)&&HangingChew.activeObjects.push(this)},HangingChew.prototype.removeFromActiveObjects=function(){var t=HangingChew.activeObjects.indexOf(this);-1!=t&&HangingChew.activeObjects.splice(t,1)},HangingChew.prototype.init=function(t){a.prototype.init.call(this,t),this.shapeName2=t.shapeName2,this.canRotate=!1,this.canTranslate=!0,this.canDelete=!0,this.world=t.world,this.addToActiveObjects(),this.mapPlacementInfo||(this.mapPlacementInfo=new l.MapPlacementInfo({mapPlacementSizeX:.25,mapPlacementSizeY:.25})),this.controlAnchor||this.addControlAnchor(),this.controlPositionLocal.x=0,this.controlPositionLocal.y=.5*this.height-.1,this.controlPositionLocal.z=.5*-this.depth;var e=0,o=0;if(null!=t.x&&(e=t.x),null!=t.y&&(o=t.y),t.isMenuItem&&t.isMenuItem,!this.hitMeshes){var i=2*this.bodyRadius,n=2*this.bodyRadius;t.hitWidth&&(i=t.hitWidth),t.hitHeight&&(n=t.hitHeight),this.hitMeshes=[];var s=l.app.graphicsHelper.getHitMesh(i,n,2*this.bodyRadius,!1);this.hitMeshes.push(s)}if(null!=t.renderingGroupID&&null!=t.renderingGroupID&&(this.renderingGroupID=t.renderingGroupID),0==this.chews.length&&this.createChews(),this.disablePhysics(),this.removeFromScene(),this._initColors(),this.setPosition(e,o,-1.7),this.draggerMesh.requestDepthSort=!0,!this.isMenuItem)if(t.skipAddToScene)this.removeFromScene();else{if(this.addToScene(),this.cage||(this.cage=l.Cage.getCageAt(this.position.x,this.position.y+.5*this.height,this.position.z)),!this.cage)return;this.cage.isReady?this.addToObject(this.cage):this.cage.pubsub.subscribe("ready",this.addToObject,this)}},HangingChew.prototype.createChews=function(){var t="hangingChew"+HangingChew.count;this.isMenuItem;for(var e=this.bodyRadius,o=0;o<this.numChews;o++){var i;o%2?(i=new l.SimpleChew2).init({isMenuItem:this.isMenuItem,x:0,y:0+o*e,z:0,bodyRadius:e,renderingGroupID:this.renderingGroupID,parent:this,shapeName:"sw",world:this.world,radius:.1,meshType:"box"}):(i=new l.SimpleChew2).init({isMenuItem:this.isMenuItem,x:0,y:0+o*e,z:0,bodyRadius:e,renderingGroupID:this.renderingGroupID,parent:this,shapeName:"sw",world:this.world,radius:.1}),this.isMenuItem&&i.removeFromActiveObjects(),this.chews.push(i),this.meshes.push(i.mesh),i.placementType=void 0,i.saveToDB=!1}var n=l.App.PhysicsGroupDragger,s=[1,1,1];s[3]=n,s[4]=n,s[3]=null,s[4]=null;var a=l.app.graphicsHelper.scene;this.draggerMesh=ObjectPool.get("hanger",{renderingGroupID:this.renderingGroupID,scene:a,textureName:"tubeStraightTexture"}),this.draggerMesh.removeFromScene(),this.draggerBody=new OIMO.Body({type:"sphere",size:[.1,.1,.1],pos:[0,0,0],rot:[0,0,0],move:!1,world:this.world,name:t+"_dragger",config:s}).body,l.app.graphicsHelper.addObject(this,this.draggerMesh),(this.draggerMesh.parent=this).isMenuItem,this.isMenuItem;for(o=0;o<this.chews.length;o++)this.chews[o].addToScene();var r={name:"bodyDraggerJoint",type:"jointDistance",body1:this.draggerBody,body2:this.chews[0].dynamicBody,min:0,max:this.bodyRadius,pos1:[0,0,0],pos2:[0,this.bodyRadius,0],collision:!1,spring:[100,1],world:this.world};this.draggerJoint=new OIMO.Link(r).joint,this.joints.push(this.draggerJoint);for(o=0;o<this.numChews-1;o++){var c=2*e,d={type:"jointBall",body1:this.chews[o].dynamicBody,body2:this.chews[o+1].dynamicBody,pos1:[0,0,0],pos2:[0,c,0],collision:!1,world:this.world},p=new OIMO.Link(d).joint;this.joints.push(p)}},HangingChew.prototype.createMeshes=function(){},HangingChew.prototype.update=function(){this.draggerMesh&&(this.isMenuItem||(this.draggerMesh.position.x=this.draggerBody.position.x,this.draggerMesh.position.y=this.draggerBody.position.y,this.draggerMesh.position.z=this.draggerBody.position.z))},HangingChew.prototype.setPositionOnMapFromDrop=function(t,e,o){a.prototype.setPositionOnMapFromDrop.call(this,t,e,o)},HangingChew.prototype.setHitMesh=function(t,e,o){if(this.hitMeshes&&this.hitMeshes[0]){var i=this.hitMeshes[0];i.position.x=t,i.position.y=e+.5*this.height,i.position.z=o,i.computeWorldMatrix()}},HangingChew.prototype.removeVelocity=function(){for(var t=0;t<this.chews.length;t++)this.chews[t].removeVelocity()},HangingChew.prototype.translate=function(t,e,o){var i=this.draggerBody;i.position.x+=t,i.position.y+=e,i.position.z+=o,this.position.x=i.position.x,this.position.y=i.position.y,this.position.z=i.position.z;var n=i.shapes;n.position.x=i.position.x,n.position.y=i.position.y,n.position.z=i.position.z,n.updateProxy();for(var s=0;s<this.chews.length;s++)this.chews[s].translate(t,e,o);this.draggerMesh.translate(t,e,o),this.draggerMesh.position},HangingChew.prototype.setPositionDrag=function(t,e,o,i){var n=this.draggerBody,s=n.position;if(this.isDragging||(this.draggerMesh.requestDepthSort=!0,this.setPosition(t,e,o),this.isDragging=!0,this.cage&&this.addToObject(null)),i)return this.draggerMesh.requestDepthSort=!0,this.updateCage(),this.isDragging=!1,void this.setPosition(t,e,o);s.x=t,s.y=e,s.z=o;var a=n.shapes.position;a.x=t,a.y=e,a.z=o,n.shapes.updateProxy(),this.draggerMesh.setPosition(t,e,o)},HangingChew.prototype.updateCage=function(){var t=l.Cage.getCageAt(this.position.x,this.position.y+.5*this.height,this.position.z);this.addToObject(t)},HangingChew.prototype.setPosition=function(t,e,o,i){void 0===i&&(i=!1),this.position.x=t,this.position.y=e,this.position.z=o,this.isMenuItem||this.cage||this.updateCage(),this.position.x=t,this.position.y=e,this.position.z=o,this.setHitMesh(t,e,o),this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position);var n=this.draggerBody;n.position.x=t,n.position.y=e,n.position.z=o,this.draggerMesh&&this.draggerMesh.setPosition(t,e,o),n.linearVelocity.x=0,n.linearVelocity.y=0,n.linearVelocity.z=0,n.angularVelocity.x=0,n.angularVelocity.y=0,n.angularVelocity.z=0;var s=n.shapes;s.position.x=n.position.x,s.position.y=n.position.y,s.position.z=n.position.z,n.syncShapes();var a=-9999;if(this.cage&&o>this.cage.front){a=this.cage.bottom+this.bodyRadius;var r=this.cage.getPlatformUnder(t,e,o);r&&(a=r.position.y+this.bodyRadius)}for(var c=2.2*this.bodyRadius,d=1.1*-this.bodyRadius,p=0;p<this.chews.length;p++){var l=e-c*p+d;l<a&&(l=a),this.chews[p].isOnScene||this.chews,this.chews[p].dynamicBody||this.chews,this.chews[p].setPosition(t,l,o)}this.onChangeObservable.notifyObservers(this)},HangingChew.prototype.setRotation=function(t,e,o){},HangingChew.prototype.enablePhysics=function(){this.draggerBody.parent||this.world.addRigidBody(this.draggerBody);for(var t=0;t<this.numChews;t++)this.chews[t].enablePhysics();for(t=0;t<this.numChews;t++){var e=this.joints[t];e.parent||this.world.addJoint(e)}},HangingChew.prototype.disablePhysics=function(){var t=this.draggerBody;t.parent&&this.world.removeRigidBody(t);for(var e=0;e<this.numChews;e++)this.chews[e].disablePhysics()},HangingChew.prototype.addToScene=function(){if(!this.isOnScene){a.prototype.addToScene.call(this);for(var t=0;t<this.numChews;t++)this.chews[t].addToScene(),this.isMenuItem||this.chews[t].addItemCount(1),this.draggerMesh.addToScene();this.enablePhysics(),l.app.graphicsHelper.addForUpdate(this)}},HangingChew.prototype.removeFromScene=function(){if(this.isOnScene){this.disablePhysics(),a.prototype.removeFromScene.call(this);for(var t=0;t<this.numChews;t++)this.chews[t].removeFromScene();this.draggerMesh.removeFromScene(),l.app.graphicsHelper.removeFromUpdate(this)}},HangingChew.prototype.recycle=function(){this.setPosition(9999,9999,9999),a.prototype.recycle.call(this)},HangingChew.prototype.setColor=function(t,e,o,i){a.prototype.setColor.call(this,t,e,o,i),"color 1"==i?this.chews[0].setColor(t,e,o):"color 2"==i?this.chews[1].setColor(t,e,o):"color 3"==i?this.chews[2].setColor(t,e,o):"color 4"==i&&this.chews[3].setColor(t,e,o)},HangingChew.prototype.getName=function(){return this._className},HangingChew.prototype.getProps=function(){return a.prototype.getProps.call(this)},HangingChew.prototype.getCenterAtPosToRef=function(t,e,o,i){i.x=t,i.y=e+.5*this.height,i.z=o},HangingChew.prototype.addToObject=function(t){if(this.cage&&this.cage!=t&&this.cage.removeObject(this),this.parent=t,this.cage=t){t.addObject(this);for(e=0;e<this.chews.length;e++)this.chews[e].addToObject(t),this.chews[e].parent=this}else for(var e=0;e<this.chews.length;e++)this.chews[e].addToObject(null),this.chews[e].parent=this},HangingChew.prototype.isValidDropLocation=function(t,e,o){var i=this._tempDropLoc;this.getPositionOnMapFromDropToRef(t,e,o,i);var n=l.Cage.getCageAt(i.x,i.y,i.z);if(!n)return!1;if(this.hitMeshes&&this.hitMeshes[0]){var s=this.hitMeshes[0],a=s.position.x,r=s.position.y,c=s.position.z;this.setHitMesh(i.x,i.y,i.z);var d=HangingChew.tempArr;d.length=0,n.getObjectsByz1044(l.z1044.z1056|l.z1044.z1059|l.z1044.z1049,d,!0);var p=this.intersectsAccesories(d);if(s.position.x=a,s.position.y=r,s.position.z=c,s.computeWorldMatrix(),p)return!1}return!0},HangingChew.tempVecs=[new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3],HangingChew.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],HangingChew.tempArr=[],HangingChew.count=0,HangingChew.activeObjects=[],HangingChew}(l.z1092);l.HangingChew=t}(z0||(z0={})),function(e){var t=function(){function HangingChewConfig(){this.maxObjects=5,this.objName="hc",e.HangingChew.objectCount=this.maxObjects}return HangingChewConfig.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,e.HangingChew,{shapeName:this.objName,shapeName2:"ch",world:t,hitWidth:.45,hitHeight:.45}),ObjectPool.addClass("hanger",z1068,{shapeName:"hanger"})},HangingChewConfig.prototype.getSceneFileNames=function(t){},HangingChewConfig.prototype.getCreateMeshFunctions=function(t){t.HangingChewMenuButton=this._createMeshes},HangingChewConfig.prototype._createMeshes=function(t,e){var o=BABYLON.MeshBuilder.CreatePlane("HangingChewMenuButton",{width:1,height:1},t);t.removeMesh(o),o.position.y=.5,o.bakeCurrentTransformIntoVertices(),e.HangingChewMenuButton=o},HangingChewConfig.prototype.getChildSPSData=function(t){t[this.objName]||(t[this.objName]={}),t[this.objName].hanger=1},HangingChewConfig.prototype.getSPSData=function(t){t.push({shapeName:"hanger",meshName:"suction_cup",numInstances:this.maxObjects,maxInstances:this.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:"hanger",meshName:"suction_cup",numInstances:this.maxObjects,maxInstances:this.maxObjects,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0}),t.push({shapeName:"hanger",meshName:"suction_cup",numInstances:this.maxObjects,maxInstances:this.maxObjects,renderingGroupID:e.App.menuRenderingGroupID,isPickable:!0,hideButton:!0}),t.push({shapeName:"hanger",meshName:"suction_cup",numInstances:1,maxInstances:1,renderingGroupID:e.App.menuRenderingGroupID,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0})},HangingChewConfig.prototype.getTextureDrawFunctions=function(t){},HangingChewConfig.prototype.getz1064Items=function(t){t.push(new e.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Bowls",order:4,menuHeight:1.3,menuWidth:.5,countLabelY:-.5,offsetY:.3}))},HangingChewConfig.prototype.getz49s=function(t){},HangingChewConfig}();e.App.AddEntityConfig(new t)}(z0||(z0={})),function(p){var t=function(s){function SimpleChew(){var t=s.call(this)||this;return t.accType=p.z1044.z1058,t.pubsub=new Pubsub,t.num=0,t.world=void 0,t.boxSize=0,t.rotation=BABYLON.Vector3.Zero(),t.dynamicBody=void 0,t.mesh=void 0,t.draggerMesh=void 0,t.draggerBody=void 0,t.draggerJoint=void 0,t.radius=.1,t.meshType="sphere",t.prize=void 0,t.defaultPlacementType=t.placementType=p.PlacementType.z1048|p.PlacementType.FRONT,t._tempVec=new OIMO.Vec3,SimpleChew.count++,t.num=SimpleChew.count,t.position=BABYLON.Vector3.Zero(),t.scaling=new BABYLON.Vector3(1,1,1),t.placementType=t.defaultPlacementType,t.color=new BABYLON.Color4(1,.6,.2,1),t}return __extends(SimpleChew,s),SimpleChew.prototype.addToActiveObjects=function(){-1==SimpleChew.activeObjects.indexOf(this)&&SimpleChew.activeObjects.push(this)},SimpleChew.prototype.removeFromActiveObjects=function(){var t=SimpleChew.activeObjects.indexOf(this);-1!=t&&SimpleChew.activeObjects.splice(t,1)},SimpleChew.prototype.init=function(t){s.prototype.init.call(this,t),t.radius&&(this.radius=t.radius),t.parent&&(this.parent=t.parent),this.canRotate=!1,this.canTranslate=!0,this.canDelete=!0,this.world=t.world,this.placementType=this.defaultPlacementType,this.addToActiveObjects(),this.mapPlacementInfo||(this.mapPlacementInfo=new p.MapPlacementInfo({mapPlacementSizeX:.25,mapPlacementSizeY:.25})),this.controlAnchor||this.addControlAnchor(),this.controlPositionLocal.x=0,this.controlPositionLocal.y=.5*this.height+.2,this.controlPositionLocal.z=.5*-this.depth;var e=0,o=0,i=-1.5;if(null!=t.x&&(e=t.x),null!=t.y&&(o=t.y),null!=t.z&&(i=t.z),null!=t.bodyRadius&&(this.radius=t.bodyRadius),t.isMenuItem&&t.isMenuItem,null!=t.meshType&&(this.meshType=t.meshType),!this.hitMeshes){this.hitMeshes=[];var n=p.app.graphicsHelper.getHitMesh(2*this.radius,2*this.radius,2*this.radius);this.hitMeshes.push(n)}if(null!=t.renderingGroupID&&null!=t.renderingGroupID&&(this.renderingGroupID=t.renderingGroupID),this.dynamicBody||(this.createPhysics(e,o,i,t.collidesWith),this.disablePhysics(),this.createMesh(),this.removeFromScene()),this._initColors(),this.mesh.scaling.x=2*this.radius,this.mesh.scaling.y=2*this.radius,this.mesh.scaling.z=2*this.radius,this.setPosition(e,o,i),!this.isMenuItem)if(t.skipAddToScene)this.removeFromScene();else{if(this.addToScene(),this.cage||(this.cage=p.Cage.getCageAt(this.position.x,this.position.y+.5*this.height,this.position.z)),!this.cage)return;this.cage.isReady?this.addToObject(this.cage):this.cage.pubsub.subscribe("ready",this.addToObject,this)}},SimpleChew.prototype.moveDragJointTo=function(t){var e=this.draggerJoint.localAnchorPoint2;z1.getOIMOLocalPositionFromGlobalToRef(this.dynamicBody,t,e);var o=e.x,i=e.y,n=e.z,s=o*o+i*i+n*n;if(s>this.radius*this.radius){var a=Math.sqrt(s);e.x=o/a*this.radius,e.y=i/a*this.radius,e.z=n/a*this.radius}},SimpleChew.prototype.createPhysics=function(t,e,o,i){var n=this.radius,s="simpleChew"+SimpleChew.count;(r=[1,1,.5])[3]=p.App.z1036,r[4]=p.App.z1033|p.App.PhysicsGroupBedding|p.App.z1036|p.App.z1037|p.App.z1035|p.App.z1034,i&&(r[4]=i),this.isMenuItem&&(r[3]=p.App.z10332Menu,r[4]=p.App.z10332Menu);var a=new OIMO.Body({type:"holey_sphere",size:[n],pos:[t,e,o],rot:[0,0,0],move:!0,world:this.world,name:s,config:r}).body;a.allowSleep=!1,this.dynamicBody=a;var r,c=p.App.PhysicsGroupDragger;(r=[1,1,1])[3]=c,r[4]=c,r[3]=null,r[4]=null;this.draggerBody=new OIMO.Body({type:"sphere",size:[.1,.1,.1],pos:[0,0,0],rot:[0,0,0],move:!1,world:this.world,name:s+"_dragger",config:r}).body;var d={name:"bodyDraggerJoint",type:"jointDistance",body1:s+"_dragger",body2:s,min:0,max:.01,pos1:[0,0,0],pos2:[0,0,0],collision:!1,spring:[7,.1],world:this.world};this.draggerJoint=new OIMO.Link(d).joint,this.isMenuItem||this.world.removeRigidBody(this.draggerBody)},SimpleChew.prototype.createMesh=function(){var t,e=p.app.graphicsHelper.scene,o=this.renderingGroupID,i=z3.GetMesh("simpleChewSphere_rg"+o),n=z3.GetMesh("simpleChewBox_rg"+o),s="simpleChew"+SimpleChew.count;"box"==this.meshType?(t=n.createInstance(s)).instancedBuffers.color=new BABYLON.Color4(1,1,1,1):(t=i.createInstance(s)).instancedBuffers.color=new BABYLON.Color4(1,1,1,1),t.instancedBuffers.tileOffset=BABYLON.Vector4.Zero();TileSet.TileInfos.chewTile1.tileSet.setUVFromTileName("chewTile1",t.instancedBuffers.tileOffset),t.rotationQuaternion=BABYLON.Quaternion.Identity(),this.mesh=t,e.removeMesh(t),p.app.graphicsHelper.addObject(this,t)},SimpleChew.prototype.update=function(){var t=this.mesh,e=this.dynamicBody,o=t.rotationQuaternion,i=e.orientation;o.x==i.x&&o.y==i.y&&o.z==i.z&&o.w==i.s||(t.rotationQuaternion.x=e.orientation.x,t.rotationQuaternion.y=e.orientation.y,t.rotationQuaternion.z=e.orientation.z,t.rotationQuaternion.w=e.orientation.s);var n=t.position,s=e.position;if(n.x=s.x,n.y=s.y,n.z=s.z,e.linearVelocity.x*=.97,e.linearVelocity.y*=.97,e.linearVelocity.z*=.97,e.angularVelocity.x*=.97,e.angularVelocity.y*=.97,e.angularVelocity.z*=.97,this.draggerMesh&&this.draggerMesh.position.copyFrom(this.draggerBody.position),this.prize){var a=this.prize.dynamicBody.position,r=a.x-s.x,c=a.y-s.y,d=a.z-s.z,p=r*r+c*c+d*d,l=this.radius-this.prize.radius;if(l*l*2<p){var u=SimpleChew.z4[0];u.x=r,u.y=c,u.z=d,u.normalize(),a.x=s.x+u.x*l,a.y=s.y+u.y*l,a.z=s.z+u.z*l;var y=this.prize.dynamicBody.shapes.position;y.x=a.x,y.y=a.y,y.z=a.z,this.prize.dynamicBody.syncShapes()}}if(this.cage){var g=this.cage.top;this.cage.bottom,this.cage.right,this.cage.left;s.y>g-this.radius-this.cage.wallThickness&&(s.y=g-this.radius-this.cage.wallThickness,this.dynamicBody.shapes.y=s.y,this.dynamicBody.linearVelocity.y*=-.5,this.dynamicBody.syncShapes())}this.position.x=s.x,this.position.y=s.y,this.position.z=s.z,this.controlAnchor.position.x=s.x+this.controlPositionLocal.x,this.controlAnchor.position.y=s.y+this.controlPositionLocal.y,this.controlAnchor.position.z=s.z+this.controlPositionLocal.z,this.debugAxesViewer&&this.debugAxesViewer.update()},SimpleChew.prototype.setHitMesh=function(t,e,o){if(this.hitMeshes&&this.hitMeshes[0]){var i=this.hitMeshes[0];i.position.x=t,i.position.y=e+.5*this.height,i.position.z=o,i.computeWorldMatrix()}},SimpleChew.prototype.removeVelocity=function(){var t=this.dynamicBody;t.linearVelocity.x=0,t.linearVelocity.y=0,t.linearVelocity.z=0,t.angularVelocity.x=0,t.angularVelocity.y=0,t.angularVelocity.z=0},SimpleChew.prototype.translate=function(t,e,o){(i=this.draggerBody)&&(i.position.x+=t,i.position.y+=e,i.position.z+=o,this.position.x=i.position.x,this.position.y=i.position.y,this.position.z=i.position.z,(n=i.shapes).position.x=i.position.x,n.position.y=i.position.y,n.position.z=i.position.z,n.updateProxy());(i=this.dynamicBody).position.x+=t,i.position.y+=e,i.position.z+=o,(n=i.shapes).position.x=i.position.x,n.position.y=i.position.y,n.position.z=i.position.z,n.updateProxy();var i,n,s=this.mesh;(s.position.x=i.position.x,s.position.y=i.position.y,s.position.z=i.position.z,this.prize)&&((i=this.prize.body).position.x+=t,i.position.y+=e,i.position.z+=o,this.position.copyFrom(i.position),(n=i.shapes).position.x=i.position.x,n.position.y=i.position.y,n.position.z=i.position.z,n.updateProxy())},SimpleChew.prototype.getLocalPosFromWorldPosInBody=function(t,e,o,i){z1.getOIMOLocalPositionFromGlobalToRef(e,t,o);var n=o.x,s=o.y,a=o.z,r=n*n+s*s+a*a;if(i*i<r){var c=Math.sqrt(r);o.x=n/c*i,o.y=s/c*i,o.z=a/c*i}},SimpleChew.prototype.addDragJointAt=function(t,e,o,i,n){var s=this.draggerJoint,a=this._tempVec;this.getLocalPosFromWorldPosInBody(t,e,a,i);var r=a.x,c=a.y,d=a.z;this.getLocalPosFromWorldPosInBody(t,o,a,n);var p=a.x,l=a.y,u=a.z;s.parent&&this.world.removeJoint(s),s.body1=e,s.localAnchorPoint1.x=r,s.localAnchorPoint1.y=c,s.localAnchorPoint1.z=d,s.body2=o,s.localAnchorPoint2.x=p,s.localAnchorPoint2.y=l,s.localAnchorPoint2.z=u;var y=s.t,b1=e,b2=o;y.b1=b1,y.b2=b2,y.l1=b1.linearVelocity,y.l2=b2.linearVelocity,y.a1=b1.angularVelocity,y.a2=b2.angularVelocity,y.i1=b1.inverseInertia,y.i2=b2.inverseInertia,this.world.addJoint(s)},SimpleChew.prototype.removeDragObjJoint=function(){var t=this.draggerJoint;t&&t.parent&&this.world.removeJoint(t)},SimpleChew.prototype.setPositionDrag=function(t,e,o,i){if(this.draggerBody&&!this.draggerBody.parent&&(this.world.addRigidBody(this.draggerBody),this.world.addJoint(this.draggerJoint)),!this.isDragging&&(this.setPosition(t,e,o),this.isDragging=!0,this.cage)){var n=this.parent;this.cage.removeObject(this),this.cage=null,n&&n.accType==p.z1044.z1059&&(this.parent=n)}var s,a,r;(i&&(this.draggerBody&&this.draggerBody.parent&&this.world.removeRigidBody(this.draggerBody),this.position.x=t,this.position.y=e,this.position.z=o,this.updateCage(),this.isDragging=!1),this.draggerBody)&&((a=(s=this.draggerBody).position).x=t,a.y=e,a.z=o,(r=s.shapes.position).x=t,r.y=e,r.z=o,s.shapes.updateProxy());this.draggerBody&&this.draggerBody.parent||((a=(s=this.dynamicBody).position).x=t,a.y=e,a.z=o,(r=s.shapes.position).x=t,r.y=e,r.z=o,s.shapes.updateProxy())},SimpleChew.prototype.updateCage=function(){var t=p.Cage.getCageAt(this.position.x,this.position.y+.5*this.height,this.position.z);this.addToObject(t)},SimpleChew.prototype.setPositionOnMapFromDrop=function(t,e,o){this.setPositionDrag(t,e,o,!0)},SimpleChew.prototype.setPosition=function(t,e,o,i){(void 0===i&&(i=!1),this.position.x=t,this.position.y=e,this.position.z=o,this.isMenuItem||this.cage||this.updateCage(),this.position.x=t,this.position.y=e,this.position.z=o,this.setHitMesh(t,e,o),this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position),n=this.draggerBody)&&(n.position.x=t,n.position.y=e,n.position.z=o,n.linearVelocity.x=0,n.linearVelocity.y=0,n.linearVelocity.z=0,n.angularVelocity.x=0,n.angularVelocity.y=0,n.angularVelocity.z=0,(d=n.shapes).position.x=n.position.x,d.position.y=n.position.y,d.position.z=n.position.z,n.syncShapes());this.draggerMesh&&this.draggerMesh.position.copyFrom(this.draggerBody.position);var n,s=-9999;if(this.cage&&o>this.cage.front){s=this.cage.bottom+this.radius;var a=this.cage.getPlatformUnder(t,e,o);a&&(s=a.position.y+this.radius)}(n=this.dynamicBody).linearVelocity.x=0,n.linearVelocity.y=0,n.linearVelocity.z=0,n.angularVelocity.x=0,n.angularVelocity.y=0,n.angularVelocity.z=0,n.position.x=t;var r=e;r<s&&(r=s),n.position.y=r,n.position.z=o,(d=n.shapes).position.x=n.position.x,d.position.y=n.position.y,d.position.z=n.position.z,n.syncShapes();var c=this.mesh;if(c.position.x=n.position.x,c.position.y=n.position.y,c.position.z=n.position.z,this.prize){var d,p=n.position.x,l=n.position.z,u=this.prize.dynamicBody;u.linearVelocity.x=0,u.linearVelocity.y=0,u.linearVelocity.z=0,u.angularVelocity.x=0,u.angularVelocity.y=0,u.angularVelocity.z=0,u.position.x=p,u.position.y=r,u.position.z=l,(d=u.shapes).position.x=p,d.position.y=r,d.position.z=l,u.syncShapes()}this.onChangeObservable.notifyObservers(this)},SimpleChew.prototype.setRotation=function(t,e,o){},SimpleChew.prototype.disablePhysics=function(){this.draggerBody&&this.draggerBody.parent&&this.world.removeRigidBody(this.draggerBody),this.dynamicBody&&this.dynamicBody.parent?this.world.removeRigidBody(this.dynamicBody):this.world,this.prize&&this.prize.disablePhysics()},SimpleChew.prototype.enablePhysics=function(){this.dynamicBody&&this.dynamicBody.parent||(this.world.addRigidBody(this.dynamicBody),this.draggerBody&&!this.draggerBody.parent&&this.isMenuItem&&(this.world.addRigidBody(this.draggerBody),this.world.addJoint(this.draggerJoint)),this.prize&&this.prize.enablePhysics())},SimpleChew.prototype.addToScene=function(){if(!this.isOnScene){s.prototype.addToScene.call(this),this.isOnScene=!0,this.enablePhysics();var t=this.mesh;p.app.graphicsHelper.scene.addMesh(t),p.app.graphicsHelper.addForUpdate(this),this.prize&&this.prize.addToScene()}},SimpleChew.prototype.removeFromScene=function(){if(this.isOnScene){s.prototype.removeFromScene.call(this),this.disablePhysics();var t=this.mesh;p.app.graphicsHelper.scene.removeMesh(t),p.app.graphicsHelper.removeFromUpdate(this),this.prize&&this.prize.removeFromScene()}},SimpleChew.prototype.recycle=function(){this.setPosition(9999,9999,9999),this.cage&&this.cage.removeObject(this),s.prototype.recycle.call(this)},SimpleChew.prototype.setColor=function(t,e,o,i){s.prototype.setColor.call(this,t,e,o,i),this.mesh&&(this.mesh.instancedBuffers.color.r=t,this.mesh.instancedBuffers.color.g=e,this.mesh.instancedBuffers.color.b=o)},SimpleChew.prototype.getName=function(){return this._className},SimpleChew.prototype.getProps=function(){return s.prototype.getProps.call(this)},SimpleChew.prototype.getCenterAtPosToRef=function(t,e,o,i){i.x=t,i.y=e+.5*this.height,i.z=o},SimpleChew.prototype.addToObject=function(t){var e=this.parent;this.cage&&this.cage!=t&&this.cage.removeObject(this),e&&e.accType==p.z1044.z1059?this.parent=e:this.parent=t,(this.cage=t)&&t.addObject(this)},SimpleChew.prototype.isValidDropLocation=function(t,e,o){var i=this._tempDropLoc;return this.getPositionOnMapFromDropToRef(t,e,o,i),!!p.Cage.getCageAt(i.x,i.y,i.z)},SimpleChew.tempVecs=[new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3],SimpleChew.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],SimpleChew.tempArr=[],SimpleChew.count=0,SimpleChew.activeObjects=[],SimpleChew}(p.z1092);p.SimpleChew=t}(z0||(z0={})),function(t){var e=function(t){function SimpleChew2(){return null!==t&&t.apply(this,arguments)||this}return __extends(SimpleChew2,t),SimpleChew2}(t.SimpleChew);t.SimpleChew2=e}(z0||(z0={})),function(e){var t=function(){function SimpleChewConfig(){this.maxObjects=10,this.objName="ch",e.SimpleChew.objectCount=this.maxObjects}return SimpleChewConfig.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,e.SimpleChew,{shapeName:this.objName,world:t,radius:.15})},SimpleChewConfig.prototype.getSceneFileNames=function(t){},SimpleChewConfig.prototype.getCreateMaterialFunctions=function(t){t.discard_alpha=this._createMeshes},SimpleChewConfig.prototype.getCreateMeshFunctions=function(t){t.SimpleChewMenuButton=this._createMeshes,t.simpleChewSphere_rg0=this._createMeshes,t.simpleChewSphere_rg1=this._createMeshes,t.simpleChewBox_rg0=this._createMeshes,t.simpleChewBox_rg1=this._createMeshes},SimpleChewConfig.prototype._createMeshes=function(t,e,o,i,n){var s=BABYLON.MeshBuilder.CreatePlane("SimpleChewMenuButton",{width:1,height:1},t);t.removeMesh(s),s.position.y=.5,s.bakeCurrentTransformIntoVertices(),e.SimpleChewMenuButton=s;var a=new BABYLON.CustomMaterial("chewMat",t);a.AddAttribute("tileOffset"),a.Vertex_Definitions("\n                attribute vec4 tileOffset;\n                varying vec4 vTileOffset;\n            "),a.Vertex_MainEnd("\n                vTileOffset = tileOffset;\n            "),a.Fragment_Definitions("\n                varying vec4 vTileOffset;\n            "),a.Fragment_Custom_Diffuse("\n                float fx = 1. - clamp(fract(vDiffuseUV.x), 0., 1.); \n                float fy = clamp(fract(vDiffuseUV.y), 0., 1.);\n                vec2 uvCoord = vec2(vTileOffset.x + fx * (vTileOffset.z-vTileOffset.x), vTileOffset.y + fy * (vTileOffset.w-vTileOffset.y));\n                baseColor = texture2D(diffuseSampler, uvCoord);\n                if(baseColor.x < .9 && baseColor.y < .9 && baseColor.z < .9){\n                    discard;\n                }\n                baseColor *= vColor;\n            "),a.specularColor.r=0,a.specularColor.g=0,a.specularColor.b=0,a.diffuseColor=new BABYLON.Color3(1,1,1),a.backFaceCulling=!1,a.diffuseTexture=n.accTileSet.getTexture(),o.discard_alpha=a;var r=e.simpleChew0;t.removeMesh(r),r.material=a,r.registerInstancedBuffer("color",4),r.registerInstancedBuffer("tileOffset",4),r.instancedBuffers.color=new BABYLON.Color4(1,0,0,1),r.instancedBuffers.tileOffset=new BABYLON.Vector4(1,1,1,1),e.simpleChewSphere_rg0=r,(r=e.simpleChew1).material=a,r.registerInstancedBuffer("color",4),r.registerInstancedBuffer("tileOffset",4),r.instancedBuffers.color=new BABYLON.Color4(1,0,0,1),r.instancedBuffers.tileOffset=new BABYLON.Vector4(1,1,1,1),r.renderingGroupId=1,t.removeMesh(r),e.simpleChewSphere_rg1=r,(r=e.boxChew0).material=o.default0,r.registerInstancedBuffer("color",4),r.registerInstancedBuffer("tileOffset",4),r.instancedBuffers.color=new BABYLON.Color4(1,0,0,1),r.instancedBuffers.tileOffset=new BABYLON.Vector4(1,1,1,1),t.removeMesh(r),e.simpleChewBox_rg0=r,(r=e.boxChew1).material=o.default0,r.registerInstancedBuffer("color",4),r.registerInstancedBuffer("tileOffset",4),r.instancedBuffers.color=new BABYLON.Color4(1,0,0,1),r.instancedBuffers.tileOffset=new BABYLON.Vector4(1,1,1,1),r.renderingGroupId=1,t.removeMesh(r),e.simpleChewBox_rg1=r},SimpleChewConfig.prototype.getSPSData=function(t){},SimpleChewConfig.prototype.getTextureDrawFunctions=function(t){t.chewTile1=function(t,e,o){var i=e,n=o;t.save(),t.beginPath(),t.rect(0,0,i,n),t.clip(),t.fillStyle="rgba(225, 225, 225, 1)",t.fillRect(0,0,e,o),t.strokeStyle="rgba(255, 255, 255, .5)";var s=[];t.lineWidth=6,t.beginPath();for(var a=0;a<100;a++){var r=Math.random()*Math.PI,c=Math.cos(r),d=Math.sin(r),p=Math.random()*i,l=Math.random()*n,u=p-c*e,y=l-d*e,g=p+c*e,m=l+d*e;t.moveTo(u,y),t.lineTo(g,m),s.push(u),s.push(y),s.push(g),s.push(m)}t.stroke(),t.lineWidth=8,t.beginPath();for(a=0;a<s.length;a+=4){var f=s[a],A=s[a+1],b=s[a+2],v=s[a+3];t.moveTo(f,A),t.lineTo(b,v)}t.stroke(),t.restore()}},SimpleChewConfig.prototype.getz1064Items=function(t){t.push(new e.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Bowls",order:3,menuHeight:1.3,menuWidth:.5,countLabelY:-.25}))},SimpleChewConfig.prototype.getz49s=function(t){},SimpleChewConfig}();e.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z763(){return null!==t&&t.apply(this,arguments)||this}return __extends(z763,t),z763.prototype.update=function(t){t.levels.chew.step(2)},z763}(z767),e.z763=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z756(){return null!==t&&t.apply(this,arguments)||this}return __extends(z756,t),z756.prototype.update=function(t){var e=t.targetObject,o=t.bones.mouth;o.update();var i=t.physics.frontBody.body,n=e.dynamicBody,s=i.shapes.radius+0,a=n.shapes.radius+0;t.physics.addDragJointAt(o.worldPos,i,n,s,a),t.cage},z756}(z767),e.z756=o}(z0||(z0={})),function(l){var t,e;t=l.z156||(l.z156={}),e=function(t){function z703(){return null!==t&&t.apply(this,arguments)||this}return __extends(z703,t),z703.prototype.update=function(t){if(t.targetObject&&t.targetObject.accType==l.z1044.z1058){var e=t.targetObject;if(e.parent){var o=e.parent;if(o.cage==t.cage){var i=o.chews,n=i.indexOf(e),s=i[n+1],a=i[n-1],r=!1,c=!1,d=6*t.size,p=t.cage.getHeightAt(o.position.x,o.position.z);if(s&&(r=!0),a)a.position.y-p<d&&(c=!0);r&&c?Math.random()<.5?(t.targetObject=s,t.usingObject=s):(t.targetObject=a,t.usingObject=a):(c&&(t.targetObject=a,t.usingObject=a),r&&(t.targetObject=s,t.usingObject=s))}}}},z703}(z767),t.z703=e}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z619(){return null!==t&&t.apply(this,arguments)||this}return __extends(z619,t),z619.prototype.update=function(t){if(!t.isTouchingGround()){var e=t.targetObject;e&&e.accType==o.z1044.z1058&&e.parent&&e.parent.accType==o.z1044.z1059&&t.forceTouchGround()}},z619}(z767),t.z619=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z588(){var t=null!==e&&e.apply(this,arguments)||this;return t.distAbove=.05,t.disableDist=.14,t}return __extends(z588,e),z588.prototype.update=function(t){var e=z767.tempBabMats[0],o=t.mesh,i=t.bones.head.bone,n=t.targets.lookToTargetOffset,s=t.targets.lookToTarget,a=t.physics.frontBody.body.position;if(z1.distanceSquared(s,a)<this.disableDist*this.disableDist)return n.x=0,n.y=0,void(n.z=0);i.getAbsoluteTransform().multiplyToRef(o.getWorldMatrix(),e);var r=this.distAbove/o.scaling.x;n.x=e.m[8]*r,n.y=e.m[9]*r,n.z=e.m[10]*r},z588}(z767),e.z588=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(o){function z589(){var t=null!==o&&o.apply(this,arguments)||this;return t.distAbove=.13,t.disableDist=.14,t}return __extends(z589,o),z589.prototype.update=function(t){var e=t.targetObject;e&&(this.distAbove=e.radius+.03,o.prototype.update.call(this,t))},z589}(e.z588),e.z589=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z509(){var t=null!==e&&e.apply(this,arguments)||this;return t.TEST_headCollFrac=.5,t}return __extends(z509,e),z509.prototype.update=function(t){t.physics.headBody.body.shapes.collisionFrac=this.TEST_headCollFrac},z509}(z767),e.z509=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z515(){return null!==t&&t.apply(this,arguments)||this}return __extends(z515,t),z515.prototype.update=function(t){t.physics.removeDragObjJoint()},z515}(z767),e.z515=o}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z405(){return null!==t&&t.apply(this,arguments)||this}return __extends(z405,t),z405.prototype.update=function(t){var e=t.targetObject;e&&e.accType==o.z1044.z1058&&(t.smoothRandomNumber1.min=0,t.smoothRandomNumber1.max=.14,t.smoothRandomNumber1.speed=.2,t.smoothRandomNumber1.update(),t.focusDist=t.smoothRandomNumber1.value)},z405}(z767),t.z405=e}(z0||(z0={})),function(C){var t,e;t=C.z156||(C.z156={}),e=function(e){function z398(){var t=null!==e&&e.apply(this,arguments)||this;return t.rollNeg90Quat=BABYLON.Quaternion.RotationYawPitchRoll(0,0,.5*-Math.PI),t.T_poleAng=1.3,t.T_poleTargetX=-.9,t.T_poleTargetY=-.9,t.T_poleTargetZ=-.9,t.T_pawRotX=-.6,t.T_pawRotY=1,t.T_pawRotZ=-1,t.T_poseShoulders=!1,t}return __extends(z398,e),z398.prototype.update=function(t){var e=t.targetObject;if(e&&e.accType==C.z1044.z1058){var o=z767.z4[0],i=z767.z4[1],n=z767.z4[2],s=e.dynamicBody.position,a=t.physics.frontBody.body.position;o.x=s.x-a.x,o.y=s.y-a.y,o.z=s.z-a.z;var r=o.lengthSquared(),c=Math.sqrt(r);o.x=o.x/c,o.y=o.y/c,o.z=o.z/c,i.x=0,i.y=1,i.z=0;var d=.5*t.adjustLerp,p=t.bones.legFL;p.targetPositionLerp=d;var l=a.x,u=a.y,y=a.z,g=c,m=e.radius;if(.2<g){var f=c-(g=.2),A=e.radius;if(A<f)return;m=Math.sqrt(A*A-f*f)}BABYLON.Vector3.CrossToRef(i,o,n),n.normalize(),n.scaleInPlace(m+.02);var b=.5*t.bones.head.roll.value;if(0!=b){var v=z767.tempBabMats[0];BABYLON.Matrix.RotationAxisToRef(o,b,v),BABYLON.Vector3.TransformNormalToRef(n,v,n)}l+=o.x*g,u+=o.y*g,y+=o.z*g,l-=n.x,u-=n.y,y-=n.z,p.setTargetPositionFloats(l,u,y),p.targetPoleAngle=-this.T_poleAng,p.ikCtrl.poleTargetLocalOffset.x=this.T_poleTargetX,p.ikCtrl.poleTargetLocalOffset.y=this.T_poleTargetY,p.ikCtrl.poleTargetLocalOffset.z=p.dirX*this.T_poleTargetZ,(p=t.bones.legFR).targetPositionLerp=d,l=a.x,u=a.y,y=a.z,l+=o.x*g,u+=o.y*g,y+=o.z*g,l+=n.x,u+=n.y,y+=n.z,p.setTargetPositionFloats(l,u,y),p.targetPositionLerp=.05,p.targetPoleAngle=this.T_poleAng,p.ikCtrl.poleTargetLocalOffset.x=this.T_poleTargetX,p.ikCtrl.poleTargetLocalOffset.y=this.T_poleTargetY,p.ikCtrl.poleTargetLocalOffset.z=p.dirX*this.T_poleTargetZ;var x=z767.tempBabQuats[0];BABYLON.Quaternion.RotationYawPitchRollToRef(-this.T_pawRotY,-this.T_pawRotX,this.T_pawRotZ,x),t.bones.legFR.setPawRotationTarget(x),BABYLON.Quaternion.RotationYawPitchRollToRef(Math.PI+this.T_pawRotY,this.T_pawRotX,this.T_pawRotZ,x),t.bones.legFL.setPawRotationTarget(x),t.bones.legFR.pawSlerpAmount=1,t.bones.legFL.pawSlerpAmount=1,t.bones.legFR.updatePose(),t.bones.legFL.updatePose()}},z398}(z767),t.z398=e}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(e){function z381(){var t=null!==e&&e.apply(this,arguments)||this;return t.headRollCenter=0,t.headRollMax=0,t.headRollSpeed=.1,t}return __extends(z381,e),z381.prototype.update=function(t){var e=t.targetObject;if(e&&e.accType==n.z1044.z1058){if(e.parent.accType==n.z1044.z1048)this.headRollCenter=0,this.headRollMax=2,this.headRollSpeed=.1;else{var o=t.physics.frontBody.body,i=z767.z4[0];z1.getOIMOLocalPositionFromGlobalToRef(o,e.position,i),i.x<0?this.headRollCenter=-.75:this.headRollCenter=.75,this.headRollMax=1,this.headRollSpeed=.2,this.headRollCenter=5*i.x,this.headRollMax=1,this.headRollSpeed=.2,1<this.headRollSpeed?this.headRollCenter=1:this.headRollCenter<-1&&(this.headRollCenter=-1)}t.smoothRandomNumber2.min=Math.max(this.headRollCenter-.5*this.headRollMax,-1),t.smoothRandomNumber2.max=Math.min(this.headRollCenter+.5*this.headRollMax,1),t.smoothRandomNumber2.speed=this.headRollSpeed,t.smoothRandomNumber2.update(),t.bones.head.roll.targetValue=t.smoothRandomNumber2.value,t.bones.shoulder.roll.targetValue=-.5*t.smoothRandomNumber2.value}},z381}(z767),t.z381=e}(z0||(z0={})),function(r){var t,e;t=r.z156||(r.z156={}),e=function(e){function z290(){var t=null!==e&&e.apply(this,arguments)||this;return t.minDistToHC=.2,t}return __extends(z290,e),z290.prototype.update=function(t){var e=t.physics.rearBody.body.position,o=t.physics.rearBody.target,i=z767.z4[0],n=t.targetObject;if(t.cage&&n&&n.accType==r.z1044.z1058){var hc=n.parent;if(hc){hc.accType,r.z1044.z1059,i.x=e.x-hc.position.x,i.z=e.z-hc.position.z,i.y=0;var s=i.x*i.x+i.z*i.z,a=this.minDistToHC;s<a*a?(i.normalize(),o.x=hc.position.x+i.x*a,o.z=hc.position.z+i.z*a):(o.x=e.x,o.z=e.z),o.y=t.cage.getHeightAt(o.x,o.z),o.frameNum=r.app.frameNum}}},z290}(z767),t.z290=e}(z0||(z0={})),function(p){var t,e;t=p.z156||(p.z156={}),e=function(e){function z207(){var t=null!==e&&e.apply(this,arguments)||this;return t.TEST_standAbove=.05,t.TEST_padding1=0,t.TEST_padding2=0,t.TEST_lookAbove=0,t}return __extends(z207,e),z207.prototype.update=function(t){var e=t.targetObject;if(e&&e.accType==p.z1044.z1058){var o=e.dynamicBody,i=e.radius+this.TEST_standAbove,n=t.targets.destTarget,s=z767.z4[0],a=e.dynamicBody.position,r=t.physics.headBody.body.position;s.x=a.x-r.x,s.y=a.y-r.y,s.z=a.z-r.z,s.normalize();var c=o.shapes.radius;c+=this.TEST_padding1,n.x=o.position.x-s.x*c,n.y=o.position.y+i-s.y*c,n.z=o.position.z-s.z*c,t.targets.moveToTarget.copyFrom(n),t.targets.standToTarget.copyFrom(n);var d=t.targets.lookToTarget;d.x=o.position.x,d.y=o.position.y+this.TEST_lookAbove,d.z=o.position.z,c=0,c+=this.TEST_padding2,d.x-=s.x*c,d.y-=s.y*c,d.z-=s.z*c}},z207}(z767),t.z207=e}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(o){function z188(){var t=null!==o&&o.apply(this,arguments)||this;return t.accType=e.z1044.z1058,t}return __extends(z188,o),z188.prototype.update=function(t){if(o.prototype.update.call(this,t),t.targetObject&&t.targetObject.isOnScene){var e=t.targets.destTarget;if(t.cage&&t.cage.isInBox(e.x,e.y,e.z)){.09<z1.distanceSquared(e,t.targetObject.position)&&(t.setPathTo(e),t.memory.remove(t.targetObject),t.memory.add(t.targetObject))}}},z188}(t.z200),t.z188=o}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z993(){return null!==t&&t.apply(this,arguments)||this}return __extends(z993,t),z993.prototype.test=function(t){var e=t.memory.getAccessories(o.z1044.z1058);return!(!e||0==e.length)},z993}(z770),t.z993=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z930(){return null!==t&&t.apply(this,arguments)||this}return __extends(z930,t),z930.prototype.test=function(t){t.walkForce;var e=t.targetObject;if(e&&e.cage==t.cage&&!(t.platformAbove&&e.position.y>t.platformAbove.position.y||t.platformUnder&&e.position.y-t.platformUnder.position.y<0)){var o=t.physics.frontBody.body,i=o.position.x-e.position.x,n=o.position.z-e.position.z;return!(.25<i*i+n*n)&&!!t.physics.isBodyFacingPos(t.physics.middleBody,e.position)}},z930}(z770),e.z930=o}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z851(){return null!==t&&t.apply(this,arguments)||this}return __extends(z851,t),z851.prototype.test=function(t){return!(!t.targetObject||t.targetObject.accType!=e.z1044.z1058)},z851}(z770),t.z851=o}(z0||(z0={})),function(o){var t=function(e){function z140(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z261],t.updatez156=[o.z156.z700],t.exitz156=[],t.states=[],t.transitions=[{condition:o.z768.z862,trueNode:{state:o.z139}}],t}return __extends(z140,e),z140}(z49);o.z140=t}(z0||(z0={})),function(o){var t=function(e){function z139(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z261],t.updatez156=[],t.exitz156=[],t.states=[],t.transitions=[{condition:o.z768.z862,trueNode:{state:o.z140}}],t}return __extends(z139,e),z139}(z49);o.z139=t}(z0||(z0={})),function(o){var t=function(e){function z117(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z703,o.z156.z408,o.z156.z265],t.updatez156=[o.z156.z381],t.exitz156=[],t.states=[],t.transitions=[{condition:o.z768.z863,trueNode:{state:o.z61}}],t}return __extends(z117,e),z117}(z49);o.z117=t}(z0||(z0={})),function(o){var t=function(e){function z61(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z408,o.z156.z265],t.updatez156=[o.z156.z381,o.z156.z700],t.exitz156=[],t.states=[],t.transitions=[{condition:o.z768.z863,trueNode:{state:o.z117}}],t}return __extends(z61,e),z61}(z49);o.z61=t}(z0||(z0={})),function(o){var t=function(e){function z48(){var t=null!==e&&e.apply(this,arguments)||this;return t.states=[o.z47,o.z46],t.enterz156=[o.z156.z726],t.updatez156=[o.z156.z191,o.z156.z208,o.z156.z209,o.z156.z532,o.z156.z733,o.z156.z734],t.exitz156=[o.z156.z502,o.z156.z468],t.transitions=[{condition:o.z768.z982,falseNode:{state:o.z37}},{condition:o.z768.z976,trueNode:{state:o.z112}},{condition:o.z768.z993,falseNode:{state:o.z112}},{condition:o.z768.z951,trueNode:{state:o.z112}}],t.initialState=o.z47,t}return __extends(z48,e),z48}(z49);o.z48=t}(z0||(z0={})),function(o){var t=function(e){function z47(){var t=null!==e&&e.apply(this,arguments)||this;return t.updatez156=[o.z156.z188,o.z156.z290],t.exitz156=[],t.transitions=[{condition:o.z768.z930,trueNode:{state:o.z46}},{condition:o.z768.z882,trueNode:{condition:o.z768.z880,falseNode:{state:o.z34,level:1,actions:[o.z156.z483,o.z156.z470]}}}],t}return __extends(z47,e),z47}(z49);o.z47=t}(z0||(z0={})),function(o){var t=function(e){function z46(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z382,o.z156.z703],t.updatez156=[o.z156.z507,o.z156.z406,o.z156.z763,o.z156.z724,o.z156.z483,o.z156.z327,o.z156.z290,o.z156.z405,o.z156.z207,o.z156.z589,o.z156.z398],t.exitz156=[o.z156.z502,o.z156.z470,o.z156.z490,o.z156.z478],t.states=[o.z61,o.z117],t.transitions=[{condition:o.z768.z851,falseNode:{state:o.z47}},{condition:o.z768.z930,falseNode:{state:o.z47}}],t.initialState=o.z117,t}return __extends(z46,e),z46}(z49);o.z46=t}(z0||(z0={})),function(l){var t=function(n){function StickChew(t){var e=n.call(this)||this;return e.accType=l.z1044.z1060,e.pubsub=new Pubsub,e.num=0,e.world=void 0,e.boxSize=0,e.rotation=BABYLON.Vector3.Zero(),e.chews=[],e.meshes=[],e.joints=[],e.draggerMesh=void 0,e.draggerBody=void 0,e.draggerJoint=void 0,e.numChews=4,e.bodyRadius=.1,StickChew.count++,e.num=StickChew.count,e.position=BABYLON.Vector3.Zero(),e.scaling=new BABYLON.Vector3(1,1,1),e.placementType=l.PlacementType.GRID|l.PlacementType.z1048|l.PlacementType.FRONT,e}return __extends(StickChew,n),StickChew.prototype.addToActiveObjects=function(){-1==StickChew.activeObjects.indexOf(this)&&StickChew.activeObjects.push(this)},StickChew.prototype.removeFromActiveObjects=function(){var t=StickChew.activeObjects.indexOf(this);-1!=t&&StickChew.activeObjects.splice(t,1)},StickChew.prototype.init=function(t){n.prototype.init.call(this,t),this.canRotate=!1,this.canTranslate=!0,this.canDelete=!0,this.world=t.world,this.addToActiveObjects(),this.mapPlacementInfo||(this.mapPlacementInfo=new l.MapPlacementInfo({mapPlacementSizeX:.25,mapPlacementSizeY:.25})),this.controlPositionLocal.x=0,this.controlPositionLocal.y=.5*this.height-.1,this.controlPositionLocal.z=.5*-this.depth;var e=0,o=0;if(null!=t.x&&(e=t.x),null!=t.y&&(o=t.y),t.isMenuItem&&t.isMenuItem,!this.hitMeshes){this.hitMeshes=[];var i=l.app.graphicsHelper.getHitMesh(2*this.bodyRadius,2*this.bodyRadius,2*this.bodyRadius);this.hitMeshes.push(i)}if(null!=t.renderingGroupID&&null!=t.renderingGroupID&&(this.renderingGroupID=t.renderingGroupID),0==this.chews.length&&(this.createChews(),this.disablePhysics(),this.removeFromScene()),this.setPosition(e,o,-1.5),!this.isMenuItem)if(t.skipAddToScene)this.removeFromScene();else{if(this.addToScene(),this.cage||(this.cage=l.Cage.getCageAt(this.position.x,this.position.y+.5*this.height,this.position.z)),!this.cage)return;this.cage.isReady?this.addToObject(this.cage):this.cage.pubsub.subscribe("ready",this.addToObject,this)}},StickChew.prototype.createChews=function(){for(var t,e="stickChew"+StickChew.count,o=this.bodyRadius,i=0;i<this.numChews;i++){t=i%2?"box":"sphere";var n=ObjectPool.get("SimpleChew",{isMenuItem:this.isMenuItem,x:0,y:0+i*o,z:0,bodyRadius:o,meshType:t,renderingGroupID:this.renderingGroupID});this.isMenuItem&&n.removeFromActiveObjects(),this.chews.push(n),this.meshes.push(n.mesh),n.placementType=void 0,n.parent=this}var s=l.App.PhysicsGroupDragger,a=[1,1,1];a[3]=s,a[4]=s,a[3]=null,a[4]=null;this.draggerMesh=l.app.graphicsHelper.addTestBox(.1,0,0,0),this.draggerBody=new OIMO.Body({type:"sphere",size:[.1,.1,.1],pos:[0,0,0],rot:[0,0,0],move:!1,world:this.world,name:e+"_dragger",config:a}).body,this.isMenuItem,this.isMenuItem;for(i=0;i<this.chews.length;i++)this.chews[i].addToScene();var r={name:"bodyDraggerJoint",type:"jointDistance",body1:this.draggerBody,body2:this.chews[0].dynamicBody,min:0,max:this.bodyRadius,pos1:[0,0,0],pos2:[0,this.bodyRadius,0],collision:!1,spring:[100,1],world:this.world};this.draggerJoint=new OIMO.Link(r).joint,this.joints.push(this.draggerJoint);for(i=0;i<this.numChews-1;i++){var c=2*o,d={type:"jointBall",body1:this.chews[i].dynamicBody,body2:this.chews[i+1].dynamicBody,pos1:[0,0,0],pos2:[0,c,0],collision:!1,world:this.world},p=new OIMO.Link(d).joint;this.joints.push(p)}},StickChew.prototype.createMeshes=function(){},StickChew.prototype.update=function(){this.draggerMesh&&this.draggerMesh.position.copyFrom(this.draggerBody.position)},StickChew.prototype.setPositionOnMapFromDrop=function(t,e,o){n.prototype.setPositionOnMapFromDrop.call(this,t,e,o)},StickChew.prototype.setHitMesh=function(t,e,o){if(this.hitMeshes&&this.hitMeshes[0]){var i=this.hitMeshes[0];i.position.x=t,i.position.y=e+.5*this.height,i.position.z=o,i.computeWorldMatrix()}},StickChew.prototype.removeVelocity=function(){for(var t=0;t<this.chews.length;t++)this.chews[t].removeVelocity()},StickChew.prototype.translate=function(t,e,o){var i=this.draggerBody;i.position.x+=t,i.position.y+=e,i.position.z+=o,this.position.copyFrom(i.position);var n=i.shapes;n.position.x=i.position.x,n.position.y=i.position.y,n.position.z=i.position.z,n.updateProxy();for(var s=0;s<this.chews.length;s++)this.chews[s].translate(t,e,o)},StickChew.prototype.setPositionDrag=function(t,e,o,i){var n=this.draggerBody,s=n.position;s.x,s.y,s.z;this.isDragging||(this.setPosition(t,e,o),this.isDragging=!0,this.cage&&this.addToObject(null)),i&&(this.updateCage(),this.isDragging=!1,this.setPosition(t,e,o)),s.x=t,s.y=e,s.z=o;var a=n.shapes.position;a.x=t,a.y=e,a.z=o,n.shapes.updateProxy()},StickChew.prototype.updateCage=function(){var t=l.Cage.getCageAt(this.position.x,this.position.y+.5*this.height,this.position.z);this.addToObject(t)},StickChew.prototype.setPosition=function(t,e,o,i){void 0===i&&(i=!1),this.position.x=t,this.position.y=e,this.position.z=o,this.isMenuItem||this.cage||this.updateCage(),this.position.x=t,this.position.y=e,this.position.z=o,this.setHitMesh(t,e,o),this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position);var n=this.draggerBody;n.position.x=t,n.position.y=e,n.position.z=o,this.draggerMesh&&this.draggerMesh.position.copyFrom(this.draggerBody.position),n.linearVelocity.x=0,n.linearVelocity.y=0,n.linearVelocity.z=0,n.angularVelocity.x=0,n.angularVelocity.y=0,n.angularVelocity.z=0;var s=n.shapes;s.position.x=n.position.x,s.position.y=n.position.y,s.position.z=n.position.z,n.syncShapes();var a=-9999;if(this.cage&&o>this.cage.front){a=this.cage.bottom+this.bodyRadius;var r=this.cage.getPlatformUnder(t,e,o);r&&(a=r.position.y+this.bodyRadius)}for(var c=2.2*this.bodyRadius,d=1.1*-this.bodyRadius,p=0;p<this.chews.length;p++){var l=e-c*p+d;l<a&&(l=a),this.chews[p].setPosition(t,l,o)}this.onChangeObservable.notifyObservers(this)},StickChew.prototype.setRotation=function(t,e,o){},StickChew.prototype.enablePhysics=function(){this.world.addRigidBody(this.draggerBody);for(var t=0;t<this.numChews;t++);for(t=0;t<this.numChews;t++){var e=this.joints[t];this.world.addJoint(e)}},StickChew.prototype.disablePhysics=function(){var t=this.draggerBody;this.world.removeRigidBody(t);for(var e=0;e<this.numChews;e++){var o=this.joints[e];o.parent&&this.world.removeJoint(o)}},StickChew.prototype.addToScene=function(){if(!this.isOnScene){n.prototype.addToScene.call(this);for(var t=0;t<this.numChews;t++)this.chews[t].addToScene(),this.isMenuItem||this.chews[t].addItemCount(1);this.enablePhysics(),l.app.graphicsHelper.addForUpdate(this)}},StickChew.prototype.removeFromScene=function(){if(this.isOnScene){n.prototype.removeFromScene.call(this);for(var t=0;t<this.numChews;t++)this.chews[t].removeFromScene();this.disablePhysics(),l.app.graphicsHelper.removeFromUpdate(this)}},StickChew.prototype.recycle=function(){this.setPosition(9999,9999,9999),n.prototype.recycle.call(this)},StickChew.prototype.setColor=function(t,e,o,i){n.prototype.setColor.call(this,t,e,o,i)},StickChew.prototype.getName=function(){return this._className},StickChew.prototype.getProps=function(){return n.prototype.getProps.call(this)},StickChew.prototype.getCenterAtPosToRef=function(t,e,o,i){i.x=t,i.y=e+.5*this.height,i.z=o},StickChew.prototype.addToObject=function(t){if(this.cage&&this.cage!=t&&this.cage.removeObject(this),this.parent=t,this.cage=t){t.addObject(this);for(e=0;e<this.chews.length;e++)this.chews[e].addToObject(t),this.chews[e].parent=this}else for(var e=0;e<this.chews.length;e++)this.chews[e].addToObject(null),this.chews[e].parent=this},StickChew.tempVecs=[new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3],StickChew.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],StickChew.tempArr=[],StickChew.count=0,StickChew.activeObjects=[],StickChew}(l.z1092);l.StickChew=t}(z0||(z0={})),function(e){var t=function(){function Connector(){this.onChangeObservable=new BABYLON.Observable,this.num=0,this.shapeName="",this.shapeEnabled=!0,this.shape=void 0,this.pathNodeTop=null,this.pathNodeBot=null,this.localOffsetButton=null,this.position=BABYLON.Vector3.Zero(),this.rotationQuaternion=BABYLON.Quaternion.Identity(),this.rotation=BABYLON.Vector3.Zero(),this.isRecycled=!1,this.isOnScene=!1,this.renderingGroupID=0,this.solidParticleIndex=-1,this.tileNum=0,this.textureName="",this.uvDirty=!0,this.forceUpdate=!1,this.color=new BABYLON.Color4(1,1,0,1),this.worldMatrix=BABYLON.Matrix.Identity(),this.saveToDB=!1,this.hamsters=new z1072,Connector.count++,this.num=Connector.count,this.id="con"+this.num}return Connector.prototype.init=function(t){if(t.renderingGroupID&&(this.renderingGroupID=t.renderingGroupID),!this.shape){var e="connector_rg"+this.renderingGroupID;t.shapeName&&(e=t.shapeName),this.shape=ObjectPool.get(e,{renderingGroupID:this.renderingGroupID}),this.shape.setColor(this.color.r,this.color.g,this.color.b),this.shape.removeFromScene()}},Connector.prototype.refresh=function(){this.refreshMeshes()},Connector.prototype.getWorldDir=function(){return this._worldDir},Connector.prototype.refreshMeshes=function(){this.pathNodeTop&&(1<this.pathNodeTop.connections.length?this.pathNodeTop.connections[1].data.connector&&(this.pathNodeTop.connections[1].data.connector.meshOnScene&&this.isOnScene?this.removeFromScene():this.pathNodeTop.connections[1].data.connector.meshOnScene||this.isOnScene||this.addToScene()):this.isOnScene||this.addToScene(),this.pathNodeBot&&this.pathNodeBot.connections.length<=1&&(this.isOnScene||this.addToScene()))},Connector.prototype.removeFromScene=function(){this.shape&&this.shape.removeFromScene(),this.isOnScene=!1,this.onChangeObservable.notifyObservers(this)},Connector.prototype.addToScene=function(){this.isOnScene||(this.shape&&this.shape.addToScene(),this.isOnScene=!0,this.onChangeObservable.notifyObservers(this))},Connector.prototype.setPosition=function(t,e,o){this.position.x=t,this.position.y=e,this.position.z=o;var i=Connector.tempVec;i.x=0,i.y=0,i.z=0,this._updatePathNodePositions(),this.shape&&this.shape.setPosition(t,e,o),this.onChangeObservable.notifyObservers(this)},Connector.prototype.setRotation=function(t,e,o){var i=Connector.tempVec,n=Connector.tempMat;this.rotation.x=t,this.rotation.y=e,this.rotation.z=o,this.shape&&this.shape.setRotation(t,e,o);var s=new BABYLON.Vector3(0,1,0);BABYLON.Quaternion.RotationYawPitchRollToRef(e,t,o,this.rotationQuaternion),(this._worldDir||this.localOffsetButton)&&(this.rotationQuaternion.toRotationMatrix(n),this._worldDir&&BABYLON.Vector3.TransformNormalToRef(s,n,this._worldDir),this.localOffsetButton&&BABYLON.Vector3.TransformNormalToRef(this.localOffsetButton,n,i)),this._updatePathNodePositions(),this.onChangeObservable.notifyObservers(this)},Connector.prototype._updatePathNodePositions=function(){this.pathNodeTop&&(this.pathNodeTop.connections[0]&&this.pathNodeBot&&(this.pathNodeTop.id,this.pathNodeTop.connections[0]),this.pathNodeTop.x=this.position.x,this.pathNodeTop.y=this.position.y,this.pathNodeTop.z=this.position.z,this._worldDir&&(this.pathNodeTop.x-=this._worldDir.x,this.pathNodeTop.y-=this._worldDir.y,this.pathNodeTop.z-=this._worldDir.z)),this.pathNodeBot&&(this.pathNodeBot.connections[0]&&this.pathNodeBot.connections[0],this.pathNodeBot.x=this.position.x,this.pathNodeBot.y=this.position.y,this.pathNodeBot.z=this.position.z,this._worldDir&&(this.pathNodeBot.x-=this._worldDir.x,this.pathNodeBot.y-=this._worldDir.y,this.pathNodeBot.z-=this._worldDir.z))},Connector.prototype.remove=function(){this.isOnScene=!1,this.shape&&this.shape.removeFromScene(),this.onChangeObservable.notifyObservers(this)},Connector.prototype.setParent=function(t){this.parent=t},Connector.prototype.addz1062=function(t){-1===this.hamsters.indexOf(t)&&this.hamsters.push(t)},Connector.prototype.removez1062=function(t){this.hamsters.remove(t)},Connector.prototype.setColor=function(t,e,o,i){this.color.r=t,this.color.g=e,this.color.b=o,this.shape&&this.shape.setColor(t,e,o)},Connector.prototype.setColorHex=function(t){t&&""!=t&&(e.z1073.SetColor3FromHex(t,this.color),this.shape&&this.shape.setColor(this.color.r,this.color.g,this.color.b))},Connector.count=0,Connector.tempVec=BABYLON.Vector3.Zero(),Connector.tempMat=BABYLON.Matrix.Identity(),Connector}();e.Connector=t}(z0||(z0={})),function(e){var t=function(){function ConnectorConfig(){}return ConnectorConfig.prototype.initObjectPool=function(t){ObjectPool.addClass("Connector",e.Connector),ObjectPool.addClass("connector_rg0",z1070,{meshName:"connector_rg0"}),ObjectPool.addClass("connector_rg1",z1068,{shapeName:"Connector"})},ConnectorConfig.prototype.getSceneFileNames=function(t){},ConnectorConfig.prototype.getCreateMeshFunctions=function(t){t.connector_rg0=this._createMeshes},ConnectorConfig.prototype._createMeshes=function(t,e,o){var i=o.default0,n=e.connector;n.position.x=0,n.position.y=0,n.position.z=0;var s=n.clone("connector_rg0");s.makeGeometryUnique(),s.material=i,s.thinInstanceRegisterAttribute("color",4);var a=s.thinInstanceAddSelf(!1);z1070.MatrixOffScene.setTranslationFromFloats(999,999,999),s.thinInstanceSetMatrixAt(a,z1070.MatrixOffScene,!0),e.connector_rg0=s},ConnectorConfig.prototype.getSPSData=function(t){t.push({shapeName:"Connector",meshName:"connector",numInstances:20,maxInstances:20,renderingGroupID:e.App.menuRenderingGroupID})},ConnectorConfig}();e.App.AddEntityConfig(new t)}(z0||(z0={})),function(l){var t=function(p){function ConnectorFloor(){var t=p.call(this)||this;return t.shape=void 0,t.accType=l.z1044.z1052,t.body=null,t.world=null,t.height=0,t.innerRadius=0,t.radius=0,t.num=0,t.boxSize=1,t.saveToDB=!1,t.rotation=BABYLON.Vector3.Zero(),t.acc1LocalPosition=BABYLON.Vector3.Zero(),ConnectorFloor.count++,t.num=ConnectorFloor.count,t}return __extends(ConnectorFloor,p),Object.defineProperty(ConnectorFloor.prototype,"acc1",{get:function(){return this._acc1},set:function(t){if(this._acc1=t,this._acc1){var e=this._acc1.position;this.acc1LocalPosition.x=this.position.x-e.x,this.acc1LocalPosition.y=this.position.y-e.y,this.acc1LocalPosition.z=this.position.z-e.z}},enumerable:!1,configurable:!0}),ConnectorFloor.prototype.init=function(t){if(p.prototype.init.call(this,t),this.acc1=t.acc1,this.height=.1*this.boxSize,this.radius=.25*this.boxSize,this.innerRadius=.9*this.radius,!this.shape){var e="connector_rg"+this.renderingGroupID;this.shape=ObjectPool.get(e,{renderingGroupID:this.renderingGroupID}),this.shape.setColor(1,1,1)}if(!this.body){var o="conplat"+this.num;this.world=t.world;var i=[1,.4,.2,2,4294967295];this.body=new OIMO.Body({size:[this.radius,this.height,this.innerRadius],pos:[0,0,0],rot:[0,0,0],world:this.world,type:"tube",move:!1,name:o+"_tube",config:i}).body,this.topNode=new GraphNode(0,.05,0),this.topNode.data.obj=this,l.app.graph.addNode(this.topNode),this.botNode=new GraphNode(0,-.05,0),this.botNode.data.obj=this,l.app.graph.addNode(this.botNode),this.topNode.addConnection(this.botNode,.04),this.botNode.addConnection(this.topNode,.04),this.topNode.data.enterNextNode=this.botNode,this.botNode.data.enterNextNode=this.topNode,this.topNode.data.enterEvent=l.ConnectorFloorEvents.GO_DOWN_THRU,this.botNode.data.enterEvent=l.ConnectorFloorEvents.GO_UP_THRU}var n=0,s=0,a=0;t.x&&(n=t.x),t.y&&(s=t.y),t.z&&(a=t.z);var r=0,c=0,d=0;t.rx&&(r=t.rx),t.ry&&(c=t.ry),t.rz&&(d=t.rz),this.setRotation(r,c,d),this.setPosition(n,s,a),t.skipAddToScene||this.addToScene()},ConnectorFloor.prototype.onAfterDisconnect=function(t){if(t==this.acc1){for(var e=(o=this.topNode.connections).length-1;0<=e;e--){(i=o[e])!=this.botNode&&(this.topNode.removeConnection(i),i.removeConnection(this.topNode))}var o;for(e=(o=this.botNode.connections).length-1;0<=e;e--){var i;(i=o[e])!=this.topNode&&(this.botNode.removeConnection(i),i.removeConnection(this.botNode),i.data.obj2&&i.data.obj2.onAfterDisconnect?i.data.obj2.onAfterDisconnect(this):i.data.obj&&i.data.obj.onAfterDisconnect&&i.data.obj.onAfterDisconnect(this))}}},ConnectorFloor.prototype.setRotation=function(t,e,o){p.prototype.setRotation.call(this,t,e,o),this.shape.setRotation(t,e,o),this.rotationQuaternion.copyFrom(this.shape.rotationQuaternion),z1.setBodyRotationQuaternion(this.body,this.rotationQuaternion)},ConnectorFloor.prototype.setPosition=function(t,e,o){p.prototype.setPosition.call(this,t,e,o),this.shape.setPosition(t,e,o);var i=this.body.position;i.x=t,i.y=e,i.z=o;var n=this.body.shapes.position;n.x=t,n.y=e,n.z=o;this.topNode.x=t+0,this.topNode.y=e+.02,this.topNode.z=o,this.botNode.x=t+0,this.botNode.y=e-.02,this.botNode.z=o,this.body.shapes.updateProxy(),this.acc1&&(this.acc1LocalPosition.x=this.position.x-this.acc1.position.x,this.acc1LocalPosition.y=this.position.y-this.acc1.position.y,this.acc1LocalPosition.z=this.position.z-this.acc1.position.z)},ConnectorFloor.prototype.removeFromScene=function(){this.isOnScene&&this.removeFromActiveObjects(),p.prototype.removeFromScene.call(this),this.shape.removeFromScene(),this.setPosition(999,999,999)},ConnectorFloor.prototype.recycle=function(){this.setPosition(999,999,999),this.acc1=null,this.isOnScene=!1,this.removeFromScene(),this.onChangeObservable.notifyObservers(this,2),this.onChangeObservable.clear(),ObjectPool.recycle(this)},ConnectorFloor.prototype.addToScene=function(){this.isOnScene||this.addToActiveObjects(),p.prototype.addToScene.call(this),this.shape.addToScene()},ConnectorFloor.prototype.addToActiveObjects=function(){-1==ConnectorFloor.activeObjects.indexOf(this)&&ConnectorFloor.activeObjects.push(this)},ConnectorFloor.prototype.removeFromActiveObjects=function(){var t=ConnectorFloor.activeObjects.indexOf(this);-1!=t&&ConnectorFloor.activeObjects.splice(t,1)},ConnectorFloor.getObjectAt=function(t,e,o,i){void 0===i&&(i=.1);for(var n=ConnectorFloor.activeObjects,s=n.length,a=i*i,r=0;r<s;r++){var c=n[r],d=c.position.x-t,p=c.position.y-e,l=c.position.z-o;if(d*d+p*p+l*l<a)return n[r]}},ConnectorFloor.prototype.setColor=function(t,e,o,i){p.prototype.setColor.call(this,t,e,o),this.shape.setColor(t,e,o)},ConnectorFloor.count=0,ConnectorFloor.tempBabVec=BABYLON.Vector3.Zero(),ConnectorFloor.activeObjects=[],ConnectorFloor}(l.z1092);l.ConnectorFloor=t}(z0||(z0={})),function(e){var t=function(){function ConnectorFloorConfig(){}return ConnectorFloorConfig.prototype.initObjectPool=function(t){ObjectPool.addClass(e.ConnectorFloor.name,e.ConnectorFloor,{world:t})},ConnectorFloorConfig.prototype.getSceneFileNames=function(t){},ConnectorFloorConfig.prototype.getSPSData=function(t){},ConnectorFloorConfig.prototype.getz49s=function(t){t.push(e.z90),t.push(e.z95)},ConnectorFloorConfig.prototype.getListenerSetups=function(t){t.push({event:e.ConnectorFloorEvents.GO_UP_THRU,state:e.z90}),t.push({event:e.ConnectorFloorEvents.GO_DOWN_THRU,state:e.z95})},ConnectorFloorConfig}();e.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(){function ConnectorFloorEvents(){}return ConnectorFloorEvents.GO_UP_THRU=t.AppEvents.GetUniqueID(),ConnectorFloorEvents.GO_DOWN_THRU=t.AppEvents.GetUniqueID(),ConnectorFloorEvents}();t.ConnectorFloorEvents=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z615(){return null!==t&&t.apply(this,arguments)||this}return __extends(z615,t),z615.prototype.update=function(t){var e=t.path[t.pathIndex];if(e){var o=e.data.obj;if(o&&o.acc1){var i=o.position.y;if(!(t.targets.moveToTarget.y<i)){var n=t.physics.frontBody.body.position;e.x,n.x,e.y,n.y,e.z,n.z;n.y-i>1.5*-t.size&&t.forceTouchGround()}}}},z615}(z767),e.z615=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z364(){var t=null!==e&&e.apply(this,arguments)||this;return t.uprightAng=4,t}return __extends(z364,e),z364.prototype.update=function(t){t.targets.moveToTarget.y,t.position.y;t.size,t.isTouchingGround()&&e.prototype.update.call(this,t)},z364}(e.z369),e.z364=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z250(){return null!==t&&t.apply(this,arguments)||this}return __extends(z250,t),z250.prototype.update=function(t){var e=t.path[t.pathIndex],o=t.path[t.pathIndex+2];if(o){var i=t.physics.frontBody.body.position,n=i.x-e.x,s=i.z-e.z,a=(t.size,t.targets.pathTarget),r=!1;o.x-e.x<0?n<.25&&(r=!0):-.25<n&&(r=!0);var c=.25,d=0;s<0&&(c*=-1),o.x-e.x<0&&(d*=-1),r?(a.x=e.x,a.y=e.y,a.z=e.z,t.targets.setTargetsToPathTarget(),t.targets.lookToTarget.y=e.y-.2):(a.x=e.x+d,a.y=e.y,a.z=e.z+c,t.targets.setTargetsToPathTarget())}},z250}(z767),e.z250=o}(z0||(z0={})),function(E){var t,e;t=E.z156||(E.z156={}),e=function(t){function z238(){return null!==t&&t.apply(this,arguments)||this}return __extends(z238,t),z238.prototype.update=function(t){var e=t.path[t.pathIndex+1],o=e.data.obj2||e.data.obj;if(o){var i=t.physics.frontBody.path[8],n=o.position.y+.05,s=e.data.obj;if(s&&s.botNode){var a=s.botNode.connections[1];if(a){var r=t.physics.frontBody.body.position;if(2<s.botNode.connections.length){var c=s.botNode.connections[2],d=Math.abs(a.z-r.z);Math.abs(c.z-r.z)<d&&(a=c)}var p=a.data.obj2,l=p.lowNode,u=t.path[t.pathIndex+3],y=t.path[t.pathIndex+4],g=t.path[t.pathIndex+5],m=t.targets.destTarget,f=t.targets.pathTarget,A=z767.z4[0],b=z767.z4[1],v=t.physics.headBody.body.position;if(u){A.x=u.x,A.y=u.y,A.z=u.z;var x=void 0;if(y&&y.data.obj2&&y.data.obj2.accType==E.z1044.z1046?x=y.data.obj2:g&&g.data.obj2&&g.data.obj2.accType==E.z1044.z1046&&(x=g.data.obj2),x)Math.abs(x.position.x-e.x)<Math.abs(A.x-e.x)&&(0<i-x.position.z?A.z+=1:A.z-=1)}else A.x=m.x,A.y=m.y,A.z=m.z;var C=p.cage,S=C.position.x-.5*C.width,T=C.position.x+.5*C.width,B=!1,O=!1;Math.abs(s.position.x-S)<1&&(B=!0),Math.abs(s.position.x-T)<1&&(O=!0);var P=.25;b.z=0,b.x=0,b.y=0,e.x-l.x<0?b.x=-1:b.x=1,p.lowNode.x<r.x&&b.x,p.lowNode.x>r.x&&b.x;var M=v.y-n,I=r.y-n;if(M>t.size&&I>.25*t.size){.1<A.z-e.z?b.z=1:A.z-e.z<-.1&&(b.z=-1),(0<A.x-e.x&&0<l.x-e.x||A.x-e.x<0&&l.x-e.x<0)&&(0<e.z-a.z?b.z=1:b.z=-1,b.x=0),b.x<0&&B&&(b.x=0),0<b.x&&O&&(b.x=0),P=.7,b.x+=A.x-e.x,b.z+=A.z-e.z;var N=n+1.5*t.size;b.normalize();var z=e.x+b.x*P,w=e.z+b.z*P;f.x+=1*(z-f.x),f.z+=1*(w-f.z),f.x=z,f.z=w,f.y=N,t.targets.lookToTarget.x=z,t.targets.setTargetsToPathTarget(),t.targets.lookToTarget.x=z,t.targets.lookToTarget.y=N,t.targets.lookToTarget.z=w}else{var _=.1,R=0;p.lowNode.x<r.x?_*=-(b.x=1):b.x=-1,b.x<0&&B&&(b.x=0),0<b.x&&O&&(b.x=0),R=M<0?.5*t.size:4*t.size;z=e.x+b.x*P,w=e.z+b.z*P+_,N=n+R;if(f.x=z,f.z=w,f.y=N,t.targets.setTargetsToPathTarget(),M>.5*t.size){.1<A.z-e.z?b.z=1:A.z-e.z<-.1&&(b.z=-1),(0<A.x-e.x&&0<l.x-e.x||A.x-e.x<0&&l.x-e.x<0)&&(0<e.z-a.z?b.z=1:b.z=-1,b.x=0),p.lowNode.x<r.x&&b.x,p.lowNode.x>r.x&&b.x,P=.7;var L=e.x+b.x*P,F=e.z+b.z*P,D=n+1.5*t.size;t.targets.lookToTarget.x=L,t.targets.lookToTarget.y=D,t.targets.lookToTarget.z=F}}}}}},z238}(z767),t.z238=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z224(){return null!==t&&t.apply(this,arguments)||this}return __extends(z224,t),z224.prototype.update=function(t){var e=t.physics.middleBody.body.rotation.elements,o=z767.z4[0],i=z767.z4[1],n=z767.z4[2];o.x=0,o.y=1,o.z=0,n.x=e[0],n.y=e[3],n.z=e[6],BABYLON.Vector3.CrossToRef(o,n,i),t.targets.upVecTarget.x=i.x,t.targets.upVecTarget.y=i.y,t.targets.upVecTarget.z=i.z},z224}(z767),e.z224=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z954(){return null!==t&&t.apply(this,arguments)||this}return __extends(z954,t),z954.prototype.test=function(t){var e=t.path[t.pathIndex];if(e){var o=e.data.obj2||e.data.obj;if(o){var i=o.position.y,n=t.physics.frontBody.body.position,s=(t.physics.rearBody.body.position,t.physics.headBody.body.position),a=(n.x,e.x,n.y-i),r=(n.z,e.z,t.size,s.y-i);return a<0*-t.size&&r<.5*-t.size}}},z954}(z770),e.z954=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z841(){return null!==t&&t.apply(this,arguments)||this}return __extends(z841,t),z841.prototype.test=function(t){var e=t.path[t.pathIndex];if(e){var o=e.data.obj2||e.data.obj;if(o){var i=o.position.y,n=t.physics.frontBody.body.position,s=t.physics.headBody.body.position,a=t.physics.middleBody.body.position,r=n.x-e.x,c=n.y-e.y,d=n.z-e.z,p=r*r+d*d,l=a.y-i,u=s.y-i,y=.25+.25*t.size;return c>.8*t.size&&y*y<p&&u>.8*t.size&&l>.8*t.size}}},z841}(z770),e.z841=o}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z805(){return null!==t&&t.apply(this,arguments)||this}return __extends(z805,t),z805.prototype.test=function(t){var e=t.path[t.pathIndex+2];return!e||(!e.data.obj2||(e.data.obj2.accType!=o.z1044.z1046||(180<t.hsm[1].currentState.numFramesInState||void 0)))},z805}(z770),t.z805=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z804(){return null!==t&&t.apply(this,arguments)||this}return __extends(z804,t),z804.prototype.test=function(t){var e=t.path[t.pathIndex];if(!e)return!0;var o=t.physics.frontBody.body.position,i=t.physics.rearBody.body.position,n=(t.physics.headBody.body.position,o.x,e.x,o.y-e.y);o.z,e.z;if(n<-.5)return!0;i.x,e.x,i.y,e.y;var s=i.z-e.z;return s<4*-t.size||(s>4*t.size||240<t.hsm[1].currentState.numFramesInState)},z804}(z770),e.z804=o}(z0||(z0={})),function(o){var t=function(e){function z95(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.enterz156=[o.z156.z406,o.z156.z474],t.updatez156=[o.z156.z250,o.z156.z599,o.z156.z292,o.z156.z461,o.z156.z446,o.z156.z590,o.z156.z214,o.z156.z369,o.z156.z362,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z379,o.z156.z442],t.exitz156=[o.z156.z494],t.states=[],t.transitions=[{condition:o.z768.z954,trueNode:{state:o.z18,actions:[o.z156.z554,o.z156.z554,o.z156.z677]}},{condition:o.z768.z805,trueNode:{state:o.z108,actions:[]}}],t}return __extends(z95,e),z95}(z49);o.z95=t}(z0||(z0={})),function(o){var t=function(e){function z90(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.enterz156=[o.z156.z406,o.z156.z489,o.z156.z474],t.updatez156=[o.z156.z441,o.z156.z238,o.z156.z294,o.z156.z224,o.z156.z615,o.z156.z461,o.z156.z446,o.z156.z590,o.z156.z214,o.z156.z364,o.z156.z362,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z379,o.z156.z442],t.exitz156=[o.z156.z494],t.states=[],t.transitions=[{condition:o.z768.z841,trueNode:{state:o.z66,actions:[o.z156.z554]}},{condition:o.z768.z804,trueNode:{state:o.z108,actions:[]}},{condition:o.z768.z873,trueNode:{state:o.z65,actions:[]}},{condition:o.z768.z944,trueNode:{state:o.z108}}],t}return __extends(z90,e),z90}(z49);o.z90=t}(z0||(z0={})),function(e){var t=function(){function ConnectorHiddenConfig(){}return ConnectorHiddenConfig.prototype.initObjectPool=function(t){ObjectPool.addClass(e.ConnectorHidden.name,e.ConnectorHidden)},ConnectorHiddenConfig.prototype.getSPSData=function(t){},ConnectorHiddenConfig.prototype.getTextureDrawFunctions=function(t){},ConnectorHiddenConfig}();e.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(s){function ConnectorHidden(){var t=null!==s&&s.apply(this,arguments)||this;return t.body=void 0,t.world=void 0,t.height=0,t.innerRadius=0,t.radius=0,t.saveToDB=!1,t}return __extends(ConnectorHidden,s),ConnectorHidden.prototype.init=function(t){if(!this.body){var e="conhidden"+this.num;this.world=t.world;var o=[1,.4,.2,2,4294967295];this.radius=.25,this.height=.1,this.innerRadius=.85*this.radius,this.world=t.world,this.body=new OIMO.Body({size:[this.radius,this.height,this.innerRadius],pos:[0,0,0],rot:[0,0,0],world:this.world,type:"tube",move:!1,name:e+"_tube",config:o}).body}this.pathNodeTop=t.pathNodeTop,this.pathNodeTop&&(this.pathNodeTop.data.connector=this),this.isOnScene=!0,this.onChangeObservable.notifyObservers(this)},ConnectorHidden.prototype.setRotation=function(t,e,o){s.prototype.setRotation.call(this,t,e,o),this.body&&z1.setBodyRotationQuaternion(this.body,this.rotationQuaternion)},ConnectorHidden.prototype.setPosition=function(t,e,o){if(s.prototype.setPosition.call(this,t,e,o),this.body){var i=this.body.position;i.x=t,i.y=e,i.z=o;var n=this.body.shapes.position;n.x=t,n.y=e,n.z=o,this.body.shapes.updateProxy()}},ConnectorHidden}(t.Connector);t.ConnectorHidden=e}(z0||(z0={})),function(t){var e=function(e){function ConnectorTube(){return null!==e&&e.apply(this,arguments)||this}return __extends(ConnectorTube,e),ConnectorTube.prototype.init=function(t){e.prototype.init.call(this,t),null!=t.renderingGroupID&&null!=t.renderingGroupID&&(this.renderingGroupID=t.renderingGroupID),this.localOffsetButton,this.pathNodeTop=t.pathNodeTop,this.pathNodeTop&&(this.pathNodeTop.data.connector=this),this.onChangeObservable.notifyObservers(this)},ConnectorTube}(t.Connector);t.ConnectorTube=e}(z0||(z0={})),function(z){var t=function(r){function Tube(){var t=r.call(this)||this;return t.accType=z.z1044.z1051,t._hasEnterNode=!1,t.initColor1=new BABYLON.Color4(1,1,1,1),t.initColor2=new BABYLON.Color4(1,1,0,1),t.num=0,t.nodes=[],t.radius=0,t.innerRadius=0,t.boxSize=1,t.gridSize=1/3,t.rotation=BABYLON.Vector3.Zero(),t.shape=null,t.topConnector=null,t.botConnector=null,t.rightConnector=null,t.leftConnector=null,t.topConOverrideHexColor=null,t.botConOverrideHexColor=null,t.rightConOverrideHexColor=null,t.leftConOverrideHexColor=null,t.requestDepthSort=!1,t._cage=null,t.tileNum=0,t.mapPlacementInfo=new z.MapPlacementInfo({}),t.topCover=null,t.botCover=null,t.rightCover=null,t.leftCover=null,t._tempArray=[],Tube.count++,t.num=Tube.count,t.placementType=z.PlacementType.GRID|z.PlacementType.MID,t}return __extends(Tube,r),Object.defineProperty(Tube.prototype,"hasEnterNode",{get:function(){return this._hasEnterNode},set:function(t){this._hasEnterNode=t},enumerable:!1,configurable:!0}),Object.defineProperty(Tube.prototype,"cage",{get:function(){return this._cage},set:function(t){(this._cage=t)?this.navigator||(this.navigator=ObjectPool.get("TubeNavigator",{accessory:this,cage:t}),this.navigator.addTube(this),this.updateNavigator()):this.navigator&&(this.navigator.removeTube(this),this.navigator=null)},enumerable:!1,configurable:!0}),Tube.prototype.init=function(t){if(this.requestDepthSort=!0,r.prototype.init.call(this,t),this.controlAnchor||this.addControlAnchor(),t.useLastRotateZ&&(t.rz=Tube.lastRotateZ),this.addToActiveObjects(),this.shape||(this.shape=ObjectPool.get(this.shapeName+"_rg"+this.renderingGroupID,{renderingGroupID:this.renderingGroupID})),this._colors?(this._colors.tube.r=this.initColor1.r,this._colors.tube.g=this.initColor1.g,this._colors.tube.b=this.initColor1.b,this._colors.connectors.r=this.initColor2.r,this._colors.connectors.g=this.initColor2.g,this._colors.connectors.b=this.initColor2.b):(this._colors={},this._colors.tube=new BABYLON.Color3(1,0,0),this._colors.tube.r=this.initColor1.r,this._colors.tube.g=this.initColor1.g,this._colors.tube.b=this.initColor1.b,this._colors.connectors=new BABYLON.Color3(1,1,0)),t.c){var e=t.c.split(",");e[0]&&z.z1073.SetColor3FromHex(e[0],this._colors.tube),e[1]&&z.z1073.SetColor3FromHex(e[1],this._colors.connectors),this.createConnectors(),this._initColors(),2<e.length&&(e[2]&&this.topConnector&&(this.topConOverrideHexColor=e[2],this.topConnector.setColorHex(e[2])),e[3]&&this.rightConnector&&(this.rightConOverrideHexColor=e[3],this.rightConnector.setColorHex(e[3])),e[4]&&this.botConnector&&(this.botConOverrideHexColor=e[4],this.botConnector.setColorHex(e[4])),e[5]&&this.leftGraphNode&&(this.leftConOverrideHexColor=e[5],this.leftConnector.setColorHex(e[5])))}else this._initColors();if(t.isMenuItem)this.controlPositionLocal.y=.8*this.boxSize,t.world=null;else if(!this.hitMeshes){this.hitMeshes=[];var o=z.app.graphicsHelper.getHitMesh(.99*this.boxSize,null,null,!1);o.rotationQuaternion=BABYLON.Quaternion.Identity(),this.hitMeshes.push(o)}},Tube.prototype.createGraphNodes=function(){},Tube.prototype.createConnectors=function(){},Tube.prototype.addToActiveObjects=function(){-1==Tube.activeObjects.indexOf(this)&&Tube.activeObjects.push(this)},Tube.prototype.removeFromActiveObjects=function(){var t=Tube.activeObjects.indexOf(this);-1!=t&&Tube.activeObjects.splice(t,1)},Tube.prototype.updateOutDirs=function(){var t=this.body.rotation.elements;if(this.topGraphNode){(n=this.topGraphNode).data.outDir||(n.data.outDir=BABYLON.Vector3.Zero());var e=0,o=1,i=0;(s=n.data.outDir).x=e*t[0]+o*t[1]+i*t[2],s.y=e*t[3]+o*t[4]+i*t[5],s.z=o*t[6]+o*t[7]+i*t[8]}if(this.botGraphNode){(n=this.botGraphNode).data.outDir||(n.data.outDir=BABYLON.Vector3.Zero());e=0,o=-1,i=0;(s=n.data.outDir).x=e*t[0]+o*t[1]+i*t[2],s.y=e*t[3]+o*t[4]+i*t[5],s.z=o*t[6]+o*t[7]+i*t[8]}if(this.leftGraphNode){(n=this.leftGraphNode).data.outDir||(n.data.outDir=BABYLON.Vector3.Zero());e=-1,o=0,i=0;(s=n.data.outDir).x=e*t[0]+o*t[1]+i*t[2],s.y=e*t[3]+o*t[4]+i*t[5],s.z=o*t[6]+o*t[7]+i*t[8]}if(this.rightGraphNode){var n;(n=this.rightGraphNode).data.outDir||(n.data.outDir=BABYLON.Vector3.Zero());var s;e=1,o=0,i=0;(s=n.data.outDir).x=e*t[0]+o*t[1]+i*t[2],s.y=e*t[3]+o*t[4]+i*t[5],s.z=o*t[6]+o*t[7]+i*t[8]}},Tube.prototype.rotate=function(t,e){void 0===t&&(t=.5*-Math.PI),void 0===e&&(e=!1),this._initColors(),this.setColorOfOverlapConnectors(!0);var o=Tube.z4[1];o.x=0,o.y=1,o.z=0,o.x=0,o.y=0,o.z=-1;var i=Tube.tempBabQuats[0];BABYLON.Quaternion.RotationAxisToRef(o,t,i),this.rotationQuaternion.multiplyToRef(i,this.rotationQuaternion);var n=Tube.z4[2];this.rotationQuaternion.toEulerAnglesToRef(n),this.setRotation(n.x,n.y,n.z,e),Tube.lastRotateZ=n.z},Tube.prototype.limitPosition=function(){r.prototype.limitPosition.call(this),this.setColorOfOverlapConnectors()},Tube.prototype.setRotation=function(t,e,o,i){void 0===i&&(i=!1),this.body&&this.disconnect(),this.rotation.x=t,this.rotation.y=e,this.rotation.z=o;var n=this.rotationQuaternion;BABYLON.Quaternion.RotationYawPitchRollToRef(e,t,o,n),this.body?(this.setBodyRotationQuaternion(n),this.updateNodes(),this.setConnectors(),this.checkConnections(),this.refreshOpenings(),this.updateCovers()):this.setConnectors(),i||this.navigator&&this.updateNavigator(),this.shape&&this.shape.setRotation(t,e,o),this.onChangeObservable.notifyObservers(this)},Tube.prototype.updateNavigator=function(){if(this.navigator&&this.nodes.length){for(var t,e,o=Number.MAX_VALUE,i=-Number.MAX_VALUE,n=-Number.MAX_VALUE,s=Number.MAX_VALUE,a=0;a<this.nodes.length;a++){var r=this.nodes[a];r.x>i&&(i=r.x,e=r),r.x<o&&(o=r.x,t=r),r.y>n&&(n=r.y,r),r.y<s&&(s=r.y,r)}var c,d,p,l,u,y;if(.3<Math.abs(o-i))p=t.connections[0].data.obj,u=e.connections[0].data.obj,t.connections[1]&&(l=t.connections[1].data.obj),e.connections[1]&&(y=e.connections[1].data.obj),p.isInTube&&p!=this&&p.cage==this.cage?d=p:l&&l.isInTube&&l!=this&&l.cage==this.cage&&(d=l),u.isInTube&&u!=this&&u.cage==this.cage?c=u:y&&y.isInTube&&y!=this&&y.cage==this.cage&&(c=y);d&&Math.abs(d.position.x-this.position.x)<.01&&(d=null),c&&Math.abs(c.position.x-this.position.x)<.01&&(c=null);var g=this.navigator;if(d&&d.navigator){if(this.navigator!=d.navigator)return this.navigator.removeTube(this),this.navigator=d.navigator,this.navigator.addTube(this),void(c&&c.updateNavigator())}else if(c&&c.navigator){if(d&&d.navigator==this.navigator)return void c.updateNavigator();if(this.navigator!=c.navigator)return this.navigator.removeTube(this),this.navigator=c.navigator,void this.navigator.addTube(this)}else if(1<g.tubes.length)return this.navigator.removeTube(this),this.navigator=ObjectPool.get("TubeNavigator",{accessory:this,cage:this.cage}),void this.navigator.addTube(this);this.navigator.updateSizePosition()}},Tube.prototype.findBestRotation=function(){for(var t=this.getTotalConnections(),e=(this.rotation.x,this.rotation.y,this.rotation.z,this.getTotalTubeConnections()),o=this.rotation.x,i=this.rotation.y,n=this.rotation.z,s=Tube.lastRotateZ,a=0;a<3;a++){this.rotate(.5*-Math.PI,!0);var r=this.getTotalConnections();t<r&&(t=r,this.rotation.x,this.rotation.y,this.rotation.z);var c=this.getTotalTubeConnections();e<c&&(e=c,o=this.rotation.x,i=this.rotation.y,n=this.rotation.z)}this.setRotation(o,i,n),Tube.lastRotateZ=s},Tube.prototype.getTotalConnections=function(){for(var t=0,e=0;e<this.nodes.length;e++){var o=this.nodes[e];o!=this.centerGraphNode&&(1<o.connections.length&&t++)}return t},Tube.prototype.getTotalTubeConnections=function(){for(var t=0,e=0;e<this.nodes.length;e++){var o=this.nodes[e];o!=this.centerGraphNode&&(1<o.connections.length&&(o.connections[0]!=this.centerGraphNode&&o.connections[1].data.obj.isInTube?t++:o.connections[1]!=this.centerGraphNode&&o.connections[1].data.obj.isInTube&&t++))}return t},Tube.prototype.setPositionDrag=function(t,e,o,i,n){if(void 0===i&&(i=!1),void 0===n&&(n=!1),this.isDragging||(this.requestDepthSort=!0,n||(this._initColors(),this.setColorOfOverlapConnectors(!0))),i&&(this.requestDepthSort=!0),this._connected&&(this.disconnect(),this._connected=!1),r.prototype.setPositionDrag.call(this,t,e,o,i),this.body){var s=this.body.position;s.x=t,s.y=e,s.z=o;var a=this.body.shapes.position;a.x=t,a.y=e,a.z=o,this.body.shapes.updateProxy()}this.shape&&this.shape.setPosition(t,e,o),this.setConnectors(),this.updateCovers()},Tube.prototype.setPositionOnMapFromDrop=function(t,e,o,i){void 0===i&&(i=!1);var n=this._tempDropLoc;this.getPositionOnMapFromDropToRef(t,e,o,n),this.setPositionDrag(n.x,n.y,n.z,!0),this.setPosition(n.x,n.y,n.z),i||this.findBestRotation(),this.setColorOfOverlapConnectors(),this.updateCage()},Tube.prototype.setPosition=function(t,e,o,i){var n=this.position;if(n.x=t,n.y=e,n.z=o,this.body){var s=this.body.position;s.x=t,s.y=e,s.z=o;var a=this.body.shapes.position;a.x=t,a.y=e,a.z=o,this.body.shapes.updateProxy()}if(this.setHitMesh(t,e,o),this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position),this.body){this.disconnect(),this.cage&&this.cage.removeObject(this),this.cage=z.Cage.getCageAt(t,e,o),this.cage&&this.addToObject(this.cage),this.updateNodes(),this.setConnectors(),this.checkConnections(),this.refreshOpenings(),this.updateCovers();this.topCover&&this.topCover.isOnScene,this.botCover&&this.botCover.isOnScene,this.leftCover&&this.leftCover.isOnScene}else this.setConnectors();this.navigator&&this.updateNavigator(),this.shape&&this.shape.setPosition(t,e,o),this._connected=!0,this.onChangeObservable.notifyObservers(this)},Tube.prototype.setConnectors=function(){},Tube.prototype.checkConnections=function(){if(this.checkTubeConnections(),this.cage){if(!this.cage.isReady)return void this.cage.pubsub.subscribe("ready",this.checkConnections,this);this.checkSwingConnections(),this.checkGroundConnections(),this.checkRampConnections(),this.checkPlatformConnections(),this.cage.updateConnectorsAt(this.position.x,this.position.y,this.position.z)}else this.checkSwingConnections(),this.checkGroundConnections(),this.checkRampConnections(),this.checkPlatformConnections()},Tube.prototype.updateCovers=function(){this.isMenuItem||this.body&&(this.topCover=this.updateCoverByConnector(this.topCover,this.topConnector),this.botCover=this.updateCoverByConnector(this.botCover,this.botConnector),this.rightCover=this.updateCoverByConnector(this.rightCover,this.rightConnector),this.leftCover=this.updateCoverByConnector(this.leftCover,this.leftConnector),this.topCover?this.body.shapes.topCovered=!0:this.body.shapes.topCovered=!1,this.botCover?this.body.shapes.botCovered=!0:this.body.shapes.botCovered=!1,this.rightCover?this.body.shapes.rightCovered=!0:this.body.shapes.rightCovered=!1,this.leftCover?this.body.shapes.leftCovered=!0:this.body.shapes.leftCovered=!1)},Tube.prototype.updateCoverByConnector=function(t,e){if(!e)return t&&t.recycle(),null;var o=e.pathNodeTop;if(o){o.connections[0]&&o.connections[0].data.obj,o.connections[1]&&o.connections[1].data.obj,o.connections[2]&&o.connections[2].data.obj,o.connections[3]&&o.connections[3].data.obj;o==this.topGraphNode&&!0,o==this.botGraphNode&&!0;this.id;if(!this.isDragging&&e.pathNodeTop.connections.length<=1){if(!t){var i=!1;this.isMenuItem&&(i=!0),t=ObjectPool.get("TubeCover",{name:"Cover",color:e.color,renderingGroupID:this.renderingGroupID},!1,i)}t.tube=this;var n=e.position,s=e.rotation;return t.setPosition(n.x,n.y,n.z),t.setRotation(s.x,s.y,s.z),t.addToScene(),t.forceUpdate=!0,t}return t?(t.recycle(),null):void 0}},Tube.prototype.removeBeddingConnectionsThroughPlatform=function(){for(var t=this.nodes,e=t.length,o=0;o<e;o++){var i=t[o];if(i!=this.centerGraphNode)for(var n=0;n<i.connections.length;n++){var s=i.connections[n];if(s.data.obj2&&s.data.obj2.accType==z.z1044.z1047)s.data.obj.getPlatformUnder(s.x,i.y,s.z)&&(i.removeConnection(s),s.removeConnection(i),n--)}}},Tube.prototype.checkGroundConnections=function(){this.checkGroundConnectionsAtCage(z.z1044.z1048|z.z1044.z1050|z.z1044.SWING);this.checkGroundConnectionsAtCage(z.z1044.z1047,.7,1)},Tube.prototype.checkPlatformConnections=function(){var t=this._tempArray;t.length=0,z.Platform.getObjectsAt(this.position.x,this.position.y,this.position.z,this.boxSize+1,this.boxSize+1,t);for(var e=0;e<t.length;e++)t[e].skipConnect||this.checkPlatformConnection(t[e])},Tube.prototype.checkPlatformConnection=function(t){if(!t.skipConnect){for(var e=this.position,o=Tube.z4[0],i=.5*this.boxSize,n=!1,s=t.position.x+.5*t.width,a=t.position.x-.5*t.width,r=0;r<this.nodes.length;r++){var c=this.nodes[r];if(!c.data.otherTube&&(c==this.leftGraphNode||c==this.rightGraphNode||c==this.topGraphNode||c==this.botGraphNode)){var d=e.y+i,p=(e.y,e.x-i),l=e.x+i;if(Math.abs(c.y-d)<.3)o.x=0,o.y=1,o.z=0;else if(Math.abs(c.x-l)<.3)o.x=1,o.y=0,o.z=0;else{if(!(Math.abs(c.x-p)<.3))continue;o.x=-1,o.y=0,o.z=0}if(0!=o.y)if(1<this.boxSize){if(s<p||l<a)continue}else if(this.position.x>s||this.position.x<a)continue;var u=t.getGraphNodeAt(c.x,c.y,c.z,null,o,0,t.centerGraphNode);if(u){var y=c.y-u.y;if(!(.5<y||y<-.5)){var g=z1.distanceSquared(u,c);if(!(.7*.7<g)){var m=Math.sqrt(g);u.addConnection(c,m),c.addConnection(u,m),this.makeEnterNode(c),n=!0,1==o.y&&t.addHoleAt(u.x,u.y,u.z)}}}}}n&&(this.updateCovers(),this.removeBeddingConnectionsThroughPlatform())}},Tube.prototype.checkRampConnections=function(){var t=this._tempArray;t.length=0,z.Ramp.getObjectsAt(this.position.x,this.position.y,this.position.z,this.boxSize+1,this.boxSize+1,t);for(var e=0;e<t.length;e++){var o=t[e];o.skipConnect||o.checkTubeConnection(this)}},Tube.prototype.checkSwingConnections=function(){var t=this._tempArray;t.length=0,z.Swing.getObjectsAt(this.position.x,this.position.y,this.position.z,this.boxSize+1,this.boxSize+1,t);for(var e=0;e<t.length;e++){var o=t[e];o.skipConnect||o.checkTubeConnection(this)}},Tube.prototype.checkGroundConnectionsAtCage=function(t,e,o){void 0===t&&(t=z.z1044.z1047|z.z1044.z1048|z.z1044.z1050|z.z1044.SWING),void 0===e&&(e=.7),void 0===o&&(o=null);for(var i,n=this.nodes,s=!1,a=Tube.z4[3],r=0,c=0;c<n.length;c++){var d=n[c];if(!d.data.otherTube&&d!=this.centerGraphNode){a.x=d.x-this.position.x,a.y=d.y-this.position.y,a.z=d.z-this.position.z,a.normalize(),r=a.y,a.scaleInPlace(.33);var p=z.Cage.getCageAt(d.x+a.x,d.y+a.y,d.z+a.z);if(p){if(.9<r)if(p.isInBox(this.centerGraphNode.x,this.centerGraphNode.y,this.centerGraphNode.z))continue;(i=this.checkCageNodeConnection(p,d,e,t,o))&&(r<-.9&&!0,.9<r&&(!0,this.cage&&(a.x=0,a.y=1,a.z=0,this.cage.addHoleAt(d.x,d.y,d.z,a,this)))),s=s||p.isCloseToTrafficArea(d.x,d.y,d.z)}}}return i},Tube.prototype.checkCageNodeConnection=function(t,e,o,i,n){void 0===o&&(o=.7),void 0===i&&(i=z.z1044.z1047|z.z1044.z1048|z.z1044.z1050|z.z1044.SWING),void 0===n&&(n=null);var s=e.data.obj.centerGraphNode,a=Tube.tempVecs[1];a.x=e.x-s.x,a.y=e.y-s.y,a.z=e.z-s.z,a.x=e.x-e.data.obj.position.x,a.y=e.y-e.data.obj.position.y,a.z=e.z-e.data.obj.position.z,a.normalize(a);var r=e.x+a.x*(1/3),c=e.y+a.y*(1/3),d=e.z+a.z*(1/3);if(!t.isInBox(r,c,d)&&!t.isInBox(e.x,e.y,e.z))return null;t.addHoleAt(r,c,d,a,this);var p=null;if(!(p=t.isInBox(s.x,s.y,s.z)?t.getGraphNodeAt(e.x,e.y,e.z,!1,a,.01,null,i):t.getGraphNodeAt(e.x,e.y,e.z,!1,null,null,null,i)))return null;var l=e.x-p.x,u=e.y-p.y,y=e.z-p.z,g=l*l+u*u+y*y;if(n&&(g=l*l+y*y),g<o*o&&(!n||u<n)){g=l*l+u*u+y*y;var m=Math.sqrt(g);return p.addConnection(e,m),e.addConnection(p,m),e.data.obj.makeEnterNode(e),this.updateCovers(),p}},Tube.prototype.createAvoidObject=function(){},Tube.prototype.update=function(){},Tube.prototype.recycle=function(){var t=this.cage,e=this.position.x,o=this.position.y,i=this.position.z;t&&t.removeObject(this),this.body&&(this.body.position.y=99),this.botConOverrideHexColor=null,this.topConOverrideHexColor=null,this.leftConOverrideHexColor=null,this.rightConOverrideHexColor=null,this.topConnector&&(this.topConnector.remove(),ObjectPool.recycle(this.topConnector),this.topConnector=null),this.botConnector&&(this.botConnector.remove(),ObjectPool.recycle(this.botConnector),this.botConnector=null),this.leftConnector&&(this.leftConnector.remove(),ObjectPool.recycle(this.leftConnector),this.leftConnector=null),this.rightConnector&&(this.rightConnector.remove(),ObjectPool.recycle(this.rightConnector),this.rightConnector=null),this.isDragging&&(this.isDragging=!1),this.disconnect(),this.updateCovers(),this.hideBoundingBox(),this.removeFromScene(),this.removeFromActiveObjects(),t&&t.updateConnectorsAt(e,o,i),ObjectPool.recycle(this),this.onChangeObservable.notifyObservers(this),this.onChangeObservable.clear()},Tube.prototype.disconnectNode=function(t){t.data.enterTarget},Tube.prototype.onAfterDisconnect=function(t){t&&t.accType==z.z1044.z1051&&(this.checkRampConnections(),this.checkPlatformConnections()),this.updateConnected(),this.refreshOpenings(),this.updateCovers()},Tube.prototype.disconnect=function(){if(this.body){this.hasEnterNode=!1,this.skipConnect=!0;var t=this.body.shapes,e=this.nodes,o=e.length,i=null;t.topConnected=!1,t.botConnected=!1,t.rightConnected=!1,t.leftConnected=!1;for(var n=Tube.tempArray,s=n.length=0;s<o;s++)if((i=e[s])!=this.centerGraphNode){var a;if(i.connections[1]){i.connections[1].data.obj2&&i.connections[1].data.obj2.removeHoleAt&&i.connections[1].data.obj2.removeHoleAt(i.x,i.y,i.z);var r=i.connections[1].data.obj;r.removeHoleAt&&(a=r)}else a=z.Cage.getCageAt(i.x,i.y,i.z,.25);a&&(-1==n.indexOf(a)&&n.push(a),a.removeHoleAt(i.x,i.y,i.z),a.updateConnectorsAt(i.x,i.y,i.z),this.cage&&.3<i.y-this.centerGraphNode.y&&this.cage.removeHoleAt(i.x,i.y,i.z),i.data.obj2&&i.data.obj2.removeHoleAt&&i.data.obj2.removeHoleAt(i.x,i.y,i.z))}for(s=0;s<o;s++)if((i=e[s])!=this.centerGraphNode){i.data.enterEvent=null,i.data.enterNextNode=null,i.data.enterTarget&&(ObjectPool.recycle(i.data.enterTarget),i.data.enterTarget=null,i.data.obj&&i.data.obj);for(var c=0;c<i.connections.length;c++){var d=i.connections[c];d!=this.centerGraphNode&&(d.data.obj!=i.data.obj&&(i.data.otherTube&&(i.data.otherTube=null,d.data.otherTube=null),i.removeConnection(d),d.removeConnection(i),c--,d.data.obj2&&d.data.obj2.rotation&&d.data.obj2,d.data.obj&&d.data.obj.removeHoleAt?d.data.obj.removeHoleAt(i.x,i.y,i.z):d.data.connector&&d.data.connector.parent&&d.data.connector.parent.removeHoleAt&&d.data.connector.parent.removeHoleAt(i.x,i.y,i.z),d.data.tube&&(d.data.tube.checkGroundConnections(),d.data.tube.onAfterDisconnect(this)),d.data.obj2&&d.data.obj2.onAfterDisconnect&&d.data.obj2.onAfterDisconnect(this),d.data.obj&&d.data.obj.onAfterDisconnect&&d.data.obj!=this&&d.data.obj.onAfterDisconnect(this)))}i.x=9999,i.y=9999,i.z=9999}else i.x=9999,i.y=9999,i.z=9999;for(s=0;s<n.length;s++){n[s].updateConnectors()}this.skipConnect=!1}},Tube.prototype.isTubeNodeConnectedToOtherTube=function(t){var e=this.body.shapes;return!(t!=this.leftGraphNode||!e.leftConnected)||(!(t!=this.rightGraphNode||!e.rightConnected)||(!(t!=this.botGraphNode||!e.botConnected)||(!(t!=this.topGraphNode||!e.topConnected)||void 0)))},Tube.prototype.updateConnected=function(){if(this.body)for(var t,e,o,i,n,s,a,r=this.body,c=r.position,d=c.x,p=c.y,l=c.z,u=r.rotation.elements,y=r.shapes,g=this.nodes,m=g.length,f=0;f<m;f++)if((t=g[f])!=this.centerGraphNode){e=t.x-d,o=t.y-p,i=t.z-l,n=e*u[0]+o*u[3]+i*u[6],s=e*u[1]+o*u[4]+i*u[7],e*u[2]+o*u[5]+i*u[8],a=1<t.connections.length;for(var A=!1,b=0;b<t.connections.length;b++){var v=t.connections[b];v.data.obj!=this&&(v.data.obj&&v.data.obj.accType==z.z1044.z1051&&(A=!0))}a=a&&A;n<1e-4&&-1e-4<n?0<s?y.topConnected=a:s<0&&(y.botConnected=a):n<0?y.leftConnected=a:0<n&&(y.rightConnected=a)}},Tube.prototype.isInTube=function(t,e,o,i){return void 0===i&&(i=0),!1},Tube.prototype.isInBox=function(t,e,o,i){if(void 0===i&&(i=0),!this.body)return!1;var n=this.body.position,s=t-n.x,a=e-n.y,r=o-n.z,c=.5*this.boxSize+i,d=.5*this.boxSize+i,p=.5*this.boxSize+i;return s<c&&-c<s&&a<d&&-d<a&&r<p&&-p<r},Tube.prototype.getNeighborAt=function(t,e,o){for(var i,n,s,a,r=this.nodes,c=r.length,d=0;d<c;d++)if((i=r[d])!=this.centerGraphNode){s=(a=i.connections).length;for(var p=0;p<s;p++)if((n=a[p]).data.obj&&n.data.obj.connectTubes&&n.data.obj.isInBox(t,e,o))return n.data.obj}for(d=0;d<c;d++)if((i=r[d])!=this.centerGraphNode){s=(a=i.connections).length;for(p=0;p<s;p++)if((n=a[p]).data.obj){if(n.data.obj.isInBox(t,e,o))return n.data.obj}else n.data.obj}},Tube.prototype.getGraphNodeAtClosestToOpening=function(t,e,o){for(var i,n=Number.MAX_VALUE,s=0;s<this.nodes.length;s++){var a=this.nodes[s];if(this.centerGraphNode!=a){var r=t-a.x,c=e-a.y,d=o-a.z,p=r*r+c*c+d*d;p<n&&(n=p,i=a)}}return i},Tube.prototype.getGraphNodeAt=function(t,e,o,i,n,s){var a;void 0===i&&(i=!1),void 0===n&&(n=null),void 0===s&&(s=0);for(var r=Number.MAX_VALUE,c=0;c<this.nodes.length;c++){var d=this.nodes[c],p=t-d.x,l=e-d.y,u=o-d.z,y=p*p+l*l+u*u;y<r&&(r=y,a=d)}return a},Tube.recycleAll=function(){for(var t=Tube.activeObjects;t.length;)t[0].recycle()},Tube.getObjectAt=function(t,e,o){for(var i,n,s=Tube.activeObjects,a=s.length,r=0;r<a;r++)if((i=s[r]).isInBox(t,e,o)){n=i;break}return n},Tube.getObjectsAt=function(t,e,o,i,n,s){for(var a,r=Tube.activeObjects,c=r.length,d=t-.5*i,p=t+.5*i,l=e-.5*n,u=e+.5*n,y=0;y<c;y++){var g=.5*(a=r[y]).boxSize,m=a.position.x-g,f=a.position.x+g,A=a.position.y+g,b=a.position.y-g;f<=d||p<=m||u<=b||A<=l||s.push(a)}},Tube.prototype.refreshOpenings=function(){},Tube.prototype.connectNode=function(t,e){if(void 0===e&&(e=-1),t){var o=this.nodes,i=1/3*1.1;-1!=e&&(i=e);for(var n=i*i,s=0;s<o.length;s++){var a=o[s],r=t.x-a.x,c=t.y-a.y,d=t.z-a.z,p=r*r+c*c+d*d;if(p<n){var l=Math.sqrt(p);return t.addConnection(a,l),a.addConnection(t,l),t.data.obj&&t.data.obj.updateConnected&&t.data.obj.updateConnected(),a.data.obj&&a.data.obj.updateConnected&&a.data.obj.updateConnected(),a}}}},Tube.prototype.getDirection=function(t,e,o,i){},Tube.prototype.addToObject=function(t){this.parent=t,(this.cage=t)&&this.cage.addObject(this)},Tube.prototype.addToScene=function(){this.isOnScene||(r.prototype.addToScene.call(this),this.body&&!this.body.parent&&this.world.addRigidBody(this.body),this.topConnector&&this.topConnector.addToScene(),this.rightConnector&&this.rightConnector.addToScene(),this.botConnector&&this.botConnector.addToScene(),this.leftConnector&&this.leftConnector.addToScene(),this.shape&&this.shape.addToScene())},Tube.prototype.removeFromScene=function(){this.isOnScene&&(r.prototype.removeFromScene.call(this),this.body&&this.body.parent&&(this.body.position.y=9999,this.body.shapes.updateProxy(),this.body.shapes.position.y=this.body.position.y,this.world.removeRigidBody(this.body)),this.topConnector&&this.topConnector.removeFromScene(),this.rightConnector&&this.rightConnector.removeFromScene(),this.botConnector&&this.botConnector.removeFromScene(),this.leftConnector&&this.leftConnector.removeFromScene(),this.shape&&this.shape.removeFromScene())},Tube.prototype.updateNodes=function(){},Tube.prototype.makeEnterNode=function(t){t.data.obj.hasEnterNode=!0,t.data.enterEvent=z.TubeEvents.ENTER,t.data.enterTarget||(t.data.enterTarget=ObjectPool.get("OIMO.Vec3")),t.data.enterNextNode=this.centerGraphNode,this.updateNodes()},Tube.prototype.initNode=function(t){if(t.data.enterEvent=null,t.data.enterNextNode=null,t.data.enterTarget){ObjectPool.recycle(t.data.enterTarget),t.data.enterTarget=null;for(var e=t.connections,o=e.length-1;0<=o;o--){var i=e[o];i.data.obj!=this&&(t.removeConnection(i),i.removeConnection(t))}this.updateNodes()}},Tube.prototype.initNodes=function(){this.hasEnterNode=!1;for(var t=0;t<this.nodes.length;t++){var e=this.nodes[t];if(e!=this.centerGraphNode&&(e.data.enterEvent=null,e.data.enterNextNode=null,e.data.enterTarget)){ObjectPool.recycle(e.data.enterTarget),e.data.enterTarget=null;for(var o=e.connections,i=o.length-1;0<=i;i--){var n=o[i];"Tube"!=n.data.obj.type&&(e.removeConnection(n),n.removeConnection(e))}}}this.updateNodes()},Tube.prototype.checkTubeConnections=function(){for(var t=Tube.activeObjects,e=0;e<t.length;e++)t[e].skipConnect||this.connectTubes(t[e])},Tube.prototype.connectTubes=function(t){if(t.isOnScene&&t!=this)for(var e=t.nodes,o=this.nodes,i=0;i<e.length;i++){var n=e[i];if(!n.data.otherTube)for(var s=0;s<o.length;s++){var a=o[s];if(!a.data.othereTube){var r=n.x-a.x,c=n.y-a.y,d=n.z-a.z,p=r*r+c*c+d*d;if(p<1/3*1.1*(1/3*1.1)){if(t.centerGraphNode==n)continue;if(this.centerGraphNode==a)continue;var l=Math.sqrt(p);t.initNode(n),this.initNode(a),2<n.connections.length&&(n.connections,n.data.obj.setColor(1,1,1)),2<a.connections.length&&(a.connections,a.data.obj.setColor(1,1,1)),n.addConnection(a,l),a.addConnection(n,l),n.data.obj.updateConnected(),a.data.obj.updateConnected(),n.data.obj.refreshOpenings(),a.data.obj.refreshOpenings(),n.data.obj.updateCovers(),a.data.obj.updateCovers(),a.data.otherTube=n.data.obj,n.data.otherTube=a.data.obj}}}}},Tube.prototype.isValidDropLocation=function(t,e,o){var i=this._tempDropLoc;this.getPositionOnMapFromDropToRef(t,e,o,i);var n=z.app.builder.background,s=n.mesh.position.x+.5*n.width,a=n.mesh.position.x-.5*n.width,r=n.mesh.position.y+.5*n.height,c=n.mesh.position.y-.5*n.height;if(t+.5*this.boxSize>s)return!1;if(t-.5*this.boxSize<a)return!1;if(e+.5*this.boxSize>r)return!1;if(e+.5*this.boxSize<c)return!1;var d=z.Cage.getCageAt(i.x,i.y,i.z);if(d){if(d.getObjectAt(i.x,i.y,i.z,z.z1044.z1046))return!1;var p=d.getObjectAt(i.x,i.y,i.z,z.z1044.z1050,1);if(p){var l=.5*this.boxSize,u=p.width+.5,y=p.height,g=p.position,m=g.x+.5*u+l,f=g.x-.5*u-l,A=g.y+y+l,b=g.y-l,v=i.x,x=i.y;if(f<v&&v<m&&b<x&&x<A)return!1}var C=d.getObjectAt(i.x,i.y,i.z,z.z1044.SWING,1);if(C){l=.5*this.boxSize-.01;var S=.5*C.width+.2,T=C.height,B=C.position,O=B.x+S+l,P=B.x-S-l,M=B.y+T+l,I=B.y-l;v=i.x,x=i.y;if(P<v&&v<O&&I<x&&x<M)return!1}}var N=Tube.getObjectAt(i.x,i.y,i.z);return!N||N==this},Tube.mergeMeshes=function(t,e){var o=e[t+"_front"],i=e[t+"_back"];o.position.x=0,o.position.y=0,o.position.z=0,i.position.x=0,i.position.y=0,i.position.z=0;var n=BABYLON.Mesh.MergeMeshes([o,i],!0);return n.name=t,n.getScene().removeMesh(n),e[t]=n},Tube.prototype.getProps=function(){var t=r.prototype.getProps.call(this),e=Tube.tempArray;if(e.length=0,this._colors.tube){var c1=this._colors.tube.toHexString();e.push(c1)}if(this._colors.connectors){var c2=this._colors.connectors.toHexString();e.push(c2)}return(this.topConOverrideHexColor||this.rightConOverrideHexColor||this.botConOverrideHexColor||this.leftConOverrideHexColor)&&e.push(this.topConOverrideHexColor),(this.rightConOverrideHexColor||this.botConOverrideHexColor||this.leftConOverrideHexColor)&&e.push(this.rightConOverrideHexColor),(this.botConOverrideHexColor||this.leftConOverrideHexColor)&&e.push(this.botConOverrideHexColor),this.leftConOverrideHexColor&&e.push(this.leftConOverrideHexColor),t.c=e.join(),t},Tube.prototype.getClosestEnterNode=function(t){for(var e=null,o=1e3,i=0;i<this.nodes.length;i++){var n=this.nodes[i];if(n.data.enterEvent){var s=t.x-n.x,a=t.y-n.y,r=t.z-n.z,c=s*s+a*a+r*r;c<o&&(o=c,e=n)}}return e},Tube.GetTubeConnectedToNodeAt=function(t,e,o,i){for(var n=t.connections,s=n.length,a=0;a<s;a++){var r=n[a];if(r.data.obj&&(r.data.obj.accType==z.z1044.z1051&&r.data.obj.isInBox(e,o,i)))return r.data.obj}},Tube.prototype.setColor=function(t,e,o,i){r.prototype.setColor.call(this,t,e,o,i),"tube"==i?this.shape?this.shape.setColor(t,e,o):(this.color.r=t,this.color.g=e,this.color.b=o):"connectors"==i&&(z.app.builder&&z.app.builder.isActive&&(this.topConOverrideHexColor=null,this.botConOverrideHexColor=null,this.rightConOverrideHexColor=null,this.leftConOverrideHexColor=null),this.botConnector&&(this.botConnector.setColor(t,e,o),this.setColorOfOverlapConnector(this.botConnector)),this.topConnector&&(this.topConnector.setColor(t,e,o),this.setColorOfOverlapConnector(this.topConnector)),this.rightConnector&&(this.rightConnector.setColor(t,e,o),this.setColorOfOverlapConnector(this.rightConnector)),this.leftConnector&&(this.leftConnector.setColor(t,e,o),this.setColorOfOverlapConnector(this.leftConnector)),this.botCover&&this.botCover.setColor(t,e,o),this.topCover&&this.topCover.setColor(t,e,o),this.rightCover&&this.rightCover.setColor(t,e,o),this.leftCover&&this.leftCover.setColor(t,e,o))},Tube.prototype.setColorOfOverlapConnectors=function(t){void 0===t&&(t=!1),this.topConnector&&this.setColorOfOverlapConnector(this.topConnector,t),this.botConnector&&this.setColorOfOverlapConnector(this.botConnector,t),this.rightConnector&&this.setColorOfOverlapConnector(this.rightConnector,t),this.leftConnector&&this.setColorOfOverlapConnector(this.leftConnector,t)},Tube.prototype.setColorOfOverlapConnector=function(t,e){if(void 0===e&&(e=!1),z.app.builder&&z.app.builder.isActive&&t.pathNodeTop){var o=t.pathNodeTop.connections[1];if(o){var i=o.data.tube;if(i){var n=t.color;e&&(n=i._colors.connectors);var s=t.position;i.topConnector&&i.topConnector.position.equalsWithEpsilon(s,.01)?i.setConnectorColor(i.topConnector,n.r,n.g,n.b):i.botConnector&&i.botConnector.position.equalsWithEpsilon(s,.01)?i.setConnectorColor(i.botConnector,n.r,n.g,n.b):i.rightConnector&&i.rightConnector.position.equalsWithEpsilon(s,.01)?i.setConnectorColor(i.rightConnector,n.r,n.g,n.b):i.leftConnector&&i.leftConnector.position.equalsWithEpsilon(s,.01)&&i.setConnectorColor(i.leftConnector,n.r,n.g,n.b)}}}},Tube.prototype.setConnectorColor=function(t,e,o,i){t.setColor(e,o,i),t==this.topConnector?this.topConOverrideHexColor=z.z1073.GetHexFromColor3(t.color):t==this.botConnector?this.botConOverrideHexColor=z.z1073.GetHexFromColor3(t.color):t==this.rightConnector?this.rightConOverrideHexColor=z.z1073.GetHexFromColor3(t.color):t==this.leftConnector&&(this.leftConOverrideHexColor=z.z1073.GetHexFromColor3(t.color)),z.app.builder.isActive&&z.app.saveDataItem(this)},Tube.prototype.setParentMesh=function(t){this.shape&&this.shape.sourceMesh&&(this.shape.sourceMesh.parent=t),this.topConnector.shape&&this.topConnector.shape.sourceMesh&&(this.topConnector.shape.sourceMesh.parent=t)},Tube.prototype.getOtherTubeFromConnector=function(t){if(t&&t.pathNodeTop){var e=t.pathNodeTop.connections[1];if(e)return e.data.tube}},Tube.prototype.getConnectedTubes=function(t){var e;this.topConnector&&(e=this.getOtherTubeFromConnector(this.topConnector))&&t.push(e),this.rightConnector&&(e=this.getOtherTubeFromConnector(this.rightConnector))&&t.push(e),this.botConnector&&(e=this.getOtherTubeFromConnector(this.botConnector))&&t.push(e),this.leftConnector&&(e=this.getOtherTubeFromConnector(this.leftConnector))&&t.push(e)},Tube.prototype.getCageFromConnector=function(t){if(t&&t.pathNodeTop){var e=t.pathNodeTop.connections[1];if(e&&e.data.obj&&e.data.obj.accType==z.z1044.z1048)return e.data.obj}},Tube.prototype.getConnectedCages=function(t){var e;this.topConnector&&(e=this.getCageFromConnector(this.topConnector))&&-1==t.indexOf(e)&&t.push(e),this.rightConnector&&(e=this.getCageFromConnector(this.rightConnector))&&-1==t.indexOf(e)&&t.push(e),this.botConnector&&(e=this.getCageFromConnector(this.botConnector))&&-1==t.indexOf(e)&&t.push(e),this.leftConnector&&(e=this.getCageFromConnector(this.leftConnector))&&-1==t.indexOf(e)&&t.push(e)},Tube.prototype.getRandomConnectedAcc=function(t){this._tempArray.length=0,this.getConnectedTubes(this._tempArray),this.getConnectedCages(this._tempArray);var e=this._tempArray.length,o=this._tempArray[Math.floor(e*Math.random())];if(t&&1<e)for(var i=0;o==t&&(o=this._tempArray[Math.floor(e*Math.random())],!(10<++i)););return o},Tube.tempVecs=[new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3],Tube.tempQuats=[new OIMO.Quat,new OIMO.Quat,new OIMO.Quat],Tube.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],Tube.tempBabQuats=[BABYLON.Quaternion.Zero(),BABYLON.Quaternion.Zero(),BABYLON.Quaternion.Zero()],Tube.tempBabMats=[BABYLON.Matrix.Identity()],Tube.tempArray=[],Tube.activeObjects=[],Tube.count=0,Tube.lastRotateZ=0,Tube}(z.z1092);z.Tube=t}(z0||(z0={})),function(y){var t=function(p){function TubeCap(){var t=p.call(this)||this;return t.height=0,t.mapPlacementInfo=new y.MapPlacementInfo({mapPlacementSizeX:.25,mapPlacementSizeY:.25}),t.initColor1.r=1,t.initColor1.g=1,t.initColor1.b=0,t.color.copyFrom(t.initColor1),t}return __extends(TubeCap,p),TubeCap.prototype.init=function(t){p.prototype.init.call(this,t),this.textureName="tubeStraightTexture",this.canRotate=!1;var e="tube"+this.num;this.boxSize=1,t.boxSize&&(this.boxSize=t.boxSize),this.gridSize=this.boxSize/3,this.height=this.boxSize,this.radius=.25*this.boxSize,this.innerRadius=.9*this.radius,this.innerRadius=.85*this.radius,this.innerRadius=.8*this.radius;var o=0,i=0;null!=t.x&&(o=t.x),null!=t.y&&(i=t.y);var n=0,s=0,a=0;if(null!=t.rx&&(n=t.rx),null!=t.ry&&(s=t.ry),null!=t.rz&&(a=t.rz),!this.isMenuItem&&!this.body){this.world=t.world,this.createGraphNodes();var r=[1,.4,.2,y.App.z1033,4294967295];this.body=new OIMO.Body({size:[this.radius,this.height,this.innerRadius],pos:[0,0,0],rot:[180/Math.PI*0,180/Math.PI*0,180/Math.PI*0],world:this.world,type:"tube",move:!1,name:e+"_tube",config:r}).body,(this.body.shapes.entity=this).body.shapes.botCovered=!0,this.body.shapes.offsetCover=.8*-this.height,this.body.shapes.offsetHitBoxBottom=this.height;var c=.5*this.height;this.centerGraphNode.addConnection(this.topGraphNode,c),this.topGraphNode.addConnection(this.centerGraphNode,c)}if(this.boxSize=this.height,t.isMenuItem)this.setPosition(o,i+.5*this.boxSize,0),this.setConnectors();else{if(this.hitMeshes){var d=this.hitMeshes[0];d.rotationQuaternion=BABYLON.Quaternion.Identity(),d.scaling.x=.45,d.scaling.y=.25,d.scaling.z=.45,y.app.graphicsHelper.scene.addMesh(d)}this.controlPositionLocal.x=0,this.controlPositionLocal.y=-.5,this.controlPositionLocal.z=0,this.setPosition(o,i,0),this.setRotation(n,s,a),t.skipAddToScene||(this.addToScene(),this.cage?this.cage.isReady?this.checkConnections():this.cage.pubsub.subscribe("ready",this.checkConnections,this):this.checkConnections())}},TubeCap.prototype.updateNodes=function(){if(this.body){var t=this.centerGraphNode,e=this.topGraphNode,o=this.gridSize,i=this.position.x,n=this.position.y,s=this.position.z,a=0;e.data.enterEvent&&(a=o);var r=o+a,c=0,d=(u=a=0)*(y=this.body.rotation.elements)[0]+r*y[1]+c*y[2]+i,p=u*y[3]+r*y[4]+c*y[5]+n,l=u*y[6]+r*y[7]+c*y[8]+s;e.x=d,e.y=p,e.z=l,t.x=i+.3*y[1],t.y=n+.3*y[4],t.z=s+.3*y[7];r=2*o,c=0,d=(u=0)*(y=this.body.rotation.elements)[0]+r*y[1]+c*y[2]+i,p=u*y[3]+r*y[4]+c*y[5]+n,l=u*y[6]+r*y[7]+c*y[8]+s;var u,y,g=e.data.enterTarget;g&&(g.x=d,g.y=p,g.z=l),this.updateOutDirs()}},TubeCap.prototype.isInTube=function(t,e,o,i){if(void 0===i&&(i=0),!this.isInBox(t,e,o,i))return!1;var n=this.body,s=n.position,a=n.rotation.elements,r=t-s.x,c=e-s.y,d=o-s.z,p=r*a[0]+c*a[3]+d*a[6],l=r*a[1]+c*a[4]+d*a[7],u=r*a[2]+c*a[5]+d*a[8];return p*p+u*u<this.radius*this.radius&&l>.2*this.height},TubeCap.prototype.createGraphNodes=function(){this.isMenuItem||this.centerGraphNode||(this.centerGraphNode=new GraphNode(0,0,0),this.topGraphNode=new GraphNode(0,1,0),((((this.centerGraphNode.data.tube=this).centerGraphNode.data.obj=this).topGraphNode.data.tube=this).topGraphNode.data.obj=this).nodes.push(this.centerGraphNode),this.nodes.push(this.topGraphNode),y.app.graph.addNode(this.centerGraphNode),y.app.graph.addNode(this.topGraphNode))},TubeCap.prototype.createConnectors=function(){if(!this.topConnector){this.createGraphNodes();var t=!1;this.isMenuItem&&(t=!0),this.topConnector=ObjectPool.get(y.ConnectorTube.name,{pathNodeTop:this.topGraphNode,renderingGroupID:this.renderingGroupID},!1,t),this.isOnScene&&this.topConnector.addToScene()}},TubeCap.prototype.setConnectors=function(){this.topConnector||this.createConnectors();var t=this.gridSize,e=this.position.x,o=this.position.y,i=this.position.z,n=1.5*t,s=y.Tube.tempBabMats[0];this.rotationQuaternion.toRotationMatrix(s);var a=s.m,r=0*a[0]+n*a[4]+0*a[8]+e,c=0*a[1]+n*a[5]+0*a[9]+o,d=0*a[2]+n*a[6]+0*a[10]+i;this.topConnector.setPosition(r,c,d);var p=y.Tube.tempBabQuats[0];y.Tube.tempBabQuats[1];p.copyFrom(this.rotationQuaternion);var l=y.Tube.tempQuats[0];l.x=p.x,l.y=p.y,l.z=p.z,l.s=p.w;var u=y.Tube.z4[0];p.toEulerAnglesToRef(u),this.topConnector.setRotation(u.x,u.y,u.z)},TubeCap.prototype.getDirection=function(t,e,o){var i=this.body,n=i.position,s=i.rotation.elements,a=e.x-n.x,r=e.y-n.y,c=e.z-n.z,d=(s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8],o.x-n.x),p=o.y-n.y,l=o.z-n.z,u=(s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8],o.x-e.x),y=o.y-e.y,g=o.z-e.z,m=(s[0],s[3],s[6],u*s[1]+y*s[4]+g*s[7]);s[2],s[5],s[8],u=0,y=1,g=0;m<0&&(y=-1),t.x=u*s[0]+y*s[1]+g*s[2],t.y=u*s[3]+y*s[4]+g*s[5],t.z=u*s[6]+y*s[7]+g*s[8]},TubeCap.prototype.getCenterAtPoint=function(t,e){var o=this.body,i=o.position,n=o.rotation.elements,s=e.x-i.x,a=e.y-i.y,r=e.z-i.z,c=(n[0],n[3],n[6],s*n[1]+a*n[4]+r*n[7]),d=(n[2],n[5],n[8],c);t.x=0*n[0]+d*n[1]+0*n[2],t.y=0*n[3]+d*n[4]+0*n[5],t.z=0*n[6]+d*n[7]+0*n[8],t.x+=i.x,t.y+=i.y,t.z+=i.z},TubeCap.prototype.refreshOpenings=function(){this.topConnector.refresh()},TubeCap.prototype.updateCovers=function(){},TubeCap.prototype.setHitMesh=function(t,e,o){if(this.hitMeshes&&this.hitMeshes[0]){var i=this.hitMeshes[0];i.rotationQuaternion.copyFrom(this.rotationQuaternion);var n=this.body.rotation.elements;i.position.x=t+.36*n[1],i.position.y=e+.36*n[4],i.position.z=o+.36*n[7],i.computeWorldMatrix(),BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,i.getWorldMatrix(),this.controlAnchor.position)}},TubeCap.prototype.setRotation=function(t,e,o,i){void 0===i&&(i=!1),p.prototype.setRotation.call(this,t,e,o,i),this.hitMeshes&&this.hitMeshes[0]&&this.setHitMesh(this.position.x,this.position.y,this.position.z)},TubeCap.prototype.isValidDropLocation=function(t,e,o){this.setHitMesh(t,e,o);var i=this.hitMeshes[0].position,n=y.Cover.getClosestCoversAt(i.x,i.y,i.z,1);if(n){var s=this.rotation.x,a=this.rotation.y,r=this.rotation.z,c=this.position.x,d=this.position.y,p=this.position.z;this.setToCover(n);var l=this.intersectsAccesories(y.app.objsOnScene);return this.setRotation(s,a,r),this.setPositionDrag(c,d,p),!l}return!1},TubeCap.prototype.setPositionDrag=function(t,e,o,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),this.isDragging||n||this.setRotation(0,0,0),p.prototype.setPositionDrag.call(this,t,e,o,i,n)},TubeCap.prototype.getCenterAtPosToRef=function(t,e,o,i){var n=this.hitMeshes[0].position;i.x=n.x,i.y=n.y,i.z=n.z},TubeCap.prototype.setToCover=function(t){this.setRotation(t.rotation.x,t.rotation.y,t.rotation.z+Math.PI);var e=t.position,o=this.body.rotation.elements,i=0*o[0]+-.5*o[1]+0*o[2],n=0*o[3]+-.5*o[4]+0*o[5],s=z1.roundToDecimalPlace(e.x+i,1),a=z1.roundToDecimalPlace(e.y+n,1),r=z1.roundToDecimalPlace(e.z,1);this.setPosition(s,a,r)},TubeCap.prototype.setPositionOnMapFromDrop=function(t,e,o,i){this.isDragging=!1,this.setHitMesh(t,e,o);var n=this.hitMeshes[0].position,s=y.Cover.getClosestCoversAt(n.x,n.y,n.z,1);s&&this.setToCover(s)},TubeCap.prototype.findBestRotation=function(){},TubeCap}(y.Tube);y.TubeCap=t}(z0||(z0={})),function(i){var t=function(){function TubeCapConfig(){this.objName="t1",i.TubeCap.objectCount=TubeCapConfig.maxObjects}return TubeCapConfig.prototype.initObjectPool=function(t){var e={shapeName:this.objName,world:t,x:0,y:0,z:0,rx:0,ry:0,rz:0,boxSize:1,skipAddToScene:!0};ObjectPool.addClass(this.objName,i.TubeCap,e)},TubeCapConfig.prototype.getSceneFileNames=function(t){},TubeCapConfig.prototype.getCreateMeshFunctions=function(t){t.TubeCap=this._createMeshes},TubeCapConfig.prototype._createMeshes=function(t,e){i.Tube.mergeMeshes("TubeCap",e);var o=BABYLON.MeshBuilder.CreatePlane("",{size:1},t);o.position.y+=.3,o.bakeCurrentTransformIntoVertices(),t.removeMesh(o),e.tubeCapMenuButton=o},TubeCapConfig.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"TubeCap",numInstances:TubeCapConfig.maxObjects,maxInstances:TubeCapConfig.maxObjects,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0}),t.push({shapeName:this.objName,meshName:"TubeCapButton",numInstances:TubeCapConfig.maxObjects,maxInstances:TubeCapConfig.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName,meshName:"TubeCap",numInstances:1,maxInstances:1,applyMaterialToSPS:"tubeMat",computeTextures:!0,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"tubeCapMenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:i.App.menuRenderingGroupID})},TubeCapConfig.prototype.getz1064Items=function(t){t.push(new i.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Tubes",order:0,offsetY:-.3}))},TubeCapConfig.maxObjects=10,TubeCapConfig}();i.TubeCapConfig=t,i.App.AddEntityConfig(new t)}(z0||(z0={})),function(E){var t=function(d){function TubeCross(){var t=d.call(this)||this;return t.height=0,t.bindedKeepPosInside=t.keepPosInside.bind(t),t}return __extends(TubeCross,d),TubeCross.prototype.init=function(t){d.prototype.init.call(this,t),this.textureName="tubeCrossTexture",this.canRotate=!1;var e="tube"+this.num;this.boxSize=1,t.boxSize&&(this.boxSize=t.boxSize),this.gridSize=this.boxSize/3,this.height=this.boxSize,this.radius=.25*this.boxSize,this.innerRadius=.9*this.radius,this.innerRadius=.85*this.radius,this.innerRadius=.8*this.radius;var o=0,i=0;null!=t.x&&(o=t.x),null!=t.y&&(i=t.y);var n=0,s=0,a=0;if(null!=t.rx&&(n=t.rx),null!=t.ry&&(s=t.ry),null!=t.rz&&(a=t.rz),!this.isMenuItem&&!this.body){this.world=t.world,this.createGraphNodes();var r=[1,.4,.2,E.App.z1033,4294967295];this.body=new OIMO.Body({size:[this.radius,this.height,this.innerRadius],pos:[0,0,0],rot:[180/Math.PI*0,180/Math.PI*0,180/Math.PI*0],world:this.world,type:"crossTube",move:!1,name:e+"_tube",config:r}).body;var c=.5*(this.body.shapes.entity=this).height;this.botGraphNode.addConnection(this.centerGraphNode,c),this.centerGraphNode.addConnection(this.botGraphNode,c),this.centerGraphNode.addConnection(this.topGraphNode,c),this.topGraphNode.addConnection(this.centerGraphNode,c),this.centerGraphNode.addConnection(this.rightGraphNode,c),this.rightGraphNode.addConnection(this.centerGraphNode,c),this.centerGraphNode.addConnection(this.leftGraphNode,c),this.leftGraphNode.addConnection(this.centerGraphNode,c)}t.isMenuItem?(this.setPosition(o,i+.5*this.boxSize,0),this.setConnectors()):(this.setPosition(o,i,0),this.setRotation(n,s,a),t.skipAddToScene||(this.addToScene(),this.cage?this.cage.isReady?this.checkConnections():this.cage.pubsub.subscribe("ready",this.checkConnections,this):this.checkConnections()))},TubeCross.prototype.updateNodes=function(){if(this.body){var t=this.centerGraphNode,e=this.topGraphNode,o=this.botGraphNode,i=this.rightGraphNode,n=this.leftGraphNode,s=this.gridSize,a=.5*this.boxSize,r=this.position.x,c=this.position.y,d=this.position.z;t.x=r,t.y=c,t.z=d;var p=0;e.data.enterEvent&&(p=.5*s);var l=0,u=a+p,y=0;p=0,o.data.enterEvent&&(p=.5*s);var g=0,m=-a-p,f=0;p=0,i.data.enterEvent&&(p=.5*s);var A=a+p,b=0,v=0;p=0,n.data.enterEvent&&(p=.5*s);var x=-a-p,C=0,S=0,T=l*(F=this.body.rotation.elements)[0]+u*F[1]+y*F[2]+r,B=l*F[3]+u*F[4]+y*F[5]+c,O=l*F[6]+u*F[7]+y*F[8]+d,P=g*F[0]+m*F[1]+f*F[2]+r,M=g*F[3]+m*F[4]+f*F[5]+c,I=g*F[6]+m*F[7]+f*F[8]+d,N=A*F[0]+b*F[1]+v*F[2]+r,z=A*F[3]+b*F[4]+v*F[5]+c,w=A*F[6]+b*F[7]+v*F[8]+d,_=x*F[0]+C*F[1]+S*F[2]+r,R=x*F[3]+C*F[4]+S*F[5]+c,L=x*F[6]+C*F[7]+S*F[8]+d;e.x=T,e.y=B,e.z=O,o.x=P,o.y=M,o.z=I,i.x=N,i.y=z,i.z=w,n.x=_,n.y=R,n.z=L;u=2*s,y=0,g=0,m=2*-s,f=0,A=2*s,b=0,v=0,x=2*-s,C=0,S=0,T=(l=0)*(F=this.body.rotation.elements)[0]+u*F[1]+y*F[2]+r,B=l*F[3]+u*F[4]+y*F[5]+c,O=l*F[6]+u*F[7]+y*F[8]+d,P=g*F[0]+m*F[1]+f*F[2]+r,M=g*F[3]+m*F[4]+f*F[5]+c,I=g*F[6]+m*F[7]+f*F[8]+d,N=A*F[0]+b*F[1]+v*F[2]+r,z=A*F[3]+b*F[4]+v*F[5]+c,w=A*F[6]+b*F[7]+v*F[8]+d,_=x*F[0]+C*F[1]+S*F[2]+r,R=x*F[3]+C*F[4]+S*F[5]+c,L=x*F[6]+C*F[7]+S*F[8]+d;var F,D=e.data.enterTarget;D&&(D.x=T,D.y=B,D.z=O),(D=o.data.enterTarget)&&(D.x=P,D.y=M,D.z=I),(D=i.data.enterTarget)&&(D.x=N,D.y=z,D.z=w),(D=n.data.enterTarget)&&(D.x=_,D.y=R,D.z=L),this.updateOutDirs()}},TubeCross.prototype.createGraphNodes=function(){this.isMenuItem||this.centerGraphNode||(this.centerGraphNode=new GraphNode(0,0,0),this.topGraphNode=new GraphNode(0,1,0),this.botGraphNode=new GraphNode(0,-1,0),this.rightGraphNode=new GraphNode(1,0,0),this.leftGraphNode=new GraphNode(-1,0,0),((((((((((this.centerGraphNode.data.tube=this).centerGraphNode.data.obj=this).topGraphNode.data.tube=this).botGraphNode.data.tube=this).rightGraphNode.data.tube=this).leftGraphNode.data.tube=this).topGraphNode.data.obj=this).botGraphNode.data.obj=this).rightGraphNode.data.obj=this).leftGraphNode.data.obj=this).nodes.push(this.botGraphNode),this.nodes.push(this.centerGraphNode),this.nodes.push(this.topGraphNode),this.nodes.push(this.rightGraphNode),this.nodes.push(this.leftGraphNode),E.app.graph.addNode(this.botGraphNode),E.app.graph.addNode(this.centerGraphNode),E.app.graph.addNode(this.topGraphNode),E.app.graph.addNode(this.rightGraphNode),E.app.graph.addNode(this.leftGraphNode))},TubeCross.prototype.createConnectors=function(){if(!this.topConnector){this.createGraphNodes();var t=!1;this.isMenuItem&&(t=!0),this.topConnector=ObjectPool.get(E.ConnectorTube.name,{pathNodeTop:this.topGraphNode,renderingGroupID:this.renderingGroupID},!1,t),this.botConnector=ObjectPool.get(E.ConnectorTube.name,{pathNodeTop:this.botGraphNode,renderingGroupID:this.renderingGroupID},!1,t),this.rightConnector=ObjectPool.get(E.ConnectorTube.name,{pathNodeTop:this.rightGraphNode,renderingGroupID:this.renderingGroupID},!1,t),this.leftConnector=ObjectPool.get(E.ConnectorTube.name,{pathNodeTop:this.leftGraphNode,renderingGroupID:this.renderingGroupID},!1,t),this.isOnScene&&(this.topConnector.addToScene(),this.botConnector.addToScene(),this.rightConnector.addToScene(),this.leftConnector.addToScene())}},TubeCross.prototype.setConnectors=function(){this.topConnector||this.createConnectors();var t=this.gridSize,e=this.position.x,o=this.position.y,i=this.position.z,n=1.5*t,s=1.5*-t,a=1.5*t,r=1.5*-t,c=E.Tube.tempBabMats[0];this.rotationQuaternion.toRotationMatrix(c);var d=c.m,p=0*d[0]+n*d[4]+0*d[8]+e,l=0*d[1]+n*d[5]+0*d[9]+o,u=0*d[2]+n*d[6]+0*d[10]+i,y=s*d[0]+0*d[4]+0*d[8]+e,g=s*d[1]+0*d[5]+0*d[9]+o,m=s*d[2]+0*d[6]+0*d[10]+i,f=a*d[0]+0*d[4]+0*d[8]+e,A=a*d[1]+0*d[5]+0*d[9]+o,b=a*d[2]+0*d[6]+0*d[10]+i,v=0*d[0]+r*d[4]+0*d[8]+e,x=0*d[1]+r*d[5]+0*d[9]+o,C=0*d[2]+r*d[6]+0*d[10]+i;this.topConnector.setPosition(p,l,u),this.botConnector.setPosition(v,x,C),this.rightConnector.setPosition(f,A,b),this.leftConnector.setPosition(y,g,m);var S=E.Tube.tempBabQuats[0];E.Tube.tempBabQuats[1];S.copyFrom(this.rotationQuaternion);var T=E.Tube.tempQuats[0];T.x=S.x,T.y=S.y,T.z=S.z,T.s=S.w;var B=E.Tube.tempVecs[0];S.toEulerAnglesToRef(B),this.topConnector.setRotation(B.x,B.y,B.z);var O=E.Tube.tempQuats[1],P=E.Tube.tempVecs[1];P.x=0,P.y=0,P.z=1,O.setFromAxisAngle(P,-Math.PI),O.mul(T,O),S.x=O.x,S.y=O.y,S.z=O.z,S.w=O.s,S.toEulerAnglesToRef(B),this.botConnector.setRotation(B.x,B.y,B.z),P.x=0,P.y=0,P.z=1,O.setFromAxisAngle(P,.5*-Math.PI),O.mul(T,O),S.x=O.x,S.y=O.y,S.z=O.z,S.w=O.s,S.toEulerAnglesToRef(B),this.rightConnector.setRotation(B.x,B.y,B.z),O.setFromAxisAngle(P,.5*Math.PI),O.mul(T,O),S.x=O.x,S.y=O.y,S.z=O.z,S.w=O.s,S.toEulerAnglesToRef(B),this.leftConnector.setRotation(B.x,B.y,B.z)},TubeCross.prototype.getDirection=function(t,e,o,i){var n=this.body,s=n.position,a=n.rotation.elements,r=e.x-s.x,c=e.y-s.y,d=e.z-s.z,p=r*a[0]+c*a[3]+d*a[6],l=r*a[1]+c*a[4]+d*a[7],u=(a[2],a[5],a[8],o.x-s.x),y=o.y-s.y,g=o.z-s.z,m=u*a[0]+y*a[3]+g*a[6],f=u*a[1]+y*a[4]+g*a[7],A=(a[2],a[5],a[8],o.x-e.x),b=o.y-e.y,v=o.z-e.z,x=A*a[0]+b*a[3]+v*a[6],C=A*a[1]+b*a[4]+v*a[7],S=(a[2],a[5],a[8],A=0,b=1,v=0,!1),T=!1,B=!1,O=this.radius,P=this.radius-.5*i;l<P&&-P<l&&p<P&&-P<p&&(S=!0);var M;M=O,m<O&&-O<m&&(T=!0),p<P&&-P<p&&(B=!0),T&&B||B&&!S?C<0&&(b=-1):(!B||S&&!T)&&(A=1,x<(v=b=0)&&(A=-1)),t.x=A*a[0]+b*a[1]+v*a[2],t.y=A*a[3]+b*a[4]+v*a[5],t.z=A*a[6]+b*a[7]+v*a[8]},TubeCross.prototype.refreshOpenings=function(){this.topConnector.refresh(),this.rightConnector.refresh(),this.botConnector.refresh(),this.leftConnector.refresh()},TubeCross.prototype.keepPosInside=function(t,e){var o=this.position,i=t.x-o.x,n=t.y-o.y,s=t.z-o.z,a=this.body.rotation.elements,r=i*a[0]+n*a[3]+s*a[6],c=i*a[1]+n*a[4]+s*a[7],d=i*a[2]+n*a[5]+s*a[8],p=this.radius-.05,l=p*p,u=0,y=0,g=0,m=0,f=0,A=0,b=E.Tube.z4[0],v=!1,x=!1,C=!1,S=!1;if(e){var T=e.x-o.x,B=e.y-o.y,O=e.z-o.z,P=T*a[0]+B*a[3]+O*a[6],M=T*a[1]+B*a[4]+O*a[7];P>this.radius&&(x=!0),M>this.radius&&(v=!0),M<-this.radius&&(v=!0)}if(!x){if(!(l<r*r+d*d))return;b.x=r,b.y=0,b.z=d,b.normalize(),m=b.x*p,f=c,A=b.z*p,C=!0}if(!v){if(!(l<c*c+d*d))return;b.x=0,b.y=c,b.z=d,b.normalize(),u=r,y=b.y*p,g=b.z*p,S=!0}if(C||S){var I,N,z,w=u-r,_=y-c,R=g-d,L=m-r,F=f-c,D=A-d;L*L+F*F+D*D<w*w+_*_+R*R?(I=m,N=f,z=A):(I=u,N=y,z=g),i=I*a[0]+N*a[1]+z*a[2],n=I*a[3]+N*a[4]+z*a[5],s=I*a[6]+N*a[7]+z*a[8],t.x=o.x+i,t.y=o.y+n,t.z=o.z+s}},TubeCross.prototype.isInTube=function(t,e,o,i){if(void 0===i&&(i=0),!this.isInBox(t,e,o,i))return!1;var n=this.body,s=n.position,a=n.rotation.elements,r=t-s.x,c=e-s.y,d=o-s.z,p=r*a[0]+c*a[3]+d*a[6],l=r*a[1]+c*a[4]+d*a[7],u=r*a[2]+c*a[5]+d*a[8];return p*p+u*u<this.radius*this.radius||l*l+u*u<this.radius*this.radius},TubeCross.count=0,TubeCross}(E.Tube);E.TubeCross=t}(z0||(z0={})),function(o){var t=function(){function TubeCrossConfig(){this.objName="t2",o.TubeCross.objectCount=TubeCrossConfig.maxObjects}return TubeCrossConfig.prototype.initObjectPool=function(t){var e={shapeName:this.objName,world:t,x:0,y:0,z:0,rx:0,ry:0,rz:0,boxSize:1,skipAddToScene:!0};ObjectPool.addClass(this.objName,o.TubeCross,e)},TubeCrossConfig.prototype.getSceneFileNames=function(t){},TubeCrossConfig.prototype.getCreateMeshFunctions=function(t){t.TubeCross=this._createMeshes},TubeCrossConfig.prototype._createMeshes=function(t,e){o.Tube.mergeMeshes("TubeCross",e)},TubeCrossConfig.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"TubeCross",numInstances:TubeCrossConfig.maxObjects,maxInstances:TubeCrossConfig.maxObjects,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0}),t.push({shapeName:this.objName,meshName:"TubeCrossButton",numInstances:TubeCrossConfig.maxObjects,maxInstances:TubeCrossConfig.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName,meshName:"menuButtonSmall",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"TubeCross",numInstances:1,maxInstances:1,applyMaterialToSPS:"tubeMat",computeTextures:!0,renderingGroupID:o.App.menuRenderingGroupID})},TubeCrossConfig.prototype.getTextureDrawFunctions=function(t){t.tubeCrossTexture=function(t,e,o){t.beginPath(),t.rect(0,0,e,o),t.fillStyle="rgba(255, 255, 255, .5)",t.fill();var i=e/6;t.lineWidth=8,t.strokeStyle="rgba(255, 255, 255, .5)";for(var n=0;n<5;n++)t.beginPath(),t.moveTo(i*(n+1),0),t.lineTo(i*(n+1),o),t.stroke()}},TubeCrossConfig.prototype.getz1064Items=function(t){t.push(new o.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Tubes",order:4,offsetX:.25}))},TubeCrossConfig.maxObjects=10,TubeCrossConfig}();o.TubeCrossConfig=t,o.App.AddEntityConfig(new t)}(z0||(z0={})),function(D){var t=function(d){function TubeCurved(){var t=d.call(this)||this;return t.curveRadius=0,t.topConnector=null,t.leftConnector=null,t.initColor1.r=0,t.initColor1.g=1,t.initColor1.b=0,t.color.copyFrom(t.initColor1),t.bindedKeepPosInside=t.keepPosInside.bind(t),t}return __extends(TubeCurved,d),TubeCurved.prototype.init=function(t){d.prototype.init.call(this,t),this.textureName="tubeCurvedTexture";var e="t"+this.num;this.boxSize=1,t.boxSize&&(this.boxSize=t.boxSize),this.gridSize=this.boxSize/3,this.curveRadius=.5*this.boxSize,this.radius=.25*this.boxSize,this.innerRadius=.9*this.radius,this.innerRadius=.85*this.radius,this.innerRadius=.8*this.radius;var o=0,i=0;null!=t.x&&(o=t.x),null!=t.y&&(i=t.y);var n=0,s=0,a=0;if(null!=t.rx&&(n=t.rx),null!=t.ry&&(s=t.ry),null!=t.rz&&(a=t.rz),!this.isMenuItem&&!this.body){this.world=t.world,this.createGraphNodes();var r=[1,.4,.2,D.App.z1033,4294967295];this.body=new OIMO.Body({size:[this.radius,this.curveRadius,this.innerRadius],pos:[0,0,0],rot:[180/Math.PI*0,180/Math.PI*0,180/Math.PI*0],world:this.world,type:"curvedTube",move:!1,name:e+"tube",config:r}).body;var c=(this.body.shapes.entity=this).curveRadius;this.leftGraphNode.addConnection(this.centerGraphNode,c),this.centerGraphNode.addConnection(this.leftGraphNode,c),this.centerGraphNode.addConnection(this.topGraphNode,c),this.topGraphNode.addConnection(this.centerGraphNode,c)}t.isMenuItem?(this.setPosition(o,i+.5*this.boxSize,0),this.setConnectors()):(this.setPosition(o,i,0),this.setRotation(n,s,a),t.skipAddToScene||(this.addToScene(),this.cage?this.cage.isReady?this.checkConnections():this.cage.pubsub.subscribe("ready",this.checkConnections,this):this.checkConnections()))},TubeCurved.prototype.refreshOpenings=function(){this.topConnector&&this.topConnector.refresh(),this.leftConnector&&this.leftConnector.refresh()},TubeCurved.prototype.updateNodes=function(){if(this.body){var t=this.gridSize,e=this.centerGraphNode,o=this.topGraphNode,i=this.leftGraphNode,n=this.position.x,s=this.position.y,a=this.position.z;e.x=n,e.y=s,e.z=a;var r=0;o.data.enterEvent&&(r=.5*t);var c=0,d=r+this.curveRadius,p=0;r=0,i.data.enterEvent&&(r=.5*t);var l=-(r+this.curveRadius),u=0,y=0,g=c*(C=this.body.rotation.elements)[0]+d*C[1]+p*C[2]+n,m=c*C[3]+d*C[4]+p*C[5]+s,f=c*C[6]+d*C[7]+p*C[8]+a,A=l*C[0]+u*C[1]+y*C[2]+n,b=l*C[3]+u*C[4]+y*C[5]+s,v=l*C[6]+u*C[7]+y*C[8]+a;o.x=g,o.y=m,o.z=f,i.x=A,i.y=b,i.z=v;var x=this.position.y+.5*this.boxSize;o.y>x&&(o.y=x),i.y>x&&(i.y=x);c=0,d=this.curveRadius+.5*t,p=0,l=-this.curveRadius-.5*t,u=0,y=0,g=c*(C=this.body.rotation.elements)[0]+d*C[1]+p*C[2]+n,m=c*C[3]+d*C[4]+p*C[5]+s,f=c*C[6]+d*C[7]+p*C[8]+a,A=l*C[0]+u*C[1]+y*C[2]+n,b=l*C[3]+u*C[4]+y*C[5]+s,v=l*C[6]+u*C[7]+y*C[8]+a;var C,S=o.data.enterTarget;S&&(S.x=g,S.y=m,S.z=f),(S=i.data.enterTarget)&&(S.x=A,S.y=b,S.z=v);var T=.3*-this.curveRadius,B=.3*this.curveRadius,O=T*C[0]+B*C[1]+0*C[2]+n,P=T*C[3]+B*C[4]+0*C[5]+s,M=T*C[6]+B*C[7]+0*C[8]+a;e.x=O,e.y=P,e.z=M,this.updateOutDirs()}},TubeCurved.prototype.createGraphNodes=function(){this.isMenuItem||this.centerGraphNode||(this.centerGraphNode=new GraphNode(0,0,0),this.leftGraphNode=new GraphNode(-1,0,0),this.topGraphNode=new GraphNode(0,1,0),((((((this.centerGraphNode.data.tube=this).centerGraphNode.data.obj=this).leftGraphNode.data.tube=this).topGraphNode.data.tube=this).leftGraphNode.data.obj=this).topGraphNode.data.obj=this).nodes.push(this.leftGraphNode),this.nodes.push(this.centerGraphNode),this.nodes.push(this.topGraphNode),D.app.graph.addNode(this.centerGraphNode),D.app.graph.addNode(this.topGraphNode),D.app.graph.addNode(this.leftGraphNode))},TubeCurved.prototype.createConnectors=function(){if(!this.topConnector){this.createGraphNodes();var t=!1;this.isMenuItem&&(t=!0),this.topConnector=ObjectPool.get(D.ConnectorTube.name,{pathNodeTop:this.topGraphNode,renderingGroupID:this.renderingGroupID},!1,t),this.leftConnector=ObjectPool.get(D.ConnectorTube.name,{pathNodeTop:this.leftGraphNode,renderingGroupID:this.renderingGroupID},!1,t),this.isOnScene&&(this.topConnector.addToScene(),this.leftConnector.addToScene())}},TubeCurved.prototype.setConnectors=function(){this.topConnector||this.createConnectors();var t=this.gridSize,e=this.position.x,o=this.position.y,i=this.position.z,n=1.5*t,s=1.5*-t,a=D.Tube.tempBabMats[0];this.rotationQuaternion.toRotationMatrix(a);var r=a.m,c=0*r[0]+n*r[4]+0*r[8]+e,d=0*r[1]+n*r[5]+0*r[9]+o,p=0*r[2]+n*r[6]+0*r[10]+i,l=s*r[0]+0*r[4]+0*r[8]+e,u=s*r[1]+0*r[5]+0*r[9]+o,y=s*r[2]+0*r[6]+0*r[10]+i;this.topConnector.setPosition(c,d,p),this.leftConnector.setPosition(l,u,y);var g=D.Tube.tempBabQuats[0],m=D.Tube.tempBabQuats[1],f=D.Tube.tempQuats[0];g.copyFrom(this.rotationQuaternion),f.x=g.x,f.y=g.y,f.z=g.z,f.s=g.w;var A=D.Tube.tempVecs[0];g.toEulerAnglesToRef(A),this.topConnector.setRotation(A.x,A.y,A.z);var b=D.Tube.tempQuats[1],v=D.Tube.tempVecs[1];v.x=1,v.y=0,v.z=0,b.setFromAxisAngle(v,.5*Math.PI),BABYLON.Quaternion.RotationAxisToRef(BABYLON.Axis.Z,.5*Math.PI,g),m.x=f.x,m.y=f.y,m.z=f.z,m.w=f.s,m.multiplyToRef(g,g),this.leftConnector.setRotation(A.x,A.y,A.z+.5*Math.PI)},TubeCurved.prototype.getDirection=function(t,e,o){var i=this.body,n=i.position,s=i.rotation.elements,a=e.x-n.x,r=e.y-n.y,c=e.z-n.z,d=a*s[0]+r*s[3]+c*s[6],p=a*s[1]+r*s[4]+c*s[7],l=o.x-e.x,u=o.y-e.y,y=o.z-e.z,g=l*s[0]+u*s[3]+y*s[6],m=l*s[1]+u*s[4]+y*s[7],f=this.curveRadius,A=(y=0,(l=d- -f)*l+(u=p-f)*u),b=1/Math.sqrt(A),v=l*=b;l=-(u*=b),u=v;var x=D.Tube.tempVecs[2],C=D.Tube.tempVecs[3];x.x=l,x.y=u,x.z=0,C.x=g,C.y=m,C.z=0,C.normalize(C),x.dot(C)<0&&(l*=-1,u*=-1),t.x=l*s[0]+u*s[1]+y*s[2],t.y=l*s[3]+u*s[4]+y*s[5],t.z=l*s[6]+u*s[7]+y*s[8]},TubeCurved.prototype.getCenterAtPoint=function(t,e){var o=this.body,i=o.position,n=o.rotation.elements,s=e.x-i.x,a=e.y-i.y,r=e.z-i.z,c=s*n[0]+a*n[3]+r*n[6],d=s*n[1]+a*n[4]+r*n[7],p=s*n[2]+a*n[5]+r*n[8],l=this.curveRadius,u=c- -l,y=d-l,g=u*u+y*y,m=1/Math.sqrt(g),f=m*u*l-l,A=l+m*y*l,b=p;t.x=f*n[0]+A*n[1]+b*n[2],t.y=f*n[3]+A*n[4]+b*n[5],t.z=f*n[6]+A*n[7]+b*n[8],t.x+=i.x,t.y+=i.y,t.z+=i.z},TubeCurved.prototype.createAvoidObject=function(){var t=this.position.x,e=this.position.y,o=this.position.z,i=.5*-this.boxSize+.375-.1,n=.5*-this.boxSize+.5,s=this.body.rotation.elements;s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8]},TubeCurved.prototype.isInTube=function(t,e,o,i){if(void 0===i&&(i=0),!this.isInBox(t,e,o,i))return!1;var n=this.body,s=n.position,a=n.rotation.elements,r=t-s.x,c=e-s.y,d=o-s.z,p=r*a[0]+c*a[3]+d*a[6],l=r*a[1]+c*a[4]+d*a[7],u=r*a[2]+c*a[5]+d*a[8],y=this.curveRadius,g=.5*this.boxSize,m=p- -g,f=l-g,A=m*m+f*f,b=1/Math.sqrt(A),v=p-((m*=b)*y-g),x=l-(g+(f*=b)*y),C=u-0;return v*v+x*x+C*C<this.radius*this.radius},TubeCurved.prototype.keepPosInside=function(t){var e=this.position,o=t.x-e.x,i=t.y-e.y,n=t.z-e.z,s=.5*this.boxSize;var a=this.body.rotation.elements,r=o*a[0]+i*a[3]+n*a[6],c=o*a[1]+i*a[4]+n*a[7],d=o*a[2]+i*a[5]+n*a[8],p=(this.radius,this.innerRadius),l=this.curveRadius,u=(n=d,(o=r- -l)*o+(i=c-l)*i),y=1/Math.sqrt(u),g=o*y,m=i*y,f=D.Tube.tempVecs[0],A=D.Tube.tempVecs[1],b=D.Tube.tempVecs[2];A.x=0,A.y=0,A.z=1,b.x=-g,b.y=-m,b.z=0,f.cross(A,b);var v=l*g-l,x=l+l*m,C=r-v,S=c-x,T=d-0,B=C*f.x+S*f.y+T*f.z,O=C*A.x+S*A.y+T*A.z,P=C*b.x+S*b.y+T*b.z,M=O*O+P*P;if(!(M<p*p)){var I,N,z,w,_,R,L=Math.sqrt(M),F=1/L;w=B,_=-(c=-O*F)*p,R=-(d=-P*F)*p,0<=p-L||(I=w*f.x+_*A.x+R*b.x,N=w*f.y+_*A.y+R*b.y,z=w*f.z+_*A.z+R*b.z,_=N+=x,R=z+=0,I=(w=I+=v)*a[0]+_*a[1]+R*a[2],N=w*a[3]+_*a[4]+R*a[5],z=w*a[6]+_*a[7]+R*a[8],I+=e.x,N+=e.y,z+=e.z,t.x=I,t.y=N,t.z=z)}},TubeCurved.prototype.addToObject=function(t){d.prototype.addToObject.call(this,t),this.navigator&&(this.navigator.pivotRadius=.6)},TubeCurved.prototype.isValidDropLocation=function(t,e,o){var i=this._tempDropLoc;this.getPositionOnMapFromDropToRef(t,e,o,i);var n=D.app.builder.background,s=n.mesh.position.x+.5*n.width,a=n.mesh.position.x-.5*n.width,r=n.mesh.position.y+.5*n.height,c=n.mesh.position.y-.5*n.height;if(t+.5*this.boxSize>s)return!1;if(t-.5*this.boxSize<a)return!1;if(e+.5*this.boxSize>r)return!1;if(e+.5*this.boxSize<c)return!1;var d=D.Cage.getCageAt(i.x,i.y,i.z);if(d){if(d.getObjectAt(i.x,i.y,i.z,D.z1044.z1046))return!1;var p=d.getObjectAt(i.x,i.y,i.z,D.z1044.z1050,1);if(p){var l=.5*this.boxSize,u=p.width+.5,y=p.height,g=p.position,m=g.x+.5*u+l,f=g.x-.5*u-l,A=g.y+y+l,b=g.y-l,v=i.x,x=i.y;if(f<v&&v<m&&b<x&&x<A)return!1}var C=d.getObjectAt(i.x,i.y,i.z,D.z1044.SWING,1);if(C){l=.5*this.boxSize-.01;var S=.5*C.width+.2,T=C.height,B=C.position,O=B.x+S+l,P=B.x-S-l,M=B.y+T+l,I=B.y-l;v=i.x,x=i.y;if(P<v&&v<O&&I<x&&x<M)return!1}}var N=D.Tube.getObjectAt(i.x,i.y,i.z);if(N&&2==N.boxSize){N.boxSize;var z=D.Tube.tempVecs[0],w=D.Tube.tempVecs[1];return z.x=t,z.y=e,z.z=o,z1.getOIMOLocalPositionFromGlobalToRef(N.body,z,w),w.x<0&&0<w.y||0<w.x&&w.y<0}return!N||N==this},TubeCurved.prototype.findBestRotation=function(){this.canRotate=!0;var t=this.position,e=D.Tube.getObjectAt(t.x,t.y,t.z);if(e&&2==e.boxSize){var o=D.Tube.tempVecs[0],i=D.Tube.tempVecs[1];o.x=t.x,o.y=t.y,o.z=t.z,z1.getOIMOLocalPositionFromGlobalToRef(e.body,o,i),i.x<0&&0<i.y&&this.setRotation(e.rotation.x,e.rotation.y,e.rotation.z),0<i.x&&i.y<0&&this.setRotation(e.rotation.x,e.rotation.y,(e.rotation.z+Math.PI)%(2*Math.PI)),this.canRotate=!1}else d.prototype.findBestRotation.call(this)},TubeCurved}(D.Tube);D.TubeCurved=t}(z0||(z0={})),function(i){var t=function(){function TubeCurvedConfig(){this.objName="t3",i.TubeCurved.objectCount=TubeCurvedConfig.maxObjects}return TubeCurvedConfig.prototype.initObjectPool=function(t){var e={shapeName:this.objName,world:t,x:0,y:0,z:0,rx:0,ry:0,rz:0,boxSize:1,skipAddToScene:!0};ObjectPool.addClass(this.objName,i.TubeCurved,e)},TubeCurvedConfig.prototype.getSceneFileNames=function(t){},TubeCurvedConfig.prototype.getCreateMeshFunctions=function(t){t.TubeCurved=this._createMeshes},TubeCurvedConfig.prototype._createMeshes=function(t,e){i.Tube.mergeMeshes("TubeCurved",e);var o=BABYLON.MeshBuilder.CreatePlane("",{size:1},t);o.position.y+=.1,o.bakeCurrentTransformIntoVertices(),t.removeMesh(o),e.tubeCurvedMenuButton=o},TubeCurvedConfig.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"TubeCurved",numInstances:TubeCurvedConfig.maxObjects,maxInstances:TubeCurvedConfig.maxObjects,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0}),t.push({shapeName:this.objName,meshName:"TubeCurvedButton",numInstances:TubeCurvedConfig.maxObjects,maxInstances:TubeCurvedConfig.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName,meshName:"TubeCurved",numInstances:1,maxInstances:1,applyMaterialToSPS:"tubeMat",computeTextures:!0,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"tubeCurvedMenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:i.App.menuRenderingGroupID})},TubeCurvedConfig.prototype.getTextureDrawFunctions=function(t){t.tubeCurvedTexture=function(t,e,o){t.beginPath(),t.rect(0,0,e,o),t.fillStyle="rgba(255, 255, 255, .5)",t.fill();var i=e/6;t.lineWidth=8,t.strokeStyle="rgba(255, 255, 255, .5)";for(var n=0;n<5;n++)t.beginPath(),t.moveTo(i*(n+1),0),t.lineTo(i*(n+1),o),t.stroke()}},TubeCurvedConfig.prototype.getz1064Items=function(t){t.push(new i.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Tubes",offsetY:0,order:5,offsetX:.25}))},TubeCurvedConfig.maxObjects=30,TubeCurvedConfig}();i.TubeCurvedConfig=t,i.App.AddEntityConfig(new t)}(z0||(z0={})),function(V){var t=function(m){function TubeCurved2(){var t=m.call(this)||this;return t.curveRadius=0,t.topConnector=null,t.leftConnector=null,t.mapPlacementInfo=new V.MapPlacementInfo({mapOffsetX:.5,mapOffsetY:-.5,mapOffsetDropTargetX:-.5,mapOffsetDropTargetY:.5}),t.initColor1.r=0,t.initColor1.g=1,t.initColor1.b=0,t.initColor1.a=.5,t.color.copyFrom(t.initColor1),t.bindedKeepPosInside=t.keepPosInside.bind(t),t}return __extends(TubeCurved2,m),TubeCurved2.prototype.init=function(t){m.prototype.init.call(this,t);var e="t"+this.num;this.textureName="tubeCurved2Texture",this.boxSize=2,t.boxSize&&(this.boxSize=t.boxSize),this.gridSize=this.boxSize/3*.5,this.curveRadius=.75*this.boxSize,this.radius=.25*this.boxSize*.5,this.innerRadius=.8*this.radius;var o=0,i=0;null!=t.x&&(o=t.x),null!=t.y&&(i=t.y);var n=0,s=0,a=0;if(null!=t.rx&&(n=t.rx),null!=t.ry&&(s=t.ry),null!=t.rz&&(a=t.rz),!this.isMenuItem&&!this.body){this.world=t.world,this.createGraphNodes();var r=[1,.4,.2,V.App.z1033,4294967295];this.body=new OIMO.Body({size:[this.radius,this.curveRadius,this.innerRadius],pos:[0,0,0],rot:[180/Math.PI*0,180/Math.PI*0,180/Math.PI*0],world:this.world,type:"curvedTube",move:!1,name:e+"tube",config:r}).body;var c=.5*(this.body.shapes.entity=this).curveRadius;this.leftGraphNode.addConnection(this.leftCenterGraphNode,c),this.leftCenterGraphNode.addConnection(this.leftGraphNode,c),this.leftCenterGraphNode.addConnection(this.centerGraphNode,c),this.centerGraphNode.addConnection(this.leftCenterGraphNode,c),this.centerGraphNode.addConnection(this.topCenterGraphNode,c),this.topCenterGraphNode.addConnection(this.centerGraphNode,c),this.topCenterGraphNode.addConnection(this.topGraphNode,c),this.topGraphNode.addConnection(this.topCenterGraphNode,c)}t.isMenuItem?(this.setPosition(o,i+.5*this.boxSize,0),this.setConnectors()):(this.setPosition(o,i,0),this.setRotation(n,s,a),t.skipAddToScene||(this.addToScene(),this.cage?this.cage.isReady?this.checkConnections():this.cage.pubsub.subscribe("ready",this.checkConnections,this):this.checkConnections()))},TubeCurved2.prototype.checkBeddingHeight=function(t){void 0===t&&(t=null);for(var e,o=(t=t||this.cage).bedding,i=V.Tube.tempVecs[4],n=0;n<this.nodes.length;n++){var s=this.nodes[n],a=o.mesh.getHeightAtCoordinates(s.x,s.z);i.x=s.x-this.position.x,i.y=s.y-this.position.y,i.z=s.z-this.position.z,i.normalize(i),i.scale(i,.5),s.y+i.y-1.2*this.radius<a&&(e=!0)}e&&t.updateNodes()},TubeCurved2.prototype.refreshOpenings=function(){this.topConnector&&this.topConnector.refresh(),this.leftConnector&&this.leftConnector.refresh()},TubeCurved2.prototype.updateNodes=function(){if(this.body){var t=this.gridSize,e=this.centerGraphNode,o=this.topGraphNode,i=this.leftGraphNode,n=this.position.x,s=this.position.y,a=this.position.z;e.x=n,e.y=s,e.z=a;var r=0;o.data.enterEvent&&(r=.5*t);var c=0,d=r+this.curveRadius,p=0;r=0,i.data.enterEvent&&(r=.5*t);var l=-(r+this.curveRadius),u=0,y=0;d+=-.5,l+=.5,u+=-.5;var g=(c+=.5)*(M=this.body.rotation.elements)[0]+d*M[1]+p*M[2]+n,m=c*M[3]+d*M[4]+p*M[5]+s,f=c*M[6]+d*M[7]+p*M[8]+a,A=l*M[0]+u*M[1]+y*M[2]+n,b=l*M[3]+u*M[4]+y*M[5]+s,v=l*M[6]+u*M[7]+y*M[8]+a,x=this.position.y+.5*this.boxSize;x<m&&(m=x),x<b&&(b=x),o.x=g,o.y=m,o.z=f,i.x=A,i.y=b,i.z=v;c=0,d=this.curveRadius+.5*t,p=0,l=-this.curveRadius-.5*t,u=0,y=0;d+=-.5,l+=.5,u+=-.5;g=(c+=.5)*(M=this.body.rotation.elements)[0]+d*M[1]+p*M[2]+n,m=c*M[3]+d*M[4]+p*M[5]+s,f=c*M[6]+d*M[7]+p*M[8]+a,A=l*M[0]+u*M[1]+y*M[2]+n,b=l*M[3]+u*M[4]+y*M[5]+s,v=l*M[6]+u*M[7]+y*M[8]+a;var C=o.data.enterTarget;C&&(C.x=g,C.y=m,C.z=f),(C=i.data.enterTarget)&&(C.x=A,C.y=b,C.z=v);var S=.3*-this.curveRadius,T=this.curveRadius,B=(T=.15*-t,(S=.15*t)*M[0]+T*M[1]+0*M[2]+n),O=S*M[3]+T*M[4]+0*M[5]+s,P=S*M[6]+T*M[7]+0*M[8]+a;e.x=B,e.y=O,e.z=P;c=.4*-t,d=.6*this.curveRadius,p=0,l=.6*-this.curveRadius,u=.4*t,y=0;d+=-.5,l+=.5,u+=-.5;var M;g=(c+=.5)*(M=this.body.rotation.elements)[0]+d*M[1]+p*M[2]+n,m=c*M[3]+d*M[4]+p*M[5]+s,f=c*M[6]+d*M[7]+p*M[8]+a,A=l*M[0]+u*M[1]+y*M[2]+n,b=l*M[3]+u*M[4]+y*M[5]+s,v=l*M[6]+u*M[7]+y*M[8]+a;this.topCenterGraphNode.x=g,this.topCenterGraphNode.y=m,this.topCenterGraphNode.z=f,this.leftCenterGraphNode.x=A,this.leftCenterGraphNode.y=b,this.leftCenterGraphNode.z=v,this.updateOutDirs()}},TubeCurved2.prototype.createGraphNodes=function(){this.isMenuItem||this.centerGraphNode||(this.centerGraphNode=new GraphNode(0,0,0),this.leftGraphNode=new GraphNode(-1,0,0),this.topGraphNode=new GraphNode(0,1,0),this.leftCenterGraphNode=new GraphNode(-.5,.5,0),this.topCenterGraphNode=new GraphNode(.5,.5,0),((((((((((this.centerGraphNode.data.tube=this).centerGraphNode.data.obj=this).leftGraphNode.data.tube=this).topGraphNode.data.tube=this).leftGraphNode.data.obj=this).topGraphNode.data.obj=this).leftCenterGraphNode.data.tube=this).topCenterGraphNode.data.tube=this).leftCenterGraphNode.data.obj=this).topCenterGraphNode.data.obj=this).nodes.push(this.leftGraphNode),this.nodes.push(this.centerGraphNode),this.nodes.push(this.topGraphNode),this.nodes.push(this.leftCenterGraphNode),this.nodes.push(this.topCenterGraphNode),V.app.graph.addNode(this.centerGraphNode),V.app.graph.addNode(this.topGraphNode),V.app.graph.addNode(this.leftGraphNode),V.app.graph.addNode(this.leftCenterGraphNode),V.app.graph.addNode(this.topCenterGraphNode))},TubeCurved2.prototype.createConnectors=function(){if(!this.topConnector){this.createGraphNodes();var t=!1;this.isMenuItem&&(t=!0),this.topConnector=ObjectPool.get(V.ConnectorTube.name,{pathNodeTop:this.topGraphNode,renderingGroupID:this.renderingGroupID},!1,t),this.leftConnector=ObjectPool.get(V.ConnectorTube.name,{pathNodeTop:this.leftGraphNode,renderingGroupID:this.renderingGroupID},!1,t),this.isOnScene&&(this.topConnector.addToScene(),this.leftConnector.addToScene())}},TubeCurved2.prototype.setConnectors=function(){this.topConnector||this.createConnectors();var t=this.gridSize,e=this.position.x,o=this.position.y,i=this.position.z,n=1.5*t,s=3*t,a=3*-t,r=1.5*-t,c=V.Tube.tempBabMats[0];this.rotationQuaternion.toRotationMatrix(c);var d=c.m,p=n*d[0]+s*d[4]+0*d[8]+e,l=n*d[1]+s*d[5]+0*d[9]+o,u=n*d[2]+s*d[6]+0*d[10]+i,y=a*d[0]+r*d[4]+0*d[8]+e,g=a*d[1]+r*d[5]+0*d[9]+o,m=a*d[2]+r*d[6]+0*d[10]+i;this.topConnector.setPosition(p,l,u),this.leftConnector.setPosition(y,g,m);var f=V.Tube.tempBabQuats[0],A=V.Tube.tempBabQuats[1],b=V.Tube.tempQuats[0];f.copyFrom(this.rotationQuaternion),b.x=f.x,b.y=f.y,b.z=f.z,b.s=f.w;var v=V.Tube.tempVecs[0];f.toEulerAnglesToRef(v),this.topConnector.setRotation(v.x,v.y,v.z);var x=V.Tube.tempQuats[1],C=V.Tube.tempVecs[1];C.x=1,C.y=0,C.z=0,x.setFromAxisAngle(C,.5*Math.PI),BABYLON.Quaternion.RotationAxisToRef(BABYLON.Axis.Z,.5*Math.PI,f),A.x=b.x,A.y=b.y,A.z=b.z,A.w=b.s,A.multiplyToRef(f,f),this.leftConnector.setRotation(v.x,v.y,v.z+.5*Math.PI)},TubeCurved2.prototype.getDirection=function(t,e,o){var i=TubeCurved2.z4[0];i.x=o.x,i.y=o.y,i.z=o.z,this.keepPosInside(i,!0);var n=this.body,s=n.position,a=n.rotation.elements,r=e.x-s.x,c=e.y-s.y,d=e.z-s.z,p=r*a[0]+c*a[3]+d*a[6],l=r*a[1]+c*a[4]+d*a[7],u=i.x-e.x,y=i.y-e.y,g=i.z-e.z,m=u*a[0]+y*a[3]+g*a[6],f=u*a[1]+y*a[4]+g*a[7],A=this.curveRadius,b=(g=0,(u=p- -A)*u+(y=l-A)*y),v=1/Math.sqrt(b),x=u*=v;u=-(y*=v),y=x;var C=V.Tube.tempVecs[2],S=V.Tube.tempVecs[3];C.x=u,C.y=y,C.z=0,S.x=m,S.y=f,S.z=0,S.normalize(S),C.dot(S)<0&&(u*=-1,y*=-1),t.x=u*a[0]+y*a[1]+g*a[2],t.y=u*a[3]+y*a[4]+g*a[5],t.z=u*a[6]+y*a[7]+g*a[8]},TubeCurved2.prototype.getCenterAtPoint=function(t,e){var o=this.body,i=o.position,n=o.rotation.elements,s=e.x-i.x,a=e.y-i.y,r=e.z-i.z,c=s*n[0]+a*n[3]+r*n[6],d=s*n[1]+a*n[4]+r*n[7],p=s*n[2]+a*n[5]+r*n[8],l=this.curveRadius,u=c- -l,y=d-l,g=u*u+y*y,m=1/Math.sqrt(g),f=m*u*l-l,A=l+m*y*l,b=p;t.x=f*n[0]+A*n[1]+b*n[2],t.y=f*n[3]+A*n[4]+b*n[5],t.z=f*n[6]+A*n[7]+b*n[8],t.x+=i.x,t.y+=i.y,t.z+=i.z},TubeCurved2.prototype.createAvoidObject=function(){var t=this.position.x,e=this.position.y,o=this.position.z,i=.5*-this.boxSize+.375-.1,n=.5*-this.boxSize+.5,s=this.body.rotation.elements;s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8]},TubeCurved2.prototype.makeEnterNode=function(t){t.data.obj.hasEnterNode=!0,t.data.enterEvent=V.TubeEvents.ENTER,t.data.enterTarget||(t.data.enterTarget=ObjectPool.get("OIMO.Vec3")),this.updateNodes()},TubeCurved2.prototype.keepPosInside=function(t,e){void 0===e&&(e=!1);var o=this.position,i=o.x,n=o.y,s=o.z,a=t.x-i,r=t.y-n,c=t.z-s,d=.5*this.boxSize;if(!e){if(a<-d)return;if(d<a)return;if(r<-d)return;if(d<r)return;if(c<-d)return;if(d<c)return}var p=this.body.rotation.elements,l=a*p[0]+r*p[3]+c*p[6],u=a*p[1]+r*p[4]+c*p[7],y=a*p[2]+r*p[5]+c*p[8],g=this.innerRadius,m=this.curveRadius,f=(c=y,(a=l- -d)*a+(r=u-d)*r),A=1/Math.sqrt(f),b=a*A,v=r*A,x=V.Tube.tempVecs[0],C=V.Tube.tempVecs[1],S=V.Tube.tempVecs[2];C.x=0,C.y=0,C.z=1,S.x=-b,S.y=-v,S.z=0,x.cross(C,S);var T=m*b-d,B=d+m*v,O=l-T,P=u-B,M=y-0,I=O*x.x+P*x.y+M*x.z,N=O*C.x+P*C.y+M*C.z,z=O*S.x+P*S.y+M*S.z,w=N*N+z*z;if(!(w<g*g)){var _,R,L,F,D,E,k=Math.sqrt(w),j=1/k;F=I,D=-(u=-N*j)*g,E=-(y=-z*j)*g,0<=g-k||(_=F*x.x+D*C.x+E*S.x,R=F*x.y+D*C.y+E*S.y,L=F*x.z+D*C.z+E*S.z,D=R+=B,E=L+=0,_=(F=_+=T)*p[0]+D*p[1]+E*p[2],R=F*p[3]+D*p[4]+E*p[5],L=F*p[6]+D*p[7]+E*p[8],_+=o.x,R+=o.y,L+=o.z,t.x=_,t.y=R,t.z=L)}},TubeCurved2.prototype.setRotation=function(t,e,o){this.body&&this.disconnect(),this.rotation.x=t,this.rotation.y=e,this.rotation.z=o;var i=this.rotationQuaternion;BABYLON.Quaternion.RotationYawPitchRollToRef(e,t,o,i),this.body?(this.setBodyRotationQuaternion(i),this.updateNodes(),this.setConnectors(),this.checkConnections(),this.refreshOpenings(),this.updateCovers()):this.setConnectors(),this.onChangeObservable.notifyObservers(this)},TubeCurved2.prototype.rotate=function(t,e){if(void 0===t&&(t=.5*-Math.PI),void 0===e&&(e=!1),!e){var o=this.position,i=V.Tube.tempArray;i.length=0,V.Tube.getObjectsAt(o.x,o.y,o.z,1.9,1.9,i),1<i.length&&(t=Math.PI)}m.prototype.rotate.call(this,t,e)},TubeCurved2.prototype.checkCageNodeConnection=function(t,e,o){void 0===o&&(o=.7);var i=V.Tube.tempVecs[1];if(!e.data.outDir)return null;i.x=e.data.outDir.x,i.y=e.data.outDir.y,i.z=e.data.outDir.z;var n=e.x+i.x*(1/3),s=e.y+i.y*(1/3),a=e.z+i.z*(1/3);if(!t.isInBox(n,s,a)&&!t.isInBox(e.x,e.y,e.z))return null;t.addHoleAt(n,s,a,i,this);var r=t.getGraphNodeAt(n,s,a);if(!r)return null;var c,d=n-r.x,p=s-r.y,l=a-r.z;if((c=d*d+l*l)<o*o){e.x=n,e.y=s,e.z=a;var u=Math.sqrt(c);return r.addConnection(e,u),e.addConnection(r,u),e.data.obj.makeEnterNode(e),this.updateCovers(),r}},TubeCurved2.prototype.isInTube=function(t,e,o,i){if(void 0===i&&(i=0),!this.isInBox(t,e,o,i))return!1;var n=this.body,s=n.position,a=n.rotation.elements,r=t-s.x,c=e-s.y,d=o-s.z,p=r*a[0]+c*a[3]+d*a[6],l=r*a[1]+c*a[4]+d*a[7],u=r*a[2]+c*a[5]+d*a[8],y=this.curveRadius,g=.5*this.boxSize,m=p- -g,f=l-g,A=m*m+f*f,b=1/Math.sqrt(A),v=p-((m*=b)*y-g),x=l-(g+(f*=b)*y),C=u-0;return v*v+x*x+C*C<this.radius*this.radius},TubeCurved2.prototype.areNodesWithinDist=function(t,e,o,i,n){for(var s=0;s<t.length;s++){var a=t[s],r=a.x-e,c=a.y-o,d=a.z-i;if(r*r+c*c+d*d<n*n)return!0}},TubeCurved2.prototype.isValidDropLocation=function(t,e,o){var i=this._tempDropLoc;this.getPositionOnMapFromDropToRef(t,e,o,i);var n=V.app.builder.background,s=n.mesh.position.x+.5*n.width,a=n.mesh.position.x-.5*n.width,r=n.mesh.position.y+.5*n.height,c=n.mesh.position.y-.5*n.height;if(t+.5*this.boxSize>s)return!1;if(t-.5*this.boxSize<a)return!1;if(e+.5*this.boxSize>r)return!1;if(e+.5*this.boxSize<c)return!1;var d=V.Cage.getCageAt(i.x,i.y,i.z);if(d){var p=V.Tube.tempArray;if(p.length=0,d.getChildrenAt(i.x,i.y,i.z,1.9,1.9,p,V.z1044.z1046),0<p.length)return!1;var l=d.getObjectAt(i.x,i.y,i.z,V.z1044.z1050,1);if(l){var u=.5*this.boxSize,y=l.width+.5,g=l.height,m=l.position,f=m.x+.5*y+u,A=m.x-.5*y-u,b=m.y+g+u,v=m.y-u,x=i.x,C=i.y;if(A<x&&x<f&&v<C&&C<b)return!1}var S=d.getObjectAt(i.x,i.y,i.z,V.z1044.SWING,1);if(S){u=.5*this.boxSize-.01;var T=.5*S.width+.2,B=S.height,O=S.position,P=O.x+T+u,M=O.x-T-u,I=O.y+B+u,N=O.y-u;x=i.x,C=i.y;if(M<x&&x<P&&N<C&&C<I)return!1}}var z=V.Tube.tempArray;z.length=0,V.Tube.getObjectsAt(i.x,i.y,i.z,1.9,1.9,z);var w=0;if(0<z.length)for(var _=-1,R=0;R<z.length;R++){var L=z[R];if(L!=this){if(!L.curveRadius||1.5<L.boxSize)return!1;if(2<++w)return!1;var F=z1.roundToDecimalPlace(z1.fixAngle(L.rotation.z),1),D=L.position.x-i.x,E=L.position.y-i.y;if(0<D&&0<E){if(4.7!=F)return!1}else if(0<D&&E<0){if(3.1!=F)return!1}else if(D<0&&E<0){if(1.6!=F)return!1}else if(0!=F)return!1;if(-1==_)_=F;else{var k=Math.abs(z1.getAngDiff(F,_));if(4<k||k<3)return!1}}}var j=V.Cage.getCageAt(i.x-.5,i.y+.5,i.z);return j==V.Cage.getCageAt(i.x+.5,i.y+.5,i.z)&&(j==V.Cage.getCageAt(i.x+.5,i.y-.5,i.z)&&j==V.Cage.getCageAt(i.x-.5,i.y-.5,i.z))},TubeCurved2.prototype.findBestRotation=function(){var t=this.position,e=V.Tube.tempArray;e.length=0,V.Tube.getObjectsAt(t.x,t.y,t.z,1.9,1.9,e);for(var o=-1,i=0;i<e.length;i++){var n=e[i];if(n!=this){var s=n.position.x-t.x,a=n.position.y-t.y;if(-1!=(o=0<s&&0<a?.5*Math.PI:0<s&&a<0?0:s<0&&a<0?.5*Math.PI:0))break}}if(-1==o)m.prototype.findBestRotation.call(this);else{var r=z1.getAngDiff(o,this.rotation.z),c=this.rotation.z;this.rotate(r,!0);var d=this.rotation.x,p=this.rotation.y,l=this.rotation.z,u=this.getTotalConnections();if(this.rotate(Math.PI,!0),u<this.getTotalConnections())this.setRotation(this.rotation.x,this.rotation.y,this.rotation.z);else{var y=Math.abs(z1.getAngDiff(c,l)),g=Math.abs(z1.getAngDiff(c,this.rotation.z));(y=z1.roundToDecimalPlace(y,1))<(g=z1.roundToDecimalPlace(g,1))?this.setRotation(d,p,l):this.setRotation(this.rotation.x,this.rotation.y,this.rotation.z)}}},TubeCurved2}(V.Tube);V.TubeCurved2=t}(z0||(z0={})),function(a){var t=function(){function TubeCurved2Config(){this.objName="t4",a.TubeCurved2.objectCount=TubeCurved2Config.maxObjects}return TubeCurved2Config.prototype.initObjectPool=function(t){var e={shapeName:this.objName,world:t,x:0,y:0,z:0,rx:0,ry:0,rz:0,boxSize:2,skipAddToScene:!0};ObjectPool.addClass(this.objName,a.TubeCurved2,e)},TubeCurved2Config.prototype.getSceneFileNames=function(t){},TubeCurved2Config.prototype.getCreateMeshFunctions=function(t){t.TubeCurved2=this._createMeshes},TubeCurved2Config.prototype._createMeshes=function(t,e){a.Tube.mergeMeshes("TubeCurved2",e);var o=BABYLON.MeshBuilder.CreatePlane("",{size:1},t);o.scaling.y*=1.5,o.position.x+=.5,o.position.y+=.25,o.bakeCurrentTransformIntoVertices();var i=BABYLON.MeshBuilder.CreatePlane("",{size:1},t);i.scaling.x*=1.5,i.position.x-=.25,i.position.y-=.5,i.bakeCurrentTransformIntoVertices();var n=BABYLON.MeshBuilder.CreatePlane("",{size:1},t);n.rotation.z=.25*Math.PI,n.bakeCurrentTransformIntoVertices();var s=BABYLON.Mesh.MergeMeshes([o,i,n],!0);t.removeMesh(s),e.tubeCurved2MenuButton=s},TubeCurved2Config.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"TubeCurved2",numInstances:TubeCurved2Config.maxObjects,maxInstances:TubeCurved2Config.maxObjects,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0}),t.push({shapeName:this.objName,meshName:"TubeCurved2Button",numInstances:TubeCurved2Config.maxObjects,maxInstances:TubeCurved2Config.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName,meshName:"TubeCurved2",numInstances:1,maxInstances:1,applyMaterialToSPS:"tubeMat",computeTextures:!0,renderingGroupID:a.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"tubeCurved2MenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:a.App.menuRenderingGroupID})},TubeCurved2Config.prototype.getTextureDrawFunctions=function(t){t.tubeCurved2Texture=function(t,e,o){t.beginPath(),t.rect(0,0,e,o),t.fillStyle="rgba(255, 255, 255, .5)",t.fill();var i=e/11;t.lineWidth=4,t.strokeStyle="rgba(255, 255, 255, .5)";for(var n=0;n<10;n++)t.beginPath(),t.moveTo(i*(n+1),0),t.lineTo(i*(n+1),o),t.stroke()}},TubeCurved2Config.prototype.getz1064Items=function(t){t.push(new a.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Tubes",offsetY:-.5,offsetX:-.5,order:6}))},TubeCurved2Config.maxObjects=10,TubeCurved2Config}();a.TubeCurved2Config=t,a.App.AddEntityConfig(new t)}(z0||(z0={})),function(v){var t=function(d){function TubeStraight(){var t=d.call(this)||this;return t.height=0,v.z1073.SetColor3FromHex("#ff3838",t.initColor1),t.color.copyFrom(t.initColor1),t.bindedKeepPosInside=t.keepPosInside.bind(t),t}return __extends(TubeStraight,d),TubeStraight.prototype.init=function(t){d.prototype.init.call(this,t),this.textureName="tubeStraightTexture";var e="tube"+this.num;this.boxSize=1,t.boxSize&&(this.boxSize=t.boxSize),this.gridSize=this.boxSize/3,this.height=this.boxSize,this.radius=.25*this.boxSize,this.innerRadius=.9*this.radius,this.innerRadius=.85*this.radius,this.innerRadius=.8*this.radius;var o=0,i=0;null!=t.x&&(o=t.x),null!=t.y&&(i=t.y);var n=0,s=0,a=0;if(null!=t.rx&&(n=t.rx),null!=t.ry&&(s=t.ry),null!=t.rz&&(a=t.rz),!this.isMenuItem&&!this.body){this.world=t.world,this.createGraphNodes();var r=[1,.4,.2,v.App.z1033,4294967295];this.body=new OIMO.Body({size:[this.radius,this.height,this.innerRadius],pos:[0,0,0],rot:[180/Math.PI*0,180/Math.PI*0,180/Math.PI*0],world:this.world,type:"tube",move:!1,name:e+"_tube",config:r}).body;var c=.5*(this.body.shapes.entity=this).height;this.botGraphNode.addConnection(this.centerGraphNode,c),this.centerGraphNode.addConnection(this.botGraphNode,c),this.centerGraphNode.addConnection(this.topGraphNode,c),this.topGraphNode.addConnection(this.centerGraphNode,c)}this.boxSize=this.height,t.isMenuItem?(this.setPosition(o,i+.5*this.boxSize,0),this.setConnectors()):t.skipAddToScene||(this.setPosition(o,i,0),this.setRotation(n,s,a),this.addToScene(),this.cage?this.cage.isReady?this.checkConnections():this.cage.pubsub.subscribe("ready",this.checkConnections,this):this.checkConnections()),this.updateCovers()},TubeStraight.prototype.updateNodes=function(){if(this.body){var t=this.centerGraphNode,e=this.topGraphNode,o=this.botGraphNode,i=this.gridSize,n=.5*this.boxSize,s=this.position.x,a=this.position.y,r=this.position.z;t.x=s,t.y=a,t.z=r;var c=0;e.data.enterEvent&&(c=.5*i);var d=0,p=n+c,l=0;c=0,o.data.enterEvent&&(c=.5*i);var u=0,y=-n-c,g=0,m=d*(C=this.body.rotation.elements)[0]+p*C[1]+l*C[2]+s,f=d*C[3]+p*C[4]+l*C[5]+a,A=d*C[6]+p*C[7]+l*C[8]+r,b=u*C[0]+y*C[1]+g*C[2]+s,v=u*C[3]+y*C[4]+g*C[5]+a,x=u*C[6]+y*C[7]+g*C[8]+r;e.x=m,e.y=f,e.z=A,o.x=b,o.y=v,o.z=x;p=2*i,l=0,u=0,y=2*-i,g=0,m=(d=0)*(C=this.body.rotation.elements)[0]+p*C[1]+l*C[2]+s,f=d*C[3]+p*C[4]+l*C[5]+a,A=d*C[6]+p*C[7]+l*C[8]+r,b=u*C[0]+y*C[1]+g*C[2]+s,v=u*C[3]+y*C[4]+g*C[5]+a,x=u*C[6]+y*C[7]+g*C[8]+r;var C,S=e.data.enterTarget;S&&(S.x=m,S.y=f,S.z=A),(S=o.data.enterTarget)&&(S.x=b,S.y=v,S.z=x),this.updateOutDirs()}},TubeStraight.prototype.isInTube=function(t,e,o,i){if(void 0===i&&(i=0),!this.isInBox(t,e,o,i))return!1;var n=this.body,s=n.position,a=n.rotation.elements,r=t-s.x,c=e-s.y,d=o-s.z,p=r*a[0]+c*a[3]+d*a[6],l=r*a[2]+c*a[5]+d*a[8];return p*p+l*l<this.radius*this.radius},TubeStraight.prototype.createGraphNodes=function(){this.isMenuItem||this.centerGraphNode||(this.centerGraphNode=new GraphNode(0,0,0),this.topGraphNode=new GraphNode(0,1,0),this.botGraphNode=new GraphNode(0,-1,0),((((((this.centerGraphNode.data.tube=this).centerGraphNode.data.obj=this).topGraphNode.data.tube=this).botGraphNode.data.tube=this).topGraphNode.data.obj=this).botGraphNode.data.obj=this).nodes.push(this.botGraphNode),this.nodes.push(this.centerGraphNode),this.nodes.push(this.topGraphNode),v.app.graph.addNode(this.botGraphNode),v.app.graph.addNode(this.centerGraphNode),v.app.graph.addNode(this.topGraphNode))},TubeStraight.prototype.createConnectors=function(){if(!this.topConnector){this.createGraphNodes();var t=!1;this.isMenuItem&&(t=!0),this.topConnector=ObjectPool.get(v.ConnectorTube.name,{pathNodeTop:this.topGraphNode,renderingGroupID:this.renderingGroupID},!1,t),this.botConnector=ObjectPool.get(v.ConnectorTube.name,{pathNodeTop:this.botGraphNode,renderingGroupID:this.renderingGroupID},!1,t),this.isOnScene&&(this.topConnector.addToScene(),this.botConnector.addToScene()),this._initColors()}},TubeStraight.prototype.setConnectors=function(){this.topConnector||this.createConnectors();var t=this.gridSize,e=this.position.x,o=this.position.y,i=this.position.z,n=1.5*t,s=1.5*-t,a=v.Tube.tempBabMats[0];this.rotationQuaternion.toRotationMatrix(a);var r=a.m,c=0*r[0]+n*r[4]+0*r[8]+e,d=0*r[1]+n*r[5]+0*r[9]+o,p=0*r[2]+n*r[6]+0*r[10]+i,l=0*r[0]+s*r[4]+0*r[8]+e,u=0*r[1]+s*r[5]+0*r[9]+o,y=0*r[2]+s*r[6]+0*r[10]+i;this.topConnector.setPosition(c,d,p),this.botConnector.setPosition(l,u,y);var g=v.Tube.tempBabQuats[0],m=v.Tube.tempQuats[0];g.copyFrom(this.rotationQuaternion),m.x=g.x,m.y=g.y,m.z=g.z,m.s=g.w;var f=v.Tube.z4[0];g.toEulerAnglesToRef(f),this.topConnector.setRotation(f.x,f.y,f.z);var A=v.Tube.tempQuats[1],b=v.Tube.tempVecs[1];b.x=0,b.y=0,b.z=1,A.setFromAxisAngle(b,-Math.PI),A.mul(m,A),g.x=A.x,g.y=A.y,g.z=A.z,g.w=A.s,g.toEulerAnglesToRef(f),this.botConnector.setRotation(f.x,f.y,f.z)},TubeStraight.prototype.getDirection=function(t,e,o){var i=this.body,n=i.position,s=i.rotation.elements,a=e.x-n.x,r=e.y-n.y,c=e.z-n.z,d=(s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8],o.x-n.x),p=o.y-n.y,l=o.z-n.z,u=(s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8],o.x-e.x),y=o.y-e.y,g=o.z-e.z,m=(s[0],s[3],s[6],u*s[1]+y*s[4]+g*s[7]);s[2],s[5],s[8],u=0,y=1,g=0;m<0&&(y=-1),t.x=u*s[0]+y*s[1]+g*s[2],t.y=u*s[3]+y*s[4]+g*s[5],t.z=u*s[6]+y*s[7]+g*s[8]},TubeStraight.prototype.getCenterAtPoint=function(t,e){var o=this.body,i=o.position,n=o.rotation.elements,s=e.x-i.x,a=e.y-i.y,r=e.z-i.z,c=(n[0],n[3],n[6],s*n[1]+a*n[4]+r*n[7]),d=(n[2],n[5],n[8],c);t.x=0*n[0]+d*n[1]+0*n[2],t.y=0*n[3]+d*n[4]+0*n[5],t.z=0*n[6]+d*n[7]+0*n[8],t.x+=i.x,t.y+=i.y,t.z+=i.z},TubeStraight.prototype.refreshOpenings=function(){this.topConnector&&(this.topConnector.refresh(),this.botConnector.refresh())},TubeStraight.prototype.keepPosInside=function(t){var e=this.position,o=t.x-e.x,i=t.y-e.y,n=t.z-e.z,s=this.body.rotation.elements,a=o*s[0]+i*s[3]+n*s[6],r=o*s[1]+i*s[4]+n*s[7],c=o*s[2]+i*s[5]+n*s[8],d=this.radius-.05;if(d*d<a*a+c*c){var p=v.Tube.z4[0];p.x=a,p.y=0,p.z=c,p.normalize();var l=p.x*d,u=r,y=p.z*d;o=l*s[0]+u*s[1]+y*s[2],i=l*s[3]+u*s[4]+y*s[5],n=l*s[6]+u*s[7]+y*s[8],t.x=e.x+o,t.y=e.y+i,t.z=e.z+n}},TubeStraight}(v.Tube);v.TubeStraight=t}(z0||(z0={})),function(e){var t=function(){function TubeConfig(){this.maxObjects=0}return TubeConfig.prototype.initObjectPool=function(t){ObjectPool.addClass("TubeNavigator",e.TubeNavigator,{world:t})},TubeConfig.prototype.getSceneFileNames=function(t){},TubeConfig.prototype.getCreateMaterialFunctions=function(t){t.tubeMat=this._createMaterials},TubeConfig.prototype._createMaterials=function(t,e,o,i,n){var s=new BABYLON.StandardMaterial("tubeMat",t);s.useSpecularOverAlpha=!0,s.diffuseColor=new BABYLON.Color3(1,1,1),s.opacityFresnelParameters=new BABYLON.FresnelParameters,s.opacityFresnelParameters.leftColor=BABYLON.Color3.White();var a=BABYLON.Color3.Black();s.opacityFresnelParameters.rightColor=a,s.opacityFresnelParameters.bias=.7,s.opacityFresnelParameters.power=3,s.diffuseTexture=n.alphaTileSet.getTexture(),s.opacityTexture=s.diffuseTexture;s.specularColor.r=.1,s.specularColor.g=.1,s.specularColor.b=.1,o.tubeMat=s},TubeConfig.prototype.getSPSData=function(t){},TubeConfig.prototype.getz1064Items=function(t){},TubeConfig.prototype.getz49s=function(t){t.push(e.z21)},TubeConfig.prototype.getListenerSetups=function(t){t.push({event:e.TubeEvents.ENTER,state:e.z21})},TubeConfig}();e.TubeConfig=t,e.App.AddEntityConfig(new t)}(z0||(z0={})),function(i){var t=function(){function TubeStraightConfig(){this.objName="t5",i.TubeStraight.objectCount=TubeStraightConfig.maxObjects}return TubeStraightConfig.prototype.initObjectPool=function(t){var e={shapeName:this.objName,world:t,x:0,y:0,z:0,rx:0,ry:0,rz:0,boxSize:1,skipAddToScene:!0};ObjectPool.addClass(this.objName,i.TubeStraight,e)},TubeStraightConfig.prototype.getSceneFileNames=function(t){},TubeStraightConfig.prototype.getCreateMeshFunctions=function(t){t.TubeStraight=this._createMeshes},TubeStraightConfig.prototype._createMeshes=function(t,e,o){return i.Tube.mergeMeshes("TubeStraight",e)},TubeStraightConfig.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"TubeStraight",numInstances:TubeStraightConfig.maxObjects,maxInstances:TubeStraightConfig.maxObjects,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0}),t.push({shapeName:this.objName,meshName:"TubeStraightButton",numInstances:TubeStraightConfig.maxObjects,maxInstances:TubeStraightConfig.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName,meshName:"menuButtonSmall",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"TubeStraight",numInstances:1,maxInstances:1,applyMaterialToSPS:"tubeMat",computeTextures:!0,renderingGroupID:i.App.menuRenderingGroupID})},TubeStraightConfig.prototype.getTextureDrawFunctions=function(t){t.tubeStraightTexture=function(t,e,o){t.beginPath(),t.rect(0,0,e,o),t.fillStyle="rgba(255, 255, 255, .5)",t.fill();var i=e/5;t.lineWidth=8,t.strokeStyle="rgba(255, 255, 255, .5)";for(var n=0;n<4;n++)t.beginPath(),t.moveTo(i*(n+1),0),t.lineTo(i*(n+1),o),t.stroke()}},TubeStraightConfig.prototype.getz1064Items=function(t){t.push(new i.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Tubes",order:2}))},TubeStraightConfig.maxObjects=40,TubeStraightConfig}();i.TubeStraightConfig=t,i.App.AddEntityConfig(new t)}(z0||(z0={})),function(E){var t=function(d){function TubeTee(){var t=d.call(this)||this;return t.height=0,t.bindedKeepPosInside=t.keepPosInside.bind(t),t}return __extends(TubeTee,d),TubeTee.prototype.init=function(t){d.prototype.init.call(this,t),this.textureName="tubeTeeTexture";var e="tube"+this.num;this.boxSize=1,t.boxSize&&(this.boxSize=t.boxSize),this.gridSize=this.boxSize/3,this.height=this.boxSize,this.radius=.25*this.boxSize,this.innerRadius=.9*this.radius,this.innerRadius=.85*this.radius,this.innerRadius=.8*this.radius;var o=0,i=0;null!=t.x&&(o=t.x),null!=t.y&&(i=t.y);var n=0,s=0,a=0;if(null!=t.rx&&(n=t.rx),null!=t.ry&&(s=t.ry),null!=t.rz&&(a=t.rz),!this.isMenuItem&&!this.body){this.world=t.world,this.createGraphNodes();var r=[1,.4,.2,E.App.z1033,4294967295];this.body=new OIMO.Body({size:[this.radius,this.height,this.innerRadius],pos:[0,0,0],rot:[180/Math.PI*0,180/Math.PI*0,180/Math.PI*0],world:this.world,type:"teeTube",move:!1,name:e+"_tube",config:r}).body;var c=.5*(this.body.shapes.entity=this).height;this.botGraphNode.addConnection(this.centerGraphNode,c),this.centerGraphNode.addConnection(this.botGraphNode,c),this.centerGraphNode.addConnection(this.topGraphNode,c),this.topGraphNode.addConnection(this.centerGraphNode,c),this.centerGraphNode.addConnection(this.rightGraphNode,c),this.rightGraphNode.addConnection(this.centerGraphNode,c)}t.isMenuItem?(this.setPosition(o,i+.5*this.boxSize,0),this.setConnectors()):(this.setPosition(o,i,0),this.setRotation(n,s,a),t.skipAddToScene||(this.addToScene(),this.cage?this.cage.isReady?this.checkConnections():this.cage.pubsub.subscribe("ready",this.checkConnections,this):this.checkConnections()))},TubeTee.prototype.updateNodes=function(){if(this.body){var t=this.centerGraphNode,e=this.topGraphNode,o=this.botGraphNode,i=this.rightGraphNode,n=this.gridSize,s=.5*this.boxSize,a=this.position.x,r=this.position.y,c=this.position.z;t.x=a,t.y=r,t.z=c;var d=0;e.data.enterEvent&&(d=.5*n);var p=0,l=s+d,u=0;d=0,o.data.enterEvent&&(d=.5*n);var y=0,g=-s-d,m=0;d=0,i.data.enterEvent&&(d=.5*n);var f=s+d,A=0,b=0,v=p*(I=this.body.rotation.elements)[0]+l*I[1]+u*I[2]+a,x=p*I[3]+l*I[4]+u*I[5]+r,C=p*I[6]+l*I[7]+u*I[8]+c,S=y*I[0]+g*I[1]+m*I[2]+a,T=y*I[3]+g*I[4]+m*I[5]+r,B=y*I[6]+g*I[7]+m*I[8]+c,O=f*I[0]+A*I[1]+b*I[2]+a,P=f*I[3]+A*I[4]+b*I[5]+r,M=f*I[6]+A*I[7]+b*I[8]+c;e.x=v,e.y=x,e.z=C,o.x=S,o.y=T,o.z=B,i.x=O,i.y=P,i.z=M;l=2*n,u=0,y=0,g=2*-n,m=0,f=2*n,A=0,b=0,v=(p=0)*(I=this.body.rotation.elements)[0]+l*I[1]+u*I[2]+a,x=p*I[3]+l*I[4]+u*I[5]+r,C=p*I[6]+l*I[7]+u*I[8]+c,S=y*I[0]+g*I[1]+m*I[2]+a,T=y*I[3]+g*I[4]+m*I[5]+r,B=y*I[6]+g*I[7]+m*I[8]+c,O=f*I[0]+A*I[1]+b*I[2]+a,P=f*I[3]+A*I[4]+b*I[5]+r,M=f*I[6]+A*I[7]+b*I[8]+c;var I,N=e.data.enterTarget;N&&(N.x=v,N.y=x,N.z=C),(N=o.data.enterTarget)&&(N.x=S,N.y=T,N.z=B),(N=i.data.enterTarget)&&(N.x=O,N.y=P,N.z=M),this.updateOutDirs()}},TubeTee.prototype.createGraphNodes=function(){this.isMenuItem||this.centerGraphNode||(this.centerGraphNode=new GraphNode(0,0,0),this.topGraphNode=new GraphNode(0,1,0),this.botGraphNode=new GraphNode(0,-1,0),this.rightGraphNode=new GraphNode(1,0,0),((((((((this.centerGraphNode.data.tube=this).centerGraphNode.data.obj=this).topGraphNode.data.tube=this).botGraphNode.data.tube=this).rightGraphNode.data.tube=this).topGraphNode.data.obj=this).botGraphNode.data.obj=this).rightGraphNode.data.obj=this).nodes.push(this.botGraphNode),this.nodes.push(this.centerGraphNode),this.nodes.push(this.topGraphNode),this.nodes.push(this.rightGraphNode),E.app.graph.addNode(this.botGraphNode),E.app.graph.addNode(this.centerGraphNode),E.app.graph.addNode(this.topGraphNode),E.app.graph.addNode(this.rightGraphNode))},TubeTee.prototype.createConnectors=function(){if(!this.topConnector){this.createGraphNodes();var t=!1;this.isMenuItem&&(t=!0),this.topConnector=ObjectPool.get(E.ConnectorTube.name,{pathNodeTop:this.topGraphNode,renderingGroupID:this.renderingGroupID},!1,t),this.botConnector=ObjectPool.get(E.ConnectorTube.name,{pathNodeTop:this.botGraphNode,renderingGroupID:this.renderingGroupID},!1,t),this.rightConnector=ObjectPool.get(E.ConnectorTube.name,{pathNodeTop:this.rightGraphNode,renderingGroupID:this.renderingGroupID},!1,t),this.isOnScene&&(this.topConnector.addToScene(),this.botConnector.addToScene(),this.rightConnector.addToScene()),this._initColors()}},TubeTee.prototype.setConnectors=function(){this.topConnector||this.createConnectors();var t=this.gridSize,e=this.position.x,o=this.position.y,i=this.position.z,n=1.5*t,s=1.5*t,a=1.5*-t,r=E.Tube.tempBabMats[0];this.rotationQuaternion.toRotationMatrix(r);var c=r.m,d=0*c[0]+n*c[4]+0*c[8]+e,p=0*c[1]+n*c[5]+0*c[9]+o,l=0*c[2]+n*c[6]+0*c[10]+i,u=s*c[0]+0*c[4]+0*c[8]+e,y=s*c[1]+0*c[5]+0*c[9]+o,g=s*c[2]+0*c[6]+0*c[10]+i,m=0*c[0]+a*c[4]+0*c[8]+e,f=0*c[1]+a*c[5]+0*c[9]+o,A=0*c[2]+a*c[6]+0*c[10]+i;this.topConnector.setPosition(d,p,l),this.botConnector.setPosition(m,f,A),this.rightConnector.setPosition(u,y,g);var b=E.Tube.tempBabQuats[0];E.Tube.tempBabQuats[1];b.copyFrom(this.rotationQuaternion);var v=E.Tube.tempQuats[0];v.x=b.x,v.y=b.y,v.z=b.z,v.s=b.w;var x=E.Tube.tempVecs[0];b.toEulerAnglesToRef(x),this.topConnector.setRotation(x.x,x.y,x.z);var C=E.Tube.tempQuats[1],S=E.Tube.tempVecs[1];S.x=0,S.y=0,S.z=1,C.setFromAxisAngle(S,-Math.PI),C.mul(v,C),b.x=C.x,b.y=C.y,b.z=C.z,b.w=C.s,b.toEulerAnglesToRef(x),this.botConnector.setRotation(x.x,x.y,x.z),S.x=0,S.y=0,S.z=1,C.setFromAxisAngle(S,.5*-Math.PI),C.mul(v,C),b.x=C.x,b.y=C.y,b.z=C.z,b.w=C.s,b.toEulerAnglesToRef(x),this.rightConnector.setRotation(x.x,x.y,x.z)},TubeTee.prototype.getDirection=function(t,e,o,i){var n=this.body,s=n.position,a=n.rotation.elements,r=e.x-s.x,c=e.y-s.y,d=e.z-s.z,p=r*a[0]+c*a[3]+d*a[6],l=r*a[1]+c*a[4]+d*a[7],u=(a[2],a[5],a[8],o.x-s.x),y=o.y-s.y,g=o.z-s.z,m=u*a[0]+y*a[3]+g*a[6],f=u*a[1]+y*a[4]+g*a[7],A=(a[2],a[5],a[8],o.x-e.x),b=o.y-e.y,v=o.z-e.z,x=A*a[0]+b*a[3]+v*a[6],C=A*a[1]+b*a[4]+v*a[7],S=(a[2],a[5],a[8],A=0,b=1,v=0,!1),T=!1,B=!1,O=this.radius,P=this.radius-.5*i;l<P&&-P<l&&p<P&&-P<p&&(S=!0);var M;M=O,m<O&&(T=!0),p<P&&(B=!0),T&&B||B&&!S?C<0&&(b=-1):(!B||S&&!T)&&(A=1,x<(v=b=0)&&(A=-1)),t.x=A*a[0]+b*a[1]+v*a[2],t.y=A*a[3]+b*a[4]+v*a[5],t.z=A*a[6]+b*a[7]+v*a[8]},TubeTee.prototype.refreshOpenings=function(){this.topConnector.refresh(),this.rightConnector.refresh(),this.botConnector.refresh()},TubeTee.prototype.keepPosInside=function(t,e){var o=this.position,i=t.x-o.x,n=t.y-o.y,s=t.z-o.z,a=this.body.rotation.elements,r=i*a[0]+n*a[3]+s*a[6],c=i*a[1]+n*a[4]+s*a[7],d=i*a[2]+n*a[5]+s*a[8],p=this.radius-.05,l=p*p,u=0,y=0,g=0,m=0,f=0,A=0,b=E.Tube.z4[0],v=!1,x=!1,C=!1,S=!1;if(e){var T=e.x-o.x,B=e.y-o.y,O=e.z-o.z,P=T*a[0]+B*a[3]+O*a[6],M=T*a[1]+B*a[4]+O*a[7];P>this.radius&&(x=!0),M>this.radius&&(v=!0),M<-this.radius&&(v=!0)}if(!x){if(!(l<r*r+d*d))return;b.x=r,b.y=0,b.z=d,b.normalize(),m=b.x*p,f=c,A=b.z*p,C=!0}if(!v&&0<r){if(!(l<c*c+d*d))return;b.x=0,b.y=c,b.z=d,b.normalize(),u=r,y=b.y*p,g=b.z*p,S=!0}if(C||S){var I,N,z,w=u-r,_=y-c,R=g-d,L=m-r,F=f-c,D=A-d;L*L+F*F+D*D<w*w+_*_+R*R?(I=m,N=f,z=A):(I=u,N=y,z=g),i=I*a[0]+N*a[1]+z*a[2],n=I*a[3]+N*a[4]+z*a[5],s=I*a[6]+N*a[7]+z*a[8],t.x=o.x+i,t.y=o.y+n,t.z=o.z+s}},TubeTee.prototype.isInTube=function(t,e,o,i){if(void 0===i&&(i=0),!this.isInBox(t,e,o,i))return!1;var n=this.body,s=n.position,a=n.rotation.elements,r=t-s.x,c=e-s.y,d=o-s.z,p=r*a[0]+c*a[3]+d*a[6],l=r*a[1]+c*a[4]+d*a[7],u=r*a[2]+c*a[5]+d*a[8];return p*p+u*u<this.radius*this.radius||!(r<0)&&l*l+u*u<this.radius*this.radius},TubeTee.count=0,TubeTee}(E.Tube);E.TubeTee=t}(z0||(z0={})),function(o){var t=function(){function TubeTeeConfig(){this.objName="t6",o.TubeTee.objectCount=TubeTeeConfig.maxObjects}return TubeTeeConfig.prototype.initObjectPool=function(t){var e={shapeName:this.objName,world:t,x:0,y:0,z:0,rx:0,ry:0,rz:0,boxSize:1,skipAddToScene:!0};ObjectPool.addClass(this.objName,o.TubeTee,e)},TubeTeeConfig.prototype.getSceneFileNames=function(t){},TubeTeeConfig.prototype.getCreateMeshFunctions=function(t){t.TubeTee=this._createMeshes},TubeTeeConfig.prototype._createMeshes=function(t,e){o.Tube.mergeMeshes("TubeTee",e)},TubeTeeConfig.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"TubeTee",numInstances:TubeTeeConfig.maxObjects,maxInstances:TubeTeeConfig.maxObjects,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0}),t.push({shapeName:this.objName,meshName:"TubeTeeButton",numInstances:TubeTeeConfig.maxObjects,maxInstances:TubeTeeConfig.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName,meshName:"menuButtonSmall",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"TubeTee",numInstances:1,maxInstances:1,applyMaterialToSPS:"tubeMat",computeTextures:!0,renderingGroupID:o.App.menuRenderingGroupID})},TubeTeeConfig.prototype.getTextureDrawFunctions=function(t){t.tubeTeeTexture=function(t,e,o){t.beginPath(),t.rect(0,0,e,o),t.fillStyle="rgba(255, 255, 255, .5)",t.fill();var i=e/6;t.lineWidth=8,t.strokeStyle="rgba(255, 255, 255, .5)";for(var n=0;n<5;n++)t.beginPath(),t.moveTo(i*(n+1),0),t.lineTo(i*(n+1),o),t.stroke()}},TubeTeeConfig.prototype.getz1064Items=function(t){t.push(new o.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Tubes",order:3}))},TubeTeeConfig.maxObjects=10,TubeTeeConfig}();o.TubeTeeConfig=t,o.App.AddEntityConfig(new t)}(z0||(z0={})),function(e){var t=function(){function ConnectorTubeConfig(){}return ConnectorTubeConfig.prototype.initObjectPool=function(t){ObjectPool.addClass(e.ConnectorTube.name,e.ConnectorTube)},ConnectorTubeConfig.prototype.getSPSData=function(t){},ConnectorTubeConfig.prototype.getTextureDrawFunctions=function(t){},ConnectorTubeConfig.maxObjects=e.TubeCapConfig.maxObjects+4*e.TubeCrossConfig.maxObjects+2*e.TubeCurvedConfig.maxObjects+2*e.TubeCurved2Config.maxObjects+2*e.TubeStraightConfig.maxObjects+2*e.TubeTeeConfig.maxObjects,ConnectorTubeConfig}();e.App.AddEntityConfig(new t)}(z0||(z0={})),function(e){var t=function(){function ConnectorCageConfig(){}return ConnectorCageConfig.prototype.initObjectPool=function(t){ObjectPool.addClass("ConnectorCage",e.ConnectorCage,{world:t})},ConnectorCageConfig.prototype.getSceneFileNames=function(t){},ConnectorCageConfig.prototype.getSPSData=function(t){},ConnectorCageConfig.prototype.getz49s=function(t){t.push(e.z126)},ConnectorCageConfig.prototype.getListenerSetups=function(t){t.push({event:e.ConnectorCageEvents.ENTER,state:e.z126})},ConnectorCageConfig}();e.App.AddEntityConfig(new t)}(z0||(z0={})),function(u){var t=function(l){function ConnectorCage(){var t=l.call(this)||this;return t.accType=u.z1044.CONNECTOR_z1048,t.node1=null,t.node2=null,t.centerGraphNode=null,t.body=null,t.world=null,t.height=0,t.innerRadius=0,t.radius=0,t.num=0,t.boxSize=1,t.rotation=BABYLON.Vector3.Zero(),t.saveToDB=!1,t._node1Connected=!1,t._node2Connected=!1,t.hamsters=new z1072,ConnectorCage.count++,t.num=ConnectorCage.count,t}return __extends(ConnectorCage,l),Object.defineProperty(ConnectorCage.prototype,"node1Connected",{get:function(){return this._node1Connected},set:function(t){t!=this._node1Connected&&(this._node1Connected=t)},enumerable:!1,configurable:!0}),Object.defineProperty(ConnectorCage.prototype,"node2Connected",{get:function(){return this._node2Connected},set:function(t){t!=this._node2Connected&&(this._node2Connected=t)},enumerable:!1,configurable:!0}),ConnectorCage.prototype.init=function(t){if(l.prototype.init.call(this,t),this.cage1=t.cage1,this.cage2=t.cage2,this.height=.1*this.boxSize,this.radius=.25*this.boxSize,this.innerRadius=.9*this.radius,this.innerRadius=.85*this.radius,!this.body){var e="concage"+this.num;this.world=t.world;var o=[1,.4,.2,2,4294967295];this.body=new OIMO.Body({size:[this.radius,this.height,this.innerRadius],pos:[0,0,0],rot:[0,0,0],world:this.world,type:"tube",move:!1,name:e+"_tube",config:o}).body}if(!this.shape){var i="connector_rg"+this.renderingGroupID;this.shape=ObjectPool.get(i,{renderingGroupID:this.renderingGroupID}),this.shape.setColor(this.color.r,this.color.g,this.color.b)}if(t.color){var n=t.color;this.setColor(n.r,n.g,n.b,n.a)}var s=0,a=0,r=0;t.x&&(s=t.x),t.y&&(a=t.y),t.z&&(r=t.z);var c=0,d=0,p=0;t.rx&&(c=t.rx),t.ry&&(d=t.ry),t.rz&&(p=t.rz),this.setRotation(c,d,p),this.setPosition(s,a,r),t.skipAddToScene||this.addToScene()},ConnectorCage.prototype.setRotation=function(t,e,o){l.prototype.setRotation.call(this,t,e,o),this.shape.setRotation(t,e,o),this.rotationQuaternion.copyFrom(this.shape.rotationQuaternion),z1.setBodyRotationQuaternion(this.body,this.rotationQuaternion)},ConnectorCage.prototype.setPosition=function(t,e,o){l.prototype.setPosition.call(this,t,e,o);var i=this.body.position;i.x=t,i.y=e,i.z=o;var n=this.body.shapes.position;n.x=t,n.y=e,n.z=o,this.body.shapes.updateProxy(),this.shape.setPosition(t,e,o),this.updateNodes()},ConnectorCage.prototype.updateNodes=function(){if(!this.node1){this.node1=new GraphNode(0,0,0),this.node2=new GraphNode(0,0,0),this.centerGraphNode=new GraphNode(0,0,0),this.node1.data={},(this.node1.data.connector=this).node1.data.enterTarget=new OIMO.Vec3,this.node1.data.enterNextNode=this.centerGraphNode,this.node2.data={},(this.node2.data.connector=this).node2.data.enterTarget=new OIMO.Vec3,this.node2.data.enterNextNode=this.centerGraphNode,this.centerGraphNode.data={};(this.centerGraphNode.data.connector=this).node1.addConnection(this.centerGraphNode,.2),this.centerGraphNode.addConnection(this.node1,.2),this.node2.addConnection(this.centerGraphNode,.2),this.centerGraphNode.addConnection(this.node2,.2),u.app.graph.addNode(this.centerGraphNode),u.app.graph.addNode(this.node1),u.app.graph.addNode(this.node2)}this.node1.data.enterEvent=u.ConnectorCageEvents.ENTER,this.node2.data.enterEvent=u.ConnectorCageEvents.ENTER,((this.node1.data.obj=this).node2.data.obj=this).centerGraphNode.data.obj=this;var t=ConnectorCage.tempBabVec;t.x=0,t.y=.2,t.z=0,BABYLON.Vector3.TransformCoordinatesToRef(t,this.shape.worldMatrix,t),this.node1.x=t.x,this.node1.y=t.y,this.node1.z=t.z;var e=this.node1.data.enterTarget;e&&(e.x=t.x,e.y=t.y,e.z=t.z),t.x=0,t.y=-.2,t.z=0,BABYLON.Vector3.TransformCoordinatesToRef(t,this.shape.worldMatrix,t),this.node2.x=t.x,this.node2.y=t.y,this.node2.z=t.z,(e=this.node2.data.enterTarget)&&(e.x=t.x,e.y=t.y,e.z=t.z),t.x=0,t.y=0,t.z=0,BABYLON.Vector3.TransformCoordinatesToRef(t,this.shape.worldMatrix,t),this.centerGraphNode.x=t.x,this.centerGraphNode.y=t.y,this.centerGraphNode.z=t.z,this.refreshConnections()},ConnectorCage.prototype.checkRampConnections=function(t,e){var o,i=ConnectorCage.tempArray;if((i.length=0,e.getChildrenAt(t.x,t.y,t.z,.2,.5,i,u.z1044.z1046),i[0])&&!(o=i[0]).skipConnect){var n=o.lowNode.x-t.x;if(Math.abs(n)<.3){var s=o.lowCenterNode;s.x=n<0?this.centerGraphNode.x+.4:this.centerGraphNode.x-.4;var a=Math.sqrt(z1.distanceSquared(s,t));t.addConnection(s,a),s.addConnection(t,a)}}if((i.length=0,!u.z1073.IsNodeConnectedToAccType(t,u.z1044.z1049))&&(e.getChildrenAt(t.x,t.y-1,t.z,.2,.5,i,u.z1044.z1046),i[0]&&!(o=i[0]).skipConnect&&Math.abs(o.highNode.x-t.x)<.4)){a=Math.sqrt(z1.distanceSquared(o.highNode,t));t.addConnection(o.highNode,a),o.highNode.addConnection(t,a)}},ConnectorCage.prototype.connectNodeToCage=function(t,e,o){var i=e.getGraphNodeAt(t.x,t.y,t.z,null,null,null,null,o);if(i){var n=t.x-i.x,s=t.y-i.y,a=t.z-i.z;if(.5625<n*n+a*a)return;var r=Math.sqrt(n*n+s*s+a*a);if(1<r)return;if(o&u.z1044.z1047){var c=e.getHeightAt(t.x,t.z);t.y<c&&(r*=2);var d=e.getPlatformUnder(t.x,t.y,t.z);if(d&&d.position.y>i.y)return}else if(o&u.z1044.z1049){var p=u.z1073.IsNodeConnectedToAccType(t,u.z1044.z1047);p&&p.y<i.y&&(t.removeConnection(p),p.removeConnection(t))}return t.addConnection(i,r),i.addConnection(t,r),i.data.obj2&&i.data.obj2.onAfterConnect&&i.data.obj2.onAfterConnect(this),i.data.obj&&i.data.obj&&i.data.obj.onAfterConnect(this),!0}},ConnectorCage.prototype.onAfterDisconnect=function(t){this.refreshConnections()},ConnectorCage.prototype.recycle=function(){var t;(this.node1Connected&&this.disconnectNodeFromCage(this.node1,this.cage1),this.node2Connected&&this.disconnectNodeFromCage(this.node2,this.cage2),this.node1Connected=!1,this.node2Connected=!1,this.cage1)&&(this.cage1.removeHoleAt(this.position.x,this.position.y,this.position.z),-1<(t=this.cage1.connectors.indexOf(this))&&this.cage1.connectors.splice(t,1));this.cage2&&(this.cage2.removeHoleAt(this.position.x,this.position.y,this.position.z),-1<(t=this.cage2.connectors.indexOf(this))&&this.cage2.connectors.splice(t,1));this.cage1=null,this.cage2=null,this.setPosition(999,999,999),this.isOnScene=!1,this.shape.removeFromScene(),this.onChangeObservable.notifyObservers(this,2),this.onChangeObservable.clear(),ObjectPool.recycle(this)},ConnectorCage.prototype.isTubeConnected=function(t,e){var o=t.getObjectAt(e.x,e.y,e.z,u.z1044.z1051);if(o&&o.accType==u.z1044.z1051){var i,n,s,a=this.position,r=o.getGraphNodeAt(a.x,a.y,a.z);if((i=r.x-this.node1.x)*i+(n=r.y-this.node1.y)*n+(s=r.z-this.node1.z)*s<.0625)return!0;if((i=r.x-this.node2.x)*i+(n=r.y-this.node2.y)*n+(s=r.z-this.node2.z)*s<.0625)return!0}return!1},ConnectorCage.prototype.disconnectNodeFromCage=function(t,e){for(var o=t.connections,i=o.length-1;0<=i;i--){var n=o[i];n.data&&n.data.obj==e&&(t.removeConnection(n),n.removeConnection(t))}},ConnectorCage.prototype.disconnectz1044=function(t){for(var e=this.node1.connections,o=e.length-1;0<=o;o--){if((i=e[o])&&i.data.obj2&&i.data.obj2.accType==t){this.node1.removeConnection(i),i.removeConnection(this.node1);break}}for(o=(e=this.node2.connections).length-1;0<=o;o--){var i;if((i=e[o])&&i.data.obj2&&i.data.obj2.accType==t){this.node2.removeConnection(i),i.removeConnection(this.node2);break}}},ConnectorCage.prototype.refreshConnections=function(){if(this.cage1){var t,e=this.isTubeConnected(this.cage1,this.node1);if(e||(e=this.isTubeConnected(this.cage2,this.node2)),e&&(this.node1Connected&&(this.disconnectNodeFromCage(this.node1,this.cage1),this.node1Connected=!1),this.node2Connected&&(this.disconnectNodeFromCage(this.node2,this.cage2),this.node2Connected=!1),this.disconnectz1044(u.z1044.z1046)),u.z1073.IsNodeConnectedToAccType(this.node1,u.z1044.z1049))(t=u.z1073.IsNodeConnectedToAccType(this.node1,u.z1044.z1046,-.5))&&(this.node1.removeConnection(t),t.removeConnection(this.node1));if(u.z1073.IsNodeConnectedToAccType(this.node2,u.z1044.z1049))(t=u.z1073.IsNodeConnectedToAccType(this.node2,u.z1044.z1046,-.5))&&(this.node2.removeConnection(t),t.removeConnection(this.node2));var o=ConnectorCage.tempBabVec,i=this.position;if(!e){this.node1Connected&&(this.disconnectNodeFromCage(this.node1,this.cage1),this.node1Connected=!1);var n=this.connectNodeToCage(this.node1,this.cage1,u.z1044.z1048|u.z1044.z1049|u.z1044.z1050|u.z1044.SWING);this.checkRampConnections(this.node1,this.cage1);var s=this.connectNodeToCage(this.node1,this.cage1,u.z1044.z1047);this.node1Connected=n||s}if(o.x=this.node1.x-i.x,o.y=this.node1.y-i.y,o.z=this.node1.z-i.z,o.normalize(),this.cage1.addHoleAt(i.x,i.y,i.z,o,this.cage2),!e){this.node2Connected&&(this.disconnectNodeFromCage(this.node2,this.cage2),this.node2Connected=!1);n=this.connectNodeToCage(this.node2,this.cage2,u.z1044.z1048|u.z1044.z1049|u.z1044.z1050|u.z1044.SWING);this.checkRampConnections(this.node2,this.cage2);s=this.connectNodeToCage(this.node2,this.cage2,u.z1044.z1047);this.node2Connected=n||s}o.x=this.node2.x-i.x,o.y=this.node2.y-i.y,o.z=this.node2.z-i.z,o.normalize(),this.cage2.addHoleAt(i.x,i.y,i.z,o,this.cage1)}},ConnectorCage.prototype.addz1062=function(t){-1===this.hamsters.indexOf(t)&&this.hamsters.push(t)},ConnectorCage.prototype.removez1062=function(t){this.hamsters.remove(t)},ConnectorCage.prototype.getNeighborAt=function(t,e,o){var i;return(i=u.Tube.GetTubeConnectedToNodeAt(this.node1,t,e,o))?i:(i=u.Tube.GetTubeConnectedToNodeAt(this.node1,t,e,o))?i:(i=u.Tube.GetTubeConnectedToNodeAt(this.node2,t,e,o))?i:(i=u.Tube.GetTubeConnectedToNodeAt(this.node2,t,e,o))||void 0},ConnectorCage.prototype.addToScene=function(){l.prototype.addToScene.call(this),this.shape.addToScene()},ConnectorCage.prototype.removeFromScene=function(){l.prototype.removeFromScene.call(this),this.shape.removeFromScene()},ConnectorCage.prototype.setColor=function(t,e,o,i){l.prototype.setColor.call(this,t,e,o),this.shape.setColor(t,e,o)},ConnectorCage.count=0,ConnectorCage.tempBabVec=BABYLON.Vector3.Zero(),ConnectorCage.tempArray=[],ConnectorCage}(u.z1092);u.ConnectorCage=t}(z0||(z0={})),function(t){var e=function(){function ConnectorCageEvents(){}return ConnectorCageEvents.ENTER=t.AppEvents.GetUniqueID(),ConnectorCageEvents.EXIT=t.AppEvents.GetUniqueID(),ConnectorCageEvents}();t.ConnectorCageEvents=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z676(){return null!==t&&t.apply(this,arguments)||this}return __extends(z676,t),z676.prototype.update=function(t){var e=t.path[t.pathIndex];if(e){var o,i,n,s,a=e,r=e,c=t.physics,d=c.headBody.body.position,p=c.frontBody.body.position,l=(o=d.x-a.x,i=d.y-a.y,n=d.z-a.z,s=t.size,t.targets.moveToTarget),u=t.targets.lookToTarget,y=t.targets.standToTarget;if(t.path[t.pathIndex+1]){a=t.path[t.pathIndex+1];var g=t.path[t.pathIndex];if(g.data.connector){var m=t.path[t.pathIndex+1],f=z767.z4[0],A=z767.z4[1];if(f.x=g.x-m.x,f.y=g.y-m.y,f.z=g.z-m.z,A.x=p.x-g.x,A.y=p.y-g.y,A.z=p.z-g.z,0<BABYLON.Vector3.Dot(f,A)){.09<z1.distanceSquared(d,g)&&(a=t.path[t.pathIndex])}else t.pathIndex+1<t.path.length&&t.pathIndex++}}u.x=a.x,u.y=a.y,u.z=a.z,y.x=u.x,y.y=u.y,y.z=u.z,(o=p.x-r.x)*o+(i=p.y-r.y)*i+(n=p.z-r.z)*n<(s=.5*t.size)*s&&(t.pathIndex,t.path.length),l.x=r.x,l.y=r.y,l.z=r.z}},z676}(z767),e.z676=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z622(){return null!==t&&t.apply(this,arguments)||this}return __extends(z622,t),z622.prototype.update=function(t){if(t.usingObject){var e=t.usingObject.position,o=t.physics.frontBody.body.position,i=o.x-e.x,n=o.z-e.z,s=i*i+n*n,a=2*t.size;s<a*a&&t.forceTouchGround()}},z622}(z767),e.z622=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(p){function z567(){var t=null!==p&&p.apply(this,arguments)||this;return t.bodyIndex=3,t.speedFrac=1,t.easeAmount=1,t}return __extends(z567,p),z567.prototype.update=function(t){var e=t.physics.rearBody.body.position,o=t.physics.frontBody.onGroundShape,i=t.physics.middleBody.onGroundShape,n=t.physics.rearBody.onGroundShape,s=o||i||n;if(s){var a=e,r=s.rotation.elements,c=t.physics.rearBody.target,d=t.size;c.x=a.x-r[1]*d,c.y=a.y-r[4]*d,c.z=a.z-r[7]*d,1!=r[0]&&p.prototype.update.call(this,t)}},z567}(e.z561),e.z567=o}(z0||(z0={})),function(y){var t,e;t=y.z156||(y.z156={}),e=function(t){function z524(){return null!==t&&t.apply(this,arguments)||this}return __extends(z524,t),z524.prototype.update=function(t){if(t.usingObject&&t.currentObject){var e=t.usingObject;if(e.accType==y.z1044.CONNECTOR_z1048){var o=t.usingObject.position,i=t.physics.middleBody;if(e.cage1.bedding||e.cage2.bedding){var n=t.currentObject.bedding;if(t.usingObject.position.y,i.body.position.y,t.physics.headBody.removeCollidesWith(y.App.PhysicsGroupBedding),t.physics.frontBody.removeCollidesWith(y.App.PhysicsGroupBedding),i.testCollidesWith(y.App.PhysicsGroupBedding)){var s=(a=i.body.position).x-o.x;a.y,o.y;s*s+(r=a.z-o.z)*r<(c=3*t.size)*c&&i.removeCollidesWith(y.App.PhysicsGroupBedding)}if((i=t.physics.rearBody).testCollidesWith(y.App.PhysicsGroupBedding)){var a,r,c;s=(a=i.body.position).x-o.x,a.y,o.y;if(s*s+(r=a.z-o.z)*r<(c=3*t.size)*c)if(i.removeCollidesWith(y.App.PhysicsGroupBedding),n)n==t.physics.getTouchingz1092ByType(y.z1044.z1047)&&n.addHamForUpdate(t)}var d=t.physics.rearBody,p=t.physics.middleBody;if(d.testCollidesWith(y.App.PhysicsGroupBedding)||p.testCollidesWith(y.App.PhysicsGroupBedding)){var l=t.physics.frontBody.body.position,u=z767.z4[0];if(u.x=l.x-o.x,u.y=l.y-o.y,u.z=l.z-o.z,u.normalize(),.707<BABYLON.Vector3.Dot(u,BABYLON.Axis.Y))if(d.removeCollidesWith(y.App.PhysicsGroupBedding),p.removeCollidesWith(y.App.PhysicsGroupBedding),n)n==t.physics.getTouchingz1092ByType(y.z1044.z1047)&&n.addHamForUpdate(t)}}}}},z524}(z767),t.z524=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z436(){return null!==t&&t.apply(this,arguments)||this}return __extends(z436,t),z436.prototype.update=function(t){t.currentObject&&t.currentObject.cage1&&(t.currentObject.cage1.isInside(t.position.x,t.position.y,t.position.z)?t.currentObject=t.currentObject.cage1:t.currentObject=t.currentObject.cage2)},z436}(z767),e.z436=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z372(){return null!==e&&e.apply(this,arguments)||this}return __extends(z372,e),z372.prototype.update=function(t){t.targets.otherz1062&&0<t.targets.otherz1062.walkForce&&e.prototype.update.call(this,t)},z372}(e.z369),e.z372=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z325(){return null!==t&&t.apply(this,arguments)||this}return __extends(z325,t),z325.prototype.update=function(t){for(var e=t.usingObject,o=e.hamsters.data,i=e.hamsters.length,n=t.physics.frontBody.body.position,s=e.position,a=y=(p=n.x-s.x)*p+(l=n.y-s.y)*l+(u=n.z-s.z)*u,r=t,c=0;c<i;c++){var d=o[c];if(d!=t&&t.currentObject==d.currentObject){var p,l,u,y,g=d.physics.frontBody.body.position;if((y=(p=g.x-s.x)*p+(l=g.y-s.y)*l+(u=g.z-s.z)*u)<a&&(r=d,a=y),!t.currentObject.isInBox(g.x,g.y,g.z))return void(t.targets.otherz1062=d)}}r!=t&&(t.targets.otherz1062=r)},z325}(z767),e.z325=o}(z0||(z0={})),function(x){var t,e;t=x.z156||(x.z156={}),e=function(t){function z248(){return null!==t&&t.apply(this,arguments)||this}return __extends(z248,t),z248.prototype.update=function(t){var e=t.path[t.pathIndex];if(t.id,e&&(!t.avoidingObject||t.avoidingObject.cage!=t.cage)){var o=t.targets.moveToTarget,i=t.targets.lookToTarget,n=t.targets.standToTarget;if(t.path[t.pathIndex+1]){var s=t.path[t.pathIndex+1];if(s.data.obj&&s.data.obj.accType==x.z1044.z1048){var a=s.data.obj,r=t.physics.headBody.body.position;a.isInside(r.x,r.y,r.z)||t.decrementPathIndex()}e=t.path[t.pathIndex+1]}i.x=e.x,i.y=e.y,i.z=e.z,n.x=i.x,n.y=i.y,n.z=i.z;var c=t.physics.frontBody.body.position,d=t.path[t.pathIndex],p=c.x-d.x,l=c.y-d.y,u=c.z-d.z,y=p*p+l*l+u*u,g=.85*t.size;if(y<g*g)t.incrementPathIndex(),d=t.path[t.pathIndex];else if(t.path[t.pathIndex+1])d=t.path[t.pathIndex+1],(p=c.x-d.x)*p+(l=c.y-d.y)*l+(u=c.z-d.z)*u<y&&(t.incrementPathIndex(),d=t.path[t.pathIndex]);else t.pathIndex,t.path.length;if(o.x=d.x,o.y=d.y,o.z=d.z,!d.data.obj.cage1&&d.data.obj!=t.currentObject){var m=o.x-c.x;if(o.y-c.y<0&&m<.3&&-.3<m&&(m<0?o.x-=.3:o.x+=.3),d.data.obj2&&d.data.obj2.accType==x.z1044.z1049){var f=d.data.obj2,A=t.path[t.pathIndex+1],b=t.path[t.pathIndex+2],v=f.body.shapes.holes;v&&0<v.length&&(A&&A.y<f.position.y||b&&b.y<f.position.y||(o.y-f.position.y<.1&&(o.y=f.position.y+.3,i.y=o.y,n.y=o.y),m<0?(o.z+=.5,i.z+=.5):(o.z-=.5,i.z-=.5),n.z=i.z))}}t.targets.pathTarget.copyFrom(t.targets.moveToTarget)}},z248}(z767),t.z248=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z228(){return null!==t&&t.apply(this,arguments)||this}return __extends(z228,t),z228.prototype.update=function(t){var e=t.physics.frontBody.onGroundShape,o=t.physics.middleBody.onGroundShape,i=t.physics.rearBody.onGroundShape,n=e||o||i;if(n){var s=n.rotation.elements;t.targets.upVecTarget.x=s[1],t.targets.upVecTarget.y=s[4],t.targets.upVecTarget.z=s[7]}},z228}(z767),e.z228=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z222(){return null!==t&&t.apply(this,arguments)||this}return __extends(z222,t),z222.prototype.update=function(t){for(var e=Math.max(t.pathIndex-1,0);e<Math.min(t.path.length,t.pathIndex+2);e++){var o=t.path[e];if(o.data.connector)return void(t.usingObject=o.data.connector)}},z222}(z767),e.z222=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z184(){return null!==t&&t.apply(this,arguments)||this}return __extends(z184,t),z184.prototype.update=function(t){if(t.usingObject){var e=t.physics.frontBody.body.position,o=t.usingObject.position,i=e.x-o.x,n=e.y-o.y,s=e.z-o.z,a=i*i+n*n+s*s,r=2*t.size;a<r*r&&t.forceTouchGround()}},z184}(z767),e.z184=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1006(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1006,t),z1006.prototype.test=function(t){var e=t.cage;if(e){var o=t.physics.middleBody.body.position,i=e.isInside(o.x,o.y,o.z);return!i}},z1006}(z770),e.z1006=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z995(){return null!==t&&t.apply(this,arguments)||this}return __extends(z995,t),z995.prototype.test=function(t){for(var e=Math.max(t.pathIndex-2,0);e<Math.min(t.path.length,t.pathIndex+2);e++){var o=t.path[e];if(o.data.obj.cage1)return o.data.obj!=t.usingObject}return!0},z995}(z770),e.z995=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z967(){return null!==t&&t.apply(this,arguments)||this}return __extends(z967,t),z967.prototype.test=function(t){var e=t.usingObject;if(e){var o=e.hamsters.data,i=e.hamsters.length,n=t.physics.headBody.body.position,s=t.physics.frontBody.body.position,a=e.position,r=(l=s.x-a.x)*l+(u=s.y-a.y)*u+(y=s.z-a.z)*y,c=t.currentObject;if(c){if(!c.isInBox(n.x,n.y,n.z))return!0;for(var d=0;d<i;d++){var p=o[d];if(p!=t&&t.currentObject==p.currentObject){var l,u,y,g=p.physics.frontBody.body.position;if((l=g.x-a.x)*l+(u=g.y-a.y)*u+(y=g.z-a.z)*y<r)return!1;if(!c.isInBox(g.x,g.y,g.z))return!1}}return!0}}},z967}(z770),e.z967=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z888(){return null!==t&&t.apply(this,arguments)||this}return __extends(z888,t),z888.prototype.test=function(t){var e=t.targets.otherz1062;return!e||e.usingObject!=t.usingObject},z888}(z770),e.z888=o}(z0||(z0={})),function(o){var t=function(e){function z128(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z406,o.z156.z318,o.z156.z466],t.updatez156=[o.z156.z315,o.z156.z599,o.z156.z622,o.z156.z524,o.z156.z362,o.z156.z532,o.z156.z461,o.z156.z248,o.z156.z586,o.z156.z457,o.z156.z560,o.z156.z590,o.z156.z214,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z379],t.exitz156=[],t.transitions=[{condition:o.z768.z967,falseNode:{state:o.z127}},{condition:o.z768.z860,trueNode:{condition:o.z768.z830,falseNode:{condition:o.z768.z1027,trueNode:{condition:o.z768.z932,trueNode:{state:o.z116,actions:[o.z156.z526,o.z156.z755]}}}}}],t}return __extends(z128,e),z128}(z49);o.z128=t}(z0||(z0={})),function(o){var t=function(e){function z127(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z759,o.z156.z743,o.z156.z494,o.z156.z404],t.updatez156=[o.z156.z567,o.z156.z599,o.z156.z325,o.z156.z362,o.z156.z228,o.z156.z461,o.z156.z630,o.z156.z446,o.z156.z369,o.z156.z590,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z379],t.exitz156=[],t.transitions=[{condition:o.z768.z888,trueNode:{state:o.z128,actions:[o.z156.z314]}},{condition:o.z768.z967,trueNode:{state:o.z128,actions:[o.z156.z314]}}],t}return __extends(z127,e),z127}(z49);o.z127=t}(z0||(z0={})),function(o){var t=function(e){function z126(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.historyLength=3,t.enterz156=[o.z156.z222,o.z156.z436,o.z156.z741],t.states=[o.z128,o.z127,o.z116],t.exitz156=[o.z156.z517,o.z156.z465,o.z156.z502,o.z156.z514],t.transitions=[{condition:o.z768.z995,trueNode:{state:o.z66}},{condition:o.z768.z1006,trueNode:{state:o.z66}},{condition:o.z768.z873,trueNode:{state:o.z65,actions:[]}},{condition:o.z768.z944,trueNode:{state:o.z108}}],t.initialState=o.z128,t}return __extends(z126,e),z126}(z49);o.z126=t}(z0||(z0={})),function(o){var t=function(e){function z125(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z759,o.z156.z743,o.z156.z494,o.z156.z404,o.z156.z222,o.z156.z741],t.updatez156=[o.z156.z599,o.z156.z325,o.z156.z461,o.z156.z362,o.z156.z630,o.z156.z446,o.z156.z372,o.z156.z590,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739],t.exitz156=[o.z156.z517],t.transitions=[{condition:o.z768.z888,trueNode:{previousState:!0}},{condition:o.z768.z967,trueNode:{previousState:!0}}],t}return __extends(z125,e),z125}(z49);o.z125=t}(z0||(z0={})),function(t){var e=function(n){function Cover(){var t=null!==n&&n.apply(this,arguments)||this;return t.shape=void 0,t.rotation=BABYLON.Vector3.Zero(),t.saveToDB=!1,t._enabled=!0,t}return __extends(Cover,n),Cover.getAllCoversAt=function(t,e,o,i,n){var s=Cover.activeObjects;if(0!=s.length){for(var a=.5*n,r=0;r<s.length;r++){var c=s[r],d=c.position.x-e,p=c.position.y-o,l=c.position.z-i;a<d||d<-a||a<p||p<-a||a<l||l<-a||t.push(c)}t.length}},Cover.getClosestCoversAt=function(t,e,o,i){var n=Cover.activeObjects;if(0!=n.length){for(var s=null,a=99999,r=.5*i,c=0;c<n.length;c++){var d=n[c],p=d.position.x-t,l=d.position.y-e,u=d.position.z-o;if(!(r<p||p<-r||r<l||l<-r||r<u||u<-r)){var y=p*p+l*l+u*u;y<a&&(a=y,s=d)}}return s}},Cover.prototype.init=function(t){if(n.prototype.init.call(this,t),this.shape||(this.shape=ObjectPool.get("cover_rg"+this.renderingGroupID,{renderingGroupID:this.renderingGroupID})),t.color){var e=t.color;this.setColor(e.r,e.g,e.b,e.a)}},Object.defineProperty(Cover.prototype,"enabled",{get:function(){return this._enabled},set:function(t){!(this._enabled=t)&&this.isOnScene?this.removeFromScene():t&&this.addToScene()},enumerable:!1,configurable:!0}),Cover.prototype.addToScene=function(){this.addToActiveObjects(),this.enabled&&(n.prototype.addToScene.call(this),this.shape.addToScene(),this.onChangeObservable.notifyObservers(this))},Cover.prototype.removeFromScene=function(){n.prototype.removeFromScene.call(this),this.shape.removeFromScene(),this.onChangeObservable.notifyObservers(this)},Cover.prototype.recycle=function(){this.enabled=!0,this.removeFromScene(),this.removeFromActiveObjects(),ObjectPool.recycle(this)},Cover.prototype.setPosition=function(t,e,o,i){n.prototype.setPosition.call(this,t,e,o,i),this.shape.setPosition(t,e,o)},Cover.prototype.setRotation=function(t,e,o){n.prototype.setRotation.call(this,t,e,o),this.shape.setRotation(t,e,o)},Cover.prototype.addToActiveObjects=function(){-1==Cover.activeObjects.indexOf(this)&&Cover.activeObjects.push(this)},Cover.prototype.removeFromActiveObjects=function(){var t=Cover.activeObjects.indexOf(this);-1!=t&&Cover.activeObjects.splice(t,1)},Cover.prototype.setColor=function(t,e,o,i){n.prototype.setColor.call(this,t,e,o),this.shape.setColor(t,e,o)},Cover.activeObjects=[],Cover}(t.z1092);t.Cover=e}(z0||(z0={})),function(e){var t=function(){function CoverConfig(){this.maxObjects=0}return CoverConfig.prototype.initObjectPool=function(t){ObjectPool.addClass("Cover",e.Cover),ObjectPool.addClass("cover_rg0",z1070,{meshName:"cover_rg0"}),ObjectPool.addClass("cover_rg1",z1068,{shapeName:"Cover"})},CoverConfig.prototype.getSceneFileNames=function(t){},CoverConfig.prototype.getSPSData=function(t){},CoverConfig.prototype.getCreateMeshFunctions=function(t){t.cover_rg0=this._createMeshes},CoverConfig.prototype._createMeshes=function(t,e,o){var i=z3.GetMesh("cover");(i=i.clone("cover_rg0")).makeGeometryUnique(),i.material=o.default0,i.position.x=0,i.position.y=0,i.position.z=0,i.thinInstanceRegisterAttribute("color",4);var n=i.thinInstanceAddSelf(!1);z1070.MatrixOffScene.setTranslationFromFloats(999,999,999),i.thinInstanceSetMatrixAt(n,z1070.MatrixOffScene,!0),e.cover_rg0=i},CoverConfig.prototype.getTextureDrawFunctions=function(t){},CoverConfig}();e.App.AddEntityConfig(new t)}(z0||(z0={})),function(e){var t=function(t){function TubeCover(){return null!==t&&t.apply(this,arguments)||this}return __extends(TubeCover,t),TubeCover.prototype.recycle=function(){this.tube=null,t.prototype.recycle.call(this)},TubeCover.prototype.addToActiveObjects=function(){-1==TubeCover.activeObjects.indexOf(this)&&(TubeCover.activeObjects.push(this),e.Cover.activeObjects.push(this))},TubeCover.prototype.removeFromActiveObjects=function(){var t;-1!=(t=TubeCover.activeObjects.indexOf(this))&&TubeCover.activeObjects.splice(t,1),-1!=(t=e.Cover.activeObjects.indexOf(this))&&e.Cover.activeObjects.splice(t,1)},TubeCover.activeObjects=[],TubeCover}(e.Cover);e.TubeCover=t}(z0||(z0={})),function(e){var t=function(){function TubeCoverConfig(){this.maxObjects=0}return TubeCoverConfig.prototype.initObjectPool=function(t){ObjectPool.addClass("TubeCover",e.TubeCover)},TubeCoverConfig.prototype.getSPSData=function(t){},TubeCoverConfig}();e.App.AddEntityConfig(new t)}(z0||(z0={})),function(z){var t=function(x){function House(t){var e=x.call(this)||this;return e.accType=z.z1044.z1055,e.food=[],e.centerGraphNode=new GraphNode(0,0,0),e.nodes=[],e.holes=[],e.pubsub=new Pubsub,e.num=0,e.world=void 0,e.body=void 0,e.boxSize=0,e.floorY=0,e.initPosZ=1.5,e.rotation=BABYLON.Vector3.Zero(),e.connectors=[],e.worldMatrix=BABYLON.Matrix.Identity(),e.invWorldMatrix=BABYLON.Matrix.Identity(),e.floorThickness=0,e.shapes=void 0,e.hitHeight=null,e.hitOffsetY=0,e.targetPosition=BABYLON.Vector3.Zero(),e._tempColorHSL={h:0,s:0,l:0},e._tempColor3=BABYLON.Color3.White(),e.maxz1062s=3,e.hamsters=new z1072,House.count++,e.num=House.count,e.position=BABYLON.Vector3.Zero(),e.scaling=new BABYLON.Vector3(1,1,1),e.placementType=z.PlacementType.GRID|z.PlacementType.z1048|z.PlacementType.BACK|z.PlacementType.ALIGN_BOTTOM,e}return __extends(House,x),House.prototype.getWorldMatrix=function(){return this.worldMatrix},House.prototype.addToActiveObjects=function(){-1==House.activeObjects.indexOf(this)&&House.activeObjects.push(this)},House.prototype.removeFromActiveObjects=function(){var t=House.activeObjects.indexOf(this);-1!=t&&House.activeObjects.splice(t,1)},House.prototype.init=function(t){x.prototype.init.call(this,t),this.shapeName=t.shapeName,this.canRotate=!1,this.canTranslate=!0,this.canDelete=!0,this.world=t.world,this.addToActiveObjects();this.width,this.depth;var e=this.height;t.width&&(t.width,this.width=t.width),t.depth&&(t.depth,this.depth=t.depth),t.height&&(e=t.height,this.height=t.height),this.mapPlacementInfo||(this.mapPlacementInfo=new z.MapPlacementInfo({mapPlacementSizeX:.25,offsetDragFromMenuY:-.5})),this.controlAnchor||this.addControlAnchor(),this.controlPositionLocal.x=0,this.controlPositionLocal.y=.5*this.height-.1,this.controlPositionLocal.z=.5*-this.depth;var o=0,i=0,n=this.initPosZ;if(null!=t.x&&(o=t.x),null!=t.y&&(i=t.y),this.floorY=i,t.isMenuItem&&t.isMenuItem,this.floorY+=this.floorThickness,t.isMenuItem)this.controlPositionLocal.y=this.height;else if(!this.body){var s=this.width-.01,a=this.height-.01,r=0;t.hitWidth&&(s=t.hitWidth),t.hitHeight&&(a=t.hitHeight),t.hitOffsetY&&(r=t.hitOffsetY),this.hitHeight=a,this.hitOffsetY=r,this.hitMeshes=[];var c=z.app.graphicsHelper.getHitMesh(s,a,this.depth,!1);c.rotationQuaternion=BABYLON.Quaternion.Identity(),this.hitMeshes.push(c);var d=[1,.4,.2,z.App.z1033,4294967295],p="holey_box";if(t.bodyType&&(p=t.bodyType),"holey_sphere"==p){var l=.5*this.width;t.radius&&(l=t.radius),this.body=new OIMO.Body({holes:[],size:[l],pos:[0,.5*e,0],rot:[0,0,0],world:this.world,config:d,type:"holey_sphere"}).body,this.body.shapes.wallThickness=.1}else this.body=new OIMO.Body({holes:[],size:[this.width-.2,e,this.depth-.2],pos:[0,.5*e,0],rot:[0,0,0],world:this.world,config:d,type:"holey_box"}).body;this.body.shapes.floorThickness=.05;var u=[];if(t.holes)for(var y=0;y<t.holes.length;y++){var g=t.holes[y];u.push(new OIMO.Hole(g.x,g.y,g.z,g.radius,g.xside,g.yside,g.zside))}this.holes=u;var m=this.nodes;for(u=this.holes,y=0;y<u.length;y++){g=u[y];this.body.shapes.addHole(g);var f=Math.sqrt(g.x*g.x+g.y*g.y+g.z*g.z);f*=3;var A=new GraphNode(g.xside,g.yside,g.zside);A.addConnection(this.centerGraphNode,f),this.centerGraphNode.addConnection(A,f),A.data.obj=this,A.data.enterEvent=z.HouseEvents.ENTER,A.data.hole=g,m.push(A),z.app.graph.addNode(A);var b=new GraphNode(g.xside,g.yside,g.zside);b.data.obj=this;f=.2,A.addConnection(b,f),b.addConnection(A,f),m.push(b),z.app.graph.addNode(b);var v=ObjectPool.get(z.ConnectorHidden.name,{pathNodeTop:A,world:this.world});v.setPosition(this.position.x+g.x,this.position.y+g.y+.5*this.height,this.position.z+g.z),v.setRotation(.5*Math.PI,0,0),this.connectors.push(v)}this.centerGraphNode.data.obj=this,z.app.graph.addNode(this.centerGraphNode)}if(this.shapes||(this.shapes=[],this.shapes[0]=ObjectPool.get(this.shapeName+"_inside",{name:this.shapeName+"_inside",renderingGroupID:this.renderingGroupID})),this._initColors(),t.skipAddToScene)this.removeFromScene();else{if(this.setPosition(o,i,n),this.addToScene(),this.isMenuItem||this.cage||(this.cage=z.Cage.getCageAt(this.position.x,this.position.y+.5*this.height,this.position.z)),!this.cage)return;this.cage.isReady?this.addToObject(this.cage):this.cage.pubsub.subscribe("ready",this.addToObject,this)}},House.prototype.refreshConnections=function(){this.disconnect(),this.updateNodes()},House.prototype.updateNodes=function(){var t=this.centerGraphNode,e=this.position.x,o=this.position.y,i=this.position.z;t.x=e,t.y=o+.4,t.z=i;for(var n=this.body.rotation.elements,s=this.nodes,a=this.holes,r=0;r<a.length;r++){var c=a[r],d=s[r],p=s[r+1],l=.05,u=c.x+c.xside*l,y=c.y+c.yside*l,g=c.z+c.zside*l,m=u*n[0]+y*n[1]+g*n[2]+e,f=u*n[3]+y*n[4]+g*n[5]+o,A=u*n[6]+y*n[7]+g*n[8]+i;d.x=m,d.y=f+.5*this.height,d.z=A,l=.2,u=c.x+c.xside*l,y=c.y+c.yside*l,g=c.z+c.zside*l;m=u*n[0]+y*n[1]+g*n[2]+e,f=u*n[3]+y*n[4]+g*n[5]+o,A=u*n[6]+y*n[7]+g*n[8]+i;p.x=m,p.y=f+.5*this.height,p.z=A,d.data.enterNextNode=this.centerGraphNode,d.data.enterEvent=z.HouseEvents.ENTER}var b=House.tempVecs[0];for(r=0;r<a.length;r++){p=s[r+1];var v=(c=this.holes[r]).xside,x=c.yside,C=c.zside;if(b.x=v*n[0]+x*n[1]+C*n[2],b.y=v*n[3]+x*n[4]+C*n[5],b.z=v*n[6]+x*n[7]+C*n[8],!this.cage)return;var S=House.tempArr;S.length=0;var T=this.cage.getPlatformUnder(p.x,p.y,p.z),B=null;T&&Math.abs(this.position.y-T.position.y)<.1&&(B=z.z1044.z1049),this.cage.getGraphNodesAtToRef(S,p.x,p.y,p.z,null,null,null,null,.75,B);for(r=0;r<S.length;r++){var O=S[r],P=O.x-p.x,M=O.y-p.y,I=O.z-p.z,N=Math.sqrt(P*P+M*M+I*I);p.addConnection(O,N),O.addConnection(p,N)}}},House.prototype.setPositionOnMapFromDrop=function(t,e,o,i){var n;x.prototype.setPositionOnMapFromDrop.call(this,t,e,o),i&&null!=i.dragPlatformY&&(n=i.dragPlatformY+.03),this.setToFloor(e,n)},House.prototype.setHitMesh=function(t,e,o){if(this.hitMeshes&&this.hitMeshes[0]){var i=this.hitMeshes[0];i.position.x=t,this.hitHeight?i.position.y=e+.5*this.hitHeight+this.hitOffsetY:i.position.y=e+.5*this.height+this.hitOffsetY,i.position.z=o,i.computeWorldMatrix()}},House.prototype.setPositionDrag=function(t,e,o,i){var n=t-this.position.x,s=e-this.position.y,a=o-this.position.z;x.prototype.setPositionDrag.call(this,t,e,o,i),i&&this.updateCage(),this.floorY=e+this.floorThickness;var r=z.app.pointerDownPosition.x,c=z.app.pointerDownPosition.y,d=z.app.pointerDownPosition.z;if(this.isInside(r,c,d)&&(z.app.pointerDownPosition.x+=n,z.app.pointerDownPosition.y+=s,z.app.pointerDownPosition.z+=a),this._translatez1062s(n,s,a),this.food)for(var p=0;p<this.food.length;p++){this.food[p].translate(n,s,a)}if(this.body){var l=this.body.position,u=this.position;l.x=u.x,l.y=u.y+.5*this.height,l.z=u.z;var y=this.body.shapes.position;y.x=u.x,y.y=u.y+.5*this.height,y.z=u.z,this.body.shapes.updateProxy()}this.setHitMesh(t,e,o);var g=this.holes[0],m=this.connectors[0];g&&(m.setPosition(this.position.x+g.x,this.position.y+g.y+.5*this.height,this.position.z+g.z),m.setRotation(.5*Math.PI,0,0)),this.navigator&&this.navigator.setPosition(t,e,o);for(p=0;p<this.shapes.length;p++)this.shapes[p].setPosition(t,e,o);this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position)},House.prototype.updateCage=function(){var t=z.Cage.getCageAt(this.position.x,this.position.y+.5*this.height,this.position.z);this.addToObject(t)},House.prototype.getFloorY=function(t,e,o){var i=e,n=this.cage;if(n||(n=z.Cage.getCageAt(t,e+.5*this.height,o)),n){i=n.position.y;var s=n.getPlatformUnder(t,e,o);if(s&&s.position.y>=i&&(i=s.position.y+.01),n.bedding){var a=n.getMinYBetween(t-.75*this.width,t+.75*this.width);if(i<a){i=a;var r=n.getPlatformAbove(t,i,o);if(r){var c=0;r.position.y<i+this.height+c&&(i=r.position.y-this.height-c)}}if(!s){c=.1;n.top<i+this.height+c&&(i=n.top-this.height-c);var d=n.position.y+n.height-n.wallThickness-this.height;d<i&&(i=d)}}}return i},House.prototype.setToFloor=function(t,e){var o=this.position.x,i=this.position.z,n=this.getFloorY(o,t,i);if(null!=e&&n<e&&(n=e),n!=this.position.y){if(this.cage){var s=this.cage.getPlatformAbove(o,n,i);if(s){if(n+this.height>s.position.y-.03){var a=s.position.y-this.height-.03;a>=this.cage.position.y&&(n=a)}}}this.setPosition(o,n,i)}},House.prototype.setPosition=function(t,e,o,i){void 0===i&&(i=!1);var n=e,s=this.position.x,a=this.position.y,r=this.position.z;this.position.x=t,this.position.y=e,this.position.z=o,this.isMenuItem||this.cage||this.updateCage();var c=t-s,d=n-a,p=o-r;this.position.x=t,this.position.y=n,this.position.z=o,this.floorY=n+this.floorThickness,this._translateNodes(c,d,p),this._translatez1062s(c,d,p),this.setHitMesh(t,n,o);for(var l=0;l<this.shapes.length;l++)this.shapes[l].setPosition(t,e,o);if(this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position),!i&&this.body){var u=this.body.position,y=this.position;u.x=y.x,u.y=y.y+.5*this.height,u.z=y.z,this.body.syncShapes(),this.disconnect();var g=z.Cage.getCageAt(t,n+.1,o);g!=this.cage?(this.cage&&this.cage.removeObject(this),g&&this.addToObject(g)):this.updateNodes()}this.navigator&&this.navigator.setPosition(t,n,o),this._connected=!0,this.worldMatrix.setTranslation(this.position),this.worldMatrix.invertToRef(this.invWorldMatrix);var m=this.holes[0],f=this.connectors[0];m&&(f.setPosition(this.position.x+m.x,this.position.y+m.y+.5*this.height,this.position.z+m.z),f.setRotation(.5*Math.PI,0,0)),this.isMenuItem||(this.targetPosition.x=t,this.targetPosition.y=e+.1,this.targetPosition.z=o+this.body.shapes.halfDepth),this.onChangeObservable.notifyObservers(this)},House.prototype.setRotation=function(t,e,o){this.rotation.x=t,this.rotation.y=e,this.rotation.z=o;var i=House.tempBabQuats[0],n=House.tempBabQuats[1];n.copyFrom(this.rotationQuaternion),n.x*=-1,n.y*=-1,n.z*=-1,BABYLON.Quaternion.RotationYawPitchRollToRef(e,t,o,this.rotationQuaternion),this.rotationQuaternion.multiplyToRef(n,i),this.hitMeshes&&this.hitMeshes[0].rotationQuaternion.copyFrom(this.rotationQuaternion),this.body&&this.setBodyRotationQuaternion(this.rotationQuaternion),this.rotationQuaternion.toRotationMatrix(this.worldMatrix),this.worldMatrix.setTranslation(this.position),this.worldMatrix.invertToRef(this.invWorldMatrix),this.onChangeObservable.notifyObservers(this)},House.prototype.rotate=function(t){void 0===t&&(t=.5*Math.PI),t<0&&(t*=-1),this.setRotation(this.rotation.x,this.rotation.y+t,this.rotation.z),this.disconnect(),this.updateNodes()},House.prototype._translateNodes=function(t,e,o){for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i];n.x+=t,n.y+=e,n.z+=o}},House.prototype._translatez1062s=function(t,e,o){for(var i,n=z.z1062.activeObjects,s=0;s<n.length;s++)!(i=n[s]).currentObject||i.currentObject!=this&&i.currentObject.parent!=this||i.translate(t,e,o)},House.prototype.isInside=function(t,e,o,i){void 0===i&&(i=0);var n=this.body,s=n.position,a=z1.roundToDecimalPlace(t-s.x,3),r=z1.roundToDecimalPlace(e-s.y,3),c=z1.roundToDecimalPlace(o-s.z,3);if(this.width!=this.depth&&0!=this.rotation.y){var d=House.z4[0];d.x=t,d.y=e,d.z=o,BABYLON.Vector3.TransformCoordinatesToRef(d,this.invWorldMatrix,d),a=d.x,r=d.y-.5*this.height,c=d.z}var p=n.shapes.halfWidth+i,l=.5*this.height+i,u=n.shapes.halfDepth+i;return a<=p&&-p<=a&&r<=l&&-l<=r&&c<=u&&-u<=c},House.prototype.isInBox=function(t,e,o,i){return this.isInside(t,e,o,i)},House.prototype.getGraphNodeAt=function(t,e,o,i,n,s){return void 0===i&&(i=!1),void 0===n&&(n=null),void 0===s&&(s=0),this.centerGraphNode},House.prototype.addToScene=function(){if(!this.isOnScene){if(x.prototype.addToScene.call(this),this.navigator&&this.navigator.enable(),this.body&&!this.body.parent&&this.world.addRigidBody(this.body),this.connectors)for(var t=0;t<this.connectors.length;t++)this.connectors[t].addToScene();for(t=0;t<this.shapes.length;t++)this.shapes[t].addToScene()}},House.prototype.removeFromScene=function(){if(this.isOnScene){for(this.body&&this.body.shapes&&10==this.body.shapes.id&&(this.body.position,this.body.shapes.position),this.navigator&&this.navigator.disable(),x.prototype.removeFromScene.call(this),this.body&&this.body.parent&&(this.body.position.y=9999,this.body.shapes.updateProxy(),this.body.shapes.position.y=this.body.position.y,this.world.removeRigidBody(this.body));this.food.length;){this.food[0].recycle()}if(this.connectors)for(var t=0;t<this.connectors.length;t++)this.connectors[t].removeFromScene();for(t=0;t<this.shapes.length;t++)this.shapes[t].removeFromScene()}},House.prototype.recycle=function(){this.setPosition(9999,9999,9999),this.hamsters.length=0,this.hamsters.clean(),x.prototype.recycle.call(this)},House.prototype.disconnect=function(){if(this.body)for(var t=this.nodes,e=(t.length,this.holes),o=0;o<e.length;o++)for(var i=t[o],n=t[o+1],s=0;s<n.connections.length;s++){var a=n.connections[s];a.data.obj==n.data.obj&&a.data.obj2==n.data.obj2||a!=i&&(n.removeConnection(a),a.removeConnection(n),s--)}},House.prototype.onAfterDisconnect=function(t){},House.prototype.recycleHoles=function(){for(var t=this.body.shapes.holes,e=0;e<t.length;e++)ObjectPool.recycle(t[e]);t.length=0},House.prototype.setColor=function(t,e,o,i){if(x.prototype.setColor.call(this,t,e,o,i),""==i){var n=this._tempColorHSL,c3=this._tempColor3;z.z1073.setHSLFromColor3(this.color,n),n.l*=.8,z.z1073.setColor3FromHSL(n.h,n.s,n.l,c3),this.shapes[0].setColor(c3.r,c3.g,c3.b)}},House.prototype.removeFood=function(t){var e=this.food.indexOf(t);-1!=e&&this.food.splice(e,1)},House.prototype.addFood=function(t){this.food.push(t)},House.prototype.getNeighborAt=function(t,e,o){for(var i,n=this.position.x,s=this.position.y+.5*this.height,a=this.position.z,r=this.nodes,c=t-n,d=e-s,p=0;p<r.length;p++){var l=r[p],u=l.x-n,y=l.y-s,g=l.z-a;if(!(.3<g||g<-.3)&&(!(c<0&&0<u)&&!(0<c&&u<0)&&!(d<0&&0<y)&&!(0<d&&y<0)&&(i=z.z1092.GetObjConnectedToNodeAt(l,t,e,o))))return i}},House.prototype.getProps=function(){return x.prototype.getProps.call(this)},House.prototype.getCenterAtPosToRef=function(t,e,o,i){i.x=t,i.y=e+.5*this.height,i.z=o},House.prototype.getPositionOnMapFromDropToRef=function(t,e,o,i){var n=this.mapPlacementInfo;t=1*z1.round((t+n.mapOffsetDropTargetX)/1,n.mapPlacementSizeX)+n.mapOffsetX,e=1*z1.round((e+n.mapOffsetDropTargetY)/1,n.mapPlacementSizeY)+n.mapOffsetY,o=this.initPosZ;var s=this.hitMeshes[0].getBoundingInfo(),a=s.boundingBox.maximum.x,r=s.boundingBox.maximum.y,c=z.Cage.getCageAt(t,e,o);if(c){var d=c.position,p=d.x-.5*c.width,l=d.x+.5*c.width,u=d.y+c.height,y=c.floorY,g=t+a,m=e-r;t-a<p?t=p+a:l<g&&(t=l-a),u<e+r?e=u-r:m<y&&(e=y+r)}i.x=t,i.y=e,i.z=o},House.prototype.isValidDropLocation=function(t,e,o,i){var n=this._tempDropLoc;this.getPositionOnMapFromDropToRef(t,e,o,n);var s=z.Cage.getCageAt(n.x,n.y,n.z);if(!s)return!1;var a=s.position.y,r=s.getPlatformUnder(n.x,n.y,n.z);if(r&&(a=r.position.y),i&&i.dragPlatformY&&(a=i.dragPlatformY),s.bedding){var c=s.getHeightAt(n.x,n.z);a<c&&(a=c);var d=s.getPlatformAbove(n.x,n.y,n.z);if(d){var p=this.height+.1;p=Math.min(d.position.y-s.position.y,p),d.position.y-c<p&&(a=d.position.y-p)}else{a+this.height>s.top&&(a=s.top-this.height,r||(a-=.05))}}if(.001<a+this.height+s.wallThickness-s.top)return!1;var l=this.hitMeshes[0],u=l.position.x,y=l.position.y,g=l.position.z;this.setHitMesh(n.x,a,n.z);var m=this.intersectsAccesories(s.objs,z.z1044.z1055|z.z1044.z1054|z.z1044.z1049);return l.position.x=u,l.position.y=y,l.position.z=g,l.computeWorldMatrix(),!m},House.prototype.addToObject=function(t){this.cage&&this.cage!=t&&this.cage.removeObject(this),this.parent=t,(this.cage=t)&&(this.disconnect(),this.updateNodes(),t.bedding,t.addObject(this))},House.prototype.addz1062=function(t){-1===this.hamsters.indexOf(t)&&this.hamsters.push(t)},House.prototype.removez1062=function(t){this.hamsters.remove(t)},House.prototype.isFull=function(){if(this.hamsters.length>=this.maxz1062s)return!0},House.tempVecs=[new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3],House.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],House.tempArr=[],House.count=0,House.activeObjects=[],House}(z.z1092);z.House=t}(z0||(z0={})),function(t){var e=function(t){function House1(){return null!==t&&t.apply(this,arguments)||this}return __extends(House1,t),House1.count=0,House1}(t.House);t.House1=e}(z0||(z0={})),function(o){!function(){function House1Config(){this.maxObjects=5,o.House1.objectCount=this.maxObjects}House1Config.prototype.initObjectPool=function(t){var e=[];e.push(new OIMO.Hole(0,0,-.5,.25,0,0,-1)),ObjectPool.addClass("House1",o.House1,{world:t,height:1,width:1,depth:1,holes:e,shapeName:"House1"}),ObjectPool.addClass("House1_inside",z1068)},House1Config.prototype.getSPSData=function(t){t.push({shapeName:"House1",meshName:"house1",numInstances:this.maxObjects,maxInstances:this.maxObjects}),t.push({shapeName:"House1_inside",meshName:"house1_inside",numInstances:this.maxObjects,maxInstances:this.maxObjects}),t.push({shapeName:"House1",meshName:"house1_button",numInstances:this.maxObjects,maxInstances:this.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:"House1",meshName:"house1",numInstances:1,maxInstances:1,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:"House1_inside",meshName:"house1_inside",numInstances:1,maxInstances:1,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:"House1",meshName:"HouseMenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:o.App.menuRenderingGroupID})},House1Config.prototype.getz1064Items=function(t){t.push(new o.MenuItemInfo({id:"House1",objectName:"House1",category:"Houses",order:0,menuHeight:1.3,menuWidth:1.3,offsetY:-.5}))}}()}(z0||(z0={})),function(a){var t=function(s){function House2(t){var e=s.call(this,t)||this;return e._colors={},e._colors.house=new BABYLON.Color3,e._colors.roof=new BABYLON.Color3,a.z1073.SetColor3FromHex("#AF5719",e._colors.house),a.z1073.SetColor3FromHex("#00C700",e._colors.roof),e}return __extends(House2,s),House2.prototype.init=function(t){if(s.prototype.init.call(this,t),1==this.shapes.length){this.shapes[1]=ObjectPool.get(this.shapeName+"_roof",{name:this.shapeName+"_roof",renderingGroupID:this.renderingGroupID}),this.shapes[1].setPosition(this.position.x,this.position.y,this.position.z);var e=this._colors.roof;this.shapes[1].setColor(e.r,e.g,e.b)}},House2.prototype.setColor=function(t,e,o,i){if(s.prototype.setColor.call(this,t,e,o,i),"house"==i){this.color.r=t,this.color.g=e,this.color.b=o;var n=this._tempColorHSL,c3=this._tempColor3;a.z1073.setHSLFromColor3(this.color,n),n.l*=.8,a.z1073.setColor3FromHSL(n.h,n.s,n.l,c3),this.shapes[0].setColor(c3.r,c3.g,c3.b)}else if("roof"==i){if(!this.shapes[1])return;this.shapes[1].setColor(t,e,o)}},House2.count=0,House2}(a.House);a.House2=t}(z0||(z0={})),function(o){var t=function(){function House2Config(){this.maxObjects=5,this.objName="h2",o.House2.objectCount=this.maxObjects}return House2Config.prototype.initObjectPool=function(t){var e=[];e.push(new OIMO.Hole(0,-.1,-.5,.25,0,0,-1)),ObjectPool.addClass(this.objName,o.House2,{world:t,height:1.2,width:1,depth:1,holes:e,shapeName:this.objName,hitWidth:1.46,hitHeight:1.2,hitOffsetY:.03}),ObjectPool.addClass(this.objName+"_inside",z1068),ObjectPool.addClass(this.objName+"_roof",z1068)},House2Config.prototype.getSceneFileNames=function(t){},House2Config.prototype.getChildSPSData=function(t){t[this.objName]||(t[this.objName]={}),t[this.objName][this.objName+"_inside"]=1,t[this.objName][this.objName+"_roof"]=1,t[this.objName][this.objName+"_button"]=1},House2Config.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"house2",numInstances:this.maxObjects,maxInstances:this.maxObjects}),t.push({shapeName:this.objName+"_inside",meshName:"house2_inside",numInstances:this.maxObjects,maxInstances:this.maxObjects}),t.push({shapeName:this.objName+"_roof",meshName:"house2_roof",numInstances:this.maxObjects,maxInstances:this.maxObjects}),t.push({shapeName:this.objName,meshName:"house2_button",numInstances:this.maxObjects,maxInstances:this.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName,meshName:"house2",numInstances:1,maxInstances:1,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName+"_inside",meshName:"house2_inside",numInstances:1,maxInstances:1,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName+"_roof",meshName:"house2_roof",numInstances:1,maxInstances:1,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"HouseMenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:o.App.menuRenderingGroupID})},House2Config.prototype.getTextureDrawFunctions=function(t){},House2Config.prototype.getz1064Items=function(t){t.push(new o.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Houses",order:0,menuHeight:1.3,menuWidth:1.3,offsetY:-.5}))},House2Config.prototype.getz49s=function(t){},House2Config.prototype.getListenerSetups=function(t){},House2Config}();o.App.AddEntityConfig(new t)}(z0||(z0={})),function(a){var t=function(s){function House3(t){var e=s.call(this,t)||this;return e._colors={},e._colors.house=new BABYLON.Color3(0,1,0),e}return __extends(House3,s),House3.prototype.init=function(t){s.prototype.init.call(this,t)},House3.prototype.setColor=function(t,e,o,i){if(s.prototype.setColor.call(this,t,e,o,i),"house"==i){this.color.r=t,this.color.g=e,this.color.b=o;var n=this._tempColorHSL,c3=this._tempColor3;a.z1073.setHSLFromColor3(this.color,n),n.l*=.8,a.z1073.setColor3FromHSL(n.h,n.s,n.l,c3),this.shapes[0].setColor(c3.r,c3.g,c3.b)}},House3.count=0,House3}(a.House);a.House3=t}(z0||(z0={})),function(o){var t=function(){function House3Config(){this.maxObjects=5,this.objName="h3",o.House3.objectCount=this.maxObjects}return House3Config.prototype.initObjectPool=function(t){var e=[];e.push(new OIMO.Hole(0,-.09,-.5,.25,0,0,-1)),ObjectPool.addClass(this.objName,o.House3,{world:t,height:.95,width:1,depth:1,hitHeight:.9,hitOffsetY:.05,holes:e,shapeName:this.objName}),ObjectPool.addClass(this.objName+"_inside",z1068)},House3Config.prototype.getSceneFileNames=function(t){},House3Config.prototype.getChildSPSData=function(t){t[this.objName]||(t[this.objName]={}),t[this.objName][this.objName+"_inside"]=1,t[this.objName][this.objName+"_button"]=1},House3Config.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"house3",numInstances:this.maxObjects,maxInstances:this.maxObjects}),t.push({shapeName:this.objName+"_inside",meshName:"house3_inside",numInstances:this.maxObjects,maxInstances:this.maxObjects}),t.push({shapeName:this.objName,meshName:"house3_button",numInstances:this.maxObjects,maxInstances:this.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName,meshName:"house3",numInstances:1,maxInstances:1,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName+"_inside",meshName:"house3_inside",numInstances:1,maxInstances:1,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"HouseMenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:o.App.menuRenderingGroupID})},House3Config.prototype.getTextureDrawFunctions=function(t){},House3Config.prototype.getz1064Items=function(t){t.push(new o.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Houses",order:0,menuHeight:1.3,menuWidth:1.3,offsetY:-.5}))},House3Config.prototype.getz49s=function(t){},House3Config.prototype.getListenerSetups=function(t){},House3Config}();o.App.AddEntityConfig(new t)}(z0||(z0={})),function(a){var t=function(s){function House4(t){var e=s.call(this,t)||this;return e._colors={},e._colors.house=new BABYLON.Color3(1,1,0),e}return __extends(House4,s),House4.prototype.init=function(t){s.prototype.init.call(this,t),1==this.shapes.length&&(this.shapes[1]=ObjectPool.get(this.shapeName+"_ears",{name:this.shapeName+"_ears",renderingGroupID:this.renderingGroupID}),this.shapes[1].setPosition(this.position.x,this.position.y,this.position.z),this.shapes[1].setColor(this.color.r,this.color.g,this.color.b))},House4.prototype.setColor=function(t,e,o,i){if(s.prototype.setColor.call(this,t,e,o,i),"house"==i){this.shapes[1]&&this.shapes[1].setColor(t,e,o),this.color.r=t,this.color.g=e,this.color.b=o;var n=this._tempColorHSL,c3=this._tempColor3;a.z1073.setHSLFromColor3(this.color,n),n.l*=.8,a.z1073.setColor3FromHSL(n.h,n.s,n.l,c3),this.shapes[0].setColor(c3.r,c3.g,c3.b)}},House4.count=0,House4}(a.House);a.House4=t}(z0||(z0={})),function(o){var t=function(){function House4Config(){this.maxObjects=5,this.objName="h4",o.House4.objectCount=this.maxObjects}return House4Config.prototype.initObjectPool=function(t){var e=[];e.push(new OIMO.Hole(0,-.09,-.5,.25,0,0,-1)),ObjectPool.addClass(this.objName,o.House4,{world:t,height:1,width:1,depth:1,radius:.55,holes:e,shapeName:this.objName,hitHeight:1.04,hitOffsetY:.02,bodyType:"holey_sphere"}),ObjectPool.addClass(this.objName+"_inside",z1068),ObjectPool.addClass(this.objName+"_ears",z1068)},House4Config.prototype.getChildSPSData=function(t){t[this.objName]||(t[this.objName]={}),t[this.objName][this.objName+"_inside"]=1,t[this.objName][this.objName+"_ears"]=1,t[this.objName][this.objName+"_button"]=1},House4Config.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"house4",numInstances:this.maxObjects,maxInstances:this.maxObjects}),t.push({shapeName:this.objName+"_inside",meshName:"house4_inside",numInstances:this.maxObjects,maxInstances:this.maxObjects}),t.push({shapeName:this.objName+"_ears",meshName:"house4_ears",numInstances:this.maxObjects,maxInstances:this.maxObjects}),t.push({shapeName:this.objName,meshName:"house4_button",numInstances:this.maxObjects,maxInstances:this.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName,meshName:"house4",numInstances:1,maxInstances:1,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName+"_inside",meshName:"house4_inside",numInstances:1,maxInstances:1,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName+"_ears",meshName:"house4_ears",numInstances:1,maxInstances:1,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"HouseMenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:o.App.menuRenderingGroupID})},House4Config.prototype.getTextureDrawFunctions=function(t){},House4Config.prototype.getz1064Items=function(t){t.push(new o.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Houses",order:0,menuHeight:1.3,menuWidth:1.3,offsetY:-.5}))},House4Config.prototype.getz49s=function(t){},House4Config.prototype.getListenerSetups=function(t){},House4Config}();o.App.AddEntityConfig(new t)}(z0||(z0={})),function(e){var t=function(){function HouseConfig(){}return HouseConfig.prototype.getSceneFileNames=function(t){},HouseConfig.prototype.getCreateMeshFunctions=function(t){t.HouseMenuButton=this._createMeshes},HouseConfig.prototype._createMeshes=function(t,e){var o=BABYLON.MeshBuilder.CreatePlane("HouseMenuButton",{width:1,height:1},t);t.removeMesh(o),o.position.y=.5,o.bakeCurrentTransformIntoVertices(),e.HouseMenuButton=o},HouseConfig.prototype.getz49s=function(t){t.push(e.z80)},HouseConfig.prototype.getListenerSetups=function(t){t.push({event:e.HouseEvents.ENTER,state:e.z80})},HouseConfig}();e.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(){function HouseEvents(){}return HouseEvents.ENTER=t.AppEvents.GetUniqueID(),HouseEvents}();t.HouseEvents=e}(z0||(z0={})),function(s){var t=function(e){function HouseNavigator(){var t=null!==e&&e.apply(this,arguments)||this;return t.localPosition=BABYLON.Vector3.Zero(),t.pivotRadius=0,t._enabled=!0,t.updated=new z1072Set,t}return __extends(HouseNavigator,e),HouseNavigator.prototype.init=function(t){this.accessory=t.accessory;var e=this.accessory,o=e.shapeName+e.num;if(!this.triggerArea){this.world=e.world;var i=[.03,.01,1,s.App.PhysicsGroupTriggerArea,s.App.z1034],n=t.radius;this.pivotRadius=n,this.triggerArea=new OIMO.Body({type:"sphere",size:[n,n,n],pos:[0,0,0],rot:[0,0,0],move:!1,world:this.world,name:o+"_houseBumper1",config:i}).body,this.triggerArea.shapes.pubsub=this.pubsub,this.triggerArea.shapes.disablePhysics=!0;this.localPosition.x=0,this.localPosition.y=0,this.localPosition.z=0,this.pubsub.subscribe("hit",this.onTrigger.bind(this));this.triggerAreaMesh=s.app.graphicsHelper.addTestSphere("testEllipticCylinderSphereMesh",n,0,0,0,16711680,8)}},HouseNavigator.prototype.setPosition=function(t,e,o){this.accessory;var i=this.localPosition;this.triggerArea.position.x=t+i.x,this.triggerArea.position.y=e+i.y,this.triggerArea.position.z=o+i.z,this.triggerArea.syncShapes(),this.triggerAreaMesh&&(this.triggerAreaMesh.position.x=this.triggerArea.position.x,this.triggerAreaMesh.position.y=this.triggerArea.position.y,this.triggerAreaMesh.position.z=this.triggerArea.position.z,this.triggerAreaMesh.isPickable=!1)},HouseNavigator.prototype.enable=function(){this._enabled||(this.world.addRigidBody(this.triggerArea),this._enabled=!0)},HouseNavigator.prototype.disable=function(){this._enabled&&(this.triggerArea.position.y=9999,this.triggerArea.syncShapes(),this.world.removeRigidBody(this.triggerArea),this._enabled=!1)},HouseNavigator.prototype.onTrigger=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=this.accessory,i=t[8].actor.rodent;if(this.updated.push(i,i.id,s.app.frameNum)&&(!i.isInState(s.z80.name)&&o.parent)){var n=i.path[i.pathIndex];if(i.targetObject==o&&n)for(;n&&n.data.obj!=o;)i.incrementPathIndex(),n=i.path[i.pathIndex],0}},HouseNavigator}(s.z1091);s.HouseNavigator=t}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z767AddHamToHouse(){return null!==t&&t.apply(this,arguments)||this}return __extends(z767AddHamToHouse,t),z767AddHamToHouse.prototype.update=function(t){var e=t.currentObject;e&&e.accType==o.z1044.z1055&&e.addz1062(t)},z767AddHamToHouse}(z767),t.z767AddHamToHouse=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z606(){return null!==t&&t.apply(this,arguments)||this}return __extends(z606,t),z606.prototype.update=function(t){t.levels.home.step(2)},z606}(z767),e.z606=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z605(){return null!==t&&t.apply(this,arguments)||this}return __extends(z605,t),z605.prototype.update=function(t){t.levels.home.resetRandom()},z605}(z767),e.z605=o}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z600(){return null!==t&&t.apply(this,arguments)||this}return __extends(z600,t),z600.prototype.update=function(t){var e=t.currentObject;e&&e.accType==o.z1044.z1055&&t.path[t.pathIndex]==e.centerGraphNode&&(t.pathIndex++,t.path2Index=3*t.pathIndex+3)},z600}(z767),t.z600=e}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z577(){return null!==t&&t.apply(this,arguments)||this}return __extends(z577,t),z577.prototype.update=function(t){var e=t.targets.lookToTarget,o=(t.targets.moveToTarget,t.path,t.currentObject);if(o&&o.accType==n.z1044.z1055&&0!=t.pathIndex&&t.path[t.pathIndex+1]){var i=t.path[t.pathIndex+1];t.path[t.pathIndex+2]&&(i=t.path[t.pathIndex+2]),e.x=i.x,e.y=i.y,e.z=i.z}},z577}(z767),t.z577=e}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z767RemoveHamFromHouse(){return null!==t&&t.apply(this,arguments)||this}return __extends(z767RemoveHamFromHouse,t),z767RemoveHamFromHouse.prototype.update=function(t){var e=t.currentObject;e&&e.accType==o.z1044.z1055&&e.removez1062(t)},z767RemoveHamFromHouse}(z767),t.z767RemoveHamFromHouse=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z461(){var t=null!==e&&e.apply(this,arguments)||this;return t.slowAngSpeed=.01*Math.PI,t.fastAngSpeed=.16*Math.PI,t.skipRoll=!1,t.skipAbortTouchGround=!1,t}return __extends(z461,e),z461.prototype.update=function(t){if(t.standing||this.skipAbortTouchGround||t.isTouchingGround()){var e,o=t.targets,i=o.upVecTarget,n=i.x,s=i.y,a=i.z,r=t.physics.middleBody.body,c=z767.tempVecs[0],d=z767.tempVecs[1],p=z767.tempVecs[2],l=t.physics.middleBody.rotationElements,u=r.angularVelocity;c.x=l[2],c.y=l[5],c.z=l[8],d.x=0,d.y=1,d.z=0,null!=n&&(d.x=n,d.y=s,d.z=a),p.cross(d,c),e=l;var y=p.x,g=p.y,m=p.z,f=y*e[0]+g*e[3]+m*e[6],A=y*e[1]+g*e[4]+m*e[7];o.rollAngToUp=Math.atan2(A,f);var b=o.rollAngToUp,v=t.speed,x=this.fastAngSpeed-this.slowAngSpeed,C=this.slowAngSpeed+x*v;C<b?b=C:b<-C&&(b=-C),c.scaleEqual(62*b),d.sub(c,u),u.addEqual(d),datgui&&t.pubsub.broadcast("rolling",t)}},z461}(z767),e.z461=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z461InHouse(){var t=null!==e&&e.apply(this,arguments)||this;return t.skipAbortTouchGround=!0,t}return __extends(z461InHouse,e),z461InHouse.prototype.update=function(t){e.prototype.update.call(this,t)},z461InHouse}(e.z461),e.z461InHouse=o}(z0||(z0={})),function(i){var t,e;t=i.z156||(i.z156={}),e=function(e){function z313(){var t=null!==e&&e.apply(this,arguments)||this;return t.tempArr=[],t}return __extends(z313,e),z313.prototype.update=function(t){var e=t.targetObject;if(e&&e.accType==i.z1044.z1055){var o=t.path[t.pathIndex];o&&o.data.enterEvent||((o=t.path[t.pathIndex-1])&&o.data.obj==e&&o.data.enterEvent&&(t.pathIndex=t.pathIndex-1),(o=t.path[t.pathIndex-2])&&o.data.obj==e&&o.data.enterEvent&&(t.pathIndex=t.pathIndex-2),(o=t.path[t.pathIndex-3])&&o.data.obj==e&&o.data.enterEvent&&(t.pathIndex=t.pathIndex-3))}},z313}(z767),t.z313=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z312(){return null!==t&&t.apply(this,arguments)||this}return __extends(z312,t),z312.prototype.update=function(t){var e=t.path[t.path.length-1],o=e.data.obj;o&&o.centerGraphNode!=e&&t.setPathTo(o.centerGraphNode)},z312}(z767),e.z312=o}(z0||(z0={})),function(i){var t,e;t=i.z156||(i.z156={}),e=function(t){function z429(){return null!==t&&t.apply(this,arguments)||this}return __extends(z429,t),z429.prototype.update=function(t){var e=t.currentObject;if(e){e.accType,i.z1044.z1055;var o=t.targets.destTarget;e.isInside(o.x,o.y,o.z)&&(o.copyFrom(e.position),o.y+=.1,o.z-=.5*e.depth+1)}},z429}(z767),t.z429=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z245(){return null!==t&&t.apply(this,arguments)||this}return __extends(z245,t),z245.prototype.update=function(t){},z245}(z767),e.z245=o}(z0||(z0={})),function(c){var t,e;t=c.z156||(c.z156={}),e=function(t){function z243(){return null!==t&&t.apply(this,arguments)||this}return __extends(z243,t),z243.prototype.update=function(t){var e=t.currentObject;if(e&&e.accType==c.z1044.z1055){var o=t.physics.rearBody.body.position,i=e.body.shapes.halfDepth;if(!(o.z<e.position.z-i)){var n=e.holes[0],s=e.body.position;if(t.targets.destTarget.x=n.x+s.x,t.targets.destTarget.y=n.y+s.y,t.targets.destTarget.z=s.z-i,t.targets.setTargetsToDestination(),t.eyesCloseAmount<.5){var a=t.physics.frontBody.body.position,r=t.physics.rearBody.body.position;if(a.z<r.z){if(t.targets.targetNum1<c.app.frameNum){t.targets.lookToTargetOffset2.x=0,t.targets.lookToTargetOffset2.y=z1.GetRandomNum(-.2,0),t.targets.lookToTargetOffset2.z=z1.GetRandomNum(-.2,0),t.targets.targetNum1=c.app.frameNum+z1.GetRandomNum(300,500)}t.targets.lookToTarget.addInPlace(t.targets.lookToTargetOffset2)}else t.walkForce,t.walkSpeed,t.targets.targetDir,t.targets.dirTarget}}}},z243}(z767),t.z243=e}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(e){function z193(){var t=null!==e&&e.apply(this,arguments)||this;return t.accType=o.z1044.z1055,t}return __extends(z193,e),z193.prototype.update=function(t){e.prototype.update.call(this,t),t.isFollowingPath()||t.targetObject&&t.currentObject!=t.targetObject&&t.targetObject.accType==o.z1044.z1055&&t.setPathTo(t.targetObject.position)},z193}(t.z200),t.z193=e}(z0||(z0={})),function(p){var t,e;t=p.z768||(p.z768={}),e=function(t){function z1000(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1000,t),z1000.prototype.test=function(t){var e=t.path[t.pathIndex].data.obj;if(!e)return!1;if(e.accType!=p.z1044.z1055)return!1;var o=t.physics.headBody.body.position,i=t.physics.frontBody.body.position,n=t.physics.middleBody.body.position,s=t.physics.rearBody.body.position;if(e.body.shapes.radius){var a=e.body.shapes.radius-e.body.shapes.wallThickness,r=e.body.position,c=z1.distanceSquared(o,r),d=a;return!(d*d<c)&&(!(d*d<(c=z1.distanceSquared(i,r)))&&(!(d*d<(c=z1.distanceSquared(n,r)))&&!(d*d<(c=z1.distanceSquared(s,r)))))}return!!(e.isInside(o.x,o.y,o.z)&&e.isInside(i.x,i.y,i.z)&&e.isInside(n.x,n.y,n.z))},z1000}(z770),t.z1000=e}(z0||(z0={})),function(s){var t,e;t=s.z768||(s.z768={}),e=function(t){function z998(){return null!==t&&t.apply(this,arguments)||this}return __extends(z998,t),z998.prototype.test=function(t){var e=t.currentObject;if(!e)return!1;if(e.accType!=s.z1044.z1055)return!1;var o=t.physics.headBody.body.position,i=t.physics.frontBody.body.position,n=t.physics.middleBody.body.position;return!(e.isInBox(o.x,o.y,o.z,.1)||e.isInBox(i.x,i.y,i.z,.1)||e.isInBox(n.x,n.y,n.z,0))},z998}(z770),t.z998=e}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z996(){return null!==t&&t.apply(this,arguments)||this}return __extends(z996,t),z996.prototype.test=function(t){var e=t.memory.getAccessories(o.z1044.z1055);return!(!e||0==e.length)},z996}(z770),t.z996=e}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z963(){return null!==t&&t.apply(this,arguments)||this}return __extends(z963,t),z963.prototype.test=function(t){return!(!t.currentObject||t.currentObject.accType!=e.z1044.z1055)},z963}(z770),t.z963=o}(z0||(z0={})),function(i){var t,e;t=i.z768||(i.z768={}),e=function(t){function z956(){return null!==t&&t.apply(this,arguments)||this}return __extends(z956,t),z956.prototype.test=function(t){var e=t.targetObject;if(!e||e.accType!=i.z1044.z1055)return!1;var o=t.targets.destTarget;return o.x==e.position.x&&o.y==e.position.y&&o.z==e.position.z||!!t.targetObject.isInBox(o.x,o.y,o.z)},z956}(z770),t.z956=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z949(){return null!==t&&t.apply(this,arguments)||this}return __extends(z949,t),z949.prototype.test=function(t){var e=t.path[t.pathIndex],o=t.path[t.pathIndex+1],i=t.path[t.pathIndex+2];return!!(e&&e.data.obj&&e.data.obj.holes&&e.data.obj.cage)||(!!(o&&o.data.obj&&o.data.obj.holes&&o.data.obj.cage)||!!(i&&i.data.obj&&i.data.obj.holes&&i.data.obj.cage))},z949}(z770),e.z949=o}(z0||(z0={})),function(s){var t,e;t=s.z768||(s.z768={}),e=function(t){function CondIsFrontInTargetHouse(){return null!==t&&t.apply(this,arguments)||this}return __extends(CondIsFrontInTargetHouse,t),CondIsFrontInTargetHouse.prototype.test=function(t){var e=t.targetObject;if(!e||e.accType!=s.z1044.z1055)return!1;var o=t.physics.frontBody.body.position,i=t.physics.headBody.body.position,n=e.connectors[0];return!(i.z<n.position.z)&&!(o.z<n.position.z)},CondIsFrontInTargetHouse}(z770),t.CondIsFrontInTargetHouse=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z917(){return null!==t&&t.apply(this,arguments)||this}return __extends(z917,t),z917.prototype.test=function(t){return t.levels.home.value<=0},z917}(z770),e.z917=o}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z854(){return null!==t&&t.apply(this,arguments)||this}return __extends(z854,t),z854.prototype.test=function(t){return!(!t.targetObject||t.targetObject.accType!=e.z1044.z1055)},z854}(z770),t.z854=o}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z854Full(){return null!==t&&t.apply(this,arguments)||this}return __extends(z854Full,t),z854Full.prototype.test=function(t){return!(!t.targetObject||t.targetObject.accType!=e.z1044.z1055)&&!!t.targetObject.isFull()},z854Full}(z770),t.z854Full=o}(z0||(z0={})),function(n){var t,e;t=n.z768||(n.z768={}),e=function(t){function z848(){return null!==t&&t.apply(this,arguments)||this}return __extends(z848,t),z848.prototype.test=function(t){var e=t.targetObject;if(e&&e.accType==n.z1044.z1055){var o=t.physics.frontBody.body.position,i=e.body.position;return o.x<i.x-.3||o.x>i.x+.3}},z848}(z770),t.z848=e}(z0||(z0={})),function(i){var t,e;t=i.z768||(i.z768={}),e=function(t){function z803(){return null!==t&&t.apply(this,arguments)||this}return __extends(z803,t),z803.prototype.test=function(t,e){if(t.targetObject&&t.targetObject.accType==i.z1044.z1055&&t.targetObject.cage==t.cage){var o=t.hsm[1].currentState.currentState;if(o&&"z87"==o.name)return 480<o.numFramesInState}},z803}(z770),t.z803=e}(z0||(z0={})),function(i){var t,e;t=i.z768||(i.z768={}),e=function(t){function z778(){return null!==t&&t.apply(this,arguments)||this}return __extends(z778,t),z778.prototype.test=function(t){var e=t.currentObject;if(e&&e.accType==i.z1044.z1055){if(!e.parent)return!0;var o=t.targets.destTarget;return!e.isInside(o.x,o.y,o.z,.1)}},z778}(z770),t.z778=e}(z0||(z0={})),function(o){var t=function(e){function z82(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[],t.updatez156=[o.z156.z193],t.transitions=[{condition:o.z768.z949,trueNode:{condition:o.z768.z963,falseNode:{condition:o.z768.z854Full,trueNode:{state:o.z112,actions:[o.z156.z605]}}}},{condition:o.z768.z951,trueNode:{condition:o.z768.z964,trueNode:{state:o.z40}}},{condition:o.z768.z963,trueNode:{nodes:[{condition:o.z768.z957,falseNode:{state:o.z81}},{condition:o.z768.z976,trueNode:{state:o.z81}},{condition:o.z768.z982,falseNode:{condition:o.z768.z986,falseNode:{state:o.z81}}}]},falseNode:{condition:o.z768.z956,falseNode:{state:o.z112}}},{condition:o.z768.z996,falseNode:{state:o.z112}},{condition:o.z768.z963,trueNode:{condition:o.z768.z911,trueNode:{condition:o.z768.z925,trueNode:{state:o.z45}}},falseNode:{condition:o.z768.z803,trueNode:{condition:o.z768.z925,trueNode:{state:o.z112,actions:[o.z156.z605,o.z156.z212]},falseNode:{state:o.z112,actions:[o.z156.z605]}}}}],t}return __extends(z82,e),z82}(z49);o.z82=t}(z0||(z0={})),function(o){var t=function(e){function z81(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z429,o.z156.z470,o.z156.z314],t.updatez156=[],t.transitions=[{condition:o.z768.z963,falseNode:{condition:o.z768.z982,trueNode:{state:o.z112},falseNode:{state:o.z37}}}],t}return __extends(z81,e),z81}(z49);o.z81=t}(z0||(z0={})),function(o){var t=function(e){function z40(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[],t.updatez156=[o.z156.z507],t.transitions=[{condition:o.z768.z951,falseNode:{state:o.z82,actions:[o.z156.z426,o.z156.z480]}}],t}return __extends(z40,e),z40}(z49);o.z40=t}(z0||(z0={})),function(o){var t=function(e){function z87(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z495,o.z156.z406,o.z156.z318,o.z156.z222,o.z156.z741,o.z156.z313],t.updatez156=[o.z156.z184,o.z156.z599,o.z156.z461,o.z156.z362,o.z156.z731,o.z156.z676,o.z156.z590,o.z156.z214,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z457],t.exitz156=[o.z156.z502,o.z156.z517],t.transitions=[{condition:o.z768.z848,trueNode:{state:o.z66,level:1,actions:[o.z156.z314]}},{condition:o.z768.z963,trueNode:{state:o.z79}},{condition:o.z768.z839,falseNode:{state:o.z66,level:1}},{condition:o.z768.z820,trueNode:{state:o.z66,level:1}},{condition:o.z768.z949,falseNode:{state:o.z66,level:1}},{condition:o.z768.z1000,trueNode:{state:o.z79,actions:[o.z156.z435,o.z156.z298]}},{condition:o.z768.CondIsFrontInTargetHouse,falseNode:{condition:o.z768.z967,falseNode:{state:o.z125}}},{condition:o.z768.z913,falseNode:{condition:o.z768.z1000,falseNode:{state:o.z79,actions:[o.z156.z497,o.z156.z324]}}}],t.states=[o.z86,o.z85],t.initialState=o.z86,t}return __extends(z87,e),z87}(z49);o.z87=t}(z0||(z0={})),function(o){var t=function(e){function z86(){var t=null!==e&&e.apply(this,arguments)||this;return t.updatez156=[o.z156.z560],t.transitions=[{condition:o.z768.z922,falseNode:{state:o.z85}}],t}return __extends(z86,e),z86}(z49);o.z86=t}(z0||(z0={})),function(o){var t=function(e){function z85(){var t=null!==e&&e.apply(this,arguments)||this;return t.updatez156=[o.z156.z558],t.transitions=[{condition:o.z768.z922,trueNode:{state:o.z86}}],t}return __extends(z85,e),z85}(z49);o.z85=t}(z0||(z0={})),function(o){var t=function(e){function z84(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z495,o.z156.z406,o.z156.z222,o.z156.z741,o.z156.z314,o.z156.z600],t.updatez156=[o.z156.z507,o.z156.z626,o.z156.z599,o.z156.z461,o.z156.z362,o.z156.z731,o.z156.z676,o.z156.z577,o.z156.z590,o.z156.z214,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z457],t.exitz156=[o.z156.z767RemoveHamFromHouse,o.z156.z502],t.transitions=[{condition:o.z768.z778,falseNode:{state:o.z79}},{condition:o.z768.z998,trueNode:{state:o.z66,level:1,actions:[o.z156.z435]}},{condition:o.z768.z967,falseNode:{state:o.z83}}],t.states=[o.z86,o.z85],t.initialState=o.z86,t}return __extends(z84,e),z84}(z49);o.z84=t}(z0||(z0={})),function(o){var t=function(e){function z83(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z494,o.z156.z404,o.z156.z222,o.z156.z741,o.z156.z278],t.updatez156=[o.z156.z599,o.z156.z325,o.z156.z461,o.z156.z362,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739],t.exitz156=[o.z156.z517],t.transitions=[{condition:o.z768.z888,trueNode:{previousState:!0}},{condition:o.z768.z967,trueNode:{previousState:!0}}],t}return __extends(z83,e),z83}(z49);o.z83=t}(z0||(z0={})),function(o){var t=function(e){function z80(){var t=null!==e&&e.apply(this,arguments)||this;return t.historyLength=3,t.type="move",t.ignoreEvents=[o.ConnectorCageEvents.ENTER],t.enterz156=[o.z156.z406,o.z156.z318,o.z156.z726],t.states=[o.z87,o.z79,o.z84,o.z83],t.initialState=o.z87,t}return __extends(z80,e),z80}(z49);o.z80=t}(z0||(z0={})),function(o){var t=function(e){function z79(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z320,o.z156.z500,o.z156.z482,o.z156.z526,o.z156.z514,o.z156.z434,o.z156.z278,o.z156.z503,o.z156.z767AddHamToHouse],t.updatez156=[o.z156.z507,o.z156.z724,o.z156.z606,o.z156.z243,o.z156.z687,o.z156.z685,o.z156.z610,o.z156.z716,o.z156.z235,o.z156.z461InHouse,o.z156.z446,o.z156.z590,o.z156.z214,o.z156.z369,o.z156.z362,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z379,o.z156.z442],t.transitions=[{condition:o.z768.z951,falseNode:{condition:o.z768.z778,trueNode:{state:o.z84}}}],t}return __extends(z79,e),z79}(z49);o.z79=t}(z0||(z0={})),function(A){var t=function(g){function Platform(t){var e=g.call(this)||this;return e.accType=A.z1044.z1049,e.centerGraphNode=void 0,e.nodeToBeddingLeft1=void 0,e.nodeToBeddingRight1=void 0,e.nodeToBeddingLeft2=void 0,e.nodeToBeddingRight2=void 0,e.nodeToBeddingLeft3=void 0,e.nodeToBeddingRight3=void 0,e.beddingConnectedAbove=!1,e.nodes=void 0,e.holes=[],e.num=0,e.world=void 0,e.body=void 0,e.boxSize=0,e.food=[],e.worldMatrix=BABYLON.Matrix.Identity(),e.invWorldMatrix=BABYLON.Matrix.Identity(),e.floorThickness=0,e._platformToLeft=void 0,e._platformToRight=void 0,e._tempArray=[],e.objs=[],e._connectedPlatformsCenterX=0,e._connectedPlatformsWidth=0,Platform.count++,e.num=Platform.count,e.shapeName="Platform",e.position=BABYLON.Vector3.Zero(),e.scaling=new BABYLON.Vector3(1,1,1),e.placementType=A.PlacementType.GRID|A.PlacementType.z1048|A.PlacementType.MID,e.bindedKeepPosInside=e.keepPosInside.bind(e),e}return __extends(Platform,g),Object.defineProperty(Platform.prototype,"cage",{get:function(){return this._cage},set:function(t){t||this._cage,this._cage=t},enumerable:!1,configurable:!0}),Object.defineProperty(Platform.prototype,"platformToLeft",{get:function(){return this._platformToLeft},set:function(t){t!=this._platformToLeft&&(this._platformToLeft=t,this.refreshPlatformConnected())},enumerable:!1,configurable:!0}),Object.defineProperty(Platform.prototype,"platformToRight",{get:function(){return this._platformToRight},set:function(t){t!=this._platformToRight&&(this._platformToRight=t,this.refreshPlatformConnected())},enumerable:!1,configurable:!0}),Platform.prototype.getWorldMatrix=function(){return this.worldMatrix},Platform.prototype.addToActiveObjects=function(){-1==Platform.activeObjects.indexOf(this)&&Platform.activeObjects.push(this)},Platform.prototype.removeFromActiveObjects=function(){var t=Platform.activeObjects.indexOf(this);-1!=t&&Platform.activeObjects.splice(t,1)},Platform.prototype.init=function(t){g.prototype.init.call(this,t),this.boxSize=1,t.boxSize&&(this.boxSize=t.boxSize),this.canRotate=!1,this.canTranslate=!0,this.canDelete=!0,this.world=t.world,this.addToActiveObjects();this.width,this.height;t.width&&(t.width,this.width=t.width),this.mapPlacementInfo||(this.mapPlacementInfo=new A.MapPlacementInfo({mapOffsetY:-.5,mapOffsetDropTargetY:.5})),this.controlAnchor||this.addControlAnchor(),this.controlPositionLocal.x=0,this.controlPositionLocal.y=0;var e=this.controlPositionLocal.z=0,o=0;if(null!=t.x&&(e=t.x),null!=t.y&&(o=t.y),this.floorThickness=.04,t.isMenuItem&&t.isMenuItem,this.controlPositionLocal.y=.3,this.connectedPlatformsWidth=this.width,t.isMenuItem);else if(!this.hitMeshes){this.depth=4,this.height=.06,this.hitMeshes=[];var i=A.app.graphicsHelper.getHitMesh(this.width-.01,.001,this.depth,!1);i.rotationQuaternion=BABYLON.Quaternion.Identity(),this.hitMeshes.push(i);var n=[1,.4,.2,A.App.z1033,4294967295];this.body=new OIMO.Body({holes:[],size:[this.width,.06,4],pos:[0,0,0],rot:[0,0,0],world:this.world,config:n,type:"holey_box"}).body,this.body.shapes.floorThickness=.05,(this.body.shapes.entity=this).holes[0]||(this.holes[0]=new OIMO.Hole(0,0,0,.3,0,1,0));var s=this.width-1,a=2*s+1;this.nodes=z1083.createNodeGrid(0,0,-.35,s,3*.7,a,4,this)}if(this._initColors(),t.skipAddToScene)this.removeFromScene();else if(this.setPosition(e,o,0),this.addToScene(),!this.cage)return},Platform.prototype.updateNodes=function(){if(this.nodes){for(var t=0;t<this.nodes.length;t++){var e=this.nodes[t];e.y=this.position.y+.05,e.data.obj=this.cage,e.data.obj2=this}this.centerGraphNode&&(this.centerGraphNode.data.obj=this.cage,this.centerGraphNode.data.obj2=this)}},Platform.prototype.setPositionOnMapFromDrop=function(t,e,o){g.prototype.setPositionOnMapFromDrop.call(this,t,e,o);for(var i=0;i<this.objs.length;i++){var n=this.objs[i],s=n.position;n.setPositionOnMapFromDrop(s.x,s.y,s.z,{dragPlatformY:e})}},Platform.prototype.setHitMesh=function(t,e,o){if(this.hitMeshes&&this.hitMeshes[0]){var i=this.hitMeshes[0];i.position.x=t,i.position.y=e,i.position.z=o,i.computeWorldMatrix()}},Platform.prototype._translateChildrenDrag=function(t,e,o,i){for(var n=0;n<this.objs.length;n++){var s=this.objs[n],a=s.position;s.bodies||s.draggerBody?s.parent==this&&s.translate(t,e,o):s.setPositionDrag(t+a.x,e+a.y,o+a.z,i,!0)}},Platform.prototype.setPositionDrag=function(t,e,o,i){var n=t-this.position.x,s=e-this.position.y,a=o-this.position.z;if(!this.isDragging&&this.cage&&!this.cage.isDragging){this.objs.length=0;var r=.8*this.width,c=this.position,d=A.z1044.z1054|A.z1044.z1045|A.z1044.z1055|A.z1044.SWING;this.cage.getChildrenAt(c.x,c.y+.4,c.z,r,.8,this.objs,d)}if(g.prototype.setPositionDrag.call(this,t,e,o,i),this.body){var p=this.body.position;c=this.position;p.x=c.x,p.y=c.y,p.z=c.z;var l=this.body.shapes.position;l.x=c.x,l.y=c.y,l.z=c.z,this.body.shapes.updateProxy()}if(this.food)for(var u=0;u<this.food.length;u++){this.food[u].translate(n,s,a)}if(this.nodes&&this._translateNodes(n,s,a),this.foodMoundCollider&&this.foodMoundCollider.translate(n,s,a),this.setHitMesh(t,e,o),i&&this.updateCage(),this.cage&&this.cage.isDragging||this._translateChildrenDrag(n,s,a,i),i&&this.objs.length){var y=this;setTimeout(function(){y.objs.length=0},0)}this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position)},Platform.prototype.removeFromCage=function(){if(this.cage){this.cage;this.cage.removeObject(this)}},Platform.prototype.updateCage=function(){var t=A.Cage.getCageAt(this.position.x,this.position.y,this.position.z);this.addToObject(t)},Platform.prototype.setPosition=function(t,e,o,i){void 0===i&&(i=!1);var n=e,s=this.position.x,a=this.position.y,r=this.position.z;this.position.x=t,this.position.y=e,this.position.z=o;var c=t-this.position.x,d=e-this.position.y,p=o-this.position.z;this.foodMoundCollider&&this.foodMoundCollider.translate(c,d,p);c=t-s,d=n-a,p=o-r;if(this.position.x=t,this.position.y=n,this.position.z=o,this.nodes&&this._translateNodes(c,d,p),this.setHitMesh(t,n,o),this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position),!i&&this.body){var l=this.body.position,u=this.position;l.x=u.x,l.y=u.y,l.z=u.z,this.body.syncShapes();var y=A.Cage.getCageAt(t,e,o);y!=this.cage?(this.cage&&this.removeFromCage(),y?this.addToObject(y):this.disconnect()):(this.disconnect(),this.updateNodes(),this.checkConnections())}this._platformToLeft||this._platformToRight||(this.connectedPlatformsCenterX=this.position.x),this._connected=!0,this.worldMatrix.setTranslation(this.position),this.worldMatrix.invertToRef(this.invWorldMatrix),this.onChangeObservable.notifyObservers(this)},Platform.prototype._translateNodes=function(t,e,o){for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i];n.x+=t,n.y+=e,n.z+=o}},Platform.prototype.getGraphNodeAt=function(t,e,o,i,n,s,a,r){void 0===i&&(i=!1),void 0===n&&(n=null),void 0===s&&(s=0),void 0===a&&(a=null);for(var c,d,p=this.nodes,l=p.length,u=Number.MAX_VALUE,y=Platform.tempVecs[0],g=0;g<l;g++)if((c=p[g])!=a&&this.nodeToBeddingRight1!=c&&this.nodeToBeddingLeft1!=c&&this.nodeToBeddingRight2!=c&&this.nodeToBeddingLeft2!=c&&this.nodeToBeddingRight3!=c&&this.nodeToBeddingLeft3!=c){var m=c.x-t,f=c.y-e,A=c.z-o,b=m*m+f*f+A*A;if(b<u){if(i&&0==c.type)continue;if(n)if(y.x=m,y.y=f,y.z=A,y.normalize(y),y.dot(n)<s)continue;u=b,d=c}}return d},Platform.prototype.addToScene=function(){this.isOnScene||(g.prototype.addToScene.call(this),this.body&&!this.body.parent&&this.world.addRigidBody(this.body))},Platform.prototype.removeFromScene=function(){if(this.isOnScene)for(g.prototype.removeFromScene.call(this),this.isMenuItem||this.setPositionDrag(this.position.x,9999,this.position.z,!1),this.body&&this.body.parent&&(this.body.shapes.updateProxy(),this.body.shapes.position.y=this.body.position.y,this.world.removeRigidBody(this.body));this.food.length;){this.food[0].recycle()}},Platform.prototype.recycle=function(){if(g.prototype.recycle.call(this),this.objs.length=0,this.body)for(var t=0;t<this.holes.length;t++)this.body.shapes.removeHole(this.holes[t]);this.foodMoundCollider&&this.foodMoundCollider.resetHeights()},Platform.prototype.disconnectBeddingNodes=function(t){void 0===t&&(t=0);var e=3;1<this.width&&(e=7);for(var o=this.nodes,i=e;i<o.length;i++)for(var n=o[i],s=0;s<n.connections.length;s++){var a=n.connections[s];if(t){if(0<t&&a.x-this.position.x<0)continue;if(t<0&&0<a.x-this.position.x)continue}a.data.obj==n.data.obj&&a.data.obj2==n.data.obj2||(a.data.obj&&a.data.obj.accType!=A.z1044.z1047||(n.removeConnection(a),a.removeConnection(n),s--))}},Platform.prototype.onAfterConnect=function(t){t&&(t.accType==A.z1044.z1049&&(this.disconnectBeddingNodes(),0<t.position.x-this.position.x?this.platformToRight=t:this.platformToLeft=t,this.checkBeddingConnections()),t.accType==A.z1044.z1046&&(t.position.x>this.position.x+.5*this.width&&t.position.y<this.position.y?this.disconnectBeddingNodes(1):t.position.x<this.position.x-.5*this.width&&t.position.y<this.position.y&&this.disconnectBeddingNodes(-1)))},Platform.prototype.onAfterDisconnect=function(t){t==this.platformToLeft?(this.platformToLeft=null,this.checkBeddingConnections()):t==this.platformToRight&&(this.platformToRight=null,this.checkBeddingConnections())},Platform.prototype.disconnect=function(){if(this.body){this.skipConnect=!0;for(var t=this.nodes,e=t.length,o=0;o<e;o++)for(var i=t[o],n=0;n<i.connections.length;n++){var s=i.connections[n];if(s!=this.centerGraphNode&&(s.data.obj!=i.data.obj||s.data.obj2!=i.data.obj2)){if(i.removeConnection(s),s.removeConnection(i),n--,s.data.obj2||(s.data.obj&&s.data.obj.removeHoleAt?s.data.obj.removeHoleAt(i.x,i.y,i.z):s.data.connector&&s.data.connector.parent&&s.data.connector.parent.removeHoleAt&&s.data.connector.parent.removeHoleAt(i.x,i.y,i.z)),s.data.tube){var a=s.data.tube;a.initNode(s),a.checkGroundConnections(),a.updateConnected(),a.refreshOpenings(),a.updateCovers(),this.removeHoleAt(s.x,s.y,s.z)}s.data.obj2&&s.data.obj2.onAfterDisconnect&&s.data.obj2.onAfterDisconnect(this),s.data.obj&&s.data.obj.onAfterDisconnect&&s.data.obj.onAfterDisconnect(this)}}this.platformToRight=null,this.platformToLeft=null,this.beddingConnectedAbove=!1,this.skipConnect=!1}},Platform.prototype.getNeighborAt=function(t,e,o){for(var i,n=this.position.x,s=this.position.y+.5*this.height,a=this.position.z,r=this.nodes,c=t-n,d=e-s,p=0;p<r.length;p++){var l=r[p],u=l.x-n,y=l.y-s,g=l.z-a;if(!(.3<g||g<-.3)&&(!(c<0&&0<u)&&!(0<c&&u<0)&&!(d<0&&0<y)&&!(0<d&&y<0)&&(i=A.z1092.GetObjConnectedToNodeAt(l,t,e,o))))return i}},Platform.prototype.getProps=function(){return g.prototype.getProps.call(this)},Platform.prototype.getPositionOnMapFromDropToRef=function(t,e,o,i){g.prototype.getPositionOnMapFromDropToRef.call(this,t,e,o,i);var n=A.Cage.getCageAt(t,e,o);if(n){var s=this.mapPlacementInfo,a=i.y-n.position.y;Math.abs(a)<.1?(e=i.y+1,i.y=z1.round(e+s.mapOffsetDropTargetY,s.mapPlacementSizeY)+s.mapOffsetY):a>n.height-.001&&(e=i.y-1,i.y=z1.round(e+s.mapOffsetDropTargetY,s.mapPlacementSizeY)+s.mapOffsetY)}},Platform.prototype.isValidDropLocation=function(t,e,o){var i=this._tempDropLoc;this.getPositionOnMapFromDropToRef(t,e,o,i);var n=A.Cage.getCageAt(i.x,i.y,i.z);if(!n)return!1;if(n.getObjectAt(i.x,i.y,i.z,A.z1044.z1049))return!1;var s=n.getObjectAt(i.x,i.y,1.5,A.z1044.z1054);if(s){if(n.position.y+n.height-e<2*s.radius)return!1;if(n.getObjectAt(i.x,i.y+1,i.z,A.z1044.z1049))return!1}for(var a=0;a<n.objs.length;a++){var r=n.objs[a];if(r.accType==A.z1044.z1054&&(!s||s!=r)){if(r.isInBox(i.x+.5*this.width-.1,i.y,1.5))return!1;if(r.isInBox(i.x-.5*this.width+.1,i.y,1.5))return!1}}var c=this.hitMeshes[0];c.position.x,c.position.y,c.position.z;this.setHitMesh(i.x,i.y,i.z);var d=Platform.tempArray;d.length=0,n.getChildrenAt(i.x,i.y,i.z,this.width,.02,d,A.z1044.z1055);var p=0<d.length;if(p&&n.bedding){for(var l=0,u=0;u<d.length;u++){var y=d[u];i.y-y.height<n.position.y&&l++}0==l&&(p=!1)}return!p},Platform.prototype.addToObject=function(t){this.cage&&this.cage!=t&&this.removeFromCage(),t!=this.cage&&(this.parent=t,(this.cage=t)&&(this.disconnect(),t.addObject(this),this.updateNodes(),this.checkConnections()))},Platform.prototype.isInBox=function(t,e,o,i){void 0===i&&(i=0);var n=this.position,s=.5*this.width+i,a=.5*this.depth+i,r=n.x-s,c=n.x+s,d=n.y-i,p=n.y+this.boxSize+i,l=n.z-a,u=n.z+a;return!(t<r||c<t||e<d||p<=e||o<l||u<o)},Platform.prototype.checkConnections=function(){this.checkTubeConnections(),this.checkCageConnections(),this.checkPlatformConnections(),this.checkRampConnections(),this.checkBridgeConnections(),this.checkSwingConnections(),this.checkBeddingConnections(),this.checkWheelConnections(),this.checkHouseConnections()},Platform.prototype.checkWheelConnections=function(){if(this.cage){var t=this.cage.getObjectAt(this.position.x,this.position.y+.33,1.5,A.z1044.z1054);if(t){var e=t.position.y;t.setToFloor(t.position.y),e==t.position.y&&t.refreshConnections()}}},Platform.prototype.checkHouseConnections=function(){if(this.cage){var t=this._tempArray;t.length=0,this.cage.getChildrenAt(this.position.x,this.position.y+.4,this.position.z,.5*this.width,.4,t,A.z1044.z1055);for(var e=0;e<t.length;e++){var o=t[e];o.position.y==o.position.y&&o.refreshConnections()}}},Platform.prototype.removeBeddingConnectionsUnderPlatform=function(t){for(var e=0;e<t.connections.length;e++){var o=t.connections[e];t.data.obj2.centerGraphNode,o.data.obj2==t.data.obj2&&(t.y>this.position.y&&o.y<this.position.y&&o.x<this.position.x+.5*this.width&&o.x>this.position.x-.5*this.width?(t.removeConnection(o),o.removeConnection(t),e--):t.y<this.position.y&&o.y>this.position.y&&o.x<this.position.x+.5*this.width&&o.x>this.position.x-.5*this.width?(t.removeConnection(o),o.removeConnection(t),e--):t.y<this.position.y-.2&&t.y>this.position.y-.4&&o.x<this.position.x+.5*this.width&&(o.x,this.position.x,this.width))}},Platform.prototype.checkBeddingConnections=function(){if(this.cage&&this.cage.bedding){var t=this.cage.position.x-.5*this.cage.width,e=this.cage.position.x+.5*this.cage.width,o=this.position.x-.5*this.width,i=this.position.x+.5*this.width,n=!0,s=!0;if(Math.abs(t-o)<.1&&(n=!1),Math.abs(e-i)<.1&&(s=!1),(n||s)&&(n&&this.platformToLeft&&(n=!1),s&&this.platformToRight&&(s=!1),n||s)){if(n){this._tempArray.length=0,this.cage.getObjectsAt(this._tempArray,this.position.x-.5*this.width-.1,this.position.y-.1,this.position.z,A.z1044.z1046);for(var a=0;a<this._tempArray.length;a++){if(0<this._tempArray[a].rotation.z){n=!1;break}}}if(s){this._tempArray.length=0,this.cage.getObjectsAt(this._tempArray,this.position.x+.5*this.width+.1,this.position.y-.1,this.position.z,A.z1044.z1046);for(var r=0;r<this._tempArray.length;r++){if(this._tempArray[r].rotation.z<0){s=!1;break}}}var c=.15,d=-1;if(s){var p=this.cage.bedding.getHeightAt2(i,this.position.z);if(this.position.y-p<.4){if((u=Platform.z4[0]).x=1,u.y=0,u.z=0,y=this.cage.bedding.getGraphNodeAt(i+c,this.position.y,this.position.z,null,u)){this.nodeToBeddingRight1||(this.nodeToBeddingRight1=this.createNodeToBedding(i+c,this.position.y,this.position.z)),this.nodeToBeddingRight1.x=i+c,this.nodeToBeddingRight1.y=this.position.y+.2,this.nodeToBeddingRight1.z=this.position.z;var l=10*Math.sqrt(z1.distanceSquared(y,this.nodeToBeddingRight1));this.nodeToBeddingRight1.addConnection(y,l),y.addConnection(this.nodeToBeddingRight1,l),this.removeBeddingConnectionsUnderPlatform(y)}if(d=-1,y=this.cage.bedding.getGraphNodeAt(i+c,this.position.y,this.position.z+d,null,u)){this.nodeToBeddingRight2||(this.nodeToBeddingRight2=this.createNodeToBedding(i+c,this.position.y,this.position.z+d)),this.nodeToBeddingRight2.x=i+c,this.nodeToBeddingRight2.y=this.position.y+.2,this.nodeToBeddingRight2.z=this.position.z+d;l=10*Math.sqrt(z1.distanceSquared(y,this.nodeToBeddingRight2));this.nodeToBeddingRight2.addConnection(y,l),y.addConnection(this.nodeToBeddingRight2,l),this.removeBeddingConnectionsUnderPlatform(y)}if(d=1,y=this.cage.bedding.getGraphNodeAt(i+c,this.position.y,this.position.z+d,null,u)){this.nodeToBeddingRight3||(this.nodeToBeddingRight3=this.createNodeToBedding(i+c,this.position.y,this.position.z+d)),this.nodeToBeddingRight3.x=i+c,this.nodeToBeddingRight3.y=this.position.y+.2,this.nodeToBeddingRight3.z=this.position.z+d;l=10*Math.sqrt(z1.distanceSquared(y,this.nodeToBeddingRight3));this.nodeToBeddingRight3.addConnection(y,l),y.addConnection(this.nodeToBeddingRight3,l),this.removeBeddingConnectionsUnderPlatform(y)}}}if(c*=-1,n){p=this.cage.bedding.getHeightAt2(o+c,this.position.z);if(this.position.y-p<.4){var u,y;if((u=Platform.z4[0]).x=-1,u.y=0,u.z=0,y=this.cage.bedding.getGraphNodeAt(o+c,this.position.y,this.position.z,null,u)){this.nodeToBeddingLeft1||(this.nodeToBeddingLeft1=this.createNodeToBedding(o+c,this.position.y,this.position.z)),this.nodeToBeddingLeft1.x=o+c,this.nodeToBeddingLeft1.y=this.position.y+.2,this.nodeToBeddingLeft1.z=this.position.z;l=10*Math.sqrt(z1.distanceSquared(y,this.nodeToBeddingLeft1));this.nodeToBeddingLeft1.addConnection(y,l),y.addConnection(this.nodeToBeddingLeft1,l),this.removeBeddingConnectionsUnderPlatform(y)}if(d=-1,y=this.cage.bedding.getGraphNodeAt(o+c,this.position.y,this.position.z+d,null,u)){this.nodeToBeddingLeft2||(this.nodeToBeddingLeft2=this.createNodeToBedding(o+c,this.position.y,this.position.z+d)),this.nodeToBeddingLeft2.x=o+c,this.nodeToBeddingLeft2.y=this.position.y+.2,this.nodeToBeddingLeft2.z=this.position.z+d;l=10*Math.sqrt(z1.distanceSquared(y,this.nodeToBeddingLeft2));this.nodeToBeddingLeft2.addConnection(y,l),y.addConnection(this.nodeToBeddingLeft2,l),this.removeBeddingConnectionsUnderPlatform(y)}if(d=1,y=this.cage.bedding.getGraphNodeAt(o+c,this.position.y,this.position.z+d,null,u)){this.nodeToBeddingLeft3||(this.nodeToBeddingLeft3=this.createNodeToBedding(o+c,this.position.y,this.position.z+d)),this.nodeToBeddingLeft3.x=o+c,this.nodeToBeddingLeft3.y=this.position.y+.2,this.nodeToBeddingLeft3.z=this.position.z+d;l=10*Math.sqrt(z1.distanceSquared(y,this.nodeToBeddingLeft3));this.nodeToBeddingLeft3.addConnection(y,l),y.addConnection(this.nodeToBeddingLeft3,l),this.removeBeddingConnectionsUnderPlatform(y)}}}if(!this.beddingConnectedAbove){for(var g=this.cage.bedding.sideHeights,m=!1,f=0;f<g.length;f++){if(g[f]+this.cage.bedding.position.y>this.position.y){m=!0;break}}m&&this.cage.bedding.refreshFloorConnections()}}}},Platform.prototype.createNodeToBedding=function(t,e,o){var i=new GraphNode(t,e,o);A.app.graph.addNode(i);var n=this.getGraphNodeAt(t,e,-1.5),s=Math.sqrt(z1.distanceSquared(n,i));n.addConnection(i,s),i.addConnection(n,s);var a=Math.sqrt(z1.distanceSquared(n,i));return(n=this.getGraphNodeAt(t,e,o)).addConnection(i,a),i.addConnection(n,a),i.data.obj2=this,i.data.obj=this.cage,i.data.enterEvent=A.PlatformEvents.CLIMB_ONTO,this.nodes.push(i),i},Platform.prototype.checkTubeConnections=function(){if(this.cage){var t=this._tempArray;t.length=0,A.Tube.getObjectsAt(this.position.x,this.position.y,this.position.z,this.width+1,this.height+1,this._tempArray);for(var e=0;e<t.length;e++)t[e].checkPlatformConnection(this)}},Platform.prototype.checkCageConnectorConnections=function(){for(var t=this.cage.connectors,e=0;e<t.length;e++){var o=t[e];if(o.cage1==this.cage||o.cage2==this.cage){if(Math.abs(o.position.x-this.position.x)>.5*this.width)continue;if(o.position.y-this.position.y<0)continue;if(1<o.position.y-this.position.y)continue;t[e].refreshConnections()}}},Platform.prototype.checkCageConnections=function(){this.cage&&this.checkCageConnectorConnections()},Platform.prototype.checkPlatformConnections=function(){if(this.cage)for(var t=this.cage.objs,e=this.position,o=e.x-.5*this.width,i=e.x+.5*this.width,n=0;n<t.length;n++){var s=t[n];if(!s.skipConnect&&(s!=this&&s.accType==A.z1044.z1049)){var a=s.position,r=e.y-a.y;if(!(.1<r||r<-.1)){var c=a.x-.5*s.width,d=a.x+.5*s.width;Math.abs(c-i)<.1?(this.connectToPlatform(s),(this.platformToRight=s).onAfterConnect(this)):Math.abs(o-d)<.1&&(this.connectToPlatform(s),(this.platformToLeft=s).onAfterConnect(this))}}}},Platform.prototype.checkRampConnections=function(){if(this.cage)for(var t=this.cage.objs,e=0;e<t.length;e++)t[e].skipConnect||t[e].accType==A.z1044.z1046&&t[e].checkPlatformConnection(this)},Platform.prototype.checkBridgeConnections=function(){if(this.cage)for(var t=this.cage.objs,e=0;e<t.length;e++)t[e].skipConnect||t[e].accType==A.z1044.z1050&&t[e].checkPlatformConnection(this)},Platform.prototype.checkSwingConnections=function(){if(this.cage)for(var t=this.cage.objs,e=0;e<t.length;e++)t[e].skipConnect||t[e].accType==A.z1044.SWING&&t[e].checkPlatformConnection(this)},Platform.prototype.connectToPlatform=function(t){var e=this.nodes,o=t.nodes,i=3,n=3;1<this.width&&(i=6),1<t.width&&(n=6);for(var s=0;s<i;s++)for(var a=e[s],r=0;r<n;r++){var c=o[r],d=a.x-c.x,p=a.z-c.z,l=d*d+p*p;if(l<2.25){var u=Math.sqrt(l);a.addConnection(c,u),c.addConnection(a,u)}}},Platform.prototype.addHoleAt=function(t,e,o,i){for(var n=t-this.position.x,s=e-this.position.y,a=o-this.position.z,r=9999,c=0;c<this.holes.length;c++){var d=this.holes[c],p=d.x-n,l=d.y-s,u=d.z-a,y=p*p+l*l+u*u;if(y<.09){this.body.shapes.addHole(d),d.active=!0,c;break}y<r&&(r=y)}},Platform.prototype.removeHoleAt=function(t,e,o){for(var i=t-this.position.x,n=e-this.position.y,s=o-this.position.z,a=0;a<this.holes.length;a++){var r=this.holes[a],c=r.x-i,d=r.y-n,p=r.z-s;if(c*c+d*d+p*p<.09){this.body.shapes.removeHole(r),a,r.active=!1;break}}},Platform.getObjectsAt=function(t,e,o,i,n,s,a){var r,c=Platform.activeObjects;a&&(c=a);for(var d=c.length,p=t-.5*i,l=t+.5*i,u=e-.5*n,y=e+.5*n,g=0;g<d;g++){var m=(r=c[g]).position.x-.5*r.width,f=r.position.x+.5*r.width,A=r.position.y,b=r.position.y;f<=p||l<=m||y<=b||A<=u||s.push(r)}},Platform.prototype.getChildren=function(){return this.objs},Platform.prototype.addObject=function(t){this.objs.indexOf(t)<0&&this.objs.push(t)},Platform.prototype.removeObject=function(t){var e=this.objs.indexOf(t);0<=e&&this.objs.splice(e,1)},Platform.prototype.removeFood=function(t){var e=this.food.indexOf(t);-1!==e&&this.food.splice(e,1)},Platform.prototype.addFood=function(t){-1==this.food.indexOf(t)&&this.food.push(t)},Object.defineProperty(Platform.prototype,"connectedPlatformsWidth",{get:function(){return this._connectedPlatformsWidth},set:function(t){this._connectedPlatformsWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(Platform.prototype,"connectedPlatformsCenterX",{get:function(){return this._connectedPlatformsCenterX},set:function(t){this._connectedPlatformsCenterX=t},enumerable:!1,configurable:!0}),Platform.prototype.refreshPlatformConnected=function(){for(var t=this.position.x+.5*this.width,e=this.platformToRight;e;)t+=this.width,e=e.platformToRight;var o=this.position.x-.5*this.width;for(e=this.platformToLeft;e;)o-=e.width,e=e.platformToLeft;this.connectedPlatformsCenterX=.5*(o+t),this.connectedPlatformsWidth=t-o;for(e=this.platformToRight;e;)e.connectedPlatformsWidth=this.connectedPlatformsWidth,e.connectedPlatformsCenterX=this.connectedPlatformsCenterX,e=e.platformToRight;for(e=this.platformToLeft;e;)e.connectedPlatformsWidth=this.connectedPlatformsWidth,e.connectedPlatformsCenterX=this.connectedPlatformsCenterX,e=e.platformToLeft},Platform.prototype.keepPosInside=function(t){var e=this.position.x-.5*this.width,o=this.cage;if(o){var i=.05,n=this.position.y+i;if(t.y<n){if(.2<n-t.y)return;t.y=n}for(var s=this.body.position,a=0;a<this.holes.length;a++){var r=this.holes[a],c=t.x-r.x+s.x,d=t.z-r.z+s.z;if(c*c+d*d<r.radius*r.radius)return}if(!(o.left-e<-.3&&t.x<e)){var p=this.position.x+.5*this.width;.3<o.right-p&&t.x>p||(i=.05,t.x>o.right-i&&(t.x=o.right-i),t.x<o.left+i&&(t.x=o.left+i))}}},Platform.tempVecs=[new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3],Platform.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],Platform.count=0,Platform.activeObjects=[],Platform}(A.z1092);A.Platform=t}(z0||(z0={})),function(o){var t=function(n){function Platform1(t){var e=n.call(this,t)||this;return e._colors={},e._colors.platform=new BABYLON.Color3,o.z1073.SetColor3FromHex("#82ff82",e._colors.platform),e}return __extends(Platform1,n),Platform1.prototype.setColor=function(t,e,o,i){n.prototype.setColor.call(this,t,e,o,i),this.color.r==t&&this.color.g==e&&this.color.b==o||(this.color.r=t,this.color.g=e,this.color.b=o,this.onChangeObservable.notifyObservers(this),this.propsNeedToBeSaved=!0)},Platform1}(o.Platform);o.Platform1=t}(z0||(z0={})),function(o){var t=function(){function Platform1Config(){this.objName="p1",o.Platform1.objectCount=Platform1Config.maxObjects}return Platform1Config.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,o.Platform1,{world:t,width:1,shapeName:this.objName})},Platform1Config.prototype.getSceneFileNames=function(t){},Platform1Config.prototype.getCreateMeshFunctions=function(t){t.Platform1x4MenuButton=this._createMeshes},Platform1Config.prototype._createMeshes=function(t,e){var o=BABYLON.MeshBuilder.CreatePlane("Platform1x4MenuButton",{width:1.3,height:1.3},t);t.removeMesh(o),o.bakeCurrentTransformIntoVertices(),e.Platform1x4MenuButton=o},Platform1Config.prototype.getSPSData=function(t){var e=Platform1Config.maxObjects;t.push({shapeName:this.objName,meshName:"platform1x4Hole",numInstances:e,maxInstances:e,isPickable:!0}),t.push({shapeName:this.objName,meshName:"platform1x4Hole",numInstances:1,maxInstances:1,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"Platform1x4MenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:o.App.menuRenderingGroupID})},Platform1Config.prototype.getTextureDrawFunctions=function(t){},Platform1Config.prototype.getz49s=function(t){t.push(o.z131),t.push(o.z96)},Platform1Config.prototype.getListenerSetups=function(t){t.push({event:o.PlatformEvents.CLIMB_ONTO,state:o.z131})},Platform1Config.prototype.getz1064Items=function(t){t.push(new o.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Bridges",order:3,countLabelY:-.4,menuWidth:1.5}))},Platform1Config.maxObjects=10,Platform1Config}();o.Platform1Config=t,o.App.AddEntityConfig(new t)}(z0||(z0={})),function(o){var t=function(n){function Platform2(t){var e=n.call(this,t)||this;return e.mapPlacementInfo=new o.MapPlacementInfo({mapOffsetX:-.5,mapOffsetY:-.5,mapOffsetDropTargetX:.5,mapOffsetDropTargetY:.5}),e._colors={},e._colors.platform=new BABYLON.Color3,o.z1073.SetColor3FromHex("#a7a7ff",e._colors.platform),e}return __extends(Platform2,n),Platform2.prototype.init=function(t){this.isMenuItem||this.holes[1]||(this.holes[0]=new OIMO.Hole(-.5,0,0,.3,0,1,0),this.holes[1]=new OIMO.Hole(.5,0,0,.3,0,1,0)),n.prototype.init.call(this,t)},Platform2.prototype.setColor=function(t,e,o,i){n.prototype.setColor.call(this,t,e,o,i),this.color.r==t&&this.color.g==e&&this.color.b==o||(this.color.r=t,this.color.g=e,this.color.b=o,this.onChangeObservable.notifyObservers(this),this.propsNeedToBeSaved=!0)},Platform2}(o.Platform);o.Platform2=t}(z0||(z0={})),function(o){var t=function(){function Platform2Config(){this.objName="p2",o.Platform2.objectCount=Platform2Config.maxObjects}return Platform2Config.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,o.Platform2,{world:t,width:2,shapeName:this.objName})},Platform2Config.prototype.getSceneFileNames=function(t){},Platform2Config.prototype.getCreateMeshFunctions=function(t){t.Platform2x4MenuButton=this._createMeshes},Platform2Config.prototype._createMeshes=function(t,e){var o=BABYLON.MeshBuilder.CreatePlane("Platform2x4MenuButton",{width:2.3,height:1.3},t);t.removeMesh(o),o.bakeCurrentTransformIntoVertices(),e.Platform2x4MenuButton=o},Platform2Config.prototype.getSPSData=function(t){var e=Platform2Config.maxObjects;t.push({shapeName:this.objName,meshName:"platform2x4Hole2",numInstances:e,maxInstances:e,isPickable:!0}),t.push({shapeName:this.objName,meshName:"platform2x4Hole2",numInstances:1,maxInstances:1,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"Platform2x4MenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:o.App.menuRenderingGroupID})},Platform2Config.prototype.getTextureDrawFunctions=function(t){},Platform2Config.prototype.getz1064Items=function(t){t.push(new o.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Bridges",order:4,countLabelY:-.4,menuWidth:2.5}))},Platform2Config.maxObjects=10,Platform2Config}();o.Platform2Config=t,o.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(){function PlatformEvents(){}return PlatformEvents.CLIMB_ONTO=t.AppEvents.GetUniqueID(),PlatformEvents}();t.PlatformEvents=e}(z0||(z0={})),function(c){var t,e;t=c.z156||(c.z156={}),e=function(t){function z714(){return null!==t&&t.apply(this,arguments)||this}return __extends(z714,t),z714.prototype.update=function(t){var e=t.path[t.pathIndex];if(e){var o=e.data.obj2;if(o&&o.accType==c.z1044.z1049){var i=o.position,n=t.physics.frontBody.body.position,s=n.x-i.x,a=n.y-i.y;if(e.data.enterEvent==c.PlatformEvents.CLIMB_ONTO){var r=.5*o.width+.75*t.size;s<r&&-r<s&&a>.5*t.size&&t.incrementPathIndex()}}}},z714}(z767),t.z714=e}(z0||(z0={})),function(c){var t,e;t=c.z156||(c.z156={}),e=function(t){function z624(){return null!==t&&t.apply(this,arguments)||this}return __extends(z624,t),z624.prototype.update=function(t){if(!t.isTouchingGround()){var e=t.path[t.pathIndex];if(e){var o=e.data.obj2;if(o&&o.accType==c.z1044.z1049){var i=o.position,n=t.physics.frontBody.body.position,s=n.x-i.x,a=n.y-i.y;if(e.data.enterEvent==c.PlatformEvents.CLIMB_ONTO){var r=.5*o.width+1.5*t.size;if(s<r&&-r<s&&-.05<a)0<(t.physics.touchingAccTypes&c.z1044.z1049)&&t.forceTouchGround()}}}}},z624}(z767),t.z624=e}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z604(){return null!==t&&t.apply(this,arguments)||this}return __extends(z604,t),z604.prototype.update=function(t){var e=t.path[t.pathIndex];e&&e.data.enterEvent==o.PlatformEvents.CLIMB_ONTO&&t.incrementPathIndex()},z604}(z767),t.z604=e}(z0||(z0={})),function(l){var t,e;t=l.z156||(l.z156={}),e=function(e){function z530(){var t=null!==e&&e.apply(this,arguments)||this;return t.plat_stretch=.3,t.TEST_REACH_LERP=.3,t}return __extends(z530,e),z530.prototype.update=function(t){var e=!1,o=t.path[t.pathIndex];if(o){var i=o.data.obj2;if(i&&i.accType==l.z1044.z1049){var n=i.position,s=t.physics.frontBody.body.position,a=s.x-n.x,r=s.y-n.y;if(o.data.enterEvent==l.PlatformEvents.CLIMB_ONTO){var c=.5*i.width+1.5*t.size;a<c&&-c<a&&-.05<r&&(e=!0)}if(e){var d=this.TEST_REACH_LERP,p=this.plat_stretch;t.physics.stretchJoints(p,d)}else 1e-4<t.physics.stretchFrac&&t.physics.stretchJoints(.95*t.physics.stretchDist)}}},z530}(z767),t.z530=e}(z0||(z0={})),function(l){var t,e;t=l.z156||(l.z156={}),e=function(t){function z252(){return null!==t&&t.apply(this,arguments)||this}return __extends(z252,t),z252.prototype.update=function(t){var e=t.path[t.pathIndex];if(e){var o=e.data.obj2;if(o&&o.accType==l.z1044.z1049){var i=o.cage,n=t.physics.frontBody.body.position,s=null;-.5<n.z&&n.z<.5&&(s=i.getObjectAt(n.x,n.y+.3,n.z,l.z1044.z1046));var a=t.targets.pathTarget,r=t.targets.lookToTarget,c=.2,d=t.path[t.pathIndex+1],p=1;n.x<o.position.x&&(p=-1),a.x=e.x,a.y=e.y,a.z=n.z,s&&(n.z<0?a.z=-.5:a.z=.5),t.physics.touchingAccTypes&l.z1044.z1054&&.5<a.z&&(a.z=.5),r.x=a.x,r.y=a.y,r.z=a.z,n.y<o.position.y&&(c=.1),e.data.enterEvent==l.PlatformEvents.CLIMB_ONTO?(a.x=e.x-p*c,a.y=e.y+.2,.2<o.position.y-n.y?a.y=o.position.y:.2<a.y-n.y&&(a.y=e.y),r.x=e.x-.2*p,r.y=e.y+0,t.targets.upVecTarget.x=.707*p,t.targets.upVecTarget.y=.707,t.targets.upVecTarget.z=0):d&&r.copyFrom(d),t.targets.moveToTarget.copyFrom(a),t.targets.standToTarget.copyFrom(a)}}},z252}(z767),t.z252=e}(z0||(z0={})),function(s){var t,e;t=s.z156||(s.z156={}),e=function(t){function z241(){return null!==t&&t.apply(this,arguments)||this}return __extends(z241,t),z241.prototype.update=function(t){var e=t.path[t.pathIndex];if(e){var o=e.data.obj2;if(o&&o.accType==s.z1044.z1049){var i=t.physics.frontBody.body.position,n=t.targets.pathTarget;n.x=e.x-o.position.x+e.x,n.y=o.position.y,n.z=i.z,t.targets.setTargetsToPathTarget(),t.targets.lookToTarget.copyFrom(e)}}},z241}(z767),t.z241=e}(z0||(z0={})),function(c){var t,e;t=c.z768||(c.z768={}),e=function(t){function z894(){return null!==t&&t.apply(this,arguments)||this}return __extends(z894,t),z894.prototype.test=function(t){var e=t.path[t.pathIndex];if(!e)return!1;var o=e.data.obj2;if(!o||o.accType!=c.z1044.z1049)return!1;var i=o.position,n=t.physics.middleBody.body.position,s=n.x-i.x,a=n.y-i.y,r=.5*o.width;return s<r&&-r<s&&a>.5*t.size},z894}(z770),t.z894=e}(z0||(z0={})),function(s){var t,e;t=s.z768||(s.z768={}),e=function(t){function z886(){return null!==t&&t.apply(this,arguments)||this}return __extends(z886,t),z886.prototype.test=function(t){var e=t.path[t.pathIndex];if(e){var o=e.data.obj2;if(o&&o.accType==s.z1044.z1049){var i=t.physics.frontBody.body.position.x-o.position.x,n=.5*o.width+2*t.size;return n<i||i<-n}}},z886}(z770),t.z886=e}(z0||(z0={})),function(a){var t,e;t=a.z768||(a.z768={}),e=function(t){function z842(){return null!==t&&t.apply(this,arguments)||this}return __extends(z842,t),z842.prototype.test=function(t){var e=t.path[t.pathIndex];if(e){var o=e.data.obj2;if(o&&o.accType==a.z1044.z1049){var i=t.physics.frontBody.body.position,n=i.x-o.position.x,s=i.y-o.position.y;return n<.5*o.width&&n>.5*-o.width&&s<0}}},z842}(z770),t.z842=e}(z0||(z0={})),function(i){var t,e;t=i.z768||(i.z768={}),e=function(t){function z811(){return null!==t&&t.apply(this,arguments)||this}return __extends(z811,t),z811.prototype.test=function(t){var e=t.path[t.pathIndex];if(!e)return!0;var o=e.data.obj2;return!o||o.accType!=i.z1044.z1049||void 0},z811}(z770),t.z811=e}(z0||(z0={})),function(o){var t=function(e){function z131(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.enterz156=[o.z156.z406],t.updatez156=[o.z156.z252,o.z156.z714,o.z156.z687,o.z156.z624,o.z156.z530,o.z156.z461,o.z156.z446,o.z156.z590,o.z156.z214,o.z156.z369,o.z156.z362,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z379,o.z156.z442],t.exitz156=[o.z156.z494],t.states=[],t.transitions=[{condition:o.z768.z894,trueNode:{state:o.z66,actions:[o.z156.z604]}},{condition:o.z768.z811,trueNode:{state:o.z66,actions:[o.z156.z604]}},{condition:o.z768.z842,trueNode:{state:o.z96,actions:[]}},{condition:o.z768.z873,trueNode:{state:o.z65,actions:[]}}],t}return __extends(z131,e),z131}(z49);o.z131=t}(z0||(z0={})),function(o){var t=function(e){function z96(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.enterz156=[],t.updatez156=[o.z156.z241,o.z156.z599,o.z156.z624,o.z156.z461,o.z156.z446,o.z156.z590,o.z156.z214,o.z156.z369,o.z156.z362,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z379,o.z156.z442],t.exitz156=[],t.states=[],t.transitions=[{condition:o.z768.z886,trueNode:{state:o.z66,actions:[]}},{condition:o.z768.z811,trueNode:{state:o.z66,actions:[o.z156.z604]}},{condition:o.z768.z861,trueNode:{condition:o.z768.z845,trueNode:{condition:o.z768.z932,trueNode:{state:o.z67}}}}],t}return __extends(z96,e),z96}(z49);o.z96=t}(z0||(z0={})),function(S){var t=function(p){function Ramp(t){var e=p.call(this)||this;return e.accType=S.z1044.z1046,e.centerGraphNode=void 0,e.lowCenterNode=void 0,e.highCenterNode=void 0,e.nodes=[],e.num=0,e.world=void 0,e.body=void 0,e.boxSize=1,e.rotation=BABYLON.Vector3.Zero(),e.rotationMatrix=BABYLON.Matrix.Identity(),e.floorThickness=0,e.treads=[],e.rampConnectedLeft=!1,e.rampConnectedRight=!1,e._platformAbove=null,e._platformConnectedAbove=!1,e._platformConnectedTopSide=!1,e._platformConnectedLowRight=!1,e._platformConnectedLowLeft=!1,e._bridgeConnectedHigh=null,e._bridgeConnectedLow=null,e._tempArray=[],Ramp.count++,e.num=Ramp.count,e.shapeName="Ramp",e.position=BABYLON.Vector3.Zero(),e.scaling=new BABYLON.Vector3(1,1,1),e.placementType=S.PlacementType.GRID|S.PlacementType.z1048|S.PlacementType.MID,e._colors={},e._colors.ramp=new BABYLON.Color3,e._colors.treads=new BABYLON.Color3,S.z1073.SetColor3FromHex("#e1dabb",e._colors.ramp),S.z1073.SetColor3FromHex("#c2b475",e._colors.treads),e}return __extends(Ramp,p),Object.defineProperty(Ramp.prototype,"cage",{get:function(){return this._cage},set:function(t){t!=this._cage&&this.recycleConnectorAbove(),this._cage=t},enumerable:!1,configurable:!0}),Object.defineProperty(Ramp.prototype,"platformAbove",{get:function(){return this._platformAbove},set:function(t){this._platformAbove,this._platformAbove=t,this._platformConnectedAbove=!!t},enumerable:!1,configurable:!0}),Ramp.UpdateChildPositions=function(){for(var t=Ramp.activeObjects,e=0;e<t.length;e++)t[e].updateChildPositions()},Object.defineProperty(Ramp.prototype,"rampBelow",{get:function(){return this._rampBelow},set:function(t){this._rampBelow=t},enumerable:!1,configurable:!0}),Object.defineProperty(Ramp.prototype,"rampAbove",{get:function(){return this._rampAbove},set:function(t){this._rampAbove=t},enumerable:!1,configurable:!0}),Ramp.prototype.addToActiveObjects=function(){-1==Ramp.activeObjects.indexOf(this)&&Ramp.activeObjects.push(this)},Ramp.prototype.removeFromActiveObjects=function(){var t=Ramp.activeObjects.indexOf(this);-1!=t&&Ramp.activeObjects.splice(t,1)},Ramp.prototype.init=function(t){p.prototype.init.call(this,t),this.boxSize=1,t.boxSize&&(this.boxSize=t.boxSize),this.canRotate=!1,this.canTranslate=!0,this.canDelete=!0,this.world=t.world,this.addToActiveObjects();this.width,this.height;t.width&&(t.width,this.width=t.width),this.mapPlacementInfo||(this.mapPlacementInfo=new S.MapPlacementInfo({})),this.controlAnchor||this.addControlAnchor(),this.controlPositionLocal.x=0,this.controlPositionLocal.y=0;var e=this.controlPositionLocal.z=0,o=0,i=0;if(null!=t.x&&(e=t.x),null!=t.y&&(o=t.y),null!=t.z&&(i=t.z),this.rotation.z<0&&this.rotation.z,this.floorThickness=.04,t.isMenuItem&&t.isMenuItem,this.controlPositionLocal.y=.3,!this.connectorLeft){this.ramp=ObjectPool.get("z1068",{name:"RampPlank",renderingGroupID:this.renderingGroupID}),this.connectorLeft=ObjectPool.get("z1068",{name:"RampConnector",renderingGroupID:this.renderingGroupID}),this.connectorRight=ObjectPool.get("z1068",{name:"RampConnector",renderingGroupID:this.renderingGroupID});for(var n=0;n<3;n++){var s=ObjectPool.get("z1068",{name:"RampTread",renderingGroupID:this.renderingGroupID});this.treads.push(s)}}if(t.isMenuItem);else if(!this.hitMeshes){this.hitMeshes=[];var a=S.app.graphicsHelper.getHitMesh(this.boxSize-.01,.001,this.depth);a.rotationQuaternion=BABYLON.Quaternion.Identity(),this.hitMeshes.push(a);var r=[1,.4,.2,S.App.z1033,4294967295];this.depth=.5;this.body=new OIMO.Body({holes:[],size:[this.width-.2,.06,.5],pos:[0,0,0],rot:[0,0,0],world:this.world,config:r,type:"holey_box"}).body,this.body.shapes.floorThickness=.05,(this.body.shapes.entity=this).world=t.world;var c=this.width+.5,d=.5*(c/3);this.nodes=z1083.createNodeGrid(0,0,0,c,0,3,1,this,d),this.nodes[0].data.enterEvent,((this.nodes[0].data.obj=this).nodes[0].data.obj2=this).nodes[0].data.enterEvent=S.RampEvents.USE,this.nodes[0].data.enterNextNode=this.nodes[1],((((this.nodes[1].data.obj=this).nodes[1].data.obj2=this).nodes[2].data.obj=this).nodes[2].data.obj2=this).nodes[2].data.enterEvent=S.RampEvents.USE,this.nodes[2].data.enterNextNode=this.nodes[1],this.centerGraphNode=this.nodes[1],this.lowCenterNode=new GraphNode(0,0,0),((this.lowCenterNode.data.obj=this).lowCenterNode.data.obj2=this).lowCenterNode.data.enterEvent=S.RampEvents.USE,this.lowCenterNode.data.enterNextNode=this.centerGraphNode,S.app.graph.addNode(this.lowCenterNode),this.nodes.push(this.lowCenterNode),this.highCenterNode=new GraphNode(0,0,0),((this.highCenterNode.data.obj=this).highCenterNode.data.obj2=this).highCenterNode.data.enterEvent=S.RampEvents.USE,this.highCenterNode.data.enterNextNode=this.centerGraphNode,S.app.graph.addNode(this.highCenterNode),this.nodes.push(this.highCenterNode),this.centerGraphNode.data.enterEvent=S.RampEvents.USE;this.lowCenterNode.addConnection(this.centerGraphNode,.66),this.centerGraphNode.addConnection(this.lowCenterNode,.66),this.highCenterNode.addConnection(this.centerGraphNode,.66),this.centerGraphNode.addConnection(this.highCenterNode,.66),this.navigator=new S.RampNavigator,this.navigator.init({accessory:this,radius:.5*this.width})}this._initColors(),t.rz&&this.setRotation(0,0,t.rz),t.skipAddToScene?this.removeFromScene():(this.setPosition(e,o,i),this.addToScene())},Ramp.prototype.updateNodes=function(){if(this.nodes&&0!=this.nodes.length){var t=this.width+.5,e=.5*(t/3);z1083.resetNodeGrid(this.nodes,this.position.x,this.position.y+0,this.position.z,t,0,3,1,this.cage,e),z1083.RotateNodesToBody(this.nodes,this.body),this.lowNode=this.nodes[0],this.highNode=this.nodes[2],this.lowNode.y>this.highNode.y&&(this.lowNode=this.nodes[2],this.highNode=this.nodes[0]),this.highCenterNode.data.obj=this.cage,this.highCenterNode.x=this.centerGraphNode.x+.1,this.highCenterNode.y=this.centerGraphNode.y,this.highCenterNode.z=this.centerGraphNode.z,this.lowCenterNode.data.obj=this.cage,this.lowCenterNode.x=this.centerGraphNode.x-.1,this.lowCenterNode.y=this.centerGraphNode.y,this.lowCenterNode.z=this.centerGraphNode.z,this.lowNode.y+=.15,this.keepNodeInCage(this.nodes[0]),this.keepNodeInCage(this.nodes[2])}},Ramp.prototype.keepNodeInCage=function(t){if(this.cage){t.y,this.centerGraphNode.y;var e=this.cage.position.x-.5*this.cage.width+.15,o=this.cage.position.x+.5*this.cage.width-.15,i=t.x;t.x<e?t.x=e:t.x>o&&(t.x=o),i!=t.x&&t.y<this.centerGraphNode.y&&(t.y+=.7*(this.centerGraphNode.y-t.y))}},Ramp.prototype.setPositionOnMapFromDrop=function(t,e,o){p.prototype.setPositionOnMapFromDrop.call(this,t,e,o)},Ramp.prototype.setHitMesh=function(t,e,o){if(this.hitMeshes&&this.hitMeshes[0]){var i=this.hitMeshes[0];i.position.x=t,i.position.y=e,i.position.z=o,i.computeWorldMatrix()}},Ramp.prototype._translateNodes=function(t,e,o){for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i];n.x+=t,n.y+=e,n.z+=o}},Ramp.prototype.setPositionDrag=function(t,e,o,i){var n=t-this.position.x,s=e-this.position.y,a=o-this.position.z;if(p.prototype.setPositionDrag.call(this,t,e,o,i),this.body){var r=this.body.position,c=this.position;r.x=c.x,r.y=c.y,r.z=c.z;var d=this.body.shapes.position;d.x=c.x,d.y=c.y,d.z=c.z,this.body.shapes.updateProxy()}this.updateChildPositions(),this.setHitMesh(t,e,o),this.nodes&&this.nodes.length&&this._translateNodes(n,s,a),this.navigator&&this.navigator.setPosition(t,e,o),i&&this.updateCage(),this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position)},Ramp.prototype.updateCage=function(){var t=S.Cage.getCageAt(this.position.x,this.position.y,this.position.z);this.addToObject(t)},Ramp.prototype.setPosition=function(t,e,o,i){void 0===i&&(i=!1);var n=e,s=(this.position.x,this.position.y,this.position.z);this.position.x=t,this.position.y=e;this.position.z=o;if(this.position.x=t,this.position.y=n,this.position.z=o,!i){if(this.body){var a=this.body.position,r=this.position;a.x=r.x,a.y=r.y-.02,a.z=r.z,this.body.syncShapes();var c=S.Cage.getCageAt(t,e,o);c!=this.cage?(this.cage&&this.cage.removeObject(this),c?this.addToObject(c):this.disconnect()):(this.disconnect(),this.updateNodes(),this.checkConnections())}this.navigator&&this.navigator.setPosition(t,e,o)}if(this.updateChildPositions(),this.setHitMesh(t,n,o),this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position),this._connected=!0,!this.isMenuItem)s=z1.roundToDecimalPlace(this.position.z,2);this.onChangeObservable.notifyObservers(this)},Ramp.prototype.updateChildPositions=function(){for(var t=this.position.x,e=this.position.y,o=this.position.z,i=this.width/(this.treads.length+1),n=.5*-this.width+i,s=0;s<this.treads.length;s++)this.updateChildPosition(this.treads[s],n+i*s,.04,0);var a=Ramp.coffsetX,r=Ramp.coffsetY;this.rampConnectedLeft&&(r=0),this.updateChildPosition(this.connectorLeft,.5*-this.width+a,r,0);a=Ramp.coffsetX,r=Ramp.coffsetY;if(this.rotation.z<0&&(r*=-1),this.rampConnectedRight&&(r=0),this.updateChildPosition(this.connectorRight,.5*this.width-a,r,0),this.cage){var c=this.cage,d=c.position.x-.5*c.width+.02+.04,p=c.position.x+.5*c.width-.02-.04,l=c.position.y+.04+.04,u=c.position.y+c.height-.04-.04,y=this.position.x-.5+.05,g=this.position.x+.5-.05,m=this.position.y-.5+.05,f=this.position.y+.5-.05;this.keepChildInBox(this.connectorLeft,d,p,l,u)&&this.keepChildInBox(this.connectorLeft,y,g,m,f),this.keepChildInBox(this.connectorRight,d,p,l,u)&&this.keepChildInBox(this.connectorRight,y,g,m,f)}var A=0,b=0;if(this.cage){var v=this.cage.position.x-.5*this.cage.width,x=this.cage.position.x+.5*this.cage.width,C=this.cage.position.y,S=this.cage.position.y+this.cage.height,T=this.rotation.z;0<T&&t-v<1&&e-C<1?b=A=.02:T<0&&t-v<1&&S-e<1?b=-(A=.02):T<0&&x-t<1&&e-C<1?(A=-.02,b=.02):0<T&&x-t<1&&S-e<1&&(b=A=-.02)}this.ramp.setPosition(t+A,e+b,o)},Ramp.prototype.keepChildInBox=function(t,e,o,i,n,s,a){var r=t.position.x,c=t.position.y,d=t.position.z,p=r,l=c,u=d;if(p<e&&(p=e),o<p&&(p=o),l<i&&(l=i),n<l&&(l=n),null!=s&&u<s&&(u=s),null!=a&&a<u&&(u=a),p!=r||l!=c||u!=d)return t.setPosition(p,l,u),!0},Ramp.prototype.updateChildPosition=function(t,e,o,i){t.position.x=e,t.position.y=o,t.position.z=i,BABYLON.Vector3.TransformCoordinatesToRef(t.position,this.rotationMatrix,t.position);var n=t.position.x+this.position.x,s=t.position.y+this.position.y,a=t.position.z+this.position.z;t.setPosition(n,s,a)},Ramp.prototype.setRotation=function(t,e,o){this.rotation.x=t,this.rotation.y=e,this.rotation.z=o,BABYLON.Quaternion.RotationYawPitchRollToRef(e,t,o,this.rotationQuaternion),BABYLON.Matrix.FromQuaternionToRef(this.rotationQuaternion,this.rotationMatrix),this.hitMeshes,this.body&&(this.setBodyRotationQuaternion(this.rotationQuaternion),this.updateNodes());for(var i=0;i<this.treads.length;i++)this.treads[i].setRotation(t,e,o);this.rampConnectedLeft&&this.connectorLeft.setRotation(t,e,o),this.rampConnectedRight&&this.connectorRight.setRotation(t,e,o),this.ramp.setRotation(t,e,o),this.updateChildPositions(),this.onChangeObservable.notifyObservers(this)},Ramp.prototype.getGraphNodeAt=function(t,e,o,i,n,s){void 0===i&&(i=!1),void 0===n&&(n=null),void 0===s&&(s=0);var a,r,c=this.nodes,d=c.length,p=Number.MAX_VALUE,l=Ramp.tempVecs[0],u=!1;this.position.y+.5*this.boxSize<e&&(u=!0);for(var y=0;y<d;y++)if(!((a=c[y])==this.highCenterNode&&1==this.highCenterNode.connections.length||a==this.lowCenterNode&&1==this.lowCenterNode.connections.length)){var g=a.x-t,m=a.y-e,f=a.z-o,A=g*g+m*m+f*f;if(A<p){if(i&&0==a.type)continue;if(n)if(l.x=g,l.y=m,l.z=f,l.normalize(l),l.dot(n)<s)continue;if(u&&this._platformConnectedAbove&&0<a.y-this.position.y)continue;p=A,r=a}}return r},Ramp.prototype.addToScene=function(){if(!this.isOnScene){p.prototype.addToScene.call(this),this.body&&!this.body.parent&&this.world.addRigidBody(this.body);for(var t=0;t<this.treads.length;t++)this.treads[t].addToScene();this.ramp.addToScene(),this.connectorLeft.addToScene(),this.connectorRight.addToScene()}},Ramp.prototype.removeFromScene=function(){if(this.isOnScene){p.prototype.removeFromScene.call(this),this.isMenuItem||this.setPositionDrag(this.position.x,9999,this.position.z,!1),this.navigator&&this.navigator.setPosition(this.position.x,9999,this.position.z),this.body&&this.body.parent&&(this.body.position.y=9999,this.body.shapes.updateProxy(),this.body.shapes.position.y=this.body.position.y,this.world.removeRigidBody(this.body));for(var t=0;t<this.treads.length;t++)this.treads[t].removeFromScene();this.ramp.removeFromScene(),this.connectorLeft.removeFromScene(),this.connectorRight.removeFromScene()}},Ramp.prototype.disconnect=function(){if(this.body){this.skipConnect=!0;for(var t=this.nodes,e=t.length,o=0;o<e;o++)this.disconnectNode(t[o]);this.skipConnect=!1,this.recycleConnectorAbove(),this.rampAbove&&this.rampAbove.rampBelow==this&&(this.rampAbove.rampBelow=null),this.rampBelow&&this.rampBelow.rampAbove==this&&(this.rampBelow.rampAbove=null),this.rampAbove=null,this.rampBelow=null,this._platformConnectedTopSide=!1,this._platformConnectedLowLeft=!1,this._platformConnectedLowRight=!1,this._platformConnectedAbove=!1,this._bridgeConnectedHigh=null,this._bridgeConnectedLow=null,this._rampOverlapping&&(this._rampOverlapping._rampOverlapping=null,this._rampOverlapping=null)}},Ramp.prototype.setColor=function(t,e,o,i){if(p.prototype.setColor.call(this,t,e,o,i),"ramp"==i&&this.ramp.setColor(t,e,o),"treads"==i){for(var n=0;n<this.treads.length;n++)this.treads[n].setColor(t,e,o);this.connectorLeft.setColor(t,e,o),this.connectorRight.setColor(t,e,o)}},Ramp.prototype.getNeighborAt=function(t,e,o){for(var i,n=this.position.x,s=this.position.y+.5*this.height,a=this.position.z,r=this.nodes,c=t-n,d=e-s,p=0;p<r.length;p++){var l=r[p],u=l.x-n,y=l.y-s,g=l.z-a;if(!(.3<g||g<-.3)&&(!(c<0&&0<u)&&!(0<c&&u<0)&&!(d<0&&0<y)&&!(0<d&&y<0)&&(i=S.z1092.GetObjConnectedToNodeAt(l,t,e,o))))return i}},Ramp.prototype.getProps=function(){var t=p.prototype.getProps.call(this);return t.x=z1.roundToDecimalPlace(this.position.x,2),t.y=z1.roundToDecimalPlace(this.position.y,2),t},Ramp.prototype.isValidDropLocation=function(t,e,o){var i=this._tempDropLoc;this.getPositionOnMapFromDropToRef(t,e,o,i);var n=S.Cage.getCageAt(i.x,i.y,i.z);if(!n)return!1;var s=n.getObjectAt(i.x,i.y,i.z,S.z1044.z1046);if(s&&s.rotation.z==this.rotation.z)return!1;if(n.getObjectAt(i.x,i.y,i.z,S.z1044.z1051))return!1;var a=n.getObjectAt(i.x,i.y,i.z,S.z1044.z1050,1);if(a){var r=.5*this.width,c=a.width,d=a.height,p=a.position,l=p.x+.5*c+r,u=p.x-.5*c-r,y=p.y+d+.5,g=p.y-.5,m=i.x,f=i.y;if(u<m&&m<l&&g<f&&f<y)return!1}var A=n.getObjectAt(i.x,i.y,i.z,S.z1044.SWING,1);if(A){var b=.5*this.boxSize-.01,v=.5*A.width,x=A.height,C=A.position;l=C.x+v+b,u=C.x-v-b,y=C.y+x+b,g=C.y-b,m=i.x,f=i.y;if(u<m&&m<l&&g<f&&f<y)return!1}return!0},Ramp.prototype.recycleConnectorAbove=function(){if(this._connectorAbove){var t=this._connectorAbove;if(this._connectorAbove=null,this.platformAbove=null,this.highNode.removeConnection(t.botNode),t.botNode.removeConnection(this.highNode),1==t.botNode.connections.length){if(1<t.topNode.connections.length){var e=t.topNode.connections[1];t.topNode.removeConnection(e),e.removeConnection(t.topNode)}if(t.acc1&&t.acc1.removeHoleAt(t.acc1.position.x+t.acc1LocalPosition.x,t.acc1.position.y+t.acc1LocalPosition.y,t.acc1.position.z+t.acc1LocalPosition.z),this.cage){var o=this.cage.position.y+this.cage.height;-.6<this.position.y-o&&this.cage.removeHoleAt(t.position.x,t.position.y,t.position.z)}t.removeFromScene(),t.recycle(),ObjectPool.recycle(t)}}},Ramp.prototype.addToObject=function(t){this.cage&&this.cage!=t&&this.cage.removeObject(this),this.cage!=t&&(this.parent=t,(this.cage=t)&&(this.disconnect(),t.addObject(this),this.updateNodes(),this.checkConnections(),this.updateChildPositions()))},Ramp.prototype.isInBox=function(t,e,o,i){void 0===i&&(i=0);var n=this.position,s=.5*this.boxSize+i,a=.5*this.boxSize+i,r=.5*this.boxSize+i,c=n.x-s,d=n.x+s,p=n.y-r,l=n.y+r,u=n.z-a,y=n.z+a;return!(t<c||d<t||e<p||l<e||o<u||y<o)},Ramp.prototype.checkConnections=function(){this.body&&(this.checkSwingConnections(),this.checkBridgeConnections(),this.checkPlatformConnections(),this.checkTubeConnections(),this.checkCageConnections(),this.checkRampConnections(),this.checkBeddingConnections())},Ramp.prototype.checkTubeConnections=function(){if(this.cage){var t=this._tempArray;t.length=0,S.Tube.getObjectsAt(this.position.x,this.position.y,this.position.z,this.boxSize+1,this.boxSize+1,this._tempArray);for(var e=0;e<t.length;e++)this.checkTubeConnection(t[e])}},Ramp.prototype.checkTubeConnection=function(t){var e=t.position.x-this.position.x,o=t.position.y-this.position.y,i=t.position.z-this.position.z,n=this.lowCenterNode,s=this.highCenterNode,a=this.centerGraphNode,r=t.getGraphNodeAtClosestToOpening(a.x,a.y,a.z);if(!r.data.otherTube){var c=this.position.x+.5*this.boxSize,d=this.position.y-.5*this.boxSize+.15;this.lowNode.x<this.position.x&&(c=this.position.x-.5*this.boxSize);var p=r.x-c,l=r.y-d;if(p<.4&&-.4<p&&l<.4&&-.4<l){n.x=c+.7*(this.centerGraphNode.x-c),n.y=d+.7*(this.centerGraphNode.y-d),a=n;var u=(e=r.x-a.x)*e+(o=r.y-a.y)*o+(i=r.z-a.z)*i,y=Math.sqrt(u);return a.addConnection(r,y),r.addConnection(a,y),t.makeEnterNode(r),t.position.z-this.position.z<0?r.z-=.1:r.z+=.1,t.updateCovers(),!0}var g=r.x-a.x,m=r.y-a.y;if(g<.1&&-.1<g&&.3<m&&m<.7){u=(e=r.x-a.x)*e+(o=r.y-a.y)*o+(i=r.z-a.z)*i,y=Math.sqrt(u);if(a.addConnection(r,y),r.addConnection(a,y),t.makeEnterNode(r),r.connections[2]==a){var f=r.connections[1];r.removeConnection(f),f.removeConnection(r)}else if(r.connections[1]==a&&r.connections[2]){f=r.connections[2];r.removeConnection(f),f.removeConnection(r)}t.updateCovers()}else if(!this._connectorAbove){var A=this.position.x+.5*this.boxSize,b=this.position.y+.5*this.boxSize-.15;this.highNode.x<this.position.x&&(A=this.position.x-.5*this.boxSize);p=r.x-A,l=r.y-b;if(p<.4&&-.4<p&&0<l){if(r.connections[1]&&r.connections[1].data.tube)return;(a=s).x=this.highNode.x,a.y=this.highNode.y,a.z=this.highNode.z;e=r.x-a.x,o=r.y-a.y,i=r.z-a.z;if(t.cage!=this.cage){var v=this.cage.position.y+this.cage.height;if(r.y>v)return}u=e*e+o*o+i*i,y=Math.sqrt(u);return a.addConnection(r,y),r.addConnection(a,y),t.makeEnterNode(r),void t.updateCovers()}}}},Ramp.prototype.checkCageConnectorConnections=function(){for(var t=this.cage.connectors,e=0;e<t.length;e++){var o=t[e];o.cage1!=this.cage&&o.cage2!=this.cage||(Math.abs(o.position.x-this.highNode.x)<.4&&Math.abs(o.position.y-this.highNode.y)<.6?t[e].refreshConnections():Math.abs(o.position.x-this.lowNode.x)<.4&&Math.abs(o.position.y-this.lowNode.y)<.4&&t[e].refreshConnections())}},Ramp.prototype.onAfterConnect=function(){for(var t=0;t<this.lowNode.connections.length;t++){this.lowNode.connections[t].data.enterEvent==S.ConnectorCageEvents.ENTER&&(0<this.lowNode.x-this.centerGraphNode.x?this.lowNode.x=this.position.x+.2*this.boxSize:this.lowNode.x=this.position.x-.2*this.boxSize,this.lowNode.y=this.centerGraphNode.y-.001)}},Ramp.prototype.checkBeddingConnections=function(){if(this.cage&&this.cage.bedding&&!S.z1073.IsNodeConnectedToAccType(this.lowNode,S.z1044.z1049)){var t=null;t=this.cage.bedding.getGraphNodeAt(this.lowNode.x,this.lowNode.y,this.lowNode.z);var e=this.lowNode;if(this.position.y-.5-t.y<.3){var o=Math.sqrt(z1.distanceSquared(e,t));e.addConnection(t,o),t.addConnection(e,o)}}},Ramp.prototype.checkCageConnections=function(){if(this.cage&&0!=this.rotation.z){this.checkCageConnectorConnections();var t=this.lowNode,e=this.highNode,o=Ramp.z4[0];o.x=t.x-this.centerGraphNode.x,o.y=0,o.z=t.z-this.centerGraphNode.z,o.normalize();var i=(S.z1044.z1047,S.z1044.z1048);i=S.z1044.z1048;var n=this.cage.getGraphNodeAt(t.x,t.y,t.z,null,o,.1,null,i);if(!n){var s=this.cage.position.x+.5*this.cage.width,a=this.cage.position.x-.5*this.cage.width;s-t.x<.5&&(n=this.cage.getGraphNodeAt(t.x,t.y,t.z,null,null,null,null,i)),t.x-a<.5&&(n=this.cage.getGraphNodeAt(t.x,t.y,t.z,null,null,null,null,i))}if(n){var r=n.x-t.x,c=n.y-t.y,d=n.z-t.z,p=r*r+c*c+d*d;if(p<1){var l=Math.sqrt(p);t.addConnection(n,l),n.addConnection(t,l)}}if(this.cage.position.y+this.cage.height-e.y<.5*this.boxSize){var u=S.Cage.getCageAt(e.x,e.y+.5*this.boxSize,e.z);u&&this.connectToFloorAbove(u)}this.onAfterConnect()}},Ramp.prototype.connectToFloorAbove=function(t){var e=this.highNode,o=Ramp.z4[0];o.x=0,o.y=1,o.z=0;var i=Math.round(e.x),n=Math.floor(e.y)+.5,s=t.getGraphNodeAt(i,n,0,null,null,.8,null,S.z1044.z1048);if(s){var a=s.x-i,r=s.y-n,c=s.z-0;if(!(.2*.2<a*a+r*r+c*c)){var d=this.cage.position.y+this.height;if(-.6<this.position.y-d&&this.cage.addHoleAt(i,n,0,o),o.y=-1,t.addHoleAt(i,n,0,o),e.x+=.5*(i-e.x),e.y-=Math.abs(.5*(i-e.x)),!this._connectorAbove){var p=S.ConnectorFloor.getObjectAt(i,n,0);p||(1<this.highNode.connections.length&&this.disconnectNode(this.highNode,!0),p=ObjectPool.get(S.ConnectorFloor.name,{x:i,y:n,z:0,rz:0,cage1:t,cage2:this.cage})),(this._connectorAbove=p).acc1=t;var l=p.topNode,u=p.botNode,y=e;if(!s)return;var g=Math.sqrt(z1.distanceSquared(s,l));l.addConnection(s,g),s.addConnection(l,g);g=Math.sqrt(z1.distanceSquared(y,u));u.addConnection(y,g),y.addConnection(u,g)}}}},Ramp.prototype.checkPlatformConnection=function(t){if(!this.cage)return!1;var e=this.position,o=(e.x,this.boxSize,e.x,this.boxSize,t.position),i=e.x-o.x,n=e.y-o.y;e.z,o.z;return!(1.1<n||n<-1.1)&&(1.5<t.width&&Math.abs(i)<1.6?this.connectToPlatform(t):t.width<1.5&&Math.abs(i)<1.1&&this.connectToPlatform(t),!0)},Ramp.prototype.onAfterDisconnect=function(t){this._connectorAbove&&this._connectorAbove==t&&(this.recycleConnectorAbove(),this.isOnScene&&(this.updateNodes(),this.checkPlatformConnections(!0),this.checkTubeConnections(),this.checkCageConnectorConnections(),this.checkRampConnections())),t.accType==S.z1044.z1049&&t!=this.platformAbove&&this.cage.bedding&&this.checkBeddingConnections(),t.accType==S.z1044.z1051&&this.isOnScene&&this.checkCageConnections(),t.accType==S.z1044.z1046&&this.isOnScene&&(this.updateNodes(),this.checkConnections()),t.accType==S.z1044.z1050&&this.isOnScene&&(t==this._bridgeConnectedLow?this._bridgeConnectedLow=null:t==this._bridgeConnectedHigh&&(this._bridgeConnectedHigh=null),this.updateNodes(),this.checkCageConnections(),this.checkPlatformConnections(!0),this.checkTubeConnections(),this.checkCageConnectorConnections(),this.checkRampConnections())},Ramp.prototype.checkRampConnections=function(){if(this.cage)for(var t=this.cage.objs,e=0;e<t.length;e++)if(!t[e].skipConnect&&t[e].accType==S.z1044.z1046&&t[e]!=this){t[e].checkRampConnection(this);var o=t[e].position.x-this.position.x;o<.01&&-.01<o&&this.checkRampConnection(t[e])}},Ramp.prototype.checkRampConnection=function(t){if(!this.cage)return!1;var e,o,i=this.boxSize,n=.5*i,s=this.position,a=t.position,r=s.x-a.x,c=s.y-a.y,d=Math.abs(r),p=Math.abs(c);if((this.rotation.z==t.rotation.z&&n<d&&d<1.1*i&&n<p&&p<1.1*i&&(c<0?this.platformAbove||this.connectToRamp(t):t.platformAbove||this.connectToRamp(t)),!this.platformAbove&&this.rotation.z!=t.rotation.z&&-n<d&&d<n&&n<p&&p<1.1*i)&&(c<0?this.platformAbove||(e=this.connectToRamp(t,.4,.5,.5),o=this.highNode):t.platformAbove||(e=this.connectToRamp(t,.4,.5,.5),o=this.lowNode),e)){var l=e,u=o,y=t,g=this;e.y<o.y&&(l=o,u=e,y=this,g=t),u.x>this.position.x?(l.x=Math.min(this.position.x+.4*this.boxSize,l.x),u.x=Math.min(this.position.x+.3*this.boxSize,u.x)):(l.x=Math.max(this.position.x-.4*this.boxSize,l.x),u.x=Math.max(this.position.x-.3*this.boxSize,u.x)),l.y=y.position.y-.25*y.boxSize,(y.rampBelow=g).rampAbove=y}if(!this.platformAbove&&this.rotation.z!=t.rotation.z&&-.1<d&&d<.1&&-.1<p&&p<.1){var m=.5;((this._rampOverlapping=t)._rampOverlapping=this).centerGraphNode.addConnection(t.centerGraphNode,m),t.centerGraphNode.addConnection(this.centerGraphNode,m),this.centerGraphNode.y=this.position.y+.02,t.centerGraphNode.y=this.position.y+.02}if(this.rotation.z!=t.rotation.z&&n<d&&d<1.1*i&&c<.1&&-.1<c){if(r<0&&this.rotation.z<0||0<r&&0<this.rotation.z){m=Math.sqrt(z1.distanceSquared(t.lowNode,this.lowNode));this.lowNode.addConnection(t.lowNode,m),t.lowNode.addConnection(this.lowNode,m),this.lowNode.y=Math.max(this.position.y-.5*n,this.lowNode.y),t.lowNode.y=Math.max(t.position.y-.5*n,t.lowNode.y)}if(!this.platformAbove&&(0<r&&this.rotation.z<0||r<0&&0<this.rotation.z)){this._tempHighNodeBetween||(this._tempHighNodeBetween=new GraphNode(0,0,0),S.app.graph.addNode(this._tempHighNodeBetween)),this._tempHighNodeBetween.x=.5*(this.highNode.x+t.highNode.x),this._tempHighNodeBetween.y=.5*(this.highNode.y+t.highNode.y),this._tempHighNodeBetween.z=.5*(this.highNode.z+t.highNode.z);m=1;this.highNode.addConnection(this._tempHighNodeBetween,m),this._tempHighNodeBetween.addConnection(this.highNode,m),t.highNode.addConnection(this._tempHighNodeBetween,m),this._tempHighNodeBetween.addConnection(t.highNode,m)}}},Ramp.prototype.connectToRamp=function(t,e,o,i){void 0===e&&(e=.4),void 0===o&&(o=.3),void 0===i&&(i=.3);for(var n=this.nodes,s=t.nodes,a=0;a<n.length;a++){var r=n[a];if(r!=this.centerGraphNode&&(r!=this.highCenterNode&&r!=this.lowCenterNode))for(var c=0;c<s.length;c++){var d=s[c],p=r.x-d.x,l=r.y-d.y,u=r.z-d.z;if(d!=t.centerGraphNode&&!(o<l||l<-o||i<u||u<-i||e<p||p<-e)){var y=p*p+l*l+u*u,g=Math.sqrt(y);return r.addConnection(d,g),d.addConnection(r,g),d}}}return null},Ramp.prototype.checkBridgeConnections=function(){if(this.cage)for(var t=this.cage.objs,e=0;e<t.length;e++)if(!t[e].skipConnect&&t[e].accType==S.z1044.z1050){var o=t[e],i=o.checkRampConnection(this);i==this.lowNode&&(this._bridgeConnectedLow=o),i==this.highNode&&(this._bridgeConnectedHigh=o)}},Ramp.prototype.checkSwingConnections=function(){if(this.cage)for(var t=this.cage.objs,e=0;e<t.length;e++)if(!t[e].skipConnect&&t[e].accType==S.z1044.SWING)t[e].checkRampConnection(this)},Ramp.prototype.checkPlatformConnections=function(t){if(void 0===t&&(t=!1),this.cage)for(var e=this.cage.objs,o=0;o<e.length;o++)if(!e[o].skipConnect&&e[o].accType==S.z1044.z1049){if(t){var i=e[o],n=i.position.y-this.position.y,s=i.position.x+.5*i.width,a=i.position.x-.5*i.width;if(0<n&&this.position.x>a&&this.position.x<s)continue}this.checkPlatformConnection(e[o])}},Ramp.prototype.removeTopSidePlatformConnection=function(){if(this._platformConnectedTopSide){this.nodes,this.lowNode;for(var t=this.highNode,e=0;e<t.connections.length;e++){var o=t.connections[e];if(o.data.obj2&&(o.data.obj2!=this&&!o.data.obj2.rotation))return o.removeConnection(t),t.removeConnection(o),e--,void(this._platformConnectedTopSide=!1)}}},Ramp.prototype.removeTopRampConnection=function(){this.nodes,this.lowNode;for(var t=this.highNode,e=0;e<t.connections.length;e++){var o=t.connections[e];o.data.obj2&&(o.data.obj2!=this&&o.data.obj2.accType==S.z1044.z1046&&(o.removeConnection(t),t.removeConnection(o),o.data.obj2.checkPlatformConnections(),e--))}},Ramp.prototype.removeTopTubeConnection=function(){for(var t=this.highCenterNode,e=0;e<t.connections.length;e++){var o=t.connections[e];o.data.obj2!=this&&(o.data.obj.accType==S.z1044.z1051&&(o.removeConnection(t),t.removeConnection(o),e--))}},Ramp.prototype.disconnectNode=function(t,e){void 0===e&&(e=!1);for(var o=0;o<t.connections.length;o++){var i=t.connections[o];i.data.obj==t.data.obj&&i.data.obj2==t.data.obj2||(t.removeConnection(i),i.removeConnection(t),o--,i.data.obj2?i.data.enterEvent&&i.data.enterNextNode&&!i.data.obj2.rotation&&i.data.obj2==this.platformAbove&&i.data.obj2.removeHoleAt(i.data.enterNextNode.x,i.data.enterNextNode.y,i.data.enterNextNode.z):i.data.obj&&i.data.obj.accType==S.z1044.z1049?i.data.obj.removeHoleAt(t.x,t.y,t.z):i.data.connector&&i.data.connector.parent&&i.data.connector.parent.removeHoleAt&&i.data.connector.parent.removeHoleAt(t.x,t.y,t.z),e||(i.data.obj2&&i.data.obj2.onAfterDisconnect&&i.data.obj2.onAfterDisconnect(this),i.data.obj&&i.data.obj.onAfterDisconnect&&i.data.obj.onAfterDisconnect(this)))}},Ramp.prototype.connectToPlatform=function(t){var e=this.nodes,o=t.nodes,i=t.position.x-this.position.x,n=t.position.y-this.position.y,s=!1;if(Math.abs(i)<.6*t.width&&0<n)s=!0;else{if(n<0&&this._bridgeConnectedLow)return;if(0<n&&this._bridgeConnectedHigh)return}for(var a=0,r=0;r<e.length;r++){var c=e[r];if(c!=this.centerGraphNode&&(c!=this.highCenterNode&&c!=this.lowCenterNode)){for(var d=0;d<o.length;d++){var p=o[d],l=c.x-p.x,u=c.y-p.y,y=c.z-p.z;if(p!=t.centerGraphNode&&(!(.45<u||u<-.45)&&!(.3<y||y<-.3)&&l<.6&&-.6<l))if(s)Math.abs(p.x-this.position.x)<.1&&(this.removeTopSidePlatformConnection(),this.removeTopRampConnection(),this.removeTopTubeConnection(),this.highNode.x>this.position.x?this.highNode.x=this.position.x+.1*this.boxSize:this.highNode.x=this.position.x-.1*this.boxSize,this.highNode.y=this.position.y+.35*this.boxSize,this.connectToFloorAbove(t),this.platformAbove=t,a++);else if(!(this._platformConnectedAbove&&0<n)){var g=S.z1073.IsNodeConnectedToAccType(c,S.z1044.z1047);g&&(g.removeConnection(c),c.removeConnection(g));var m=l*l+u*u+y*y,f=Math.sqrt(m);c.addConnection(p,f),p.addConnection(c,f),.3<n?this._platformConnectedTopSide=!0:.33<l?this._platformConnectedLowLeft=!0:l<-.33&&(this._platformConnectedLowRight=!0),a++}}0<a&&t.onAfterConnect(this)}}},Ramp.getObjectsAt=function(t,e,o,i,n,s,a){var r,c=Ramp.activeObjects;a&&(c=a);for(var d=c.length,p=t-.5*i,l=t+.5*i,u=e-.5*n,y=e+.5*n,g=0;g<d;g++){var m=(r=c[g]).position.x-.5*r.boxSize,f=r.position.x+.5*r.boxSize,A=r.position.y+.5*r.boxSize,b=r.position.y-.5*r.boxSize;f<=p||l<=m||y<=b||A<=u||s.push(r)}},Ramp.prototype.getPointSideY=function(t,e,o,i){void 0===e&&(e=0),void 0===o&&(o=0),void 0===i&&(i=0);var n=Ramp.z4[0];z1.getOIMOLocalPositionFromGlobalToRef(this.body,t,n),isNaN(n.x);var s=.5*(this.width+e),a=i,r=.5*(this.depth+o);return n.x<-s||n.x>s?0:n.z<-r||n.z>r?0:n.y>a?1:-1},Ramp.prototype.getPositionOnMapFromDropToRef=function(t,e,o,i){p.prototype.getPositionOnMapFromDropToRef.call(this,t,e,0,i),0<this.rotation.z?i.z+=.25:i.z-=.25},Ramp.tempVecs=[new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3],Ramp.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],Ramp.count=0,Ramp.activeObjects=[],Ramp.coffsetX=.044,Ramp.coffsetY=0,Ramp}(S.z1092);S.Ramp=t}(z0||(z0={})),function(t){var e=function(e){function Ramp1(){return null!==e&&e.apply(this,arguments)||this}return __extends(Ramp1,e),Ramp1.prototype.init=function(t){t.z=.25,e.prototype.init.call(this,t),this.setRotation(0,0,.25*Math.PI),this.disconnect(),this.checkConnections()},Ramp1}(t.Ramp);t.Ramp1=e}(z0||(z0={})),function(e){var t=function(){function Ramp1Config(){this.maxObjects=20,this.objName="r1",e.Ramp1.objectCount=this.maxObjects}return Ramp1Config.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,e.Ramp1,{shapeName:this.objName,world:t,width:1.5})},Ramp1Config.prototype.getSceneFileNames=function(t){},Ramp1Config.prototype.getCreateMeshFunctions=function(t){t.RampMenuButton=this._createMeshes,t.RampButton=this._createMeshes},Ramp1Config.prototype._createMeshes=function(t,e){var o=BABYLON.MeshBuilder.CreatePlane("RampMenuButton",{width:1.3,height:1.3},t);t.removeMesh(o),o.rotation.z=.25*Math.PI,o.bakeCurrentTransformIntoVertices(),e.RampMenuButton=o;o=BABYLON.MeshBuilder.CreatePlane("RampButton",{width:1.3,height:.33},t);t.removeMesh(o),o.bakeCurrentTransformIntoVertices(),e.RampButton=o},Ramp1Config.prototype.getChildSPSData=function(t){t[this.objName]||(t[this.objName]={}),t[this.objName].RampPlank=1,t[this.objName].RampConnector=2,t[this.objName].RampTread=3},Ramp1Config.prototype.getSPSData=function(t){t.push({shapeName:"RampConnector",meshName:"ramp_connector",numInstances:4*this.maxObjects,maxInstances:4*this.maxObjects}),t.push({shapeName:"RampConnector",meshName:"ramp_connector",numInstances:4,maxInstances:4,renderingGroupID:e.App.menuRenderingGroupID}),t.push({shapeName:"RampTread",meshName:"ramp_tread_2",numInstances:6*this.maxObjects,maxInstances:6*this.maxObjects}),t.push({shapeName:"RampTread",meshName:"ramp_tread_2",numInstances:6,maxInstances:6,renderingGroupID:e.App.menuRenderingGroupID}),t.push({shapeName:"RampPlank",meshName:"ramp3",numInstances:2*this.maxObjects,maxInstances:2*this.maxObjects}),t.push({shapeName:"RampPlank",meshName:"ramp3",numInstances:2,maxInstances:2,renderingGroupID:e.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"RampMenuButton",numInstances:2,maxInstances:2,isPickable:!0,hideButton:!0,renderingGroupID:e.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"RampButton",numInstances:this.maxObjects,maxInstances:this.maxObjects,isPickable:!0,hideButton:!0})},Ramp1Config.prototype.getTextureDrawFunctions=function(t){},Ramp1Config.prototype.getz1064Items=function(t){t.push(new e.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Bridges",order:1,countLabelY:-.3,menuWidth:1.5}))},Ramp1Config.prototype.getz49s=function(t){t.push(e.z18)},Ramp1Config.prototype.getListenerSetups=function(t){t.push({event:e.RampEvents.USE,state:e.z18})},Ramp1Config}();e.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(e){function Ramp2(){return null!==e&&e.apply(this,arguments)||this}return __extends(Ramp2,e),Ramp2.prototype.init=function(t){t.z=-.25,e.prototype.init.call(this,t),this.setRotation(0,0,.25*-Math.PI),this.disconnect(),this.checkConnections()},Ramp2}(t.Ramp);t.Ramp2=e}(z0||(z0={})),function(e){var t=function(){function Ramp2Config(){this.maxObjects=20,this.objName="r2",e.Ramp2.objectCount=this.maxObjects}return Ramp2Config.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,e.Ramp2,{shapeName:this.objName,world:t,width:1.5})},Ramp2Config.prototype.getSceneFileNames=function(t){},Ramp2Config.prototype.getChildSPSData=function(t){t[this.objName]||(t[this.objName]={}),t[this.objName].RampPlank=1,t[this.objName].RampConnector=2,t[this.objName].RampTread=3},Ramp2Config.prototype.getSPSData=function(t){t.push({shapeName:this.objName,meshName:"RampMenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:e.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"RampButton",numInstances:this.maxObjects,maxInstances:this.maxObjects,isPickable:!0,hideButton:!0})},Ramp2Config.prototype.getTextureDrawFunctions=function(t){},Ramp2Config.prototype.getz1064Items=function(t){t.push(new e.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Bridges",order:2,countLabelY:-.3,menuWidth:1.5}))},Ramp2Config}();e.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(){function RampEvents(){}return RampEvents.USE=t.AppEvents.GetUniqueID(),RampEvents}();t.RampEvents=e}(z0||(z0={})),function(F){var t=function(e){function RampNavigator(){var t=null!==e&&e.apply(this,arguments)||this;return t.localPosition=BABYLON.Vector3.Zero(),t.pivotRadius=0,t.TEST_Pivot_Radius=.25,t.TEST_Pivot_Area=Math.PI,t._enabled=!0,t.updated=new z1072Set,t}return __extends(RampNavigator,e),RampNavigator.prototype.init=function(t){this.accessory=t.accessory;var e=this.accessory,o=e.shapeName+e.num;if(!this.triggerArea){this.world=e.world;var i=[.03,.01,1,F.App.PhysicsGroupTriggerArea,F.App.z1034],n=t.radius;this.pivotRadius=.5*e.depth+.05,this.triggerArea=new OIMO.Body({type:"sphere",size:[n,n,n],pos:[0,0,0],rot:[0,0,0],move:!1,world:this.world,name:o+"_rampBumper1",config:i}).body,this.triggerArea.shapes.pubsub=this.pubsub,this.triggerArea.shapes.disablePhysics=!0;this.localPosition.x=0,this.localPosition.y=0,this.localPosition.z=0,this.pubsub.subscribe("hit",this.onTrigger.bind(this))}},RampNavigator.prototype.setPosition=function(t,e,o){this.accessory;var i=this.localPosition;this.triggerArea.position.x=t+i.x,this.triggerArea.position.y=e+i.y,this.triggerArea.position.z=o+i.z,this.triggerArea.syncShapes(),this.triggerAreaMesh&&(this.triggerAreaMesh.position.x=this.triggerArea.position.x,this.triggerAreaMesh.position.y=this.triggerArea.position.y,this.triggerAreaMesh.position.z=this.triggerArea.position.z,this.triggerAreaMesh.isPickable=!1)},RampNavigator.prototype.enable=function(){this._enabled||(this.world.addRigidBody(this.triggerArea),this._enabled=!0)},RampNavigator.prototype.disable=function(){this._enabled&&(this.triggerArea.position.y=9999,this.triggerArea.syncShapes(),this.world.removeRigidBody(this.triggerArea),this._enabled=!1)},RampNavigator.prototype.onTrigger=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=this.accessory,i=t[8].actor.rodent;if(this.updated.push(i,i.id,F.app.frameNum)&&i.usingObject!=this.accessory&&!(i.currentObject&&i.currentObject.accType==F.z1044.z1051||i.isInState(F.z14.name)||i.isInState(F.z90.name)||i.isInState(F.z95.name)||i.isInState(F.z131.name)||i.isInState(F.z113.name)&&i.usingObject&&i.usingObject.accType==F.z1044.SWING&&.4<i.usingObject.position.y-o.position.y)){var n=o.parent;if(n){var s=i.physics.frontBody.body.position,a=i.targets.pathTarget,r=RampNavigator.z4[0];r.x=this.position.x,r.y=this.position.y,r.z=this.position.z;var c=s.y-this.position.y,d=o.body.rotation.elements,p=d[0]/d[3];r.x+=c*p;var l=n.position.x-.5*n.width,u=n.position.x+.5*n.width;r.x<l+.4&&(r.x=l+.4),r.x>u-.4&&(r.x=u-.4);var y=o.position.x+.5*o.boxSize-.1;r.x>y&&(r.x=y);var g=o.position.x-.5*o.boxSize+.1;if(r.x<g&&(r.x=g),r.y+=(r.x-this.position.x)/p,this.testMesh&&this.testMesh.position.copyFrom(r),r.y>o.position.y+.5)i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null);else if(c>.5*o.boxSize)i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null);else{var m=i.path[i.pathIndex],f=o.getPointSideY(s,0,10),A=0;if((A=m?o.getPointSideY(m,1,.5):o.getPointSideY(a,1,.5))<0&&a.x-o.position.x<.5*o.boxSize&&a.x-o.position.x>.5*-o.boxSize&&-.05<a.z-o.position.z&&a.z-o.position.z<.05&&i.path[i.pathIndex]&&!i.path[i.pathIndex].data.enterEvent&&i.path[i.pathIndex+1]&&!i.path[i.pathIndex+1].data.enterEvent&&(i.incrementPathIndex(),i.pathIndex),0<f&&0<A)i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null);else{i.targets.avoidTarget,i.targets.moveToTarget,i.targets.lookToTarget,i.targets.standToTarget;var b=RampNavigator.z4[1];b.x=a.x-r.x,b.y=0,b.z=a.z-r.z;var v=RampNavigator.z4[2];v.x=a.x-s.x,v.y=0,v.z=a.z-s.z;var x=RampNavigator.z4[3];if(x.x=r.x-s.x,x.y=0,x.z=r.z-s.z,f<1&&0<r.z&&a.z<=0&&s.z<0-.25*i.size)i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null);else if(f<1&&r.z<0&&0<=a.z&&s.z>0+.25*i.size)i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null);else{var C=v.lengthSquared(),S=x.lengthSquared(),T=(this.pivotRadius,i.size);if((T=this.TEST_Pivot_Radius+1.1*i.size)*T<S)i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null);else if(f==A&&C<=S)i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null);else if(v.normalize(),x.normalize(),BABYLON.Vector3.Dot(v,x)<0)i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null);else{i.pivotRadius=this.pivotRadius,i.pivotRadiusMax=this.pivotRadius+1.5*i.size,i.pivotRadius=this.TEST_Pivot_Radius,i.pivotRadiusMax=this.TEST_Pivot_Radius+1.5*i.size,i.pivotPoint.x=r.x,i.pivotPoint.y=r.y,i.pivotPoint.z=r.z;var B=RampNavigator.z4[4];B.x=-v.z,B.z=v.x;var O=B.x+s.x,P=B.z+s.z,M=O-r.x,I=P-r.z,N=M*M+I*I,z=-B.x+s.x,w=-B.z+s.z,_=z-r.x,R=w-r.z,L=_*_+R*R;i.pivotMoveDir=L<N?1:-1,i.pivotArea=1*Math.PI,i.pivotArea=this.TEST_Pivot_Area,i.pivotAreaDir.x=v.x,i.pivotAreaDir.y=v.y,i.pivotAreaDir.z=v.z,i.pivotUpdateLook=!1,i.currentz1091=this}}}}}}},RampNavigator}(F.z1091);F.RampNavigator=t}(z0||(z0={})),function(r){var t,e;t=r.z156||(r.z156={}),e=function(t){function z722(){return null!==t&&t.apply(this,arguments)||this}return __extends(z722,t),z722.prototype.update=function(t){var e,o=t.path[t.pathIndex-1],i=t.path[t.pathIndex],n=t.path[t.pathIndex+1],s=t.usingObject;if(s&&s.accType==r.z1044.z1046&&(i&&o==s.centerGraphNode)){if(o.y<=i.y)return;if(!(e=n))return;if(!e.data.obj2||e.data.obj2.rotation)return;if(e.data.enterNextNode){var a=.3;e.z>s.position.z&&(a*=-1),t.targets.pathTarget.x=i.x,t.targets.pathTarget.y=i.y,t.targets.pathTarget.z=i.z+a,t.targets.moveToTarget.copyFrom(t.targets.pathTarget)}}},z722}(z767),t.z722=e}(z0||(z0={})),function(A){var t,e;t=A.z156||(A.z156={}),e=function(t){function z713(){return null!==t&&t.apply(this,arguments)||this}return __extends(z713,t),z713.prototype.update=function(t){var e=t.targets,o=e.pathTarget;t.path.length,t.pathIndex,o.y<t.position.y&&o.y,t.path[t.pathIndex],t.usingObject.centerGraphNode;var i=t.path[t.pathIndex],n=t.path[t.pathIndex+1],s=t.path[t.pathIndex+2],a=t.usingObject;if(a&&a.accType==A.z1044.z1046){if(n&&i.data.obj2==a&&n.data.obj2&&n.data.obj2.accType==A.z1044.z1049){var r=n.data.obj2;if(r.position.y<a.position.y){var c=r.position.x-.5*r.width,d=r.position.x+.5*r.width;if((Math.abs(i.x-c)<.3||Math.abs(i.x-d)<.3)&&a.position.x>c&&a.position.x<d){if(n.data.obj2&&n.data.obj2==r)return void t.incrementPathIndex();if(!s)return void t.incrementPathIndex();if(s.data.obj2&&s.data.obj2==r)return void t.incrementPathIndex()}}}if(n&&i.data.obj2==a&&i==a.lowNode)if(n.data.obj2&&n.data.obj2.accType==A.z1044.z1050)if(n.data.obj2.position.y<a.position.y)return void t.incrementPathIndex();if(0<t.path2.length&&t.path2Index<t.path2.length){var p=t.physics.frontBody.body,l=(t.size,e.pathNodeHitDist),u=l*l,y=p.position,g=t.path[t.pathIndex].x-y.x,m=t.path[t.pathIndex].y-y.y,f=t.path[t.pathIndex].z-y.z;g*g+m*m+f*f<u&&(t.path2Index+=3,t.pathIndex=Math.floor(t.path2Index/3)-1,t.pubsub.broadcast(A.z1061Events.NEW_PATH_NODE),t.path2Index>=t.path2.length&&t.targets.setTargetsToDestination()),t.path2Index<t.path2.length?o.copyFrom(t.path[t.pathIndex]):t.path2Index>=t.path2.length&&o.copyFrom(t.targets.destTarget)}}},z713}(z767),t.z713=e}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z710(){return null!==t&&t.apply(this,arguments)||this}return __extends(z710,t),z710.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==n.z1044.z1046)if(t.isFollowingPath()){var o=t.path[t.pathIndex];-1!=e.getPointSideY(o,0,2*t.size)||t.incrementPathIndex()}else{var i=t.targets.destTarget;e.getPointSideY(i,0,2*t.size)}},z710}(z767),t.z710=e}(z0||(z0={})),function(s){var t,e;t=s.z156||(s.z156={}),e=function(t){function z637(){return null!==t&&t.apply(this,arguments)||this}return __extends(z637,t),z637.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==s.z1044.z1046){var o=t.targets.pathTarget,i=(t.path[t.pathIndex],t.path[t.pathIndex+1]);if(-1==e.getPointSideY(o,0,3*t.size)){var n=1;return t.physics.frontBody.body.position.z-e.position.z<0&&(n=-1),i&&(i.z-e.position.z<0&&0<n?i.x-e.position.x<.5*e.boxSize&&i.x-e.position.x>.5*-e.boxSize&&(n=-1):0<i.z-e.position.z&&n<0&&i.x-e.position.x<.5*e.boxSize&&i.x-e.position.x>.5*-e.boxSize&&(n=1)),o.x=t.position.x,o.y=t.position.y,o.z=e.position.z+n,void t.targets.setTargetsToPathTarget()}}},z637}(z767),t.z637=e}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z636(){return null!==t&&t.apply(this,arguments)||this}return __extends(z636,t),z636.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==n.z1044.z1046){var o=t.pathIndex+1;if(t.path[o]){var i=t.path[o].data.obj;if(i)if(i.accType==n.z1044.z1051)if(i.position.x==e.position.x&&i.position.y>e.position.y)t.position.z-i.position.z<0?t.targets.moveToTarget.z-=.3:t.targets.moveToTarget.z+=.3}}},z636}(z767),t.z636=e}(z0||(z0={})),function(d){var t,e;t=d.z156||(d.z156={}),e=function(t){function z621(){return null!==t&&t.apply(this,arguments)||this}return __extends(z621,t),z621.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==d.z1044.z1046){var o=t.physics.frontBody.body.position,i=t.path[t.pathIndex],n=i.x-o.x,s=i.y-o.y,a=i.z-o.z,r=o.y-e.position.y,c=t.currentObject;c.position.x,c.width,c.position.x,c.width;r<0?e.rampBelow&&(n*n+a*a,.5):e.rampAbove&&(n*n+a*a,.4);e.depth,t.size;.5;n<.2&&-.2<n&&s<.4&&a<.5&&-.5<a&&t.forceTouchGround()}},z621}(z767),t.z621=e}(z0||(z0={})),function(p){var t,e;t=p.z156||(p.z156={}),e=function(t){function z591(){return null!==t&&t.apply(this,arguments)||this}return __extends(z591,t),z591.prototype.update=function(t){var e=t.path[t.pathIndex+1],o=t.targets.moveToTarget,i=t.targets.lookToTarget,n=t.usingObject;if(n&&n.accType==p.z1044.z1046&&e){var s=t.physics.frontBody.body.position;if(t.usingObject.isInBox(s.x,s.y-t.size,s.z)){var a=t.usingObject.position.z-.5*t.usingObject.depth,r=t.usingObject.position.z+.5*t.usingObject.depth;if(i.y<t.position.y)return;if(!e.data.obj2)return;if(!e.data.obj2.rotation)return;i.z>r?i.z=r:i.z<a&&(i.z=a),a+=t.size,r-=t.size,o.z>r?o.z=r:o.z<a&&(o.z=a)}s=t.physics.frontBody.body.position;var c=o.x-s.x,d=o.y-s.y;c<0&&(c*=-1),.5<d&&d<c&&(o.y=s.y+t.size)}},z591}(z767),t.z591=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z586(){return null!==t&&t.apply(this,arguments)||this}return __extends(z586,t),z586.prototype.update=function(t){if(t.isTouchingGround()){var e,o=t.targets.lookToTarget,i=t.path[t.pathIndex];if(i&&i.data.obj2)if((i==(e=i.data.obj2).lowCenterNode||i==e.highNode)&&o.x==i.x)return o.x=e.centerGraphNode.x,o.y=e.centerGraphNode.y,o.z=e.centerGraphNode.z,void(i==e.lowCenterNode&&t.targets.moveToTarget.copyFrom(t.targets.lookToTarget));if((i=t.path[t.pathIndex+1])&&i.data.obj2)if((i==(e=i.data.obj2).lowCenterNode||i==e.highNode)&&o.x==i.x)return o.x=e.centerGraphNode.x,o.y=e.centerGraphNode.y,o.z=e.centerGraphNode.z,void(i==e.lowCenterNode&&t.targets.moveToTarget.copyFrom(t.targets.lookToTarget))}},z586}(z767),e.z586=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z575(){var t=null!==e&&e.apply(this,arguments)||this;return t.maxStrength=5,t}return __extends(z575,e),z575.prototype.update=function(t){if(0<t.targets.moveToTarget.y-t.position.y){var e=t.targets.lookToTarget.x-t.position.x;t.targets.lookToTarget.y+=.5<e||e<-.5?3*t.size:t.size}},z575}(z767),e.z575=o}(z0||(z0={})),function(r){var t,e;t=r.z156||(r.z156={}),e=function(a){function z566(){var t=null!==a&&a.apply(this,arguments)||this;return t.bodyIndex=3,t.speedFrac=1,t.easeAmount=.1,t.skipRearBodySpeedSq=.001,t}return __extends(z566,a),z566.prototype.update=function(t){t.physics.frontBody.speedSq,this.skipRearBodySpeedSq;var e=t.path[t.pathIndex-1],o=t.path[t.pathIndex],i=t.path[t.pathIndex+1];if(e&&o&&e.y>o.y){this.easeAmount=.2;var n=t.path[t.pathIndex-2];i=t.path[t.pathIndex+1];t.targets.rollAngToUp,i&&i.data.enterNextNode&&i.data.obj2&&i.data.obj2!=r.z1044.z1046?this.easeAmount=.7:n&&n.data.enterEvent&&n.data.obj2&&n.data.obj2!=r.z1044.z1046&&(this.easeAmount=.7);var s=t.usingObject;s&&s.accType==r.z1044.z1046&&s.platformAbove&&(this.easeAmount=.7),i&&i.data.enterNextNode&&i.data.obj2&&i.data.obj2.rotation&&i.data.obj2.rotation.z!=t.usingObject.rotation.z&&(this.easeAmount=.9),t.isTouchingGround(),a.prototype.update.call(this,t)}},z566}(t.z561),t.z566=e}(z0||(z0={})),function(a){var t,e;t=a.z156||(a.z156={}),e=function(s){function z445(){var t=null!==s&&s.apply(this,arguments)||this;return t.minTargetY=0,t.maxTargetY=2,t.maxStrength=100,t}return __extends(z445,s),z445.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==a.z1044.z1046){this.maxStrength=100;var o=t.targets.moveToTarget.y-t.position.y,i=t.physics.headBody.body.position;if(i=t.physics.frontBody.body.position,o>-t.size)this.minTargetY=1;else if(this.minTargetY=-.5,e.isInBox(i.x,i.y-t.size,i.z))this.minTargetY=-10;else{var n=i.x-e.position.x;if(i.y-e.position.y>.5*e.boxSize)if(n>.5*e.boxSize||n<.5*-e.boxSize)t.physics.middleBody.body.rotation.elements[5]<-.5&&(this.minTargetY=-10)}s.prototype.update.call(this,t)}},z445}(t.z446),t.z445=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z412(){var t=null!==e&&e.apply(this,arguments)||this;return t.footOffsetXFront=-.13,t.footOffsetYFront=.1,t.footOffsetZFront=-.04,t.footOffsetXRear=-.2,t.footOffsetYRear=.1,t.footOffsetZRear=-.13,t}return __extends(z412,e),z412.prototype.update=function(t){var e=t.physics.frontBody.rotationElements,o=z767.tempVecs[0];o.x=e[2],o.y=e[5],o.z=e[8];e=t.physics.rearBody.rotationElements;var i=z767.tempVecs[1];i.x=e[2],i.y=e[5],i.z=e[8];e=t.physics.middleBody.rotationElements;var n=z767.tempVecs[2];n.x=e[2],n.y=e[5],n.z=e[8];var s=o.y*n.y*i.y;(s=1.5*n.y)<0&&(s*=-.25);.85<(s*=s)&&(s=.85);var a=t.bones.legFL.offsetBone1Pos;a.x=this.footOffsetXFront*s,a.y=this.footOffsetYFront*s,a.z=this.footOffsetZFront*s,(a=t.bones.legFR.offsetBone1Pos).x=this.footOffsetXFront*s,a.y=this.footOffsetYFront*s,a.z=-this.footOffsetZFront*s,a=t.bones.legRL.offsetBone1Pos,t.bones.legRL.footOffsetX_.targetValue=this.footOffsetXRear*s,t.bones.legRL.footOffsetZ_.targetValue=this.footOffsetZRear*s,a=t.bones.legRR.offsetBone1Pos,t.bones.legRR.footOffsetX_.targetValue=this.footOffsetXRear*s,t.bones.legRR.footOffsetZ_.targetValue=-this.footOffsetZRear*s;t.bones.tail},z412}(z767),e.z412=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z367(){var t=null!==e&&e.apply(this,arguments)||this;return t.maxStrength=10,t.uprightAng=2,t}return __extends(z367,e),z367.prototype.update=function(t){t.targets.moveToTarget.y,t.position.y;t.size,t.isTouchingGround()&&e.prototype.update.call(this,t)},z367}(e.z369),e.z367=o}(z0||(z0={})),function(s){var t,e;t=s.z156||(s.z156={}),e=function(t){function z350(){return null!==t&&t.apply(this,arguments)||this}return __extends(z350,t),z350.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==s.z1044.z1046){var o=t.physics.frontBody.body.position;if(e.position.y<o.y||0<e.getPointSideY(o,1,10,.5*t.size)){var i=t.path[t.pathIndex+1],n=t.path[t.pathIndex];i&&(t.targets.lookToTarget.x=.5*(i.x+n.x),t.targets.lookToTarget.y=.5*(i.y+n.y),t.targets.lookToTarget.z=.5*(i.z+n.z))}}},z350}(z767),t.z350=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z319(){return null!==t&&t.apply(this,arguments)||this}return __extends(z319,t),z319.prototype.update=function(t){t.targets.pathNodeHitDist=2*t.size},z319}(z767),e.z319=o}(z0||(z0={})),function(c){var t,e;t=c.z156||(c.z156={}),e=function(t){function z293(){return null!==t&&t.apply(this,arguments)||this}return __extends(z293,t),z293.prototype.update=function(t){var e=t.physics.rearBody,o=e.body.position;if(e.target.frameNum!=c.app.frameNum){e.target.copyFrom(o);var i=t.usingObject;if(i&&i.accType==c.z1044.z1046){var n=o,s=i.body.rotation.elements,a=t.physics.rearBody.target,r=t.size;a.x=n.x-s[1]*r,a.y=n.y-s[4]*r,a.z=n.z-s[7]*r}}},z293}(z767),t.z293=e}(z0||(z0={})),function(v){var t,e;t=v.z156||(v.z156={}),e=function(t){function z247(){return null!==t&&t.apply(this,arguments)||this}return __extends(z247,t),z247.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==v.z1044.z1046){var o=t.path[t.pathIndex],i=t.targets.pathTarget,n=t.physics.frontBody.body.position;if(.3<n.y-e.position.y)return i.x=o.x,i.y=o.y,i.z=o.z,void t.targets.setTargetsToPathTarget();var s=e.cage;if(s){var a=s.position.x-.5*s.width,r=s.position.x+.5*s.width,c=o.x-a,d=o.x-r,p=0,l=0;c<.33&&(l=t.size),-.33<d&&(l=t.size);var u=o.x-n.x,y=o.y-n.y,g=o.z-n.z;if(e.position.y<t.position.y){var m=u*u+y*y+g*g,f=1.5*t.size;(.3<g||g<-.3)&&(l=.05),m<f*f&&(o=t.path[t.pathIndex+1])}else{var A=1;if((A=u<1.5*t.size&&u>1.5*-t.size?e.getPointSideY(n,1,.5,0):e.getPointSideY(n,0,10,.5*t.size))<0)p=.5*e.depth+1.5*t.size,(g=n.z-e.position.z)<0&&(p*=-1);else if(0==A){p=.5*e.depth+.5*t.size,(g=n.z-e.position.z)<0&&(p*=-1)}var b=0;if((A=e.getPointSideY(n,0,10,.5*t.size))<0)b=.5*e.depth+1.5*t.size,(g=n.z-e.position.z)<0&&(b*=-1),b<0&&b<p?p=b:0<b&&p<b&&(p=b)}o&&(i.x=o.x,i.y=o.y+l,i.z=o.z+p,t.targets.setTargetsToPathTarget())}}},z247}(z767),t.z247=e}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z227(){return null!==t&&t.apply(this,arguments)||this}return __extends(z227,t),z227.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==n.z1044.z1046){var o=t.physics.middleBody.body.position;if(e.isInBox(o.x,o.y,o.z)){var i=e.body.rotation.elements;t.targets.upVecTarget.x=i[1],t.targets.upVecTarget.y=i[4],t.targets.upVecTarget.z=i[7]}}},z227}(z767),t.z227=e}(z0||(z0={})),function(l){var t,e;t=l.z156||(l.z156={}),e=function(t){function z226(){return null!==t&&t.apply(this,arguments)||this}return __extends(z226,t),z226.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==l.z1044.z1046){var o=t.path[t.pathIndex],i=t.physics.frontBody.body.position;if(o&&o.data.enterNextNode&&o.data.enterNextNode==e.centerGraphNode){var n=o.x-i.x,s=(o.y,i.y,o.z-i.z),a=n*n+s*s,r=i.y-e.position.y;t.path[t.pathIndex+1];if(!(.25<a)){var c=t.physics.rearBody.body.position;if(r<0){if(e.rampBelow){if((d=.6)<(p=e.rampBelow.position.x-c.x)||p<-d)return;return t.targets.upVecTarget.y+=.03,o.z<-1.5?t.targets.upVecTarget.z+=.01:t.targets.upVecTarget.z-=.01,void t.targets.upVecTarget.normalize(t.targets.upVecTarget)}}else if(e.rampAbove){var d,p;if((d=.6)<(p=e.rampAbove.position.x-c.x)||p<-d)return;return t.targets.upVecTarget.y+=.03,-1.5<o.z?t.targets.upVecTarget.z+=.02:t.targets.upVecTarget.z-=.02,void t.targets.upVecTarget.normalize(t.targets.upVecTarget)}}}}},z226}(z767),t.z226=e}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z221(){return null!==t&&t.apply(this,arguments)||this}return __extends(z221,t),z221.prototype.update=function(t){t.path[t.pathIndex]&&(t.path[t.pathIndex].data.obj2&&t.path[t.pathIndex].data.obj2.accType==e.z1044.z1046&&(t.usingObject=t.path[t.pathIndex].data.obj2),!t.usingObject&&t.path[t.pathIndex].data.obj.acc2&&(t.usingObject=t.path[t.pathIndex].data.obj.acc2))},z221}(z767),t.z221=o}(z0||(z0={})),function(d){var t,e;t=d.z768||(d.z768={}),e=function(t){function z989(){return null!==t&&t.apply(this,arguments)||this}return __extends(z989,t),z989.prototype.test=function(t){var e=t.usingObject;if(!e||e.accType!=d.z1044.z1046)return!0;var o=!1;t.targets.moveToTarget.y-t.position.y>-t.size&&(o=!0);var i=t.physics.frontBody.body.position,n=t.path[t.pathIndex],s=t.path[t.pathIndex+1];if(n&&n.data.obj2!=e){var a=i.x,r=i.y,c=i.z;if(o||(r-=2*t.size),!e.isInBox(a,r,c,t.size)&&(a>e.position.x+.5*e.boxSize||a<e.position.x-.5*e.boxSize)){if(!s||!s.data.tube)return!0;if(a>e.position.x+.5*e.boxSize+t.size||a<e.position.x-.5*e.boxSize-t.size)return d.z1044.z1051,!0}}return!1},z989}(z770),t.z989=e}(z0||(z0={})),function(i){var t,e;t=i.z768||(i.z768={}),e=function(t){function z901(){return null!==t&&t.apply(this,arguments)||this}return __extends(z901,t),z901.prototype.test=function(t){var e=t.path[t.pathIndex+1];if(e){var o=e.data.obj2;if(o&&o.accType==i.z1044.z1046&&e.data.enterEvent&&e.data.enterNextNode==o.centerGraphNode&&o.lowNode==e)return!0}return!1},z901}(z770),t.z901=e}(z0||(z0={})),function(s){var t,e;t=s.z768||(s.z768={}),e=function(t){function z898(){return null!==t&&t.apply(this,arguments)||this}return __extends(z898,t),z898.prototype.test=function(t){var e=t.usingObject;if(!e||e.accType!=s.z1044.z1046)return!1;if(!e.getPointSideY)return!1;var o=t.physics.frontBody.body.position,i=1.5*t.size,n=0*t.size;return e.getPointSideY(o,i,i,n)<1},z898}(z770),t.z898=e}(z0||(z0={})),function(s){var t,e;t=s.z768||(s.z768={}),e=function(t){function z893(){return null!==t&&t.apply(this,arguments)||this}return __extends(z893,t),z893.prototype.test=function(t){var e=t.usingObject;if(!e||e.accType!=s.z1044.z1046)return!1;if(!e.getPointSideY)return!1;t.targets.moveToTarget.y,t.position.y,t.size;var o=t.physics.frontBody.body.position,i=.25*-t.size,n=.5*t.size;return 0<e.getPointSideY(o,i,i,n)},z893}(z770),t.z893=e}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z875(){return null!==t&&t.apply(this,arguments)||this}return __extends(z875,t),z875.prototype.test=function(t){var e=t.usingObject;if(e&&e.accType==o.z1044.z1046)return t.path[t.pathIndex].data.obj2==e},z875}(z770),t.z875=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z808(){return null!==t&&t.apply(this,arguments)||this}return __extends(z808,t),z808.prototype.test=function(t){if(300<t.hsm[1].currentState.currentState.numFramesInState)return!0},z808}(z770),e.z808=o}(z0||(z0={})),function(s){var t,e;t=s.z768||(s.z768={}),e=function(t){function z800(){return null!==t&&t.apply(this,arguments)||this}return __extends(z800,t),z800.prototype.test=function(t){var e=t.usingObject;if(!e||e.accType!=s.z1044.z1046)return!0;var o=t.path[t.pathIndex],i=t.path[t.pathIndex+1];if(!o)return!0;var n=t.physics.frontBody.body.position;return!!(i&&i==e.centerGraphNode&&o.y>i.y&&n.y<i.y)},z800}(z770),t.z800=e}(z0||(z0={})),function(i){var t,e;t=i.z768||(i.z768={}),e=function(t){function z794(){return null!==t&&t.apply(this,arguments)||this}return __extends(z794,t),z794.prototype.test=function(t){var e=t.path[t.pathIndex];if(e&&e.data.enterNextNode&&t.path[t.pathIndex+1]===e.data.enterNextNode){var o=t.path[t.pathIndex+1].data.obj2;if(o&&o.accType==i.z1044.z1046)return!0}},z794}(z770),t.z794=e}(z0||(z0={})),function(u){var t,e;t=u.z768||(u.z768={}),e=function(t){function z784(){return null!==t&&t.apply(this,arguments)||this}return __extends(z784,t),z784.prototype.test=function(t){var e=t.usingObject;if(e&&e.accType==u.z1044.z1046){var o=t.path[t.pathIndex];if(o&&o.data.obj2){var i=t.path[t.pathIndex+1];if(i){var n=i.data.obj2;if(n&&n.rotation&&!(.2<n.height)){if(n!=t.usingObject){if(n.rotation.z==t.usingObject.rotation.z)return!1;var s=t.physics.frontBody.body.position,a=t.physics.rearBody.body.position,r=o.x-s.x,c=o.y-s.y,d=o.z-s.z,p=r*r+c*c+d*d,l=.45;return o!=o.data.obj2.lowNode&&(o!=o.data.obj2.highNode&&(a.y>s.y&&(l=.6),p<l*l))}return!1}}}}},z784}(z770),t.z784=e}(z0||(z0={})),function(o){var t=function(e){function z114(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.enterz156=[o.z156.z221],t.updatez156=[o.z156.z247,o.z156.z350,o.z156.z599,o.z156.z226,o.z156.z621,o.z156.z461,o.z156.z445,o.z156.z590,o.z156.z214,o.z156.z367],t.exitz156=[],t.states=[],t.transitions=[{condition:o.z768.z893,trueNode:{state:o.z14,actions:[o.z156.z554]}},{condition:o.z768.z875,falseNode:{state:o.z66,level:1,actions:[]}},{condition:o.z768.z873,trueNode:{state:o.z65,level:1,actions:[]}},{condition:o.z768.z808,trueNode:{state:o.z108,level:1,actions:[]}}],t}return __extends(z114,e),z114}(z49);o.z114=t}(z0||(z0={})),function(o){var t=function(e){function z18(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.enterz156=[o.z156.z319,o.z156.z406,o.z156.z466,o.z156.z481,o.z156.z466],t.updatez156=[o.z156.z362,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z379,o.z156.z442],t.exitz156=[o.z156.z710,o.z156.z465,o.z156.z494,o.z156.z320,o.z156.z466],t.states=[o.z114,o.z14],t.transitions=[{condition:o.z768.z989,trueNode:{state:o.z66}},{condition:o.z768.z873,trueNode:{state:o.z65,actions:[]}},{condition:o.z768.z800,trueNode:{state:o.z108}},{condition:o.z768.z944,trueNode:{state:o.z108}}],t.initialState=o.z114,t}return __extends(z18,e),z18}(z49);o.z18=t}(z0||(z0={})),function(o){var t=function(e){function z14(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.enterz156=[o.z156.z476],t.updatez156=[o.z156.z227,o.z156.z713,o.z156.z235,o.z156.z591,o.z156.z722,o.z156.z637,o.z156.z636,o.z156.z718,o.z156.z412,o.z156.z599,o.z156.z293,o.z156.z566,o.z156.z461,o.z156.z445,o.z156.z590,o.z156.z214,o.z156.z367],t.exitz156=[],t.states=[],t.transitions=[{condition:o.z768.z898,trueNode:{state:o.z66,level:1,actions:[]}},{condition:o.z768.z794,trueNode:{state:o.z114,actions:[]}},{condition:o.z768.z784,trueNode:{state:o.z114,actions:[o.z156.z554]}},{condition:o.z768.z874,trueNode:{state:o.z66,level:1}}],t}return __extends(z14,e),z14}(z49);o.z14=t}(z0||(z0={})),function(b){var t=function(o){function Saucer(){var t=o.call(this)||this;t.num=0,t.graphicsHelper=b.app.graphicsHelper,t.modelName="wheel2",t.centerGraphNode=new GraphNode(0,0,0),t.thickness=0,t.nodes=[],t.axisMat=new OIMO.Mat33,t.computeUpVec=!1,t.saucerForce=0,t.modelPath="assets/models/",t.texturePath="assets/models/spiral.png",t.angVel=0,t.ang=0,t.lastAng=0,t.radius=0,t.height=0,t.halfHeight=0,t.x=0,t.y=0,t.z=0,Saucer.count++,t.num=Saucer.count,t.centerGraphNode.data.obj=t;var e=new GraphNode(0,0,0);e.data.obj=t,e.data.enterEvent=b.SaucerEvents.ENTER;t.nodes.push(e),b.app.graph.addNode(e);return((e=new GraphNode(0,0,0)).data.obj=t).nodes.push(e),b.app.graph.addNode(e),e.addConnection(t.nodes[0],.5),t.nodes[0].addConnection(e,.5),e.addConnection(t.centerGraphNode,.5),t.centerGraphNode.addConnection(e,.5),b.app.graph.addNode(t.centerGraphNode),t}return __extends(Saucer,o),Saucer.prototype.init=function(t){var e="saucer"+this.num;this.x=t.x,this.y=t.y,this.z=t.z,this.cage=b.Cage.getCageAt(t.x,t.y,t.z),this.parent=this.cage,this.radius=t.radius,this.height=t.height,this.halfHeight=.5*this.height,this.thickness=t.thickness,this.world=t.world,this.groundY=this.cage.floorY;var o=b.App.z1033;Math.PI;this.base=new OIMO.Body({type:"box",size:[10,10,10],pos:[this.x,this.y,this.z],rot:[0,0,0],move:!1,world:this.world,name:e+"_base"});var i=[.15,.5,.2,o,4294967295],n=.65*this.height;this.saucer=new OIMO.Body({size:[this.radius,this.height,0,this.thickness],pos:[this.x,n+this.y,this.z],rot:[-20,180,0],world:this.world,type:"funnel",move:!0,name:e+"_saucer",config:i}),this.body=this.saucer.body;var s=-20*Math.PI/180,a=Math.sin(s),r=Math.cos(s);new OIMO.Link({type:"jointWheel",body1:e+"_base",body2:e+"_saucer",pos1:[0,n,0],axe1:[0,a,r],axe2:[0,1,0],limit:[0,0],world:this.world}),this.axisMat.copy(this.body.rotation),this.updateNodes();this.radius,this.radius;var c=new OIMO.Vec3,d=this.body.rotation.elements;c.x=d[1],c.y=0,c.z=d[7],c.normalize(c),this.createMesh();var p=this.mesh,l=this.mesh.position;p.rotationQuaternion=new BABYLON.Quaternion;var u=this.body.position;l.x=u.x,l.y=u.y,l.z=u.z;var y=new BABYLON.Quaternion,g=this.body.orientation;y.x=g.x,y.y=g.y,y.z=g.z,y.w=g.s,p.rotationQuaternion=y,this.graphicsHelper.addForUpdate(this),this.cage.isReady?(this.setInCage(),this.checkBeddingHeight(),this.addToObject(this.parent)):(this.cage.pubsub.subscribe("ready",this.setInCage,this),this.cage.pubsub.subscribe("ready",this.checkBeddingHeight,this))},Saucer.prototype.setInCage=function(){var t=this.cage;t.addObject(this),this.mesh.position.y=this.y;var e=.5+this.radius,o=t.mesh.position.x-.5*t.width+e,i=t.mesh.position.x+.5*t.width-e;this.x<o?(this.x=o,this.mesh.position.x=this.x):this.x>i&&(this.x=i,this.mesh.position.x=this.x);var n=t.mesh.position.z-.5*t.depth+e,s=t.mesh.position.z+.5*t.depth-e;this.z<n?(this.z=n,this.mesh.position.z=this.z):this.z>s&&(this.z=s,this.mesh.position.z=this.z)},Saucer.prototype.checkBeddingHeight=function(){var t=this.cage.groundMesh,e=this.x,o=(this.y,this.z),i=this.base.body.rotation.elements,n=.5*this.radius,s=0*i[0]+0*i[1]+n*i[2]+e,a=0*i[6]+0*i[7]+n*i[8]+o,r=t.getHeightAtCoordinates(s,a),c=this.y-this.height;c<r&&(this.cage.setBeddingHeight(s,a,c),this.cage.updateNodes())},Saucer.prototype.updateNodes=function(){var t=this.centerGraphNode;t.x=this.body.position.x,t.y=this.body.position.y,t.z=this.body.position.z;var e=1*this.radius,o=1*this.height,i=this.base.body.position,n=i.x,s=i.y,a=i.z,r=this.base.body.rotation.elements,c=1.2*o,d=1.2*e,p=0*r[0]+c*r[1]+d*r[2]+n,l=0*r[3]+c*r[4]+d*r[5]+s,u=0*r[6]+c*r[7]+d*r[8]+a,y=this.nodes[0];y.x=p,y.y=l,y.z=u;var g=1.4*o,m=.5*e,f=0*r[0]+g*r[1]+m*r[2]+n,A=0*r[3]+g*r[4]+m*r[5]+s,b=0*r[6]+g*r[7]+m*r[8]+a,v=this.nodes[1];v.x=f,v.y=A,v.z=b},Saucer.prototype.addToObject=function(t){this.parent=t;b.app.graph;var e=this.nodes[0],o=Saucer.tempVecs[0];if(o.x=e.x-this.centerGraphNode.x,o.y=e.y-this.centerGraphNode.y,o.z=e.z-this.centerGraphNode.z,o.normalize(o),y=t.getGraphNodeAt(e.x,e.y,e.z)){var i=y.x-e.x,n=y.y-e.y,s=y.z-e.z,a=Math.sqrt(i*i+n*n+s*s);e.addConnection(y,a),y.addConnection(e,a)}var r=y,c=this.base.body.rotation.elements,d=this.centerGraphNode,p=(n=0,s=0,(i=-this.radius)*c[0]+n*c[1]+s*c[2]+d.x),l=i*c[3]+n*c[4]+s*c[5]+d.y,u=i*c[6]+n*c[7]+s*c[8]+d.z;if(o.x=p-d.x,o.y=l-d.y,o.z=u-d.z,o.normalize(o),y=t.getGraphNodeAt(p,l,u,!1,o)){i=y.x-d.x,s=y.z-d.z,a=Math.sqrt(i*i+s*s);d.addConnection(y,a)}var y;n=0,s=0,p=(i=this.radius)*c[0]+n*c[1]+s*c[2]+d.x,l=i*c[3]+n*c[4]+s*c[5]+d.y,u=i*c[6]+n*c[7]+s*c[8]+d.z;if(o.x=p-d.x,o.y=l-d.y,o.z=u-d.z,o.normalize(o),y=t.getGraphNodeAt(p,l,u,!1,o)){i=y.x-d.x,s=y.z-d.z,a=Math.sqrt(i*i+s*s);d.addConnection(y,a)}var g=this.parent.getGraphNodeAt(this.x,this.y,this.z);if(g&&(g.type=0,z1083.RemoveDiagonalsAround(g)),r)for(var m=r.connections.length-1,f=0;f<m;f++){var A=r.connections[f];if(0!==A.type){i=A.x-e.x,n=A.y-e.y,s=A.z-e.z,a=Math.sqrt(i*i+n*n+s*s);e.addConnection(A,a),A.addConnection(e,a)}}},Saucer.prototype.createMesh=function(){var t=b.app.graphicsHelper.scene,e=new BABYLON.StandardMaterial("mat1",t);e.diffuseColor=new BABYLON.Color3(.5,.5,1),e.wireframe=!0,e.backFaceCulling=!1;var o=this.radius,i=2*Math.PI,n=i/12,s=[],a=[],r=this.height;s=[];for(var c=0;c<i;c+=n){var d=0*Math.sin(c),p=0*Math.cos(c),l=0;s.push(new BABYLON.Vector3(d,l,p))}a.push(s),s=[];for(c=0;c<i;c+=n){d=o*Math.sin(c),p=o*Math.cos(c),l=r;s.push(new BABYLON.Vector3(d,l,p))}a.push(s),this.mesh=BABYLON.Mesh.CreateRibbon("saucer",a,!1,!0,0,t),this.mesh.material=e},Saucer.prototype.update=function(){var t=this.saucer.body,e=t.rotation.elements;t.angularVelocity.scaleEqual(.995);var o=1,i=0,n=0,s=o*e[0]+i*e[1]+n*e[2],a=o*e[3]+i*e[4]+n*e[5],r=o*e[6]+i*e[7]+n*e[8];i=a,n=r,s=(o=s)*(e=this.base.body.rotation.elements)[0]+i*e[3]+n*e[6],a=o*e[1]+i*e[4]+n*e[7],r=o*e[2]+i*e[5]+n*e[8],this.lastAng=this.ang,this.ang=-Math.atan2(r,s),this.angVel=z1.getAngDiff(this.ang,this.lastAng)},Saucer.prototype.getGraphNodeAt=function(t,e,o){return this.centerGraphNode},Saucer.prototype.applyForceToz1062Body=function(t,e,o){var i=Saucer.tempVecs[1],n=Saucer.tempVecs[2],s=this.body,a=t.position,r=s.position,c=s.rotation.elements,d=this.base.body.rotation.elements,p=this.axisMat.elements,l=s.angularVelocity,u=l.x*p[1]+l.y*p[4]+l.z*p[7],y=o;i.x=r.x-a.x,i.y=r.y-a.y,i.z=r.z-a.z,n.cross(e,i),n.normalize(n);var g=a.x-r.x,m=a.y-r.y,f=a.z-r.z,A=g*c[0]+m*c[3]+f*c[6],b=(c[1],c[4],c[7],g*c[2]+m*c[5]+f*c[8]),v=Math.sqrt(A*A+b*b),x=-u*y*.5*Math.PI*v;n.x*=x,n.y*=x,n.z*=x;var C=t.linearVelocity,S=C.x,T=C.y,B=C.z,O=(d[0],d[3],d[6],d[1],d[4],d[7],d[2],d[5],d[8],n.x),P=n.y,M=n.z,I=O*d[0]+P*d[3]+M*d[6],N=O*d[1]+P*d[4]+M*d[7],z=O*d[2]+P*d[5]+M*d[8];n.x=I*d[0]+N*d[1]+z*d[2],n.y=I*d[3]+N*d[4]+z*d[5],n.z=I*d[6]+N*d[7]+z*d[8],t.linearVelocity.addEqual(n)},Saucer.count=0,Saucer.tempVecs=[new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3],Saucer}(b.z1092);b.Saucer=t}(z0||(z0={})),function(t){var e=function(){function SaucerEvents(){}return SaucerEvents.ENTER=t.AppEvents.GetUniqueID(),SaucerEvents.EXIT=t.AppEvents.GetUniqueID(),SaucerEvents.RUN=t.AppEvents.GetUniqueID(),SaucerEvents}();t.SaucerEvents=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z730(){return null!==t&&t.apply(this,arguments)||this}return __extends(z730,t),z730.prototype.update=function(t){if(t.isTouchingGround()){var e=t.currentObject,o=z767.tempVecs[0],i=z767.tempVecs[1],n=t.physics.frontBody.body.position,s=e.body,a=s.position,r=t.physics.frontBody.rotationElements,c=t.targets.dirTarget;o.x=r[2],o.y=r[5],o.z=r[8],i.x=c.x,i.y=c.y,i.z=c.z;var d=o.dot(i);d<.5&&(d=.5);var p=13.3*d*t.size;if(p=13.3*t.size,.001<(p*=t.speed)){var l=Math.abs(.3*p);l=-t.speed,o.scaleEqual(l);var u=i,y=o;u.sub(n,a).cross(u,y).mulMat(s.inverseInertia,u);var g=s.angularVelocity;s.angularVelocity.addEqual(i);65,20,400<g.dot(g)&&(g.normalize(g),g.scaleEqual(20))}}},z730}(z767),e.z730=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z728(){return null!==t&&t.apply(this,arguments)||this}return __extends(z728,t),z728.prototype.update=function(t){if(t.isTouchingGround()){var e=t.physics,o=e.middleBody.rotationElements,i=t.currentObject,n=z767.tempVecs[0],s=t.targets.upVecTarget;n.x=o[1],n.y=o[4],n.z=o[7];i.applyForceToz1062Body(e.frontBody.body,s,0),i.applyForceToz1062Body(e.rearBody.body,s,0),i.applyForceToz1062Body(e.middleBody.body,s,0)}},z728}(z767),e.z728=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z665(){return t.call(this)||this}return __extends(z665,t),z665.prototype.update=function(t){var e,o,i,n,s=t.path[t.pathIndex+1],a=t.path[t.pathIndex],r=t.physics,c=r.headBody.body.position,d=r.frontBody.body.position,p=(e=c.x-s.x,o=c.y-s.y,i=c.z-s.z,n=t.size,t.targets),l=p.moveToTarget,u=p.lookToTarget,y=p.standToTarget;u.x=s.x,u.y=s.y,u.z=s.z,y.x=u.x,y.y=u.y,y.z=u.z,(e=d.x-a.x)*e+(o=d.y-a.y)*o+(i=d.z-a.z)*i<(n=t.size)*n&&t.pathIndex++,l.x=a.x,l.y=a.y,l.z=a.z},z665}(z767),e.z665=o}(z0||(z0={})),function(M){var t,e;t=M.z156||(M.z156={}),e=function(t){function z648(){return null!==t&&t.apply(this,arguments)||this}return __extends(z648,t),z648.prototype.update=function(t){t.forceTouchGround();z767.tempVecs[0],z767.tempVecs[1],z767.tempVecs[2],z767.tempVecs[3],t.size;var e=t.physics,o=e.middleBody.body.position,i=e.frontBody.body.position;e.rearBody.body.position,t.physics.middleBody.rotationElements;t.localPos.x=o.x,t.localPos.y=o.y,t.localPos.z=o.z,t.localPosMid.x=o.x,t.localPosMid.y=o.y,t.localPosMid.z=o.z,t.localPosFront.x=i.x,t.localPosFront.y=i.y,t.localPosFront.z=i.z;var n=t.currentObject,s=(n.height,n.body),a=s.position,r=n.radius,c=n.base.body,d=c.position,p=c.rotation.elements,l=(n.angVel,e.middleBody.body.position),u=t.targets,y=u.moveToTarget,g=u.lookToTarget,m=u.standToTarget,f=d.x,A=d.y,b=d.z,v=1,x=0,C=(B=0)*p[0]+x*p[1]+v*p[2],S=(p[3],p[4],p[5],B*p[6]+x*p[7]+v*p[8]);y.x=f+C*r*2,y.y=A+1.5*n.height,y.z=b+S*r*2,m.x=y.x,m.y=y.y,m.z=y.z,t.targets.pathTarget.copyFrom(y),g.x=y.x,g.y=y.y,g.z=y.z;var T=s.rotation.elements,B=(l=i).x-a.x,O=(x=l.y-a.y,v=l.z-a.z,B*T[0]+x*T[3]+v*T[6]),P=B*T[2]+x*T[5]+v*T[8];if(r*r<O*O+P*P)return t.pathIndex++,t.path2Index+=3,t.pubsub.broadcast(M.z1061Events.WALK),t.currentObject=t.currentObject.parent,void(t.physics.stayInsideBody=null)},z648}(z767),t.z648=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z598(){return null!==t&&t.apply(this,arguments)||this}return __extends(z598,t),z598.prototype.update=function(t){},z598}(z767),e.z598=o}(z0||(z0={})),function(A){var t,e;t=A.z156||(A.z156={}),e=function(t){function z447(){return null!==t&&t.apply(this,arguments)||this}return __extends(z447,t),z447.prototype.update=function(t){if(t.isTouchingGround()){t.currentObject;var e=z767.tempVecs[0],o=z767.tempVecs[1],i=z767.tempVecs[2],n=z767.tempVecs[3],s=t.physics.middleBody.rotationElements,a=t.targets.upVecTarget;if(e.x=s[1],e.y=s[4],e.z=s[7],e.dot(e,a)<.95)return;var r=t.physics.frontBody.body,c=(A.app.world.timeStep,r.rotationElements),d=t.targets.dirTarget;e.x=d.x,e.y=d.y,e.z=d.z,o.x=c[2],o.y=c[5],o.z=c[8],i.cross(e,o),i.normalize(i),n.cross(i,e),n.normalize(n);var p=n,l=e,u=i,y=o.x*p.x+o.y*p.y+o.z*p.z,g=o.x*l.x+o.y*l.y+o.z*l.z,m=.1*-Math.atan2(y,g),f=r.angularVelocity;u.scaleEqual(62*m),o.sub(u,f);900<o.dot(o)&&(o.normalize(o),o.scaleEqual(30)),f.addEqual(o)}},z447}(z767),t.z447=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z420(){return null!==t&&t.apply(this,arguments)||this}return __extends(z420,t),z420.prototype.update=function(t){if(t.isTouchingGround()){var e=t.physics.middleBody.rotationElements,o=z767.tempVecs[0],i=t.targets,n=i.moveToTarget,s=i.dirTarget,a=i.upVecTarget;if(o.x=e[1],o.y=e[4],o.z=e[7],o.dot(o,a)<.95)return;var r=t.physics.frontBody.body;o.x=n.x-r.position.x,o.y=n.y-r.position.y,o.z=n.z-r.position.z,o.normalize(o),s.x=o.x,s.y=o.y,s.z=o.z}},z420}(z767),e.z420=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z370(){var t=null!==e&&e.apply(this,arguments)||this;return t.line1=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],t.linePoints=[],t}return __extends(z370,e),z370.prototype.update=function(t){if(t.isTouchingGround()){var e=t.currentObject,o=z767.tempVecs[0],i=z767.tempVecs[1],n=(z767.tempVecs[2],z767.tempVecs[3],t.physics),s=(n.frontBody.body.position,n.middleBody.rotationElements),a=e.base.body.rotation.elements,r=e.body,c=r.position,d=n.frontBody.body,p=t.targets,l=p.pathTarget,u=p.dirTarget,y=p.upVecTarget,g=l.x-c.x,m=l.y-c.y,f=l.z-c.z,A=.4*Math.PI;g*a[0]+m*a[3]+f*a[6]<0&&(A*=-1);var b=t.currentObject.axisMat.elements,v=t.physics.middleBody.rotationElements;if(o.x=v[1],o.y=v[4],o.z=v[7],o.dot(y)<.95)return;var x=r.angularVelocity,C=x.x*b[1]+x.y*b[4]+x.z*b[7];s=t.physics.frontBody.rotationElements,o.x=s[2],o.y=s[5],o.z=s[8],i.x=u.x,i.y=u.y,i.z=u.z;var S=o.dot(i);S<.5&&(S=.5);A=13.3*S*t.size;if(A=13.3*t.size,.001<(A*=t.speed)){o.x*=A,o.y*=A,o.z*=A;var T=d.linearVelocity,B=T.x,O=T.y,P=T.z,M=(s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8],o.x),I=o.y,N=o.z,z=1-C/100;z*=.5,o.x=(M-B)*z,o.y=(I-O)*z,o.z=(N-P)*z;var w=138*t.size;w*w<o.dot(o)&&(o.normalize(o),o.scaleEqual(w)),T.addEqual(o)}}},z370}(z767),e.z370=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z361(){return null!==t&&t.apply(this,arguments)||this}return __extends(z361,t),z361.prototype.update=function(t){var e=t.currentObject,o=e.body.rotation.elements,i=e.body.position,n=t.localPos,s=t.physics.frontBody.body.position,a=s.x-i.x,r=s.y-i.y,c=s.z-i.z,d=a*o[0]+r*o[3]+c*o[6],p=a*o[1]+r*o[4]+c*o[7],l=a*o[2]+r*o[5]+c*o[8];n.x=d,n.y=p,n.z=l},z361}(z767),e.z361=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z285(){var t=null!==e&&e.apply(this,arguments)||this;return t.test=0,t}return __extends(z285,e),z285.prototype.update=function(t){.98<Math.random()&&Math.random()},z285}(z767),e.z285=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z276(){return null!==t&&t.apply(this,arguments)||this}return __extends(z276,t),z276.prototype.update=function(t){t.bones.tail.ang=-.62*Math.PI},z276}(z767),e.z276=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z259(){return null!==t&&t.apply(this,arguments)||this}return __extends(z259,t),z259.prototype.update=function(t){var e=t.currentObject,o=e.body.position,i=t.targets,n=i.pathTarget,s=i.moveToTarget,a=i.lookToTarget,r=n.x-o.x,c=n.y-o.y,d=n.z-o.z,p=e.base.body.rotation.elements,l=(Math.PI,r*p[0]+c*p[3]+d*p[6]),u=t.currentObject.axisMat.elements,y=e.radius,g=t.size,m=t.physics.frontBody.body.position,f=(r=m.x-o.x,c=m.y-o.y,d=m.z-o.z,z767.tempVecs[0]),A=z767.tempVecs[1],b=z767.tempVecs[2],v=(l=r*u[0]+c*u[3]+d*u[6],r*u[1]+c*u[4]+d*u[7]),x=(u[2],u[5],u[8],(l=0)*u[0]+v*u[1]+0*u[2]+o.x),C=l*u[3]+v*u[4]+0*u[5]+o.y,S=l*u[6]+v*u[7]+0*u[8]+o.z;f.x=m.x-x,f.y=m.y-C,f.z=m.z-S,f.normalize(f),A.x=u[1],A.y=u[4],A.z=u[7],b.cross(f,A),b.normalize(b);var T=2*t.size;b.x*=T,b.y*=T,b.z*=T;var B=t.physics.frontBody.body.position,O=.65*y,P=f.x*O+x,M=f.y*O+C,I=f.z*O+S;s.x=b.x+P,s.y=b.y+M,s.z=b.z+I,a.x=b.x+B.x,a.y=b.y+B.y+g,a.z=b.z+B.z,a.x=s.x,a.y=s.y,a.z=s.z},z259}(z767),e.z259=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z206(){return null!==t&&t.apply(this,arguments)||this}return __extends(z206,t),z206.prototype.update=function(t){var e=t.currentObject,o=e.body.position,i=t.targets.pathTarget,n=i.x-o.x,s=i.y-o.y,a=i.z-o.z,r=e.base.body.rotation.elements,c=(Math.PI,n*r[0]+s*r[3]+a*r[6]),d=t.currentObject.axisMat.elements,p=e.radius,l=(t.size,t.physics.middleBody.body.position),u=(n=l.x-o.x,s=l.y-o.y,a=l.z-o.z,z767.tempVecs[0]),y=(z767.tempVecs[1],z767.tempVecs[2],c=n*d[0]+s*d[3]+a*d[6],d[1],d[4],d[7]),g=c*c+(A=n*d[2]+s*d[5]+a*d[8])*A,m=p-t.size,f=m*m;Math.max(.3*p,2*t.size);if(!(0<g)){c=0,y=t.size;var A=0,b=c*d[0]+y*d[1]+A*d[2]+o.x,v=c*d[3]+y*d[4]+A*d[5]+o.y,x=c*d[6]+y*d[7]+A*d[8]+o.z;u.x=l.x-b,u.y=l.y-v,u.z=l.z-x,f<g&&(u.x=b-l.x,u.y=v-l.y,u.z=x-l.z),u.normalize(u);var C=t.physics.middleBody.body,S=4*t.size;u.x*=S,u.y*=S,u.z*=S;C.linearVelocity;C.linearVelocity.addEqual(u)}},z206}(z767),e.z206=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1009(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1009,t),z1009.prototype.test=function(t){var e=t.path[t.pathIndex].data.obj,o=e.body,i=o.position,n=e.radius,s=(e.height,t.physics),a=t.size,r=s.frontBody.body,c=(i=o.position,r.position),d=c.x-i.x,p=c.y-i.y,l=c.z-i.z,u=o.rotation.elements,y=d*u[0]+p*u[3]+l*u[6],g=(u[1],u[4],u[7],d*u[2]+p*u[5]+l*u[8]),m=n-a;return y*y+g*g<m*m},z1009}(z770),e.z1009=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1008(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1008,t),z1008.prototype.test=function(t){var e=t.currentObject,o=(e.base.body.rotation.elements,e.base.body.position,e.body),i=o.rotation.elements,n=o.position,s=t.physics,a=(s.middleBody.body,s.frontBody.body.position),r=a.x-n.x,c=a.y-n.y,d=a.z-n.z,p=r*i[0]+c*i[3]+d*i[6],l=(i[1],i[4],i[7],r*i[2]+c*i[5]+d*i[8]),u=p*p+l*l,y=e.radius,g=t.size;return(g=y)*g<u},z1008}(z770),e.z1008=o}(z0||(z0={})),function(o){var t=function(e){function z55(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z406],t.updatez156=[o.z156.z362,o.z156.z665,o.z156.z461,o.z156.z446,o.z156.z369,o.z156.z590,o.z156.z731,o.z156.z209,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z739],t.exitz156=[o.z156.z502,o.z156.z435],t.transitions=[{condition:o.z768.z1009,trueNode:{state:o.z53}}],t}return __extends(z55,e),z55}(z49);o.z55=t}(z0||(z0={})),function(o){var t=function(e){function z54(){var t=null!==e&&e.apply(this,arguments)||this;return t.updatez156=[o.z156.z648,o.z156.z590,o.z156.z461,o.z156.z446,o.z156.z369,o.z156.z732,o.z156.z209,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z739],t.listeners=[{event:o.z1061Events.WALK,state:o.z66}],t}return __extends(z54,e),z54}(z49);o.z54=t}(z0||(z0={})),function(o){var t=function(e){function z53(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z598,o.z156.z435,o.z156.z278,o.z156.z276],t.updatez156=[o.z156.z260,o.z156.z361,o.z156.z420,o.z156.z447,o.z156.z728,o.z156.z370,o.z156.z730,o.z156.z461,o.z156.z590,o.z156.z732,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z739],t.exitz156=[o.z156.z502],t.states=[o.z52],t.initialState=o.z52,t.transitions=[{condition:o.z768.z1008,trueNode:{state:o.z54}}],t}return __extends(z53,e),z53}(z49);o.z53=t}(z0||(z0={})),function(o){var t=function(e){function z52(){var t=null!==e&&e.apply(this,arguments)||this;return t.updatez156=[o.z156.z284,o.z156.z285],t}return __extends(z52,e),z52}(z49);o.z52=t}(z0||(z0={})),function(o){var t=function(e){function z51(){var t=null!==e&&e.apply(this,arguments)||this;return t.states=[o.z55,o.z53,o.z54],t}return __extends(z51,e),z51}(z49);o.z51=t}(z0||(z0={})),function(M){var t=function(f){function Swing(t){var e=f.call(this)||this;return e.accType=M.z1044.SWING,e.nodes=void 0,e.num=0,e.world=void 0,e.bodyBottom=void 0,e.bodySide1=void 0,e.bodySide2=void 0,e.testMesh=void 0,e.boxSize=1,e.radius=1,e.armLen=.55,e.armY=.85,e.armLenHyp=0,e.angToHyp=0,e._bodyOffsetY=0,e.worldMatrix=BABYLON.Matrix.Identity(),e.invWorldMatrix=BABYLON.Matrix.Identity(),e.floorThickness=0,e.sideNodesConnectedRight=!1,e.sideNodesConnectedLeft=!1,e.rotMatDelta=BABYLON.Matrix.Identity(),e.rotMat=BABYLON.Matrix.Identity(),e.base=void 0,e.isDraggingBottom=!1,e.lastMoveFrame=0,e.lastMoveVelSq=0,e.maxSwingRot=Math.PI,e.maxQuat=new OIMO.Quat,e.minQuat=new OIMO.Quat,e.wallNodesUnder=[],e.swingVelFrac=.5,e._tempArray=[],e.maxz1062s=4,e.hamsters=new z1072,Swing.count++,e.shapeName="Swing",e.num=Swing.count,e.position=BABYLON.Vector3.Zero(),e.scaling=new BABYLON.Vector3(1,1,1),e.placementType=M.PlacementType.GRID|M.PlacementType.z1048|M.PlacementType.MID|M.PlacementType.ALIGN_BOTTOM,e._colors={},e._colors.swing=new BABYLON.Color3,e._colors.stand=new BABYLON.Color3,M.z1073.SetColor3FromHex("#ffff00",e._colors.swing),M.z1073.SetColor3FromHex("#3838ff",e._colors.stand),e}return __extends(Swing,f),Swing.prototype.getWorldMatrix=function(){return this.worldMatrix},Swing.prototype.addToActiveObjects=function(){-1==Swing.activeObjects.indexOf(this)&&Swing.activeObjects.push(this)},Swing.prototype.removeFromActiveObjects=function(){var t=Swing.activeObjects.indexOf(this);-1!=t&&Swing.activeObjects.splice(t,1)},Swing.prototype.init=function(t){f.prototype.init.call(this,t),this.boxSize=1,t.boxSize&&(this.boxSize=t.boxSize),this.canRotate=!1,this.canTranslate=!0,this.canDelete=!0,this.world=t.world,this.addToActiveObjects(),t.width&&(this.width=t.width);var e=.5*this.width,o=this.armLen;this.armLenHyp=Math.sqrt(e*e+o*o),this.angToHyp=Math.atan(this.armY/this.armLenHyp),this.mapPlacementInfo||(this.mapPlacementInfo=new M.MapPlacementInfo({mapPlacementSizeX:.25,offsetDragFromMenuY:-.5})),this.controlAnchor||this.addControlAnchor(),this.controlPositionLocal.x=0,this.controlPositionLocal.y=.5;var i=this.controlPositionLocal.z=0,n=0;this.isDraggingBottom=!1,null!=t.x&&(i=t.x),null!=t.y&&(n=t.y),this.floorThickness=.04,this.height=1;if(this.depth=.6,t.isMenuItem&&(this.controlPositionLocal.y=.5,t.isMenuItem),t.isMenuItem);else if(!this.hitMeshes){this.hitMeshes=[];var s=this.width,a=this.armY-.04,r=M.app.graphicsHelper.getHitMesh(s,a,this.depth,!1);r.rotationQuaternion=BABYLON.Quaternion.Identity(),this.hitMeshes.push(r);var c=M.App.z1033,d=[1,.4,.2,c,4294967295];this.radius=.5;var p="swing"+this.num;this.bodyBottom=new OIMO.Body({holes:[],size:[1,.06,.6],pos:[0,0,0],world:this.world,type:"holey_box",move:!0,name:p+"_swing",config:d}).body;(this.bodyBottom.shapes.entity=this).bodySide1=new OIMO.Body({size:[.02,1,0],pos:[0,0,0],rot:[0,0,150],world:this.world,type:"tube",move:!1,name:p+"_swing_side1",config:d}).body,this.bodySide2=new OIMO.Body({size:[.02,1,0],pos:[0,0,0],rot:[0,0,30],world:this.world,type:"tube",move:!1,name:p+"_swing_side1",config:d}).body,this.base=new OIMO.Body({type:"box",size:[1,.1,1],pos:[0,0,0],rot:[0,0,0],move:!1,world:this.world,name:p+"_base"});d=[.03,0,.2,c,4294967295];new OIMO.Link({type:"jointHinge",body1:p+"_base",body2:p+"_swing",pos1:[0,this.armY,0],pos2:[0,this.armLen,0],axe1:[0,0,1],axe2:[0,0,1],collision:!1,world:this.world}),this.nodes=[];for(var l=0;l<5;l++){var u=new GraphNode(0,0,0);M.app.graph.addNode(u),this.nodes.push(u)}this.nodes[1].data.enterEvent=M.SwingEvents.USE,this.nodes[1].data.enterNextNode=this.nodes[2],this.nodes[3].data.enterEvent=M.SwingEvents.USE,this.nodes[3].data.enterNextNode=this.nodes[2],this.rightGraphNode=this.nodes[0],this.rightGraphNode2=this.nodes[1],this.centerGraphNode=this.nodes[2],this.leftGraphNode=this.nodes[4],this.leftGraphNode2=this.nodes[3],this.rightGraphNode.data.enterEvent=M.SwingEvents.USE,this.rightGraphNode.data.enterNextNode=this.nodes[1],this.leftGraphNode.data.enterEvent=M.SwingEvents.USE,this.leftGraphNode.data.enterNextNode=this.nodes[3],this.updateNodes();for(l=0;l<4;l++){var y=this.nodes[l],g=this.nodes[l+1],m=.1*Math.sqrt(z1.distanceSquared(y,g));y.addConnection(g,m),g.addConnection(y,m)}this.bodyFixer=new M.SwingHamBodyFixer,this.bodyFixer.init({accessory:this,radius:1.1*this.armY}),this.navigator=new M.SwingNavigator,this.navigator.init({accessory:this,radius:.5*this.width+.1})}if(this.shapeSide1?(this.shapeSide1.init({name:"swingSide1",renderingGroupID:this.renderingGroupID}),this.shapeSide2.init({name:"swingSide1",renderingGroupID:this.renderingGroupID}),this.shapeBottom.init({name:"swingBottom1",renderingGroupID:this.renderingGroupID}),this.shapeSideFront.init({name:"swingSide2",renderingGroupID:this.renderingGroupID})):(this.shapeSide1=ObjectPool.get("z1068",{name:"SwingSide1",renderingGroupID:this.renderingGroupID}),this.shapeSide2=ObjectPool.get("z1068",{name:"SwingSide1",renderingGroupID:this.renderingGroupID}),this.shapeBottom=ObjectPool.get("z1068",{name:"SwingBottom1",renderingGroupID:this.renderingGroupID}),this.shapeBottom.body=this.bodyBottom,(this.shapeBottom.parent=this).shapeSideFront=ObjectPool.get("z1068",{name:"SwingSide2",renderingGroupID:this.renderingGroupID}),this.shapeSideFront.body=this.bodyBottom),this._initColors(),t.skipAddToScene)this.removeFromScene();else{if(this.setPosition(i,n,0),this.addToScene(),this.isMenuItem||this.cage||(this.cage=M.Cage.getCageAt(this.position.x,this.position.y+.5*this.height,this.position.z)),!this.cage)return;this.cage.isReady?this.addToObject(this.cage):this.cage.pubsub.subscribe("ready",this.addToObject,this)}},Swing.prototype.updateNodes=function(){if(this.nodes){for(var t=this.radius+.15,e=Math.PI/4,o=0;o<5;o++){(i=this.nodes[o]).x=this.position.x+Math.cos(o*e+0)*t,i.y=this.position.y+Math.sin(o*e+0)*t+.04}for(o=0;o<this.nodes.length;o++){var i;(i=this.nodes[o]).data.obj=this.cage,i.data.obj2=this}if(this.rightGraphNode.x+=.1,this.rightGraphNode.y+=.3,this.leftGraphNode.x-=.1,this.leftGraphNode.y+=.3,this.centerGraphNode.y-=.17,this.cage){var n=this.cage.left+.25,s=this.cage.right-.25;this.leftGraphNode.x<n&&(this.leftGraphNode.x=n,this.leftGraphNode.y+=.1),this.rightGraphNode.x>s&&(this.rightGraphNode.x=s,this.rightGraphNode.y+=.1)}}},Swing.prototype.setPositionOnMapFromDrop=function(t,e,o){var i=this._tempDropLoc;this.getPositionOnMapFromDropToRef(t,e,o,i),this.setPositionDrag(i.x,i.y,i.z,!0),this.setPosition(i.x,i.y,i.z,!1,!1),this.updateCage(),this.setToFloor(e)},Swing.prototype.setToFloor=function(t,e){var o=this.position.x,i=this.position.z,n=this.getFloorY(o,t,i);if(null!=e&&n<e&&(n=e),n!=this.position.y){if(this.cage){var s=this.cage.getPlatformAbove(o,n,i);if(s){if(n+this.height>s.position.y-0){var a=s.position.y-this.height-0;a>=this.cage.position.y&&(n=a)}}}this.setPosition(o,n,i)}},Swing.prototype.getFloorY=function(t,e,o){var i=e,n=this.cage;if(n||(n=M.Cage.getCageAt(t,e+.5*this.height,o)),n){i=n.position.y;var s=n.getPlatformUnder(t,e,o);if(s&&s.position.y>=i&&(i=s.position.y+.01),n.bedding){var a=n.getMinYBetween(t-.75*this.width,t+.75*this.width);if(i<a){i=a;var r=n.getPlatformAbove(t,i,o);if(r){var c=0;r.position.y<i+this.height+c&&(i=r.position.y-this.height-c)}}if(!s){c=.1;n.top<i+this.height+c&&(i=n.top-this.height-c)}}}return i},Swing.prototype.setHitMesh=function(t,e,o){if(this.hitMeshes&&this.hitMeshes[0]){var i=this.hitMeshes[0];i.position.x=t,i.position.y=e+.5*this.armY,i.position.z=o,i.computeWorldMatrix()}},Swing.prototype.updateBodyPositions=function(t){if(void 0===t&&(t=!0),this.bodyBottom){var e=this.position;if((o=this.base.body.position).x=e.x,o.y=e.y+this._bodyOffsetY+0,o.z=e.z,this.base.body.syncShapes(),this.bodySide1){var o=this.bodySide2.position,i=this.bodySide2.orientation;o.x=e.x+.22,o.y=e.y+this._bodyOffsetY+0+.5,o.z=e.z-.5*this.depth-.05,this.bodySide2.syncShapes();var o=this.bodySide1.position;i=this.bodySide1.orientation;o.x=e.x-.22,o.y=e.y+this._bodyOffsetY+0+.5,o.z=e.z-.5*this.depth-.05,this.bodySide1.syncShapes(),this.testMesh&&(this.testMesh.position.x=o.x,this.testMesh.position.y=o.y,this.testMesh.position.z=o.z,this.testMesh.rotationQuaternion.x=i.x,this.testMesh.rotationQuaternion.y=i.y,this.testMesh.rotationQuaternion.z=i.z,this.testMesh.rotationQuaternion.w=i.s)}if(this.isMenuItem&&this.isMenuItem,t)(o=this.bodyBottom.position).x=e.x,o.y=e.y+.3,o.z=e.z,this.bodyBottom.syncShapes();var n=this.base.body,s=n.position;s.x=e.x,s.y=e.y+0,s.z=e.z,n.syncShapes()}},Swing.prototype.setPositionDrag=function(t,e,o,i){var n=t-this.position.x,s=e-this.position.y,a=o-this.position.z;f.prototype.setPositionDrag.call(this,t,e,o,i),this.updateBodyPositions(!1),this.nodes&&this._translateNodes(n,s,a),this.shapeSide1.setPosition(t,e,o-.5*this.depth-.1),this.shapeSide2.setPosition(t,e,o+.5*this.depth+.1),this.setHitMesh(t,e,o),i&&this.updateCage();var r=this.bodyBottom,c=r.position;c.x+=n,c.y+=s,c.z+=a;var d=Swing.tempVecs[0];d.x=2*-n,(1e3<s||s<-1e3)&&(s=0),d.y=2*-s,d.z=0,r.linearVelocity.addEqual(d),this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position)},Swing.prototype.updateCage=function(){var t=M.Cage.getCageAt(this.position.x,this.position.y+.3,this.position.z);this.addToObject(t)},Swing.prototype.setPosition=function(t,e,o,i,n){if(void 0===i&&(i=!1),void 0===n&&(n=!0),!this.isMenuItem||this.position.x!=t||this.position.y!=e||this.position.z!=o){var s=this.position.x,a=this.position.y,r=this.position.z,c=(this.position.x=t)-s,d=(this.position.y=e)-a,p=(this.position.z=o)-r;if(this.position.x=t,this.position.y=e,this.position.z=o,this.nodes&&this._translateNodes(c,d,p),this.setHitMesh(t,e+.02,o),this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position),this.bodyBottom||(this.shapeBottom.setPosition(t,e+.3,o),this.shapeSideFront.setPosition(t,e+.3,o)),this.shapeSide1.setPosition(t,e+.02,o-.5*this.depth-.1),this.shapeSide2.setPosition(t,e+.02,o+.5*this.depth+.1),this.bodyFixer&&this.bodyFixer.setPosition(t,e+this.armY,o),this.navigator&&this.navigator.setPosition(t,e+.3,o),this.navigatorLeft&&this.navigatorLeft.setPosition(t,e,o),this.navigatorRight&&this.navigatorRight.setPosition(t,e,o),this.leftNavigator){var l=.5*this.depth+.05;this.leftNavigator.setPosition(t-this.radius- -.1,e+(.15+.02),o-l),this.rightNavigator.setPosition(t+this.radius+-.1,e+(.15+.02),o-l)}if(!i&&this.bodyBottom){this.updateBodyPositions(n),this.disconnect();var u=M.Cage.getCageAt(t,e+.3,o);u!=this.cage?(this.cage&&this.cage.removeObject(this),u&&this.addToObject(u)):(this.updateNodes(),this.checkConnections())}this.setMaxRot(),this._connected=!0,this.worldMatrix.setTranslation(this.position),this.worldMatrix.invertToRef(this.invWorldMatrix),this.onChangeObservable.notifyObservers(this)}},Swing.prototype._translateNodes=function(t,e,o){for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i];n.x+=t,n.y+=e,n.z+=o}},Swing.prototype.getGraphNodeAt=function(t,e,o,i,n,s,a,r){void 0===i&&(i=!1),void 0===n&&(n=null),void 0===s&&(s=0),void 0===a&&(a=null);for(var c,d,p=this.nodes,l=p.length,u=Number.MAX_VALUE,y=Swing.tempVecs[0],g=0;g<l;g++){var m=(c=p[g]).x-t,f=c.y-e,A=c.z-o,b=m*m+f*f+A*A;if(b<u){if(i&&0==c.type)continue;if(n)if(y.x=m,y.y=f,y.z=A,y.normalize(y),y.dot(n)<s)continue;u=b,d=c}}return d},Swing.prototype.disablePhysics=function(){},Swing.prototype.enablePhysics=function(){},Swing.prototype.addToScene=function(){this.isOnScene||(f.prototype.addToScene.call(this),this.enablePhysics(),this.shapeSide1.addToScene(),this.shapeSide2.addToScene(),this.shapeBottom.addToScene(),this.shapeSideFront.addToScene(),this.isMenuItem||(M.app.graphicsHelper.addForUpdate(this.shapeSideFront),M.app.graphicsHelper.addForUpdate(this.shapeBottom),M.app.graphicsHelper.addForUpdate(this)))},Swing.prototype.update=function(){if(!this.isMenuItem){var t=Swing.tempMat;this.rotMat.invertToRef(t);var e=this.bodyBottom.rotation.elements,o=Swing.z4[0],i=Swing.z4[1],n=Swing.z4[2];o.x=e[0],o.y=e[3],o.z=e[6],i.x=e[1],i.y=e[4],i.z=e[7],n.x=e[2],n.y=e[5],n.z=e[8],BABYLON.Matrix.FromXYZAxesToRef(o,i,n,this.rotMat),this.rotMat.multiplyToRef(t,this.rotMatDelta);var s=this.bodyBottom.linearVelocity,a=this.bodyBottom.rotation.elements,r=this.bodyBottom.position.x-this.position.x;s.x-=a[0]*this.swingVelFrac*r,s.y-=a[3]*this.swingVelFrac*r,s.z-=a[6]*this.swingVelFrac*r,this.hamsters.length||(s.x*=.998,s.y*=.998,s.z*=.998);var c=s.x*s.x+s.y*s.y;.001<c&&(this.lastMoveFrame=M.app.frameNum,this.lastMoveVelSq=c),this.checkLimitRotToCeiling()}},Swing.prototype.setMaxRot=function(){if(this.cage){var t=this.cage.getPlatformAbove(this.position.x,this.position.y+.5,this.position.z);this.platformAbove=t;var e=this.cage.top;t&&(e=t.position.y);var o=e-this.armY-this.armLen,i=Swing.tempVecs[0];if(i.x=0,i.y=0,i.z=1,this.position.y>o){var n=e-(this.position.y+this.armY),s=Math.atan(n/this.armLenHyp);this.maxSwingRot=.5*Math.PI-this.angToHyp+s,this.minQuat.setFromAxisAngle(i,-this.maxSwingRot),this.maxQuat.setFromAxisAngle(i,this.maxSwingRot)}else this.maxSwingRot=Math.PI,this.minQuat.setFromAxisAngle(i,-this.maxSwingRot),this.maxQuat.setFromAxisAngle(i,this.maxSwingRot)}},Swing.prototype.checkLimitRotToCeiling=function(){if(this.cage){var t=this.cage.top;this.platformAbove&&(t=this.platformAbove.position.y);var e=t-this.armY-this.armLen;if(this.position.y<e)this.cage.getPlatformAbove(this.position.x,this.position.y,this.position.z)!=this.platformAbove&&(this.setMaxRot(),e=(t=this.platformAbove?this.platformAbove.position.y:this.cage.top)-this.armY-this.armLen);if(this.position.y>e){var o=this.maxSwingRot,i=this.bodyBottom.position.x-this.position.x,n=this.bodyBottom.position.y-(this.position.y+this.armY);if(n>.5*-this.armLen){var s=.5*Math.PI,a=Math.atan2(n,i)+s;a>Math.PI&&(a-=2*Math.PI);var r=this.bodyBottom.linearVelocity,c=this.bodyBottom.position,d=this.bodyBottom.shapes.position,p=this.bodyBottom.orientation;o<a?(0<r.y&&(r.x*=-1,r.y*=-1,r.z*=-1),c.x=this.position.x+Math.cos(o-s)*this.armLen,c.y=this.position.y+this.armY+Math.sin(o-s)*this.armLen,d.x=c.x,d.y=c.y,p.x=this.maxQuat.x,p.y=this.maxQuat.y,p.z=this.maxQuat.z,p.s=this.maxQuat.s,this.bodyBottom.syncShapes()):a<-o&&(0<r.y&&(r.x*=-1,r.y*=-1,r.z*=-1),c.x=this.position.x+Math.cos(-o-s)*this.armLen,c.y=this.position.y+this.armY+Math.sin(-o-s)*this.armLen,d.x=c.x,d.y=c.y,p.x=this.minQuat.x,p.y=this.minQuat.y,p.z=this.minQuat.z,p.s=this.minQuat.s,this.bodyBottom.syncShapes())}}}},Swing.prototype.removeFromScene=function(){this.isOnScene&&(f.prototype.removeFromScene.call(this),this.disablePhysics(),this.shapeSide1.removeFromScene(),this.shapeSide2.removeFromScene(),this.shapeBottom.removeFromScene(),this.shapeSideFront.removeFromScene(),this.isMenuItem||this.setPositionDrag(this.position.x,9999,this.position.z,!1),this.navigator&&this.navigator.setPosition(this.position.x,9999,this.position.z),this.bodyFixer&&this.bodyFixer.setPosition(this.position.x,9999,this.position.z),this.navigatorLeft&&this.navigatorLeft.setPosition(this.position.x,9999,this.position.z),this.navigatorRight&&this.navigatorRight.setPosition(this.position.x,9999,this.position.z),this.wallNodesUnder.length&&this.wallNodesUnder.length,this.platformAbove=null,M.app.graphicsHelper.removeFromUpdate(this.shapeBottom),M.app.graphicsHelper.removeFromUpdate(this.shapeSideFront))},Swing.prototype.recycle=function(){f.prototype.recycle.call(this)},Swing.prototype.disconnect=function(){if(this.bodyBottom){this.skipConnect=!0;for(var t=this.nodes,e=t.length,o=0;o<this.wallNodesUnder.length;o++)this.wallNodesUnder[o].type=null;for(o=this.wallNodesUnder.length=0;o<e;o++)for(var i=t[o],n=0;n<i.connections.length;n++){var s=i.connections[n];if((!s.data.obj||s.data.obj.acc1!=this)&&(s.data.obj!=i.data.obj||s.data.obj2!=i.data.obj2)){if(i.removeConnection(s),s.removeConnection(i),n--,s.data.obj2&&s.data.obj2.accType==M.z1044.z1049&&s.data.obj2.removeObject(this),s.data.tube){var a=s.data.tube;a.initNode(s),a.checkGroundConnections()}s.data.obj2&&s.data.obj2.onAfterDisconnect&&s.data.obj2.onAfterDisconnect(this),s.data.obj&&s.data.obj.onAfterDisconnect&&s.data.obj.onAfterDisconnect(this)}}this.skipConnect=!1,this.sideNodesConnectedLeft=!1,this.sideNodesConnectedRight=!1}},Swing.prototype.onAfterDisconnect=function(t){t.accType==M.z1044.z1046&&this.isOnScene&&(this.updateNodes(),this.checkCageConnections(),this.checkPlatformConnections(),this.checkRampConnections())},Swing.prototype.setColor=function(t,e,o,i){f.prototype.setColor.call(this,t,e,o,i),"swing"==i&&(this.shapeBottom.setColor(t,e,o),this.shapeSideFront.setColor(t,e,o),f.prototype.setColor.call(this,t,e,o,i)),"stand"==i&&(this.shapeSide1.setColor(t,e,o),this.shapeSide2.setColor(t,e,o),f.prototype.setColor.call(this,t,e,o,i))},Swing.prototype.getNeighborAt=function(t,e,o){for(var i,n=this.position.x,s=this.position.y+.5*this.height,a=this.position.z,r=this.nodes,c=t-n,d=e-s,p=0;p<r.length;p++){var l=r[p],u=l.x-n,y=l.y-s,g=l.z-a;if(!(.3<g||g<-.3)&&(!(c<0&&0<u)&&!(0<c&&u<0)&&!(d<0&&0<y)&&!(0<d&&y<0)&&(i=M.z1092.GetObjConnectedToNodeAt(l,t,e,o))))return i}},Swing.prototype.getProps=function(){return f.prototype.getProps.call(this)},Swing.prototype.getCenterAtPosToRef=function(t,e,o,i){i.x=t,i.y=e+.5*this.armY,i.z=o},Swing.prototype.getPositionOnMapFromDropToRef=function(t,e,o,i){var n=this.mapPlacementInfo;t=1*z1.round((t+n.mapOffsetDropTargetX)/1,n.mapPlacementSizeX)+n.mapOffsetX;e=1*z1.round((e+n.mapOffsetDropTargetY)/1,n.mapPlacementSizeY)+n.mapOffsetY;if(this.placementType&M.PlacementType.ALIGN_BACK&&(o-=.5*this.depth),this.placementType&M.PlacementType.z1048){var s=this.hitMeshes[0].getBoundingInfo(),a=s.boundingBox.maximum.x,r=s.boundingBox.maximum.y,c=M.z1092.z4[2];this.getCenterAtPosToRef(t,e,o,c);var d=M.Cage.getCageAt(c.x,c.y,c.z);if(d){var p=d.position,l=p.x-.5*d.width,u=p.x+.5*d.width,y=p.y+d.height,g=d.floorY,m=t+a+.33,f=e-r;t-a-.33<l?t=l+a+.33:u<m&&(t=u-a-.33),y<e+r?e=y-r:f<g&&(e=g+r)}}i.x=t,i.y=e,i.z=o},Swing.prototype.isValidDropLocation=function(t,e,o,i){var n=this._tempDropLoc;this.getPositionOnMapFromDropToRef(t,e,o,n);var s=M.Cage.getCageAt(n.x,n.y,n.z);if(!s)return!1;var a=s.position.y,r=s.getPlatformUnder(n.x,n.y,n.z);if(r&&(a=r.position.y),i&&i.dragPlatformY&&(a=i.dragPlatformY),s.bedding){var c=s.getHeightAt(n.x,n.z);a<c&&(a=c);var d=s.getPlatformAbove(n.x,n.y,n.z);if(d){var p=this.height+.1;p=Math.min(d.position.y-s.position.y,p),d.position.y-c<p&&(a=d.position.y-p)}else{a+this.height>s.top&&(a=s.top-this.height,r||(a-=.05))}}if(.001<a+this.height-s.top)return!1;var l=s.getObjectAt(n.x,n.y,n.z,M.z1044.z1051,1);if(l){var u=.5*l.boxSize-.01,y=.5*this.width+.2,g=this.height,m=this.position,f=m.x+y+u,A=m.x-y-u,b=m.y+g+u,v=m.y-u,x=l.position.x,C=l.position.y;if(A<x&&x<f&&v<C&&C<b)return!1}var S=this.hitMeshes[0],T=S.position.x,B=S.position.y,O=S.position.z;this.setHitMesh(n.x,a,n.z);var P=this.intersectsAccesories(s.objs,M.z1044.SWING|M.z1044.z1046|M.z1044.z1050|M.z1044.z1049);return S.position.x=T,S.position.y=B,S.position.z=O,S.computeWorldMatrix(),!P},Swing.prototype.addToObject=function(t){this.cage&&this.cage!=t&&this.cage.removeObject(this),this.parent=t,(this.cage=t)&&(this.disconnect(),t.addObject(this),this.setMaxRot(),this.updateNodes(),this.checkConnections())},Swing.prototype.isInBox=function(t,e,o,i){void 0===i&&(i=0);var n=this.position,s=.5*this.width+i,a=.5*this.depth+i,r=n.x-s,c=n.x+s,d=n.y-i,p=n.y+this.boxSize+i,l=n.z-a,u=n.z+a;return!(t<r||c<t||e<d||p<e||o<l||u<o)},Swing.prototype.getPointSideY=function(t,e,o,i){void 0===e&&(e=0),void 0===o&&(o=0),void 0===i&&(i=0);var n=Swing.z4[0];n.x=t.x-this.position.x,n.y=t.y-this.position.y,n.z=t.z-this.position.z,isNaN(n.x);var s=this.boxSize+.5*e,a=i,r=.5*(this.depth+o);return n.x<-s||n.x>s?0:n.z<-r||n.z>r?0:n.y>a?1:-1},Swing.prototype.checkConnections=function(){this.checkTubeConnections(),this.checkCageConnections(),this.checkPlatformConnections(),this.checkRampConnections(),this.checkSwingConnections()},Swing.prototype.checkTubeConnections=function(){if(this.cage){var t=this._tempArray;t.length=0,M.Tube.getObjectsAt(this.position.x,this.position.y+.5*this.boxSize,this.position.z,2*this.boxSize+.5,this.boxSize+.5,this._tempArray);for(var e=0;e<t.length;e++){var o=t[e];this.checkTubeConnection(o)}}},Swing.prototype.checkTubeConnection=function(t){if(!t.skipConnect){var e=t.getGraphNodeAtClosestToOpening(this.position.x,this.position.y,this.position.z);if(1<e.connections.length){var o=e.connections[1];(o.data.obj2||o.data.obj).accType!=M.z1044.z1051&&(o.removeConnection(e),e.removeConnection(o))}t.checkGroundConnections()}},Swing.prototype.checkCageConnectorConnections=function(){for(var t=this.cage.connectors,e=0;e<t.length;e++){var o=t[e];if(o.cage1==this.cage||o.cage2==this.cage){if(.5<Math.abs(o.position.x-this.leftGraphNode.x)&&.5<Math.abs(o.position.x-this.rightGraphNode.x))continue;if(o.position.y-this.position.y<0)continue;if(1<o.position.y-this.position.y)continue;t[e].refreshConnections()}}},Swing.prototype.checkRightSideConnections=function(t,e){void 0===e&&(e=M.z1044.z1048|M.z1044.z1047);var o=!1,i=Swing.z4[0];i.x=1,i.y=0,i.z=0;var n=this.rightGraphNode,s=this.position.x+.5*this.width+.15,a=this.position.y+.5;i.x=0,i.y=0,i.z=1;var r=t.getGraphNodeAt(s,a,n.z+.1*i.z,null,i,null,null,e);if(r&&a-r.y<.5){n.x=s,n.y=a;var c=1*Math.sqrt(z1.distanceSquared(n,r));r.addConnection(n,c),n.addConnection(r,c),o=this.sideNodesConnectedRight=!0}if((i.x=0,i.y=0,i.z=-1,r=t.getGraphNodeAt(s,a,n.z+.1*i.z,null,i,null,null,e))&&a-r.y<.5){n.x=s,n.y=a;c=1*Math.sqrt(z1.distanceSquared(n,r));r.addConnection(n,c),n.addConnection(r,c),o=this.sideNodesConnectedRight=!0}return o},Swing.prototype.checkLeftSideConnections=function(t,e){void 0===e&&(e=M.z1044.z1048|M.z1044.z1047);var o=!1,i=Swing.z4[0];i.x=1,i.y=0,i.z=0;var n=this.leftGraphNode,s=this.position.x-.5*this.width-.15,a=this.position.y+.5;i.x=0,i.y=0,i.z=1;var r=t.getGraphNodeAt(s,a,n.z+.1*i.z,null,i,null,null,e);if(r&&a-r.y<.5){n.x=s,n.y=a;var c=1*Math.sqrt(z1.distanceSquared(n,r));r.addConnection(n,c),n.addConnection(r,c),o=this.sideNodesConnectedLeft=!0}if((i.x=0,i.y=0,i.z=-1,r=t.getGraphNodeAt(n.x,n.y,n.z+.1*i.z,null,i,null,null,e))&&a-r.y<.5){n.x=s,n.y=a;c=1*Math.sqrt(z1.distanceSquared(n,r));r.addConnection(n,c),n.addConnection(r,c),o=this.sideNodesConnectedLeft=!0}return o},Swing.prototype.checkBeddingConnections=function(){this.checkCageConnections(M.z1044.z1047)},Swing.prototype.disableNodesUnder=function(t){if(this.cage){var e=ObjectPool.get("Array");e.length=0;var o=.6*this.width;this.cage.getGraphNodesAtToRef(e,this.position.x,this.position.y,this.position.z,!0,null,null,null,o,t);for(var i=.5*-this.width,n=.5*this.width,s=0;s<e.length;s++){var a=e[s],r=a.x-this.position.x,c=a.y-this.position.y,d=a.z-this.position.z;r<i||n<r||(c<-.1||.3<c||d<-.1||.1<d||(a.type=GraphNodeType.WALL,-1==this.wallNodesUnder.indexOf(a)&&this.wallNodesUnder.push(a)))}ObjectPool.recycle(e)}},Swing.prototype.checkCageConnections=function(t){if(void 0===t&&(t=M.z1044.z1048|M.z1044.z1047),this.cage){this.checkCageConnectorConnections();this.cage.position.y;this.position.y;var e=this.rightGraphNode,o=Swing.z4[0];o.x=1,o.y=0,o.z=0;var i=Swing.tempArray;i.length=0;if(this.cage.getGraphNodesAtToRef(i,e.x,e.y,e.z,null,o,0,0,1.2,t),0<i.length)for(var n=0;n<i.length;n++){var s=i[n],a=s.x-e.x;if(!(.5<Math.abs(a)))if(!(.5<e.y-s.y)){var r=1*Math.sqrt(z1.distanceSquared(e,s));s.addConnection(e,r),e.addConnection(s,r)}}else this.checkRightSideConnections(this.cage,t);e=this.leftGraphNode;if(o.x=-1,o.y=0,o.z=0,i.length=0,this.cage.getGraphNodesAtToRef(i,e.x,e.y,e.z,null,o,0,0,1.2,t),0<i.length)for(n=0;n<i.length;n++){var c=i[n];a=c.x-e.x;if(!(.5<Math.abs(a)))if(!(.5<e.y-c.y)){c.isConnectedTo(e);var d=1*Math.sqrt(z1.distanceSquared(e,c));c.addConnection(e,d),e.addConnection(c,d)}}else this.checkLeftSideConnections(this.cage,t);this.disableNodesUnder(M.z1044.z1048|M.z1044.z1047)}},Swing.prototype.checkPlatformConnections=function(){if(this.cage)for(var t=this.cage.objs,e=this.position,o=(e.x,this.width,e.x,this.width,0);o<t.length;o++){var i=t[o];if(!i.skipConnect&&i.accType==M.z1044.z1049){var n=i.position,s=e.y-n.y;.15<s||s<-.15||this.checkPlatformConnection(i)&&i.addObject(this)}}this.disableNodesUnder(M.z1044.z1048)},Swing.prototype.checkWheelConnection=function(){if(this.cage)for(var t=this.cage.objs,e=0;e<t.length;e++)if(t[e].accType==M.z1044.z1054){var o=t[e],i=o.position.y-this.position.y;if(.3<i||i<-.3)return;var n=this.rightGraphNode,s=this.leftGraphNode,a=o.nodes[1],r=Math.sqrt(z1.distanceSquared(a,n));a.addConnection(n,r),n.addConnection(a,r);r=Math.sqrt(z1.distanceSquared(a,s));a.addConnection(s,r),s.addConnection(a,r)}},Swing.prototype.checkSwingConnections=function(){if(this.cage)for(var t=this.cage.objs,e=0;e<t.length;e++)if(t[e].accType==M.z1044.SWING){var o=t[e];if(o!=this){var i=o.position.x-this.position.x,n=o.position.y-this.position.y;if(!(.5<Math.abs(n)||Math.abs(i)>this.width+.2)){var s=void 0,a=void 0;if(0<i?(s=o.leftGraphNode2,a=this.rightGraphNode2):(s=o.rightGraphNode2,a=this.leftGraphNode2),!s.isConnectedTo(a)){var r=Math.sqrt(z1.distanceSquared(s,a));s.addConnection(a,.1*r),a.addConnection(s,.1*r)}}}}},Swing.prototype.checkRampConnections=function(){if(this.cage)for(var t=this.cage.objs,e=0;e<t.length;e++)t[e].accType==M.z1044.z1046&&this.checkRampConnection(t[e])},Swing.prototype.checkRampConnection=function(t){if(!t.skipConnect&&!t.platformAbove){var e=t.position.x-this.position.x,o=t.position.y-this.position.y,i=this.rightGraphNode,n=this.leftGraphNode,s=t.lowCenterNode;o<-.5&&(s=t.highNode),0<e&&(n=i);var a=t.highNode.x-this.position.x;if(!(.3<t.highNode.y-this.position.y&&Math.abs(a)<.7)){var r=s.x-n.x,c=s.y-n.y,d=s.z-n.z;if(!(.55<c||c<-.55||.4<r||r<-.4)){if(s==t.lowCenterNode){s.x=t.position.x+.1,0<e&&(n=i,s.x=t.position.x-.1),n.y=t.position.y-.05;n.data.hitDist=.3,n.data.offsetY=.08}else n.y=this.position.y+.2;this.leftGraphNode,n.x>this.position.x?(n.x=this.position.x+.5*this.width+.1,n.z=this.position.z+.1):(n.x=this.position.x-.5*this.width-.1,n.z=this.position.z-.1);var p=Math.sqrt(r*r+c*c+d*d);s.addConnection(n,.01*p),n.addConnection(s,.01*p);var l=this.rightGraphNode2,u=Swing.z4[0];u.x=1,u.y=0,u.z=0,n.x<this.position.x&&(l=this.leftGraphNode2,u.x=-1);var y=Swing.tempArray,g=M.z1044.z1048|M.z1044.z1047|M.z1044.z1049;y.length=0;if(this.cage.getGraphNodesAtToRef(y,l.x,l.y,l.z,null,u,0,0,1.2,g),0<y.length)for(var m=0;m<y.length;m++){var f=y[m],A=f.x-l.x;if(!(.5<Math.abs(A))).5<l.y-f.y||(p=.5*Math.sqrt(z1.distanceSquared(n,f)),f.addConnection(n,p),n.addConnection(f,p))}return s}}}},Swing.prototype.checkPlatformConnection=function(t){if(t.skipConnect)return!1;if(.15<(p=this.position.y-t.position.y)||p<-.15)return!1;var e=0,o=this.nodes,i=Swing.z4[0],n=Swing.z4[1];i.y=0;for(var s=i.z=0;s<5;s+=4){var a=o[s];i.x=a.x-this.position.x,i.normalize();for(var r=0;r<t.nodes.length;r++){var c=t.nodes[r];if(c){var d=c.x-a.x,p=c.y-a.y,l=c.z-a.z,u=d*d+p*p+l*l;if(u<1.44)if(n.x=d,n.y=p,n.z=l,n.normalize(),0<BABYLON.Vector3.Dot(i,n)){var y=Math.sqrt(u);a.addConnection(c,y),c.addConnection(a,y),e++}}}}if(!e){var g=t.position.x+.5*t.width,m=t.position.x-.5*t.width;this.position.x<g&&this.checkRightSideConnections(t)&&e++,this.position.x>m&&this.checkLeftSideConnections(t)&&e++}return!!e&&(this.disableNodesUnder(M.z1044.z1049),!0)},Swing.prototype.addz1062=function(t){-1===this.hamsters.indexOf(t)&&this.hamsters.push(t)},Swing.prototype.removez1062=function(t){this.hamsters.remove(t)},Swing.getObjectsAt=function(t,e,o,i,n,s,a){var r,c=Swing.activeObjects;a&&(c=a);for(var d=c.length,p=t-.5*i,l=t+.5*i,u=e-.5*n,y=e+.5*n,g=0;g<d;g++){var m=(r=c[g]).position.x-.5*r.width,f=r.position.x+.5*r.width,A=r.position.y,b=r.position.y;f<=p||l<=m||y<=b||A<=u||s.push(r)}},Swing.tempVecs=[new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3],Swing.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],Swing.count=0,Swing.activeObjects=[],Swing.tempArray=[],Swing}(M.z1092);M.Swing=t}(z0||(z0={})),function(e){var t=function(){function SwingConfig(){this.maxObjects=4,this.objName="sw",e.Swing.objectCount=this.maxObjects}return SwingConfig.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,e.Swing,{shapeName:this.objName,world:t,width:1})},SwingConfig.prototype.getSceneFileNames=function(t){},SwingConfig.prototype.getCreateMeshFunctions=function(t){t.SwingMenuButton=this._createMeshes,t.swingButton=this._createMeshes,t.swingBottomButton=this._createMeshes},SwingConfig.prototype._createMeshes=function(t,e){var o=BABYLON.MeshBuilder.CreatePlane("SwingMenuButton",{width:1.7,height:1.4},t);t.removeMesh(o),o.position.y=.4,o.bakeCurrentTransformIntoVertices(),e.SwingMenuButton=o;var i=BABYLON.MeshBuilder.CreateDisc("SwingBottomButton",{tessellation:3,radius:.7},t);t.removeMesh(i),i.position.y+=.32,i.position.z-=.4,i.rotation.z=.165*-Math.PI,i.bakeCurrentTransformIntoVertices(),e.swingButton=i;i=BABYLON.MeshBuilder.CreatePlane("SwingButton",{height:.3,width:1.2},t);t.removeMesh(i),i.bakeCurrentTransformIntoVertices(),e.swingBottomButton=i},SwingConfig.prototype.getChildSPSData=function(t){t[this.objName]||(t[this.objName]={}),t[this.objName].SwingSide1=2},SwingConfig.prototype.getSPSData=function(t){t.push({shapeName:"SwingBottom1",meshName:"swing_bottom_1",numInstances:this.maxObjects,maxInstances:this.maxObjects}),t.push({shapeName:"SwingSide2",meshName:"swing_side_2",numInstances:this.maxObjects,maxInstances:this.maxObjects}),t.push({shapeName:"SwingBottom1",meshName:"swingBottomButton",numInstances:this.maxObjects,maxInstances:this.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName,meshName:"swingButton",numInstances:this.maxObjects,maxInstances:this.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:"SwingSide1",meshName:"swing_side_1",numInstances:2*this.maxObjects,maxInstances:2*this.maxObjects}),t.push({shapeName:"SwingBottom1",meshName:"swing_bottom_1",numInstances:1,maxInstances:1,renderingGroupID:e.App.menuRenderingGroupID}),t.push({shapeName:"SwingSide2",meshName:"swing_side_2",numInstances:1,maxInstances:1,renderingGroupID:e.App.menuRenderingGroupID}),t.push({shapeName:"SwingSide1",meshName:"swing_side_1",numInstances:2,maxInstances:2,renderingGroupID:e.App.menuRenderingGroupID}),t.push({shapeName:this.objName,meshName:"SwingMenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:e.App.menuRenderingGroupID})},SwingConfig.prototype.getz1064Items=function(t){t.push(new e.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Bridges",order:0,menuWidth:1.5,offsetY:-.4}))},SwingConfig.prototype.getz49s=function(t){t.push(e.z17)},SwingConfig.prototype.getListenerSetups=function(t){t.push({event:e.SwingEvents.USE,state:e.z17})},SwingConfig}();e.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(){function SwingEvents(){}return SwingEvents.USE=t.AppEvents.GetUniqueID(),SwingEvents}();t.SwingEvents=e}(z0||(z0={})),function(B){var t=function(e){function SwingHamBodyFixer(){var t=null!==e&&e.apply(this,arguments)||this;return t.localPosition=BABYLON.Vector3.Zero(),t.pivotRadius=0,t.BR_Pivot_Radius=.2,t.BR_Pivot_Area=.5*Math.PI,t._enabled=!0,t.updated=new z1072Set,t}return __extends(SwingHamBodyFixer,e),SwingHamBodyFixer.prototype.init=function(t){this.accessory=t.accessory;var e=this.accessory,o=e.shapeName+e.num;if(!this.triggerArea){this.world=e.world;var i=[.03,.01,1,B.App.PhysicsGroupTriggerArea,B.App.z1034],n=t.radius;this.pivotRadius=.5*e.depth,this.triggerArea=new OIMO.Body({type:"sphere",size:[n,n,n],pos:[0,0,0],rot:[0,0,0],move:!1,world:this.world,name:o+"_SwingBodyFixer",config:i}).body,this.triggerArea.shapes.pubsub=this.pubsub,this.triggerArea.shapes.disablePhysics=!0;this.localPosition.x=0,this.localPosition.y=0,this.localPosition.z=0,this.pubsub.subscribe("hit",this.onTrigger.bind(this))}},SwingHamBodyFixer.prototype.setPosition=function(t,e,o){this.accessory;var i=this.localPosition;this.triggerArea.position.x=t+i.x,this.triggerArea.position.y=e+i.y,this.triggerArea.position.z=o+i.z,this.triggerArea.syncShapes(),this.triggerAreaMesh&&(this.triggerAreaMesh.position.x=this.triggerArea.position.x,this.triggerAreaMesh.position.y=this.triggerArea.position.y,this.triggerAreaMesh.position.z=this.triggerArea.position.z,this.triggerAreaMesh.isPickable=!1)},SwingHamBodyFixer.prototype.enable=function(){this._enabled||(this.world.addRigidBody(this.triggerArea),this._enabled=!0)},SwingHamBodyFixer.prototype.disable=function(){this._enabled&&(this.triggerArea.position.y=9999,this.triggerArea.syncShapes(),this.world.removeRigidBody(this.triggerArea),this._enabled=!1)},SwingHamBodyFixer.prototype.onTrigger=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.accessory;(o=t[8].actor.rodent).physics.touchingAccTypes&B.z1044.SWING&&this.fixSwingThruHamBody(o),o.pathIndex,o.path;this.accessory;var o=t[8].actor.rodent;t[8].parent.name,t[7]},SwingHamBodyFixer.prototype.fixSwingThruHamBody=function(t){if(t.physics.touchingAccTypes&B.z1044.SWING){for(var e,o=t.physics.touchingShapes,i=0;i<o.length;i++){var n=o.getAtIndex(i);if(n.entity&&n.entity.accType==B.z1044.SWING&&this.accessory==n.entity){e=n.entity;break}}if(e){var s=e.bodyBottom,a=t.physics.rearBody.body,r=a.position,c=B.SwingNavigator.tempVecs[0];z1.getOIMOLocalPositionFromGlobalToRef(s,r,c);var d=t.physics.middleBody.body,p=d.position,l=B.SwingNavigator.tempVecs[1];z1.getOIMOLocalPositionFromGlobalToRef(s,p,l);var u=t.physics.frontBody.body,y=u.position,g=B.SwingNavigator.tempVecs[2];z1.getOIMOLocalPositionFromGlobalToRef(s,y,g);var m=t.physics.headBody.body,f=m.position,A=B.SwingNavigator.tempVecs[3];z1.getOIMOLocalPositionFromGlobalToRef(s,f,A);var b=.5*e.width,v=.5*e.depth,x=!1,C=!1,S=!1,T=!1;if(A.x>-b&&A.x<b&&A.z>-v&&A.z<v&&(x=!0),g.x>-b&&g.x<b&&g.z>-v&&g.z<v&&(C=!0),l.x>-b&&l.x<b&&l.z>-v&&l.z<v&&(S=!0),c.x>-b&&c.x<b&&c.z>-v&&c.z<v&&(T=!0),x&&C&&S&&T){if(A.y<0&&0<g.y&&0<l.y&&0<c.y)return A.y=m.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,A,f),m.shapes.position.copy(m.position),void m.syncShapes();if(c.y<0&&0<g.y&&0<l.y&&0<A.y)return c.y=a.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,c,r),a.shapes.position.copy(a.position),void a.syncShapes();if(c.y<0&&0<g.y&&0<l.y&&A.y<0)return c.y=a.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,c,r),a.shapes.position.copy(a.position),a.syncShapes(),A.y=m.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,A,f),m.shapes.position.copy(m.position),void m.syncShapes();if(0<A.y&&g.y<0&&l.y<0&&c.y<0)return A.y=-m.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,A,f),m.shapes.position.copy(m.position),void m.syncShapes();if(A.y<0&&g.y<0&&l.y<0&&0<c.y)return c.y=-a.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,c,r),a.shapes.position.copy(a.position),void a.syncShapes();if(0<A.y&&0<g.y&&l.y<0&&c.y<0)return l.y=d.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,l,p),d.shapes.position.copy(d.position),d.syncShapes(),c.y=a.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,c,r),a.shapes.position.copy(a.position),void a.syncShapes();if(0<A.y&&0<g.y&&l.y<0&&0<c.y)return l.y=d.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,l,p),d.shapes.position.copy(d.position),void d.syncShapes();if(0<A.y&&g.y<0&&l.y<0&&c.y<0)return g.y=u.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,g,y),u.shapes.position.copy(u.position),void u.syncShapes()}if(x&&C&&S)return A.y<0&&0<g.y&&0<l.y&&0<c.y?(A.y=m.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,A,f),m.shapes.position.copy(m.position),void m.syncShapes()):void 0;if(T&&C&&S&&T)return c.y<0&&0<g.y&&0<l.y&&0<A.y?(c.y=a.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,c,r),a.shapes.position.copy(a.position),void a.syncShapes()):void 0;x&&C&&(A.y<0&&0<g.y?(A.y=m.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,A,f),m.shapes.position.copy(m.position),m.syncShapes()):0<A.y&&g.y<0&&(A.y=-m.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,A,f),m.shapes.position.copy(m.position),m.syncShapes())),T&&S&&(c.y<0&&0<l.y?(c.y=a.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,c,r),a.shapes.position.copy(a.position),a.syncShapes()):0<c.y&&l.y),C&&S&&(g.y<0&&0<l.y||0<g.y&&l.y)}}},SwingHamBodyFixer}(B.z1091);B.SwingHamBodyFixer=t}(z0||(z0={})),function(I){var t=function(e){function SwingNavigator(){var t=null!==e&&e.apply(this,arguments)||this;return t.localPosition=BABYLON.Vector3.Zero(),t.pivotRadius=0,t.SW_Pivot_Area=.5*Math.PI,t.radius=0,t._enabled=!0,t.updated=new z1072Set,t}return __extends(SwingNavigator,e),SwingNavigator.prototype.init=function(t){this.accessory=t.accessory;var e=this.accessory,o=e.shapeName+e.num;if(!this.triggerArea){this.world=e.world;var i=[.03,.01,1,I.App.PhysicsGroupTriggerArea,I.App.z1034];this.radius=t.radius;var n=t.radius;this.pivotRadius=.5*e.depth,this.triggerArea=new OIMO.Body({type:"sphere",size:[n,n,n],pos:[0,0,0],rot:[0,0,0],move:!1,world:this.world,name:o+"_SwingBumper",config:i}).body,this.triggerArea.shapes.pubsub=this.pubsub,this.triggerArea.shapes.disablePhysics=!0;this.localPosition.x=0,this.localPosition.y=0,this.localPosition.z=0,this.pubsub.subscribe("hit",this.onTrigger.bind(this))}},SwingNavigator.prototype.setPosition=function(t,e,o){this.accessory;var i=this.localPosition;this.triggerArea.position.x=t+i.x,this.triggerArea.position.y=e+i.y,this.triggerArea.position.z=o+i.z,this.triggerArea.syncShapes(),this.triggerAreaMesh&&(this.triggerAreaMesh.position.x=this.triggerArea.position.x,this.triggerAreaMesh.position.y=this.triggerArea.position.y,this.triggerAreaMesh.position.z=this.triggerArea.position.z,this.triggerAreaMesh.isPickable=!1)},SwingNavigator.prototype.enable=function(){this._enabled||(this.world.addRigidBody(this.triggerArea),this._enabled=!0)},SwingNavigator.prototype.disable=function(){this._enabled&&(this.triggerArea.position.y=9999,this.triggerArea.syncShapes(),this.world.removeRigidBody(this.triggerArea),this._enabled=!1)},SwingNavigator.prototype.onTrigger=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=this.accessory,i=t[8].actor.rodent;o=this.accessory,i=t[8].actor.rodent,t[8].parent.name,t[7];if(this.updated.push(i,i.id,I.app.frameNum)&&i.usingObject!=this.accessory&&(i.targetObject==this.accessory&&i.targetObject,!i.isInState(I.z21.name)&&!(i.isInState(I.z90.name)||i.isInState(I.z113.name)||i.isInState(I.z126.name)||i.isInState(I.z141.name)))){var n=o.parent;if(n&&n==i.cage){var s=i.physics.frontBody.body.position,a=i.targets.pathTarget,r=SwingNavigator.z4[0];a||(a=i.targets.destTarget);var c=i.path[i.pathIndex],d=i.path[i.pathIndex+1];if(r.x=this.position.x,r.y=this.position.y,r.z=this.position.z,(null==c?void 0:c.data.obj2)!=o||d&&d.data.obj2!=o){if(o.getPointSideY(a)<0&&i.path[i.pathIndex]&&!i.path[i.pathIndex].data.enterEvent&&i.path[i.pathIndex+1]&&!i.path[i.pathIndex+1].data.enterEvent)return i.incrementPathIndex(),void i.pathIndex;s.x,this.position.x,s.y,this.position.y,s.z,this.position.z,s.x,r.x,s.y,r.y,s.z,r.z;var p=SwingNavigator.z4[1];p.x=a.x-r.x,p.y=0,p.z=a.z-r.z;var l=SwingNavigator.z4[2];l.x=a.x-s.x,l.y=0,l.z=a.z-s.z;var u=SwingNavigator.z4[3];u.x=r.x-s.x,u.y=0,u.z=r.z-s.z;l.lengthSquared();var y=u.lengthSquared();l.normalize(),u.normalize();var g=SwingNavigator.z4[4];u.scaleToRef(-1,g);var m=SwingNavigator.z4[5];if(c&&c.data.obj2==o&&(m.y=0,m.z=0,m.x=1,this.position.x<o.position.x&&(m.x=-1),.7<BABYLON.Vector3.Dot(g,m)))i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null);else if(BABYLON.Vector3.Dot(l,u)<0)i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null);else if(0<BABYLON.Vector3.Dot(g,p))i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null);else{i.pivotRadius=this.radius+.1,i.pivotRadiusMax=i.pivotRadius,i.pivotPoint.x=r.x,i.pivotPoint.y=r.y,i.pivotPoint.z=r.z;var f=SwingNavigator.z4[6];f.x=-l.z,f.z=l.x;var A=f.x+s.x,b=f.z+s.z,v=A-r.x,x=b-r.z,C=v*v+x*x,S=-f.x+s.x,T=-f.z+s.z,B=S-r.x,O=T-r.z,P=B*B+O*O;i.pivotMoveDir=P<C?1:-1,i.pivotUpdateLook=!0,i.pivotArea=1*Math.PI,i.pivotArea=this.SW_Pivot_Area,i.pivotAreaDir.x=l.x,i.pivotAreaDir.y=l.y,i.pivotAreaDir.z=l.z;var M=this.radius;i.pivotUpdateLook=y<M*M}}else i.currentz1091==this&&(i.pivotArea=0,i.currentz1091=null)}}},SwingNavigator}(I.z1091);I.SwingNavigator=t}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z753(){return null!==t&&t.apply(this,arguments)||this}return __extends(z753,t),z753.prototype.update=function(t){var e=t.usingObject;e&&e.accType==o.z1044.SWING&&e.addz1062(t)},z753}(z767),t.z753=e}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z723(){return null!==t&&t.apply(this,arguments)||this}return __extends(z723,t),z723.prototype.update=function(t){var e=t.usingObject;e&&e.accType==o.z1044.SWING&&(o.app.frameNum-e.lastMoveFrame<=1||(t.levels.attention.step(),e.isDraggingBottom&&t.levels.attention.resetRandom(.5,1)))},z723}(z767),t.z723=e}(z0||(z0={})),function(l){var t,e;t=l.z156||(l.z156={}),e=function(t){function z712(){return null!==t&&t.apply(this,arguments)||this}return __extends(z712,t),z712.prototype.update=function(t){var e=t.targets,o=e.pathTarget;t.path.length,t.pathIndex;var i=t.usingObject;if(i&&i.accType==l.z1044.SWING&&0<t.path2.length&&t.path2Index<t.path2.length){var n=t.physics.frontBody.body,s=e.pathNodeHitDist,a=s*s,r=n.position,c=t.path[t.pathIndex].x-r.x,d=t.path[t.pathIndex].y-r.y,p=t.path[t.pathIndex].z-r.z;c*c+d*d+p*p<a&&(t.path2Index+=3,t.pathIndex=Math.floor(t.path2Index/3)-1,t.pubsub.broadcast(l.z1061Events.NEW_PATH_NODE),t.path2Index>=t.path2.length&&t.targets.setTargetsToDestination()),t.path2Index<t.path2.length?o.copyFrom(t.path[t.pathIndex]):t.path2Index>=t.path2.length&&o.copyFrom(t.targets.destTarget)}},z712}(z767),t.z712=e}(z0||(z0={})),function(b){var t,e;t=b.z156||(b.z156={}),e=function(t){function z705(){return null!==t&&t.apply(this,arguments)||this}return __extends(z705,t),z705.prototype.update=function(t){if(t.avoidingOther=null,t.physics.collisionOtherFrac.targetValue=.5,!(t.pathIndex>=t.path.length)){var e=t.getClosestz1061(0);if(e&&t.usingObject&&t.usingObject.accType==b.z1044.SWING){var o=t.targets.targetDir,i=e.targets.targetDir,n=(BABYLON.Vector3.Dot(o,i),t.physics.middleBody.body.position),s=e.physics.middleBody.body.position,a=(m=n.x-s.x)*m+(f=n.y-s.y)*f+(A=n.z-s.z)*A,r=(n=t.physics.frontBody.body.position,s=e.physics.middleBody.body.position,(m=n.x-s.x)*m+(f=n.y-s.y)*f+(A=n.z-s.z)*A),c=(n=t.physics.rearBody.body.position,s=e.physics.middleBody.body.position,(m=n.x-s.x)*m+(f=n.y-s.y)*f+(A=n.z-s.z)*A),d=3*t.size,p=!1,l=!1,u=!1;if(r<d*d&&(p=!0),c<(d=3*t.size)*d&&(l=!0),a<(d=3*t.size)*d&&(u=!0),(p||l||u)&&(t.position.z>e.position.z&&(t.physics.collisionOtherFrac.targetValue=.4),t.avoidingOther=e),t.avoidingOther&&r<d){var y=e.physics.headBody.body.position,g=t.physics.headBody.body.position,m=g.x-y.x,f=g.y-y.y,A=g.z-y.z;g.z-y.z<0?t.targets.lookToTargetOffset.z=-t.size:t.targets.lookToTargetOffset.z=t.size}}}},z705}(z767),t.z705=e}(z0||(z0={})),function(d){var t,e;t=d.z156||(d.z156={}),e=function(e){function z633(){var t=null!==e&&e.apply(this,arguments)||this;return t.fixStuckSwingForce=.1,t}return __extends(z633,e),z633.prototype.update=function(t){var e=t.physics.touchingAccTypes&d.z1044.SWING;if(t.isStuck(120)&&e&&!t.isInState(d.z17.name)){var o=t.physics.getTouchingz1092ByType(d.z1044.SWING),i=t.physics.frontBody.body.position,n=o.bodyBottom.rotation.elements,s=i.x-o.position.x,a=o.bodyBottom.linearVelocity,r=-this.fixStuckSwingForce;0<s&&(r*=-1);var c=z767.tempVecs[0];z1.getOIMOLocalPositionFromGlobalToRef(o.bodyBottom,i,c),0<c.y&&(r*=-1),a.x+=n[0]*r,a.y+=n[3]*r,a.z+=n[6]*r}},z633}(z767),t.z633=e}(z0||(z0={})),function(B){var t,e;t=B.z156||(B.z156={}),e=function(t){function z632(){return null!==t&&t.apply(this,arguments)||this}return __extends(z632,t),z632.prototype.update=function(t){if(t.physics.touchingAccTypes&B.z1044.SWING){var e;e&&e.accType==B.z1044.SWING&&(e=t.usingObject);for(var o=t.physics.touchingShapes,i=0;i<o.length;i++){var n=o.getAtIndex(i);if(n.entity&&n.entity.accType==B.z1044.SWING){e=n.entity;break}}if(e){var s=e.bodyBottom,a=t.physics.rearBody.body,r=a.position,c=z767.tempVecs[0];z1.getOIMOLocalPositionFromGlobalToRef(s,r,c);var d=t.physics.middleBody.body,p=d.position,l=z767.tempVecs[1];z1.getOIMOLocalPositionFromGlobalToRef(s,p,l);var u=t.physics.frontBody.body,y=u.position,g=z767.tempVecs[2];z1.getOIMOLocalPositionFromGlobalToRef(s,y,g);var m=t.physics.headBody.body,f=m.position,A=z767.tempVecs[3];z1.getOIMOLocalPositionFromGlobalToRef(s,f,A);var b=.5*e.width,v=.5*e.depth,x=!1,C=!1,S=!1,T=!1;if(A.x>-b&&A.x<b&&A.z>-v&&A.z<v&&(x=!0),g.x>-b&&g.x<b&&g.z>-v&&g.z<v&&(C=!0),l.x>-b&&l.x<b&&l.z>-v&&l.z<v&&(S=!0),c.x>-b&&c.x<b&&c.z>-v&&c.z<v&&(T=!0),x&&C&&S&&T)return A.y<0&&0<g.y&&0<l.y&&0<c.y?(A.y=m.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,A,f),m.shapes.position.copy(m.position),void m.syncShapes()):c.y<0&&0<g.y&&0<l.y&&0<A.y?(c.y=a.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,c,r),a.shapes.position.copy(a.position),void a.syncShapes()):c.y<0&&0<g.y&&0<l.y&&A.y<0?(c.y=a.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,c,r),a.shapes.position.copy(a.position),a.syncShapes(),A.y=m.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,A,f),m.shapes.position.copy(m.position),void m.syncShapes()):0<A.y&&g.y<0&&l.y<0&&c.y<0?(A.y=-m.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,A,f),m.shapes.position.copy(m.position),void m.syncShapes()):A.y<0&&g.y<0&&l.y<0&&0<c.y?(c.y=-a.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,c,r),a.shapes.position.copy(a.position),void a.syncShapes()):void 0;if(x&&C&&S)return A.y<0&&0<g.y&&0<l.y&&0<c.y?(A.y=m.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,A,f),m.shapes.position.copy(m.position),void m.syncShapes()):void 0;if(T&&C&&S&&T)return c.y<0&&0<g.y&&0<l.y&&0<A.y?(c.y=a.shapes.radius,z1.getOIMOGlobalPositionFromLocalToRef(s,c,r),a.shapes.position.copy(a.position),void a.syncShapes()):void 0;x&&C&&(A.y<0&&0<g.y?this.fixSwingThruBodies(s,u,g,m,A):0<A.y&&g.y<0&&this.fixSwingThruBodies(s,m,A,u,g)),T&&S&&(c.y<0&&0<l.y?this.fixSwingThruBodies(s,d,l,a,c):0<c.y&&l.y<0&&this.fixSwingThruBodies(s,a,c,d,l)),C&&S&&(g.y<0&&0<l.y?this.fixSwingThruBodies(s,d,l,u,g):0<g.y&&l.y<0&&this.fixSwingThruBodies(s,u,g,d,l))}}},z632.prototype.fixSwingThruBodies=function(t,e,o,i,n){},z632}(z767),t.z632=e}(z0||(z0={})),function(d){var t,e;t=d.z156||(d.z156={}),e=function(t){function z620(){return null!==t&&t.apply(this,arguments)||this}return __extends(z620,t),z620.prototype.update=function(t){if(!t.isTouchingGround()){var e=t.usingObject;if(e&&e.accType==d.z1044.SWING){var o=t.physics.frontBody.body.position,i=t.path[t.pathIndex];if(i&&!(o.y>i.y)){var n=(i=o.x<e.position.x?e.leftGraphNode:e.rightGraphNode).x-o.x,s=i.y-o.y,a=i.z-o.z,r=n*n+a*a+s*s,c=.5*e.depth-.5*t.size;a<-c||c<a||r<.09&&t.forceTouchGround()}}}},z620}(z767),t.z620=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z602(){return null!==t&&t.apply(this,arguments)||this}return __extends(z602,t),z602.prototype.update=function(t){t.levels.swing.step(2)},z602}(z767),e.z602=o}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z580(){return null!==t&&t.apply(this,arguments)||this}return __extends(z580,t),z580.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==n.z1044.SWING&&!n.app.pointerMoveIsBelowBedding&&!n.app.pointerMoveIsBelowBedding&&t.canSeePointerMove()){var o=n.app.pointerMovePosition,i=t.targets.lookToTarget;i.x=o.x,i.y=o.y,i.z=o.z,t.targets.moveToTarget.x<e.position.x?i.x>t.position.x&&(i.x=t.position.x):i.x<t.position.x&&(i.x=t.position.x)}},z580}(z767),t.z580=e}(z0||(z0={})),function(s){var t,e;t=s.z156||(s.z156={}),e=function(n){function z571(){var t=null!==n&&n.apply(this,arguments)||this;return t.bodyIndex=2,t.speedFrac=1,t}return __extends(z571,n),z571.prototype.update=function(t){t.isTouchingGround();var e=t.usingObject;if(e&&e.accType==s.z1044.SWING){var o=t.physics.rearBody.body.position,i=z767.tempVecs[2];z1.getOIMOLocalPositionFromGlobalToRef(e.bodyBottom,o,i),i.y<0||i.x<.5*-e.width||i.x>.5*e.width||n.prototype.update.call(this,t)}},z571}(t.z561),t.z571=e}(z0||(z0={})),function(i){var t,e;t=i.z156||(i.z156={}),e=function(o){function z563(){var t=null!==o&&o.apply(this,arguments)||this;return t.bodyIndex=3,t.speedFrac=.5,t}return __extends(z563,o),z563.prototype.update=function(t){t.isTouchingGround();var e=t.usingObject;e&&e.accType==i.z1044.SWING&&o.prototype.update.call(this,t)},z563}(t.z561),t.z563=e}(z0||(z0={})),function(u){var t,e;t=u.z156||(u.z156={}),e=function(e){function z556(){var t=e.call(this)||this;return t.mult=2,t.frac=0,t.maxVel=0,t.swingVelFrac=.5,t.doRotate=!0,t.moveMethod2=!0,t}return __extends(z556,e),z556.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==u.z1044.SWING){if(this.moveMethod2){var o=t.size+.06,i=z767.tempVecs[0];if(z1.getOIMOLocalPositionFromGlobalToRef(e.bodyBottom,t.physics.rearBody.body.position,i),i.y>o&&(z1.getOIMOLocalPositionFromGlobalToRef(e.bodyBottom,t.physics.middleBody.body.position,i),i.y>o&&(z1.getOIMOLocalPositionFromGlobalToRef(e.bodyBottom,t.physics.frontBody.body.position,i),i.y>o)))return;this.moveBodyPart(t.physics.headBody,e,!0),this.moveBodyPart(t.physics.frontBody,e,!0,this.rayViewer),this.moveBodyPart(t.physics.middleBody,e,!0),this.moveBodyPart(t.physics.rearBody,e,!0)}else{var n=e.position.x,s=e.position.y+e.armY,a=z767.z4[0],r=z767.z4[1];a.x=t.position.x-n,a.y=t.position.y-s,a.z=0,BABYLON.Vector3.TransformCoordinatesToRef(a,e.rotMatDelta,r);var c=r.x-a.x,d=r.y-a.y,p=r.z-a.z;t.physics.headBody.translate(c,d,p),t.physics.frontBody.translate(c,d,p),t.physics.middleBody.translate(c,d,p),t.physics.rearBody.translate(c,d,p)}if(t.position.x=t.physics.middleBody.body.position.x,t.position.y=t.physics.middleBody.body.position.y,t.position.z=t.physics.middleBody.body.position.z,this.doRotate){var l=z767.tempBabQuats[0];BABYLON.Quaternion.FromRotationMatrixToRef(e.rotMatDelta,l),t.physics.frontBody.rotateWithQuaternion(l),t.physics.middleBody.rotateWithQuaternion(l),t.physics.rearBody.rotateWithQuaternion(l)}e.bodyBottom.linearVelocity,e.bodyBottom.rotation.elements,e.bodyBottom.position.x,e.position.x}},z556.prototype.moveBodyPart=function(t,e,o,i){void 0===o&&(o=!1);var n=e.position.x,s=e.position.y+e.armY,a=z767.z4[0],r=z767.z4[1];a.x=t.body.position.x-n,a.y=t.body.position.y-s,a.z=0,BABYLON.Vector3.TransformCoordinatesToRef(a,e.rotMatDelta,r);var c=r.x-a.x,d=r.y-a.y,p=r.z-a.z;if(i){var l=z767.z4[0],u=z767.z4[1];l.x=t.body.position.x,l.y=t.body.position.y,l.z=t.body.position.z,u.x=c,u.y=d,u.z=p,u.normalize(),i.update(l,u)}o&&(t.body.linearVelocity.x+=c*this.mult,t.body.linearVelocity.y+=d*this.mult,t.body.linearVelocity.z+=p*this.mult);var y=e.bodyBottom.linearVelocity.x,g=e.bodyBottom.linearVelocity.y,m=e.bodyBottom.linearVelocity.z;y*y+g*g+m*m>this.maxVel*this.maxVel&&(m=g=y=0);var f=t.body.linearVelocity;if(f.x*f.x+f.y*f.y+f.z*f.z<1){var A=e.bodyBottom.linearVelocity,b=z767.tempVecs[0],v=e.bodyBottom.rotation.elements;0<A.x?(b.x=v[0],b.y=v[3],b.z=v[6]):(b.x=-v[0],b.y=-v[3],b.z=-v[6]);var x=b.x-f.x,C=b.y-f.y,S=b.z-f.z;f.x+=x*this.frac,f.y+=C*this.frac,f.z+=S*this.frac}t.translate(c,d,p)},z556}(z767),t.z556=e}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z512(){return null!==t&&t.apply(this,arguments)||this}return __extends(z512,t),z512.prototype.update=function(t){var e=t.usingObject;e&&e.accType==o.z1044.SWING&&e.removez1062(t)},z512}(z767),t.z512=e}(z0||(z0={})),function(c){var t,e;t=c.z156||(c.z156={}),e=function(t){function z454(){return null!==t&&t.apply(this,arguments)||this}return __extends(z454,t),z454.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==c.z1044.SWING&&t.standing){var o=z767.tempVecs[0];o.x=e.bodyBottom.rotation.elements[1],o.y=e.bodyBottom.rotation.elements[4],o.z=e.bodyBottom.rotation.elements[7];var i=t.physics.rearBody.body.rotation.elements,n=i[2],s=i[8],a=-Math.atan2(n,s)/(.5*Math.PI),r=Math.atan2(o.x,o.y);t.bones.hip.pitch.targetValue=Math.min(r*a,0)}},z454}(z767),t.z454=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z411(){var t=null!==e&&e.apply(this,arguments)||this;return t.footOffsetXFront=-.13,t.footOffsetYFront=.1,t.footOffsetZFront=-.04,t.footOffsetXRear=-.2,t.footOffsetYRear=.1,t.footOffsetZRear=-.13,t.feetOnRampFrac=.5,t}return __extends(z411,e),z411.prototype.update=function(t){var e=t.physics.frontBody.rotationElements,o=z767.tempVecs[0];o.x=e[2],o.y=e[5],o.z=e[8];e=t.physics.rearBody.rotationElements;var i=z767.tempVecs[1];i.x=e[2],i.y=e[5],i.z=e[8];e=t.physics.middleBody.rotationElements;var n=z767.tempVecs[2];n.x=e[2],n.y=e[5],n.z=e[8];var s=o.y*n.y*i.y;s=1.5*n.y,(s=.8)<0&&(s*=-.25),s*=s;.85<(s=this.feetOnRampFrac)&&(s=.85);var a=t.bones.legFL.offsetBone1Pos;a.x=this.footOffsetXFront*s,a.y=this.footOffsetYFront*s,a.z=this.footOffsetZFront*s,(a=t.bones.legFR.offsetBone1Pos).x=this.footOffsetXFront*s,a.y=this.footOffsetYFront*s,a.z=-this.footOffsetZFront*s,a=t.bones.legRL.offsetBone1Pos,t.bones.legRL.footOffsetX_.targetValue=this.footOffsetXRear*s,t.bones.legRL.footOffsetZ_.targetValue=this.footOffsetZRear*s,a=t.bones.legRR.offsetBone1Pos,t.bones.legRR.footOffsetX_.targetValue=this.footOffsetXRear*s,t.bones.legRR.footOffsetZ_.targetValue=-this.footOffsetZRear*s},z411}(z767),e.z411=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z366(){var t=null!==e&&e.apply(this,arguments)||this;return t.maxStrength=70,t.uprightAng=2.5,t}return __extends(z366,e),z366.prototype.update=function(t){t.focusDist,e.prototype.update.call(this,t)},z366}(e.z369),e.z366=o}(z0||(z0={})),function(s){var t,e;t=s.z156||(s.z156={}),e=function(t){function z336(){return null!==t&&t.apply(this,arguments)||this}return __extends(z336,t),z336.prototype.update=function(t){var e=t.targets.pathTarget,o=t.usingObject;if(o&&o.accType==s.z1044.SWING&&t.path[t.pathIndex]){var i=t.path[t.pathIndex+1];if(i){var n=i.data.obj2||i.data.obj;if((n.accType==s.z1044.z1051||n.accType==s.z1044.z1052)&&n.position.y<o.position.y)return}t.path[t.pathIndex].data.obj!=o&&e.y<o.leftGraphNode.y&&(e.y=o.leftGraphNode.y,t.targets.setTargetsToPathTarget())}},z336}(z767),t.z336=e}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z329(){return null!==t&&t.apply(this,arguments)||this}return __extends(z329,t),z329.prototype.update=function(t){var e=t.usingObject;e&&e.accType==o.z1044.SWING&&(t.targets.moveToTarget.x=e.position.x,t.targets.moveToTarget.y=e.position.y+e.radius+1.5*t.size,t.targets.moveToTarget.z=e.position.z)},z329}(z767),t.z329=e}(z0||(z0={})),function(s){var t,e;t=s.z156||(s.z156={}),e=function(t){function z322(){return null!==t&&t.apply(this,arguments)||this}return __extends(z322,t),z322.prototype.update=function(t){var e,o,i,n=t.usingObject;if(n&&n.accType==s.z1044.SWING){s.SwingEvents.USE;(null===(e=t.path[t.pathIndex])||void 0===e?void 0:e.data.enterEvent)==s.SwingEvents.USE&&t.incrementPathIndex(),(null===(o=t.path[t.pathIndex])||void 0===o?void 0:o.data.enterEvent)==s.SwingEvents.USE&&t.incrementPathIndex(),(null===(i=t.path[t.pathIndex])||void 0===i?void 0:i.data.enterEvent)==s.SwingEvents.USE&&t.incrementPathIndex(),t.path[t.pathIndex]||(t.path[t.pathIndex]=n.centerGraphNode),t.path[t.pathIndex]!=n.centerGraphNode&&t.path[t.pathIndex],t.pathIndex!=t.path.length-1&&t.pathIndex}},z322}(z767),t.z322=e}(z0||(z0={})),function(i){var t,e;t=i.z156||(i.z156={}),e=function(e){function z302(){var t=null!==e&&e.apply(this,arguments)||this;return t.offsetXMoveBody=.1,t.offsetYMoveBody=0,t}return __extends(z302,e),z302.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==i.z1044.SWING){var o=z767.tempVecs[0];o.x=-t.size+this.offsetXMoveBody,o.y=this.offsetYMoveBody,o.z=0,t.targets.moveToTarget.x<t.position.x&&(o.x*=-1),z1.getOIMOGlobalPositionFromLocalToRef(e.bodyBottom,o,t.physics.rearBody.target)}},z302}(z767),t.z302=e}(z0||(z0={})),function(a){var t,e;t=a.z156||(a.z156={}),e=function(t){function z297(){return t.call(this)||this}return __extends(z297,t),z297.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==a.z1044.SWING){var o=e.bodyBottom.rotation.elements,i=(t.physics.rearBody.body.position,t.physics.rearBody.target),n=1*t.size,s=e.bodyBottom.position;e.isDraggingBottom,i.x=s.x+o[1]*n,i.y=s.y+o[4]*n,i.z=s.z+o[7]*n}},z297}(z767),t.z297=e}(z0||(z0={})),function(a){var t,e;t=a.z156||(a.z156={}),e=function(t){function z291(){return null!==t&&t.apply(this,arguments)||this}return __extends(z291,t),z291.prototype.update=function(t){var e=t.physics.rearBody,o=e.body.position;if(e.target.copyFrom(o),t.cage){var i=t.usingObject;if(i&&i.accType==a.z1044.SWING){var n=t.physics.rearBody.target,s=i.position;n.x=s.x,n.y=s.y+i.radius+t.size}}},z291}(z767),t.z291=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z535(){var t=null!==e&&e.apply(this,arguments)||this;return t.tailX=0,t.tailY=0,t.tailZ=0,t}return __extends(z535,e),z535.prototype.update=function(t){t.bones.tail.offsetZ.targetValue=-.1},z535}(z767),e.z535=o}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z271(){return null!==t&&t.apply(this,arguments)||this}return __extends(z271,t),z271.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==n.z1044.SWING){var o=t.targets.targetDir,i=e.bodyBottom.rotation.elements;o.x=i[0],o.y=i[3],o.z=i[6],t.targets.moveToTarget.x<t.position.x&&(o.x*=-1,o.y*=-1,o.z*=-1)}},z271}(z767),t.z271=e}(z0||(z0={})),function(C){var t,e;t=C.z156||(C.z156={}),e=function(t){function z246(){return null!==t&&t.apply(this,arguments)||this}return __extends(z246,t),z246.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==C.z1044.SWING){var o=t.physics.frontBody.body.position,i=z767.tempVecs[0],n=z767.tempVecs[1];i.y=0,i.z=0;var s=.1,a=o.z-e.position.z;(.3<a||a<-.3)&&(s=-.05),o.x>e.position.x?i.x=.5*e.width-s:i.x=.5*-e.width+s,z1.getOIMOGlobalPositionFromLocalToRef(e.bodyBottom,i,n),n.y+=t.size,t.targets.lookToTarget.copyFrom(n),t.targets.moveToTarget.copyFrom(n),t.targets.moveToTarget.y+=t.size,t.targets.standToTarget.copyFrom(t.targets.moveToTarget);var r=t.physics.headBody.body.position,c=z767.tempVecs[2],d=z767.tempVecs[3];z1.getOIMOLocalPositionFromGlobalToRef(e.bodyBottom,r,c),z1.getOIMOLocalPositionFromGlobalToRef(e.bodyBottom,o,d);var p=.5*e.width,l=.5*e.depth;0<c.y&&c.x>-p&&c.x<p&&d.z>-l&&d.z<l?(t.targets.lookToTarget.copyFrom(e.bodyBottom.position),t.targets.lookToTarget.y+=t.size,t.targets.moveToTarget.copyFrom(e.bodyBottom.position),t.targets.moveToTarget.y+=t.size,t.targets.standToTarget.copyFrom(t.targets.moveToTarget)):c.x;var u=.5*e.width;if(0<d.y&&d.x>-u&&d.x<u&&d.z>-l&&d.z<l?(t.targets.moveToTarget.copyFrom(e.bodyBottom.position),t.targets.moveToTarget.y+=t.size,t.targets.standToTarget.copyFrom(t.targets.moveToTarget)):d.y,t.physics.touchingAccTypes&C.z1044.z1046){var y=t.physics.getTouchingz1092ByType(C.z1044.z1046);if(y.lowNode){var g=y.getPointSideY(o);if(g<0){var m=t.targets.moveToTarget,f=t.targets.lookToTarget,A=t.targets.standToTarget,b=e.position,v=y.lowNode.x-b.x,x=o.x-b.x;v<0&&x<0?(m.z+=.2,f.z+=.2,A.z+=.2):0<v&&0<x&&(m.z-=.2,f.z-=.2,A.z-=.2)}}}}},z246}(z767),t.z246=e}(z0||(z0={})),function(c){var t,e;t=c.z156||(c.z156={}),e=function(e){function z242(){var t=null!==e&&e.apply(this,arguments)||this;return t.offsetYMoveBody=.005,t}return __extends(z242,e),z242.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==c.z1044.SWING){var o=t.physics.rearBody.body.position,i=t.physics.frontBody.body.position,n=z767.tempVecs[0],s=z767.tempVecs[1],a=z767.tempVecs[2];if(z1.getOIMOLocalPositionFromGlobalToRef(e.bodyBottom,o,a),z1.getOIMOLocalPositionFromGlobalToRef(e.bodyBottom,i,s),s.x>a.x?n.x=2.5*t.size:n.x=2.5*-t.size,n.y=t.size+e.bodyBottom.shapes.halfHeight,n.z=0,z1.getOIMOGlobalPositionFromLocalToRef(e.bodyBottom,n,t.targets.moveToTarget),t.targets.lookToTarget.copyFrom(t.targets.moveToTarget),t.targets.standToTarget.copyFrom(t.targets.moveToTarget),t.targets.targetNum1<c.app.frameNum){t.targets.lookToTargetOffset2.x=0,t.targets.lookToTargetOffset2.y=z1.GetRandomNum(-.05,.05),t.targets.lookToTargetOffset2.z=z1.GetRandomNum(-.1,.1),t.targets.targetNum1=c.app.frameNum+z1.GetRandomNum(100,300)}var r=z767.z4[0];z1.getOIMOTranformCoordinatesToRef(e.bodyBottom,t.targets.lookToTargetOffset2,r),t.targets.lookToTarget.addInPlace(r),s.x>a.x?n.x=1*-t.size:n.x=1*t.size,n.y=t.size+e.bodyBottom.shapes.halfHeight+this.offsetYMoveBody,n.z=0,z1.getOIMOGlobalPositionFromLocalToRef(e.bodyBottom,n,t.physics.rearBody.target),n.x=0,n.y=t.size+e.bodyBottom.shapes.halfHeight+this.offsetYMoveBody,n.z=0,z1.getOIMOGlobalPositionFromLocalToRef(e.bodyBottom,n,t.physics.middleBody.target)}},z242}(z767),t.z242=e}(z0||(z0={})),function(i){var t,e;t=i.z156||(i.z156={}),e=function(t){function z225(){return null!==t&&t.apply(this,arguments)||this}return __extends(z225,t),z225.prototype.update=function(t){var e=t.usingObject;if(e&&e.accType==i.z1044.SWING){var o=e.bodyBottom.rotation.elements;t.targets.upVecTarget.x=o[1],t.targets.upVecTarget.y=o[4],t.targets.upVecTarget.z=o[7]}},z225}(z767),t.z225=e}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z217(){return null!==t&&t.apply(this,arguments)||this}return __extends(z217,t),z217.prototype.update=function(t){if((!t.usingObject||t.usingObject.accType!=n.z1044.SWING)&&t.physics.touchingAccTypes&n.z1044.SWING){for(var e,o=0;o<t.physics.touchingShapes.length;o++){var i=t.physics.touchingShapes.data.data[o];i.entity&&i.entity.accType==n.z1044.SWING&&(e=i.entity,0)}e&&(t.usingObject=e)}},z217}(z767),t.z217=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z201(){return null!==t&&t.apply(this,arguments)||this}return __extends(z201,t),z201.prototype.update=function(t){t.levels.swing.resetRandom()},z201}(z767),e.z201=o}(z0||(z0={})),function(i){var t,e;t=i.z156||(i.z156={}),e=function(o){function z187(){var t=null!==o&&o.apply(this,arguments)||this;return t.accType=i.z1044.SWING,t}return __extends(z187,o),z187.prototype.update=function(t){o.prototype.update.call(this,t);var e=t.targetObject;e&&(e.accType,i.z1044.SWING)},z187}(t.z200),t.z187=e}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z992(){return null!==t&&t.apply(this,arguments)||this}return __extends(z992,t),z992.prototype.test=function(t){var e=t.memory.getAccessories(o.z1044.SWING);return!(!e||0==e.length)},z992}(z770),t.z992=e}(z0||(z0={})),function(d){var t,e;t=d.z768||(d.z768={}),e=function(t){function z934(){return t.call(this)||this}return __extends(z934,t),z934.prototype.test=function(t){var e=t.usingObject;if(!(e&&e.accType==d.z1044.SWING||(e=t.targetObject)&&e.accType==d.z1044.SWING))return!1;if(t.cage!=e.cage)return!1;var o=e.position,i=t.physics.frontBody.body.position,n=o.x-i.x,s=o.y-i.y,a=o.z-i.z,r=n*n+s*s+a*a,c=.5*e.width+3*t.size;return r<c*c},z934}(z770),t.z934=e}(z0||(z0={})),function(a){var t,e;t=a.z768||(a.z768={}),e=function(t){function z926(){return null!==t&&t.apply(this,arguments)||this}return __extends(z926,t),z926.prototype.test=function(t){var e=t.usingObject;if(!e||e.accType!=a.z1044.SWING)return!1;var o=t.physics.middleBody.body.position,i=z770.tempVecs[0];z1.getOIMOLocalPositionFromGlobalToRef(e.bodyBottom,o,i);var n=1.5*t.size,s=i.x;return 0<i.y&&-n<s&&s<n},z926}(z770),t.z926=e}(z0||(z0={})),function(a){var t,e;t=a.z768||(a.z768={}),e=function(t){function z897(){return null!==t&&t.apply(this,arguments)||this}return __extends(z897,t),z897.prototype.test=function(t){var e=t.usingObject;if(!e||e.accType!=a.z1044.SWING)return!0;var o=t.physics.middleBody.body.position,i=z770.tempVecs[0];z1.getOIMOLocalPositionFromGlobalToRef(e.bodyBottom,o,i);var n=.5*e.width+1.5*t.size,s=i.x;return!(0<i.y&&-n<s&&s<n)},z897}(z770),t.z897=e}(z0||(z0={})),function(s){var t,e;t=s.z768||(s.z768={}),e=function(t){function z892(){return null!==t&&t.apply(this,arguments)||this}return __extends(z892,t),z892.prototype.test=function(t){var e=t.usingObject;if(!e||e.accType!=s.z1044.SWING)return!1;var o=t.physics.middleBody.body.position,i=e.radius+0*t.size,n=z770.tempVecs[0];return z1.getOIMOLocalPositionFromGlobalToRef(e.bodyBottom,o,n),!(n.y<0)&&(n.x>-i&&n.x<i&&n.z>.5*-e.depth&&n.z<.5*e.depth)},z892}(z770),t.z892=e}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z891(){return null!==t&&t.apply(this,arguments)||this}return __extends(z891,t),z891.prototype.test=function(t){var e=t.usingObject;return!(!e||e.accType!=o.z1044.SWING)&&(!(1<e.hamsters.length)&&(e.hamsters.getAtIndex(0)==t||void 0))},z891}(z770),t.z891=e}(z0||(z0={})),function(n){var t,e;t=n.z768||(n.z768={}),e=function(t){function z878(){return null!==t&&t.apply(this,arguments)||this}return __extends(z878,t),z878.prototype.test=function(t){var e=t.path[t.pathIndex];if(e){var o=e.data.obj2;if(o&&o.accType==n.z1044.SWING){var i=e.z-o.position.z;if(i<.5*o.depth&&i>.5*-o.depth)return!0}}return!1},z878}(z770),t.z878=e}(z0||(z0={})),function(i){var t,e;t=i.z768||(i.z768={}),e=function(t){function z877(){return null!==t&&t.apply(this,arguments)||this}return __extends(z877,t),z877.prototype.test=function(t){var e=t.path[t.pathIndex];if(e){var o=e.data.obj2;if(o&&o.accType==i.z1044.SWING)return!0}return!1},z877}(z770),t.z877=e}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z867(){return null!==t&&t.apply(this,arguments)||this}return __extends(z867,t),z867.prototype.test=function(t){var e=t.usingObject;return!!(e&&e.accType==o.z1044.SWING||(e=t.targetObject)&&e.accType==o.z1044.SWING)&&!(3<e.hamsters.length)},z867}(z770),t.z867=e}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z858(){return null!==t&&t.apply(this,arguments)||this}return __extends(z858,t),z858.prototype.test=function(t){var e=t.usingObject;return!(!e||e.accType!=o.z1044.SWING)&&!!e.isDraggingBottom},z858}(z770),t.z858=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z857(){return null!==t&&t.apply(this,arguments)||this}return __extends(z857,t),z857.prototype.test=function(t){return t.levels.swing.value<=0},z857}(z770),e.z857=o}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z856(){return null!==t&&t.apply(this,arguments)||this}return __extends(z856,t),z856.prototype.test=function(t){var e=t.usingObject;return!(!e||e.accType!=o.z1044.SWING)&&(!(1<o.app.frameNum-e.lastMoveFrame)&&.1<e.lastMoveVelSq)},z856}(z770),t.z856=e}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z855(){return null!==t&&t.apply(this,arguments)||this}return __extends(z855,t),z855.prototype.test=function(t){var e=t.usingObject;return!(!e||e.accType!=o.z1044.SWING)&&20<o.app.frameNum-e.lastMoveFrame},z855}(z770),t.z855=e}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z835(){return null!==t&&t.apply(this,arguments)||this}return __extends(z835,t),z835.prototype.test=function(t){return!(!t.usingObject||t.usingObject.accType!=e.z1044.SWING)},z835}(z770),t.z835=o}(z0||(z0={})),function(n){var t,e;t=n.z768||(n.z768={}),e=function(t){function z807(){return null!==t&&t.apply(this,arguments)||this}return __extends(z807,t),z807.prototype.test=function(t){var e=t.usingObject;if(!e||e.accType!=n.z1044.SWING)return!0;var o=t.platformAbove;if(o&&(o.position.y<e.position.y+.1&&t.physics.getTouchingz1092ByType(n.z1044.SWING)!=e))return!0;var i=t.path[t.pathIndex];return!i||(!i.data.obj2||(i.data.obj2.accType!=n.z1044.SWING||(!e.isOnScene||void 0)))},z807}(z770),t.z807=e}(z0||(z0={})),function(i){var t,e;t=i.z768||(i.z768={}),e=function(t){function z799(){return null!==t&&t.apply(this,arguments)||this}return __extends(z799,t),z799.prototype.test=function(t){var e=t.usingObject;if(!e||e.accType!=i.z1044.SWING)return!0;var o=t.path[t.pathIndex];return o?!o.data.obj2||o.data.obj2.accType!=i.z1044.SWING:!(0<e.getPointSideY(t.targets.moveToTarget))},z799}(z770),t.z799=e}(z0||(z0={})),function(n){var t,e;t=n.z768||(n.z768={}),e=function(t){function z797(){return null!==t&&t.apply(this,arguments)||this}return __extends(z797,t),z797.prototype.test=function(t){var e=t.path[t.pathIndex],o=t.path[t.pathIndex+1];if(!e)return!1;if(!o)return!1;if(e.data.obj2&&e.data.obj2.accType==n.z1044.SWING&&o.data.obj2&&e.data.obj2.accType==n.z1044.SWING){var i=o.data.obj2;if(e.data.enterEvent==n.SwingEvents.USE&&e.data.enterNextNode==o){if(e.z>i.position.z&&o.z>i.position.z&&o.z<e.z)return!0;if(e.z<i.position.z&&o.z<i.position.z&&o.z>e.z)return!0}}return!1},z797}(z770),t.z797=e}(z0||(z0={})),function(n){var t,e;t=n.z768||(n.z768={}),e=function(t){function z795(){return null!==t&&t.apply(this,arguments)||this}return __extends(z795,t),z795.prototype.test=function(t){var e=t.path[t.pathIndex],o=t.path[t.pathIndex+1];if(!e)return!1;if(!o)return!1;if(e.data.obj2&&e.data.obj2.accType==n.z1044.SWING&&o.data.obj2&&e.data.obj2.accType==n.z1044.SWING){var i=o.data.obj2;if(e.data.enterEvent==n.SwingEvents.USE&&e.data.enterNextNode==o){if(e.z>i.position.z&&o.z>i.position.z&&o.z>e.z)return!0;if(e.z<i.position.z&&o.z<i.position.z&&o.z<e.z)return!0}}return!1},z795}(z770),t.z795=e}(z0||(z0={})),function(i){var t,e;t=i.z768||(i.z768={}),e=function(t){function z793(){return null!==t&&t.apply(this,arguments)||this}return __extends(z793,t),z793.prototype.test=function(t){var e=t.path[t.pathIndex];if(e&&e.data.enterNextNode&&t.path[t.pathIndex+1]===e.data.enterNextNode){var o=t.path[t.pathIndex+1].data.obj2;if(o&&o.accType==i.z1044.SWING)return!0}},z793}(z770),t.z793=e}(z0||(z0={})),function(o){var t=function(e){function z75(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[],t.updatez156=[o.z156.z580],t.exitz156=[],t.transitions=[{condition:o.z768.z819,trueNode:{state:o.z73}},{condition:o.z768.z1028,falseNode:{state:o.z73}}],t}return __extends(z75,e),z75}(z49);o.z75=t}(z0||(z0={})),function(o){var t=function(e){function z73(){var t=null!==e&&e.apply(this,arguments)||this;return t.historyLength=3,t.enterz156=[],t.updatez156=[],t.exitz156=[],t.transitions=[{condition:o.z768.z819,falseNode:{condition:o.z768.z1028,trueNode:{state:o.z75}}}],t.states=[o.z74,o.z116],t.initialState=o.z74,t}return __extends(z73,e),z73}(z49);o.z73=t}(z0||(z0={})),function(o){var t=function(e){function z119(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z726],t.updatez156=[o.z156.z602,o.z156.z507,o.z156.z723],t.states=[o.z97,o.z42],t.transitions=[{condition:o.z768.z934,trueNode:{condition:o.z768.z867,falseNode:{state:o.z112,actions:[o.z156.z201,o.z156.z512]}}},{condition:o.z768.z897,trueNode:{state:o.z112}},{condition:o.z768.z982,falseNode:{condition:o.z768.z985,falseNode:{state:o.z112}}},{condition:o.z768.z976,trueNode:{state:o.z112}}],t.exitz156=[o.z156.z502],t.initialState=o.z97,t}return __extends(z119,e),z119}(z49);o.z119=t}(z0||(z0={})),function(o){var t=function(e){function z97(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z476,o.z156.z503],t.updatez156=[o.z156.z411,o.z156.z479,o.z156.z242,o.z156.z571],t.transitions=[{condition:o.z768.z891,trueNode:{condition:o.z768.z858,falseNode:{condition:o.z768.z855,trueNode:{condition:o.z768.z926,trueNode:{state:o.z42}}}}}],t.exitz156=[o.z156.z502],t.states=[],t}return __extends(z97,e),z97}(z49);o.z97=t}(z0||(z0={})),function(o){var t=function(e){function z42(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z255,o.z156.z400,o.z156.z483,o.z156.z272,o.z156.z382,o.z156.z501,o.z156.z726],t.updatez156=[o.z156.z535,o.z156.z382,o.z156.z495,o.z156.z483,o.z156.z271,o.z156.z536,o.z156.z542,o.z156.z386,o.z156.z393,o.z156.z209,o.z156.z327,o.z156.z265,o.z156.z302,o.z156.z563],t.states=[o.z75,o.z73],t.transitions=[{condition:o.z768.z856,trueNode:{state:o.z97}},{condition:o.z768.z858,trueNode:{state:o.z97}}],t.exitz156=[o.z156.z502],t.initialState=o.z73,t}return __extends(z42,e),z42}(z49);o.z42=t}(z0||(z0={})),function(o){var t=function(e){function z32(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z726],t.updatez156=[o.z156.z187],t.exitz156=[],t.transitions=[{condition:o.z768.z982,falseNode:{condition:o.z768.z986,falseNode:{state:o.z112}}},{condition:o.z768.z934,trueNode:{condition:o.z768.z867,falseNode:{state:o.z112,actions:[o.z156.z201]}}},{condition:o.z768.z892,trueNode:{state:o.z119}},{condition:o.z768.z882,trueNode:{condition:o.z768.z880,falseNode:{state:o.z34,actions:[o.z156.z483,o.z156.z470]}}}],t}return __extends(z32,e),z32}(z49);o.z32=t}(z0||(z0={})),function(o){var t=function(e){function z113(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.enterz156=[o.z156.z220,o.z156.z406,o.z156.z322],t.updatez156=[o.z156.z246,o.z156.z616,o.z156.z599,o.z156.z209,o.z156.z461,o.z156.z446,o.z156.z590,o.z156.z214,o.z156.z366],t.exitz156=[],t.states=[],t.transitions=[{condition:o.z768.z807,trueNode:{state:o.z108,level:1}},{condition:o.z768.z873,trueNode:{state:o.z65,level:1}},{condition:o.z768.z892,trueNode:{state:o.z13,actions:[]}}],t}return __extends(z113,e),z113}(z49);o.z113=t}(z0||(z0={})),function(o){var t=function(e){function z39(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.enterz156=[o.z156.z494,o.z156.z753],t.updatez156=[o.z156.z217,o.z156.z687,o.z156.z556,o.z156.z225,o.z156.z454,o.z156.z461,o.z156.z446,o.z156.z590,o.z156.z214,o.z156.z366,o.z156.z362],t.exitz156=[o.z156.z512],t.states=[],t.transitions=[{condition:o.z768.z897,trueNode:{state:o.z108,level:1,actions:[]}}],t}return __extends(z39,e),z39}(z49);o.z39=t}(z0||(z0={})),function(o){var t=function(e){function z17(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.enterz156=[o.z156.z319,o.z156.z406,o.z156.z481,o.z156.z466],t.updatez156=[o.z156.z362,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z379,o.z156.z442],t.exitz156=[o.z156.z512,o.z156.z465,o.z156.z494,o.z156.z320,o.z156.z466],t.states=[o.z113,o.z13,o.z39],t.transitions=[{condition:o.z768.z799,trueNode:{state:o.z108,actions:[]}},{condition:o.z768.z928,falseNode:{state:o.z141}}],t.initialState=o.z113,t}return __extends(z17,e),z17}(z49);o.z17=t}(z0||(z0={})),function(o){var t=function(e){function z13(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.enterz156=[o.z156.z626,o.z156.z332,o.z156.z345],t.updatez156=[o.z156.z705,o.z156.z620,o.z156.z165,o.z156.z616,o.z156.z225,o.z156.z712,o.z156.z718,o.z156.z235,o.z156.z336,o.z156.z718,o.z156.z412,o.z156.z599,o.z156.z461,o.z156.z446,o.z156.z590,o.z156.z214,o.z156.z366],t.exitz156=[],t.states=[],t.transitions=[{condition:o.z768.z793,trueNode:{state:o.z113,actions:[]}},{condition:o.z768.z977,trueNode:{state:o.z39}},{condition:o.z768.z897,trueNode:{state:o.z108,level:1,actions:[]}}],t}return __extends(z13,e),z13}(z49);o.z13=t}(z0||(z0={})),function(t){var e=function(){function TubeEvents(){}return TubeEvents.ENTER=t.AppEvents.GetUniqueID(),TubeEvents.EXIT=t.AppEvents.GetUniqueID(),TubeEvents.WALK=t.AppEvents.GetUniqueID(),TubeEvents.TURN=t.AppEvents.GetUniqueID(),TubeEvents}();t.TubeEvents=e}(z0||(z0={})),function(mt){var t=function(e){function TubeNavigator(){var t=null!==e&&e.apply(this,arguments)||this;return t._radius=.65,t.tubes=[],t.leftBlocked=!1,t.rightBlocked=!1,t.pivotRadius=.95,t._enabled=!0,t.updated=new z1072Set,t}return __extends(TubeNavigator,e),Object.defineProperty(TubeNavigator.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this.triggerAreaMesh&&(this.triggerAreaMesh.scaling.x=2*t,this.triggerAreaMesh.scaling.y=2*t,this.triggerAreaMesh.scaling.z=2*t),this.triggerArea.shapes.radius=t,this.triggerArea.syncShapes()},enumerable:!1,configurable:!0}),TubeNavigator.prototype.init=function(t){if(this.cage=t.cage,!this.triggerArea){this.world=t.world;var e=[.03,.01,1,mt.App.PhysicsGroupTriggerArea,mt.App.z1034];t.pivotRadius&&(this.pivotRadius=t.pivotRadius);var o=this.radius;this.triggerArea=new OIMO.Body({type:"sphere",size:[o,o,o],pos:[0,0,0],rot:[0,0,0],move:!1,world:this.world,name:"_tubeBumper1",config:e}).body,this.triggerArea.shapes.pubsub=this.pubsub,this.triggerArea.shapes.disablePhysics=!0,this.pubsub.subscribe("hit",this.onTrigger.bind(this));this.radius=o}},TubeNavigator.prototype.addTube=function(t){-1==this.tubes.indexOf(t)&&(this.tubes.push(t),this.updateSizePosition()),this.enable()},TubeNavigator.prototype.removeTube=function(t){var e=this.tubes.indexOf(t);-1!=e&&(this.tubes.splice(e,1),this.updateSizePosition()),0==this.tubes.length&&(this.disable(),ObjectPool.recycle(this))},TubeNavigator.prototype.updateSizePosition=function(){var t=this.tubes.length;if(0!=t){var e=this.tubes[0].cage;if(e){for(var o,i,n=0,s=0,a=0,r=0,c=Number.MAX_VALUE,d=-Number.MAX_VALUE,p=-Number.MAX_VALUE,l=Number.MAX_VALUE,u=0;u<t;u++)for(var y=this.tubes[u],g=0;g<y.nodes.length;g++){var m=y.nodes[g];m.x>d&&(d=m.x,i=m),m.x<c&&(c=m.x,o=m),m.y>p&&(p=m.y,m),m.y<l&&(l=m.y,m),n+=m.x,s+=m.y,a+=m.z,r++}if(0<r){n/=r,s/=r,a/=r;var f=e.position.x-.5*e.width+.3,A=e.position.x+.5*e.width-.3,b=0;this.leftBlocked=!1,this.rightBlocked=!1,c<f&&A<d?(this.leftBlocked=!0,this.rightBlocked=!0):c<f&&d<A?(b=d-c+.2,this.leftBlocked=!0):f<c&&A<d&&(b=d-c+.2,this.rightBlocked=!0),this.leftTube=o.data.obj,this.rightTube=i.data.obj,b=z1.roundToDecimalPlace(Math.max(.4,.5*(d-c))+.2,1),this.pivotRadius=.6==b?.1:.95,this.setPosition(n,s,a),this.radius=b}}}},TubeNavigator.prototype.setPosition=function(t,e,o){this.triggerArea.position.x=t,this.triggerArea.position.y=e,this.triggerArea.position.z=o,this.triggerArea.syncShapes(),this.triggerAreaMesh&&(this.triggerAreaMesh.position.x=this.triggerArea.position.x,this.triggerAreaMesh.position.y=this.triggerArea.position.y,this.triggerAreaMesh.position.z=this.triggerArea.position.z,this.triggerAreaMesh.isPickable=!1)},TubeNavigator.prototype.enable=function(){this._enabled||(this.world.addRigidBody(this.triggerArea),this._enabled=!0)},TubeNavigator.prototype.disable=function(){this._enabled&&(this.triggerArea.position.y=9999,this.triggerAreaMesh&&(this.triggerAreaMesh.position.y=9999),this.triggerArea.syncShapes(),this.world.removeRigidBody(this.triggerArea),this._enabled=!1)},TubeNavigator.prototype.onTrigger=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=t[8].actor.rodent;if(this.updated.push(o,o.id,mt.app.frameNum)){var i=o.path[o.pathIndex],n=o.physics.frontBody.body.position,s=o.physics.headBody.body.position,a=this.rightBlocked,r=this.leftBlocked;if(!o.isInState(mt.z21.name)&&!(o.platformUnder&&this.position.y<o.platformUnder.position.y)&&!(o.platformAbove&&i&&i.y>=o.platformAbove.position.y)&&o.currentObject&&o.currentObject.accType!=mt.z1044.z1051){if(o.usingObject&&o.usingObject.accType==mt.z1044.z1046){var c=o.usingObject,d=c.position,p=o.physics.frontBody.body.position.x-d.x,l=.5*c.boxSize-o.size;if(p<l&&-l<p)return}else if(i&&i.data.obj2&&i.data.obj2.accType==mt.z1044.z1046){if((p=i.x-n.x)<.5&&-.5<p)return void(o.pivotArea=0)}var u=o.targets.moveToTarget,y=o.targets.lookToTarget,g=o.targets.standToTarget,m=o.targets.avoidTarget,f=o.targets.pathTarget,A=TubeNavigator.z4[0];if(A.x=this.position.x,A.y=this.position.y,A.z=this.position.z,this.cage.isInBox(n.x,n.y,n.z)){var b=n.x-A.x,v=n.y-A.y,x=n.z-A.z,C=f.x-A.x,S=(f.y,A.y,f.z-A.z);if((!(.2<v&&1==this.tubes.length)||this.tubes[0].isInBox(n.x,n.y,n.z))&&!(v<-.5)){for(var T=0;T<this.tubes.length;T++){var B=this.tubes[T];if(B.isInTube(n.x,n.y,n.z,o.size)){if(B.isInTube(s.x,s.y,s.z,-o.size))return o.currentObject=B,o.setPathTo(o.targets.destTarget),void o.pubsub.broadcast(mt.TubeEvents.ENTER);var O=B.radius;if(O<S||S<-O){if(b<0&&f.x-A.x>-this.radius)return m.copyFrom(f),m.x=A.x-this.radius,u.copyFrom(m),g.copyFrom(m),void(o.avoidingObject=B);if(0<b&&f.x-A.x<this.radius)return m.copyFrom(f),m.x=A.x+this.radius,u.copyFrom(m),g.copyFrom(m),void(o.avoidingObject=B)}}}var P=this.radius,M=P*P;if(i)for(var I=C*C+S*S,N=i.data.obj;I<M&&N==o.currentObject&&o.isFollowingPath()&&!o.path[o.pathIndex].data.enterEvent;){var z=o.path2[o.path2Index]-n.x,w=o.path2[o.path2Index+1]-n.y,_=o.path2[o.path2Index+2]-n.z;if(z*z+w*w+_*_<o.targets.pathNodeHitDist*o.targets.pathNodeHitDist)break;if(o.incrementPathIndex(),!(i=o.path[o.pathIndex]))break;N=i.data.obj,C=f.x-A.x,f.y-A.y,I=C*C+(S=f.z-A.z)*S,0}N&&N.accType==mt.z1044.CONNECTOR_z1048&&(r=a=!1);var R=this.tubes[0],L=100;for(T=0;T<this.tubes.length;T++){var F=Math.abs(this.tubes[T].position.x-n.x);F<L&&(R=this.tubes[T],L=F)}A.x=R.centerGraphNode.x,A.y=R.centerGraphNode.y,A.z=R.centerGraphNode.z;var D=TubeNavigator.z4[4];D.x=f.x-A.x,D.y=0,D.z=f.z-A.z;var E=TubeNavigator.z4[1];E.x=f.x-n.x,E.y=0,E.z=f.z-n.z;var k=TubeNavigator.z4[2];k.x=A.x-n.x,k.y=0,k.z=A.z-n.z;var j=E.lengthSquared(),V=k.lengthSquared();if(j<=V)0<o.pivotArea&&o.currentz1091==this&&(o.pivotArea=0,o.currentz1091=null);else{var G;if(1<this.radius||r||a){if(x<0&&S<0)return;if(0<x&&0<S)return;if(G=this.rightTube,r&&a){for(L=100,T=0;T<this.tubes.length;T++)Math.abs(this.tubes[T].x-f.x)<L&&(G=this.tubes[T],L=Math.abs(this.tubes[T].x-f.x));return m.copyFrom(f),m.y=G.position.y+.5,m.z=G.position.z,m.x=n.x,u.copyFrom(m),y.copyFrom(m),g.copyFrom(m),void(o.avoidingObject=G)}var W=this.radius+.15,Y=1,U=1;b+S<0&&(Y=-1,G=this.leftTube),a&&(Y=-1,G=this.leftTube),r&&(Y=1,G=this.rightTube),x<0&&(U=-1),A.x=G.centerGraphNode.x,A.y=G.centerGraphNode.y,A.z=G.centerGraphNode.z,b=n.x-A.x,x=n.z-A.z;var X,Z=this.position.x+Y*W,q=this.position.z+.3*U,Q=this.cage.getPlatformUnder(Z,this.position.y,q);X=Q?Q.position.y+o.size:this.cage.getHeightAt(Z,q)+o.size;var J=this.cage,K=J.position.x-.5*J.width+o.size+J.wallThickness,$=J.position.x+.5*J.width-o.size-J.wallThickness;Z<K?Z=K:$<Z&&(Z=$);var tt=!1,et=!1,ot=Z-s.x,it=q-s.z,nt=2.5*o.size;if(ot*ot+it*it<nt*nt&&(et=!0),(et||x<1&&-1<x&&(0<Y&&.3<b||Y<0&&b<-.3))&&(tt=!0,k.x=A.x-n.x,k.z=A.z-n.z,V=k.lengthSquared()),!tt)return m.set(Z,X,q),u.copyFrom(m),y.copyFrom(m),g.copyFrom(m),void(o.avoidingObject=G);x<0?0<Y?E.x<0&&(E.x=0,E.z=1):0<E.x&&(E.x=0,E.z=1):0<Y?E.x<0&&(E.x=0,E.z=-1):0<E.x&&(E.x=0,E.z=-1)}if(E.normalize(),k.normalize(),!(BABYLON.Vector3.Dot(E,k)<0)){var st=TubeNavigator.z4[3];BABYLON.Vector3.CrossToRef(E,BABYLON.Axis.Y,st),st.x!=-E.z||(st.z,E.x);var at=st.x+n.x,rt=st.z+n.z,ht=at-A.x,ct=rt-A.z,dt=ht*ht+ct*ct,pt=-st.x+n.x,lt=-st.z+n.z,ut=pt-A.x,yt=lt-A.z,gt=ut*ut+yt*yt;o.pivotMoveDir=gt<dt?1:-1,o.pivotPoint.x=A.x,o.pivotPoint.y=A.y,o.pivotPoint.z=A.z,o.pivotArea=.5*Math.PI,o.pivotRadius=this.pivotRadius,o.pivotRadiusMax=this.pivotRadius,0<o.pivotRadius&&(o.pivotRadiusMax+=2*o.size),G&&1<this.tubes.length&&(o.pivotRadius=this.getPivotRadiusFromTube(G)+1.5*o.size,o.pivotRadiusMax+=2*o.size),o.pivotAreaDir.x=E.x,o.pivotAreaDir.y=E.y,o.pivotAreaDir.z=E.z,.2<this.pivotRadius?o.pivotUpdateLook=!0:o.pivotUpdateLook=!1,o.currentz1091=this}}}}}}},TubeNavigator.prototype.getPivotRadiusFromTube=function(t){for(var e=t.nodes,o=Number.MAX_VALUE,i=-Number.MAX_VALUE,n=-Number.MAX_VALUE,s=Number.MAX_VALUE,a=0;a<e.length;a++){var r=e[a];r.x>i&&(i=r.x,r),r.x<o&&(o=r.x,r),r.y>n&&(n=r.y,r),r.y<s&&(s=r.y,r)}return.5*Math.abs(o-i)},TubeNavigator}(mt.z1091);mt.TubeNavigator=t}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z765(){return null!==t&&t.apply(this,arguments)||this}return __extends(z765,t),z765.prototype.update=function(t){var e=t.bones,o=e.bellyR.bone,i=e.bellyL.bone,n=e.chest.bone,s=e.spine1.bone,a=e.spine2.bone,r=e.shoulder.bone,c=e.legFR,d=e.legFL,p=e.legRR,l=e.legRL,u=t.physics.frontBody.rotationElements,y=z767.tempVecs[0];y.x=u[2],y.y=u[5],y.z=u[8];u=t.physics.rearBody.rotationElements;var g=z767.tempVecs[1];g.x=u[2],g.y=u[5],g.z=u[8];u=t.physics.middleBody.rotationElements;var m=z767.tempVecs[2];m.x=u[2],m.y=u[5],m.z=u[8];var f=m.y,A=m.x;A<0&&(A*=-1);var b=.25*-Math.max(p.moveX,l.moveX),v=.25*-Math.max(c.moveX,d.moveX),x=.3*Math.max(p.moveY,l.moveY),C=.3*Math.max(c.moveY,d.moveY);b*=f,v*=f,x*=A,C*=A;var S=s.getLocalMatrix();S._m[13]+=b,S._m[14]+=x,S._markAsUpdated(),(S=a.getLocalMatrix())._m[13]+=v-b,S._m[14]+=C-x,S._markAsUpdated(),(S=r.getLocalMatrix())._m[13]-=v,S._m[14]-=C,S._markAsUpdated();var T=o.getLocalMatrix();T._m[13]-=.5*b,T._m[14]-=.5*x,T._markAsUpdated(),(T=i.getLocalMatrix())._m[13]-=.5*b,T._m[14]-=.5*x,T._markAsUpdated(),(T=n.getLocalMatrix())._m[13]-=.5*v,T._m[14]-=.5*C,T._markAsUpdated()},z765}(z767),e.z765=o}(z0||(z0={})),function(x){var t,e;t=x.z156||(x.z156={}),e=function(t){function z711(){return null!==t&&t.apply(this,arguments)||this}return __extends(z711,t),z711.prototype.update=function(t){if(t.isTouchingGround()){var e=t.path[t.pathIndex],o=t.path[t.pathIndex+1],i=0;e&&e.data.obj2&&(i=e.data.obj2.accType);var n=(c=t.targets).pathTarget,s=t.size;if(e&&e.data.obj.accType!=x.z1044.z1051&&o){var a=void 0;if(i==x.z1044.z1049)a=e.data.obj2;else if(i==x.z1044.z1046){var r=t.path[t.pathIndex-1];r&&r.data.obj2&&r.data.obj2.accType==x.z1044.z1049&&(a=r.data.obj2),a&&a.position.y>t.position.y&&(t.path2Index<t.path2.length?n.set(t.path2[t.path2Index],t.path2[t.path2Index+1]+s,t.path2[t.path2Index+2]):t.path2Index>=t.path2.length&&n.copyFrom(t.targets.destTarget))}}else if(0<t.path2.length&&t.path2Index<t.path2.length){var c,d=t.physics.frontBody.body,p=(n=(c=t.targets).pathTarget,c.pathNodeHitDist),l=p*p,u=d.position,y=t.path2[t.path2Index]-u.x,g=t.path2[t.path2Index+1]-u.y,m=t.path2[t.path2Index+2]-u.z,f=y*y+g*g+m*m;if(t.path2[t.path2Index+2]<-10)return t.path2Index=t.path2.length+3,t.pathIndex=Math.floor(t.path2Index/3)-1,void t.targets.setTargetsToDestination();if(f<l){var A=t.path[t.pathIndex],b=!0;if(A&&o&&A!=o&&(b=A.isConnectedTo(o)),b)t.path2Index+=3,t.pathIndex=Math.floor(t.path2Index/3)-1,t.pubsub.broadcast(x.z1061Events.NEW_PATH_NODE),t.path2Index>=t.path2.length&&t.targets.setTargetsToDestination();else{var v=t.targets.destTarget;v.x=A.x,v.y=A.y,v.z=A.z,t.path.length=0,t.path2.length=0}}t.path2Index<t.path2.length?n.set(t.path2[t.path2Index],t.path2[t.path2Index+1]+s,t.path2[t.path2Index+2]):t.path2Index>=t.path2.length&&n.copyFrom(t.targets.destTarget)}}},z711}(z767),t.z711=e}(z0||(z0={})),function(b){var t,e;t=b.z156||(b.z156={}),e=function(t){function z708(){return null!==t&&t.apply(this,arguments)||this}return __extends(z708,t),z708.prototype.update=function(t){if(t.avoidingOther=null,t.physics.collisionOtherFrac.targetValue=.5,!(t.pathIndex>=t.path.length)){var e=t.getClosestz1061(0);if(e&&t.currentObject&&t.currentObject.accType==b.z1044.z1051){var o=t.targets.targetDir,i=e.targets.targetDir,n=(BABYLON.Vector3.Dot(o,i),t.physics.middleBody.body.position),s=e.physics.middleBody.body.position,a=(m=n.x-s.x)*m+(f=n.y-s.y)*f+(A=n.z-s.z)*A,r=(n=t.physics.frontBody.body.position,s=e.physics.middleBody.body.position,(m=n.x-s.x)*m+(f=n.y-s.y)*f+(A=n.z-s.z)*A),c=(n=t.physics.rearBody.body.position,s=e.physics.middleBody.body.position,(m=n.x-s.x)*m+(f=n.y-s.y)*f+(A=n.z-s.z)*A),d=3*t.size,p=!1,l=!1,u=!1;if(r<d*d&&(p=!0),c<(d=3*t.size)*d&&(l=!0),a<(d=3*t.size)*d&&(u=!0),(p||l||u)&&(t.physics.collisionOtherFrac.targetValue=.4,t.id,t.avoidingOther=e),t.avoidingOther&&r<d){var y=e.physics.headBody.body.position,g=t.physics.headBody.body.position,m=g.x-y.x,f=g.y-y.y,A=g.z-y.z;g.z-y.z<0?t.targets.lookToTargetOffset.z=-t.size:t.targets.lookToTargetOffset.z=t.size}}}},z708}(z767),t.z708=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z707(){return null!==e&&e.apply(this,arguments)||this}return __extends(z707,e),z707.prototype.update=function(t){e.prototype.update.call(this,t),t.avoidingOther&&t.avoidingOther},z707}(e.z708),e.z707=o}(z0||(z0={})),function(S){var t,e;t=S.z156||(S.z156={}),e=function(t){function z662(){return null!==t&&t.apply(this,arguments)||this}return __extends(z662,t),z662.prototype.update=function(t){var e=t.path[t.pathIndex];if(e){var o=e.data.obj;if(o.accType==S.z1044.z1051){var i=z767.z4[0],n=z767.z4[1];i.x=e.x,i.y=e.y,i.z=e.z,n.copyFrom(i);var s=t.physics,a=s.headBody.body.position,r=s.frontBody.body.position,c=s.middleBody.body.position,d=t.targets.moveToTarget,p=t.targets.lookToTarget,l=t.targets.standToTarget,u=e.data.outDir,y=e.data.connector;if(t.path[t.pathIndex+1]){var g=z767.z4[2];g.x=c.x-y.position.x,g.y=c.y-y.position.y,g.z=c.z-y.position.z,0<BABYLON.Vector3.Dot(u,g)&&(i=t.path[t.pathIndex+1])}p.x=i.x,p.y=i.y,p.z=i.z,l.x=p.x,l.y=p.y,l.z=p.z;var m=t.path[t.pathIndex+1];if(!m)return d.x=n.x,d.y=n.y,void(d.z=n.z);var f,A=r.x-n.x,b=r.y-n.y,v=r.z-n.z,x=A*A+b*b+v*v,C=(f=.85*t.size)*f;if(o.isInTube&&o.isInTube(a.x,a.y,a.z)&&m&&(n=m),x<C)m&&(n=m);else if(.3<r.y-o.position.y)(A=r.x-o.position.x)*A+(v=r.z-o.position.z)*v<(f=o.radius-t.size)*f&&(n=m);d.x=n.x,d.y=n.y,d.z=n.z}}},z662}(z767),t.z662=e}(z0||(z0={})),function(s){var t,e;t=s.z156||(s.z156={}),e=function(t){function z639(){return null!==t&&t.apply(this,arguments)||this}return __extends(z639,t),z639.prototype.update=function(t){var e=t.path[t.pathIndex];if(e){var o=e.data.obj;if(o&&o.accType==s.z1044.z1051&&!e.data.enterEvent){var i=t.physics.frontBody.body.position,n=o.getClosestEnterNode(i);t.path.splice(t.pathIndex,0,n)}}},z639}(z767),t.z639=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z638(){return null!==t&&t.apply(this,arguments)||this}return __extends(z638,t),z638.prototype.update=function(t){var e=t.targets,o=e.currentTarget,i=e.moveToTarget,n=e.lookToTarget,s=e.standToTarget;if((t.currentObject.parent||t.isFollowingPath())&&(t.path[t.pathIndex]&&t.path[t.pathIndex].data.obj&&!t.path[t.pathIndex].data.obj.isInTube||!t.path[t.pathIndex])){var a=t.currentObject;if(a.hasEnterNode)if(!a.isInTube(o.x,o.y,o.z)){for(var r=null,c=0,d=0;d<a.nodes.length;d++){var p=a.nodes[d];if(p.data.enterTarget){var l=o.x-p.x,u=o.y-p.y,y=o.z-p.z,g=l*l+u*u+y*y;(!r||g<c)&&(r=p,c=g)}}if(r&&r.data.obj==a){var m=z767.z4[0],f=z767.z4[1],A=r,b=a.centerGraphNode;p.data.outDir?(m.x=A.data.outDir.x,m.y=A.data.outDir.y,m.z=A.data.outDir.z):(m.x=A.x-b.x,m.y=A.y-b.y,m.z=A.z-b.z),f.x=o.x-A.x,f.y=o.y-A.y,f.z=o.z-A.z,BABYLON.Vector3.Dot(f,m)<0&&(o=r,s.x=o.x,s.y=o.y,s.z=o.z,i.x=o.x,i.y=o.y,i.z=o.z,n.x=o.x,n.y=o.y,n.z=o.z)}}}},z638}(z767),e.z638=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z617(){return null!==t&&t.apply(this,arguments)||this}return __extends(z617,t),z617.prototype.update=function(t){if(!t.isTouchingGround()&&t.usingObject){var e=t.physics.frontBody.body.position;if(!(t.usingObject.position.y<e.y)){var o=e.x-t.usingObject.position.x,i=e.y-t.usingObject.position.y,n=e.z-t.usingObject.position.z,s=o*o+i*i+n*n,a=t.size;if(s<a*a)t.forceTouchGround();else{var r=1.75*t.size,c=1.5*t.size;if(o<r&&-r<o&&i<.4&&n<c&&-c<n)t.forceTouchGround();else{var d=.5*t.size,p=t.physics.rearBody.body.position;if(t.cage){if(p.y<t.cage.bottom+d)return void t.forceTouchGround();var l=t.platformUnder;if(l&&p.y<l.position.y+d)return void t.forceTouchGround()}}}}}},z617}(z767),e.z617=o}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z616(){return null!==t&&t.apply(this,arguments)||this}return __extends(z616,t),z616.prototype.update=function(t){t.isTouchingGround()||t.rearObject&&t.rearObject.accType==e.z1044.z1051&&t.forceTouchGround()},z616}(z767),t.z616=o}(z0||(z0={})),function(q){var t,e;t=q.z156||(q.z156={}),e=function(t){function z576(){return t.call(this)||this}return __extends(z576,t),z576.prototype.update=function(t){var e=t.bones.head,o=(q.app.world.timeStep,t.physics.headBody.body),i=t.physics.frontBody.body,n=(t.physics.middleBody.body,t.targets.lookToTarget),s=z767.tempVecs[0],a=z767.tempVecs[1],r=z767.tempVecs[2],c=z767.tempVecs[3],d=z767.tempVecs[4],p=z767.tempVecs[5],l=z767.tempVecs[6],u=t.physics.middleBody.rotationElements;d.x=u[0],d.y=u[3],d.z=u[6],p.x=u[1],p.y=u[4],p.z=u[7],l.x=u[2],l.y=u[5],l.z=u[8];var y=t.physics.frontBody.standAng.value;if(y<0){var g=Math.cos(-y),m=Math.sin(-y),f=0*d.x+g*p.x+m*l.x,A=0*d.y+g*p.y+m*l.y,b=0*d.z+g*p.z+m*l.z;p.x=f,p.y=A,p.z=b,l.cross(d,p),l.normalize(l)}var v,x,C,S=t.speed,T=n,B=(o.position,i.position),O=T.x-B.x,P=T.y-B.y,M=T.z-B.z,I=t.physics.frontBody.rotationElements;v=O*I[0]+P*I[3]+M*I[6],x=O*I[1]+P*I[4]+M*I[7],C=O*I[2]+P*I[5]+M*I[8];var N=Math.atan2(v,C);e.yawTar=N,O=v*I[0]+x*I[1]+C*I[2],P=v*I[3]+x*I[4]+C*I[5],M=v*I[6]+x*I[7]+C*I[8];var z=t.physics.headBody.rotationElements,w=z[2],_=z[5],R=z[8];d.x,d.y,d.z,p.x,p.y,p.z,l.x,l.y,l.z;s.x=w,s.y=_,s.z=R;var L=a,F=c,D=r;F.x=O,F.y=P,F.z=M,F.normalize(F),D.cross(s,F),D.normalize(D),L.cross(D,F);var E=s.x,k=s.y,j=s.z,V=E*L.x+k*L.y+j*L.z,G=E*F.x+k*F.y+j*F.z,W=Math.atan2(V,G),Y=.5*-(e.angToTar=W),U=.01*Math.PI,X=U+(.1*Math.PI-U)*S;X<Y?Y=X:Y<-X&&(Y=-X);var Z=o.angularVelocity;D.scaleEqual(62*Y),a.sub(D,Z),Z.addEqual(a)},z576}(z767),t.z576=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z553(){return null!==t&&t.apply(this,arguments)||this}return __extends(z553,t),z553.prototype.update=function(t){var e=t.path[t.pathIndex];e&&!e.data.obj.isInTube||(t.pathIndex++,t.path2Index=3*t.pathIndex+3)},z553}(z767),e.z553=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z548(){return null!==t&&t.apply(this,arguments)||this}return __extends(z548,t),z548.prototype.update=function(t){t.bones.ears.offsetZ.targetValue=-.15,t.bones.ears.offsetY.targetValue=-.15;var e=t.physics.middleBody.body.rotation.elements,o=z767.z4[0];o.x=e[1],o.y=e[4],o.z=e[7];var i=z767.z4[1];i.x=0,i.y=1,i.z=0,BABYLON.Vector3.Dot(o,i)<-.5&&(t.bones.ears.offsetZ.targetValue=-.3)},z548}(z767),e.z548=o}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z505(){return null!==t&&t.apply(this,arguments)||this}return __extends(z505,t),z505.prototype.update=function(t){if(t.isFollowingPath()&&(t.path[t.pathIndex].data.obj.accType!=n.z1044.z1051&&t.currentObject&&t.currentObject.accType==n.z1044.z1051)){var e=t.path[t.pathIndex-1];if(e&&e.data.obj!=t.currentObject){var o=t.path[t.pathIndex-2];if(o&&o.data.obj==t.currentObject)return;var i=t.physics.rearBody.body.position;t.currentObject.isInTube(i.x,i.y,i.z)&&t.setPathTo(t.targets.destTarget)}}},z505}(z767),t.z505=e}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(e){function z459(){var t=e.call(this)||this;o.app.graphicsHelper;return t}return __extends(z459,e),z459.prototype.update=function(t){if(t.isTouchingGround()){var e=t.targets,o=e.upVecTarget,i=o.x,n=o.y,s=o.z,a=t.physics.frontBody.body.position,r=t.physics.rearBody.body.position;a.y,r.y;t.size,t.size;var c,d=t.physics.middleBody.body,p=z767.tempVecs[0],l=z767.tempVecs[1],u=z767.tempVecs[2],y=t.physics.middleBody.rotationElements,g=d.angularVelocity;if(p.x=y[2],p.y=y[5],p.z=y[8],l.x=0,l.y=1,l.z=0,!(t.walkForce<.01)){var m=z1.Dot(p,l);if(!(.95<m||m<-.95)){var f,A,b;null!=i&&(l.x=i,l.y=n,l.z=s),u.cross(l,p),c=y,f=u.x,A=u.y,b=u.z;var v=f*c[0]+A*c[3]+b*c[6],x=f*c[1]+A*c[4]+b*c[7];c[2],c[5],c[8];e.rollAngToUp=Math.atan2(x,v);var C=e.rollAngToUp,S=t.speed,T=.01*Math.PI,B=T+(.1*Math.PI-T)*S;B<C?C=B:C<-B&&(C=-B),p.scaleEqual(62*C),l.sub(p,g);var O;(O=50*t.size)*O<l.dot(l)&&(l.normalize(l),l.scaleEqual(O)),g.addEqual(l)}}}},z459}(z767),t.z459=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z452(){return null!==t&&t.apply(this,arguments)||this}return __extends(z452,t),z452.prototype.update=function(t){var e=z767.tempVecs[0],o=z767.tempVecs[1],i=z767.tempVecs[2],n=z767.tempVecs[3],s=t.physics,a=s.rearBody.body,r=t.physics.rearBody.rotationElements,c=n;c.x=r[2],c.y=r[5],c.z=r[8];t.size;var d=e,p=o,l=i;if(t.rearObject&&t.rearObject.getDirection){t.rearObject.getDirection(p,a.position,s.headBody.body.position,a.shapes.radius),l.cross(c,p),l.normalize(l),d.cross(l,p);var u=c.x,y=c.y,g=c.z,m=u*d.x+y*d.y+g*d.z,f=u*p.x+y*p.y+g*p.z,A=Math.atan2(m,f),b=.2*Math.PI;b<A?A=b:A<-b&&(A=-b);var v=1*-A,x=a.angularVelocity;l.scaleEqual(v),o.sub(l,x);var C=50*t.size;C*C<o.dot(o)&&(o.normalize(o),o.scaleEqual(C)),x.addEqual(o)}},z452}(z767),e.z452=o}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z433(){return null!==t&&t.apply(this,arguments)||this}return __extends(z433,t),z433.prototype.update=function(t){if(0<(t.physics.touchingAccTypes&n.z1044.z1051))for(var e=t.physics.frontBody.body.position,o=0;o<t.physics.touchingShapes.length;o++){var i=t.physics.touchingShapes.data.data[o];i&&i.entity&&i.entity.accType==n.z1044.z1051&&i.entity.isInTube(e.x,e.y,e.z)&&(t.currentObject=i.entity,t.rearObject=i.entity)}},z433}(z767),t.z433=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z414(){var t=null!==e&&e.apply(this,arguments)||this;return t.footOffsetXFront=-.13,t.footOffsetYFront=.1,t.footOffsetZFront=-.04,t.footOffsetXRear=-.4,t.footOffsetYRear=.1,t.footOffsetZRear=-.07,t.rearTargPoleAng=.75,t}return __extends(z414,e),z414.prototype.update=function(t){var e=t.physics.frontBody.rotationElements,o=z767.tempVecs[0];o.x=e[2],o.y=e[5],o.z=e[8];e=t.physics.rearBody.rotationElements;var i=z767.tempVecs[1];i.x=e[2],i.y=e[5],i.z=e[8];e=t.physics.middleBody.rotationElements;var n=z767.tempVecs[2];n.x=e[2],n.y=e[5],n.z=e[8];var s=o.y*n.y*i.y;s<0&&(s*=-1),s*=s;var a=t.bones.legFL.offsetBone1Pos;a.y=this.footOffsetYFront*s,(a=t.bones.legFR.offsetBone1Pos).y=this.footOffsetYFront*s;var r=this.rearTargPoleAng;t.bones.legRL.targetPoleAngle=-r,t.bones.legRR.targetPoleAngle=r,(a=t.bones.legRL.offsetBone1Pos).x=this.footOffsetXRear*s*.5,a.y=this.footOffsetYRear*s,t.bones.legRL.footOffsetX_.targetValue=this.footOffsetXRear*s*.5,t.bones.legRL.footOffsetZ_.targetValue=this.footOffsetZRear*s,(a=t.bones.legRR.offsetBone1Pos).x=this.footOffsetXRear*s*.5,a.y=this.footOffsetYRear*s,t.bones.legRR.footOffsetX_.targetValue=this.footOffsetXRear*s*.5,t.bones.legRR.footOffsetZ_.targetValue=-this.footOffsetZRear*s},z414}(z767),e.z414=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z321(){return null!==t&&t.apply(this,arguments)||this}return __extends(z321,t),z321.prototype.update=function(t){t.targets.pathNodeHitDist=2.5*t.size},z321}(z767),e.z321=o}(z0||(z0={})),function(u){var t,e;t=u.z156||(u.z156={}),e=function(t){function z317(){return t.call(this)||this}return __extends(z317,t),z317.prototype.update=function(t){if(!(t.pathIndex>=t.path.length)){var e=t.path[t.pathIndex],o=t.physics.headBody.body.position,i=e.x-o.x,n=e.y-o.y,s=e.z-o.z,a=i*i+n*n+s*s,r=t.size;if(a<r*r){var c=t.path[t.pathIndex],d=t.path[t.pathIndex+1],p=!0;if(c&&d&&c!=d&&(p=c.isConnectedTo(d)),p)t.pathIndex=Math.min(t.pathIndex+1,t.path.length-1),t.path2Index=3*t.pathIndex+3,t.pubsub.broadcast(u.z1061Events.NEW_PATH_NODE),t.path2Index>=t.path2.length&&t.pubsub.broadcast(u.z1061Events.END_PATH);else{var l=t.targets.destTarget;l.x=c.x,l.y=c.y,l.z=c.z,t.path.length=0,t.path2.length=0}}}},z317}(z767),t.z317=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z277(){return null!==t&&t.apply(this,arguments)||this}return __extends(z277,t),z277.prototype.update=function(t){t.physics.stayInsideBodyType=OIMO.SHAPE_z1051},z277}(z767),e.z277=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z270(){return t.call(this)||this}return __extends(z270,t),z270.prototype.update=function(t){var e=t.physics.frontBody.body,o=t.targets.moveToTarget,i=(o=t.targets.lookToTarget,t.targets.targetDir);t.currentObject||t.currentObject,t.currentObject&&t.currentObject.getDirection&&(t.currentObject.getDirection(i,e.position,o,e.shapes.radius),this.pubsub&&this.pubsub.broadcast("getDirection",t,e.position,i),i.x<.9&&i.x)},z270}(z767),e.z270=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z254(){return null!==t&&t.apply(this,arguments)||this}return __extends(z254,t),z254.prototype.update=function(t){var e=z767.tempVecs[0],o=z767.tempVecs[1],i=z767.tempVecs[2],n=z767.tempVecs[3],s=t.physics,a=s.middleBody.body.position,r=s.frontBody.body.position,c=s.rearBody.body.position;t.localPos.x=a.x,t.localPos.y=a.y,t.localPos.z=a.z,t.localPosMid.x=a.x,t.localPosMid.y=a.y,t.localPosMid.z=a.z,t.localPosFront.x=r.x,t.localPosFront.y=r.y,t.localPosFront.z=r.z,t.localPosRear.x=c.x,t.localPosRear.y=c.y,t.localPosRear.z=c.z;var d=t.path[t.pathIndex],p=t.targets,l=p.moveToTarget,u=p.lookToTarget,y=p.upVecTarget;d=0==t.path.length||t.pathIndex>=t.path.length?t.targets.destTarget:t.path[t.pathIndex],u.x=d.x,u.y=d.y,u.z=d.z,l.x=d.x,l.y=d.y,l.z=d.z,e.x=u.x-a.x,e.y=u.y-a.y,e.z=u.z-a.z,e.normalize(e),o.x=0,o.y=1,o.z=0,i.cross(e,o),i.normalize(i),n.cross(i,e),n.normalize(n),y.x=n.x,y.y=n.y,y.z=n.z},z254}(z767),e.z254=o}(z0||(z0={})),function(j){var t,e;t=j.z156||(j.z156={}),e=function(t){function z244(){return null!==t&&t.apply(this,arguments)||this}return __extends(z244,t),z244.prototype.update=function(t){if(t.isTouchingGround())if(t.avoidingObject)t.avoidingObject;else{var e,o=t.path[t.pathIndex],i=t.path[t.pathIndex+1],n=0,s=t.targets,a=s.moveToTarget,r=s.lookToTarget,c=s.standToTarget,d=t.physics.frontBody.body.position;if(!o){var p=t.rearObject,l=t.physics.headBody.body.position;if(p&&p.accType==j.z1044.z1051){var u=p.getClosestEnterNode(l);if(u){var y=u.connections;o=y[0];for(var g=1;o&&o.data.obj==p;)if(o=y[g],10<++g){o=null;break}}}}if(o&&o.data.obj2&&o.data.obj2.accType==j.z1044.z1049&&i){if(e=o.data.obj2,t.targets.targetDir.y<.5&&0<e.body.shapes.holes.length){var m=t.physics.rearBody.body.position;if(0<=i.y-o.y&&m.y>o.y)for(var f=e.position,A=0;A<e.holes.length;A++){if((C=e.holes[A]).active)if((R=C.x+f.x-o.x)*R+(L=C.z+f.z-o.z)*L<.01){0<t.targets.targetDir.x?n+=.33:n-=.33;break}}}}else if(o&&o.data.obj.accType==j.z1044.z1048&&i){var b=o.data.obj,v=b.holes;if(t.targets.targetDir.y<.5&&0<v.length&&0<=i.y-o.y){var x=b.position;for(A=0;A<v.length;A++){var C;if((R=(C=v[A]).x+x.x-o.x)*R+(L=C.z+x.z-o.z)*L<.01){i.z>C.z?n+=.33:n-=.33;break}}}}if(t.physics.touchingAccTypes&j.z1044.z1046&&(n||.9<t.targets.targetDir.y&&(o.x-d.x<0?n-=.5:n+=.5)),0<t.path2.length&&t.path2Index<t.path2.length)c.x=o.x,c.y=o.y,c.z=o.z+n,a.x=o.x,a.y=o.y,a.z=o.z+n,r.x=o.x,r.y=o.y,r.z=o.z+n;else if(n){var S=t.targets.destTarget;c.z=S.z+n,a.z=S.z+n,r.z=S.z+n}var T=t.rearObject;if(T){var B=T.parent;if(B&&t.path2[t.path2Index-3]&&t.path2[t.path2Index+2]){S=t.targets.destTarget;if(B.isInBox(S.x,S.y,S.z)){var O=t.path2[t.path2Index-3],P=t.path2[t.path2Index-2],M=t.path2[t.path2Index-1],I=t.path2[t.path2Index],N=t.path2[t.path2Index+1],z=t.path2[t.path2Index+2];(E=z767.z4[0]).x=I-O,E.y=N-P,E.z=z-M,E.normalize(),BABYLON.Vector3.Dot(E,t.targets.targetDir)<-.8&&(r.x=S.x,r.y=S.y,r.z=S.z)}}if(t.rearObject&&t.currentObject.accType!=j.z1044.z1051&&t.rearObject.isInTube&&t.currentObject.getHeightAt){var w=t.physics.rearBody.body.position,_=t.currentObject.floorY;if(e&&(_=e.position.y),_>w.y){t.forceTouchGround();var R,L,F=(R=a.x-d.x)*R+(L=a.z-d.z)*L,D=t.rearObject.innerRadius+.5*t.size;if(F<D*D){var E,k=t.physics.frontBody.rotationElements;(E=z767.z4[0]).x=-k[1],E.y=0,E.z=-k[7],E.normalize(),a.x=d.x+E.x,a.y=_+t.size,a.z=d.z+E.z}r.copyFrom(a),c.copyFrom(a)}}}}},z244}(z767),t.z244=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z232(){return null!==t&&t.apply(this,arguments)||this}return __extends(z232,t),z232.prototype.update=function(t){var e=t.physics.frontBody.body,o=t.physics.frontBody.rotationElements,i=e.position,n=t.path[Math.min(t.pathIndex+2,t.path.length-1)],s=n.x-i.x,a=n.y-i.y,r=n.z-i.z,c=s*o[0]+a*o[3]+r*o[6];o[2],o[5],o[8];t.targets.turnDir=c<0?-1:1},z232}(z767),e.z232=o}(z0||(z0={})),function(yt){var t,e;t=yt.z156||(yt.z156={}),e=function(t){function z183(){return t.call(this)||this}return __extends(z183,t),z183.prototype.update=function(t){yt.app.world.timeStep;var e=t.adjustLerp,o=z767.tempVecs[0],i=z767.tempVecs[1],n=z767.tempVecs[2],s=z767.tempVecs[3],a=t.physics,r=a.headBody.body,c=t.targets.turnDir,d=a.middleBody.body.position,p=a.frontBody.body.position,l=a.rearBody.body.position;if(t.localPos.x=d.x,t.localPos.y=d.y,t.localPos.z=d.z,t.localPosMid.x=d.x,t.localPosMid.y=d.y,t.localPosMid.z=d.z,t.localPosFront.x=p.x,t.localPosFront.y=p.y,t.localPosFront.z=p.z,t.localPosRear.x=l.x,t.localPosRear.y=l.y,t.localPosRear.z=l.z,t.currentObject&&t.currentObject.accType==yt.z1044.z1051){var u,y,g,m=t.currentObject,f=o,A=a.frontBody.body.position,b=i,v=t.path[t.pathIndex+2];if(v||(v=t.path[t.pathIndex+1]),v||(v=t.path[t.pathIndex]),v&&!v.data.tube){for(var x=null,C=t.pathIndex;C>t.pathIndex-3&&0<=C;C--)if(t.path[C].data.enterTarget){v=z767.z4[0],x=t.path[C],v.x=x.x+(x.x-m.centerGraphNode.x),v.y=x.y+(x.y-m.centerGraphNode.y),v.z=x.z+(x.z-m.centerGraphNode.z);break}if(!x){var S=t.currentObject.nodes;for(C=0;C<S.length;C++)if(S[C].data.enterTarget){v=z767.z4[0],x=S[C],v.x=x.x+(x.x-m.centerGraphNode.x),v.y=x.y+(x.y-m.centerGraphNode.y),v.z=x.z+(x.z-m.centerGraphNode.z);break}}}var T=t.targets.pathTarget,B=t.targets.lookToTarget;v?(u=v.x,y=v.y,g=v.z):(u=T.x,y=T.y,g=T.z),b.x=u,b.y=y,b.z=g,m.getDirection(f,r.position,b,r.shapes.radius);var O=f.x,P=f.y,M=f.z;m.getDirection(f,A,b,a.frontBody.body.shapes.radius);var I=f.x,N=f.y,z=f.z,w=I,_=N,R=z,L=I,F=N,D=z,E=t.physics.headBody.rotationElements;s.x=E[2],s.y=E[5],s.z=E[8],o.x=O,o.y=P,o.z=M;var k=s.dot(o);E=t.physics.frontBody.rotationElements;o.x=I,o.y=N,o.z=z,s.x=E[2],s.y=E[5],s.z=E[8];var j=s.dot(f);o.x=w,o.y=_,o.z=R,E=t.physics.middleBody.rotationElements,i.x=E[2],i.y=E[5],i.z=E[8];var V=i.dot(o);o.x=L,o.y=F,o.z=D,E=t.physics.rearBody.rotationElements,i.x=E[2],i.y=E[5],i.z=E[8];var G=i.dot(o),W=o,Y=i,U=n;E=t.physics.rearBody.rotationElements,j<-.75?(B.x=A.x+(I+E[0]*c)*(.5*e),B.y=A.y+(N+E[3]*c)*(.5*e),B.z=A.z+(z+E[6]*c)*(.5*e)):(B.x=A.x+O,B.y=A.y+P,B.z=A.z+M);var X=.5*(2*m.innerRadius-2*t.size),Z=1*a.rearJoint.len,q=X/a.rearJoint.len;1<q?q=1:q<-1&&(q=-1);var Q,J,K,$,tt,et=Math.asin(q),ot=0;if(X<(Z=1*a.neckJoint.len)&&(K=Z-X,(Q=k<(ot=0)?Math.acos(-k):Math.acos(k))<et&&(ot=(et-Q)/et),J=(X+ot*K)/a.neckJoint.len,a.neckJoint.frac+=(J-a.neckJoint.frac)*(.1*e)),-.25<k){E=t.physics.middleBody.rotationElements,U.x=E[1],U.y=E[4],U.z=E[7];var it=0;Y.x=I,Y.y=N,Y.z=z,W.cross(U,Y),W.normalize(W),Y.cross(W,U);var nt=(E=t.physics.frontBody.rotationElements)[2],st=E[5],at=E[8],rt=nt*W.x+st*W.y+at*W.z,ht=nt*Y.x+st*Y.y+at*Y.z;$=Math.atan2(rt,ht),Math.abs($)<.5*Math.PI?it=-$:-.5<k?it=Math.PI*c:k<0&&(it=Math.PI*-c);var ct=.1*Math.PI;(ct=(lt=.01*Math.PI)+(.1*Math.PI-lt)*.5)<it?it=ct:it<-ct&&(it=-ct);var dt=a.frontBody.body.angularVelocity;U.scaleEqual(62*it),i.sub(U,dt),i.scaleEqual(.8*e),(ut=30)*ut<i.dot(i)&&(i.normalize(i),i.scaleEqual(ut)),dt.addEqual(i);if(1==c&&-2.75<$&&$<.1||-1==c&&$<2.75&&-.1<$){E=t.physics.frontBody.rotationElements,s.x=O,s.y=P,s.z=M;var pt=a.frontBody.body.linearVelocity;i.sub(s,pt),i.scaleEqual(.8*e),(ut=50)*ut<i.dot(i)&&(i.normalize(i),i.scaleEqual(ut)),pt.addEqual(i)}}if(-.5<j){E=t.physics.middleBody.rotationElements,U.x=E[1],U.y=E[4],U.z=E[7];it=0;Y.x=L,Y.y=F,Y.z=D,W.cross(U,Y),W.normalize(W),Y.cross(W,U);nt=(E=t.physics.rearBody.rotationElements)[2],st=E[5],at=E[8],rt=nt*W.x+st*W.y+at*W.z,ht=nt*Y.x+st*Y.y+at*Y.z;it=-(tt=Math.atan2(rt,ht)),it=0<V?-tt:Math.PI*c;var lt;ct=.1*Math.PI;(ct=(lt=.01*Math.PI)+(.1*Math.PI-lt)*.5)<it?it=ct:it<-ct&&(it=-ct);var ut;dt=a.rearBody.body.angularVelocity;U.scaleEqual(62*it),i.sub(U,dt),i.scaleEqual(.8*e),(ut=30)*ut<i.dot(i)&&(i.normalize(i),i.scaleEqual(ut)),dt.addEqual(i)}X<Z&&(K=Z-X,(Q=G<(ot=0)?Math.acos(-G):Math.acos(G))<et&&(ot=(et-Q)/et),J=(X+ot*K)/a.rearJoint.len,a.rearJoint.frac+=(J-a.rearJoint.frac)*(.1*e)),X<(Z=1*a.frontJoint.len)&&(K=Z-X,(Q=j<(ot=0)?Math.acos(-j):Math.acos(j))<et&&(ot=(et-Q)/et),J=(X+ot*K)/a.frontJoint.len,a.frontJoint.frac+=(J-a.frontJoint.frac)*(.05*e))}},z183}(z767),t.z183=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z165(){return null!==t&&t.apply(this,arguments)||this}return __extends(z165,t),z165.prototype.update=function(t){var e=t.physics,o=e.frontBody.body.position,i=t.currentObject;if(i&&i.getNeighborAt&&!i.isInBox(o.x,o.y,o.z)){var n=t.currentObject.getNeighborAt(o.x,o.y,o.z);if(!n)return;t.currentObject=n}var s=e.rearBody.body.position;t.rearObject&&!t.rearObject.connectTubes&&(t.rearObject=t.currentObject),t.rearObject=t.rearObject||t.currentObject,t.rearObject&&t.rearObject.connectTubes&&t.rearObject,t.rearObject&&t.rearObject.getNeighborAt&&!t.rearObject.isInBox(s.x,s.y,s.z)&&(n=t.rearObject.getNeighborAt(s.x,s.y,s.z),t.rearObject=n),t.rearObject&&t.rearObject.isInTube&&t.rearObject!=t.currentObject&&t.currentObject.objs&&-1<t.currentObject.objs.indexOf(t.rearObject)&&t.rearObject.isInTube(o.x,o.y,o.z)&&(t.currentObject=t.rearObject)},z165}(z767),e.z165=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z164(){return null!==t&&t.apply(this,arguments)||this}return __extends(z164,t),z164.prototype.update=function(t){var e=t.physics.rearBody.body.position,o=t.currentObject;if(o&&!o.isInBox(e.x,e.y,e.z)){var i=t.currentObject.getNeighborAt(e.x,e.y,e.z);t.currentObject=i}},z164}(z767),e.z164=o}(z0||(z0={})),function(K){var t,e;t=K.z156||(K.z156={}),e=function(t){function z162(){return null!==t&&t.apply(this,arguments)||this}return __extends(z162,t),z162.prototype.update=function(t){var e;e=K.app.world.timeStep;var o=z767.tempVecs[0],i=z767.tempVecs[1],n=z767.tempVecs[2],s=z767.tempVecs[3],a=t.physics,r=a.frontBody.body,c=a.headBody.body.position,d=t.targets.targetDir,p=6,l=t.focusDist+t.focusRange,u=t.targets.destTarget,y=c.x-u.x,g=c.y-u.y,m=c.z-u.z,f=y*y+g*g+m*m;t.targetObject&&t.targetObject.accType==K.z1044.z1051&&(f=y*y+g*g);var A=!1,b=3*t.size,v=t.getClosestz1061(0,2,b*b);if(v&&v.yieldingToOther!=t&&v.currentObject&&v.currentObject.accType==K.z1044.z1051){t.yieldingToOther=null;c=t.physics.headBody.body.position;var x=t.targets.targetDir,C=v.targets.targetDir;0<=BABYLON.Vector3.Dot(x,C)&&(A=!0,(t.yieldingToOther=v).id)}this.pubsub&&this.pubsub.broadcast(t.id,t,A);var S=t.physics.frontBody.rotationElements,T=s;T.x=S[2],T.y=S[5],T.z=S[8];var B,O,P,M=t.size;p=13*M,f<1.5*l*l*1.5&&(p=6.4*M);var I=o,N=i,z=n;N.x=d.x,N.y=d.y,N.z=d.z,z.cross(T,N),z.normalize(z),I.cross(z,N);var w=T.x,_=T.y,R=T.z,L=w*I.x+_*I.y+R*I.z,F=w*N.x+_*N.y+R*N.z,D=1*-Math.atan2(L,F),E=r.angularVelocity;if(z.scaleEqual(62*D),i.sub(z,E),(V=100*t.size)*V<i.dot(i)&&(i.normalize(i),i.scaleEqual(V)),E.addEqual(i),f<l*l&&(A=!0),A){j=a.frontBody.body.linearVelocity;o.x=.1*-j.x,o.y=1*-j.y,o.z=0,j.addEqual(o),j=a.middleBody.body.linearVelocity,o.x=.1*-j.x,o.y=1*-j.y,o.z=0,j.addEqual(o),j=a.rearBody.body.linearVelocity,o.x=.1*-j.x,o.y=1*-j.y,o.z=0,j.addEqual(o),t.walkForce=0}else{var k=a.frontBody;o.x=S[2],o.y=S[5],o.z=S[8];var j;S=t.physics.frontBody.rotationElements;o.x*=p,o.y*=p,o.z*=p,(j=k.body.linearVelocity).y<-p&&(j.y=-p);var V,G=j.x,W=j.y,Y=j.z,U=G*S[0]+W*S[3]+Y*S[6],X=G*S[1]+W*S[4]+Y*S[7],Z=G*S[2]+W*S[5]+Y*S[8],q=o.x,Q=o.y,J=o.z;B=32*((B=q*S[0]+Q*S[3]+J*S[6])-U)*e,O=32*((O=q*S[1]+Q*S[4]+J*S[7])-X)*e,P=32*((P=q*S[2]+Q*S[5]+J*S[8])-Z)*e,a.localWalkForce.x=B,a.localWalkForce.y=O,a.localWalkForce.z=P,o.x=B*S[0]+O*S[1]+P*S[2],o.y=B*S[3]+O*S[4]+P*S[5],o.z=B*S[6]+O*S[7]+P*S[8],(V=3)*V<o.dot(o)&&(o.normalize(o),o.scaleEqual(V)),j.addEqual(o),t.walkForce=p}},z162}(z767),t.z162=e}(z0||(z0={})),function(U){var t,e;t=U.z156||(U.z156={}),e=function(t){function z161(){return t.call(this)||this}return __extends(z161,t),z161.prototype.update=function(t){var e;e=U.app.world.timeStep;var o=z767.tempVecs[0],i=z767.tempVecs[1],n=z767.tempVecs[2],s=z767.tempVecs[3],a=t.physics,r=a.rearBody.body,c=(a.middleBody.body.position,a.frontBody.body.position,a.rearBody.body.position),d=a.headBody.body.position,p=t.rearObject;if(p.getDirection){p.getDirection(i,c,d,r.shapes.radius),o.x=c.x+i.x,o.y=c.y+i.y,o.z=c.z+i.z;var l=o.x-d.x,u=o.y-d.y,y=o.z-d.z,g=o.x-c.x,m=o.y-c.y,f=o.z-c.z;l*l+u*u+y*y<g*g+m*m+f*f&&(i.x*=-1,i.y*=-1,i.z*=-1);r.linearVelocity,t.focusDist;var A,b,v,x,C=t.physics.rearBody.rotationElements,S=s;S.x=-C[2],S.y=-C[5],S.z=-C[8],A=7*t.size;var T=o,B=i,O=n;O.cross(S,B),O.normalize(O),T.cross(O,B);var P=S.x,M=S.y,I=S.z,N=P*T.x+M*T.y+I*T.z,z=P*B.x+M*B.y+I*B.z,w=1*-Math.atan2(N,z),_=(Math.PI,.01*Math.PI);_+1*(.08*Math.PI-_);var R=r.angularVelocity;O.scaleEqual(62*w),i.sub(O,R),R.addEqual(i),o.x=S.x,o.y=S.y,o.z=S.z,o.x*=A,o.y*=A,o.z*=A;var L=r.linearVelocity,F=L.x,D=L.y,E=L.z,k=F*C[0]+D*C[3]+E*C[6],j=F*C[1]+D*C[4]+E*C[7],V=F*C[2]+D*C[5]+E*C[8],G=o.x,W=o.y,Y=o.z;b=32*((b=G*C[0]+W*C[3]+Y*C[6])-k)*e,v=32*((v=G*C[1]+W*C[4]+Y*C[7])-j)*e,x=32*((x=G*C[2]+W*C[5]+Y*C[8])-V)*e,a.localWalkForce.x=b,a.localWalkForce.y=v,a.localWalkForce.z=x,o.x=b*C[0]+v*C[1]+x*C[2],o.y=b*C[3]+v*C[4]+x*C[5],o.z=b*C[6]+v*C[7]+x*C[8],L.addEqual(o)}},z161}(z767),t.z161=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1023(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1023,t),z1023.prototype.test=function(t){return t.currentObject.hasEnterNode},z1023}(z770),e.z1023=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1020(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1020,t),z1020.prototype.test=function(t){if(!t.currentObject.getDirection)return!0;var e=z770.tempVecs[0],o=z770.tempVecs[1],i=t.physics,n=t.physics.frontBody.rotationElements,s=t.targets.moveToTarget,a=t.targets.targetDir;if((o.x=n[2],o.y=n[5],o.z=n[8],.8<o.dot(a))&&(n=t.physics.middleBody.rotationElements,o.x=n[2],o.y=n[5],o.z=n[8],t.currentObject.getDirection(e,i.middleBody.body.position,s,i.middleBody.body.shapes.radius),.5<o.dot(e)))return n=t.physics.rearBody.rotationElements,o.x=n[2],o.y=n[5],o.z=n[8],t.currentObject.getDirection(e,i.rearBody.body.position,s,i.rearBody.body.shapes.radius),!0;return!1},z1020}(z770),e.z1020=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z999(){return null!==t&&t.apply(this,arguments)||this}return __extends(z999,t),z999.prototype.test=function(t){var e=t.path[t.pathIndex];if(e){var o=e.data.obj,i=t.physics.frontBody.body.position;return!(!o.isInTube||!o.isInTube(i.x,i.y,i.z))}},z999}(z770),e.z999=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z968(){return null!==t&&t.apply(this,arguments)||this}return __extends(z968,t),z968.prototype.test=function(t){var e=t.path[t.pathIndex];if(!e)return!1;var o=e.data.obj;if(!o.isInTube)return!1;var i=3*t.size,n=t.getClosestz1061(0,2,i*i);return!(!n||n.currentObject!=o)},z968}(z770),e.z968=o}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z962(){return null!==t&&t.apply(this,arguments)||this}return __extends(z962,t),z962.prototype.test=function(t){return!(!t.currentObject||t.currentObject.accType!=e.z1044.z1051)},z962}(z770),t.z962=o}(z0||(z0={})),function(n){var t,e;t=n.z768||(n.z768={}),e=function(t){function z948(){return null!==t&&t.apply(this,arguments)||this}return __extends(z948,t),z948.prototype.test=function(t){var e=t.path[t.pathIndex],o=t.path[t.pathIndex+1],i=t.path[t.pathIndex+2];return!!(e&&e.data.obj&&e.data.obj.accType==n.z1044.z1051&&e.data.obj.hasEnterNode)||(!!(o&&o.data.obj&&o.data.obj.accType==n.z1044.z1051&&o.data.obj.hasEnterNode)||!!(i&&i.data.obj&&i.data.obj.accType==n.z1044.z1051&&i.data.obj.hasEnterNode))},z948}(z770),t.z948=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z945(){return null!==t&&t.apply(this,arguments)||this}return __extends(z945,t),z945.prototype.test=function(t){var e=t.currentObject;if(!e.isInTube)return!1;for(var o=e.nodes,i=t.physics.frontBody.body.position,n=t.physics.rearBody.body.position,s=0;s<o.length;s++){var a=o[s];if(a.data.enterTarget){var r=i.x-a.x,c=i.y-a.y,d=i.z-a.z,p=r*r+c*c+d*d,l=n.x-a.x,u=n.y-a.y,y=n.z-a.z;if(p<l*l+u*u+y*y)return!0}}return!1},z945}(z770),e.z945=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z922(){return null!==t&&t.apply(this,arguments)||this}return __extends(z922,t),z922.prototype.test=function(t){var e=t.path[t.pathIndex+1];if(!e)return!0;var o=t.physics.frontBody.body.position,i=t.physics.headBody.body.position,n=o,s=n.x-e.x,a=n.y-e.y,r=n.z-e.z,c=s*s+a*a+r*r;return(s=(n=i).x-e.x)*s+(a=n.y-e.y)*a+(r=n.z-e.z)*r<c},z922}(z770),e.z922=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z915(){return null!==t&&t.apply(this,arguments)||this}return __extends(z915,t),z915.prototype.test=function(t){var e=t.path[t.pathIndex];if(e){var o=e.data.outDir;if(o){var i=e.data.connector;if(i){var n=z770.z4[2];return n.x=t.position.x-i.position.x,n.y=t.position.y-i.position.y,n.z=t.position.z-i.position.z,0<BABYLON.Vector3.Dot(o,n)}}}},z915}(z770),e.z915=o}(z0||(z0={})),function(n){var t,e;t=n.z768||(n.z768={}),e=function(t){function z912(){return null!==t&&t.apply(this,arguments)||this}return __extends(z912,t),z912.prototype.test=function(t){if(0<(t.physics.touchingAccTypes&n.z1044.z1051))for(var e=t.physics.frontBody.body.position,o=0;o<t.physics.touchingShapes.length;o++){var i=t.physics.touchingShapes.data.data[o];if(i&&i.entity&&i.entity.accType==n.z1044.z1051&&i.entity.isInTube(e.x,e.y,e.z))return!0}return!1},z912}(z770),t.z912=e}(z0||(z0={})),function(p){var t,e;t=p.z768||(p.z768={}),e=function(t){function z890(){return null!==t&&t.apply(this,arguments)||this}return __extends(z890,t),z890.prototype.test=function(t){var e=t.path[t.pathIndex];if(e){var o=e.data.obj;if(o.accType==p.z1044.z1051)for(var i=p.z1062.activeObjects,n=t.physics.headBody.body.position,s=0;s<i.length;s++){var a=i[s];if(a!=t&&a.currentObject==o){var r=a.physics.frontBody.body.position,c=z1.distanceSquared(r,n);if(.66*.66<c)continue;var d=a.physics.rearBody.body.position;if(c<z1.distanceSquared(d,n))return!0}}}},z890}(z770),t.z890=e}(z0||(z0={})),function(i){var t,e;t=i.z768||(i.z768={}),e=function(t){function z876(){return null!==t&&t.apply(this,arguments)||this}return __extends(z876,t),z876.prototype.test=function(t){var e=t.path[t.pathIndex];if(e){var o=e.data.obj;if(o&&o.accType==i.z1044.z1051)return!0}return!1},z876}(z770),t.z876=e}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z869(){return null!==t&&t.apply(this,arguments)||this}return __extends(z869,t),z869.prototype.test=function(t,e){return!(!t.rearObject||t.rearObject.accType!=o.z1044.z1051)},z869}(z770),t.z869=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z821(){return null!==t&&t.apply(this,arguments)||this}return __extends(z821,t),z821.prototype.test=function(t){return!t.currentObject||!t.currentObject.isInTube},z821}(z770),e.z821=o}(z0||(z0={})),function(a){var t,e;t=a.z768||(a.z768={}),e=function(t){function z791(){return null!==t&&t.apply(this,arguments)||this}return __extends(z791,t),z791.prototype.test=function(t){if(t.currentObject&&t.currentObject.accType==a.z1044.z1051){var e=t.path[t.pathIndex];if(!e)return;var o=t.physics.frontBody.body.position,i=e.data,n=t.physics.rearBody.body.position;if(i.obj2&&i.obj2.accType==a.z1044.z1049)if(i.obj2.position.y>t.position.y&&n.y<o.y){var s=t.path[t.pathIndex-1];if(s&&s.data.enterEvent&&s.data.tube==t.currentObject)return!0}return!1}return!0},z791}(z770),t.z791=e}(z0||(z0={})),function(s){var t,e;t=s.z768||(s.z768={}),e=function(t){function z783(){return null!==t&&t.apply(this,arguments)||this}return __extends(z783,t),z783.prototype.test=function(t){if(!t.isFollowingPath())return!1;var e=t.physics.frontBody.body.position,o=t.physics.rearBody.body.position,i=t.path[t.pathIndex];if(!i)return!1;if(z1.distanceSquared(e,i)<z1.distanceSquared(o,i))return!1;var n=t.path[t.pathIndex].data;if(n.obj.accType==s.z1044.z1051)return!0;o=t.physics.rearBody.body.position;if(n.obj2&&n.obj2.accType==s.z1044.z1049&&(n.obj2.position.y>t.position.y&&o.y<e.y))return!1;if(n.obj.accType==s.z1044.z1048&&(n.obj.position.y>t.position.y&&o.y<e.y))return!1;return!0},z783}(z770),t.z783=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z781(){return null!==t&&t.apply(this,arguments)||this}return __extends(z781,t),z781.prototype.test=function(t){var e=t.physics,o=z770.tempVecs[0],i=t.targets.targetDir,n=e.frontBody.rotationElements;return o.x=n[2],o.y=n[5],o.z=n[8],!(o.dot(i)<-.5)},z781}(z770),e.z781=o}(z0||(z0={})),OIMO.CrossTubeShape=function(t,e,o,i){OIMO.Shape.call(this,t),this.innerRadius=i||0,this.radius=e,this.height=o,this.halfHeight=.5*o,this.elements=new OIMO_ARRAY_TYPE(24),this.type=OIMO.SHAPE_CROSS_z1051,this.topConnected=!1,this.botConnected=!1,this.rightConnected=!1,this.leftConnected=!1,this.topCovered=!1,this.botCovered=!1,this.rightCovered=!1,this.leftCovered=!1},OIMO.CrossTubeShape.prototype=Object.create(OIMO.Shape.prototype),OIMO.CrossTubeShape.prototype.calculateMassInfo=function(t){var e=this.innerRadius,o=this.radius,h=this.height,i=Math.PI*o*o*h,n=Math.PI*e*e*h,s=this.density*(i-n),a=s/12*(3*(o*o+e*e)+h*h),r=.5*s*(o*o+e*e);t.mass=s,t.inertia.init(a,0,0,0,a,0,0,0,r)},OIMO.CrossTubeShape.prototype.updateProxy=function(){this.rotation.elements;var t=this.position.x,e=this.position.y,o=this.position.z,i=t-.5,n=t+.5,s=e-.5,a=e+.5,r=o-.5,c=o+.5;this.aabb.init(i-.005,n+.005,s-.005,a+.005,r-.005,c+.005),null!==this.proxy&&this.proxy.update()},OIMO.CrossTubeSphereCollisionDetector=function(t){OIMO.CollisionDetector.call(this),this.flip=t},OIMO.CrossTubeSphereCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype),OIMO.CrossTubeSphereCollisionDetector.prototype.detectCollision=function(t,e,o){var i,n;this.flip?(i=e,n=t):(i=t,n=e);var s,a=n.radius,r=i.radius,c=i.innerRadius,d=i.halfHeight,p=i.position,l=n.position,u=l.x-p.x,y=l.y-p.y,g=l.z-p.z,m=i.rotation.elements,f=u*m[0]+y*m[3]+g*m[6],A=u*m[1]+y*m[4]+g*m[7],b=u*m[2]+y*m[5]+g*m[8];n.actor&&n.actor.stayInsideBodyType==OIMO.SHAPE_z1051&&(s=!0);var v=!1,x=f;if(f<0&&(x*=-1),s&&(i.topCovered&&d-a<A||i.botCovered&&A<-(d-a))&&(M=-1,L=d,A<(F=R=I=P=0)&&(L*=-1,M*=-1),N=d-(j+a),D=P*m[0]+M*m[1]+I*m[2],E=P*m[3]+M*m[4]+I*m[5],k=P*m[6]+M*m[7]+I*m[8],z=R*m[0]+L*m[1]+F*m[2],w=R*m[3]+L*m[4]+F*m[5],_=R*m[6]+L*m[7]+F*m[8],z+=p.x,w+=p.y,_+=p.z,i.pubsub&&i.pubsub.broadcast("hit",z,w,_,D,E,k,N,i,n),o.addPoint(z,w,_,D,E,k,N,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,z,w,_,D,E,k,N,i),v=!0),s&&(i.rightCovered&&d-a<f||i.leftCovered&&f<-(d-a))&&(P=-1,R=d,f<(F=L=I=M=0)&&(R*=-1,P*=-1),N=d-(x+a),D=P*m[0]+M*m[1]+I*m[2],E=P*m[3]+M*m[4]+I*m[5],k=P*m[6]+M*m[7]+I*m[8],z=R*m[0]+L*m[1]+F*m[2],w=R*m[3]+L*m[4]+F*m[5],_=R*m[6]+L*m[7]+F*m[8],z+=p.x,w+=p.y,_+=p.z,i.pubsub&&i.pubsub.broadcast("hit",z,w,_,D,E,k,N,i,n),o.addPoint(z,w,_,D,E,k,N,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,z,w,_,D,E,k,N,i),v=!0),!(d<A-a||A+a<-d||d<f-a||f+a<-d)){var C=f*f+b*b,S=r+a,T=S*S,B=c-a,O=B*B;(x=f)<0&&(x*=-1);var P,M,I,N,z,w,_,R,L,F,D,E,k,j=A;j<0&&(j*=-1);var V,G,W,Y,U,X,Z=!1,q=!1,Q=c+.5*(r-c),J=Q*Q,K=c*c,$=!1;if(!(C<O)){C<K?q=!0:C<J?q=!0:T<C?Z=!0:j<d&&($=!0);var tt=A*A+b*b,et=!1,ot=!1,it=!1;if(tt<O)!0;else if(tt<K?et=!0:tt<J?et=!0:T<tt?ot=!0:x<d&&(it=!0),!Z||!ot)if($&&!et&&(I=b*(G=1/(V=Math.sqrt(C))),N=V-(r+a),D=(P=f*G)*m[M=0]+M*m[1]+I*m[2],E=P*m[3]+M*m[4]+I*m[5],k=P*m[6]+M*m[7]+I*m[8],L=A,F=I*r,z=(R=P*r)*m[0]+L*m[1]+F*m[2],w=R*m[3]+L*m[4]+F*m[5],_=R*m[6]+L*m[7]+F*m[8],z+=p.x,w+=p.y,_+=p.z,i.pubsub&&i.pubsub.broadcast("hit",z,w,_,D,E,k,N,i,n),o.addPoint(z,w,_,D,E,k,N,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,z,w,_,D,E,k,N,i)),it&&!q&&(M=A*(Y=1/(W=Math.sqrt(tt))),I=b*Y,N=W-(r+a),D=(P=0)*m[0]+M*m[1]+I*m[2],E=P*m[3]+M*m[4]+I*m[5],k=P*m[6]+M*m[7]+I*m[8],L=M*r,F=I*r,z=(R=f)*m[0]+L*m[1]+F*m[2],w=R*m[3]+L*m[4]+F*m[5],_=R*m[6]+L*m[7]+F*m[8],z+=p.x,w+=p.y,_+=p.z,i.pubsub&&i.pubsub.broadcast("hit",z,w,_,D,E,k,N,i,n),o.addPoint(z,w,_,D,E,k,N,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,z,w,_,D,E,k,N,i)),!v&&d<j&&(r*r<C||C<K)){if(0<A&&i.topConnected)return;if(A<0&&i.botConnected)return;if(L=d,A<0&&(L=-d),G=1/(V=Math.sqrt(C)),r<V?(R=f*G*r,F=b*G*r):(R=f*G*c,F=b*G*c),P=f-R,M=A-L,I=b-F,M*=X=1/(U=Math.sqrt(P*P+M*M+I*I)),I*=X,0<=(N=U-a))return;D=(P*=X)*m[0]+M*m[1]+I*m[2],E=P*m[3]+M*m[4]+I*m[5],k=P*m[6]+M*m[7]+I*m[8],z=R*m[0]+L*m[1]+F*m[2],w=R*m[3]+L*m[4]+F*m[5],_=R*m[6]+L*m[7]+F*m[8],z+=p.x,w+=p.y,_+=p.z,i.pubsub&&i.pubsub.broadcast("hit",z,w,_,D,E,k,N,i,n),o.addPoint(z,w,_,D,E,k,N,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,z,w,_,D,E,k,N,i)}else if(!v&&d<x&&(r*r<tt||tt<K)){if(0<f&&i.rightConnected)return;if(f<0&&i.leftConnected)return;if(R=d,u<0&&(R=-d),Y=1/(W=Math.sqrt(tt)),r<W?(L=A*Y*r,F=b*Y*r):(L=A*Y*c,F=b*Y*c),P=f-R,M=A-L,I=b-F,M*=X=1/(U=Math.sqrt(P*P+M*M+I*I)),I*=X,0<=(N=U-a))return;D=(P*=X)*m[0]+M*m[1]+I*m[2],E=P*m[3]+M*m[4]+I*m[5],k=P*m[6]+M*m[7]+I*m[8],z=R*m[0]+L*m[1]+F*m[2],w=R*m[3]+L*m[4]+F*m[5],_=R*m[6]+L*m[7]+F*m[8],z+=p.x,w+=p.y,_+=p.z,i.pubsub&&i.pubsub.broadcast("hit",z,w,_,D,E,k,N,i,n),o.addPoint(z,w,_,D,E,k,N,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,z,w,_,D,E,k,N,i)}else if(q&&et){R=f*(G=1/(V=Math.sqrt(C)))*c;var nt=b*G*c;P=f-R,M=A-(L=A*(Y=1/(W=Math.sqrt(tt)))*c),I=b-(F=.5*(nt+b*Y*c)),M*=X=1/(U=Math.sqrt(P*P+M*M+I*I)),I*=X,N=U-a,D=(P*=X)*m[0]+M*m[1]+I*m[2],E=P*m[3]+M*m[4]+I*m[5],k=P*m[6]+M*m[7]+I*m[8],z=R*m[0]+L*m[1]+F*m[2],w=R*m[3]+L*m[4]+F*m[5],_=R*m[6]+L*m[7]+F*m[8],z+=p.x,w+=p.y,_+=p.z,i.pubsub&&i.pubsub.broadcast("hit",z,w,_,D,E,k,N,i,n),o.addPoint(z,w,_,D,E,k,N,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,z,w,_,D,E,k,N,i)}else q&&!et&&j<d?(I=-b*(G=1/(V=Math.sqrt(C))),N=c-a-V,D=(P=-f*G)*m[M=0]+M*m[1]+I*m[2],E=P*m[3]+M*m[4]+I*m[5],k=P*m[6]+M*m[7]+I*m[8],L=A,F=-I*c,z=(R=-P*c)*m[0]+L*m[1]+F*m[2],w=R*m[3]+L*m[4]+F*m[5],_=R*m[6]+L*m[7]+F*m[8],z+=p.x,w+=p.y,_+=p.z,i.pubsub&&i.pubsub.broadcast("hit",z,w,_,D,E,k,N,i,n),o.addPoint(z,w,_,D,E,k,N,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,z,w,_,D,E,k,N,i)):!q&&et&&x<d?(M=-A*(Y=1/(W=Math.sqrt(tt))),I=-b*Y,N=c-a-W,D=(P=0)*m[0]+M*m[1]+I*m[2],E=P*m[3]+M*m[4]+I*m[5],k=P*m[6]+M*m[7]+I*m[8],L=-M*r,F=-I*r,z=(R=f)*m[0]+L*m[1]+F*m[2],w=R*m[3]+L*m[4]+F*m[5],_=R*m[6]+L*m[7]+F*m[8],z+=p.x,w+=p.y,_+=p.z,i.pubsub&&i.pubsub.broadcast("hit",z,w,_,D,E,k,N,i,n),o.addPoint(z,w,_,D,E,k,N,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,z,w,_,D,E,k,N,i)):!q&&A<-d?(M=-1,R=f,L=-d,F=b,N=-A-(d+a),D=(P=0)*m[I=0]+M*m[1]+I*m[2],E=P*m[3]+M*m[4]+I*m[5],k=P*m[6]+M*m[7]+I*m[8],z=R*m[0]+L*m[1]+F*m[2],w=R*m[3]+L*m[4]+F*m[5],_=R*m[6]+L*m[7]+F*m[8],z+=p.x,w+=p.y,_+=p.z,i.pubsub&&i.pubsub.broadcast("hit",z,w,_,D,E,k,N,i,n),o.addPoint(z,w,_,D,E,k,N,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,z,w,_,D,E,k,N,i)):!q&&d<A?(M=1,R=f,F=b,N=A-((L=d)+a),D=(P=0)*m[I=0]+M*m[1]+I*m[2],E=P*m[3]+M*m[4]+I*m[5],k=P*m[6]+M*m[7]+I*m[8],z=R*m[0]+L*m[1]+F*m[2],w=R*m[3]+L*m[4]+F*m[5],_=R*m[6]+L*m[7]+F*m[8],z+=p.x,w+=p.y,_+=p.z,i.pubsub&&i.pubsub.broadcast("hit",z,w,_,D,E,k,N,i,n),o.addPoint(z,w,_,D,E,k,N,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,z,w,_,D,E,k,N,i)):!et&&d<f?(L=A,F=b,N=f-((R=d)+a),D=(P=1)*m[I=M=0]+M*m[1]+I*m[2],E=P*m[3]+M*m[4]+I*m[5],k=P*m[6]+M*m[7]+I*m[8],z=R*m[0]+L*m[1]+F*m[2],w=R*m[3]+L*m[4]+F*m[5],_=R*m[6]+L*m[7]+F*m[8],z+=p.x,w+=p.y,_+=p.z,i.pubsub&&i.pubsub.broadcast("hit",z,w,_,D,E,k,N,i,n),o.addPoint(z,w,_,D,E,k,N,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,z,w,_,D,E,k,N,i)):!et&&f<-d&&(R=-d,L=A,F=b,N=-f-(d+a),D=(P=-1)*m[I=M=0]+M*m[1]+I*m[2],E=P*m[3]+M*m[4]+I*m[5],k=P*m[6]+M*m[7]+I*m[8],z=R*m[0]+L*m[1]+F*m[2],w=R*m[3]+L*m[4]+F*m[5],_=R*m[6]+L*m[7]+F*m[8],z+=p.x,w+=p.y,_+=p.z,i.pubsub&&i.pubsub.broadcast("hit",z,w,_,D,E,k,N,i,n),o.addPoint(z,w,_,D,E,k,N,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,z,w,_,D,E,k,N,i))}}},OIMO.CurvedTubeShape=function(t,e,o,i){OIMO.Shape.call(this,t),this.innerRadius=i||0,this.radius=e,this.curveRadius=o,this.elements=new OIMO_ARRAY_TYPE(24),this.type=OIMO.SHAPE_CURVED_z1051,this.topConnected=!1,this.leftConnected=!1,this.topCovered=!1,this.leftCovered=!1},OIMO.CurvedTubeShape.prototype=Object.create(OIMO.Shape.prototype),OIMO.CurvedTubeShape.prototype.calculateMassInfo=function(t){var e=this.innerRadius,o=this.radius,h=this.curveRadius,i=Math.PI*o*o*h,n=Math.PI*e*e*h,s=this.density*(i-n),a=s/12*(3*(o*o+e*e)+h*h),r=.5*s*(o*o+e*e);t.mass=s,t.inertia.init(a,0,0,0,a,0,0,0,r)},OIMO.CurvedTubeShape.prototype.updateProxy=function(){this.rotation.elements,this.radius;var t=this.curveRadius,e=this.position.x,o=this.position.y,i=this.position.z,n=.5;1<t&&(n=1);var s=e-n,a=e+n,r=o-n,c=o+n,d=i-n,p=i+n;this.aabb.init(s-.005,a+.005,r-.005,c+.005,d-.005,p+.005),null!==this.proxy&&this.proxy.update()},OIMO.CurvedTubeSphereCollisionDetector=function(t){OIMO.CollisionDetector.call(this),this.flip=t},OIMO.CurvedTubeSphereCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype),OIMO.CurvedTubeSphereCollisionDetector.prototype.tempVec1=new OIMO.Vec3,OIMO.CurvedTubeSphereCollisionDetector.prototype.tempVec2=new OIMO.Vec3,OIMO.CurvedTubeSphereCollisionDetector.prototype.tempVec3=new OIMO.Vec3,OIMO.CurvedTubeSphereCollisionDetector.prototype.detectCollision=function(t,e,o){var i,n;this.flip?(i=e,n=t):(i=t,n=e);var s=!1;n.actor&&n.actor.stayInsideBodyType==OIMO.SHAPE_z1051&&(s=!0);var a=n.radius,r=i.radius,c=i.innerRadius,d=c+.5*(r-c),p=i.curveRadius,l=.5;1<p&&(l=1);var u=-l,y=l,g=i.position,m=n.position,f=g.x,A=g.y,b=g.z,v=m.x-f,x=m.y-A,C=m.z-b,S=i.rotation.elements,T=v*S[0]+x*S[3]+C*S[6],B=v*S[1]+x*S[4]+C*S[7],O=v*S[2]+x*S[5]+C*S[8],P=l,M=!1,I=T,N=B;T<0&&(I*=-1),B<0&&(N*=-1);var z=T- -l,w=B-l,_=O,R=z*z+w*w,L=p-r-a,F=p+r+a;if(1<p){if(F*F<R)return;if(R<L*L)return}if(s&&(i.topCovered&&P-a<B||i.botCovered&&B<-(P-a))&&(X=-1,W=P,B<(Y=G=Z=U=0)&&(W*=-1,X=1),q=P-(N+a),z=U*S[0]+X*S[1]+Z*S[2],w=U*S[3]+X*S[4]+Z*S[5],_=U*S[6]+X*S[7]+Z*S[8],k=G*S[0]+W*S[1]+Y*S[2],j=G*S[3]+W*S[4]+Y*S[5],V=G*S[6]+W*S[7]+Y*S[8],k+=g.x,j+=g.y,V+=g.z,i.pubsub&&i.pubsub.broadcast("hit",k,j,V,z,w,_,q,i,n),o.addPoint(k,j,V,z,w,_,q,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,k,j,V,z,w,_,q,i),M=!0),s&&(i.rightCovered&&P-a<T||i.leftCovered&&T<-(P-a))&&(U=-1,G=P,T<(Y=W=Z=X=0)&&(G*=-1,U=1),q=P-(I+a),z=U*S[0]+X*S[1]+Z*S[2],w=U*S[3]+X*S[4]+Z*S[5],_=U*S[6]+X*S[7]+Z*S[8],k=G*S[0]+W*S[1]+Y*S[2],j=G*S[3]+W*S[4]+Y*S[5],V=G*S[6]+W*S[7]+Y*S[8],k+=g.x,j+=g.y,V+=g.z,i.pubsub&&i.pubsub.broadcast("hit",k,j,V,z,w,_,q,i,n),o.addPoint(k,j,V,z,w,_,q,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,k,j,V,z,w,_,q,i),M=!0),!(T<-l-a||l+a<B)){if(!s){if(p<1){if(F*F<R)return;if(R<L*L)return}if(_<-r-a)return;if(r+a<_)return}var D,E,k,j,V,G,W,Y,U,X,Z,q,Q,J,K,$,tt=T-(p-l),et=B+(p-l),ot=tt*tt+O*O,it=et*et+O*O,nt=c-a,st=r+a,at=nt*nt,rt=st*st;if(T<u&&s&&rt<it){if(W=et,Y=O,(Z=X=0)<=(q=-(G=u)-(tt+a)))return;return z=(U=-1)*S[0]+X*S[1]+Z*S[2],w=U*S[3]+X*S[4]+Z*S[5],_=U*S[6]+X*S[7]+Z*S[8],k=G*S[0]+W*S[1]+Y*S[2],j=G*S[3]+W*S[4]+Y*S[5],V=G*S[6]+W*S[7]+Y*S[8],k+=g.x,j+=g.y,V+=g.z,i.pubsub&&i.pubsub.broadcast("hit",k,j,V,z,w,_,q,i,n),o.addPoint(k,j,V,z,w,_,q,this.flip),void(n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,k,j,V,z,w,_,q,i))}if(y<B&&s&&rt<ot){if(X=1,Y=O,(Z=U=0)<=(q=(G=tt)+a-(W=y)))return;return z=U*S[0]+X*S[1]+Z*S[2],w=U*S[3]+X*S[4]+Z*S[5],_=U*S[6]+X*S[7]+Z*S[8],k=G*S[0]+W*S[1]+Y*S[2],j=G*S[3]+W*S[4]+Y*S[5],V=G*S[6]+W*S[7]+Y*S[8],k+=g.x,j+=g.y,V+=g.z,i.pubsub&&i.pubsub.broadcast("hit",k,j,V,z,w,_,q,i,n),o.addPoint(k,j,V,z,w,_,q,this.flip),void(n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,k,j,V,z,w,_,q,i))}if(T<u&&!M){if(i.leftConnected)return;if(it<at)return;if(!s&&rt<it)return;if(J=1/(Q=Math.sqrt(it)),r<Q?(W=et*J*r+(B-et),Y=O*J*r):(W=et*J*c+(B-et),Y=O*J*c),U=T-(G=u),X=B-W,Z=O-Y,X*=E=1/(D=Math.sqrt(U*U+X*X+Z*Z)),Z*=E,0<=(q=D-a))return;return z=(U*=E)*S[0]+X*S[1]+Z*S[2],w=U*S[3]+X*S[4]+Z*S[5],_=U*S[6]+X*S[7]+Z*S[8],k=G*S[0]+W*S[1]+Y*S[2],j=G*S[3]+W*S[4]+Y*S[5],V=G*S[6]+W*S[7]+Y*S[8],k+=g.x,j+=g.y,V+=g.z,i.pubsub&&i.pubsub.broadcast("hit",k,j,V,z,w,_,q,i,n),o.addPoint(k,j,V,z,w,_,q,this.flip),void(n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,k,j,V,z,w,_,q,i))}if(y<B&&!M){if(i.topConnected)return;if(ot<at)return;if(!s&&rt<ot)return;if($=1/(K=Math.sqrt(ot)),r<K?(G=tt*$*r+(T-tt),Y=O*$*r):(G=tt*$*c+(T-tt),Y=O*$*c),U=T-G,X=B-(W=y),Z=O-Y,X*=E=1/(D=Math.sqrt(U*U+X*X+Z*Z)),Z*=E,0<=(q=D-a))return;return z=(U*=E)*S[0]+X*S[1]+Z*S[2],w=U*S[3]+X*S[4]+Z*S[5],_=U*S[6]+X*S[7]+Z*S[8],k=G*S[0]+W*S[1]+Y*S[2],j=G*S[3]+W*S[4]+Y*S[5],V=G*S[6]+W*S[7]+Y*S[8],k+=g.x,j+=g.y,V+=g.z,i.pubsub&&i.pubsub.broadcast("hit",k,j,V,z,w,_,q,i,n),o.addPoint(k,j,V,z,w,_,q,this.flip),void(n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,k,j,V,z,w,_,q,i))}var ht=1/Math.sqrt(R),ct=z*ht,dt=w*ht,pt=this.tempVec1,lt=this.tempVec2,ut=this.tempVec3;lt.x=0,lt.y=0,lt.z=1,ut.x=-ct,ut.y=-dt,ut.z=0,pt.cross(lt,ut);var yt=u+p*ct,gt=y+p*dt,mt=(N=B-gt,O-0),ft=(I=T-yt)*pt.x+N*pt.y+mt*pt.z,At=I*lt.x+N*lt.y+mt*lt.z,bt=I*ut.x+N*ut.y+mt*ut.z;U=0;var vt=c-a;if(!((it=At*At+bt*bt)<vt*vt)){J=1/(Q=Math.sqrt(it));var xt=!1;n.actor&&n.actor.stayInsideBody==i.parent&&(xt=!0),Q<d||xt?(G=ft,W=-(X=-At*J)*c,Y=-(Z=-bt*J)*c,q=c-(Q+a)):(G=ft,W=(X=At*J)*r,Y=(Z=bt*J)*r,q=Q-(r+a)),0<=q||(z=U*pt.x+X*lt.x+Z*ut.x,w=U*pt.y+X*lt.y+Z*ut.y,_=U*pt.z+X*lt.z+Z*ut.z,X=w,Z=_,z=(U=z)*S[0]+X*S[1]+Z*S[2],w=U*S[3]+X*S[4]+Z*S[5],_=U*S[6]+X*S[7]+Z*S[8],k=G*pt.x+W*lt.x+Y*ut.x,j=G*pt.y+W*lt.y+Y*ut.y,V=G*pt.z+W*lt.z+Y*ut.z,W=j+=gt,Y=V+=0,k=(G=k+=yt)*S[0]+W*S[1]+Y*S[2],j=G*S[3]+W*S[4]+Y*S[5],V=G*S[6]+W*S[7]+Y*S[8],k+=g.x,j+=g.y,V+=g.z,i.pubsub&&i.pubsub.broadcast("hit",k,j,V,z,w,_,q,i,n),o.addPoint(k,j,V,z,w,_,q,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,k,j,V,z,w,_,q,i))}}},OIMO.TeeTubeShape=function(t,e,o,i){OIMO.Shape.call(this,t),this.innerRadius=i||0,this.radius=e,this.height=o,this.halfHeight=.5*o,this.elements=new OIMO_ARRAY_TYPE(24),this.type=OIMO.SHAPE_TEE_z1051,this.topConnected=!1,this.botConnected=!1,this.rightConnected=!1,this.topCovered=!1,this.botCovered=!1,this.rightCovered=!1},OIMO.TeeTubeShape.prototype=Object.create(OIMO.Shape.prototype),OIMO.TeeTubeShape.prototype.calculateMassInfo=function(t){var e=this.innerRadius,o=this.radius,h=this.height,i=Math.PI*o*o*h,n=Math.PI*e*e*h,s=this.density*(i-n),a=s/12*(3*(o*o+e*e)+h*h),r=.5*s*(o*o+e*e);t.mass=s,t.inertia.init(a,0,0,0,a,0,0,0,r)},OIMO.TeeTubeShape.prototype.updateProxy=function(){var t=this.rotation.elements,e=this.radius,o=this.position.x,i=this.position.y,n=this.position.z,s=this.halfHeight,a=s,r=-s,c=s,d=a*t[1]+o,p=a*t[4]+i,l=a*t[7]+n,u=r*t[1]+o,y=r*t[4]+i,g=r*t[7]+n,m=c*t[0]+o,f=c*t[3]+i,A=c*t[6]+n,b=u,v=d,x=y,C=p,S=g,T=l;d<u&&(b=d,v=u),p<y&&(x=p,C=y),l<g&&(S=l,T=g),m<b?b=m:v<m&&(v=m),f<x?x=f:C<f&&(C=f),A<T?S=A:T<A&&(T=A);var B=.005+e;this.aabb.init(b-B,v+B,x-B,C+B,S-B,T+B),null!==this.proxy&&this.proxy.update()},OIMO.TeeTubeSphereCollisionDetector=function(t){OIMO.CollisionDetector.call(this),this.flip=t},OIMO.TeeTubeSphereCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype),OIMO.TeeTubeSphereCollisionDetector.prototype.detectCollision=function(t,e,o){var i,n;this.flip?(i=e,n=t):(i=t,n=e);var s=n.radius,a=i.radius,r=i.innerRadius,c=i.halfHeight,d=i.position,p=n.position;n.id;var l=p.x-d.x,u=p.y-d.y,y=p.z-d.z,g=i.rotation.elements,m=l*g[0]+u*g[3]+y*g[6],f=l*g[1]+u*g[4]+y*g[7],A=l*g[2]+u*g[5]+y*g[8];n.actor&&n.actor.stayInsideBodyType==OIMO.SHAPE_z1051&&(x=!0);var b=!1,v=m;if(m<0&&(v*=-1),x&&(i.topCovered&&c-s<f||i.botCovered&&f<-(c-s))&&(T=-1,z=c,f<(w=N=B=S=0)&&(z*=-1,T*=-1),O=c-(j+s),_=S*g[0]+T*g[1]+B*g[2],R=S*g[3]+T*g[4]+B*g[5],L=S*g[6]+T*g[7]+B*g[8],P=N*g[0]+z*g[1]+w*g[2],M=N*g[3]+z*g[4]+w*g[5],I=N*g[6]+z*g[7]+w*g[8],P+=d.x,M+=d.y,I+=d.z,i.pubsub&&i.pubsub.broadcast("hit",P,M,I,_,R,L,O,i,n),o.addPoint(P,M,I,_,R,L,O,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,P,M,I,_,R,L,O,i),b=!0),x&&(i.rightCovered&&c-s<m||i.leftCovered&&m<-(c-s))&&(S=-1,N=c,m<(w=z=B=T=0)&&(N*=-1,S*=-1),O=c-(v+s),_=S*g[0]+T*g[1]+B*g[2],R=S*g[3]+T*g[4]+B*g[5],L=S*g[6]+T*g[7]+B*g[8],P=N*g[0]+z*g[1]+w*g[2],M=N*g[3]+z*g[4]+w*g[5],I=N*g[6]+z*g[7]+w*g[8],P+=d.x,M+=d.y,I+=d.z,i.pubsub&&i.pubsub.broadcast("hit",P,M,I,_,R,L,O,i,n),o.addPoint(P,M,I,_,R,L,O,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,P,M,I,_,R,L,O,i),b=!0),!(c<f-s||f+s<-c||c<m-s)){var x,C=m*m+A*A;n.actor&&n.actor.stayInsideBodyType==OIMO.SHAPE_z1051&&(x=!0);var S,T,B,O,P,M,I,N,z,w,_,R,L,F=a+s,D=F*F,E=r-s,k=E*E,j=f;j<0&&(j*=-1);var V,G,W,Y,U,X,Z=!1,q=!1,Q=r+.5*(a-r),J=Q*Q,K=r*r,$=!1;if(!(C<k)){C<K?q=!0:C<J?q=!0:D<C?Z=!0:j<c&&($=!0);var tt=f*f+A*A,et=!1,ot=!1,it=!1;if(tt<k){if(!0,0<m)return}else tt<K?et=!0:tt<J?et=!0:D<tt?ot=!0:0<m&&m<c&&(it=!0);if(j<c&&m<c&&(!x||q||et||(C<tt?q=!0:et=!0,ot=Z=!1)),!Z||!ot){if(q&&et){var nt=s/.667457216;Math.abs(f)>Math.abs(m)+nt&&(et=!1),Math.abs(m)>Math.abs(f)+nt&&(q=!1)}if($&&!et&&(B=A*(G=1/(V=Math.sqrt(C))),O=V-(a+s),_=(S=m*G)*g[T=0]+T*g[1]+B*g[2],R=S*g[3]+T*g[4]+B*g[5],L=S*g[6]+T*g[7]+B*g[8],z=f,w=B*a,P=(N=S*a)*g[0]+z*g[1]+w*g[2],M=N*g[3]+z*g[4]+w*g[5],I=N*g[6]+z*g[7]+w*g[8],P+=d.x,M+=d.y,I+=d.z,i.pubsub&&i.pubsub.broadcast("hit",P,M,I,_,R,L,O,i,n),o.addPoint(P,M,I,_,R,L,O,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,P,M,I,_,R,L,O,i),q&&et&&(Math.abs(f),Math.abs(m))),it&&!q&&(T=f*(Y=1/(W=Math.sqrt(tt))),B=A*Y,O=W-(a+s),_=(S=0)*g[0]+T*g[1]+B*g[2],R=S*g[3]+T*g[4]+B*g[5],L=S*g[6]+T*g[7]+B*g[8],z=T*a,w=B*a,P=(N=m)*g[0]+z*g[1]+w*g[2],M=N*g[3]+z*g[4]+w*g[5],I=N*g[6]+z*g[7]+w*g[8],P+=d.x,M+=d.y,I+=d.z,i.pubsub&&i.pubsub.broadcast("hit",P,M,I,_,R,L,O,i,n),o.addPoint(P,M,I,_,R,L,O,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,P,M,I,_,R,L,O,i),q&&et&&(Math.abs(m),Math.abs(f))),!b&&c<j&&(a*a<C||C<K)){if(0<f&&i.topConnected)return;if(f<0&&i.botConnected)return;if(z=c,f<0&&(z=-c),G=1/(V=Math.sqrt(C)),a<V?(N=m*G*a,w=A*G*a):(N=m*G*r,w=A*G*r),S=m-N,T=f-z,B=A-w,T*=X=1/(U=Math.sqrt(S*S+T*T+B*B)),B*=X,0<=(O=U-s))return;_=(S*=X)*g[0]+T*g[1]+B*g[2],R=S*g[3]+T*g[4]+B*g[5],L=S*g[6]+T*g[7]+B*g[8],P=N*g[0]+z*g[1]+w*g[2],M=N*g[3]+z*g[4]+w*g[5],I=N*g[6]+z*g[7]+w*g[8],P+=d.x,M+=d.y,I+=d.z,i.pubsub&&i.pubsub.broadcast("hit",P,M,I,_,R,L,O,i,n),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,P,M,I,_,R,L,O,i),o.addPoint(P,M,I,_,R,L,O,this.flip)}if(!b&&c<m&&(a*a<tt||tt<K)){if(i.rightConnected)return;if(Y=1/(W=Math.sqrt(tt)),a<W?(z=f*Y*a,w=A*Y*a):(z=f*Y*r,w=A*Y*r),S=m-(N=c),T=f-z,B=A-w,T*=X=1/(U=Math.sqrt(S*S+T*T+B*B)),B*=X,0<=(O=U-s))return;_=(S*=X)*g[0]+T*g[1]+B*g[2],R=S*g[3]+T*g[4]+B*g[5],L=S*g[6]+T*g[7]+B*g[8],P=N*g[0]+z*g[1]+w*g[2],M=N*g[3]+z*g[4]+w*g[5],I=N*g[6]+z*g[7]+w*g[8],P+=d.x,M+=d.y,I+=d.z,i.pubsub&&i.pubsub.broadcast("hit",P,M,I,_,R,L,O,i,n),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,P,M,I,_,R,L,O,i),o.addPoint(P,M,I,_,R,L,O,this.flip)}else if(q&&et&&0<m){N=m*(G=1/(V=Math.sqrt(C)))*r;var st=A*G*r;if(z=f*(Y=1/(W=Math.sqrt(tt)))*r,w=.5*(st+A*Y*r),S=m-(N=N<0?-Math.sqrt(K-w*w):Math.sqrt(K-w*w)),T=f-(z=z<0?-Math.abs(N):Math.abs(N)),B=A-w,T*=X=1/(U=Math.sqrt(S*S+T*T+B*B)),B*=X,0<=(O=U-s))return;_=(S*=X)*g[0]+T*g[1]+B*g[2],R=S*g[3]+T*g[4]+B*g[5],L=S*g[6]+T*g[7]+B*g[8],P=N*g[0]+z*g[1]+w*g[2],M=N*g[3]+z*g[4]+w*g[5],I=N*g[6]+z*g[7]+w*g[8],P+=d.x,M+=d.y,I+=d.z,i.pubsub&&i.pubsub.broadcast("hit",P,M,I,_,R,L,O,i,n),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,P,M,I,_,R,L,O,i),o.addPoint(P,M,I,_,R,L,O,this.flip)}else if(q&&j<c){if(n.id,B=-A*(G=1/(V=Math.sqrt(C))),(T=0)<=(O=r-s-V))return;_=(S=-m*G)*g[0]+T*g[1]+B*g[2],R=S*g[3]+T*g[4]+B*g[5],L=S*g[6]+T*g[7]+B*g[8],z=f,w=-B*r,P=(N=-S*r)*g[0]+z*g[1]+w*g[2],M=N*g[3]+z*g[4]+w*g[5],I=N*g[6]+z*g[7]+w*g[8],P+=d.x,M+=d.y,I+=d.z,i.pubsub&&i.pubsub.broadcast("hit",P,M,I,_,R,L,O,i,n),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,P,M,I,_,R,L,O,i),o.addPoint(P,M,I,_,R,L,O,this.flip)}else!q&&et&&0<m&&m<c?(T=-f*(Y=1/(W=Math.sqrt(tt))),B=-A*Y,O=r-s-W,_=(S=0)*g[0]+T*g[1]+B*g[2],R=S*g[3]+T*g[4]+B*g[5],L=S*g[6]+T*g[7]+B*g[8],z=-T*a,w=-B*a,P=(N=m)*g[0]+z*g[1]+w*g[2],M=N*g[3]+z*g[4]+w*g[5],I=N*g[6]+z*g[7]+w*g[8],P+=d.x,M+=d.y,I+=d.z,i.pubsub&&i.pubsub.broadcast("hit",P,M,I,_,R,L,O,i,n),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,P,M,I,_,R,L,O,i),o.addPoint(P,M,I,_,R,L,O,this.flip)):!q&&f<-c?(T=-1,N=m,z=-c,w=A,O=-f-(c+s),_=(S=0)*g[B=0]+T*g[1]+B*g[2],R=S*g[3]+T*g[4]+B*g[5],L=S*g[6]+T*g[7]+B*g[8],P=N*g[0]+z*g[1]+w*g[2],M=N*g[3]+z*g[4]+w*g[5],I=N*g[6]+z*g[7]+w*g[8],P+=d.x,M+=d.y,I+=d.z,i.pubsub&&i.pubsub.broadcast("hit",P,M,I,_,R,L,O,i,n),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,P,M,I,_,R,L,O,i),o.addPoint(P,M,I,_,R,L,O,this.flip)):!q&&c<f?(T=1,N=m,w=A,O=f-((z=c)+s),_=(S=0)*g[B=0]+T*g[1]+B*g[2],R=S*g[3]+T*g[4]+B*g[5],L=S*g[6]+T*g[7]+B*g[8],P=N*g[0]+z*g[1]+w*g[2],M=N*g[3]+z*g[4]+w*g[5],I=N*g[6]+z*g[7]+w*g[8],P+=d.x,M+=d.y,I+=d.z,i.pubsub&&i.pubsub.broadcast("hit",P,M,I,_,R,L,O,i,n),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,P,M,I,_,R,L,O,i),o.addPoint(P,M,I,_,R,L,O,this.flip)):!et&&c<m&&(z=f,w=A,O=m-((N=c)+s),_=(S=1)*g[B=T=0]+T*g[1]+B*g[2],R=S*g[3]+T*g[4]+B*g[5],L=S*g[6]+T*g[7]+B*g[8],P=N*g[0]+z*g[1]+w*g[2],M=N*g[3]+z*g[4]+w*g[5],I=N*g[6]+z*g[7]+w*g[8],P+=d.x,M+=d.y,I+=d.z,i.pubsub&&i.pubsub.broadcast("hit",P,M,I,_,R,L,O,i,n),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,P,M,I,_,R,L,O,i),o.addPoint(P,M,I,_,R,L,O,this.flip))}}}},OIMO.TubeShape=function(t,e,o,i){OIMO.Shape.call(this,t),this.innerRadius=i||0,this.radius=e,this.height=o,this.halfHeight=.5*o,this.elements=new OIMO_ARRAY_TYPE(24),this.type=OIMO.SHAPE_z1051,this.topConnected=!1,this.botConnected=!1,this.topCovered=!1,this.botCovered=!1,this.offsetCover=0,this.offsetHitBoxBottom=0},OIMO.TubeShape.prototype=Object.create(OIMO.Shape.prototype),OIMO.TubeShape.prototype.calculateMassInfo=function(t){var e=this.innerRadius,o=this.radius,h=this.height,i=Math.PI*o*o*h,n=Math.PI*e*e*h,s=this.density*(i-n),a=s/12*(3*(o*o+e*e)+h*h),r=.5*s*(o*o+e*e);t.mass=s,t.inertia.init(a,0,0,0,a,0,0,0,r)},OIMO.TubeShape.prototype.updateProxy=function(){var t=this.rotation.elements,e=this.radius,o=this.position.x,i=this.position.y,n=this.position.z,s=this.halfHeight,a=s,r=-s+this.offsetHitBoxBottom,c=a*t[1]+o,d=a*t[4]+i,p=a*t[7]+n,l=r*t[1]+o,u=r*t[4]+i,y=r*t[7]+n,g=l,m=c,f=u,A=d,b=y,v=p;c<l&&(g=c,m=l),d<u&&(f=d,A=u),p<y&&(b=p,v=y);var x=.005+e;g-=x,f-=x,b-=x,m+=x,A+=x,v+=x,null!=this.minY&&f<this.minY+i&&(f=this.minY+i),this.aabb.init(g,m,f,A,b,v),null!==this.proxy&&this.proxy.update()},OIMO.CylinderBoxCollisionDetector=function(t){OIMO.CollisionDetector.call(this),this.flip=t},OIMO.CylinderBoxCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype),OIMO.CylinderBoxCollisionDetector.prototype.tmpVec1=new OIMO.Vec3,OIMO.CylinderBoxCollisionDetector.prototype.tmpVec2=new OIMO.Vec3,OIMO.CylinderBoxCollisionDetector.prototype.tmpVec3=new OIMO.Vec3,OIMO.CylinderBoxCollisionDetector.prototype.quat=new OIMO.Quat,OIMO.CylinderBoxCollisionDetector.prototype.detectCollision=function(t,e,o){var i,n;this.flip?(i=e,n=t):(i=t,n=e);var s=n.position,a=s.x,r=s.y,c=s.z,d=i.position,p=d.x,l=d.y,u=d.z,y=(i.halfWidth,i.halfHeight),g=(i.halfDepth,n.radius),m=n.halfHeight,f=(n.rotation.elements,y);a-=p,r-=l,c-=u;i.rotation;var A=i.rotation.elements,b=a*A[0]+r*A[3]+c*A[6],v=a*A[1]+r*A[4]+c*A[7],x=a*A[2]+r*A[5]+c*A[8],C=this.tmpVec1,S=this.tmpVec2;S.set(0,1,0),S.mulMat(n.rotation,S);var T=S.x,B=S.y,O=S.z;S.x=T*A[0]+B*A[3]+O*A[6],S.y=T*A[1]+B*A[4]+O*A[7],S.z=T*A[2]+B*A[5]+O*A[8],C.set(0,1,0);var P=S.x*m+b,M=S.y*m+v,I=S.z*m+x,N=-(P-b)+b,z=-(M-v)+v,w=-(I-x)+x;if(M<z){var _=N;N=P,P=_,_=z,z=M,M=_,_=w,w=I,I=_}var R=this.tmpVec3;R.cross(C,S),R.cross(R,S),R.normalize(R),R.x*=g,R.y*=g,R.z*=g;var L,F,D,E,k,j,V,G,W,Y,U=R.x+N,X=R.y+z,Z=R.z+w,q=(R.x,-R.y+z),Q=(R.z,R.x+P),J=R.y+M,K=R.z+I;R.x,R.y,R.z;if(J<f)F=X,D=Z,E=p+(L=U)*A[0]+F*A[1]+D*A[2],k=l+L*A[3]+F*A[4]+D*A[5],j=u+L*A[6]+F*A[7]+D*A[8],V=A[1],G=A[4],W=A[7],Y=X-f,o.addPoint(E,k,j,V,G,W,Y,this.flip),F=J,D=K,E=p+(L=Q)*A[0]+F*A[1]+D*A[2],k=l+L*A[3]+F*A[4]+D*A[5],j=u+L*A[6]+F*A[7]+D*A[8],Y=J-f,o.addPoint(E,k,j,V,G,W,Y,this.flip);else if(X<f&&(F=X,D=Z,E=p+(L=U)*A[0]+F*A[1]+D*A[2],k=l+L*A[3]+F*A[4]+D*A[5],j=u+L*A[6]+F*A[7]+D*A[8],V=A[1],G=A[4],W=A[7],Y=X-f,o.addPoint(E,k,j,V,G,W,Y,this.flip),q<f)){var $=this.quat;$.setFromAxisAngle(S,2*Math.PI/3),R.applyQuaternion($),L=R.x+N,F=R.y+z,D=R.z+w,Y=F-f,E=p+L*A[0]+F*A[1]+D*A[2],k=l+L*A[3]+F*A[4]+D*A[5],j=u+L*A[6]+F*A[7]+D*A[8],o.addPoint(E,k,j,V,G,W,Y,this.flip),R.applyQuaternion($),L=R.x+N,F=R.y+z,D=R.z+w,E=p+L*A[0]+F*A[1]+D*A[2],k=l+L*A[3]+F*A[4]+D*A[5],j=u+L*A[6]+F*A[7]+D*A[8],Y=F-f,o.addPoint(E,k,j,V,G,W,Y,this.flip)}},OIMO.CylinderSphereCollisionDetector=function(t){OIMO.CollisionDetector.call(this),this.flip=t},OIMO.CylinderSphereCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype),OIMO.CylinderSphereCollisionDetector.prototype.tmpVec1=new OIMO.Vec3,OIMO.CylinderSphereCollisionDetector.prototype.tmpVec2=new OIMO.Vec3,OIMO.CylinderSphereCollisionDetector.prototype.tmpVec3=new OIMO.Vec3,OIMO.CylinderSphereCollisionDetector.prototype.detectCollision=function(t,e,o){var i,n;this.flip?(i=e,n=t):(i=t,n=e);var s=n.radius,a=i.radius,r=i.halfHeight,c=i.position,d=n.position,p=d.x-c.x,l=d.y-c.y,u=d.z-c.z,y=i.rotation.elements,g=p*y[0]+l*y[3]+u*y[6],m=p*y[1]+l*y[4]+u*y[7],f=p*y[2]+l*y[5]+u*y[8];if(!(r<m-s||m+s<-r)){var A,b=g*g+f*f,v=a+s,x=v*v;if(n.actor&&n.actor.stayInsideBodyType==OIMO.SHAPE_z1051&&(A=!0),A||!(x<b)){if(null!=i.minY){A=!1;var C=d.y+s,S=i.minY+i.position.y;if(C<S)return;if(d.y<S){var T=i.position.x+i.minX;d.x<i.position.x&&(T=i.position.x-i.minX);var B=this.tmpVec1,O=T-i.position.x,P=S-i.position.y+i.radius;(B.z=0)<O?(B.x=-P,B.y=O):(B.x=P,B.y=-O);var M=this.tmpVec2;M.x=d.x-T,M.y=d.y-S,M.z=0;B.dot(M);return}}var I,N,z,w,_,R,L,F,D,E,k,j,V,G=Math.sqrt(b),W=m;W<0&&(W*=-1);var Y=!1,U=i.innerRadius,X=a-U,Z=!1,q=r+i.offsetCover-s;if(A&&(i.topCovered&&q<m||i.botCovered&&m<-q)&&(N=-1,F=z=I=0,D=r+i.offsetCover,E=0,m+i.offsetCover<0&&(D*=-1,N=1),w=r-(W+s),k=I*y[0]+N*y[1]+z*y[2],j=I*y[3]+N*y[4]+z*y[5],V=I*y[6]+N*y[7]+z*y[8],_=F*y[0]+D*y[1]+E*y[2],R=F*y[3]+D*y[4]+E*y[5],L=F*y[6]+D*y[7]+E*y[8],_+=c.x,R+=c.y,L+=c.z,i.pubsub&&i.pubsub.broadcast("hit",_,R,L,k,j,V,w,i,n),o.addPoint(_,R,L,k,j,V,w,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,_,R,L,k,j,V,w,i),Z=!0),!(G<U+.5*X&&(Y=!0,G+s<U)))if(!Z&&r<W&&(a<G||G<U)){if(0<m&&i.topConnected)return;if(m<0&&i.botConnected)return;D=r,m<0&&(D=-r);var Q=1/G;a<G?(F=g*Q*a,E=f*Q*a):(F=g*Q*U,E=f*Q*U),I=g-F,N=m-D,z=f-E;var J=Math.sqrt(I*I+N*N+z*z),K=1/J;if(N*=K,z*=K,0<=(w=J-s))return;k=(I*=K)*y[0]+N*y[1]+z*y[2],j=I*y[3]+N*y[4]+z*y[5],V=I*y[6]+N*y[7]+z*y[8],_=F*y[0]+D*y[1]+E*y[2],R=F*y[3]+D*y[4]+E*y[5],L=F*y[6]+D*y[7]+E*y[8],_+=c.x,R+=c.y,L+=c.z,i.pubsub&&i.pubsub.broadcast("hit",_,R,L,k,j,V,w,i,n),o.addPoint(_,R,L,k,j,V,w,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,_,R,L,k,j,V,w,i)}else if((A||Y)&&W<r){z=-f*(Q=1/G),w=U-s-G,k=(I=-g*Q)*y[N=0]+N*y[1]+z*y[2],j=I*y[3]+N*y[4]+z*y[5],V=I*y[6]+N*y[7]+z*y[8],D=m,E=-z*U,_=(F=-I*U)*y[0]+D*y[1]+E*y[2],R=F*y[3]+D*y[4]+E*y[5],L=F*y[6]+D*y[7]+E*y[8],_+=c.x,R+=c.y,L+=c.z,i.pubsub&&i.pubsub.broadcast("hit",_,R,L,k,j,V,w,i,n),o.addPoint(_,R,L,k,j,V,w,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,_,R,L,k,j,V,w,i)}else if(!Y&&W<r){z=f*(Q=1/G),w=G-s-a,k=(I=g*Q)*y[N=0]+N*y[1]+z*y[2],j=I*y[3]+N*y[4]+z*y[5],V=I*y[6]+N*y[7]+z*y[8],D=m,E=z*a,_=(F=I*a)*y[0]+D*y[1]+E*y[2],R=F*y[3]+D*y[4]+E*y[5],L=F*y[6]+D*y[7]+E*y[8],_+=c.x,R+=c.y,L+=c.z,i.pubsub&&i.pubsub.broadcast("hit",_,R,L,k,j,V,w,i,n),o.addPoint(_,R,L,k,j,V,w,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,_,R,L,k,j,V,w,i)}else m<0?(N=-1,F=g,D=-r,E=f,w=-m-s-r,k=(I=0)*y[z=0]+N*y[1]+z*y[2],j=I*y[3]+N*y[4]+z*y[5],V=I*y[6]+N*y[7]+z*y[8],_=F*y[0]+D*y[1]+E*y[2],R=F*y[3]+D*y[4]+E*y[5],L=F*y[6]+D*y[7]+E*y[8],_+=c.x,R+=c.y,L+=c.z,i.pubsub&&i.pubsub.broadcast("hit",_,R,L,k,j,V,w,i,n),o.addPoint(_,R,L,k,j,V,w,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,_,R,L,k,j,V,w,i)):0<m&&(N=1,F=g,E=f,w=m-s-(D=r),k=(I=0)*y[z=0]+N*y[1]+z*y[2],j=I*y[3]+N*y[4]+z*y[5],V=I*y[6]+N*y[7]+z*y[8],_=F*y[0]+D*y[1]+E*y[2],R=F*y[3]+D*y[4]+E*y[5],L=F*y[6]+D*y[7]+E*y[8],_+=c.x,R+=c.y,L+=c.z,i.pubsub&&i.pubsub.broadcast("hit",_,R,L,k,j,V,w,i,n),o.addPoint(_,R,L,k,j,V,w,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,_,R,L,k,j,V,w,i))}}},function(o){var t=function(e){function z31(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z495,o.z156.z406,o.z156.z318,o.z156.z222,o.z156.z741,o.z156.z639],t.updatez156=[o.z156.z599,o.z156.z165,o.z156.z235,o.z156.z461,o.z156.z362,o.z156.z731,o.z156.z662,o.z156.z590,o.z156.z214,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z647,o.z156.z617,o.z156.z457],t.exitz156=[o.z156.z502,o.z156.z517,o.z156.z465],t.transitions=[{condition:o.z768.z1027,trueNode:{condition:o.z768.z944,trueNode:{state:o.z108,level:1}}},{condition:o.z768.z873,trueNode:{state:o.z65,level:1,actions:[]}},{condition:o.z768.z968,trueNode:{state:o.z27}},{condition:o.z768.z962,trueNode:{state:o.z20,actions:[o.z156.z526]}},{condition:o.z768.z839,falseNode:{state:o.z66,level:1}},{condition:o.z768.z820,trueNode:{state:o.z66,level:1}},{condition:o.z768.z948,falseNode:{state:o.z66,level:1}},{condition:o.z768.z999,trueNode:{state:o.z20,actions:[o.z156.z554,o.z156.z435,o.z156.z526]}},{condition:o.z768.z967,falseNode:{state:o.z125}},{condition:o.z768.z876,falseNode:{state:o.z66,level:1}},{condition:o.z768.z860,trueNode:{condition:o.z768.z830,falseNode:{condition:o.z768.z1027,trueNode:{condition:o.z768.z932,trueNode:{state:o.z116,actions:[o.z156.z526,o.z156.z755]}}}}}],t.states=[o.z30,o.z29,o.z28],t.initialState=o.z30,t}return __extends(z31,e),z31}(z49);o.z31=t}(z0||(z0={})),function(o){var t=function(e){function z30(){var t=null!==e&&e.apply(this,arguments)||this;return t.updatez156=[o.z156.z560],t.transitions=[{condition:o.z768.z890,trueNode:{state:o.z28}},{condition:o.z768.z915,trueNode:{condition:o.z768.z922,falseNode:{state:o.z29}}}],t}return __extends(z30,e),z30}(z49);o.z30=t}(z0||(z0={})),function(o){var t=function(e){function z29(){var t=null!==e&&e.apply(this,arguments)||this;return t.updatez156=[o.z156.z558],t.transitions=[{condition:o.z768.z922,trueNode:{state:o.z30}}],t}return __extends(z29,e),z29}(z49);o.z29=t}(z0||(z0={})),function(o){var t=function(e){function z28(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[],t.updatez156=[],t.exitz156=[],t.transitions=[{condition:o.z768.z890,falseNode:{state:o.z30}}],t}return __extends(z28,e),z28}(z49);o.z28=t}(z0||(z0={})),function(o){var t=function(e){function z27(){var t=null!==e&&e.apply(this,arguments)||this;return t.updatez156=[o.z156.z687,o.z156.z461,o.z156.z362,o.z156.z731,o.z156.z590,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z457],t.transitions=[{condition:o.z768.z968,falseNode:{state:o.z31}}],t}return __extends(z27,e),z27}(z49);o.z27=t}(z0||(z0={})),function(o){var t=function(e){function z26(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z743],t.updatez156=[o.z156.z406,o.z156.z165,o.z156.z618,o.z156.z711,o.z156.z244,o.z156.z586,o.z156.z664,o.z156.z557,o.z156.z460,o.z156.z446,o.z156.z369,o.z156.z707,o.z156.z590,o.z156.z362,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z379],t.states=[],t.transitions=[{condition:o.z768.z791,falseNode:{state:o.z20,actions:[]}},{condition:o.z768.z830,trueNode:{state:o.z63,actions:[]}},{condition:o.z768.z869,falseNode:{state:o.z66,level:1}},{condition:o.z768.z901,trueNode:{state:o.z66,level:1}},{condition:o.z768.z881,trueNode:{state:o.z19,level:1}},{condition:o.z768.z873,trueNode:{state:o.z65,level:1,actions:[]}}],t}return __extends(z26,e),z26}(z49);o.z26=t}(z0||(z0={})),function(o){var t=function(e){function z25(){var t=null!==e&&e.apply(this,arguments)||this;return t.transitions=[{condition:o.z768.z960,falseNode:{condition:o.z768.z781,trueNode:{state:o.z23},falseNode:{condition:o.z768.z776,trueNode:{state:o.z24},falseNode:{condition:o.z768.z783,trueNode:{state:o.z22,level:1,actions:[]}}}}}],t}return __extends(z25,e),z25}(z49);o.z25=t}(z0||(z0={})),function(o){var t=function(e){function z24(){var t=null!==e&&e.apply(this,arguments)||this;return t.updatez156=[o.z156.z214,o.z156.z161],t.transitions=[{condition:o.z768.z826,trueNode:{state:o.z25},falseNode:{condition:o.z768.z776,falseNode:{state:o.z25}}}],t}return __extends(z24,e),z24}(z49);o.z24=t}(z0||(z0={})),function(o){var t=function(e){function z23(){var t=null!==e&&e.apply(this,arguments)||this;return t.updatez156=[o.z156.z214,o.z156.z452,o.z156.z162],t.transitions=[{condition:o.z768.z960,trueNode:{state:o.z25},falseNode:{condition:o.z768.z782,falseNode:{state:o.z25}}}],t}return __extends(z23,e),z23}(z49);o.z23=t}(z0||(z0={})),function(o){var t=function(e){function z22(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z277,o.z156.z437,o.z156.z553,o.z156.z301,o.z156.z232],t.updatez156=[o.z156.z548,o.z156.z317,o.z156.z626,o.z156.z254,o.z156.z270,o.z156.z731,o.z156.z165,o.z156.z183,o.z156.z576,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z765,o.z156.z747,o.z156.z739,o.z156.z440],t.exitz156=[o.z156.z482,o.z156.z501],t.transitions=[{condition:o.z768.z962,falseNode:{state:o.z66,level:1,actions:[]}},{condition:o.z768.z1020,trueNode:{state:o.z20}}],t}return __extends(z22,e),z22}(z49);o.z22=t}(z0||(z0={})),function(o){var t=function(e){function z21(){var t=null!==e&&e.apply(this,arguments)||this;return t.historyLength=3,t.type="move",t.ignoreEvents=[o.ConnectorCageEvents.ENTER],t.enterz156=[o.z156.z406,o.z156.z318,o.z156.z547],t.states=[o.z31,o.z26,o.z20,o.z22,o.z125,o.z27],t.exitz156=[o.z156.z546,o.z156.z495],t.transitions=[{condition:o.z768.z965,trueNode:{state:o.z141,actions:[o.z156.z552]}}],t.initialState=o.z31,t}return __extends(z21,e),z21}(z49);o.z21=t}(z0||(z0={})),function(o){var t=function(e){function z20(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z476,o.z156.z277,o.z156.z254,o.z156.z270,o.z156.z321,o.z156.z514],t.updatez156=[o.z156.z626,o.z156.z711,o.z156.z235,o.z156.z165,o.z156.z317,o.z156.z254,o.z156.z638,o.z156.z270,o.z156.z708,o.z156.z349,o.z156.z590,o.z156.z459,o.z156.z414,o.z156.z548,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z765,o.z156.z747,o.z156.z739,o.z156.z505],t.exitz156=[o.z156.z502],t.transitions=[{condition:o.z768.z791,trueNode:{state:o.z26}}],t.states=[o.z25,o.z23,o.z24],t.initialState=o.z25,t}return __extends(z20,e),z20}(z49);o.z20=t}(z0||(z0={})),function(S){var t=function(C){function WaterBottle(){var t=C.call(this)||this;return t.accType=S.z1044.z1056,t.num=0,t.graphicsHelper=S.app.graphicsHelper,t.curveRadius=0,t.thickness=.1,t.targetPosition=BABYLON.Vector3.Zero(),t.capHeight=.1,t.spoutRadius=.03,t.height=0,t.halfHeight=0,t.radius=0,t.offsetX=0,t.offsetY=0,t.offsetZ=0,t.bodySpout=null,t.bodyWaterLineDynamic=null,t.bodyWaterLineStatic=null,t.bodyWaterLineJoint=null,t.bodyBottle=null,t.testMesh1=null,t.testMesh2=null,t.testMesh3=null,t.frontDir=BABYLON.Vector3.Zero(),t._waterLevel=.4,t._localSpoutPos=BABYLON.Vector3.Zero(),t.spoutPosition=BABYLON.Vector3.Zero(),t._rotationMatrix=BABYLON.Matrix.Identity(),t.mapPlacementInfo=new S.MapPlacementInfo({mapPlacementSizeY:.2}),t._numHamsAccess=0,t._lastWaterLinePos=BABYLON.Vector3.Zero(),t.hamsters=new z1072,t._lastDir=BABYLON.Vector3.Zero(),t._lastPosX=0,t._lastPosZ=0,t._frameNumUpdateNumHamsAccess=-1,t._lastNumActiveHams=0,WaterBottle.count++,t.num=WaterBottle.count,t.offsetY=-.55,t.offsetZ=-.2,t.rotationQuaternion=BABYLON.Quaternion.Identity(),t.rotation=BABYLON.Vector3.Zero(),t.position=BABYLON.Vector3.Zero(),t.color=new BABYLON.Color4,t.placementType=S.PlacementType.GRID|S.PlacementType.z1048|S.PlacementType.FRONT,t._colors={},t._colors.bottle=new BABYLON.Color3(1,1,1),t._colors.cap=new BABYLON.Color3(1,1,1),t._colors.spout=new BABYLON.Color3,t._colors.holder=new BABYLON.Color3(1,1,1),t._colors.label=new BABYLON.Color3(1,1,1),t}return __extends(WaterBottle,C),Object.defineProperty(WaterBottle.prototype,"waterLevel",{get:function(){return this._waterLevel},set:function(t){this._waterLevel=t},enumerable:!1,configurable:!0}),Object.defineProperty(WaterBottle.prototype,"numHamsAccess",{get:function(){return this._numHamsAccess},set:function(t){t!=this._numHamsAccess&&(this._numHamsAccess=t,this.dbid&&this.saveSettings())},enumerable:!1,configurable:!0}),WaterBottle.prototype.init=function(t){C.prototype.init.call(this,t),this.controlAnchor||this.addControlAnchor(),t.isMenuItem,this.controlPositionLocal.y=.4,this.addToActiveObjects(),this.canRotate=!1,this.canTranslate=!0;var e=this.shapeName,o=0,i=0,n=-1.5;null!=t.x&&(o=t.x),null!=t.y&&(i=t.y),this._localSpoutPos.y=-.29,this._localSpoutPos.z=-.23,this.cage&&(o+=this.cage.body.position.x,i+=this.cage.body.position.y,n+=this.cage.body.position.z),t.radius?this.radius=t.radius:this.radius=.25,t.height?this.height=t.height:this.height=1,this.halfHeight=.5*this.height;var s=0;null!=t.ry&&(s=t.ry);var a=s;this.world=t.world;var r=S.App.z1033;if(this.shapeBottle)this.shapeBottle.init({name:e+"_bottle",renderingGroupID:this.renderingGroupID}),this.shapeBottle.color.a=.5,this.shapeCap.init({name:e+"_cap",renderingGroupID:this.renderingGroupID}),this.shapeSpout.init({name:e+"_spout",renderingGroupID:this.renderingGroupID}),this.shapeWaterLine.init({name:e+"_waterline",renderingGroupID:this.renderingGroupID}),this.shapeHolder.init({name:e+"_holder",renderingGroupID:this.renderingGroupID}),this.shapeLabelOutside.init({name:e+"_labelOutside",renderingGroupID:this.renderingGroupID});else{var c=[1,.4,.2,r,4294967295];if(this.world&&!this.isMenuItem){this.bodySpout=new OIMO.Body({size:[.02,.3,0],pos:[0,0,0],rot:[180/Math.PI*0,180/Math.PI*0,180/Math.PI*0],world:this.world,type:"tube",move:!1,name:e+"_spout1",config:c}).body,this.bodyBottle=new OIMO.Body({size:[this.radius,this.height,0],pos:[0,0,0],rot:[180/Math.PI*0,180/Math.PI*0,180/Math.PI*0],world:this.world,type:"tube",move:!1,name:e+"_bottle1",config:c}).body,(d=[1,1,.1])[3]=S.App.z1042,d[4]=S.App.z1042;var d,p="waterLine"+WaterBottle.count,l=new OIMO.Body({type:"sphere",size:[.1],pos:[0,0,0],rot:[0,0,0],move:!0,world:this.world,name:p,config:d}).body;l.allowSleep=!1,this.bodyWaterLineDynamic=l,(d=[1,1,.1])[3]=null,d[4]=null;this.bodyWaterLineStatic=new OIMO.Body({type:"sphere",size:[.01],pos:[0,0,0],rot:[0,0,0],move:!1,world:this.world,name:p+"_dragger",config:d}).body;var u={name:"bodyDraggerJoint",type:"jointDistance",body1:p+"_dragger",body2:p,min:0,max:.01,pos1:[0,0,0],pos2:[0,0,0],collision:!1,spring:[7,.1],world:this.world};this.bodyWaterLineJoint=new OIMO.Link(u).joint}this.shapeBottle=ObjectPool.get("z1068",{name:e+"_bottle",renderingGroupID:this.renderingGroupID}),this.shapeBottle.textureName="white50PercentAlphaTile",this.shapeBottle.color.a=.5,this.shapeCap=ObjectPool.get("z1068",{name:e+"_cap",renderingGroupID:this.renderingGroupID}),this.shapeSpout=ObjectPool.get("waterbottle_spout_rg"+this.renderingGroupID,{name:"waterbottle_spout",renderingGroupID:this.renderingGroupID}),this.shapeWaterLine=ObjectPool.get("z1068",{name:e+"_waterline",renderingGroupID:this.renderingGroupID}),this.shapeWaterLine.textureName="waterTile",this.shapeHolder=ObjectPool.get("z1068",{name:e+"_holder",renderingGroupID:this.renderingGroupID}),this.shapeLabelOutside=ObjectPool.get(e+"_labeloutside_rg"+this.renderingGroupID,{name:e+"_labeloutside",renderingGroupID:this.renderingGroupID}),this.isMenuItem&&!this.meshes&&(this.meshes=[],this.meshes.push(this.shapeLabelOutside.inst),this.meshes.push(this.shapeSpout.inst));var y=this,g=BABYLON.Vector3.Zero();this.shapeWaterLine.onBeforeDepthSort=function(t){g.copyFrom(this.position),this.setPosition(y.position.x,y.position.y,y.position.z+.1),t.setParticle(this,!1)},this.shapeWaterLine.onAfterDepthSort=function(t){this.position.copyFrom(g),t.setParticle(this,!1)}}var m=0;if(0<t.nh&&(m=t.nh),this._numHamsAccess=m,null!=t.wl){var f=this.height-.1;if(this.waterLevel=t.wl,0<m){var A=S.app._cageLastViewed;if(A){var b=(Date.now()-A)/36e5;this.waterLevel-=b*b*.02*m}}this.waterLevel<.1&&(this.waterLevel=.1),this.waterLevel>f&&(this.waterLevel=f)}if(this.shapeSpout.scaling.y=1.2,this._initColors(),!this.hitMeshes&&!t.isMenuItem){this.hitMeshes=[];var v=S.app.graphicsHelper.getHitMesh(2*this.radius-.02,1.2,2*this.radius);this.hitMeshes.push(v)}if(t.isMenuItem)this.setRotation(0,a,0),this.setPosition(o,i,n);else if(this.setRotation(0,a,0),this.setPosition(o,i,n),t.skipAddToScene)t.cage&&this.setToCageWall(t.cage);else{if(t.cage&&t.cage!=this.cage){var x=t.cage;(this.cage=x).addObject(this),x.isReady?this.onCageReady():x.pubsub.subscribe("ready",this.onCageReady,this)}x||(x=S.Cage.getCageAt(this.position.x,this.position.y,this.position.z)),this.addToObject(x)}t.skipAddToScene||this.addToScene()},WaterBottle.prototype.updateCage=function(){var t=S.Cage.getCageAt(this.position.x,this.position.y,this.position.z);this.addToObject(t)},WaterBottle.prototype.setToCageWall=function(t){if(t){var e=WaterBottle.z4[0],o=this.radius,i=WaterBottle.tempMat,n=t.getWorldMatrix();n.invertToRef(i);var s=WaterBottle.z4[2];WaterBottle.z4[3];BABYLON.Vector3.TransformCoordinatesToRef(this.position,i,s);var a=Math.abs(Math.abs(s.x)-.5*t.width),r=Math.abs(Math.abs(s.z)-.5*t.depth);a=z1.round(a,.5),r=z1.round(r,.5);e.x=s.x,e.y=s.y,e.z=s.z,a<=r?s.x<0?(s.x=.5*-t.width+o+.1,e.x=s.x+1):(s.x=.5*t.width-o-.1,p=.5*-Math.PI,e.x=s.x-1):s.z<0?(s.z=.5*-t.depth+o+.1,e.z=s.z+1):(s.z=.5*t.depth-o-.1,e.z=s.z-1),BABYLON.Vector3.TransformCoordinatesToRef(s,n,this.position),BABYLON.Vector3.TransformCoordinatesToRef(e,n,e);var c=this.position.x-e.x,d=this.position.z-e.z,p=Math.atan2(c,d);this.setRotation(0,p-.5*Math.PI,0)}},WaterBottle.prototype.addToObject=function(t){if(this.cage&&(this.cage.removeObject(this),this.disconnect()),this.parent=t,this.cage=t){var e=this.cage;e.addObject(this),this.setToCageWall(e),this.onCageReady()}},WaterBottle.prototype.setTargetPosition=function(){if(this.targetPosition.x=this.position.x+1*(this.spoutPosition.x-this.position.x),this.targetPosition.z=this.position.z+1*(this.spoutPosition.z-this.position.z),this.targetPosition.y=this.spoutPosition.y-.3,this.cage){var t=this.cage.getPlatformUnder(this.position.x,this.position.y,this.position.z);t&&t.position.y>this.targetPosition.y&&(this.targetPosition.y=t.position.y+.1);var e=this.cage.getHeightAt(this.position.x,this.position.z);e>this.targetPosition.y&&(this.targetPosition.y=e+.1)}},WaterBottle.prototype.onCageReady=function(){this.setTargetPosition()},WaterBottle.prototype.addToScene=function(){this.isOnScene||(this.isMenuItem&&this.isMenuItem,C.prototype.addToScene.call(this),this.shapeBottle.addToScene(),this.shapeBottle.requestDepthSort=!0,this.shapeCap.addToScene(),this.shapeSpout.addToScene(),this.shapeWaterLine.addToScene(),this.shapeHolder.addToScene(),this.shapeLabelOutside.addToScene(),this.isMenuItem||S.app.graphicsHelper.addForUpdate(this))},WaterBottle.prototype.removeFromScene=function(){this.isOnScene&&(this.isMenuItem&&this.isMenuItem,C.prototype.removeFromScene.call(this),this.shapeBottle.removeFromScene(),this.shapeCap.removeFromScene(),this.shapeSpout.removeFromScene(),this.shapeWaterLine.removeFromScene(),this.shapeHolder.removeFromScene(),this.shapeLabelOutside.removeFromScene(),this.isMenuItem||S.app.graphicsHelper.removeFromUpdate(this))},WaterBottle.prototype.setPositionDrag=function(t,e,o,i){var n=t-this.position.x,s=e-this.position.y,a=o-this.position.z;if(this.isDragging||(this.shapeBottle.requestDepthSort=!0,this.shapeBottle.forceUpdate=!0),C.prototype.setPositionDrag.call(this,t,e,o,i),this.shapeBottle.translate(n,s,a),this.shapeCap.translate(n,s,a),this.shapeSpout.translate(n,s,a),this.shapeWaterLine.translate(n,s,a),this.shapeHolder.translate(n,s,a),this.shapeLabelOutside.translate(n,s,a),this.syncBodyToMesh(),this.hitMeshes){var r=this.hitMeshes[0];r.position.copyFrom(this.position),r.position.y-=.1,r.computeWorldMatrix(),BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,r.getWorldMatrix(),this.controlAnchor.position)}if(this.bodyWaterLineStatic){var c=this.bodyWaterLineStatic,d=c.position;d.x+=n,d.y+=s,d.z+=a;var p=c.shapes.position;p.x=d.x,p.y=d.y,p.z=d.z,c.shapes.updateProxy()}},WaterBottle.prototype.setHitMesh=function(t,e,o){if(this.hitMeshes&&this.hitMeshes[0]){var i=this.hitMeshes[0];i.position.x=t,i.position.y=e-.1,i.position.z=o,i.computeWorldMatrix()}},WaterBottle.prototype.setPosition=function(t,e,o){this.isMenuItem&&this.isMenuItem,this.position.x=t,this.position.y=e,this.position.z=o;var i=this.shapeBottle,n=this.shapeCap,s=t,a=e,r=o;if(this.isMenuItem||(this.updateCage(),this.cage&&this.cage.top<this.position.y+this.halfHeight&&(this.position.y=this.cage.top-this.halfHeight),s=this.position.x,a=this.position.y,r=this.position.z),this.offsetY||this.offsetZ){var c=WaterBottle.z4[0],d=WaterBottle.z4[1],p=WaterBottle.tempMat;this.rotationQuaternion.toRotationMatrix(p),BABYLON.Vector3.TransformNormalToRef(BABYLON.Axis.Y,p,c),BABYLON.Vector3.TransformNormalToRef(BABYLON.Axis.Z,p,d),this.offsetY&&(s+=c.x*this.offsetY,a+=c.y*this.offsetY,r+=c.z*this.offsetY),this.offsetZ}i.setPosition(s,a,r),n.setPosition(s,a,r),this.shapeSpout.setPosition(s,a-.09,r),this.shapeHolder.setPosition(s,a,r);var l,u,y=this.waterLevel;(this.shapeWaterLine.setPosition(s,a+y,r),this.shapeLabelOutside.setPosition(s,a,r),this.bodyWaterLineStatic)&&((l=this.bodyWaterLineStatic)&&(l.position.x=s,l.position.y=a+y,l.position.z=r,l.linearVelocity.x=0,l.linearVelocity.y=0,l.linearVelocity.z=0,l.angularVelocity.x=0,l.angularVelocity.y=0,l.angularVelocity.z=0,(u=l.shapes).position.x=l.position.x,u.position.y=l.position.y,u.position.z=l.position.z,l.syncShapes(),(l=this.bodyWaterLineDynamic).linearVelocity.x=0,l.linearVelocity.y=0,l.linearVelocity.z=0,l.angularVelocity.x=0,l.angularVelocity.y=0,l.angularVelocity.z=0,l.position.x=s,l.position.y=a+y-.1,l.position.z=r,(u=l.shapes).position.x=l.position.x,u.position.y=l.position.y,u.position.z=l.position.z,l.syncShapes()));this.syncBodyToMesh(),this.setHitMesh(t,e,o),this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position),BABYLON.Vector3.TransformCoordinatesToRef(this._localSpoutPos,this.shapeCap.worldMatrix,this.spoutPosition),this.setTargetPosition(),this.onChangeObservable.notifyObservers(this)},WaterBottle.prototype.setRotation=function(t,e,o){this.rotation.x=t,this.rotation.y=e,this.rotation.z=o;var i=this.rotationQuaternion;BABYLON.Quaternion.RotationYawPitchRollToRef(e,t,o,i),i.toRotationMatrix(this._rotationMatrix);var n=WaterBottle.tempBabQuats[0],s=WaterBottle.z4[0];if(s.x=t,s.y=e,s.z=o,BABYLON.Quaternion.RotationYawPitchRollToRef(.5*Math.PI,0,0,n),i.multiplyToRef(n,n),n.toEulerAnglesToRef(s),this.shapeBottle.setRotation(s.x,s.y,s.z),this.shapeCap.setRotation(s.x,s.y,s.z),this.shapeHolder.setRotation(s.x,s.y,s.z),this.shapeLabelOutside.setRotation(s.x,s.y,s.z),BABYLON.Quaternion.RotationYawPitchRollToRef(.5*Math.PI,.278*Math.PI,0,n),i.multiplyToRef(n,n),n.toEulerAnglesToRef(s),this.shapeSpout.setRotation(s.x,s.y,s.z),this.syncBodyToMesh(),BABYLON.Vector3.TransformCoordinatesToRef(this._localSpoutPos,this.shapeCap.worldMatrix,this.spoutPosition),this.hitMeshes&&(this.hitMeshes[0].rotation.y=e,this.hitMeshes[0].computeWorldMatrix()),this.bodySpout){var a=this.bodySpout.rotation.elements;this.frontDir.x=-a[1],this.frontDir.y=0,this.frontDir.z=-a[7],this.frontDir.normalize()}this.onChangeObservable.notifyObservers(this)},WaterBottle.prototype.update=function(){var t=this.bodyWaterLineDynamic;if(t){t.linearVelocity.x*=.99,t.linearVelocity.y*=.99,t.linearVelocity.z*=.99,t.angularVelocity.x*=.99,t.angularVelocity.y*=.99,t.angularVelocity.z*=.99;var e=this.bodyWaterLineDynamic.position,o=e.x-this._lastWaterLinePos._x,i=e.y-this._lastWaterLinePos._y,n=e.z-this._lastWaterLinePos._z,s=o*o+i*i+n*n;this._lastWaterLinePos._x=e.x,this._lastWaterLinePos._y=e.y,this._lastWaterLinePos._z=e.z;if(!(s<1e-6)){this.testMesh1&&(this.testMesh1.position.x=e.x,this.testMesh1.position.y=e.y,this.testMesh1.position.z=e.z);var a=this.bodyWaterLineStatic.position;this.testMesh2&&(this.testMesh2.position.x=a.x,this.testMesh2.position.y=a.y,this.testMesh2.position.z=a.z),this.testMesh3&&(this.testMesh3.position.x=this.bodySpout.position.x,this.testMesh3.position.y=this.bodySpout.position.y,this.testMesh3.position.z=this.bodySpout.position.z,this.testMesh3.rotationQuaternion.x=this.bodySpout.orientation.x,this.testMesh3.rotationQuaternion.y=this.bodySpout.orientation.y,this.testMesh3.rotationQuaternion.z=this.bodySpout.orientation.z,this.testMesh3.rotationQuaternion.w=this.bodySpout.orientation.s);var r=WaterBottle.z4[0],c=WaterBottle.z4[1],d=WaterBottle.z4[2],p=this.position;c._x=e.x-p.x,c._y=1,c._z=e.z-p.z,c.normalize(),d._x=0,d._y=0,d._z=1,BABYLON.Vector3.CrossToRef(c,d,r),r.normalize(),BABYLON.Vector3.CrossToRef(r,c,d),d.normalize();var l=WaterBottle.tempMat;BABYLON.Matrix.FromXYZAxesToRef(r,c,d,l),this.shapeWaterLine.setRotationMatrix(l)}}},WaterBottle.prototype.disconnect=function(){this.cage=null},WaterBottle.prototype.addToActiveObjects=function(){-1==WaterBottle.activeObjects.indexOf(this)&&WaterBottle.activeObjects.push(this)},WaterBottle.prototype.removeFromActiveObjects=function(){var t=WaterBottle.activeObjects.indexOf(this);-1!=t&&WaterBottle.activeObjects.splice(t,1)},WaterBottle.prototype.setColor=function(t,e,o,i){C.prototype.setColor.call(this,t,e,o,i),"bottle"==i?(this.shapeBottle.setColor(t,e,o),this.shapeWaterLine.setColor(t,e,o)):"cap"==i?this.shapeCap.setColor(t,e,o):"spout"==i?this.shapeSpout.setColor(t,e,o):"holder"==i?this.shapeHolder.setColor(t,e,o):"label"==i&&this.shapeLabelOutside.setColor(t,e,o)},WaterBottle.prototype.recycle=function(){this.shapeBottle.translate(0,9999,0),this.shapeSpout.translate(0,9999,0),this.syncBodyToMesh(),this._numHamsAccess=0,C.prototype.recycle.call(this)},WaterBottle.prototype.isValidDropLocation=function(t,e,o){if(!C.prototype.isValidDropLocation.call(this,t,e,o))return!1;var i=this._tempDropLoc;return this.getPositionOnMapFromDropToRef(t,e,o,i),!!S.Cage.getCageAt(i.x,i.y,i.z)},WaterBottle.prototype.getPositionOnMapFromDropToRef=function(t,e,o,i){C.prototype.getPositionOnMapFromDropToRef.call(this,t,e,o,i);var n=S.Cage.getCageAt(i.x,i.y,i.z);if(n){var s=n.floorY+1.5;i.y<s&&(i.y=s)}},WaterBottle.prototype.syncBodyToMesh=function(){if(this.bodyBottle){var t=this.bodyBottle,e=this.shapeBottle;t.position.x=e.position.x,t.position.y=e.position.y+this.halfHeight,t.position.z=e.position.z;var o=t.orientation,i=e.rotationQuaternion;o.s=i.w,o.x=i.x,o.y=i.y,o.z=i.z,t.syncShapes()}if(this.bodySpout){t=this.bodySpout,e=this.shapeSpout;t.position.x=e.position.x,t.position.y=e.position.y,t.position.z=e.position.z;o=t.orientation,i=e.rotationQuaternion;o.s=i.w,o.x=i.x,o.y=i.y,o.z=i.z,t.syncShapes();var n=t.shapes.halfHeight,s=t.rotation.elements,a=t.position;a.x-=s[1]*n,a.y-=s[4]*n,a.z-=s[7]*n}},WaterBottle.prototype.addz1062=function(t){-1===this.hamsters.indexOf(t)&&this.hamsters.push(t)},WaterBottle.prototype.removez1062=function(t){this.hamsters.remove(t)},WaterBottle.prototype.getDirToBottle=function(t,e,o){if(t==this._lastPosX&&e==this._lastPosZ)return o.x=this._lastDir.x,o.y=this._lastDir.y,void(o.z=this._lastDir.z);this._lastPosX=t,this._lastPosZ=t;var i=this.spoutPosition;o.x=t-i.x,o.z=e-i.z,o.y=0,o.normalize(),this._lastDir.x=o.x,this._lastDir.y=o.y,this._lastDir.z=o.z},WaterBottle.prototype.saveSettings=function(){S.app.saveDataItem(this)},WaterBottle.prototype.getProps=function(){var t=C.prototype.getProps.call(this);return t.wl=this.waterLevel,t.nh=this.numHamsAccess,t},WaterBottle.prototype.updateNumHamsAccess=function(){var t=S.z1062.activeObjects;if((this._frameNumUpdateNumHamsAccess!=S.app.frameNum||this._lastNumActiveHams!=t.length)&&!this.isDragging){this._frameNumUpdateNumHamsAccess=S.app.frameNum,this._lastNumActiveHams=t.length;for(var e=WaterBottle.tempArray,o=e.length=0,i=0;i<t.length;i++){var n=t[i];n.currentObject==this.cage?o++:(e.length=0,n.getPathToRef(this.position,e),0<e.length&&o++)}this.numHamsAccess=o}},WaterBottle.tempMat=BABYLON.Matrix.Identity(),WaterBottle.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],WaterBottle.activeObjects=[],WaterBottle.count=0,WaterBottle}(S.z1092);S.WaterBottle=t}(z0||(z0={})),function(t){var e=function(e){function WaterBottle1(){var t=e.call(this)||this;return t._colors={},t._colors.bottle=new BABYLON.Color3(.75,.75,.75),t._colors.cap=new BABYLON.Color3(0,1,0),t._colors.spout=new BABYLON.Color3(.68,.68,.68),t._colors.holder=new BABYLON.Color3(0,1,0),t._colors.label=new BABYLON.Color3(1,.5,0),t}return __extends(WaterBottle1,e),WaterBottle1.prototype.init=function(t){e.prototype.init.call(this,t)},WaterBottle1.count=0,WaterBottle1}(t.WaterBottle);t.WaterBottle1=e}(z0||(z0={})),function(i){var t=function(){function WaterBottle1Config(){this.maxObjects=4,this.objName="wb1",i.WaterBottle1.objectCount=this.maxObjects}return WaterBottle1Config.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,i.WaterBottle1,{shapeName:this.objName,world:t,x:0,y:.25,z:0}),ObjectPool.addClass(this.objName+"_labeloutside_rg0",z1069,{meshName:"waterbottle1_labeloutside_rg0",tileName:"waterBottleLabel1"}),ObjectPool.addClass(this.objName+"_labeloutside_rg1",z1069,{meshName:"waterbottle1_labeloutside_rg1",tileName:"waterBottleLabel1",renderingGroupID:1})},WaterBottle1Config.prototype.getCreateMeshFunctions=function(t){t.waterbottle1_bottle=this._createMeshes,t.waterBottleButton=this._createMeshes,t.waterBottleMenuButton=this._createMeshes,t.waterbottle_waterline=this._createMeshes,t.waterbottle1_labeloutside_rg0=this._createMeshes,t.waterbottle1_labeloutside_rg1=this._createMeshes},WaterBottle1Config.prototype._createMeshes=function(t,e,o){var i=e.waterbottle1_bottleoutside,n=e.waterbottle1_bottleinside;i.position.x=0,i.position.y=0,i.position.z=0,n.position.x=0,n.position.y=0,n.position.z=0,(r=BABYLON.Mesh.MergeMeshes([i,n],!0)).getScene().removeMesh(r),e.waterbottle1_bottle=r;var s=BABYLON.MeshBuilder.CreateBox("waterBottleButton",{height:1.1,width:.5,depth:.5},t);s.position.y-=.1,s.bakeCurrentTransformIntoVertices(),e.waterBottleButton=s,t.removeMesh(s);var a=BABYLON.MeshBuilder.CreatePlane("",{height:2,width:1},t);a.position.y+=.2,a.bakeCurrentTransformIntoVertices(),t.removeMesh(a),e.waterBottleMenuButton=a;var r;i=e.waterbottle1_waterlineoutside,n=e.waterbottle1_waterlineinside;i.position.x=0,i.position.y=0,i.position.z=0,n.position.x=0,n.position.y=0,n.position.z=0,(r=BABYLON.Mesh.MergeMeshes([i,n],!0)).getScene().removeMesh(r),e.waterbottle_waterline=r;var c;i=e.waterbottle1_labeloutside,n=e.waterbottle1_labelinside;(c=e.waterbottle1_labeloutside.clone("waterbottle1_labeloutside_rg0")).makeGeometryUnique(),c.material=o.discard_alpha2,c.registerInstancedBuffer("color",4),c.instancedBuffers.color=new BABYLON.Color4(1,1,1,1),c.registerInstancedBuffer("tileOffset",4),c.instancedBuffers.tileOffset=new BABYLON.Vector4(1,1,1,1),t.removeMesh(c),e.waterbottle1_labeloutside_rg0=c,(c=e.waterbottle1_labeloutside.clone("waterbottle1_labeloutside_rg1")).makeGeometryUnique(),c.material=o.discard_alpha2,c.registerInstancedBuffer("color",4),c.instancedBuffers.color=new BABYLON.Color4(1,1,1,1),c.registerInstancedBuffer("tileOffset",4),c.instancedBuffers.tileOffset=new BABYLON.Vector4(1,1,1,1),t.removeMesh(c),c.renderingGroupId=1,e.waterbottle1_labeloutside_rg1=c},WaterBottle1Config.prototype.getTextureDrawFunctions=function(t){var e=function(t,e,o){t.beginPath(),t.rect(0,0,e,o),t.fillStyle="rgba(255, 255, 255, .33)",t.fill()};t.waterTile=e;e=function(t,e,o){t.beginPath(),t.rect(0,0,e,o),t.fillStyle="rgba(255, 255, 255, .01)",t.fill()},e=function(t,e,o){i.CanvasDraw.DrawHeartsPattern(t,e,o,"rgba(255, 255, 255, 0)","rgba(255, 255, 255, 1)",2,4,.8)};t.waterBottle1Hearts=e;e=function(t,e,o){i.CanvasDraw.DrawLogoPattern(t,e,o,"rgba(255, 255, 255, 0)","rgba(255, 255, 255, .8)",60,60,.8,.8)};t.waterBottleLabel1=e},WaterBottle1Config.prototype.getChildSPSData=function(t){t[this.objName]||(t[this.objName]={}),t[this.objName][this.objName+"_bottle"]=1,t[this.objName][this.objName+"_cap"]=1,t[this.objName][this.objName+"_holder"]=1,t[this.objName][this.objName+"_waterline"]=1},WaterBottle1Config.prototype.getSPSData=function(t){var e=this.objName;t.push({shapeName:e,meshName:"waterBottleButton",numInstances:this.maxObjects,maxInstances:this.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:e+"_bottle",meshName:"waterbottle1_bottle",numInstances:this.maxObjects,maxInstances:this.maxObjects,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0}),t.push({shapeName:e+"_cap",meshName:"waterbottle1_cap",numInstances:this.maxObjects,maxInstances:this.maxObjects}),t.push({shapeName:e+"_holder",meshName:"waterbottle1_holder",numInstances:this.maxObjects,maxInstances:this.maxObjects}),t.push({shapeName:e+"_waterline",meshName:"waterbottle_waterline",numInstances:this.maxObjects,maxInstances:this.maxObjects,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0}),t.push({shapeName:e,meshName:"waterBottleMenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:e+"_bottle",meshName:"waterbottle1_bottle",numInstances:1,maxInstances:1,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:e+"_cap",meshName:"waterbottle1_cap",numInstances:1,maxInstances:1,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:e+"_holder",meshName:"waterbottle1_holder",numInstances:1,maxInstances:1,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:e+"_waterline",meshName:"waterbottle_waterline",numInstances:1,maxInstances:1,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0,renderingGroupID:i.App.menuRenderingGroupID})},WaterBottle1Config.prototype.getz1064Items=function(t){t.push(new i.MenuItemInfo({id:this.objName,objectName:this.objName,category:"WaterBottles",order:2,countLabelY:-.4,offsetY:.25,menuHeight:2}))},WaterBottle1Config}();i.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(e){function WaterBottle2(){var t=e.call(this)||this;return t._colors={},t._colors.bottle=new BABYLON.Color3(.75,.75,.75),t._colors.cap=new BABYLON.Color3(.5,.5,1),t._colors.spout=new BABYLON.Color3(.68,.68,.68),t._colors.holder=new BABYLON.Color3(.5,.5,1),t._colors.label=new BABYLON.Color3(1,.5,0),t}return __extends(WaterBottle2,e),Object.defineProperty(WaterBottle2.prototype,"waterLevel",{get:function(){return this._waterLevel},set:function(t){var e=1;if(.75<t){var o=t-.75;e*=Math.sin(.5*Math.PI*(1-o/.3))}else if(t<.2){o=.2-t;e*=Math.sin(.5*Math.PI*(1-o/.3))}this.shapeWaterLine.setScale(e,1,e),this._waterLevel=t},enumerable:!1,configurable:!0}),WaterBottle2.prototype.init=function(t){e.prototype.init.call(this,t)},WaterBottle2.count=0,WaterBottle2}(t.WaterBottle);t.WaterBottle2=e}(z0||(z0={})),function(i){var t=function(){function WaterBottle2Config(){this.maxObjects=4,this.objName="wb2",i.WaterBottle2.objectCount=this.maxObjects}return WaterBottle2Config.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,i.WaterBottle2,{shapeName:this.objName,world:t,x:0,y:.25,z:0}),ObjectPool.addClass(this.objName+"_labeloutside_rg0",z1069,{meshName:"waterbottle2_labeloutside_rg0",tileName:"waterBottleLabel2"}),ObjectPool.addClass(this.objName+"_labeloutside_rg1",z1069,{meshName:"waterbottle2_labeloutside_rg1",tileName:"waterBottleLabel2",renderingGroupID:1})},WaterBottle2Config.prototype.getCreateMeshFunctions=function(t){t.waterbottle2_bottle=this._createMeshes,t.waterbottle2_labeloutside_rg0=this._createMeshes,t.waterbottle2_labeloutside_rg1=this._createMeshes},WaterBottle2Config.prototype._createMeshes=function(t,e,o){var i=e.waterbottle2_bottleoutside,n=e.waterbottle2_bottleinside;i.position.x=0,i.position.y=0,i.position.z=0,n.position.x=0,n.position.y=0,n.position.z=0;var s,a=BABYLON.Mesh.MergeMeshes([i,n],!0);a.getScene().removeMesh(a),e.waterbottle2_bottle=a,(s=e.waterbottle2_labeloutside.clone("waterbottle2_labeloutside_rg0")).makeGeometryUnique(),s.material=o.discard_alpha2,s.registerInstancedBuffer("color",4),s.instancedBuffers.color=new BABYLON.Color4(1,1,1,1),s.registerInstancedBuffer("tileOffset",4),s.instancedBuffers.tileOffset=new BABYLON.Vector4(1,1,1,1),t.removeMesh(s),e.waterbottle2_labeloutside_rg0=s,(s=e.waterbottle2_labeloutside.clone("waterbottle2_labeloutside_rg1")).makeGeometryUnique(),s.material=o.discard_alpha2,s.registerInstancedBuffer("color",4),s.instancedBuffers.color=new BABYLON.Color4(1,1,1,1),s.registerInstancedBuffer("tileOffset",4),s.instancedBuffers.tileOffset=new BABYLON.Vector4(1,1,1,1),t.removeMesh(s),s.renderingGroupId=1,e.waterbottle2_labeloutside_rg1=s},WaterBottle2Config.prototype.getTextureDrawFunctions=function(t){var e=function(t,e,o){t.beginPath(),t.rect(0,0,e,o),t.fillStyle="rgba(255, 255, 255, .33)",t.fill()};t.waterTile=e;e=function(t,e,o){t.beginPath(),t.rect(0,0,e,o),t.fillStyle="rgba(255, 255, 255, .01)",t.fill()},e=function(t,e,o){i.CanvasDraw.DrawLogoPattern(t,e,o,"rgba(255, 255, 255, 0)","rgba(255, 255, 255, .8)",50,120,.8,.8*.7)};t.waterBottleLabel2=e},WaterBottle2Config.prototype.getChildSPSData=function(t){t[this.objName]||(t[this.objName]={}),t[this.objName][this.objName+"_bottle"]=1,t[this.objName][this.objName+"_cap"]=1,t[this.objName][this.objName+"_holder"]=1,t[this.objName][this.objName+"_waterline"]=1},WaterBottle2Config.prototype.getSPSData=function(t){var e=this.objName;t.push({shapeName:e,meshName:"waterBottleButton",numInstances:this.maxObjects,maxInstances:this.maxObjects,isPickable:!0,hideButton:!0}),t.push({shapeName:e+"_bottle",meshName:"waterbottle2_bottle",numInstances:this.maxObjects,maxInstances:this.maxObjects,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0}),t.push({shapeName:e+"_cap",meshName:"waterbottle2_cap",numInstances:this.maxObjects,maxInstances:this.maxObjects}),t.push({shapeName:e+"_holder",meshName:"waterbottle2_holder",numInstances:this.maxObjects,maxInstances:this.maxObjects}),t.push({shapeName:e+"_waterline",meshName:"waterbottle_waterline",numInstances:this.maxObjects,maxInstances:this.maxObjects,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0}),t.push({shapeName:e,meshName:"waterBottleMenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:e+"_bottle",meshName:"waterbottle2_bottle",numInstances:1,maxInstances:1,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:e+"_cap",meshName:"waterbottle2_cap",numInstances:1,maxInstances:1,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:e+"_holder",meshName:"waterbottle2_holder",numInstances:1,maxInstances:1,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:e+"_waterline",meshName:"waterbottle_waterline",numInstances:1,maxInstances:1,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0,renderingGroupID:i.App.menuRenderingGroupID})},WaterBottle2Config.prototype.getz1064Items=function(t){t.push(new i.MenuItemInfo({id:this.objName,objectName:this.objName,category:"WaterBottles",order:2,countLabelY:-.4,offsetY:.25,menuHeight:2}))},WaterBottle2Config}();i.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(){function WaterBottleConfig(){}return WaterBottleConfig.prototype.initObjectPool=function(t){ObjectPool.addClass("waterbottle_spout_rg0",z1069,{meshName:"waterbottle_spout_rg0"}),ObjectPool.addClass("waterbottle_spout_rg1",z1069,{meshName:"waterbottle_spout_rg1",renderingGroupID:1})},WaterBottleConfig.prototype.getCreateMeshFunctions=function(t){t.waterbottle_spout_rg0=this._createMeshes,t.waterbottle_spout_rg1=this._createMeshes},WaterBottleConfig.prototype._createMeshes=function(t,e,o){var i=o.hiSpecMat,n=e.waterbottle_spout;n.position.x=0,n.position.y=0,n.position.z=0;var s=n.clone("waterbottle_spout_rg0");s.makeGeometryUnique(),s.material=i,s.registerInstancedBuffer("color",4),s.instancedBuffers.color=new BABYLON.Color4(1,0,0,1),t.removeMesh(s),e.waterbottle_spout_rg0=s,(s=n.clone("waterbottle_spout_rg1")).material=i,s.registerInstancedBuffer("color",4),s.instancedBuffers.color=new BABYLON.Color4(1,0,0,1),t.removeMesh(s),s.renderingGroupId=1,e.waterbottle_spout_rg1=s},WaterBottleConfig}();t.App.AddEntityConfig(new e)}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z742(){return null!==t&&t.apply(this,arguments)||this}return __extends(z742,t),z742.prototype.update=function(t){var e=t.bottle;e&&e.addz1062(t)},z742}(z767),e.z742=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z698(){return null!==t&&t.apply(this,arguments)||this}return __extends(z698,t),z698.prototype.update=function(t){t.levels.chew.resetRandom()},z698}(z767),e.z698=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z518(){return null!==t&&t.apply(this,arguments)||this}return __extends(z518,t),z518.prototype.update=function(t){var e=t.bottle;e&&e.removez1062(t)},z518}(z767),e.z518=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z499(){return null!==t&&t.apply(this,arguments)||this}return __extends(z499,t),z499.prototype.update=function(t){t.bottle=null},z499}(z767),e.z499=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z438(){return null!==t&&t.apply(this,arguments)||this}return __extends(z438,t),z438.prototype.update=function(t){t.bottle=t.targetObject},z438}(z767),e.z438=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z384(){var t=null!==e&&e.apply(this,arguments)||this;return t.pawRotTar=BABYLON.Quaternion.RotationYawPitchRoll(0,2.7,0),t.yaw=0,t.pitch=2.7,t.roll=0,t.poleTargetX=-.9,t.poleTargetY=.3,t.poleTargetZ=-.9,t.poleAng=1.3,t}return __extends(z384,e),z384.prototype.update=function(t){BABYLON.Quaternion.RotationYawPitchRollToRef(this.yaw,this.pitch,this.roll,this.pawRotTar);var e=t.bones.legFR,o=t.bones.legFL;o.targetPoleAngle=-this.poleAng,e.targetPoleAngle=this.poleAng;var i=t.bones.head.angToTar,n=.05*Math.PI;e.targetPositionLerp=.05,o.targetPositionLerp=.05;var s=t.getStandFracSmooth();if(.3<t.getStandFracFront()&&.4<s&&i<n&&-n<i){var a=t.targets.destTarget;e.setTargetPosition(a),o.setTargetPosition(a),e.setPawRotationTarget(this.pawRotTar),o.setPawRotationTarget(this.pawRotTar),e.updatePose(),o.updatePose()}else t.poseFrontLegs(),t.rotatePawDown(t.bones.legFR),t.rotatePawDown(t.bones.legFL)},z384}(z767),e.z384=o}(z0||(z0={})),function(C){var t,e;t=C.z156||(C.z156={}),e=function(e){function z288(){var t=null!==e&&e.apply(this,arguments)||this;return t.distToBottle=.14*3.6,t.dirX=Math.sin(Math.PI/180*60),t.dirZ=Math.cos(Math.PI/180*60),t}return __extends(z288,e),z288.prototype.update=function(t){var e=t.physics.rearBody.body.position,o=t.physics.rearBody.target,i=z767.z4[0],n=t.bottle;if(n){var s=n.parent,a=n.frontDir,r=n.spoutPosition;if(n.getDirToBottle(e.x,e.z,i),BABYLON.Vector3.Dot(i,n.frontDir)<this.dirZ){var c=z767.z4[1],d=z767.z4[2],p=z767.z4[3];p.x=a.x,p.y=a.y,p.z=a.z,d.x=0,d.y=1,d.z=0,BABYLON.Vector3.CrossToRef(p,d,c);var l=i.x,u=i.y,y=i.z,g=l*c.x+u*c.y+y*c.z,m=l*d.x+u*d.y+y*d.z,f=(p.x,p.y,p.z);g=g<0?-this.dirX:this.dirX,f=this.dirZ,i.x=g*c.x+m*d.x+f*p.x,i.y=g*c.y+m*d.y+f*p.y,i.z=g*c.z+m*d.z+f*p.z}var A=this.distToBottle,b=t.physics.rearBody.body.position,v=r.y-b.y,x=this.distToBottle;A=.2*.2<x*x-v*v?Math.sqrt(x*x-v*v):.2,o.x=r.x+i.x*A,o.z=r.z+i.z*A,o.y=s.getHeightAt(o.x,o.z),o.frameNum=C.app.frameNum}},z288}(z767),t.z288=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z237(){return null!==t&&t.apply(this,arguments)||this}return __extends(z237,t),z237.prototype.update=function(t){if(!t.avoidingObject){var e=t.targetObject;if(e){var o=t.targets,i=e.parent;if(i&&t.currentObject==i){o.moveToTarget.copyFrom(e.spoutPosition);var n=t.size;o.moveToTarget.x+=e.frontDir.x*n,o.moveToTarget.z+=e.frontDir.z*n,i.bedding?o.moveToTarget.y=i.bedding.mesh.getHeightAtCoordinates(o.moveToTarget.x,o.moveToTarget.z):o.moveToTarget.y=i.position.y,o.moveToTarget.y+=t.size,o.lookToTarget.copyFrom(e.spoutPosition),o.standToTarget.copyFrom(e.spoutPosition)}}}},z237}(z767),e.z237=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z236(){return null!==t&&t.apply(this,arguments)||this}return __extends(z236,t),z236.prototype.update=function(t){var e=t.targetObject,o=t.targets,i=e.spoutPosition,n=t.physics.rearBody.body,s=n.position;o.moveToTarget.copyFrom(i),o.destTarget.copyFrom(i),o.lookToTarget.copyFrom(i);var a=t.physics.frontBody.rotationElements;o.lookToTarget.x+=.05*a[1],o.lookToTarget.y+=.05*a[4],o.lookToTarget.z+=.05*a[7],o.standToTarget.copyFrom(i),o.minStandY=s.y+4*t.size,o.minStandYFront=n.position.y},z236}(z767),e.z236=o}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(o){function z186(){var t=null!==o&&o.apply(this,arguments)||this;return t.accType=e.z1044.z1056,t}return __extends(z186,o),z186.prototype.update=function(t){if(o.prototype.update.call(this,t),!t.isFollowingPath()&&t.targetObject&&t.targetObject.targetPosition&&t.targetObject.isOnScene){var e=t.targetObject.targetPosition;t.cage&&t.cage.isInBox(e.x,e.y,e.z)&&(t.targets.destTarget.equals(t.targetObject.targetPosition)||t.targets.destTarget.copyFrom(t.targetObject.targetPosition))}},z186}(t.z200),t.z186=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z160(){return null!==t&&t.apply(this,arguments)||this}return __extends(z160,t),z160.prototype.update=function(t){t.levels.water.resetRandom()},z160}(z767),e.z160=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z159(){return null!==t&&t.apply(this,arguments)||this}return __extends(z159,t),z159.prototype.update=function(t){var e=t.levels.water.maxValue;t.levels.water.value=.8*e+Math.random()*e*.2},z159}(z767),e.z159=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z158(){return null!==t&&t.apply(this,arguments)||this}return __extends(z158,t),z158.prototype.update=function(t){t.levels.water.resetRandom(1,.5)},z158}(z767),e.z158=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z157(){return null!==t&&t.apply(this,arguments)||this}return __extends(z157,t),z157.prototype.update=function(t){t.levels.water.step(1)},z157}(z767),e.z157=o}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z991(){return null!==t&&t.apply(this,arguments)||this}return __extends(z991,t),z991.prototype.test=function(t){var e=t.memory.getAccessories(o.z1044.z1056);return!(!e||0==e.length)},z991}(z770),t.z991=e}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z953(){return null!==t&&t.apply(this,arguments)||this}return __extends(z953,t),z953.prototype.test=function(t){var e=o.app.getDragged();return!(!e||e!=t.bottle)},z953}(z770),t.z953=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z907(){return null!==t&&t.apply(this,arguments)||this}return __extends(z907,t),z907.prototype.test=function(t){var e=t.targetObject;if(!e)return!1;var o=e.spoutPosition,i=t.bones.mouth;i.update();var n=i.worldPos,s=z770.z4[0];s.x=o.x,s.y=o.y,s.z=o.z;var a=s.x-n.x,r=s.y-n.y,c=s.z-n.z,d=a*a+r*r+c*c,p=.5*t.size;return d<p*p},z907}(z770),e.z907=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z832(){return null!==t&&t.apply(this,arguments)||this}return __extends(z832,t),z832.prototype.test=function(t){var e=t.levels.water;return e.value==e.maxValue},z832}(z770),e.z832=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z780(){return null!==t&&t.apply(this,arguments)||this}return __extends(z780,t),z780.prototype.test=function(t){return!(!t.targetObject||!t.targetObject.spoutPosition)},z780}(z770),e.z780=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z772(){return null!==t&&t.apply(this,arguments)||this}return __extends(z772,t),z772.prototype.test=function(t){var e=t.targetObject;if(!e)return!1;if(t.cage!=e.cage)return!1;var o=e.spoutPosition,i=t.physics.frontBody.body.position,n=z770.z4[0];n.x=o.x,n.y=o.y,n.z=o.z;var s=t.size;n.x+=e.frontDir.x*s,n.z+=e.frontDir.z*s;var a=n.x-i.x,r=n.y-i.y,c=n.z-i.z,d=a*a+c*c,p=1.5*t.size,l=p*p;if(1<r){var u=t.platformAbove;if(u&&n.y>u.position.y)return}else if(r<-.5){var y=t.platformUnder;if(y&&n.y<y.position.y)return}return d<l},z772}(z770),e.z772=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z771(){return null!==t&&t.apply(this,arguments)||this}return __extends(z771,t),z771.prototype.test=function(t){var e=t.targetObject;if(!e)return!1;var o=e.spoutPosition,i=t.physics.frontBody.body.position,n=z770.z4[0];n.x=o.x,n.y=o.y,n.z=o.z;var s=n.x-i.x,a=n.z-i.z,r=s*s+a*a,c=2*t.size;return r<c*c},z771}(z770),e.z771=o}(z0||(z0={})),function(o){var t=function(e){function z12(){var t=null!==e&&e.apply(this,arguments)||this;return t.updatez156=[o.z156.z186,o.z156.z237,o.z156.z406],t.transitions=[{condition:o.z768.z951,falseNode:{condition:o.z768.z780,trueNode:{condition:o.z768.z772,trueNode:{state:o.z10,actions:[o.z156.z425]}}}},{condition:o.z768.z882,trueNode:{condition:o.z768.z880,falseNode:{state:o.z34,actions:[o.z156.z483,o.z156.z470]}}}],t}return __extends(z12,e),z12}(z49);o.z12=t}(z0||(z0={})),function(o){var t=function(e){function z11(){var t=null!==e&&e.apply(this,arguments)||this;return t.states=[o.z12,o.z10],t.updatez156=[o.z156.z208,o.z156.z209,o.z156.z532,o.z156.z733,o.z156.z734],t.exitz156=[o.z156.z502,o.z156.z470],t.transitions=[{condition:o.z768.z832,trueNode:{state:o.z112}},{condition:o.z768.z991,falseNode:{state:o.z112}}],t.initialState=o.z12,t}return __extends(z11,e),z11}(z49);o.z11=t}(z0||(z0={})),function(o){var t=function(e){function z10(){var t=e.call(this)||this;return t.enterz156=[o.z156.z408,o.z156.z438,o.z156.z742,o.z156.z483,o.z156.z158],t.updatez156=[o.z156.z507,o.z156.z543,o.z156.z700,o.z156.z236,o.z156.z288,o.z156.z568,o.z156.z384,o.z156.z384,o.z156.z157],t.states=[],t.exitz156=[o.z156.z502,o.z156.z518,o.z156.z499,o.z156.z159],t.transitions=[{condition:o.z768.z780,falseNode:{state:o.z12}},{condition:o.z768.z771,falseNode:{state:o.z12,actions:[]}},{condition:o.z768.z953,trueNode:{state:o.z12,actions:[]}}],t}return __extends(z10,e),z10}(z49);o.z10=t}(z0||(z0={})),function(b){var t=function(y){function Wheel(){var t=y.call(this)||this;t.accType=b.z1044.z1054,t.num=0,t.centerGraphNode=new GraphNode(0,0,0),t.thickness=0,t.nodes=[],t.computeUpVec=!0,t.cage=void 0,t._rotationMatrix=BABYLON.Matrix.Identity(),t.shapes=[],t.vel=0,t.acc=.04,t.angVel=0,t.ang=0,t.lastAng=0,t.radius=0,t.height=0,t.halfHeight=0,t.curveRadius=0,t.base=void 0,t.baseHeight=.1,t.axisMat=new OIMO.Mat33,t.mapPlacementInfo=new b.MapPlacementInfo({mapPlacementSizeX:.25,mapOffsetDropTargetY:.5,mapOffsetY:-.5}),t.sideBumperR=void 0,t.sideBumperL=void 0,t.bottomBumper=void 0,t.sideBumperRMesh=void 0,t.sideBumperLMesh=void 0,t.bottomBumperMesh=void 0,t.navigatorR=void 0,t.navigatorL=void 0,t.hamSpeedConv=26.6,t.maxSpeedFrac=1,t.minVel=3,t.maxVel=30,t.pubsub=new Pubsub,t.targetPosition=BABYLON.Vector3.Zero(),t.doApplyForceToHam=!0,t.forceToHamFrac=1,t.hitHeight=1,t._hitz7671=z641.getz767(b.z156.z230),t._hitz7672=z641.getz767(b.z156.z729),t.updated=new z1072Set,t.diagonalNodes=[],t.wallNode=void 0,t.fric=.98,t.fricAcc=.01,t._tempArr=[],t.maxz1062s=4,t.hamsters=new z1072,t.placementType=b.PlacementType.GRID|b.PlacementType.z1048|b.PlacementType.BACK|b.PlacementType.ALIGN_BOTTOM,t.canRotate=!1,t.canTranslate=!0,Wheel.count++,t.num=Wheel.count,(t.centerGraphNode.data.obj=t).centerGraphNode.data.enterEvent=b.WheelEvents.ENTER;var e=new GraphNode(0,0,0);e.data.enterEvent=b.WheelEvents.ENTER,e.data.obj=t,e.data.enterNextNode=t.centerGraphNode,t.nodes.push(e),b.app.graph.addNode(e);return e.addConnection(t.centerGraphNode,.5),((e=new GraphNode(0,0,0)).data.obj=t).nodes.push(e),b.app.graph.addNode(e),e.addConnection(t.nodes[0],.5),t.nodes[0].addConnection(e,.5),t.centerGraphNode.addConnection(e,.5),b.app.graph.addNode(t.centerGraphNode),t.boundsMax=new BABYLON.Vector3(100,100,100),t.boundsMin=new BABYLON.Vector3(-100,-100,-100),t.color=new BABYLON.Color4(1,1,1,.6),t.rotation=BABYLON.Vector3.Zero(),t.bindedKeepPosInside=t.keepPosInside.bind(t),t}return __extends(Wheel,y),Wheel.prototype.init=function(t){y.prototype.init.call(this,t);this.addToActiveObjects();var e=this.shapeName+this.num,o=0,i=0,n=1;t.x&&(o=t.x),t.y&&(i=t.y),t.scale&&(n=t.scale),this.radius=t.radius*n,this.height=t.height,this.halfHeight=.5*this.height,this.thickness=.08,this.curveRadius=t.curveRadius*n,this.hamSpeedConv=26.6/this.radius,this.mapPlacementInfo.offsetDragFromMenuY=-this.radius,this.controlAnchor||this.addControlAnchor(),this.controlPositionLocal.x=0,this.controlPositionLocal.y=.65*this.radius,this.controlPositionLocal.z=this.halfHeight,this.isMenuItem&&(this.controlPositionLocal.y=1.65*this.radius);var s,a=b.App.z1033;s=180*Math.PI/Math.PI;var r=this.baseHeight;if(!this.base&&!this.isMenuItem){this.world=t.world,this.base=new OIMO.Body({type:"box",size:[10,10,10],pos:[o,i-(this.radius+r)+0,1.5],rot:[0,s,0],move:!1,world:this.world,name:e+"_base"});var c=[.03,0,.2,a,4294967295],d=new OIMO.Body({size:[this.radius,this.height,this.curveRadius,this.thickness],pos:[o,i+0,1.5],rot:[-90,180+s,0],world:this.world,type:"bowl",move:!0,name:e+"_wheel",config:c});this.body=d.body,this.body.shapes.entity=this,new OIMO.Link({type:"jointWheel",body1:e+"_base",body2:e+"_wheel",pos1:[0,r+this.radius,0],axe1:[0,1,0],axe2:[0,1,0],limit:[0,0],world:this.world}),this.axisMat.copy(this.body.rotation),this.pubsub.subscribe("hit",this.onHit,this),this.body.shapes.pubsub=this.pubsub;var p=1.5*this.halfHeight;this.navigatorL=new b.WheelNavigator,this.navigatorL.init({accessory:this,radius:p,side:-1}),this.navigatorR=new b.WheelNavigator,this.navigatorR.init({accessory:this,radius:p,side:1})}if(this.body&&this.body.angularVelocity.scaleEqual(0),!this.hitMeshes&&!t.isMenuItem){this.hitMeshes=[],this.radius,t.scale;var l=2.05*n;this.hitHeight=l;var u=b.app.graphicsHelper.getHitMesh(l,l,.9,!1);u.setPivotPoint(new BABYLON.Vector3(0,0,0)),u.rotationQuaternion=BABYLON.Quaternion.Identity(),this.hitMeshes.push(u)}this.setRotation(0,s*Math.PI/180,0),this.setPosition(o,i,1.5),t.isMenuItem?this.removeFromScene():t.skipAddToScene||this.addToScene(),this.isMenuItem||this._debugPubsub},Wheel.prototype.onHit=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(t[8]&&t[8].actor){var o=t[8].actor.rodent,i=t[8].parent;i.name,t[7];if(i!=o.physics.headBody.body){var n=o.physics.frontBody.body.position,s=this.body.position;if(!(n.z<s.z-this.halfHeight-.7*o.size)){var a=n.x-s.x,r=n.y-s.y,c=a*a+r*r,d=this.radius-.25*o.size;d*d<c||this.updated.push(o,o.id,b.app.frameNum)&&(o.isOnWheel=!0,0==o.runSpeedFrac&&(o.runSpeedFrac,this._hitz7671.update(o,this),this._hitz7672.update(o,this)),this.applyWheelForceToHam(o))}}}},Wheel.prototype.applyWheelForceToHam=function(t){if(this.doApplyForceToHam){var e=t.physics,o=e.middleBody.rotationElements,i=e.frontBody.rotationElements,n=Wheel.tempVecs[3],s=Wheel.tempVecs[4];n.x=o[1],n.y=o[4],n.z=o[7],s.x=i[2],s.y=i[5],s.z=i[8];var a=Wheel.tempVecs[5];this.getForceDirectionAt(e.frontBody.body.position,a),a.scaleEqual(-1);var r=a.dot(s);1<r&&(r=1);var c=Math.acos(r)/1.57;1<c?c=1:c<0&&(c=0);var d=Math.abs(this.body.angularVelocity.z),p=(d-t.runSpeedFrac*this.hamSpeedConv)/d;1<p?p=1:p<0&&(p=0),t.tripping;var l=p+c;1<(l*=.02)&&(l=1);var u=e.frontBody.body.linearVelocity.x,y=e.frontBody.body.linearVelocity.y,g=e.frontBody.body.linearVelocity.z;56.25<u*u+y*y+g*g||0<l&&(this.applyForceToz1062Body(e.frontBody.body,l,!1),this.applyForceToz1062Body(e.rearBody.body,l))}},Wheel.prototype.setPositionOnMapFromDrop=function(t,e,o){var i=this._tempDropLoc;this.getPositionOnMapFromDropToRef(t,e,o,i),this.setPositionDrag(i.x,i.y,i.z,!0),this.setPosition(i.x,i.y,i.z),this.updateCage(),this.setToFloor(e)},Wheel.prototype.setPositionDrag=function(t,e,o,i){void 0===i&&(i=!1);var n=t-this.position.x,s=e-this.position.y,a=o-this.position.z;y.prototype.setPositionDrag.call(this,t,e,o,i);var r=Wheel.z4[0],c=Wheel.z4[1];r=Wheel.z4[0],c=Wheel.z4[1];if(r.x=0,r.y=this.radius+this.baseHeight,(r.z=0)==this.rotation.x&&0==this.rotation.z||BABYLON.Vector3.TransformCoordinatesToRef(r,this._rotationMatrix,r),c.x=0,c.y=0,(c.z=0)==this.rotation.x&&0==this.rotation.z||BABYLON.Vector3.TransformCoordinatesToRef(c,this._rotationMatrix,c),this.shapes[0].setPosition(t+c.x,e+c.y,o+c.z),d=this.body){var d,p,l;(p=d.position).x+=n,p.y+=s,p.z+=a,(l=d.shapes.position).x=p.x,l.y=p.y,l.z=p.z,d.shapes.updateProxy();for(u=1;u<this.shapes.length;u++)this.shapes[u].setPosition(p.x,p.y,p.z);(p=(d=this.base.body).position).x+=n,p.y+=s,p.z+=a,(l=d.shapes.position).x=p.x,l.y=p.y,l.z=p.z,d.shapes.updateProxy()}else for(var u=1;u<this.shapes.length;u++)this.shapes[u].setPosition(t+r.x,e+r.y,o+r.z);this.setHitMesh(t,e,o),this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position)},Wheel.prototype.setHitMesh=function(t,e,o){if(this.hitMeshes&&this.hitMeshes[0]){var i=Wheel.z4[0],n=this.hitMeshes[0];i.x=0,i.y=.5*this.hitHeight,(i.z=0)==this.rotation.x&&0==this.rotation.z||BABYLON.Vector3.TransformCoordinatesToRef(i,this._rotationMatrix,i),n.position.x=t+i.x,n.position.y=e+i.y,n.position.z=o+i.z,n.computeWorldMatrix()}},Wheel.prototype.getFloorY=function(t,e,o){var i=this.cage;if(i||(i=b.Cage.getCageAt(t,e,o)),i){var n=i.position.y+i.height-i.wallThickness,s=i.getPlatformUnder(t,Math.min(e+1.5*this.radius,n),o);e=i.getMinYBetween(t-(this.radius-.3),t+(this.radius-.3)),s&&s.position.y>e&&(e=s.position.y+.04);var a=2*this.radius+this.baseHeight+.05,r=i.getObjectAt(t,e+a,o,b.z1044.z1049,.5);r&&r.position.x>t-this.radius&&r.position.x<t+this.radius&&r.position.y>e&&r.position.y<e+a&&(e=r.position.y-a);var c=i.position.y+i.height-i.wallThickness-2*this.radius-this.baseHeight,d=i.floorY;c<e&&(e=c),e<d&&(e=d)}return e},Wheel.prototype.setToFloor=function(t){var e=this.position.x,o=this.position.z,i=this.getFloorY(e,t,o);i!=this.position.y?this.setPosition(e,i,o):this.refreshConnections()},Wheel.prototype.refreshConnections=function(){this.disconnect(),this.updateNodes(),this.checkConnections()},Wheel.prototype.setPosition=function(t,e,o){this.isMenuItem||this.isMenuItem;var i=null;this.body&&(i=b.Cage.getCageAt(t,e+.1,o),this.cage!=i&&this.addToObject(i));for(var n=e-this.position.y,s=0;s<this.hamsters.length;s++){this.hamsters.data[s].translate(0,n,0)}this.position.x=t,this.position.y=e,this.position.z=o;var a=Wheel.z4[0],r=Wheel.z4[1];a.x=0,a.y=this.radius+this.baseHeight,(a.z=0)==this.rotation.x&&0==this.rotation.z||BABYLON.Vector3.TransformCoordinatesToRef(a,this._rotationMatrix,a),r.x=0,r.y=0,(r.z=0)==this.rotation.x&&0==this.rotation.z||BABYLON.Vector3.TransformCoordinatesToRef(r,this._rotationMatrix,r);for(s=1;s<this.shapes.length;s++)this.shapes[s].setPosition(t+a.x,e+a.y,o+a.z);if(this.targetPosition.copyFrom(this.shapes[1].position),this.shapes[0].setPosition(t+r.x,e+r.y,o+r.z),this.body){this.body.position.x=t+a.x,this.body.position.y=e+a.y,this.body.position.z=o+a.z;var c,d=this.base.body.position;if(d.x=t+r.x,d.y=e+r.y,d.z=o+r.z,this.disconnect(),this.updateNodes(),this.checkConnections(),this.navigatorL&&this.navigatorL.setPosition(t,e,o),this.navigatorR&&this.navigatorR.setPosition(t,e,o),this.sideBumperL&&(c=this.sideBumperL.shapes.radius,a.x=-this.radius+c,a.y=1*c,a.z=0*c,0==this.rotation.x&&0==this.rotation.z||BABYLON.Vector3.TransformCoordinatesToRef(a,this._rotationMatrix,a),this.sideBumperL.position.x=t+a.x,this.sideBumperL.position.y=e+a.y,this.sideBumperL.position.z=o+a.z,this.sideBumperL.syncShapes(),this.sideBumperLMesh&&(this.sideBumperLMesh.position.x=this.sideBumperL.position.x,this.sideBumperLMesh.position.y=this.sideBumperL.position.y,this.sideBumperLMesh.position.z=this.sideBumperL.position.z)),this.sideBumperR&&(a.x=this.radius-c,a.y=1*c,a.z=0*c,0==this.rotation.x&&0==this.rotation.z||BABYLON.Vector3.TransformCoordinatesToRef(a,this._rotationMatrix,a),this.sideBumperR.position.x=t+a.x,this.sideBumperR.position.y=e+a.y,this.sideBumperR.position.z=o+a.z,this.sideBumperR.syncShapes(),this.sideBumperRMesh&&(this.sideBumperRMesh.position.x=this.sideBumperR.position.x,this.sideBumperRMesh.position.y=this.sideBumperR.position.y,this.sideBumperRMesh.position.z=this.sideBumperR.position.z)),this.bottomBumper){var p=e-this.cage.position.y;this.bottomBumper.position.x=t,this.bottomBumper.position.y=.5*p+this.cage.position.y,this.bottomBumper.position.z=o,this.bottomBumper.shapes.halfHeight=.5*p,this.bottomBumper.syncShapes(),this.bottomBumperMesh&&(this.bottomBumperMesh.position.x=this.bottomBumper.position.x,this.bottomBumperMesh.position.y=this.bottomBumper.position.y,this.bottomBumperMesh.position.z=this.bottomBumper.position.z,this.bottomBumperMesh.scaling.y=p)}}this.setHitMesh(t,e,o),this.hitMeshes&&this.hitMeshes[0]&&BABYLON.Vector3.TransformCoordinatesToRef(this.controlPositionLocal,this.hitMeshes[0].getWorldMatrix(),this.controlAnchor.position),this.onChangeObservable.notifyObservers(this)},Wheel.prototype.addToObject=function(t){this.cage&&this.cage!=t&&this.cage.removeObject(this),this.parent=t,(this.cage=t)&&(this.disconnect(),this.updateNodes(),t.addObject(this),this.checkConnections(),this.setEnabledConnectors(!1))},Wheel.prototype.setEnabledConnectors=function(t){this.cage},Wheel.prototype.checkCageConnections=function(){var t=this.nodes[0],e=this.cage;if(e){var o=Wheel.tempArr;o.length=0;var i,n=b.z1044.z1048;if(e.bedding){if(n=b.z1044.z1047,i=e.getPlatformUnder(t.x,t.y,t.z)){var s=e.bedding.getHeightAt(t.x,t.z);i.position.y>s&&(n=b.z1044.z1049)}}else(i=e.getPlatformUnder(t.x,t.y,t.z))&&(n=b.z1044.z1049);e.getGraphNodesAtToRef(o,t.x,t.y,t.z,null,null,null,null,.75,n);for(var a=0;a<o.length;a++){var r=o[a];r.data;var c=r.x-t.x,d=r.y-t.y,p=r.z-t.z,l=Math.sqrt(c*c+d*d+p*p);t.addConnection(r,l),r.addConnection(t,l)}}},Wheel.prototype.checkBridgeConnections=function(){if(this.cage)for(var t=0;t<this.cage.objs.length;t++){var e=this.cage.objs[t];e.accType==b.z1044.z1050&&e.checkWheelConnection()}},Wheel.prototype.checkConnections=function(){this.checkCageConnections(),this.checkBridgeConnections()},Wheel.prototype.updateNodes=function(){if(this.body){var t=this.centerGraphNode;t.x=this.body.position.x,t.y=this.body.position.y,t.z=this.body.position.z;var e=1*this.radius,o=1*this.height,i=this.base.body.position,n=i.x,s=i.y,a=i.z,r=this.base.body.rotation.elements,c=0*e+.3,d=.5*o+.2,p=0*r[0]+c*r[1]+d*r[2]+n,l=0*r[3]+c*r[4]+d*r[5]+s,u=0*r[6]+c*r[7]+d*r[8]+a,y=this.nodes[0];this.cage&&l<this.cage.floorY+.1&&(l=this.cage.floorY+.1),y.x=p,y.y=l,y.z=u;var g=0*e,m=.3*o,f=0*r[0]+g*r[1]+m*r[2]+n,A=(r[3],r[4],r[5],0*r[6]+g*r[7]+m*r[8]+a),b=this.nodes[1];b.x=f,b.y=l+.1,b.z=A,t.y=b.y+.1}},Wheel.prototype.update=function(){if(this.body){this.body.angularVelocity.z;this.hamsters.length&&(this.acc/=this.hamsters.length),this.body.angularVelocity.z+=this.acc;var t=this.hamSpeedConv*this.maxSpeedFrac;this.body.angularVelocity.z>t?this.body.angularVelocity.z=t:this.body.angularVelocity.z<-t&&(this.body.angularVelocity.z=-t);var e=.995;0<this.hamsters.length&&(e=.99),this.body.angularVelocity.scaleEqual(e),this.acc=0}},Wheel.prototype.getGraphNodeAt=function(t,e,o){return this.centerGraphNode},Wheel.prototype.getForceDirectionAt=function(t,e){var o=Wheel.tempVecs[1],i=Wheel.tempVecs[2],n=this.body,s=n.position,a=this.axisMat.elements,r=t.x-s.x,c=t.y-s.y,d=t.z-s.z,p=(a[0],a[3],a[6],r*a[1]+c*a[4]+d*a[7]),l=(a[2],a[5],a[8],0*a[0]+p*a[1]+0*a[2]),u=0*a[3]+p*a[4]+0*a[5],y=0*a[6]+p*a[7]+0*a[8];l+=s.x,u+=s.y,y+=s.z,o.x=t.x-l,o.y=t.y-u,o.z=t.z-y,o.normalize(o),i.x=a[1],i.y=a[4],i.z=a[7],e.cross(o,i);var g=n.angularVelocity;-(g.x*a[1]+g.y*a[4]+g.z*a[7])<0&&(e.x*=-1,e.y*=-1,e.z*=-1)},Wheel.prototype.applyForceToz1062Body=function(t,e,o){void 0===o&&(o=!1);var i=Wheel.tempVecs[0];this.getForceDirectionAt(t.position,i);var n=this.getForce()*e*this.forceToHamFrac;.35<n&&(n=.35),o&&(this.rayViewer||(this.rayViewer=new RayViewer(b.app.graphicsHelper.scene),this.rayViewer.mesh.color=new BABYLON.Color3(0,0,0)),this.rayViewer.update(t.position,i,1)),i.x*=n,i.y*=n,i.z*=n,t.linearVelocity.addEqual(i)},Wheel.prototype.getForceVectorAt=function(t,e){var o=e;this.getForceDirectionAt(t.position,o);var i=this.getForce();o.x*=i,o.y*=i,o.z*=i},Wheel.prototype.getForce=function(){var t=this.body.angularVelocity.z;t<0&&(t*=-1);var e=this.minVel;return(t-=e)<e&&(t=0),t},Wheel.prototype.rotate=function(t){void 0===t&&(t=.5*Math.PI)},Wheel.prototype.setRotation=function(t,e,o){this.rotation.x=t,this.rotation.y=e,this.rotation.z=o;var i=this.rotationQuaternion;BABYLON.Quaternion.RotationYawPitchRollToRef(e,t,o,i),i.toRotationMatrix(this._rotationMatrix);var n=Wheel.tempBabQuats[2],s=Wheel.z4[0];s.x=t,s.y=e,s.z=o,BABYLON.Quaternion.RotationYawPitchRollToRef(0,.5*Math.PI,0,n),i.multiplyToRef(n,n),n.toEulerAnglesToRef(s);for(var a=0;a<this.shapes.length;a++)this.shapes[a].setRotation(s.x,s.y,s.z);if(this.hitMeshes&&this.hitMeshes[0].rotationQuaternion.copyFrom(this.rotationQuaternion),this.body){var r=(i=this.shapes[0].rotationQuaternion).w;t=i.x,e=i.y,o=i.z;(A=this.body.orientation).s=r;var c=(A.x=t)*(v=2*t),d=(A.y=e)*(x=2*e),p=(A.z=o)*(C=2*o),l=t*x,u=e*C,y=t*C,g=r*v,m=r*x,f=r*C;(S=this.body.rotation.elements)[0]=1-d-p,S[1]=l-f,S[2]=y+m,S[3]=l+f,S[4]=1-c-p,S[5]=u-g,S[6]=y-m,S[7]=u+g,S[8]=1-c-d,this.body.shapes.updateProxy();r=(i=this.rotationQuaternion).w,t=i.x,e=i.y,o=i.z;var A,b=this.base.body;(A=b.orientation).s=r;var v,x,C,S;c=(A.x=t)*(v=2*t),d=(A.y=e)*(x=2*e),p=(A.z=o)*(C=2*o),l=t*x,u=e*C,y=t*C,g=r*v,m=r*x,f=r*C;(S=b.rotation.elements)[0]=1-d-p,S[1]=l-f,S[2]=y+m,S[3]=l+f,S[4]=1-c-p,S[5]=u-g,S[6]=y-m,S[7]=u+g,S[8]=1-c-d,b.shapes.updateProxy(),this.axisMat.copy(this.body.rotation)}this.onChangeObservable.notifyObservers(this)},Wheel.prototype.disconnect=function(){this.skipConnect=!0,this.wallNode&&(this.wallNode.type=void 0,z1083.ReconnectNodes(this.diagonalNodes),this.diagonalNodes.length=0,this.wallNode=void 0);for(var t=this.nodes[0],e=0;e<t.connections.length;e++){var o=t.connections[e];o.data.obj==t.data.obj&&o.data.obj2==t.data.obj2||(t.removeConnection(o),o.removeConnection(t),e--)}for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i];n.x=9999,n.y=9999,n.z=9999}this.centerGraphNode.x=9999,this.centerGraphNode.y=9999,this.centerGraphNode.z=9999,this.setEnabledConnectors(!0),this.skipConnect=!1},Wheel.prototype.onAfterDisconnect=function(t){if(t&&t.accType==b.z1044.z1049&&this.cage&&!this.cage.isDragging&&!t.isDragging){var e=this.position.y;this.setToFloor(this.position.y),e!=this.position.y&&b.app.saveDataItem(this)}},Wheel.prototype.addToActiveObjects=function(){-1==Wheel.activeObjects.indexOf(this)&&Wheel.activeObjects.push(this)},Wheel.prototype.removeFromActiveObjects=function(){var t=Wheel.activeObjects.indexOf(this);-1!=t&&Wheel.activeObjects.splice(t,1)},Wheel.prototype.recycle=function(){this.setEnabledConnectors(!0),this.cage&&this.cage.removeObject(this),this.setPosition(9999,9999,9999),this.disconnect(),this.hideBoundingBox(),this.removeFromScene();for(var t=0;t<this.shapes.length;t++)this.shapes[t].removeFromScene();this.hamsters.length=0,this.hamsters.clean(),this.onChangeObservable.clear(),this.removeFromActiveObjects(),ObjectPool.recycle(this)},Wheel.prototype.faceCamera=function(t){var e=Wheel.tempBabMat;this.rotationQuaternion.toRotationMatrix(e),e.setTranslation(this.position);var o=BABYLON.Vector3.TransformCoordinates(t.position,BABYLON.Matrix.Invert(e)),i=Math.atan2(o.x,o.z),n=.5*Math.PI,s=Math.round(i/n)*n;this.setRotation(this.rotation.x,this.rotation.y+s,this.rotation.z)},Wheel.prototype.addToScene=function(){if(!this.isOnScene){y.prototype.addToScene.call(this);for(var t=0;t<this.shapes.length;t++)this.shapes[t].addToScene()}},Wheel.prototype.removeFromScene=function(){if(this.isOnScene){y.prototype.removeFromScene.call(this);for(var t=0;t<this.shapes.length;t++)this.shapes[t].removeFromScene()}},Wheel.prototype.getCenterAtPosToRef=function(t,e,o,i){i.x=t,i.y=e+this.radius,i.z=o},Wheel.prototype.isInWheel=function(t,e,o,i){void 0===i&&(i=0);var n=this.body,s=n.rotation.elements,a=n.position,r=t-a.x,c=e-a.y,d=o-a.z,p=r*s[0]+c*s[3]+d*s[6],l=r*s[1]+c*s[4]+d*s[7],u=r*s[2]+c*s[5]+d*s[8],y=p*p+u*u,g=i,m=g+this.radius,f=m*m,A=this.halfHeight+g;return!(f<y)&&!(A<l||l<-A)},Wheel.prototype.isInsideOuterWall=function(t,e,o,i){void 0===i&&(i=0);var n=this.body,s=n.rotation.elements,a=n.position,r=t-a.x,c=e-a.y,d=o-a.z,p=r*s[0]+c*s[3]+d*s[6],l=(s[1],s[4],s[7],r*s[2]+c*s[5]+d*s[8]),u=p*p+l*l,y=i+this.radius;return!(y*y<u)},Wheel.prototype.isInBox=function(t,e,o,i){void 0===i&&(i=0);var n=this.hitMeshes[0],s=t-n.position.x,a=e-n.position.y,r=o-n.position.z,c=this.halfHeight,d=this.radius+.1,p=this.radius+.1;return!(d<s||s<-d)&&(!(p<a||a<-p)&&!(c<r||r<-c))},Wheel.prototype.getPositionOnMapFromDropToRef=function(t,e,o,i){var n=this.mapPlacementInfo,s=this.hitMeshes[0].getBoundingInfo(),a=s.boundingBox.maximum.x,r=s.boundingBox.maximum.y,c=Wheel.z4[2];this.getCenterAtPosToRef(t,e,o,c),c.x=1*z1.round((c.x+n.mapOffsetDropTargetX)/1,n.mapPlacementSizeX)+n.mapOffsetX,c.y=1*z1.round((c.y+n.mapOffsetDropTargetY)/1,n.mapPlacementSizeY)+n.mapOffsetY;var d=b.Cage.getCageAt(c.x,c.y,c.z);if(d){d.position;var p=d.left,l=d.right,u=(d.top,d.bottom),y=t+a,g=e-r;t-a<p?t=p+a:l<y&&(t=l-a),e=this.getFloorY(t,e,o),g<u&&(e=u),t=1*z1.round((t+n.mapOffsetDropTargetX)/1,n.mapPlacementSizeX)+n.mapOffsetX,this.placementType&b.PlacementType.ALIGN_BACK&&(o-=.5*this.depth)}else t=1*z1.round((t+n.mapOffsetDropTargetX)/1,n.mapPlacementSizeX)+n.mapOffsetX,e=1*z1.round((e+n.mapOffsetDropTargetY)/1,n.mapPlacementSizeY)+n.mapOffsetY,this.placementType&b.PlacementType.ALIGN_BACK&&(o-=.5*this.depth);i.x=t,i.y=e,i.z=o},Wheel.prototype.isValidDropLocation=function(t,e,o,i){if(!(n=b.Cage.getCageAt(t,e+this.radius,o)))return!1;var n,s=this._tempDropLoc;if(this.getPositionOnMapFromDropToRef(t,e,o,s),!(n=b.Cage.getCageAt(s.x,s.y+this.radius,s.z)))return!1;if(2*this.radius>n.width)return!1;if(2*this.radius>n.height)return!1;if(i&&null!=i.dragPlatformY){if(s.y=i.dragPlatformY,n.position.y+n.height-s.y<2*this.radius)return!1}else{var a=n.getPlatformUnder(s.x,s.y+2*this.radius,s.z);if(a)if(n.position.y+n.height-a.position.y<2*this.radius)return!1;for(var r=this.radius,c=0;c<n.objs.length;c++){var d=n.objs[c];if(d.accType==b.z1044.z1049&&!(d.position.y<s.y||d.position.y>s.y+2*r)){var p=d.position.x-.5*d.width;if((l=s.x-p)*l<r*r)return!1;var l,u=d.position.x+.5*d.width;if((l=s.x-u)*l<r*r)return!1}}}var y=this.hitMeshes[0],g=y.position.x,m=y.position.y,f=y.position.z;this.setHitMesh(s.x,s.y,s.z);var A=this.intersectsAccesories(n.objs,b.z1044.z1055|b.z1044.z1054);return y.position.x=g,y.position.y=m,y.position.z=f,y.computeWorldMatrix(),!A},Wheel.prototype.addz1062=function(t){-1===this.hamsters.indexOf(t)&&this.hamsters.push(t)},Wheel.prototype.removez1062=function(t){this.hamsters.remove(t)},Wheel.prototype.placeHamOnWheel=function(t){if(2<=this.hamsters.length)return!1;var e=this.position;t.setPosition(e.x,e.y+.3,e.z);var o=.5*Math.PI,i=.48*this.radius;(t.targets.wheelDir=1,0==this.hamsters.length)?.5<Math.random()?(o*=-1,i*=-1,t.targets.wheelDir=-1,this.body.angularVelocity.z=20*Math.random()):this.body.angularVelocity.z=20*-Math.random():this.hamsters.data[0].targets.wheelDir<0&&(o*=-1,i*=-1,t.targets.wheelDir=-1);t.setRotation(0,o,0);var n=this.body.position;return t.targets.destTarget.set(n.x+i,n.y,n.z),t.targets.setTargetsToDestination(),t.currentObject=this,t.targetObject=this,t.path.length=0,t.pathIndex=0,t.path[0]=this.centerGraphNode,t.changeState(b.z6.name),t.changeState(b.z5.name),this.addz1062(t),!0},Wheel.prototype.keepPosInside=function(t){var e=!1,o=this.body.position,i=t.x-o.x,n=t.y-o.y;if(!(t.z-o.z<-this.halfHeight)){var s=i*i+n*n,a=this.radius;if(a*a<s){e=!0;var r=Math.sqrt(s),c=i/r,d=n/r;t.x=o.x+c*a,t.y=o.y+d*a}return e}},Wheel.count=0,Wheel.tempVecs=[new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3],Wheel.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],Wheel.tempBabMat=BABYLON.Matrix.Identity(),Wheel.activeObjects=[],Wheel.tempArr=[],Wheel}(b.z1092);b.Wheel=t}(z0||(z0={})),function(r){var t=function(a){function Wheel1(){var t=a.call(this)||this;return t._colors={},t._colors.legs=new BABYLON.Color3(1,1,1),t._colors.outer=new BABYLON.Color3(1,0,0),t._colors.back=new BABYLON.Color3(1,1,1),t._colors.center=new BABYLON.Color3(1,0,0),t}return __extends(Wheel1,a),Wheel1.prototype.init=function(t){var e=1;t.scale&&(e=t.scale),t.shapeName&&(this.shapeName=t.shapeName),null!=t.renderingGroupID&&null!=t.renderingGroupID&&(this.renderingGroupID=t.renderingGroupID);var o=this.renderingGroupID,i=r.app.graphicsHelper.scene,n=this.shapeName;this.shapes[0]?(this.shapes[1].init({name:n+"_front",renderingGroupID:o}),this.shapes[2].init({name:n+"_back",renderingGroupID:o}),this.shapes[3].init({name:n+"_center",renderingGroupID:o}),this.shapes[0].init({name:n+"_stand",renderingGroupID:o})):(this.shapes[1]=ObjectPool.get(n+"_front_rg"+o,{name:n+"_front",renderingGroupID:o,scene:i}),this.shapes[2]=ObjectPool.get(n+"_back_rg"+o,{name:n+"_back",renderingGroupID:o,scene:i}),this.shapes[3]=ObjectPool.get(n+"_center_rg"+o,{name:n+"_center",renderingGroupID:o,scene:i}),this.shapes[0]=ObjectPool.get(n+"_stand_rg"+o,{name:n+"_stand",renderingGroupID:o,scene:i}),this.shapes[2].setTexture("simpleWheelTexture"));for(var s=0;s<this.shapes.length;s++)this.shapes[s].scaling.x=e,this.shapes[s].scaling.z=e,this.shapes[s].removeFromScene();a.prototype.init.call(this,t),!this.shapes[1].body&&this.body&&(this.shapes[1].body=this.body,this.shapes[2].body=this.body,this.shapes[3].body=this.body,this.shapes[1].update=this.update.bind(this),r.app.graphicsHelper.addForUpdate(this.shapes[1]),r.app.graphicsHelper.addForUpdate(this.shapes[2]),r.app.graphicsHelper.addForUpdate(this.shapes[3])),this._initColors()},Wheel1.prototype.setColor=function(t,e,o,i){a.prototype.setColor.call(this,t,e,o,i);var n=0;for(var s in this._colors){if(s==i){this.shapes[n].setColor(t,e,o);break}n++}},Wheel1.count=0,Wheel1}(r.Wheel);r.Wheel1=t}(z0||(z0={})),function(t){var e=function(t){function Wheel1a(){return null!==t&&t.apply(this,arguments)||this}return __extends(Wheel1a,t),Wheel1a}(t.Wheel1);t.Wheel1a=e}(z0||(z0={})),function(i){var t=function(){function Wheel1aConfig(){this.maxObjects=3,this.objName="w1a",i.Wheel1a.objectCount=this.maxObjects}return Wheel1aConfig.prototype.initObjectPool=function(t){var e=this.objName;ObjectPool.addClass(e,i.Wheel1a,{shapeName:e,world:t,scale:.7,radius:.98,height:.8,curveRadius:.45}),ObjectPool.addClass(e+"_front_rg0",z1069,{meshName:"wheel_front2_inst"}),ObjectPool.addClass(e+"_back_rg0",z1069,{meshName:"wheel_back2_inst"}),ObjectPool.addClass(e+"_center_rg0",z1069,{meshName:"wheel_center_inst"}),ObjectPool.addClass(e+"_stand_rg0",z1068),ObjectPool.addClass(e+"_front_rg1",z1068),ObjectPool.addClass(e+"_back_rg1",z1068),ObjectPool.addClass(e+"_center_rg1",z1068),ObjectPool.addClass(e+"_stand_rg1",z1068)},Wheel1aConfig.prototype.getCreateMeshFunctions=function(t){t.wheel1aButton=this._createMeshes,t.wheel1aMenuButton=this._createMeshes,t.wheel_front2_inst=this._createMeshes,t.wheel_back2_inst=this._createMeshes,t.wheel_center_inst=this._createMeshes},Wheel1aConfig.prototype._createMeshes=function(t,e,o,i,n){var s=BABYLON.MeshBuilder.CreateDisc("",{radius:.75,tessellation:8},t);s.position.y=.75,s.rotation.x=Math.PI,s.bakeCurrentTransformIntoVertices(),t.removeMesh(s),e.wheel1aButton=s;var a=BABYLON.MeshBuilder.CreatePlane("",{height:2.2*.75,width:1.5},t);a.position.y+=.75,a.bakeCurrentTransformIntoVertices(),t.removeMesh(a),e.wheel1aMenuButton=a;var r=new BABYLON.StandardMaterial("",t);r.specularColor.r=.1,r.specularColor.g=.1,r.specularColor.b=.1;var c=document.createElement("canvas");c.width=256,c.height=256;var d=c.getContext("2d");i.simpleWheelTexture(d,c.width,c.height);var p,l=new BABYLON.Texture("data:"+c.id,t,!1,!0,null,null,null,c.toDataURL());r.diffuseTexture=l,(p=e.wheel_front2).material=r,p.isPickable=!1,p.registerInstancedBuffer("color",4),p.instancedBuffers.color=new BABYLON.Color4(1,1,1,1),e.wheel_front2_inst=p,(p=e.wheel_back2).material=r,p.isPickable=!1,p.registerInstancedBuffer("color",4),p.instancedBuffers.color=new BABYLON.Color4(1,1,1,1),e.wheel_back2_inst=p,(p=e.wheel_center).material=r,p.isPickable=!1,p.registerInstancedBuffer("color",4),p.instancedBuffers.color=new BABYLON.Color4(1,1,1,1),e.wheel_center_inst=p},Wheel1aConfig.prototype.getChildSPSData=function(t){t[this.objName]||(t[this.objName]={}),t[this.objName][this.objName+"_stand"]=1,t[this.objName][this.objName+"_front"]=1,t[this.objName][this.objName+"_back"]=1,t[this.objName][this.objName+"_center"]=1},Wheel1aConfig.prototype.getSPSData=function(t){var e=this.objName,o=this.maxObjects;t.push({shapeName:e,meshName:"wheel1aButton",numInstances:o,maxInstances:o,isPickable:!0,hideButton:!0}),t.push({shapeName:e+"_stand",meshName:"wheel_stand2",numInstances:o,maxInstances:o}),t.push({shapeName:e,meshName:"wheel1aMenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:e+"_front",meshName:"wheel_front",numInstances:1,maxInstances:1,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:e+"_back",meshName:"wheel_back",numInstances:1,maxInstances:1,renderingGroupID:i.App.menuRenderingGroupID,applyMaterialToSPS:"accMat",computeTextures:!0}),t.push({shapeName:e+"_center",meshName:"wheel_center",numInstances:1,maxInstances:1,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:e+"_stand",meshName:"wheel_stand2",numInstances:1,maxInstances:1,renderingGroupID:i.App.menuRenderingGroupID})},Wheel1aConfig.prototype.getTextureDrawFunctions=function(t){t.simpleWheelTexture=function(t,e,o){t.fillStyle="White",t.fillRect(0,0,e,o),t.strokeStyle="rgba(210, 210, 210, 1)",t.lineWidth=1,t.beginPath(),t.moveTo(.5*e,.5*o),t.lineTo(e,o),t.stroke(),t.closePath()}},Wheel1aConfig.prototype.getz1064Items=function(t){t.push(new i.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Wheels",order:1,menuWidth:2,menuHeight:2.2,offsetY:-1,menuRotationOffset:new BABYLON.Vector3(0,Math.PI,0)}))},Wheel1aConfig}();i.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(t){function Wheel1b(){return null!==t&&t.apply(this,arguments)||this}return __extends(Wheel1b,t),Wheel1b}(t.Wheel1);t.Wheel1b=e}(z0||(z0={})),function(i){var t=function(){function Wheel1bConfig(){this.maxObjects=3,this.objName="w1b",i.Wheel1b.objectCount=this.maxObjects}return Wheel1bConfig.prototype.initObjectPool=function(t){var e=this.objName;ObjectPool.addClass(e,i.Wheel1b,{shapeName:e,world:t,scale:.9,radius:.98,height:.8,curveRadius:.45}),ObjectPool.addClass(e+"_front_rg0",z1069,{meshName:"wheel_front2_inst"}),ObjectPool.addClass(e+"_back_rg0",z1069,{meshName:"wheel_back2_inst"}),ObjectPool.addClass(e+"_center_rg0",z1069,{meshName:"wheel_center_inst"}),ObjectPool.addClass(e+"_stand_rg0",z1068),ObjectPool.addClass(e+"_front_rg1",z1068),ObjectPool.addClass(e+"_back_rg1",z1068),ObjectPool.addClass(e+"_center_rg1",z1068),ObjectPool.addClass(e+"_stand_rg1",z1068)},Wheel1bConfig.prototype.getCreateMeshFunctions=function(t){t.wheel1bButton=this._createMeshes,t.wheel1bMenuButton=this._createMeshes},Wheel1bConfig.prototype._createMeshes=function(t,e,o,i,n){var s=BABYLON.MeshBuilder.CreateDisc("",{radius:.95,tessellation:8},t);s.position.y=.95,s.rotation.x=Math.PI,s.bakeCurrentTransformIntoVertices(),t.removeMesh(s),e.wheel1bButton=s;var a=BABYLON.MeshBuilder.CreatePlane("",{height:2.09,width:1.9},t);a.position.y+=.95,a.bakeCurrentTransformIntoVertices(),t.removeMesh(a),e.wheel1bMenuButton=a},Wheel1bConfig.prototype.getChildSPSData=function(t){t[this.objName]||(t[this.objName]={}),t[this.objName][this.objName+"_stand"]=1,t[this.objName][this.objName+"_front"]=1,t[this.objName][this.objName+"_back"]=1,t[this.objName][this.objName+"_center"]=1},Wheel1bConfig.prototype.getSPSData=function(t){var e=this.objName,o=this.maxObjects;t.push({shapeName:e,meshName:"wheel1bButton",numInstances:o,maxInstances:o,isPickable:!0,hideButton:!0}),t.push({shapeName:e+"_stand",meshName:"wheel_stand2",numInstances:o,maxInstances:o}),t.push({shapeName:e,meshName:"wheel1bMenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:e+"_front",meshName:"wheel_front",numInstances:1,maxInstances:1,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:e+"_back",meshName:"wheel_back",numInstances:1,maxInstances:1,renderingGroupID:i.App.menuRenderingGroupID,applyMaterialToSPS:"accMat",computeTextures:!0}),t.push({shapeName:e+"_center",meshName:"wheel_center",numInstances:1,maxInstances:1,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:e+"_stand",meshName:"wheel_stand2",numInstances:1,maxInstances:1,renderingGroupID:i.App.menuRenderingGroupID})},Wheel1bConfig.prototype.getz1064Items=function(t){t.push(new i.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Wheels",order:2,menuWidth:2,menuHeight:2.2,offsetY:-1,menuRotationOffset:new BABYLON.Vector3(0,Math.PI,0)}))},Wheel1bConfig}();i.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(t){function Wheel1c(){return null!==t&&t.apply(this,arguments)||this}return __extends(Wheel1c,t),Wheel1c}(t.Wheel1);t.Wheel1c=e}(z0||(z0={})),function(i){var t=function(){function Wheel1cConfig(){this.maxObjects=3,this.objName="w1c",i.Wheel1c.objectCount=this.maxObjects}return Wheel1cConfig.prototype.initObjectPool=function(t){var e=this.objName;ObjectPool.addClass(e,i.Wheel1c,{shapeName:e,world:t,scale:1.1,radius:.98,height:.8,curveRadius:.45}),ObjectPool.addClass(e+"_front_rg0",z1069,{meshName:"wheel_front2_inst"}),ObjectPool.addClass(e+"_back_rg0",z1069,{meshName:"wheel_back2_inst"}),ObjectPool.addClass(e+"_center_rg0",z1069,{meshName:"wheel_center_inst"}),ObjectPool.addClass(e+"_stand_rg0",z1068),ObjectPool.addClass(e+"_front_rg1",z1068),ObjectPool.addClass(e+"_back_rg1",z1068),ObjectPool.addClass(e+"_center_rg1",z1068),ObjectPool.addClass(e+"_stand_rg1",z1068)},Wheel1cConfig.prototype.getCreateMeshFunctions=function(t){t.wheel1cButton=this._createMeshes,t.wheel1cMenuButton=this._createMeshes},Wheel1cConfig.prototype._createMeshes=function(t,e,o,i,n){var s=BABYLON.MeshBuilder.CreateDisc("",{radius:1.15,tessellation:8},t);s.position.y=1.15,s.rotation.x=Math.PI,s.bakeCurrentTransformIntoVertices(),t.removeMesh(s),e.wheel1cButton=s;var a=BABYLON.MeshBuilder.CreatePlane("",{height:2.53,width:2.3},t);a.position.y+=1.15,a.bakeCurrentTransformIntoVertices(),t.removeMesh(a),e.wheel1cMenuButton=a},Wheel1cConfig.prototype.getChildSPSData=function(t){t[this.objName]||(t[this.objName]={}),t[this.objName][this.objName+"_stand"]=1,t[this.objName][this.objName+"_front"]=1,t[this.objName][this.objName+"_back"]=1,t[this.objName][this.objName+"_center"]=1},Wheel1cConfig.prototype.getSPSData=function(t){var e=this.objName,o=this.maxObjects;t.push({shapeName:e,meshName:"wheel1cButton",numInstances:o,maxInstances:o,isPickable:!0,hideButton:!0}),t.push({shapeName:e+"_stand",meshName:"wheel_stand2",numInstances:o,maxInstances:o}),t.push({shapeName:e,meshName:"wheel1cMenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:e+"_front",meshName:"wheel_front",numInstances:1,maxInstances:1,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:e+"_back",meshName:"wheel_back",numInstances:1,maxInstances:1,renderingGroupID:i.App.menuRenderingGroupID,applyMaterialToSPS:"accMat",computeTextures:!0}),t.push({shapeName:e+"_center",meshName:"wheel_center",numInstances:1,maxInstances:1,renderingGroupID:i.App.menuRenderingGroupID}),t.push({shapeName:e+"_stand",meshName:"wheel_stand2",numInstances:1,maxInstances:1,renderingGroupID:i.App.menuRenderingGroupID})},Wheel1cConfig.prototype.getz1064Items=function(t){t.push(new i.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Wheels",order:3,menuWidth:2,menuHeight:2.2,offsetY:-1,menuRotationOffset:new BABYLON.Vector3(0,Math.PI,0)}))},Wheel1cConfig}();i.App.AddEntityConfig(new t)}(z0||(z0={})),function(d){var t=function(c){function Wheel2(){var t=c.call(this)||this;return t._colors={},t._colors.wheel=new BABYLON.Color3(1,1,1),t}return __extends(Wheel2,c),Wheel2.prototype.init=function(t){this.textureName="wheel3Tile",this.isMenuItem=t.isMenuItem;var e=1;t.scale&&(e=t.scale),t.shapeName&&(this.shapeName=t.shapeName),null!=t.renderingGroupID&&null!=t.renderingGroupID&&(this.renderingGroupID=t.renderingGroupID);var o=this.renderingGroupID,i=d.app.graphicsHelper.scene,n=this.shapeName;this.shapes[0]?(this.shapes[0].init({name:n+"_stand",renderingGroupID:o}),this.shapes[1].init({name:n+"_back",renderingGroupID:o}),this.shapes[2].init({name:n+"_center",renderingGroupID:o})):(this.shapes[0]=ObjectPool.get(n+"_stand_rg"+o,{name:n+"_stand",renderingGroupID:o,scene:i}),this.shapes[1]=ObjectPool.get(n+"_back_rg"+o,{name:n+"_back",renderingGroupID:o,scene:i}),this.shapes[2]=ObjectPool.get(n+"_center_rg"+o,{name:n+"_center",renderingGroupID:o,scene:i}),this.isMenuItem||(this.dragSP=ObjectPool.get(n+"_back_drag_rg"+o,{name:n+"_back_drag",renderingGroupID:o,scene:i}),this.dragSP.removeFromScene()),this.alphaInst=this.shapes[1]);for(var s=0;s<this.shapes.length;s++)this.shapes[s].scaling.x=e,this.shapes[s].scaling.z=e,this.shapes[s].removeFromScene();c.prototype.init.call(this,t),!this.shapes[1].body&&this.body&&(this.shapes[1].body=this.body,this.shapes[2].body=this.body,this.shapes[1].update=this.update.bind(this),d.app.graphicsHelper.addForUpdate(this.shapes[1]),d.app.graphicsHelper.addForUpdate(this.shapes[2])),this._initColors()},Wheel2.prototype._initColors=function(){for(var t in this._colors){var e=this._colors[t];this.setColor(e.r,e.g,e.b,t)}},Wheel2.prototype.setColor=function(t,e,o,i){c.prototype.setColor.call(this,t,e,o,i),"wheel"==i&&(this.shapes[1].setColor(t,e,o),this.shapes[2].setColor(t,e,o))},Wheel2.prototype.setPositionDrag=function(t,e,o,i){if(void 0===i&&(i=!1),!this.isDragging){this.alphaInst.removeFromScene(),this.dragSP.shapeEnabled=!0;var n=this.alphaInst.rotation,s=this.alphaInst.color,a=this.alphaInst.scaling;this.dragSP.setRotation(n.x,n.y,n.z),this.dragSP.setColor(s.r,s.g,s.b),this.dragSP.setScale(a.x,a.y,a.z),this.dragSP.body=this.body,d.app.graphicsHelper.addForUpdate(this.dragSP),this.dragSP.addToScene(),this.dragSP.requestDepthSort=!0}i&&(this.alphaInst.addToScene(),this.dragSP.body=null,d.app.graphicsHelper.removeFromUpdate(this.dragSP),this.dragSP.removeFromScene(),this.dragSP.shapeEnabled=!1),c.prototype.setPositionDrag.call(this,t,e,o,i);var r=this.alphaInst.position;this.dragSP.setPosition(r.x,r.y,r.z)},Wheel2.prototype.removeFromScene=function(){c.prototype.removeFromScene.call(this),this.dragSP&&this.dragSP.removeFromScene()},Wheel2.prototype.addToScene=function(){this.isMenuItem&&(this.shapes[1].requestDepthSort=!0),c.prototype.addToScene.call(this)},Wheel2.prototype.recycle=function(){c.prototype.recycle.call(this)},Wheel2.count=0,Wheel2}(d.Wheel);d.Wheel2=t}(z0||(z0={})),function(t){var e=function(e){function Wheel2a(){var t=e.call(this)||this;return t._colors={},t._colors.wheel=new BABYLON.Color3(0,0,1),t}return __extends(Wheel2a,e),Wheel2a.prototype.init=function(t){e.prototype.init.call(this,t)},Wheel2a.prototype.addToScene=function(){this.isMenuItem||this.isMenuItem,e.prototype.addToScene.call(this)},Wheel2a.prototype.recycle=function(){e.prototype.recycle.call(this)},Wheel2a}(t.Wheel2);t.Wheel2a=e}(z0||(z0={})),function(o){var t=function(){function Wheel2aConfig(){this.objName="w2a",this.maxObjects=3,o.Wheel2a.objectCount=this.maxObjects}return Wheel2aConfig.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,o.Wheel2a,{shapeName:this.objName,world:t,scale:.7,radius:.98,height:.8,curveRadius:0}),ObjectPool.addClass(this.objName+"_back_rg0",z1069,{meshName:"wheel3_back2",tileName:"wheel3Tile"}),ObjectPool.addClass(this.objName+"_back_drag_rg0",z1068,{textureName:"wheel3Tile"}),ObjectPool.addClass(this.objName+"_center_rg0",z1069,{meshName:"wheel3_center2"}),ObjectPool.addClass(this.objName+"_stand_rg0",z1068),ObjectPool.addClass(this.objName+"_front_rg1",z1068),ObjectPool.addClass(this.objName+"_back_rg1",z1068,{textureName:"wheel3Tile"}),ObjectPool.addClass(this.objName+"_center_rg1",z1068),ObjectPool.addClass(this.objName+"_stand_rg1",z1068)},Wheel2aConfig.prototype.getCreateMeshFunctions=function(t){t.wheel2aButton=this._createMeshes,t.wheel2aMenuButton=this._createMeshes,t.wheel3_back2=this._createMeshes,t.wheel3_center2=this._createMeshes},Wheel2aConfig.prototype._createMeshes=function(t,e,o,i,n){var r=new BABYLON.CustomMaterial("wheel2Mat",t);r.AddAttribute("tileOffset"),r.Vertex_Definitions("\n                attribute vec4 tileOffset;\n                varying vec4 vTileOffset;\n            "),r.Vertex_MainEnd("\n                vTileOffset = tileOffset;\n            "),r.Fragment_Definitions("\n                varying vec4 vTileOffset;\n            "),r.Fragment_Custom_Diffuse("\n                float fx = 1. - clamp(fract(vDiffuseUV.x), 0., 1.); \n                float fy = clamp(fract(vDiffuseUV.y), 0., 1.);\n                vec2 uvCoord = vec2(vTileOffset.x + fx * (vTileOffset.z-vTileOffset.x), vTileOffset.y + fy * (vTileOffset.w-vTileOffset.y));\n                baseColor = texture2D(diffuseSampler, uvCoord);\n                baseColor *= vColor;\n            "),r._saveCustomShaderNameResolve=r.customShaderNameResolve.bind(r),r.customShaderNameResolve=function(t,e,o,i,n,s,a){return a.processFinalCode=function(t,e){return"vertex"===t?e:(e=e.replace(/vec4 opacityMap=texture2D\(opacitySampler,vOpacityUV\+uvOffset\);/,"vec4 opacityMap=texture2D(opacitySampler,uvCoord);")).replace(/vec4 opacityMap=texture\(opacitySampler,vOpacityUV\+uvOffset\);/,"vec4 opacityMap=texture(opacitySampler,uvCoord);")},r._saveCustomShaderNameResolve(t,e,o,i,n,s,a)},r.useSpecularOverAlpha=!0,r.diffuseColor=new BABYLON.Color3(1,1,1);r.specularColor.r=.2,r.specularColor.g=.2,r.specularColor.b=.2,r.opacityFresnelParameters=new BABYLON.FresnelParameters,r.opacityFresnelParameters.leftColor=BABYLON.Color3.White();var s=BABYLON.Color3.Black();r.opacityFresnelParameters.rightColor=s,r.opacityFresnelParameters.bias=.7,r.opacityFresnelParameters.power=3,r.diffuseTexture=n.alphaTileSet.getTexture(),r.opacityTexture=r.diffuseTexture,o.wheel2Mat=r;var a=BABYLON.MeshBuilder.CreateDisc("",{radius:.75,tessellation:8},t);a.position.y=.75,a.rotation.x=Math.PI,a.bakeCurrentTransformIntoVertices(),t.removeMesh(a),e.wheel2aButton=a;var c=BABYLON.MeshBuilder.CreatePlane("",{height:2.2*.75,width:1.5},t);c.position.y+=.75,c.bakeCurrentTransformIntoVertices(),t.removeMesh(c),e.wheel2aMenuButton=c;var d=e.wheel3_back.clone("wheel3_back2");d.makeGeometryUnique(),d.material=r,d.registerInstancedBuffer("color",4),d.instancedBuffers.color=new BABYLON.Color4(1,1,1,1),d.registerInstancedBuffer("tileOffset",4),d.instancedBuffers.tileOffset=new BABYLON.Vector4(1,1,1,1),t.removeMesh(d),d.alphaIndex=-100,e.wheel3_back2=d,(d=e.wheel3_center.clone("wheel3_center2")).makeGeometryUnique(),d.material=o.default0,d.registerInstancedBuffer("color",4),d.instancedBuffers.color=new BABYLON.Color4(1,1,1,1),t.removeMesh(d),e.wheel3_center2=d},Wheel2aConfig.prototype.getChildSPSData=function(t){t[this.objName]||(t[this.objName]={}),t[this.objName][this.objName+"_stand"]=1,t[this.objName][this.objName+"_back_drag"]=1},Wheel2aConfig.prototype.getSPSData=function(t){var e=this.maxObjects;t.push({shapeName:this.objName,meshName:"wheel2aButton",numInstances:e,maxInstances:e,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName+"_stand",meshName:"wheel_stand2",numInstances:e,maxInstances:e}),t.push({shapeName:this.objName+"_back_drag",meshName:"wheel3_back",numInstances:e,maxInstances:e,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0}),t.push({shapeName:this.objName,meshName:"wheel2aMenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName+"_back",meshName:"wheel3_back",numInstances:1,maxInstances:e,applyMaterialToSPS:"tubeMat",computeTextures:!0,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName+"_center",meshName:"wheel3_center",numInstances:1,maxInstances:1,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName+"_stand",meshName:"wheel_stand2",numInstances:1,maxInstances:1,renderingGroupID:o.App.menuRenderingGroupID})},Wheel2aConfig.prototype.getTextureDrawFunctions=function(t){t.wheel3Tile=function(t,e,o){t.beginPath(),t.rect(0,0,e,o),t.fillStyle="rgba(255, 255, 255, .5)",t.fill();var i=4,n=2*Math.PI/i,s=.3*o;t.lineWidth=.5,t.strokeStyle="rgba(255, 255, 255, .5)";var a=.5*e,r=.5*o;t.beginPath();for(var c=0;c<i;c++)t.moveTo(a,r),t.lineTo(a+Math.cos(n*c)*s,r+Math.sin(n*c)*s);t.stroke();var d=e/(i=24),p=.2*o;t.beginPath();for(c=0;c<i;c++)t.moveTo(d*c+1,0),t.lineTo(d*c+1,p);t.stroke();var l=.87*o;t.lineWidth=4,t.beginPath(),t.moveTo(0,l),t.lineTo(e,l),t.stroke(),l=0,t.lineWidth=4,t.beginPath(),t.moveTo(0,l),t.lineTo(e,l),t.stroke()}},Wheel2aConfig.prototype.getz1064Items=function(t){t.push(new o.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Wheels",order:4,menuWidth:2,menuHeight:2.2,offsetY:-1,menuRotationOffset:new BABYLON.Vector3(0,Math.PI,0)}))},Wheel2aConfig}();o.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(e){function Wheel2b(){var t=e.call(this)||this;return t._colors={},t._colors.wheel=new BABYLON.Color3(0,1,0),t}return __extends(Wheel2b,e),Wheel2b}(t.Wheel2);t.Wheel2b=e}(z0||(z0={})),function(o){var t=function(){function Wheel2bConfig(){this.objName="w2b",this.maxObjects=3,o.Wheel2b.objectCount=this.maxObjects}return Wheel2bConfig.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,o.Wheel2b,{shapeName:this.objName,world:t,scale:.9,radius:.98,height:.8,curveRadius:0}),ObjectPool.addClass(this.objName+"_back_rg0",z1069,{meshName:"wheel3_back2",tileName:"wheel3Tile"}),ObjectPool.addClass(this.objName+"_back_drag_rg0",z1068,{textureName:"wheel3Tile"}),ObjectPool.addClass(this.objName+"_center_rg0",z1069,{meshName:"wheel3_center2"}),ObjectPool.addClass(this.objName+"_stand_rg0",z1068),ObjectPool.addClass(this.objName+"_front_rg1",z1068),ObjectPool.addClass(this.objName+"_back_rg1",z1068,{textureName:"wheel3Tile"}),ObjectPool.addClass(this.objName+"_center_rg1",z1068),ObjectPool.addClass(this.objName+"_stand_rg1",z1068)},Wheel2bConfig.prototype.getCreateMeshFunctions=function(t){t.wheel2bButton=this._createMeshes,t.wheel2bMenuButton=this._createMeshes},Wheel2bConfig.prototype._createMeshes=function(t,e,o,i,n){var s=BABYLON.MeshBuilder.CreateDisc("",{radius:.95,tessellation:8},t);s.position.y=.95,s.rotation.x=Math.PI,s.bakeCurrentTransformIntoVertices(),t.removeMesh(s),e.wheel2bButton=s;var a=BABYLON.MeshBuilder.CreatePlane("",{height:2.09,width:1.9},t);a.position.y+=.95,a.bakeCurrentTransformIntoVertices(),t.removeMesh(a),e.wheel2bMenuButton=a},Wheel2bConfig.prototype.getChildSPSData=function(t){t[this.objName]||(t[this.objName]={}),t[this.objName][this.objName+"_stand"]=1,t[this.objName][this.objName+"_back_drag"]=1},Wheel2bConfig.prototype.getSPSData=function(t){var e=this.maxObjects;t.push({shapeName:this.objName,meshName:"wheel2bButton",numInstances:e,maxInstances:e,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName+"_stand",meshName:"wheel_stand2",numInstances:e,maxInstances:e}),t.push({shapeName:this.objName+"_back_drag",meshName:"wheel3_back",numInstances:e,maxInstances:e,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0}),t.push({shapeName:this.objName,meshName:"wheel2bMenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName+"_back",meshName:"wheel3_back",numInstances:1,maxInstances:1,applyMaterialToSPS:"tubeMat",computeTextures:!0,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName+"_center",meshName:"wheel3_center",numInstances:1,maxInstances:1,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName+"_stand",meshName:"wheel_stand2",numInstances:1,maxInstances:1,renderingGroupID:o.App.menuRenderingGroupID})},Wheel2bConfig.prototype.getz1064Items=function(t){t.push(new o.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Wheels",order:5,menuWidth:2,menuHeight:2.2,offsetY:-1,menuRotationOffset:new BABYLON.Vector3(0,Math.PI,0)}))},Wheel2bConfig}();o.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(e){function Wheel2c(){var t=e.call(this)||this;return t._colors={},t._colors.wheel=new BABYLON.Color3(1,1,0),t}return __extends(Wheel2c,e),Wheel2c}(t.Wheel2);t.Wheel2c=e}(z0||(z0={})),function(o){var t=function(){function Wheel2cConfig(){this.objName="w2c",this.maxObjects=3,o.Wheel2c.objectCount=this.maxObjects}return Wheel2cConfig.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,o.Wheel2c,{shapeName:this.objName,world:t,scale:1.1,radius:.98,height:.8,curveRadius:0}),ObjectPool.addClass(this.objName+"_back_rg0",z1069,{meshName:"wheel3_back2",tileName:"wheel3Tile"}),ObjectPool.addClass(this.objName+"_back_drag_rg0",z1068,{textureName:"wheel3Tile"}),ObjectPool.addClass(this.objName+"_center_rg0",z1069,{meshName:"wheel3_center2"}),ObjectPool.addClass(this.objName+"_stand_rg0",z1068),ObjectPool.addClass(this.objName+"_front_rg1",z1068),ObjectPool.addClass(this.objName+"_back_rg1",z1068,{textureName:"wheel3Tile"}),ObjectPool.addClass(this.objName+"_center_rg1",z1068),ObjectPool.addClass(this.objName+"_stand_rg1",z1068)},Wheel2cConfig.prototype.getCreateMeshFunctions=function(t){t.wheel2cButton=this._createMeshes,t.wheel2cMenuButton=this._createMeshes},Wheel2cConfig.prototype._createMeshes=function(t,e,o,i,n){var s=BABYLON.MeshBuilder.CreateDisc("",{radius:1.15,tessellation:8},t);s.position.y=1.15,s.rotation.x=Math.PI,s.bakeCurrentTransformIntoVertices(),t.removeMesh(s),e.wheel2cButton=s;var a=BABYLON.MeshBuilder.CreatePlane("",{height:2.53,width:2.3},t);a.position.y+=1.15,a.bakeCurrentTransformIntoVertices(),t.removeMesh(a),e.wheel2cMenuButton=a},Wheel2cConfig.prototype.getChildSPSData=function(t){t[this.objName]||(t[this.objName]={}),t[this.objName][this.objName+"_stand"]=1,t[this.objName][this.objName+"_back_drag"]=1},Wheel2cConfig.prototype.getSPSData=function(t){var e=this.maxObjects;t.push({shapeName:this.objName,meshName:"wheel2cButton",numInstances:e,maxInstances:e,isPickable:!0,hideButton:!0}),t.push({shapeName:this.objName+"_stand",meshName:"wheel_stand2",numInstances:e,maxInstances:e}),t.push({shapeName:this.objName+"_back_drag",meshName:"wheel3_back",numInstances:e,maxInstances:e,applyMaterialToSPS:"tubeMat",depthSort:!0,computeTextures:!0}),t.push({shapeName:this.objName,meshName:"wheel2cMenuButton",numInstances:1,maxInstances:1,isPickable:!0,hideButton:!0,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName+"_back",meshName:"wheel3_back",numInstances:1,maxInstances:1,applyMaterialToSPS:"tubeMat",computeTextures:!0,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName+"_center",meshName:"wheel3_center",numInstances:1,maxInstances:1,renderingGroupID:o.App.menuRenderingGroupID}),t.push({shapeName:this.objName+"_stand",meshName:"wheel_stand2",numInstances:1,maxInstances:1,renderingGroupID:o.App.menuRenderingGroupID})},Wheel2cConfig.prototype.getz1064Items=function(t){t.push(new o.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Wheels",order:6,menuWidth:2,menuHeight:2.2,offsetY:-1,menuRotationOffset:new BABYLON.Vector3(0,Math.PI,0)}))},Wheel2cConfig}();o.App.AddEntityConfig(new t)}(z0||(z0={})),function(e){var t=function(){function WheelConfig(){}return WheelConfig.prototype.getSceneFileNames=function(t){},WheelConfig.prototype.getz49s=function(t){t.push(e.z5)},WheelConfig.prototype.getListenerSetups=function(t){t.push({event:e.WheelEvents.ENTER,state:e.z5})},WheelConfig}();e.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(){function WheelEvents(){}return WheelEvents.ENTER=t.AppEvents.GetUniqueID(),WheelEvents}();t.WheelEvents=e}(z0||(z0={})),function(_){var t=function(e){function WheelNavigator(){var t=null!==e&&e.apply(this,arguments)||this;return t.localPosition=BABYLON.Vector3.Zero(),t.pivotRadius=0,t._enabled=!0,t.updated=new z1072Set,t}return __extends(WheelNavigator,e),WheelNavigator.prototype.init=function(t){this.accessory=t.accessory;var e=this.accessory,o=e.shapeName+e.num;if(!this.triggerArea){this.world=e.world;var i=[.03,.01,1,_.App.PhysicsGroupTriggerArea,_.App.z1034],n=t.radius;this.pivotRadius=n,this.triggerArea=new OIMO.Body({type:"sphere",size:[n,n,n],pos:[0,0,0],rot:[0,0,0],move:!1,world:this.world,name:o+"_wheelBumper1",config:i}).body,this.triggerArea.shapes.pubsub=this.pubsub,this.triggerArea.shapes.disablePhysics=!0;var s=t.side*(this.accessory.radius-.7*n),a=.5*n;this.localPosition.x=s,this.localPosition.y=a,this.localPosition.z=0,this.pubsub.subscribe("hit",this.onTrigger.bind(this))}},WheelNavigator.prototype.setPosition=function(t,e,o){var i=this.accessory,n=this.localPosition;0==i.rotation.x&&0==i.rotation.z||BABYLON.Vector3.TransformCoordinatesToRef(n,i._rotationMatrix,n),this.triggerArea.position.x=t+n.x,this.triggerArea.position.y=e+n.y,this.triggerArea.position.z=o+n.z,this.triggerArea.syncShapes(),this.triggerAreaMesh&&(this.triggerAreaMesh.position.x=this.triggerArea.position.x,this.triggerAreaMesh.position.y=this.triggerArea.position.y,this.triggerAreaMesh.position.z=this.triggerArea.position.z,this.triggerAreaMesh.isPickable=!1)},WheelNavigator.prototype.enable=function(){this._enabled||(this.world.addRigidBody(this.triggerArea),this._enabled=!0)},WheelNavigator.prototype.disable=function(){this._enabled&&(this.triggerArea.position.y=9999,this.triggerArea.syncShapes(),this.world.removeRigidBody(this.triggerArea),this._enabled=!1)},WheelNavigator.prototype.onTrigger=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=this.accessory,i=t[8].actor.rodent;if(this.updated.push(i,i.id,_.app.frameNum)&&!i.isInState(_.z5.name)&&!(i.isInState(_.z112.name)||i.isInState(_.z43.name)||i.isInState(_.z131.name)||i.isInState(_.z132.name))){var n=i.path[i.pathIndex];if(i.targetObject==o&&n){for(;n&&n.data.obj!=o;)i.incrementPathIndex(),n=i.path[i.pathIndex],0;i.pathIndex>=i.path.length&&(i.pathIndex=i.path.length-1,i.path2Index=i.path2.length-3)}var s=o.position,a=i.path[i.pathIndex+1],r=s.z-o.halfHeight,c=s.x+o.radius,d=s.x-o.radius;n&&a&&n.z>r&&n.x>d&&n.x<c&&a.z<r&&(i.incrementPathIndex(),n=i.path[i.pathIndex],a=i.path[i.pathIndex+1]);var p=i.physics.rearBody.testCollidesWith(_.App.PhysicsGroupBedding),l=i.targets.destTarget,u=i.targets.currentTarget,y=this.position,g=l.x-s.x,m=l.z-s.z;o.isInWheel(l.x,l.y,l.z)&&(i.targetObject&&i.targetObject==o||(i.targetObject=o));var f=i.physics.frontBody.body.position,A=f.x-s.x;if(0<f.y-s.y&&!p&&(p=!0),!i.isInState(_.z7.name)){var b=o.parent;if(b){var v=!1,x=!1,C=WheelNavigator.z4[2];C.x=0,C.y=1,C.z=0;var S=1;y.x-s.x<0&&(S=-1),i.targetObject==o?x=v=!0:b.isInBox(l.x,l.y,l.z,1e-4)&&(x=!0);var T=u.x-s.x,B=f.x-y.x,O=(y.x-s.x)*S,P=!1;Math.abs(A)<O&&(P=!0);var M=o.body.position,I=f.x-M.x,N=f.z-M.z;if(N>-o.halfHeight&&P){var z=!1;if(o.isInsideOuterWall(f.x,f.y,f.z)||I<o.radius&&I>-o.radius&&N<o.halfHeight&&N>-o.halfHeight&&(z=!0),z){if(S<0&&-.001<u.x-s.x)return i.pivotMoveDir=-1,i.pivotPoint.x=s.x,i.pivotPoint.y=s.y,i.pivotPoint.z=s.z,i.pivotArea=1.2*Math.PI,i.pivotRadius=this.pivotRadius+.5*i.size,i.pivotRadiusMax=i.pivotRadius+1.5*i.size,i.pivotAreaDir.x=1,i.pivotAreaDir.y=0,i.pivotAreaDir.z=0,void(i.pivotUpdateLook=!0);if(0<S&&u.x-s.x<.001)return i.pivotMoveDir=1,i.pivotPoint.x=s.x,i.pivotPoint.y=s.y,i.pivotPoint.z=s.z,i.pivotArea=1.2*Math.PI,i.pivotRadius=this.pivotRadius+.5*i.size,i.pivotRadiusMax=i.pivotRadius+1.5*i.size,i.pivotAreaDir.x=-1,i.pivotAreaDir.y=0,i.pivotAreaDir.z=0,void(i.pivotUpdateLook=!0)}}var w=!0;v?w=!1:x&&m>-o.height?w=!1:0<T&&A<0?w=!1:T<0&&0<A&&(w=!1),w||(x&&!v&&m>-o.halfHeight?B<0&&0<S&&0<g?(i.pivotMoveDir=-1,i.pivotPoint.x=y.x,i.pivotPoint.y=y.y,i.pivotPoint.z=y.z,i.pivotArea=1*Math.PI,i.pivotRadius=this.pivotRadius+1*i.size,i.pivotRadiusMax=i.pivotRadius+1.5*i.size,i.pivotAreaDir.x=1,i.pivotAreaDir.y=0,i.pivotAreaDir.z=0,i.pivotUpdateLook=!0):0<B&&S<0&&g<0?(i.pivotMoveDir=1,i.pivotPoint.x=y.x,i.pivotPoint.y=y.y,i.pivotPoint.z=y.z,i.pivotArea=1*Math.PI,i.pivotRadius=this.pivotRadius+1*i.size,i.pivotRadiusMax=i.pivotRadius+1.5*i.size,i.pivotAreaDir.x=-1,i.pivotAreaDir.y=0,i.pivotAreaDir.z=0,i.pivotUpdateLook=!0):B<0&&S<0&&0<g?(i.pivotMoveDir=-1,i.pivotPoint.x=y.x,i.pivotPoint.y=y.y,i.pivotPoint.z=y.z,i.pivotArea=1*Math.PI,i.pivotRadius=this.pivotRadius+1*i.size,i.pivotRadiusMax=i.pivotRadius+1.5*i.size,i.pivotAreaDir.x=1,i.pivotAreaDir.y=0,i.pivotAreaDir.z=0,i.pivotUpdateLook=!0):0<B&&0<S&&g<0?(i.pivotMoveDir=1,i.pivotPoint.x=y.x,i.pivotPoint.y=y.y,i.pivotPoint.z=y.z,i.pivotArea=1*Math.PI,i.pivotRadius=this.pivotRadius+1*i.size,i.pivotRadiusMax=i.pivotRadius+1.5*i.size,i.pivotAreaDir.x=-1,i.pivotAreaDir.y=0,i.pivotAreaDir.z=0,i.pivotUpdateLook=!0):P&&(A<0&&S<0&&0<g?(i.pivotMoveDir=-1,i.pivotPoint.x=s.x,i.pivotPoint.y=s.y,i.pivotPoint.z=s.z,i.pivotArea=1*Math.PI,i.pivotRadius=this.pivotRadius+1*i.size,i.pivotRadiusMax=i.pivotRadius+1.5*i.size,i.pivotAreaDir.x=1,i.pivotAreaDir.y=0,i.pivotAreaDir.z=0,i.pivotUpdateLook=!0):0<A&&0<S&&g<0&&(i.pivotMoveDir=1,i.pivotPoint.x=s.x,i.pivotPoint.y=s.y,i.pivotPoint.z=s.z,i.pivotArea=1*Math.PI,i.pivotRadius=this.pivotRadius+1*i.size,i.pivotRadiusMax=i.pivotRadius+1.5*i.size,i.pivotAreaDir.x=-1,i.pivotAreaDir.y=0,i.pivotAreaDir.z=0,i.pivotUpdateLook=!0)):B<0&&S<0?(i.pivotMoveDir=-1,i.pivotPoint.x=y.x,i.pivotPoint.y=y.y,i.pivotPoint.z=y.z,i.pivotArea=1*Math.PI,i.pivotRadius=this.pivotRadius+1*i.size,i.pivotRadiusMax=i.pivotRadius+1.5*i.size,i.pivotAreaDir.x=1,i.pivotAreaDir.y=0,i.pivotAreaDir.z=0,i.pivotUpdateLook=!0):0<B&&0<S&&(i.pivotMoveDir=1,i.pivotPoint.x=y.x,i.pivotPoint.y=y.y,i.pivotPoint.z=y.z,i.pivotArea=1*Math.PI,i.pivotRadius=this.pivotRadius+1*i.size,i.pivotRadiusMax=i.pivotRadius+1.5*i.size,i.pivotAreaDir.x=-1,i.pivotAreaDir.y=0,i.pivotAreaDir.z=0,i.pivotUpdateLook=!0))}}}},WheelNavigator}(_.z1091);_.WheelNavigator=t}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z752(){return null!==t&&t.apply(this,arguments)||this}return __extends(z752,t),z752.prototype.update=function(t){var e=t.currentObject;e&&e.accType==o.z1044.z1054&&e.addz1062(t)},z752}(z767),t.z752=e}(z0||(z0={})),function(c){var t,e;t=c.z156||(c.z156={}),e=function(e){function z729(){var t=null!==e&&e.apply(this,arguments)||this;return t.xDistMult=.1,t.wheelAccMult=.3,t._lastBroadcastFrame=0,t}return __extends(z729,e),z729.prototype.update=function(t,e){if(e||(e=t.currentObject),e&&e.accType==c.z1044.z1054&&e.isOnScene&&t.isTouchingGround()){this.xDistMult=.5*-(e.radius-1.1)+.2,this.wheelAccMult=.95*this.xDistMult;var o=z767.tempVecs[0],i=e.body,n=t.physics.frontBody.rotationElements;o.x=n[2],o.y=n[5],o.z=n[8];var s=t.targets.wheelDir;this.xDistMult,this.wheelAccMult,e.acc-=t.runSpeedFrac*this.wheelAccMult*s/e.radius;var a=e.body.position,r=(t.physics.middleBody.body.position.x-a.x)/(e.radius-t.size);e.acc+=-r*this.xDistMult,this._debugPubsub||(this._debugPubsub=new Pubsub),c.app.frameNum-60>this._lastBroadcastFrame&&(this._lastBroadcastFrame=c.app.frameNum,this._debugPubsub.broadcast("wheel_force",z1.roundToDecimalPlace(i.angularVelocity.z,1)),this._debugPubsub.broadcast("ham_speed",z1.roundToDecimalPlace(t.runSpeedFrac*e.hamSpeedConv,1)))}},z729}(z767),t.z729=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z686(){return null!==t&&t.apply(this,arguments)||this}return __extends(z686,t),z686.prototype.update=function(t){t.physics.rearBody.onGround?t.computeBodyStandAngs():t.initBodyStandAngs()},z686}(z767),e.z686=o}(z0||(z0={})),function(x){var t,e;t=x.z156||(x.z156={}),e=function(t){function z661(){return t.call(this)||this}return __extends(z661,t),z661.prototype.update=function(t){var e=t.cage;if(e){var o=e.bedding,i=t.path[t.pathIndex+1],n=t.path[t.pathIndex+1];n=t.path[t.path.length-1];var s=0;o&&t.position.y-t.size<o.position.y+o.minHeight&&(i=t.path[t.pathIndex],n=t.path[t.pathIndex],s=2*t.size),i||(i=t.path[t.path.length-1]);var a=t.targets,r=a.moveToTarget,c=a.lookToTarget,d=a.standToTarget;if(t.targetObject||t.targetObject,i){if(!t.targetObject&&i.data.obj&&i.data.obj.accType==x.z1044.z1054){var p=t.path[t.path.length-1];if(p&&p.data.obj&&p.data.obj.accType==x.z1044.z1054)return t.path.length=0,void(t.path2.length=0);t.hsm}c.x=i.x,c.y=i.y,c.z=i.z,d.x=c.x,d.y=c.y,d.z=c.z,r.x=n.x,r.y=n.y+s,r.z=n.z;var l=i.data.obj;if(l&&l.accType==x.z1044.z1054&&0<l.hamsters.length){var u,y=.3*l.radius,g=!1;l.body.angularVelocity.z<0&&(g=!0);for(var m=0;m<l.hamsters.length;m++){var f=l.hamsters.data[m];if(f!=t){var A=f.position.x-l.position.x;y<A||A<-y||(u?g?f.position.x<u.position.x&&(u=f):f.position.x>u.position.x&&(u=f):u=f)}}if(!u)return;var b=u.physics.rearBody.body.position;u.id,t.id,r.x=b.x,d.x=b.x,c.x=b.x,r.y=b.y,d.y=b.y,c.y=b.y;var v=l.body.position.z-l.halfHeight+2*t.size;r.z=v,d.z=v,c.z=v}}else t.path}},z661}(z767),t.z661=e}(z0||(z0={})),function(wt){var t,e;t=wt.z156||(wt.z156={}),e=function(t){function z645(){return null!==t&&t.apply(this,arguments)||this}return __extends(z645,t),z645.prototype.update=function(t){var e=t.currentObject,o=(wt.app.world.timeStep,z767.tempVecs[0]),i=z767.tempVecs[1],n=z767.tempVecs[2],s=z767.tempVecs[3],a=t.physics,r=a.middleBody.body.position,c=a.frontBody.body.position,d=(a.rearBody.body.position,t.physics.middleBody.rotationElements),p=t.targets.moveToTarget,l=t.targets.upVecTarget;t.bones.tail.ang=-.62*Math.PI,a.frontBody.standAng.targetValue=0,a.middleBody.standAng.targetValue=0,a.rearBody.standAng.targetValue=0;var u=e.base.body.rotation.elements,y=(e.base.body.position,e.body),g=y.rotation.elements,m=y.position,f=a.middleBody.body.position,A=t.localPos,b=e.angVel,v=a.middleBody.body,x=a.frontBody.body,C=x.position,S=C.x-m.x,T=C.y-m.y,B=C.z-m.z,O=S*g[0]+T*g[3]+B*g[6],P=S*g[1]+T*g[4]+B*g[7],M=S*g[2]+T*g[5]+B*g[8];A.x=O,A.y=P;var I=O*O+(A.z=M)*M;e.radius,t.size,e.halfHeight,a.frontBody.body.position;if(t.isTouchingGround()){var N=m.x-c.x,z=m.y-c.y,w=m.z-c.z,_=N*u[0]+z*u[3]+w*u[6],R=N*u[1]+z*u[4]+w*u[7],L=(u[2],u[5],u[8],Math.sqrt(_*_+R*R)),F=_/L,D=0,E=R/L;l.x=F*u[0]+E*u[1]+D*u[2],l.y=F*u[3]+E*u[4]+D*u[5],l.z=F*u[6]+E*u[7]+D*u[8];var k=Math.sqrt(I),j=-e.angVel*Math.PI*k*.5;j*=1.13,i.x=g[1],i.y=g[4],i.z=g[7],n.cross(l,i),n.x*=j,n.y*=j,n.z*=j,v.linearVelocity.addEqual(n);var V=f.x-m.x,G=f.y-m.y,W=f.z-m.z;A.x=V*g[0]+G*g[3]+W*g[6],A.y=V*g[1]+G*g[4]+W*g[7],A.z=V*g[2]+G*g[5]+W*g[8],o.x=d[2],o.y=d[5],o.z=d[8];j=.05*-t.walkForce;o.scaleEqual(j);var Y,U,X,Z,q,Q,J=i,K=o;J.sub(r,m).cross(J,K).mulMat(y.inverseInertia,J),n.copy(J),n.scaleEqual(.1),y.angularVelocity.addEqual(n);var $=o,tt=i,et=n;tt.x=l.x,tt.y=l.y,tt.z=l.z,$.x=g[1],$.y=g[4],$.z=g[7],et.cross(tt,$);var ot=p.x-c.x,it=p.y-c.y,nt=p.z-c.z,st=ot*$.x+it*$.y+nt*$.z,at=ot*et.x+it*et.y+nt*et.z;Y=st*$.x+0*tt.x+at*et.x,U=st*$.y+0*tt.y+at*et.y,X=st*$.z+0*tt.z+at*et.z;var rt=1/Math.sqrt(Y*Y+U*U+X*X);Y*=rt,U*=rt,X*=rt;d=t.physics.frontBody.rotationElements;var ht=s;ht.x=d[2],ht.y=d[5],ht.z=d[8];Z=Y*d[0]+U*d[3]+X*d[6],q=Y*d[1]+U*d[4]+X*d[7],Q=Y*d[2]+U*d[5]+X*d[8];var ct=Math.atan2(Z,Q),dt=Math.atan2(q,Q),pt=.5*Math.PI,lt=Math.PI;pt<ct?ct=pt:ct<-pt&&(ct=-pt),(lt=.25*Math.PI)<dt?dt=lt:dt<-lt&&(dt=-lt),tt.x=Y,tt.y=U,tt.z=X,et.cross(ht,tt),et.normalize(et),$.cross(et,tt);var ut=ht.x,yt=ht.y,gt=ht.z,mt=ut*$.x+yt*$.y+gt*$.z,ft=ut*tt.x+yt*tt.y+gt*tt.z,At=-Math.atan2(mt,ft),bt=(Math.PI,.01*Math.PI);bt+1*(.08*Math.PI-bt);b=x.angularVelocity;et.scaleEqual(62*At),i.sub(et,b),(Nt=25)*Nt<i.dot(i)&&(i.normalize(i),i.scaleEqual(Nt)),b.addEqual(i),d=t.physics.frontBody.rotationElements,o.x=d[2],o.y=d[5],o.z=d[8],i.x=Y,i.y=U,i.z=X;var vt=o.dot(i),xt=vt;vt<.5&&(xt=.5);var Ct=.04*xt*60;o.x*=Ct,o.y*=Ct,o.z*=Ct;var St=x.linearVelocity,Tt=St.x,Bt=St.y,Ot=St.z,Pt=Tt*d[0]+Bt*d[3]+Ot*d[6],Mt=Tt*d[1]+Bt*d[4]+Ot*d[7],It=Tt*d[2]+Bt*d[5]+Ot*d[8];F=o.x,E=o.y,D=o.z,Z=F*d[0]+E*d[3]+D*d[6],q=F*d[1]+E*d[4]+D*d[7],Q=F*d[2]+E*d[5]+D*d[8];var Nt,zt=.5*t.adjustLerp;Z=(Z-Pt)*zt,q=(q-Mt)*zt,Q=(Q-It)*zt,o.x=Z*d[0]+q*d[1]+Q*d[2],o.y=Z*d[3]+q*d[4]+Q*d[5],o.z=Z*d[6]+q*d[7]+Q*d[8],(Nt=25)*Nt<o.dot(o)&&(o.normalize(o),o.scaleEqual(Nt)),St.addEqual(o)}},z645}(z767),t.z645=e}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z614(){return null!==t&&t.apply(this,arguments)||this}return __extends(z614,t),z614.prototype.update=function(t){t.isTouchingGround()||t.physics.touchingAccTypes&e.z1044.z1054&&t.forceTouchGround()},z614}(z767),t.z614=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z601(){return null!==t&&t.apply(this,arguments)||this}return __extends(z601,t),z601.prototype.update=function(t){t.levels.wheel.step(2)},z601}(z767),e.z601=o}(z0||(z0={})),function(p){var t,e;t=p.z156||(p.z156={}),e=function(t){function z595(){return null!==t&&t.apply(this,arguments)||this}return __extends(z595,t),z595.prototype.update=function(t){if(t.isTouchingGround()){var e=t.currentObject;if(e&&e.accType==p.z1044.z1054){var o=e.body.position,i=t.physics.rearBody.body,n=i.position,s=(t.physics.frontBody.body.position,o.z-e.halfHeight),a=o.z+e.halfHeight-e.thickness,r=e.radius-t.size,c=z1.distanceSquaredXY(n,o);if(c<r*r){var d=n.z-(s+.5*t.size);d<0&&(i.linearVelocity.z-=.5*d),0<(d=n.z-(a-2*t.size))&&(i.linearVelocity.z-=.5*d)}}}},z595}(z767),t.z595=e}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z511(){return null!==t&&t.apply(this,arguments)||this}return __extends(z511,t),z511.prototype.update=function(t){var e=t.currentObject;e&&e.accType==o.z1044.z1054&&e.removez1062(t)},z511}(z767),t.z511=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z449(){var t=null!==e&&e.apply(this,arguments)||this;return t.minTargetY=-10,t.maxTargetY=2,t.maxStrength=100,t}return __extends(z449,e),z449.prototype.update=function(t){e.prototype.update.call(this,t)},z449}(e.z446),e.z449=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z444(){var t=null!==e&&e.apply(this,arguments)||this;return t.z1054_ANG_VEL=1,t}return __extends(z444,e),z444.prototype.update=function(t){if(t.isTouchingGround()){var e=z767.tempVecs[0],o=z767.tempVecs[1],i=z767.tempVecs[2],n=z767.tempVecs[3],s=t.physics.frontBody.body,a=e,r=o,c=i,d=t.targets.dirTarget,p=t.physics.frontBody.rotationElements,l=n;l.x=p[2],l.y=p[5],l.z=p[8];r.x=d.x,r.y=d.y,r.z=d.z,c.cross(l,r),c.normalize(c),a.cross(c,r),a.normalize(a);var u=l.x,y=l.y,g=l.z,m=u*a.x+y*a.y+g*a.z,f=u*r.x+y*r.y+g*r.z,A=60*-Math.atan2(m,f)*t.adjustLerp*this.z1054_ANG_VEL,b=s.angularVelocity;c.scaleEqual(A),o.sub(c,b);o.dot(o);b.addEqual(o)}},z444}(z767),e.z444=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z439(){return null!==t&&t.apply(this,arguments)||this}return __extends(z439,t),z439.prototype.update=function(t){t.bones.tail.ang=-.62*Math.PI,t.bones.shoulder.pitch.targetValue=.2,t.bones.hip.pitch.targetValue=-.25,t.bones.legFL.footOffsetX_.targetValue=0,t.bones.legFR.footOffsetX_.targetValue=0},z439}(z767),e.z439=o}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z428(){return null!==t&&t.apply(this,arguments)||this}return __extends(z428,t),z428.prototype.update=function(t){var e=o.z1092.FindClosestsz1092(t,o.Wheel);e&&t.targets.destTarget.copyFrom(e.position)},z428}(z767),t.z428=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z419(){return null!==t&&t.apply(this,arguments)||this}return __extends(z419,t),z419.prototype.update=function(t){if(t.isTouchingGround()){var e=z767.tempVecs[0],o=z767.tempVecs[1],i=z767.tempVecs[2],n=t.currentObject;if(n){var s=n.body.rotation.elements,a=t.physics.middleBody.body.position,r=t.targets.moveToTarget,c=t.targets.upVecTarget,d=e,p=o,l=i;p.x=c.x,p.y=c.y,p.z=c.z,d.x=s[1],d.y=s[4],d.z=s[7],l.cross(p,d),l.normalize(l);var u=r.x-a.x,y=r.y-a.y,g=r.z-a.z,m=u*d.x+y*d.y+g*d.z,f=u*l.x+y*l.y+g*l.z,A=m*d.x+0*p.x+f*l.x,b=m*d.y+0*p.y+f*l.y,v=m*d.z+0*p.z+f*l.z,x=1/Math.sqrt(A*A+b*b+v*v);A*=x,b*=x,v*=x;var C=t.targets.dirTarget;C.x=A,C.y=b,C.z=v}}},z419}(z767),e.z419=o}(z0||(z0={})),function(a){var t,e;t=a.z156||(a.z156={}),e=function(t){function z216(){return null!==t&&t.apply(this,arguments)||this}return __extends(z216,t),z216.prototype.update=function(t){if(t.targetObject&&t.targetObject.accType==a.z1044.z1054){var e=t.targetObject;if(0<e.hamsters.length){for(var o=0,i=0;i<e.hamsters.length;i++){o+=e.hamsters.data[i].targets.wheelDir}if(0<o)return void(t.targets.wheelDir=1);if(o<0)return void(t.targets.wheelDir=-1)}if(0<e.body.angularVelocity.z)t.targets.wheelDir=-1;else if(e.body.angularVelocity.z<0)t.targets.wheelDir=1;else{var n=t.physics.rearBody.body.position,s=t.physics.frontBody.body.position;n.x<s.x?t.targets.wheelDir=1:t.targets.wheelDir=-1}}},z216}(z767),t.z216=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z399(){return null!==t&&t.apply(this,arguments)||this}return __extends(z399,t),z399.prototype.update=function(t){t.physics.frontBody.body.shapes.friction=0,t.physics.middleBody.body.shapes.friction=0,t.physics.rearBody.body.shapes.friction=0},z399}(z767),e.z399=o}(z0||(z0={})),function(C){var t,e;t=C.z156||(C.z156={}),e=function(t){function z373(){return null!==t&&t.apply(this,arguments)||this}return __extends(z373,t),z373.prototype.update=function(t){var e=z767.tempVecs[0],o=t.physics.frontBody.body;o.position;if(t.isTouchingGround()){var i=t.physics.frontBody.rotationElements,n=C.app.world.timeStep;e.x=i[2],e.y=i[5],e.z=i[8];var s=t.targets.dirTarget,a=e.dot(s);a<.5&&(a=.5);var r=.04*a*60;e.x*=r,e.y*=r,e.z*=r;var c=o.linearVelocity,d=c.x,p=c.y,l=c.z,u=d*i[0]+p*i[3]+l*i[6],y=d*i[1]+p*i[4]+l*i[7],g=d*i[2]+p*i[5]+l*i[8],m=e.x,f=e.y,A=e.z,b=m*i[0]+f*i[3]+A*i[6],v=m*i[1]+f*i[4]+A*i[7],x=m*i[2]+f*i[5]+A*i[8];b=32*(b-u)*n,v=32*(v-y)*n,x=32*(x-g)*n,e.x=b*i[0]+v*i[1]+x*i[2],e.y=b*i[3]+v*i[4]+x*i[5],e.z=b*i[6]+v*i[7]+x*i[8];625<e.dot(e)&&(e.normalize(e),e.scaleEqual(25)),c.addEqual(e)}},z373}(z767),t.z373=e}(z0||(z0={})),function(M){var t,e;t=M.z156||(M.z156={}),e=function(e){function z363(){var t=null!==e&&e.apply(this,arguments)||this;return t.SPEED_RUN=1,t.ease_run_vel=.24,t.maxHamVel=1,t.fracWheelVel=1,t.touchGroundVel=.15,t.sizeMult=1,t}return __extends(z363,e),z363.prototype.update=function(t){if(t.isTouchingGround()){var e=t.currentObject;if(e){var o=t.physics.frontBody.body,i=t.physics.frontBody.rotationElements,n=z767.tempVecs[0];n.x=i[2],n.y=i[5],n.z=i[8];var s=t.targets.dirTarget,a=n.dot(s);a<.5&&(a=.5);var r=13.3*a*t.size;if(!((r*=t.runSpeedFrac)<.001)){var c=e.body,d=t.targets.wheelDir,p=-c.angularVelocity.z,l=(r=t.runSpeedFrac*e.hamSpeedConv-p*d*this.fracWheelVel,this.maxHamVel);l<r?r=l:r<-l&&(r=-l);var u=o.linearVelocity,y=this.ease_run_vel;r<0&&(u=t.physics.rearBody.body.linearVelocity),0==c.angularVelocity.z&&(y=.5,r*=2.25,u.y+=(n.y*r-u.y)*y),u.x+=(n.x*r-u.x)*y,u.z+=(n.z*r-u.z)*y;var g=t.physics.frontBody,m=g.body.position,f=e.body.position,A=m.z-f.z,b=m.y-1.5*t.size-f.y,v=e.halfHeight-.1*t.size;if(u=o.linearVelocity,b<0&&A<v&&-v<A){var x=m.x-f.x,C=m.y-f.y,S=x*x+C*C,T=e.radius-e.thickness-t.size*this.sizeMult;T*T<S&&!g.onGround&&t.physics.frontBody.touchingAccTypes,S<T*T&&g.onGround&&t.physics.frontBody.touchingAccTypes;var B=Math.sqrt(S),O=x/B,P=C/B;c.angularVelocity.z,u.x+=O*this.touchGroundVel,u.y+=P*this.touchGroundVel,(!g.onGround||S<T*T)&&(t.physics.frontBody.touchingAccTypes&M.z1044.z1054&&!g.onGround&&t.physics.frontBody.touchingAccTypes,u.y-=this.touchGroundVel,u.y)}}}}},z363}(z767),t.z363=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z360(){return null!==t&&t.apply(this,arguments)||this}return __extends(z360,t),z360.prototype.update=function(t){var e=t.localPos,o=t.currentObject;if(o){var i=o.body,n=i.rotation.elements,s=i.position,a=t.physics.frontBody.body.position,r=a.x-s.x,c=a.y-s.y,d=a.z-s.z,p=r*n[0]+c*n[3]+d*n[6],l=r*n[1]+c*n[4]+d*n[7],u=r*n[2]+c*n[5]+d*n[8];e.x=p,e.y=l,e.z=u}},z360}(z767),e.z360=o}(z0||(z0={})),function(z){var t,e;t=z.z156||(z.z156={}),e=function(t){function z335(){return null!==t&&t.apply(this,arguments)||this}return __extends(z335,t),z335.prototype.update=function(t){var e=t.currentObject;if(e&&e.accType==z.z1044.z1054){var o=t.physics,i=e.base.body.rotation.elements,n=e.body.position,s=e.radius,a=t.size,r=t.targets.pathTarget,c=t.targets.moveToTarget,d=r.x-n.x,p=r.y-n.y,l=r.z-n.z,u=s-a,y=t.targets.wheelDir,g=.2*-Math.PI;s<.7&&(g=.25*-Math.PI,u=s-.5*a);var m=d*i[0]+p*i[3]+l*i[6];g*=y;var f=t.currentObject.axisMat.elements,A=(d=(S=o.frontBody.body.position).x-n.x,p=S.y-n.y,l=S.z-n.z,m=d*f[0]+p*f[3]+l*f[6],d*f[1]+p*f[4]+l*f[7]),b=d*f[2]+p*f[5]+l*f[8],v=Math.atan2(m,b);if(b=Math.cos(v+g)*u,m=Math.sin(v+g)*u,c.x=m*f[0]+A*f[1]+b*f[2],c.y=m*f[3]+A*f[4]+b*f[5],c.z=m*f[6]+A*f[7]+b*f[8],c.x+=n.x,c.y+=n.y,c.z+=n.z,2<e.hamsters.length){var x=e.body.position;if(0<(I=t.physics.frontBody.body.position.z-x.z))return;for(var C=t.targets.moveToTarget.z,S=(y=t.targets.wheelDir,t.physics.headBody.body.position),T=0,B=0;B<e.hamsters.length;B++){var O=e.hamsters.data[B];if(O!=t){var P=O.physics.rearBody.body.position,M=(S.x-P.x)*y,I=S.z-P.z;if(M<0&&I<0){T++;var N=P.z+2*t.size;C==t.targets.moveToTarget.z?C=N:C<N&&(C=N)}}}1<T&&C>t.targets.moveToTarget.z&&(C>x.z+t.size?t.targets.moveToTarget.z=x.z+t.size:t.targets.moveToTarget.z=C)}}},z335}(z767),t.z335=e}(z0||(z0={})),function(r){var t,e;t=r.z156||(r.z156={}),e=function(t){function z323(){return t.call(this)||this}return __extends(z323,t),z323.prototype.update=function(t){var e=t.currentObject;if(!e||e.accType!=r.z1044.z1054){if(!t.targetObject||t.targetObject.accType!=r.z1044.z1054)return;e=t.targetObject}var o=t.cage;if(o){var i=e.position,n=t.physics.headBody.body.position,s=o.getGraphNodeAt(n.x,t.position.y,i.z),a=e.centerGraphNode;t.targetObject=e,t.setPathStartNodeEndNode(s,a)}},z323}(z767),t.z323=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z287(){return null!==t&&t.apply(this,arguments)||this}return __extends(z287,t),z287.prototype.update=function(t){t.runSpeedFrac=0},z287}(z767),e.z287=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z286(){return null!==t&&t.apply(this,arguments)||this}return __extends(z286,t),z286.prototype.update=function(t){t.runSpeedFrac=1},z286}(z767),e.z286=o}(z0||(z0={})),function(p){var t,e;t=p.z156||(p.z156={}),e=function(e){function z284(){var t=null!==e&&e.apply(this,arguments)||this;return t.count=0,t.SRN_MIN=.7,t.SRN_MAX=.8,t.SRN_SPEED=.1,t.TRIP_SPEED=1,t.EASE_RUN_SPEED_FRAC=.2,t}return __extends(z284,e),z284.prototype.update=function(t){var e=t.currentObject;if(e&&e.accType==p.z1044.z1054){if(1==e.hamsters.length?(this.SRN_SPEED=.1,this.SRN_MIN=.5):(this.SRN_SPEED=.2,this.SRN_MIN=.8),this.SRN_MAX=1,this.SRN_MIN<this.SRN_MAX?t.smoothRandomNumber1.min=this.SRN_MIN:t.smoothRandomNumber1.min=this.SRN_MAX,t.tripping?(3==t.tripping?(this.EASE_RUN_SPEED_FRAC=1,t.smoothRandomNumber1.min=0):1==t.tripping&&((this.EASE_RUN_SPEED_FRAC=1)<e.hamsters.length?t.smoothRandomNumber1.min=0:t.smoothRandomNumber1.min=.4),t.smoothRandomNumber1.max=0):(this.EASE_RUN_SPEED_FRAC=.2,t.smoothRandomNumber1.max=this.SRN_MAX,t.smoothRandomNumber1.min=this.SRN_MIN),t.smoothRandomNumber1.speed=this.SRN_SPEED,t.smoothRandomNumber1.update(),t.runSpeedFrac=(t.smoothRandomNumber1.value-t.runSpeedFrac)*this.EASE_RUN_SPEED_FRAC+t.runSpeedFrac,0==t.targets.nextFrameTarget){var o=5,i=10;t.targets.nextFrameTarget=p.app.frameNum+60*o+60*(i-o)*Math.random()}if(p.app.frameNum>t.targets.nextFrameTarget){o=.5,i=3;if(t.tripping)o=5,i=10,t.tripping=0;else{var n=t.physics.frontBody.body.position,s=e.body.position,a=n.x-s.x,r=n.y-s.y,c=Math.atan2(r,a),d=t.targets.wheelDir;20<Math.abs(e.body.angularVelocity.z)&&(.9<t.runSpeedFrac?0<d&&c>.25*-Math.PI?t.tripping=1:d<0&&c<.75*-Math.PI?t.tripping=1:(o=5,i=10):1<e.hamsters.length&&(d<0&&c>.3*-Math.PI?t.tripping=2:0<d&&c<.7*-Math.PI?t.tripping=2:(o=5,i=10)))}t.targets.nextFrameTarget=p.app.frameNum+60*o+60*(i-o)*Math.random()}}},z284}(z767),t.z284=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z269(){return null!==t&&t.apply(this,arguments)||this}return __extends(z269,t),z269.prototype.update=function(t){var e=t.currentObject,o=e.position.z-e.height-3*t.size,i=t.targets;i.moveToTarget.z>o&&(i.moveToTarget.z=o),i.lookToTarget.z>o&&(i.lookToTarget.z=o)},z269}(z767),e.z269=o}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z260(){return null!==t&&t.apply(this,arguments)||this}return __extends(z260,t),z260.prototype.update=function(t){var e=n.app.pointerDownPosition,o=t.targets.moveToTarget,i=t.targets.lookToTarget;o.x=e.x,o.y=e.y+t.size,o.z=e.z,i.x=o.x,i.y=o.y,i.z=o.z},z260}(z767),t.z260=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z233(){return null!==t&&t.apply(this,arguments)||this}return __extends(z233,t),z233.prototype.update=function(t){t.tripping=0},z233}(z767),e.z233=o}(z0||(z0={})),function(l){var t,e;t=l.z156||(l.z156={}),e=function(t){function z230(){return null!==t&&t.apply(this,arguments)||this}return __extends(z230,t),z230.prototype.update=function(t,e){if(e||(e=t.targetObject),e&&e.accType==l.z1044.z1054){var o=t.targets.upVecTarget,i=e.body.position,n=t.physics.frontBody.body.position,s=i.x-n.x,a=i.y-n.y;if(i.z-n.z>e.halfHeight+4*t.size)return o.x=0,o.y=1,void(o.z=0);var r=s*s+a*a;if(r>e.radius*e.radius)return o.x=0,o.y=1,void(o.z=0);var c=t.physics.rearBody.body.position,d=t.physics.middleBody.body.position;if(r=(s=i.x-d.x)*s+(a=i.y-d.y)*a,n.z>c.z||n.z>i.z-e.halfHeight){var p=Math.sqrt(r);o.x=s/p,o.y=a/p,o.z=0}else o.x=0,o.y=1,o.z=0}},z230}(z767),t.z230=e}(z0||(z0={})),function(g){var t,e;t=g.z156||(g.z156={}),e=function(t){function z223(){return null!==t&&t.apply(this,arguments)||this}return __extends(z223,t),z223.prototype.update=function(t){if(t.isTouchingGround()){var e=t.currentObject;if(!e||e.accType!=g.z1044.z1054)return;var o=t.physics.frontBody.body.position,i=e.base.body.rotation.elements,n=e.body.position;if(t.currentObject.computeUpVec){var s=t.targets.upVecTarget,a=n.x-o.x,r=n.y-o.y,c=n.z-o.z,d=a*i[0]+r*i[3]+c*i[6],p=a*i[1]+r*i[4]+c*i[7],l=Math.sqrt(d*d+p*p),u=d/l,y=p/l;s.x=u*i[0]+y*i[1]+0*i[2],s.y=u*i[3]+y*i[4]+0*i[5],s.z=u*i[6]+y*i[7]+0*i[8]}}},z223}(z767),t.z223=e}(z0||(z0={})),function(s){var t,e;t=s.z156||(s.z156={}),e=function(n){function z185(){var t=null!==n&&n.apply(this,arguments)||this;return t.accType=s.z1044.z1054,t}return __extends(z185,n),z185.prototype.update=function(t){if(n.prototype.update.call(this,t),t.isFollowingPath())2==t.pathIndex&&3==t.path.length&&t.targetObject&&t.targetObject.accType==s.z1044.z1054&&t.path[0]==t.targetObject.nodes[1]&&(t.isInState(s.z5.name)||(t.path.length=0,t.path2.length=0));else{if(t.targetObject&&t.targetObject.targetPosition&&t.targetObject.isOnScene){var e=t.targetObject.targetPosition;t.cage&&t.cage.isInBox(e.x,e.y,e.z)&&(t.targets.destTarget.equals(t.targetObject.targetPosition)||t.targets.destTarget.copyFrom(t.targetObject.targetPosition))}if(!t.isInState(s.z5.name)){var o=t.targetObject;if(!o||o.accType!=s.z1044.z1054)return;.3<t.position.z&&(t.focusDist=.01*t.initFocusDist);var i=t.physics.headBody.body.position;if(!o.isInWheel(i.x,i.y,i.z)&&!o.isInWheel(t.position.x,t.position.y,t.position.z))return;t.pathIndex=0,t.path.length=0,t.path2Index=0,t.path2.length=0,t.targetNode=o.nodes[0],t.path[0]=o.nodes[0],t.path[1]=o.nodes[1],t.pubsub.broadcast(s.WheelEvents.ENTER)}}},z185}(t.z200),t.z185=e}(z0||(z0={})),function(f){var t,e;t=f.z768||(f.z768={}),e=function(t){function z1012(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1012,t),z1012.prototype.test=function(t){var e=t.targetObject;if(!e)return!1;if(e.accType!=f.z1044.z1054)return!1;if(!e.base)return!1;var o=e.body,i=o.rotation.elements,n=o.position,s=t.physics.headBody.body.position,a=s.x-n.x,r=s.y-n.y,c=s.z-n.z,d=a*i[0]+r*i[3]+c*i[6],p=a*i[1]+r*i[4]+c*i[7],l=a*i[2]+r*i[5]+c*i[8],u=d*d+l*l,y=e.radius,g=y*y,m=e.halfHeight;return g<u&&p<m},z1012}(z770),t.z1012=e}(z0||(z0={})),function(b){var t,e;t=b.z768||(b.z768={}),e=function(t){function z1010(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1010,t),z1010.prototype.test=function(t){var e,o=t.path[t.path.length-1];if(o&&(e=o.data.obj)&&e.accType==b.z1044.z1054){var i=e.body,n=i.position,s=e.radius,a=e.halfHeight,r=t.size,c=t.physics.frontBody.body,d=(n=i.position,c.position),p=d.x-n.x,l=d.y-n.y,u=d.z-n.z,y=i.rotation.elements,g=p*y[0]+l*y[3]+u*y[6],m=p*y[1]+l*y[4]+u*y[7],f=p*y[2]+l*y[5]+u*y[8],A=a-.5*r;return g*g+f*f<s*s&&m<A&&-A<m}},z1010}(z770),t.z1010=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1007(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1007,t),z1007.prototype.test=function(t){var e=t.currentObject;if(!e)return!0;if(!e.base)return!0;var o=e.body,i=o.rotation.elements,n=o.position,s=t.physics.frontBody.body.position,a=s.x-n.x,r=s.y-n.y,c=s.z-n.z,d=a*i[0]+r*i[3]+c*i[6],p=a*i[1]+r*i[4]+c*i[7],l=a*i[2]+r*i[5]+c*i[8],u=d*d+l*l,y=e.radius,g=t.size,m=g+y,f=m*m,A=e.halfHeight+g;return f<u||(A<p||p<-A)},z1007}(z770),e.z1007=o}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z990(){return null!==t&&t.apply(this,arguments)||this}return __extends(z990,t),z990.prototype.test=function(t){var e=t.memory.getAccessories(o.z1044.z1054);return!(!e||0==e.length)},z990}(z770),t.z990=e}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z850(){return null!==t&&t.apply(this,arguments)||this}return __extends(z850,t),z850.prototype.test=function(t){return!(!t.targetObject||t.targetObject.accType!=e.z1044.z1054)},z850}(z770),t.z850=o}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z834(){return null!==t&&t.apply(this,arguments)||this}return __extends(z834,t),z834.prototype.test=function(t){var e=t.currentObject;return!(!e||e.accType!=o.z1044.z1054)},z834}(z770),t.z834=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z831(){return null!==t&&t.apply(this,arguments)||this}return __extends(z831,t),z831.prototype.test=function(t){return t.levels.wheel.value<=0},z831}(z770),e.z831=o}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z806(){return null!==t&&t.apply(this,arguments)||this}return __extends(z806,t),z806.prototype.test=function(t){return!t.path[t.pathIndex]||(!t.path[t.pathIndex].data.obj||(t.path[t.pathIndex].data.obj.accType!=e.z1044.z1054||void 0))},z806}(z770),t.z806=o}(z0||(z0={})),function(m){var t,e;t=m.z768||(m.z768={}),e=function(t){function z777(){return null!==t&&t.apply(this,arguments)||this}return __extends(z777,t),z777.prototype.test=function(t){var e=t.currentObject;if(e&&e.accType==m.z1044.z1054){var o=t.targets.currentTarget;t.targets.moveToTarget,o=t.targets.destTarget;var i=e.body,n=i.rotation.elements,s=i.position,a=o.x-s.x,r=o.y-s.y,c=o.z-s.z,d=a*n[0]+r*n[3]+c*n[6],p=a*n[1]+r*n[4]+c*n[7],l=a*n[2]+r*n[5]+c*n[8],u=d*d+l*l,y=e.radius;y*=1.1;var g=e.halfHeight;return y*y<u||g<p||p<-g}},z777}(z770),t.z777=e}(z0||(z0={})),function(o){var t=function(e){function z6(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z726],t.updatez156=[o.z156.z185],t.exitz156=[],t.transitions=[{condition:o.z768.z982,falseNode:{condition:o.z768.z986,falseNode:{state:o.z112}}},{condition:o.z768.z850,trueNode:{condition:o.z768.z852,falseNode:{condition:o.z768.z1029,trueNode:{state:o.z112,actions:[o.z156.z510]}}}},{condition:o.z768.z976,trueNode:{state:o.z112}},{condition:o.z768.z834,falseNode:{condition:o.z768.z850,falseNode:{state:o.z112}}},{condition:o.z768.z882,trueNode:{condition:o.z768.z880,falseNode:{state:o.z34,actions:[o.z156.z483,o.z156.z470]}}}],t}return __extends(z6,e),z6}(z49);o.z6=t}(z0||(z0={})),function(o){var t=function(e){function z9(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z406,o.z156.z286,o.z156.z472,o.z156.z216,o.z156.z377],t.updatez156=[o.z156.z614,o.z156.z686,o.z156.z362,o.z156.z661,o.z156.z461,o.z156.z449,o.z156.z369,o.z156.z590,o.z156.z214,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z165],t.exitz156=[o.z156.z502],t.transitions=[{condition:o.z768.z962,trueNode:{state:o.z21,actions:[]}},{condition:o.z768.z1010,trueNode:{state:o.z7}},{condition:o.z768.z873,trueNode:{state:o.z65,actions:[],level:1}},{condition:o.z768.z975,trueNode:{state:o.z66,level:1}},{condition:o.z768.z1012,trueNode:{state:o.z66,level:1,actions:[o.z156.z323]}},{condition:o.z768.z820,trueNode:{state:o.z66,level:1}},{condition:o.z768.z850,falseNode:{state:o.z66,level:1}},{condition:o.z768.z961,falseNode:{state:o.z66,level:1}},{condition:o.z768.z913,falseNode:{state:o.z66,level:1}},{condition:o.z768.z806,trueNode:{state:o.z66,level:1}}],t}return __extends(z9,e),z9}(z49);o.z9=t}(z0||(z0={})),function(o){var t=function(e){function z8(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z318,o.z156.z554],t.updatez156=[o.z156.z716,o.z156.z235,o.z156.z278,o.z156.z362,o.z156.z346,o.z156.z223,o.z156.z360,o.z156.z269,o.z156.z419,o.z156.z444,o.z156.z373,o.z156.z729,o.z156.z590,o.z156.z461,o.z156.z732,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z739],t.exitz156=[o.z156.z502,o.z156.z320,o.z156.z314,o.z156.z465,o.z156.z469],t.transitions=[{condition:o.z768.z1007,trueNode:{state:o.z66,level:1,actions:[]}}],t}return __extends(z8,e),z8}(z49);o.z8=t}(z0||(z0={})),function(o){var t=function(e){function z7(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z216,o.z156.z726,o.z156.z434,o.z156.z500,o.z156.z475,o.z156.z439,o.z156.z278,o.z156.z514,o.z156.z761,o.z156.z483,o.z156.z752,o.z156.z501,o.z156.z399],t.updatez156=[o.z156.z507,o.z156.z601,o.z156.z724,o.z156.z716,o.z156.z235,o.z156.z718,o.z156.z278,o.z156.z284,o.z156.z335,o.z156.z346,o.z156.z282,o.z156.z223,o.z156.z360,o.z156.z419,o.z156.z444,o.z156.z363,o.z156.z595,o.z156.z729,o.z156.z461,o.z156.z202,o.z156.z590,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z732],t.exitz156=[o.z156.z477,o.z156.z500,o.z156.z511],t.transitions=[{condition:o.z768.z1007,trueNode:{state:o.z108,level:1,actions:[o.z156.z323]}},{condition:o.z768.z777,trueNode:{state:o.z8}},{condition:o.z768.z982,falseNode:{condition:o.z768.z986,trueNode:{state:z7},falseNode:{condition:o.z768.z984,trueNode:{state:o.z8}}}},{condition:o.z768.z965,trueNode:{state:o.z66,level:1,actions:[o.z156.z483,o.z156.z469,o.z156.z427,o.z156.z239]}}],t}return __extends(z7,e),z7}(z49);o.z7=t}(z0||(z0={})),function(o){var t=function(e){function z5(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.states=[o.z9,o.z7,o.z8],t.updatez156=[o.z156.z379],t.exitz156=[o.z156.z287,o.z156.z233],t.initialState=o.z9,t.transitions=[],t.listeners=[{event:o.z1061Events.WALK,state:o.z66}],t}return __extends(z5,e),z5}(z49);o.z5=t}(z0||(z0={})),function(o){var t=function(e){function PickUp(){var t=null!==e&&e.apply(this,arguments)||this;return t._owner=null,t.radius=0,t.isActive=!1,t.localPosition=BABYLON.Vector3.Zero(),t.bone=null,t.placementType=o.PlacementType.FRONT,t.offsetPos=BABYLON.Vector3.Zero(),t}return __extends(PickUp,e),Object.defineProperty(PickUp.prototype,"owner",{get:function(){return this._owner},set:function(t){this._owner=t},enumerable:!1,configurable:!0}),PickUp.prototype.setPositionDrag=function(t,e,o,i){void 0===i&&(i=!1),this.setPosition(t,e,o)},PickUp.prototype.updateLocalBonePositionFromWorld=function(){this.bone&&(this.bone.getLocalPositionFromAbsoluteToRef(this.position,this.owner.mesh,this.localPosition),this.onChangeObservable.notifyObservers(this))},PickUp.prototype.updateWorldPositionFromLocalBone=function(){this.bone&&(this.bone.getAbsolutePositionFromLocalToRef(this.localPosition,this.owner.mesh,this.position),this.onChangeObservable.notifyObservers(this))},PickUp.prototype.addToActiveObjects=function(){},PickUp.prototype.removeFromActiveObjects=function(){},PickUp.prototype.getObjectCount=function(){return o[this.constructor.name].objectCount},PickUp.prototype.getName=function(){return this.shapeName},PickUp.prototype.updateCage=function(){},PickUp.objectCount=-1,PickUp}(z1068);o.PickUp=t}(z0||(z0={})),function(t){var e=function(){function PickUpList(){this.items=[],this.indexes={}}return PickUpList.prototype.remove=function(t){var e=this.items,o=e.indexOf(t);-1!==o&&(e[o]=e[e.length-1],e.length--)},PickUpList.prototype.add=function(t){this.indexes[t.id]=this.items.length,this.items.push(t)},PickUpList}();t.PickUpList=e}(z0||(z0={})),function(e){var t=function(n){function Bed(){var t=null!==n&&n.apply(this,arguments)||this;return t.saveToDB=!1,t}return __extends(Bed,n),Bed.prototype.init=function(t){this.accType=e.z1044.z1057,this.shapeName="Bed",n.prototype.init.call(this,t),this.addToScene(),this.mapPlacementInfo||(this.mapPlacementInfo=new e.MapPlacementInfo({}))},Bed.prototype.addToScene=function(){this.isOnScene||(this.isOnScene=!0,this.addToActiveObjects(),this.onChangeObservable.notifyObservers(this))},Bed.prototype.setPosition=function(t,e,o,i){n.prototype.setPosition.call(this,t,e,o,i)},Bed.prototype.removeFromScene=function(){this.isOnScene&&(this.isOnScene=!1,this.removeFromActiveObjects(),this.onChangeObservable.notifyObservers(this))},Bed.prototype.addToActiveObjects=function(){-1==Bed.activeObjects.indexOf(this)&&Bed.activeObjects.push(this)},Bed.prototype.removeFromActiveObjects=function(){var t=Bed.activeObjects.indexOf(this);-1!=t&&Bed.activeObjects.splice(t,1)},Bed.prototype.getProps=function(){return n.prototype.getProps.call(this)},Bed}(e.z1092);e.Bed=t}(z0||(z0={})),function(e){var t=function(){function BedConfig(){this.maxObjects=60}return BedConfig.prototype.initObjectPool=function(t){ObjectPool.addClass("Bed",e.Bed,{})},BedConfig.prototype.getSPSData=function(t){},BedConfig}();e.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1024(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1024,t),z1024.prototype.test=function(t){t.memory.bed||t.chooseABed();var e=t.memory.bed;if(e)return!(!e.parent||!e.parent.bedding)},z1024}(z770),e.z1024=o}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z1005(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1005,t),z1005.prototype.test=function(t){var e=t.memory.getAccessories(o.z1044.z1057);return!(!e||0==e.length)},z1005}(z770),t.z1005=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z980(){return null!==t&&t.apply(this,arguments)||this}return __extends(z980,t),z980.prototype.test=function(t){var e=t.targets.destTarget,o=t.physics.headBody.body.position;return z1.distanceSquared(e,o)<.09},z980}(z770),e.z980=o}(z0||(z0={})),function(D){var t=function(s){function Bedding(){var t=s.call(this)||this;return t.accType=D.z1044.z1047,t.floorY=0,t.padding=0,t.cage=null,t.shapeName="",t.pieces=[],t.noise=[],t.originalPositions=[],t.longTermPositions=[],t.previousPositions=[],t.width=0,t.depth=0,t.subSize=0,t._minHeight=0,t._maxHeight=0,t.numHoleGridCols=0,t.gridSquareSize=.1,t.sideHeights=[],t.previousSideHeights=[],t.nodes=void 0,t.pubsub=new Pubsub,t._isDirty=!1,t.hams=[],t.hamz156=[],t.hamsFrameAdded=[],t.food=[],t._tempAccArray=[],t._tempArr=[],t._skipChangeAltCols=[],t._maxColHeights=[],t._updateMaxHeightsFrame=null,t._dirtyHeights=!1,t.resetHeightsFrame=-1,t.bindedResetHeights=void 0,t.tempArr=[],t.dirUpRight=new BABYLON.Vector3(1,0,1).normalize(),Bedding.count++,t.bindedResetHeights=t.resetHeights.bind(t),t}return __extends(Bedding,s),Object.defineProperty(Bedding.prototype,"minHeight",{get:function(){return this._minHeight},set:function(t){this._minHeight=t},enumerable:!1,configurable:!0}),Object.defineProperty(Bedding.prototype,"maxHeight",{get:function(){return this._maxHeight},set:function(t){this._maxHeight=t},enumerable:!1,configurable:!0}),Bedding.prototype.getHeightAt=function(t,e,o){if(void 0===o&&(o=!1),o){var i=this.mesh._maxX-.001,n=this.mesh._maxZ-.001,s=this.mesh.position.x-i,a=this.mesh.position.x+i,r=this.mesh.position.z-n,c=this.mesh.position.z+n;t<s?t=s:a<t&&(t=a),e<r?e=r:c<e&&(e=c)}return this.mesh.getHeightAtCoordinates(t,e)},Object.defineProperty(Bedding.prototype,"isDirty",{get:function(){return this._isDirty},set:function(t){this._isDirty=t},enumerable:!1,configurable:!0}),Bedding.prototype.forceUpdateAll=function(){this.updateAll(!0)},Bedding.prototype.updateAll=function(t){t&&this.mesh.updateCoordinateHeights(),this.updateHams(),(this._isDirty||t)&&(this.updatePieces(),this.mesh.refreshBoundingInfo(),this.updateBodyBounds(),this.body.shapes.updateProxy(),this.updateNodes(),this.cage.resetChildrenPositions(),this._isDirty=!1)},Bedding.prototype.updateHams=function(){for(var t=this.hams,e=this.hamz156,o=this.hams.length-1;0<=o;o--){var i=this.hams[o];if(i.isOnScene)if(this.isHamInsideBedding(i))for(var n=0;n<e.length;n++)e[n].update(i);else this.removeHamFromUpdate(i);else this.removeHamFromUpdate(i)}var s=D.app.updateOnceNextFrame;0<t.length&&-1==s.indexOf(this.update)&&s.push(this.update)},Bedding.prototype.isHamInsideBedding=function(t){var e=.5*this.width,o=this.position.x-e,i=this.position.x+e,n=this.position.y,s=t.physics.headBody.body.position,a=t.physics.frontBody.body.position,r=t.physics.rearBody.body.position,c=t.size,d=s.x-c,p=s.x+c,l=s.y+c;return a.x-c<d&&(d=a.x-c),r.x-c<d&&(d=r.x-c),a.x+c>p&&(p=a.x+c),r.x+c>p&&(p=r.x+c),a.y+c<l&&(l=a.y+c),r.y+c<l&&(l=r.y+c),!(p<o)&&(!(i<d)&&!(l<n))},Bedding.prototype.removeHamFromUpdate=function(t){var e=this.hams.indexOf(t);this.hamsFrameAdded[e]==D.app.frameNum&&D.app.frameNum,0<=e&&this.hams.splice(e,1),0<=(e=t.underBeddingsTEST.indexOf(this))&&(1<t.underBeddingsTEST.length&&t.underBeddingsTEST,t.underBeddingsTEST.splice(e,1))},Bedding.prototype.addHamForUpdate=function(t){if(-1==this.hams.indexOf(t))return this.hams.push(t),t.frameNumAddedToBedding=D.app.frameNum,-1==D.app.updateOnce.indexOf(this.update)&&D.app.updateOnce.push(this.update),this.hamsFrameAdded[this.hams.indexOf(t)]=D.app.frameNum,-1==t.underBeddingsTEST.indexOf(this)&&t.underBeddingsTEST.push(this),!0},Bedding.prototype.init=function(t){this.mesh&&this.mesh.unfreezeWorldMatrix(),this.update=this.updateAll.bind(this);var e=this.width,o=this.depth,i=t.floorY;.01!=t.floorY||t.floorY,this.width=this.width,this.depth=this.depth;var n=e+"x"+o;this.shapeName="Bedding"+n,this.textureName="beddingTexture";var s=t.x,a=t.y,r=t.z,c=t.rx,d=t.ry,p=t.rz,l=t.padding,u=t.scene;this.scene=u,this.floorY=i,this.padding=l,this.world=t.world,this.cage=t.cage;var y=Bedding.MatUnitSubs,g=e*y,m=o*y;this.subSize=e/g;if(null!=t.renderingGroupID&&null!=t.renderingGroupID&&(this.renderingGroupID=t.renderingGroupID),this.cage.isMenuItem&&!this.mesh){var f=z2.Graphics.MeshBuilder.generateLandscape(e,o,g,m,1,u,l,0);return this.scene.removeMesh(f),(this.mesh=f).position.x=s,f.position.y=a+this.padding,f.position.z=r,void(this.sides||(this.sides=ObjectPool.get("BeddingSides",{name:"BeddingSides"+n,renderingGroupID:this.renderingGroupID}),this.sides.createMesh(this.mesh,this.floorY,!1,!0,!0,!0),this.sides.textureName="beddingSidesTexture"+D.BeddingSides.count%4,this.sides.parent=this))}this.numHoleGridCols=Math.ceil(this.cage.width/this.gridSquareSize),this.holeGridAreas=[],this.holeGridAreasFrameNum=[];var A=this.hamz156;if(A.length||(A.push(z641.getz767(D.z156.z626)),A.push(z641.getz767(D.z156.z441)),A.push(z641.getz767(D.z156.z338)),A.push(z641.getz767(D.z156.z570)),A.push(z641.getz767(D.z156.z289)),A.push(z641.getz767(D.z156.z562)),A.push(z641.getz767(D.z156.z513)),A.push(z641.getz767(D.z156.z727))),t.color&&this.setColor(t.color.r,t.color.g,t.color.b),this.body){this.minHeight=0;S=2*(v=this.width-1)+1,T=((x=4)-1)*(C=.7);this.nodes=z1083.resetNodeGrid(this.nodes,0,0,.5*-C,v,T,S,x,this.cage)}else{this.rotationQuaternion=BABYLON.Quaternion.Identity();var b=[1,1,.2,D.App.PhysicsGroupBedding,4294967295];f=z2.Graphics.MeshBuilder.generateLandscape(e,o,g,m,1,u,l,0);this.scene.removeMesh(f),(this.mesh=f).position.x=s,f.position.y=a+this.padding,f.position.z=r;0,this.body=new OIMO.Body({size:[e,o],pos:[s,a,r],rot:[c,d,p],world:this.world,config:b,type:"ground",thickness:0,groundMesh:f,fracPadding:.3}).body,(this.body.shapes.entity=this).sides||(this.sides=ObjectPool.get("BeddingSides",{name:"BeddingSides"+n}),this.sides.createMesh(this.mesh,this.floorY,!1,!0,!0,!0),this.sides.textureName="beddingSidesTexture"+D.BeddingSides.count%4,this.sides.parent=this),this.sidesInner||(this.sidesInner=ObjectPool.get("BeddingSides",{name:"BeddingSidesInner"+n}),this.sidesInner.createMesh(this.mesh,this.floorY,!1,!0,!0,!0,1),this.sidesInner.parent=this);var v,x,C,S=2*(v=this.width-1)+1,T=((x=4)-1)*(C=.7);this.nodes=z1083.createNodeGrid(0,0,.5*-C,v,T,S,x,this.cage,0,0,this)}if(this.sides&&this.sides.setColor(t.color.r,t.color.g,t.color.b),this.sidesInner&&this.sidesInner.setColor(.75*t.color.r,.75*t.color.g,.75*t.color.b),0==this.pieces.length){var B,O=e*o*5,P=(e-.2)/O;B=o;for(var M=0;M<O&&D.BeddingParticle.count<2e3;M++){var I=.5*P+M*P-(.5*e-.1),N=Math.random()*(B-.2)-(.5*B-.1);(w=f.getHeightAtCoordinates(I,N))<.05&&(w=.05),N+=0,(_=ObjectPool.get("BeddingParticle")).setPosition(I,w,N);var z=.75*Math.PI;_.setRotation(Math.random()*z-.5*z,Math.random()*z-.5*z,Math.random()*z-.5*z),this.pieces.push(_),_.addToScene(),_.setColor(this.color.r,this.color.g,this.color.b)}P=(e-.2)/(O=6*e);for(M=0;M<O;M++){I=.5*P+M*P-(.5*e-.1);(I+=Math.random()*P*1-.5*P)<.5*-e+.1&&(I=.5*-e+.1),.5*e-.1<I&&(I=.5*e-.1);var w,_;N=.5*-o+.1*1.5;(w=f.getHeightAtCoordinates(I,N))<.05&&(w=.05),(_=ObjectPool.get("BeddingParticle")).setPosition(I,w,N);z=.6*Math.PI;_.setRotation(Math.random()*z-.5*z,Math.random()*z-.5*z,Math.random()*z-.5*z),this.pieces.push(_),_.addToScene(),_.setColor(this.color.r,this.color.g,this.color.b)}}this.updateBodyBounds(),this.body.shapes.updateProxy(),this.originalPositions.length=0;var R=this.mesh.getVerticesData(BABYLON.VertexBuffer.PositionKind);for(M=0;M<R.length;M++)this.originalPositions[M]=R[M];for(M=this.longTermPositions.length=0;M<R.length;M++)this.longTermPositions[M]=R[M];0<this.minHeight&&this.minHeight;for(M=0;M<R.length;M+=3)this.noise[M]=R[M],this.noise[M+1]=R[M+1]-this.minHeight,this.noise[M+2]=R[M+2];t.heights&&0<t.heights.length&&(this.setSideHeights(t.heights),D.app.updateOnceNextFrame.push(this.reconnect.bind(this))),this.mesh.freezeWorldMatrix()},Bedding.prototype.reconnect=function(){this.disconnect();var t=this.width-1,e=2*t+1;z1083.resetNodeGrid(this.nodes,this.position.x,this.position.y,this.position.z-.35,t,3*.7,e,4,this.cage),this.updateNodes(),this.checkConnections()},Bedding.prototype._setMeshPosition=function(t,e,o,i){t.unfreezeWorldMatrix(),t.position.x=e,t.position.y=o,t.position.z=i,t.freezeWorldMatrix()},Bedding.prototype._translateNodes=function(t,e,o){for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i];n.x+=t,n.y+=e,n.z+=o}},Bedding.prototype._translatePieces=function(t,e,o){for(var i=0;i<this.pieces.length;i++)this.pieces[i].translate(t,e,o)},Bedding.prototype.translate=function(t,e,o){s.prototype.translate.call(this,t,e,o),this._translatePieces(t,e,o),this.nodes&&this._translateNodes(t,e,o)},Bedding.prototype.setPosition=function(t,e,o,i){void 0===i&&(i=!1);var n=t-this.position.x,s=e-this.position.y,a=o-this.position.z;if(this.position.x=t,this.position.y=e,this.position.z=o,this._translatePieces(n,s,a),this._setMeshPosition(this.mesh,t,e,o),this.nodes)if(i)this._translateNodes(n,s,a);else{this.disconnect();var r=this.width-1,c=2*r+1;z1083.resetNodeGrid(this.nodes,this.position.x,this.position.y,this.position.z-.35,r,3*.7,c,4,this.cage),this.updateNodes(),this.checkConnections()}if(this.sides&&this.sides.setPosition(t,e,o),this.sidesInner&&this.sidesInner.setPosition(t,e,o),this.body){var d=this.body.position;d.x=t,d.y=e,d.z=o;var p=this.body.shapes.position;p.x=t,p.y=e,p.z=o,this.updateBodyBounds(),this.body.shapes.updateProxy()}this.onChangeObservable.notifyObservers(this)},Bedding.prototype.refreshFloorConnections=function(){this.disconnectFloorNodes(),this.checkCageConnections()},Bedding.prototype.disconnectFloorNodes=function(){if(this.body)for(var t=this.nodes,e=t.length,o=null,i=0;i<e;i++)for(var n=(o=t[i]).connections.length,s=0;s<n;s++){var a=o.connections[s];a.data.obj2||a.data.obj==this.cage&&(a.data.obj.floorNodes.indexOf(a),o.removeConnection(a),a.removeConnection(o),n--,s--)}},Bedding.prototype.checkConnections=function(){this.checkCageConnections(),this.checkTubeConnections(),this.checkCageConnectorConnections(),this.checkBridgeConnections(),this.checkSwingConnections(),this.checkRampConnections(),this.checkPlatformConnections(),this.refreshOtherObjConnections(D.z1044.z1055|D.z1044.z1054),this.pubsub.broadcast(Bedding.NODES_UPDATED,this)},Bedding.prototype.refreshOtherObjConnections=function(t){if(this.cage)for(var e=this.cage.objs,o=0;o<e.length;o++){var i=e[o];t&i.accType&&i.refreshConnections()}},Bedding.prototype.checkRampConnections=function(){if(this.cage)for(var t=this.cage.objs,e=0;e<t.length;e++)t[e].accType==D.z1044.z1046&&t[e].checkBeddingConnections()},Bedding.prototype.checkBridgeConnections=function(){if(this.cage)for(var t=this.cage.objs,e=0;e<t.length;e++)t[e].accType==D.z1044.z1050&&t[e].checkBeddingConnections()},Bedding.prototype.checkSwingConnections=function(){if(this.cage)for(var t=this.cage.objs,e=0;e<t.length;e++)t[e].accType==D.z1044.SWING&&t[e].checkBeddingConnections()},Bedding.prototype.checkPlatformConnections=function(){if(this.cage)for(var t=this.cage.objs,e=0;e<t.length;e++)t[e].accType==D.z1044.z1049&&t[e].checkBeddingConnections()},Bedding.prototype.checkTubeConnections=function(){if(this.cage){var t=this._tempAccArray;t.length=0,D.Tube.getObjectsAt(this.position.x,this.position.y+.5*this.cage.height,this.position.z,this.width+2,this.cage.height+2,this._tempAccArray);for(var e=0;e<t.length;e++)t[e].checkConnections()}},Bedding.prototype.checkCageConnections=function(){if(this.cage){for(var t=this.nodes,e=this.cage.floorNodes,o=0;o<t.length;o++){var i=t[o],n=e[o],s=this.cage.getPlatformUnder(i.x,i.y,i.z);if(s){var a=s.getGraphNodeAt(i.x,i.y,i.z),r=Math.abs(i.y-a.y);i.addConnection(a,r),a.addConnection(i,r),s.beddingConnectedAbove=!0}else{r=Math.abs(i.y-n.y);i.addConnection(n,r),n.addConnection(i,r)}}this.pubsub.broadcast(Bedding.NODES_UPDATED)}},Bedding.prototype.checkCageConnectorConnections=function(){for(var t=this.cage.connectors,e=0;e<t.length;e++){var o=t[e];o.cage1!=this.cage&&o.cage2!=this.cage||t[e].refreshConnections()}},Bedding.prototype.updateVertex=function(t,e){var o=this.mesh.getVerticesData(BABYLON.VertexBuffer.PositionKind);t.x=o[3*e],t.y=o[3*e+1],t.z=o[3*e+2]},Bedding.prototype.updateBodyBounds=function(t){var e=this.mesh.getBoundingInfo().boundingBox,o=this.body.shapes;o.minX=e.minimumWorld.x,o.maxX=e.maximumWorld.x,o.minY=e.minimumWorld.y,o.maxY=e.maximumWorld.y,o.minZ=e.minimumWorld.z,o.maxZ=e.maximumWorld.z},Bedding.prototype._setMeshRotation=function(t,e,o,i){t.unfreezeWorldMatrix(),t.rotation.x=e,t.rotation.y=o,t.rotation.z=i,t.freezeWorldMatrix()},Bedding.prototype.setRotation=function(t,e,o){BABYLON.Quaternion.RotationYawPitchRollToRef(e,t,o,this.rotationQuaternion),this.rotation.x=t,this.rotation.y=e,this.rotation.z=o,this._setMeshRotation(this.mesh,t,e,o),this.sides&&this.sides.setRotation(t,e,o),this.sidesInner&&this.sidesInner.setRotation(t,e,o),this.body&&(this.setBodyRotationQuaternion(this.rotationQuaternion),this.updateBodyBounds(),this.body.shapes.updateProxy()),this.onChangeObservable.notifyObservers(this)},Bedding.prototype.getPreviousPositionHeightAt=function(t,e){return this.getPositionHeightAt(this.previousPositions,t,e)},Bedding.prototype.getLongTermPositionHeightAt=function(t,e){return this.getPositionHeightAt(this.longTermPositions,t,e)},Bedding.prototype.getPositionHeightAt=function(t,e,o){var i=this._tempArr,n=t;this.getIndicesInTriIndicesAtToRef(i,e,o);var s=this.position.x,a=this.position.y,r=this.position.z,c=i[0],d=n[c]+s,p=n[c+1]+a,l=n[c+2]+r,u=n[c=i[1]]+s,y=n[c+1]+a,g=n[c+2]+r,m=n[c=i[2]]+s,f=n[c+1]+a,A=n[c+2]+r,h=Bedding.z4[0],b=Bedding.z4[1],v=Bedding.z4[2],x=Bedding.z4[3],C=Bedding.z4[4];b.x=u-d,b.y=y-p,b.z=g-l,v.x=m-d,v.y=f-p,v.z=A-l,BABYLON.Vector3.CrossToRef(BABYLON.Axis.Y,v,h);var S=1/BABYLON.Vector3.Dot(b,h);C.x=e-d,C.y=a-p,C.z=o-l,BABYLON.Vector3.CrossToRef(C,b,x);var T=S*BABYLON.Vector3.Dot(v,x);return T+=this.position.y},Bedding.prototype.getHeightAt2=function(t,e){var o=this.mesh;t-=o.position.x,e-=o.position.z;var i=Math.round((t+o._maxX)*o.subdivisionsX/o._width),n=3*(Math.round(-(e+o._maxZ)*o.subdivisionsY/o._height+o.subdivisionsY)*(o._subdivisionsX+1)+i)+1;return o.getVerticesData(BABYLON.VertexBuffer.PositionKind)[n]+o.position.y},Bedding.prototype._getLongTermHeightAt=function(t,e,o){void 0===o&&(o=!1);var i=this.mesh;t-=i.position.x,e-=i.position.z;var n=Math.round((t+i._maxX)*i.subdivisionsX/i._width),s=3*(Math.round(-(e+i._maxZ)*i.subdivisionsY/i._height+i.subdivisionsY)*(i._subdivisionsX+1)+n)+1,a=this.longTermPositions[s]+i.position.y;return o&&(a-=this.noise[s]),a},Bedding.prototype.setHeightAt=function(y,g,m,f,A,t){void 0===f&&(f=0),void 0===A&&(A=!1),void 0===t&&(t=0);var b=t,v=this.mesh,x=this.sides,C=this.sidesInner,e=v.position.y;y-e<-.06&&(y=e+-.06);var S=this.mesh;g-=S.position.x,m-=S.position.z,y-=S.position.y;var T=S.subdivisionsX,B=S.subdivisionsY,O=Math.round((g+S._maxX)*S.subdivisionsX/S._width),P=Math.round(-(m+S._maxZ)*S.subdivisionsY/S._height+S.subdivisionsY),M=3*(P*(S._subdivisionsX+1)+O)+1,I=1.4142*this.subSize,N=this.originalPositions,z=this.longTermPositions,w=!1;S.updateMeshPositions(function(t){if(N=z,0<f)for(var e=Math.ceil(f/I),o=-e;o<=e;o++)for(var i=-e;i<=e;i++){var r2=P+o,c2=O+i;if(!(T<c2||c2<0||B<r2||r2<0)){var n=(O+i)*S._width/S.subdivisionsX-S._maxX,s=-(S._maxZ+S._height*(P+o-S.subdivisionsY)/S.subdivisionsY),a=n-g,r=s-m,c=a*a+r*r;if(!(f*f<c)){var d=Math.sqrt(c),p=1-Math.min(d/f,1),l=3*(r2*(S._subdivisionsX+1)+c2)+1,u=N[l]+(y-N[l])*p;(0==b||0<b&&t[l]<u||b<0&&t[l]>u)&&(t[l]=u,x&&x.updateHeightGroundSides(v,n,s,t[l]),C&&C.updateHeightGroundSides(v,n,s,t[l]),w=!0,A||(z[M]=t[M]))}}}else t[M]=y,x&&x.updateHeightGroundSides(v,g,m,y),C&&C.updateHeightGroundSides(v,g,m,y),A||(z[M]=t[M]),w=!0}),w&&(this.updatePieces(),this.dirtyHeights=!0,this.forceUpdate=!0,this.onChangeObservable.notifyObservers(this),-1==D.app.updateOnceNextFrame.indexOf(this.update)&&D.app.updateOnceNextFrame.push(this.update))},Bedding.prototype.addToMinHeight=function(r){if(r&&this.mesh){var c=this.sides,d=this.sidesInner,p=this.originalPositions,l=this.longTermPositions,u=this,y=this.subSize,g=this.mesh;g.updateMeshPositions(function(t){for(var e=t.length,o=.5*-u.depth,i=.1*y,n=1;n<e;n+=3){t[n]+=r,p[n]+=r,l[n]+=r;var s=t[n+1],a=o-s;a<i&&-i<a&&c.updateHeightGroundSides(g,t[n-1],s,t[n]),(a=o+y-s)<i&&-i<a&&d.updateHeightGroundSides(g,t[n-1],s,t[n])}}),g.updateCoordinateHeights(),u.updatePieces(),this.updateNodes(),this.mesh.refreshBoundingInfo(),this.updateBodyBounds(),this.body.shapes.updateProxy(),this.dirtyHeights=!0,this.forceUpdate=!0,this.onChangeObservable.notifyObservers(this),-1==D.app.updateOnceNextFrame.indexOf(u.update)&&D.app.updateOnceNextFrame.push(u.update)}},Bedding.prototype.updateMaxHeights=function(t){void 0===t&&(t=!1);var e=this.mesh,o=e.subdivisionsX,i=this.cage.height-1,n=this._skipChangeAltCols,s=this._maxColHeights;n.length=o+1;for(var a=0;a<=o;a++)n[a]=!1,s[a]=i;var r=e.position.x-.5*e._width,c=this.cage.objs,d=e._width/e.subdivisionsX;for(a=0;a<c.length;a++){var p=c[a];if(p.accType==D.z1044.z1054||p.accType==D.z1044.z1045||p.accType==D.z1044.z1056||p.accType==D.z1044.z1055||p.accType==D.z1044.z1049||p.accType==D.z1044.z1046||p.accType==D.z1044.z1051||p.accType==D.z1044.z1050||p.accType==D.z1044.SWING){var l=p.position.x-r,u=p.radius;p.accType==D.z1044.z1045&&(u+=.3),p.accType==D.z1044.z1054&&(u=.3),p.accType,D.z1044.z1056,p.accType==D.z1044.z1049&&(u=.5*p.width),p.accType==D.z1044.z1050&&(u=.5*p.width+.5),p.accType==D.z1044.SWING&&(u=.5*p.width+.5),p.accType==D.z1044.z1055&&(u=.3*p.width),p.accType==D.z1044.z1046&&(u=.1*p.width,p.lowNode.x<p.position.x?l-=.5:l+=.5),p.accType==D.z1044.z1051&&(u+=.3);var y=Math.round((l-u)/d),g=Math.round((l+u)/d);y<0&&(y=0),o<g&&(g=o);for(var m=y;m<=g;m++){if(p.accType==D.z1044.z1054){var f=this.cage.getPlatformAbove(p.position.x,p.position.y,p.position.z),A=2*p.radius+p.baseHeight;if(f){var b=f.position.y-(A+.1)-this.cage.position.y;s[m]>b&&(s[m]=b)}else{b=this.cage.height-2*p.radius-.3;t&&(b=p.position.y-this.cage.position.y),s[m]>b&&(s[m]=b)}}if(p.accType==D.z1044.z1045)if(n[m]=!0,f=this.cage.getPlatformAbove(p.position.x,p.position.y,p.position.z)){var v=f.position.y-(p.height+.5)-this.cage.position.y;s[m]>v&&(s[m]=v)}else{v=p.position.y-this.cage.position.y;s[m]>v&&(s[m]=v)}if(p.accType==D.z1044.z1056){n[m]=!0;var x=p.spoutPosition.y-this.cage.position.y-.5;s[m]>x&&(s[m]=x)}if(p.accType==D.z1044.SWING){n[m]=!0;var f=this.cage.getPlatformAbove(p.position.x,p.position.y+.5,p.position.z),C=p.height;if(f){var S=f.position.y-(C+.1)-this.cage.position.y;s[m]>S&&(s[m]=S)}else{S=this.cage.height-p.height-.1;t&&(S=p.position.y-this.cage.position.y),s[m]>S&&(s[m]=S)}}if(p.accType==D.z1044.z1055)if(n[m]=!0,f=this.cage.getPlatformAbove(p.position.x,p.position.y,p.position.z)){var T=f.position.y-(p.height+.1)-this.cage.position.y;s[m]>T&&(s[m]=T)}else{T=p.position.y-this.cage.position.y+.1;s[m]>T&&(s[m]=T)}if(p.accType==D.z1044.z1049){var B=p.position.y-this.cage.position.y-.5;s[m]>B&&(s[m]=B)}if(p.accType==D.z1044.z1050){var O=p.position.y-this.cage.position.y-.1;s[m]>O&&(s[m]=O)}if(p.accType==D.z1044.z1046){n[m]=!0;var P=p.position.y-.5-this.cage.position.y;s[m]>P&&(s[m]=P)}if(p.accType==D.z1044.z1051){var M=p.position.y-.5*p.boxSize-this.cage.position.y;s[m]>M&&(s[m]=M)}}}}var I=.5*d;for(m=0;m<o;m++){I<s[m+1]-s[m]&&(s[m+1]=s[m]+I),n[m]&&n[m+1]&&s[m+1]>s[m]&&(s[m+1]=s[m])}for(m=o;0<m;m--){I<s[m-1]-s[m]&&(s[m-1]=s[m]+I),n[m]&&n[m-1]&&s[m-1]>s[m]&&(s[m-1]=s[m])}},Bedding.prototype.addToHeightAtX=function(v,t){for(var x=this.sides,C=this.sidesInner,S=this.mesh,T=this._getLongTermHeightAt(t,this.position.z,!0)-S.position.y,B=t-S.position.x,O=S.subdivisionsX,P=S.subdivisionsY,M=this.longTermPositions,I=this.noise,N=this,z=!1,e=0;e<this.sideHeights.length;e++)this.previousSideHeights[e]=this.sideHeights[e];var w=S._width/S.subdivisionsX,_=this.sideHeights,R=this._maxColHeights,L=this._skipChangeAltCols;S.updateMeshPositions(function(t){var e=Math.round((B+.5*S._width)/w),o=B,i=B,n=!1;_[e]>=R[e]&&(n=!0),e<0&&(e=0),O<e&&(e=O);for(var s=e;s<=O;s++){s!=e&&L[s]&&(o+=w);var a=R[s];(m=(g=(y=s*S._width/S.subdivisionsX-S._maxX)-o)/1.75)<0&&(m*=-1),1<m&&(m=1);for(var r=.5*Math.sin(.5*Math.PI+Math.PI*m)+.5,c=_[s],d=0;d<=P;d++){var p=-(S._maxZ+S._height*(d-S.subdivisionsY)/S.subdivisionsY),l=d*(S._subdivisionsX+1)+s,u=M[f=3*l+1]-I[f]-T;if(c<a){if(!n&&0<v&&1e-4<u)continue;if(v<0&&u<-1e-4)continue}(A=Math.abs(.5*g))<u||u<-A?r=1:0<v&&a<=T?r=1:v<0&&0==T&&(r=1),(b=M[f]+v*r)<I[f]&&(b=I[f]),b>a+I[f]&&(b=a+I[f]),t[f]=b,M[f]=b,x&&x.updateHeightGroundSides(S,y,p,b)&&(N.sideHeights[s]=z1.roundToDecimalPlace(b-I[f],2)),C&&C.updateHeightGroundSides(S,y,p,t[f]),z=!0}}for(s=e-1;0<=s;s--){var y,g,m;for(L[s]&&(i-=w),a=R[s],(m=(g=(y=s*S._width/S.subdivisionsX-S._maxX)-i)/1.75)<0&&(m*=-1),1<m&&(m=1),r=.5*Math.sin(.5*Math.PI+Math.PI*m)+.5,c=_[s],d=0;d<=P;d++){var f,A,b;if(p=-(S._maxZ+S._height*(d-S.subdivisionsY)/S.subdivisionsY),l=d*(S._subdivisionsX+1)+s,u=M[f=3*l+1]-I[f]-T,c<a){if(!n&&0<v&&1e-4<u)continue;if(v<0&&u<-1e-4)continue}(A=Math.abs(.5*g))<u||u<-A?r=1:0<v&&a<=T?r=1:v<0&&0==T&&(r=1),(b=M[f]+v*r)<I[f]&&(b=I[f]),b>a+I[f]&&(b=a+I[f]),t[f]=b,M[f]=b,x&&x.updateHeightGroundSides(S,y,p,b)&&(N.sideHeights[s]=z1.roundToDecimalPlace(b-I[f],2)),C&&C.updateHeightGroundSides(S,y,p,t[f]),z=!0}}}),z&&(N.updatePieces(),this.updateMinMaxHeight(),this.mesh.refreshBoundingInfo(),this.updateBodyBounds(),this.body.shapes.updateProxy(),this.dirtyHeights=!0,this.forceUpdate=!0,this.onChangeObservable.notifyObservers(this),-1==D.app.updateOnceNextFrame.indexOf(N.update)&&D.app.updateOnceNextFrame.push(N.update))},Bedding.prototype.updateMinMaxHeight=function(){if(0<this.sideHeights.length){for(var t=999,e=0,o=0;o<this.sideHeights.length;o++){var i=this.sideHeights[o];i<t&&(t=i),e<i&&(e=i)}this.minHeight=t,this.maxHeight=e}},Object.defineProperty(Bedding.prototype,"dirtyHeights",{get:function(){return this._dirtyHeights},set:function(t){this._dirtyHeights=t},enumerable:!1,configurable:!0}),Bedding.prototype.updatePieces=function(){for(var t=this.mesh,e=0;e<this.pieces.length;e++){var o=this.pieces[e];(n=t.getHeightAtCoordinates(o.position.x,o.position.z))-t.position.y<.05&&(n=.05+t.position.y),o.position.y!=n&&o.setPosition(o.position.x,n,o.position.z)}for(e=0;e<this.food.length;e++){var i=this.food[e],n=t.getHeightAtCoordinates(i.position.x,i.position.z);i.position.y>n&&(i.isOnBeddingSurface=!0),i.isOnBeddingSurface&&i.position.y!=n&&i.setPosition(i.position.x,n,i.position.z)}},Bedding.prototype.hide=function(){this.mesh.getScene().removeMesh(this.mesh)},Bedding.prototype.enableClickThrough=function(){this.mesh.isPickable=!1,this.sides&&(this.sides.mesh.isPickable=!1),this.sidesInner&&(this.sidesInner.mesh.isPickable=!1),this.mesh.material.alpha=.7,this.sides&&(this.sides.mesh.material.alpha=.7),this.sidesInner&&(this.sidesInner.mesh.material.alpha=.7)},Bedding.prototype.disableClickThrough=function(){this.mesh.isPickable=!0,this.sides&&(this.sides.mesh.isPickable=!0),this.sidesInner&&(this.sidesInner.mesh.isPickable=!0),this.mesh.material.alpha=1,this.sides&&(this.sides.mesh.material.alpha=1),this.sidesInner&&(this.sidesInner.mesh.material.alpha=1)},Bedding.prototype.show=function(){this.mesh.getScene().addMesh(this.mesh)},Bedding.prototype.addToScene=function(){if(!this.isOnScene){this.body&&!this.body.parent&&this.world.addRigidBody(this.body),this.sides&&this.sides.addToScene(),this.sidesInner&&this.sidesInner.addToScene();for(var t=0;t<this.pieces.length;t++)this.pieces[t].addToScene();this.isOnScene=!0,this.addToActiveObjects(),this.onChangeObservable.notifyObservers(this)}},Bedding.prototype.removeFromScene=function(){if(this.isOnScene){if(this.body&&this.body.parent){this.position.y=9999,this.body.position.y=9999,this.body.shapes.updateProxy(),this.body.shapes.position.y=9999,this._setMeshPosition(this.mesh,this.position.x,9999,this.position.z),this.world.removeRigidBody(this.body)}this.sides&&this.sides.removeFromScene(),this.sidesInner&&this.sidesInner.removeFromScene();for(var t=0;t<this.pieces.length;t++)this.pieces[t].removeFromScene();if(this.hams&&0<this.hams.length&&(this.hams.length=0),0<this.food.length&&this.cage&&this.cage.isOnScene)for(;this.food.length;){var e=this.food[0];this.removeFood(e),e.setPosition(e.position.x,this.cage.floorY,e.position.z)}this.isOnScene=!1,this.removeFromActiveObjects(),this.onChangeObservable.notifyObservers(this)}},Bedding.prototype.setColor=function(t,e,o,i){if(this.color.r!=t||this.color.g!=e||this.color.b!=o){this.cage.propsNeedToBeSaved=!0,s.prototype.setColor.call(this,t,e,o);for(var n=0;n<this.pieces.length;n++)this.pieces[n].setColor(t,e,o);this.sides&&this.sides.setColor(t,e,o),this.sidesInner&&this.sidesInner.setColor(.75*t,.75*e,.75*o)}},Bedding.prototype.resetHeights=function(t){void 0===t&&(t=!1);var o=this.longTermPositions;if(t)o=this.originalPositions;else if(this.resetHeightsFrame==D.app.frameNum)return;var i=this.previousPositions;this.resetHeightsFrame=D.app.frameNum,this.mesh.updateMeshPositions(function(t){for(var e=0;e<t.length;e++)i[e]=t[e],t[e]=o[e]}),this.sides.syncWithGround(o),this.sidesInner.syncWithGround(o)},Bedding.prototype.getGraphNodeAt=function(t,e,o,i,n,s,a){void 0===i&&(i=!1),void 0===n&&(n=null),void 0===s&&(s=0),void 0===a&&(a=null);for(var r,c,d=this.nodes,p=d.length,l=Number.MAX_VALUE,u=Bedding.tempVecs[0],y=0;y<p;y++)if((r=d[y])!=a){r.deferTo&&(r=r.deferTo);var g=r.x-t,m=r.y-e,f=r.z-o,A=g*g+m*m+f*f;if(A<l){if(i&&0==r.type)continue;if(n)if(u.x=g,u.y=m,u.z=f,u.normalize(u),u.dot(n)<s)continue;l=A,c=r}}return c&&c.deferTo&&(c=c.deferTo),c},Bedding.prototype.getGraphNodesAtToRef=function(t,e,o,i,n,s,a,r,c){void 0===n&&(n=!1),void 0===s&&(s=null),void 0===a&&(a=0),void 0===r&&(r=0),void 0===c&&(c=Number.MAX_VALUE);for(var d,p=this.nodes,l=p.length,u=Bedding.tempVecs[0],y=0;y<l;y++){var g=(d=p[y]).x-e,m=d.y-o,f=d.z-i,A=g*g+m*m+f*f;if(A<c*c&&r*r<A){if(n&&0==d.type)continue;if(s)if(u.x=g,u.y=m,u.z=f,u.normalize(u),u.dot(s)<a)continue;t.push(d)}}},Bedding.prototype.updateNodes=function(){this.centerGraphNode&&(this.centerGraphNode.x=this.position.x,this.centerGraphNode.y=this.position.y,this.centerGraphNode.z=this.position.z);for(var t=0;t<this.nodes.length;t++){var e=this.nodes[t];e.y=this.getHeightAt2(e.x,e.z),e.y<this.cage.floorY+.1&&(e.y=this.cage.floorY+.1)}this.pubsub.broadcast(Bedding.NODES_UPDATED,this),D.app.builder&&D.app.builder.getSelectedz1092()!=this.cage&&D.app.builder.pubsub.broadcast(D.z1063.NODES_UPDATED,this)},Bedding.prototype.add=function(m,f,A,b,v,x,C,S){var T=this.mesh,B=this.sides,O=this.sidesInner,P=this.mesh;f-=P.position.x,A-=P.position.z;var M=this.longTermPositions,I=P.subdivisionsX,N=P.subdivisionsY,z=Math.round((f+P._maxX)*P.subdivisionsX/P._width),w=Math.round(-(A+P._maxZ)*P.subdivisionsY/P._height+P.subdivisionsY),t=.5*this.subSize*1.42;b<t&&(b=t);var _=1.4142*this.subSize,R=this.tempArr,L=R.length=0,F=Bedding.tempBabVec;return P.updateMeshPositions(function(t){for(var e=Math.ceil(b/_),o=0,i=0,n=0,s=-e;s<=e;s++)for(var a=-e;a<=e;a++){var r2=w+s;if(!(I<(c2=z+a)||c2<0||N<r2||r2<0)){var r=(z+a)*P._width/P.subdivisionsX-P._maxX,c=-(P._maxZ+P._height*(w+s-P.subdivisionsY)/P.subdivisionsY),d=r-f,p=c-A,l=d*d+p*p;if(b*b<l)R[o]=null,o++;else if(x&&l<x*x)R[o]=null,o++;else if(v&&(F.x=d,F.z=p,F.y=0,BABYLON.Vector3.Dot(F,v)<0))R[o]=null,o++;else{var u=b-Math.sqrt(l);i+=R[o]=u,n++,o++}}}o=0;for(s=-e;s<=e;s++)for(a=-e;a<=e;a++){var c2;if(r2=w+s,!(I<(c2=z+a)||c2<0||N<r2||r2<0))if(null!==R[o]){r=(z+a)*P._width/P.subdivisionsX-P._maxX,c=-(P._maxZ+P._height*(w+s-P.subdivisionsY)/P.subdivisionsY);var y=3*(r2*(P._subdivisionsX+1)+c2)+1;R[o]=R[o]/i;var g=m*(1/n);S&&(g=m*R[o]),null!=C&&t[y]+g<C&&(g=C-M[y]),t[y]=M[y]+g,L+=g,B&&B.updateHeightGroundSides(T,r,c,t[y]),O&&O.updateHeightGroundSides(T,r,c,t[y]),M[y]=t[y],o++}else o++}}),0!=L&&(this.updatePieces(),this.dirtyHeights=!0,this.forceUpdate=!0,this.onChangeObservable.notifyObservers(this),0!=D.app.updateOnceNextFrame.length&&-1!=D.app.updateOnceNextFrame.indexOf(this.update)||D.app.updateOnceNextFrame.push(this.update)),L},Bedding.prototype.getTotalHeights=function(){for(var t=this.longTermPositions,e=0,o=0;o<t.length;o++)e+=t[o];return e},Bedding.prototype.getIndicesAt=function(t,e,o,i,n,s){var a=1.4142*this.subSize,r=Math.ceil(n/a),c=this.mesh;o-=c.position.x,i-=c.position.z;for(var d=c.subdivisionsX,p=c.subdivisionsY,l=Math.round((o+c._maxX)*c.subdivisionsX/c._width),u=Math.round(-(i+c._maxZ)*c.subdivisionsY/c._height+c.subdivisionsY),y=Bedding.tempBabVec,g=0,m=-r;m<=r;m++)for(var f=-r;f<=r;f++){var r2=u+m,c2=l+f;if(!(d<c2||c2<0||p<r2||r2<0)){var A=(l+f)*c._width/c.subdivisionsX-c._maxX-o,b=-(c._maxZ+c._height*(u+m-c.subdivisionsY)/c.subdivisionsY)-i;if(!(n*n<A*A+b*b||s&&(y.x=A,y.z=b,y.y=0,BABYLON.Vector3.Dot(y,s)<0))){var v=3*(r2*(c._subdivisionsX+1)+c2)+1;t[e+g]=v,g++}}}},Bedding.prototype.getIndicesInTriIndicesAtToRef=function(t,e,o){var i=this.mesh;e-=i.position.x,o-=i.position.z;var n=i._minX+.01,s=i._maxX-.01,a=i._minZ+.01,r=i._maxZ-.01;s<e?e=s:e<n&&(e=n),r<o?o=r:o<a&&(o=a);var c=i.subdivisionsX,d=i.subdivisionsY,p=Math.floor((e+i._maxX)*i.subdivisionsX/i._width),l=Math.floor(-(o+i._maxZ)*i.subdivisionsY/i._height+i.subdivisionsY),u=0,y=(this.subSize,3*(l*(i._subdivisionsX+1)+p)),g=this.longTermPositions,m=g[y],f=g[y+2],A=Bedding.tempBabVec;A.y=0,A.x=e-m,A.z=o-f;var b=1,v=-1,x=0,C=1;0<BABYLON.Vector3.Dot(A,this.dirUpRight)&&(b=0,C=-(x=v=1));for(var S=b;0<=S&&S<=1&&u<3;S+=v)for(var T=x;0<=T&&T<=1&&u<3;T+=C){var r2=l+S,c2=p+T;if(!(c<c2||c2<0||d<r2||r2<0)){y=3*(r2*(i._subdivisionsX+1)+c2);t[u]=y,u++}}t.length<3&&t.length},Bedding.prototype.getTotalHeightsAt=function(t,e,o,i,n){for(var s=1.4142*this.subSize,a=Math.ceil(o/s),r=this.mesh,c=r.subdivisionsX,d=r.subdivisionsY,p=Math.round((t+r._maxX)*r.subdivisionsX/r._width),l=Math.round(-(e+r._maxZ)*r.subdivisionsY/r._height+r.subdivisionsY),u=this.longTermPositions,y=Bedding.tempBabVec,g=0,m=-a;m<=a;m++)for(var f=-a;f<=a;f++){var r2=l+m,c2=p+f;if(!(c<c2||c2<0||d<r2||r2<0)){var A=(p+f)*r._width/r.subdivisionsX-r._maxX-t,b=-(r._maxZ+r._height*(l+m-r.subdivisionsY)/r.subdivisionsY)-e;if(!(o*o<A*A+b*b||i&&(y.x=A,y.z=b,y.y=0,BABYLON.Vector3.Dot(y,i)<0))){var v=u[3*(r2*(r._subdivisionsX+1)+c2)+1];n&&(v-=n),g+=v}}}return g},Bedding.prototype.setHeightWithHam=function(t){var e=t.physics.frontBody.body,o=e.position.x,i=e.position.y,n=e.position.z,s=this.cage,a=this.position.y+.4,r=this.mesh.getBoundingInfo(),c=this.position.x-r.maximum.x+0,d=this.position.x+r.maximum.x-0,p=this.position.z-r.maximum.z+0,l=this.position.z+r.maximum.z-0,u=s.position.y+s.height;o<c?o=c:d<o&&(o=d),n<p?n=p:l<n&&(n=l);var y=this.getLongTermPositionHeightAt(o,n),g=t.size,m=1*g,f=2*g,A=y+g,b=A-f,v=0;i<A&&b<i?v=1-(i-b)/f:i<=b&&(v=1);var x=v;if(0!=x){var C=2*g,S=c-g,T=S+C,B=1,O=e.x;O<S&&T<O&&(B=1-(O-T)/C);var P=2*g,M=d+g,I=M-P,N=1;O<M&&I<O&&(N=1-(O-I)/P),B<x&&(x=B),N<x&&(x=N)}return u<(a=y+m*x)&&(a=u),this.setHeightAt(a,o,n,1,!0,1),x},Bedding.prototype.getChangeInHeightAtX=function(t){var e=0;if(0<this.previousSideHeights.length){var o=t-(this.position.x-.5*this.width),i=Math.floor(o/this.subSize);e=this.sideHeights[i]-this.previousSideHeights[i]}return e},Bedding.prototype.getSideHeightAtX=function(t){var e=0;if(0<this.sideHeights.length){var o=t-(this.position.x-.5*this.width),i=Math.floor(o/this.subSize);e=this.sideHeights[i]}return e},Bedding.prototype.resetSideHeights=function(){for(var t=this.mesh.subdivisionsX,e=0;e<=t;e++)this.sideHeights[e]=0;this.setSideHeights(this.sideHeights)},Bedding.prototype.setSideHeights=function(c){for(var d=this.sides,p=this.sidesInner,l=this.mesh,u=l.subdivisionsX,y=l.subdivisionsY,g=this.longTermPositions,m=this.noise,f=this,A=!1,b=this.cage.height-1,t=0;t<this.sideHeights.length;t++)this.previousSideHeights[t]=this.sideHeights[t];var v=this.originalPositions,x=this.previousPositions;l.updateMeshPositions(function(t){for(var e=0;e<=u&&e<c.length;e++)for(var o=0;o<=y;o++){var i=e*l._width/l.subdivisionsX-l._maxX,n=-(l._maxZ+l._height*(o-l.subdivisionsY)/l.subdivisionsY),s=3*(o*(l._subdivisionsX+1)+e)+1,a=c[e];b<a&&(a=b),a<0&&(a=0);var r=a+m[s];t[s]=r,g[s]=r,v[s]=r,x[s]=r,d&&d.updateHeightGroundSides(l,i,n,r)&&(f.sideHeights[e]=z1.roundToDecimalPlace(r-m[s],2)),p&&p.updateHeightGroundSides(l,i,n,t[s]),A=!0}}),A&&(this.updateMinMaxHeight(),this.dirtyHeights=!0,this.forceUpdate=!0,this._isDirty=!0,-1==D.app.updateOnceNextFrame.indexOf(f.update)&&D.app.updateOnceNextFrame.push(f.update))},Bedding.prototype.onAfterDisconnect=function(t){if(t.accType==D.z1044.z1049){var e=this.width-1,o=2*e+1;this.nodes=z1083.resetNodeGrid(this.nodes,this.position.x,this.position.y,this.position.z-.35,e,3*.7,o,4,this.cage),this.updateNodes()}},Bedding.prototype.disconnect=function(){if(this.body)for(var t=this.nodes,e=t.length,o=null,i=0;i<e;i++){for(var n=(o=t[i]).connections.length,s=0;s<n;s++){var a=o.connections[s];a.data.obj2!=this&&(o.removeConnection(a),a.removeConnection(o),n--,s--,a.data.obj2&&a.data.obj2.onAfterDisconnect&&a.data.obj2.accType==D.z1044.z1049&&(a.data.obj2.beddingConnectedAbove=!1))}o.x=9999,o.y=9999,o.z=9999}},Bedding.prototype.removeFood=function(t){var e=this.food.indexOf(t);-1!==e&&this.food.splice(e,1)},Bedding.prototype.addFood=function(t){-1==this.food.indexOf(t)&&this.food.push(t)},Bedding.prototype.recycle=function(){this.resetSideHeights(),this.setPosition(9999,9999,9999,!0),this.disconnect(),this.removeFromScene(),s.prototype.recycle.call(this)},Bedding.prototype.addToActiveObjects=function(){-1==Bedding.activeObjects.indexOf(this)&&Bedding.activeObjects.push(this)},Bedding.prototype.removeFromActiveObjects=function(){var t=Bedding.activeObjects.indexOf(this);-1!=t&&Bedding.activeObjects.splice(t,1)},Bedding.prototype.getMinHeightBetween=function(t,e){for(var o=t-this.position.x+.5*this.width,i=e-this.position.x+.5*this.width,n=this.sideHeights.length,s=this.width/(n-1),a=Math.round(o/s),r=Math.round(i/s),c=999,d=a;d<=r;d++){var h=this.sideHeights[d];h<c&&(c=h)}return c},Bedding.prototype.getAveHeightBetween=function(t,e){for(var o=t-this.position.x+.5*this.width,i=e-this.position.x+.5*this.width,n=this.sideHeights.length,s=this.width/(n-1),a=Math.round(o/s),r=Math.round(i/s),c=0,d=0,p=a;p<=r;p++){c+=this.sideHeights[p],d++}return c/d},Bedding.NODES_UPDATED=D.AppEvents.GetUniqueID(),Bedding.tempVecs=[new OIMO.Vec3,new OIMO.Vec3,new OIMO.Vec3],Bedding.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],Bedding.tempArray=[],Bedding.tempBabVec=BABYLON.Vector3.Zero(),Bedding.MatUnitSubs=2,Bedding.count=0,Bedding.activeObjects=[],Bedding}(z1068);D.Bedding=t}(z0||(z0={})),function(t){var e=function(e){function Bedding2x4(){var t=null!==e&&e.apply(this,arguments)||this;return t.width=2,t.depth=4,t}return __extends(Bedding2x4,e),Bedding2x4}(t.Bedding);t.Bedding2x4=e}(z0||(z0={})),function(t){var e=function(e){function Bedding3x4(){var t=null!==e&&e.apply(this,arguments)||this;return t.width=3,t.depth=4,t}return __extends(Bedding3x4,e),Bedding3x4}(t.Bedding);t.Bedding3x4=e}(z0||(z0={})),function(t){var e=function(e){function Bedding4x4(){var t=null!==e&&e.apply(this,arguments)||this;return t.width=4,t.depth=4,t}return __extends(Bedding4x4,e),Bedding4x4}(t.Bedding);t.Bedding4x4=e}(z0||(z0={})),function(g){var t=function(){function BeddingConfig(){this.maxObjects=20}return BeddingConfig.prototype.initObjectPool=function(t){ObjectPool.addClass("Bedding2x4",g.Bedding2x4,{world:t}),ObjectPool.addClass("Bedding3x4",g.Bedding3x4,{world:t}),ObjectPool.addClass("Bedding4x4",g.Bedding4x4,{world:t}),ObjectPool.addClass("BeddingSides",g.BeddingSides,{})},BeddingConfig.prototype.getCreateMeshFunctions=function(t){for(var e=2;e<=5;e++){var o=e+"x4";t["Bedding"+o]=this._createMeshes,t["BeddingSides"+o]=this._createMeshes,t["BeddingSidesInner"+o]=this._createMeshes}t["BeddingSidesInner"+o]=this._createMeshes},BeddingConfig.prototype._createMeshes=function(t,e,o,i,n){var s=new BABYLON.StandardMaterial("ground",t);s.diffuseTexture=n.beddingTileSet.getTexture(),s.diffuseColor=new BABYLON.Color3(.95,.95,.95),s.diffuseFresnelParameters=new BABYLON.FresnelParameters,s.diffuseFresnelParameters.bias=.01,s.diffuseFresnelParameters.power=.15,s.diffuseFresnelParameters.rightColor=BABYLON.Color3.White(),s.diffuseFresnelParameters.leftColor=new BABYLON.Color3(.5,.5,.5),s.specularColor=new BABYLON.Color3(0,0,0),s.freeze(),o.ground=s;var a=new BABYLON.CustomMaterial("groundSides",t);a.diffuseTexture=n.beddingTileSet.getTexture(),o.groundSides=a;var r=g.BeddingSides.Material=a;r.Fragment_Definitions("\n            \n                #define PI 3.14159265359\n                #define TWO_PI 6.28318530718\n\n                float shape(vec2 st, int N){\n                    st = st*2.-1.;\n                    float a = atan(st.x,st.y)+PI;\n                    float r = TWO_PI/float(N);\n                    return cos(floor(.5+a/r)*r-a)*length(st);\n                }\n\n                vec3 random3(vec3 c) {\n                    float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n                    vec3 r;\n                    r.z = fract(512.0*j);\n                    j *= .125;\n                    r.x = fract(512.0*j);\n                    j *= .125;\n                    r.y = fract(512.0*j);\n                    return r-0.5;\n                }\n\n                const float F3 =  0.3333333;\n                const float G3 =  0.1666667;\n                float snoise(vec3 p) {\n\n                    vec3 s = floor(p + dot(p, vec3(F3)));\n                    vec3 x = p - s + dot(s, vec3(G3));\n\n                    vec3 e = step(vec3(0.0), x - x.yzx);\n                    vec3 i1 = e*(1.0 - e.zxy);\n                    vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\n                    vec3 x1 = x - i1 + G3;\n                    vec3 x2 = x - i2 + 2.0*G3;\n                    vec3 x3 = x - 1.0 + 3.0*G3;\n\n                    vec4 w, d;\n\n                    w.x = dot(x, x);\n                    w.y = dot(x1, x1);\n                    w.z = dot(x2, x2);\n                    w.w = dot(x3, x3);\n\n                    w = max(0.6 - w, 0.0);\n\n                    d.x = dot(random3(s), x);\n                    d.y = dot(random3(s + i1), x1);\n                    d.z = dot(random3(s + i2), x2);\n                    d.w = dot(random3(s + 1.0), x3);\n\n                    w *= w;\n                    w *= w;\n                    d *= w;\n\n                    return dot(d, vec4(1000.0));\n                }\n\n                \n                mat2 rotate(float a){\n                    float c = cos(a); \n                    float s = sin(a);\n                    return mat2(c, -s, s, c);\n                }\n\n                float ellipse(vec3 w, vec3 o, float rx, float ry, float rz){\n                    w -= o;\n                    float dx = w.x;\n                    float dy = w.y;\n                    float dz = w.z;\n                    float d = (dx*dx)/(rx*rx);\n                    d += (dy*dy)/(ry*ry);\n                    d += (dz*dz)/(rz*rz);\n                    return d;\n                }\n\n                float makeBeddingHole(vec3 wuv, vec3 wpos, float radius){\n                    float df = ellipse(wuv, wpos, radius, radius, radius);\n                    df += snoise(wuv*15.)*.04;\n                    return df;\n                }\n            "),r.AddUniform("numHoles","float",null),r.AddUniform("h0x","float",null),r.AddUniform("h0y","float",null),r.AddUniform("h0z","float",null),r.AddUniform("h1x","float",null),r.AddUniform("h1y","float",null),r.AddUniform("h1z","float",null),r.AddUniform("h2x","float",null),r.AddUniform("h2y","float",null),r.AddUniform("h2z","float",null),r.AddUniform("h3x","float",null),r.AddUniform("h3y","float",null),r.AddUniform("h3z","float",null),r.AddUniform("h4x","float",null),r.AddUniform("h4y","float",null),r.AddUniform("h4z","float",null),r.Fragment_Custom_Diffuse("\n                int num = int(numHoles);\n                float radius = .15;\n                float df = .0;\n                if(num > 0){\n                    df = makeBeddingHole(vPositionW, vec3(h0x, h0y, h0z), radius);\n                    if(df < 1.0){\n                        discard;\n                    }\n                }\n                if(num > 1){\n                    df = makeBeddingHole(vPositionW, vec3(h1x, h1y, h1z), radius);\n                    if(df < 1.0){\n                        discard;\n                    }\n                }\n                if(num > 2){\n                    df = makeBeddingHole(vPositionW, vec3(h2x, h2y, h2z), radius);\n                    if(df < 1.0){\n                        discard;\n                    }\n                }\n                if(num > 3){\n                    df = makeBeddingHole(vPositionW, vec3(h3x, h3y, h3z), radius);\n                    if(df < 1.0){\n                        discard;\n                    }\n                }\n                if(num > 4){\n                    df = makeBeddingHole(vPositionW, vec3(h4x, h4y, h4z), radius);\n                    if(df < 1.0){\n                        discard;\n                    }\n                }\n            ");for(var c=g.Bedding.MatUnitSubs,d=2;d<=5;d++){var p=d+"x4",l={width:d,height:4,subdivisionsX:d*c,subdivisionsY:4*c},u=BABYLON.MeshBuilder.CreateGround("Bedding"+p,l,t);u.material=s,u.position.y=.3,t.removeMesh(u),e["Bedding"+p]=u;var y=z2.Graphics.MeshBuilder.createSidesForGroundMesh(u,0,!1,!0,!0,!0);t.removeMesh(y.mesh),e["BeddingSides"+p]=y.mesh,y=z2.Graphics.MeshBuilder.createSidesForGroundMesh(u,0,!1,!0,!0,!0,1),t.removeMesh(y.mesh),e["BeddingSidesInner"+p]=y.mesh}},BeddingConfig.prototype.getSPSData=function(t){for(var e=[2,3,4],o=0;o<e.length;o++){var i=e[o],n=i+"x4",s=this.maxObjects;2==i?s=g.Cage2x2Config.maxObjects+g.Cage2x3Config.maxObjects+g.Cage2x4Config.maxObjects:3==i?s=g.Cage3x2Config.maxObjects+g.Cage3x3Config.maxObjects+g.Cage3x4Config.maxObjects:4==i&&(s=g.Cage4x2Config.maxObjects+g.Cage4x3Config.maxObjects+g.Cage4x4Config.maxObjects),t.push({shapeName:"Bedding"+n,meshName:"Bedding"+n,numInstances:s,maxInstances:s,computeVertex:!0,applyMaterialToSPS:"ground",computeTextures:!0,isPickable:!0,wireframe:!1}),t.push({shapeName:"BeddingSides"+n,meshName:"BeddingSides"+n,numInstances:s,maxInstances:s,computeVertex:!0,isPickable:!0,applyMaterialToSPS:"groundSides",computeTextures:!0,wireframe:!1}),t.push({shapeName:"BeddingSidesInner"+n,meshName:"BeddingSidesInner"+n,numInstances:s,maxInstances:s,computeVertex:!0,wireframe:!1})}},BeddingConfig.prototype.getTileSetData=function(t){t.push({tileSetName:"beddingTileSet",numRows:4,numCols:4,width:1024,height:1024,tileDrawNames:["beddingSidesTexture0","beddingSidesTexture1","beddingSidesTexture2","beddingSidesTexture3","beddingTexture"]})},BeddingConfig.prototype.getTextureDrawFunctions=function(t){t.beddingTexture=function(t,e,o){t.fillStyle="rgba(255, 255, 255, 1)",t.fillRect(0,0,e,o);t.fillStyle="rgba(250, 250, 250, 0.5)";for(var i=0;i<500;i++)t.save(),t.translate(Math.random()*e,Math.random()*o),t.rotate(Math.random()*Math.PI*2),t.fillRect(0,0,10+10*Math.random(),10+10*Math.random()),t.restore()};for(var e=0;e<4;e++){t["beddingSidesTexture"+e]=function(t,e,o){t.fillStyle="rgba(200, 200, 200, .75)",t.fillRect(0,0,e,o);t.fillStyle="rgba(235, 235, 235, 0.8)";for(var i=0;i<1200;i++){t.save();var h=1*o;t.translate(Math.random()*e,.5*o+Math.random()*h-.5*h),t.rotate(Math.random()*Math.PI*2),t.fillRect(0,0,10+10*Math.random(),10+10*Math.random()),t.restore()}}}},BeddingConfig}();g.BeddingConfig=t;var e=function(){function BeddingConfig2(){}return BeddingConfig2.prototype.getz49s=function(t){t.push(g.z72),t.push(g.z67)},BeddingConfig2}();g.App.AddEntityConfig(new e)}(z0||(z0={})),function(t){var e=function(){function BeddingParticle(){BeddingParticle.count++}return Object.defineProperty(BeddingParticle.prototype,"position",{get:function(){return this.shape.position},enumerable:!1,configurable:!0}),BeddingParticle.prototype.init=function(t){this.shape||(this.shape=ObjectPool.get("BeddingParticleMesh",{name:"BeddingParticleMesh",renderingGroupID:0}),this.shape.removeFromScene());t.x,t.y,t.z,t.rx,t.ry,t.rz,t.scene;t.color&&this.shape.setColor(t.color.r,t.color.g,t.color.b)},BeddingParticle.prototype.setColor=function(t,e,o){this.shape.setColor(t,e,o)},BeddingParticle.prototype.setPosition=function(t,e,o){this.shape.setPosition(t,e,o)},BeddingParticle.prototype.setRotation=function(t,e,o){this.shape.setRotation(t,e,o)},BeddingParticle.prototype.addToScene=function(){this.shape.addToScene()},BeddingParticle.prototype.translate=function(t,e,o){this.shape.translate(t,e,o)},BeddingParticle.prototype.removeFromScene=function(){this.shape.removeFromScene()},BeddingParticle.count=0,BeddingParticle}();t.BeddingParticle=e}(z0||(z0={})),function(e){var t=function(){function BeddingParticleConfig(){this.maxObjects=2e3}return BeddingParticleConfig.prototype.initObjectPool=function(t){ObjectPool.addClass("BeddingParticle",e.BeddingParticle,{world:t}),ObjectPool.addClass("BeddingParticleMesh",z1069,{meshName:"BeddingParticle_rg0"})},BeddingParticleConfig.prototype.getCreateMeshFunctions=function(t){t.BeddingParticle_rg0=this._createMeshes},BeddingParticleConfig.prototype._createMeshes=function(t,e,o){var i=o.default0,n=e.BeddingParticle;n.position.x=0,n.position.y=0,n.position.z=0;var s=n.clone("BeddingParticle_rg0");s.makeGeometryUnique(),s.material=i,t.removeMesh(s),s.registerInstancedBuffer("color",4),s.instancedBuffers.color=new BABYLON.Color4(1,1,1,1),e.BeddingParticle_rg0=s},BeddingParticleConfig.prototype.getSPSData=function(t){},BeddingParticleConfig}();e.App.AddEntityConfig(new t)}(z0||(z0={})),function(C){var t=function(){function BeddingSideHoleManager(){this.holePositions=[],this.numHoles=0,this.maxHoles=5,this._materialBinded=!1}return BeddingSideHoleManager.prototype.bindMaterial=function(){this.sideMaterial=C.BeddingSides.Material;var i=this.sideMaterial;if(i){for(var t=[],n=this.maxHoles,e=0;e<3*n;e++)t.push(0);var s=this;i.onBindObservable.add(function(){for(var t=s.holePositions,e=s.numHoles,o=0;o<e&&o<n;o++)i.getEffect().setFloat("h"+o+"x",t[3*o]),i.getEffect().setFloat("h"+o+"y",t[3*o+1]),i.getEffect().setFloat("h"+o+"z",t[3*o+2]);i.getEffect().setFloat("numHoles",e)}),this._materialBinded=!0}},BeddingSideHoleManager.prototype.update=function(){this.numHoles=0;for(var t=C.z1062.activeObjects,e=t.length,o=0;o<e;o++){var i=t[o],n=i.currentObject;if(n){var s=n.bedding;if(s){var a=s.position.z-.5*s.depth+.8;if(!(i.physics.frontBody.body.position.z>a&&i.physics.rearBody.body.position.z>a||i.isInState(C.z146.name))){var r=i.physics.frontBody.body.position,c=i.physics.rearBody.body.position,d=i.getBeddingHeightFront(),p=i.getBeddingHeightRear(),l=0;i.physics.frontBody.testCollidesWith(C.App.PhysicsGroupBedding)||(l=.5*i.size);var u=r.y-d,y=c.y-p;if(!(l<u&&l<y)){var g=i.physics.headBody.body.position,m=r.x+.7*(g.x-r.x),f=r.y+.7*(g.y-r.y),A=r.z+.7*(g.z-r.z),b=n.position.x-.5*n.width+.2,v=n.position.x+.5*n.width-.2,x=n.position.y+.2;m<b?m=b:v<m&&(m=v),f<x&&(f=x),this.checkCreateSideHole(i,m,f,A)}}}}}},BeddingSideHoleManager.prototype.checkCreateSideHole=function(t,e,o,i){var n=t.currentObject.bedding,s=i-2*t.size,a=n.mesh.getBoundingInfo(),r=n.position.x-a.maximum.x+0,c=n.position.x+a.maximum.x-0,d=n.position.z-a.maximum.z+0,p=n.position.z+a.maximum.z-0;n.minHeight;e<r?e=r:c<e&&(e=c),i<d?i=d:p<i&&(i=p),s<d?s=d:p<s&&(s=p);var l=this.numHoles;this.holePositions[3*l]=e,this.holePositions[3*l+1]=o,this.holePositions[3*l+2]=s,this.numHoles++,this._materialBinded||this.bindMaterial()},BeddingSideHoleManager}();C.BeddingSideHoleManager=t}(z0||(z0={})),function(t){var e=function(i){function BeddingSides(){var t=null!==i&&i.apply(this,arguments)||this;return t.textureScale=new BABYLON.Vector2(1,1),t.textureName="beddingSidesTexture0",t._minInd=0,t._maxInd=0,t}return __extends(BeddingSides,i),BeddingSides.prototype.updateVertex=function(t,e){var o=this.mesh.getVerticesData(BABYLON.VertexBuffer.PositionKind);t.x=o[3*e],t.y=o[3*e+1],t.z=o[3*e+2]},BeddingSides.prototype.setPosition=function(t,e,o){i.prototype.setPosition.call(this,t,e,o),this.mesh&&(this.mesh.position.x=t-2,this.mesh.position.y=e,this.mesh.position.z=o)},BeddingSides.prototype.setRotation=function(t,e,o){i.prototype.setRotation.call(this,t,e,o),this.mesh&&(this.mesh.rotation.x=t,this.mesh.rotation.y=e,this.mesh.rotation.z=o)},BeddingSides.prototype.createMesh=function(t,e,o,i,n,s,a){if(void 0===o&&(o=!1),void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===s&&(s=!1),void 0===a&&(a=0),!this.mesh){var r=z2.Graphics.MeshBuilder.createSidesForGroundMesh(t,e,o,i,n,s,a);this.mesh=r.mesh,this.heightIndexes=r.sidesIndMap,this.groundIndexes=r.groundInd;for(var c=this.heightIndexes[0],d=c.length,p=0,l=0;l<c.length;l++){null!=c[l]&&(l<d&&(d=l),p<l&&(p=l))}this._minInd=d,this._maxInd=p,this.mesh.getScene().removeMesh(this.mesh),this.onChangeObservable.notifyObservers(this)}},BeddingSides.prototype.syncWithGround=function(t){for(var e=this.heightIndexes[0],o=this.mesh.getVerticesData(BABYLON.VertexBuffer.PositionKind),i=0,n=this._minInd;n<=this._maxInd;n++)null!=e[n]&&(o[e[n]]=t[this.groundIndexes[i]],i++);this.forceUpdate=!0,this.onChangeObservable.notifyObservers(this)},BeddingSides.prototype.updateHeightGroundSides=function(t,e,o,i){var n=this.mesh,s=this.heightIndexes,a=n.getVerticesData(BABYLON.VertexBuffer.PositionKind),r=Math.round((e+t._maxX)*t.subdivisionsX/t._width),c=Math.round(-(o+t._maxZ)*t.subdivisionsY/t._height+t.subdivisionsY)*(t._subdivisionsX+1)+r,d=s[0];if(i<1e-4&&(i=1e-4),n.uniqueId,null!=d[c]){a[d[c]]=i;var p=s[1];if(null!=p[c])a[p[c]]=i;return n.updateVerticesData(BABYLON.VertexBuffer.PositionKind,a,!1,!1),this.forceUpdate=!0,this.onChangeObservable.notifyObservers(this),!0}return!1},BeddingSides.prototype.getGraphNodeAt=function(t,e,o){var i=this.parent.cage;if(i)return i.getGraphNodeAt(t,e,o)},BeddingSides}(z1068);t.BeddingSides=e}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z761(){return null!==t&&t.apply(this,arguments)||this}return __extends(z761,t),z761.prototype.update=function(t){t.isMenuItem||t.isUnderBedding()||t.physics.addCollidesWith(e.App.PhysicsGroupBedding)},z761}(z767),t.z761=o}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z760(){return null!==t&&t.apply(this,arguments)||this}return __extends(z760,t),z760.prototype.update=function(t){t.physics.frontBody.addCollidesWith(e.App.PhysicsGroupBedding)},z760}(z767),t.z760=o}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z759(){return null!==t&&t.apply(this,arguments)||this}return __extends(z759,t),z759.prototype.update=function(t){if(!t.isMenuItem){var e=t.position,o=t.currentObject;if(!o)return;if(!(o.bedding||(o=o.parent)&&o.bedding))return;var i=o.bedding.getLongTermPositionHeightAt(e.x,e.z);0<e.y-i&&t.physics.addCollidesWith(n.App.PhysicsGroupBedding)}},z759}(z767),t.z759=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z755(){return null!==t&&t.apply(this,arguments)||this}return __extends(z755,t),z755.prototype.update=function(t){var e=t.currentObject;if(e){var o=e.bedding;o&&o.addHamForUpdate(t)}},z755}(z767),e.z755=o}(z0||(z0={})),function(a){var t,e;t=a.z156||(a.z156={}),e=function(t){function z754(){return null!==t&&t.apply(this,arguments)||this}return __extends(z754,t),z754.prototype.update=function(t){var e=t.currentObject;if(e){var o=e.bedding;if(o){var i=.9*t.size,n=t.getBeddingHeightFront();if(t.physics.frontBody.body.position.y-i<n)return o.addHamForUpdate(t),void t.physics.removeCollidesWith(a.App.PhysicsGroupBedding);var s=t.getBeddingHeightRear();return t.physics.rearBody.body.position.y-i<s?(o.addHamForUpdate(t),void t.physics.removeCollidesWith(a.App.PhysicsGroupBedding)):void 0}}},z754}(z767),t.z754=e}(z0||(z0={})),function(i){var t,e;t=i.z156||(i.z156={}),e=function(t){function z743(){return null!==t&&t.apply(this,arguments)||this}return __extends(z743,t),z743.prototype.update=function(t){if(!t.isMenuItem){var e=t.currentObject;if(!e)return;if(!e.bedding)return;var o=t.getBeddingHeightFront();if(t.physics.frontBody.body.position.y>o)return;t.physics.rearBody.testCollidesWith(i.App.PhysicsGroupBedding)||e.bedding.addHamForUpdate(t)}},z743}(z767),t.z743=e}(z0||(z0={})),function(d){var t,e;t=d.z156||(d.z156={}),e=function(t){function z727(){return null!==t&&t.apply(this,arguments)||this}return __extends(z727,t),z727.prototype.update=function(t){if(!t.isInState(d.z72.name)&&!t.isInState(d.z67.name)){var e=t.currentObject;if(e&&e.bedding){var o=t.targets.moveToTarget,i=e.bedding.getHeightAt(o.x,o.z);if(!(o.y-i<-.1)){var n=t.physics.rearBody.body.position;if(e.isInside(n.x,n.y,n.z)){var s=t.physics.middleBody.body,a=s.linearVelocity,r=.5*(t.getBeddingHeightRear()+t.getBeddingHeightFront()),c=(s.position.y,z767.tempVecs[0]);c.y=.5,c.x=0,c.z=0,a.addEqual(c)}}}}},z727}(z767),t.z727=e}(z0||(z0={})),function(m){var t,e;t=m.z156||(m.z156={}),e=function(t){function z664(){return null!==t&&t.apply(this,arguments)||this}return __extends(z664,t),z664.prototype.update=function(t){var e=t.physics,o=e.headBody,i=e.frontBody,n=e.middleBody,s=e.rearBody,a=t.currentObject;if(a){var r=a.bedding;if(r){var c=r.getHeightAt(n.body.position.x,n.body.position.z),d=0,p=m.App.PhysicsGroupBedding,l=.5*t.size,u=a.left,y=a.right;if(!o.testCollidesWith(p)){var g=o.body.position;d=Math.abs(g.y-c),g.x<y&&g.x>u&&d<l&&o.addCollidesWith(p)}if(!i.testCollidesWith(p)){g=i.body.position;d=Math.abs(g.y-c),g.x<y&&g.x>u&&d<l&&(i.addCollidesWith(p),o.addCollidesWith(p))}if(!n.testCollidesWith(p)){g=n.body.position;d=Math.abs(g.y-c),g.x<y&&g.x>u&&d<l&&n.addCollidesWith(p)}if(!s.testCollidesWith(p)){g=s.body.position;d=Math.abs(g.y-c),g.x<y&&g.x>u&&d<l&&s.addCollidesWith(p)}s.body.position.y<t.currentObject.position.y&&t.forceTouchGround()}}},z664}(z767),t.z664=e}(z0||(z0={})),function(O){var t,e;t=O.z156||(O.z156={}),e=function(t){function z647(){return null!==t&&t.apply(this,arguments)||this}return __extends(z647,t),z647.prototype.update=function(t){if(t.isTouchingGround()&&((m=t.currentObject)&&m.bedding)){var e=t.getBeddingHeightFront(),o=t.getBeddingHeightRear(),i=t.physics.frontBody.body.position,n=t.physics.rearBody.body.position,s=t.size;if(!(i.y-s>e&&n.y-s>o)){var a,r=t.physics,c=r.headBody,d=r.frontBody,p=r.middleBody,l=r.rearBody,u=t.pathIndex;for(t.path[u]&&t.path[u].data&&t.path[u].data.tube&&(a=t.path[u].data.tube);!a;){if(++u>=t.path.length)return;a=t.path[u].data.tube}if((m=t.currentObject).parent&&(m=m.parent),m.bedding){var y=m.bedding,g=t.path[u];if(!(y.getHeightAt(g.x,g.z)<g.y-.5)){var m,f=t.path[u],A=3*t.size+0,b=A*A,v=O.App.PhysicsGroupBedding;if(c.testCollidesWith(v)&&this.getDistSqTo(f,c.body.position)<b&&c.removeCollidesWith(v),b=(A=2*t.size+0)*A,d.testCollidesWith(v)&&this.getDistSqTo(f,d.body.position)<b&&d.removeCollidesWith(v),p.testCollidesWith(v)&&this.getDistSqTo(f,p.body.position)<b&&p.removeCollidesWith(v),l.testCollidesWith(v)&&this.getDistSqTo(f,l.body.position)<b&&l.removeCollidesWith(v),y=(m=t.currentObject).bedding){var x=t.physics.rearBody,C=t.physics.frontBody,S=t.physics.middleBody;if(x.testCollidesWith(v)||S.testCollidesWith(v)||C.testCollidesWith(v)){var T=t.physics.frontBody.body.position,B=z767.z4[0];B.x=T.x-f.x,B.y=T.y-f.y,B.z=T.z-f.z,B.normalize(),.707<BABYLON.Vector3.Dot(B,BABYLON.Axis.Y)&&(t.physics.removeCollidesWith(v),m.bedding.addHamForUpdate(t))}}}}}}},z647.prototype.getDistSqTo=function(t,e){var o=t.x-e.x,i=(t.y,e.y,t.z-e.z);return o*o+0+i*i},z647}(z767),t.z647=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z574(){var t=e.call(this)||this;return t.speed=.01,t}return __extends(z574,e),z574.prototype.update=function(t){},z574}(z767),e.z574=o}(z0||(z0={})),function(P){var t,e;t=P.z156||(P.z156={}),e=function(e){function z573(){var t=e.call(this)||this;return t.speed=.01,t.tvec1=BABYLON.Vector3.Zero(),t.totalHeights=0,t}return __extends(z573,e),z573.prototype.update=function(t){this.testMesh2||(this.testMesh2=P.app.graphicsHelper.addTestBox(.1,0,0,0));var e=t.currentObject;if(e){var o=P.app.world.timeStep,i=e.bedding,n=.3,s=t.physics.frontBody.body,a=s.rotation.elements[2],r=s.rotation.elements[8],c=s.position.x,d=s.position.z,p=.01*t.walkForce,l=i.position.x+.5*i.width-.3,u=i.position.x-.5*i.width+.3,y=i.position.z-.5*i.depth+.3,g=i.position.z+.5*i.depth-.3;c<u&&(c=u),l<c&&(c=l),d<y&&(d=y),g<d&&(d=g);var m=-p*o*120,f=i.add(m,c,d,.3),A=.3+1.1*n,b=a*A+c,v=r*A+d,x=i.position.x+.5*i.width-n,C=i.position.x-.5*i.width+n,S=i.position.z-.5*i.depth+n,T=i.position.z+.5*i.depth-n;x<b&&(b=x),v<S&&(v=S),b<C&&(b=C),T<v&&(v=T);var B=i.getHeightAt(b,v);n<1.1*B&&(n=1.1*B);var O=i.add(-f,b,v,n);Math.abs(-f-O),this.testMesh2.position.x=b,this.testMesh2.position.z=v,this.testMesh2.position.y=e.floorY+.1}},z573}(z767),t.z573=e}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z526(){return null!==t&&t.apply(this,arguments)||this}return __extends(z526,t),z526.prototype.update=function(t){t.physics.removeCollidesWith(e.App.PhysicsGroupBedding)},z526}(z767),t.z526=o}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z525(){return null!==t&&t.apply(this,arguments)||this}return __extends(z525,t),z525.prototype.update=function(t){t.physics.frontBody.removeCollidesWith(e.App.PhysicsGroupBedding)},z525}(z767),t.z525=o}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z523(){return null!==t&&t.apply(this,arguments)||this}return __extends(z523,t),z523.prototype.update=function(t){t.physics.headBody.removeCollidesWith(e.App.PhysicsGroupBedding)},z523}(z767),t.z523=o}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z522(){return null!==t&&t.apply(this,arguments)||this}return __extends(z522,t),z522.prototype.update=function(t){t.physics.middleBody.removeCollidesWith(e.App.PhysicsGroupBedding)},z522}(z767),t.z522=o}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z521(){return null!==t&&t.apply(this,arguments)||this}return __extends(z521,t),z521.prototype.update=function(t){t.physics.rearBody.removeCollidesWith(e.App.PhysicsGroupBedding)},z521}(z767),t.z521=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z514(){return null!==t&&t.apply(this,arguments)||this}return __extends(z514,t),z514.prototype.update=function(t){var e=t.currentObject;if(e){var o=e.bedding;if(!o)if(e.parent&&e.parent.bedding)o=e.parent.bedding;else{if(!t.rearObject||!t.rearObject.bedding)return;o=t.rearObject.bedding}o.removeHamFromUpdate(t)}},z514}(z767),e.z514=o}(z0||(z0={})),function(u){var t,e;t=u.z156||(u.z156={}),e=function(t){function z513(){return null!==t&&t.apply(this,arguments)||this}return __extends(z513,t),z513.prototype.update=function(t){var e=t.currentObject;if(e){var o=e.bedding;if(!o)if(e.parent&&e.parent.bedding)o=e.parent.bedding;else{if(!t.rearObject||!t.rearObject.bedding)return;o=t.rearObject.bedding}if(t.isInState(u.z21.name)){if(u.app.frameNum-t.frameNumAddedToBedding<30)return}else if(t.isInState(u.z126.name)&&u.app.frameNum-t.frameNumAddedToBedding<30)return;if(!t.isInState(u.z72.name)){var i=t.physics.frontBody.body.position,n=t.physics.rearBody.body.position,s=.5*t.size,a=e.position.x-.5*e.width,r=e.position.x+.5*e.width;if(!(n.x>r-s||n.x<a+s)){var c=t.getBeddingHeightFront(),d=t.getBeddingHeightRear(),p=!1,l=!1;c<i.y-s&&(p=!0),d<n.y-s&&(l=!0),p&&l&&(o.removeHamFromUpdate(t),t.physics.addCollidesWith(u.App.PhysicsGroupBedding))}}}},z513}(z767),t.z513=e}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(e){function z458(){var t=e.call(this)||this;o.app.graphicsHelper;return t}return __extends(z458,e),z458.prototype.update=function(t){if(t.isTouchingGround()){var e=t.targets,o=e.upVecTarget,i=o.x,n=o.y,s=o.z,a=t.physics.frontBody.body.position,r=t.physics.rearBody.body.position;a.y,r.y;t.size,t.size;var c,d=t.physics.middleBody.body,p=z767.tempVecs[0],l=z767.tempVecs[1],u=z767.tempVecs[2],y=t.physics.middleBody.rotationElements,g=d.angularVelocity;if(p.x=y[2],p.y=y[5],p.z=y[8],l.x=0,l.y=1,l.z=0,!(t.walkForce<.01)){var m=z1.Dot(p,l);if(!(.75<m||m<-.75)){var f,A,b;null!=i&&(l.x=i,l.y=n,l.z=s),u.cross(l,p),c=y,f=u.x,A=u.y,b=u.z;var v=f*c[0]+A*c[3]+b*c[6],x=f*c[1]+A*c[4]+b*c[7];c[2],c[5],c[8];e.rollAngToUp=Math.atan2(x,v);var C=e.rollAngToUp,S=t.speed,T=.01*Math.PI,B=T+(.1*Math.PI-T)*S;B<C?C=B:C<-B&&(C=-B),p.scaleEqual(62*C),l.sub(p,g);var O;(O=50*t.size)*O<l.dot(l)&&(l.normalize(l),l.scaleEqual(O)),g.addEqual(l)}}}},z458}(z767),t.z458=e}(z0||(z0={})),function(a){var t,e;t=a.z156||(a.z156={}),e=function(t){function z443(){return null!==t&&t.apply(this,arguments)||this}return __extends(z443,t),z443.prototype.update=function(){for(var t=a.z1062.activeObjects,e=t.length,o=0;o<e;o++){var i=t[o],n=i.currentObject;if(!n)return;var s=n.bedding;if(!s){if(!i.rearObject||!i.rearObject.bedding)return;s=i.rearObject.bedding}a.app.updateOnceNextFrame.push(s.bindedResetHeights),s.setHeightWithHam(i)}},z443}(z767),t.z443=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z365(){return t.call(this)||this}return __extends(z365,t),z365.prototype.update=function(t){var e=t.size,o=t.focusDist,i=z767.tempVecs[0],n=z767.tempVecs[1],s=t.physics,a=s.frontBody,r=t.speed,c=t.bones.head,d=t.targets,p=d.moveToTarget,l=d.dirTarget;n.copy(p);var u=s.headBody.body.position,y=s.frontBody.body.position;n.subEqual(u);var g=n.x*n.x+n.y*n.y+n.z*n.z,m=t.mesh.getWorldMatrix(),f=t.bones.hip.bone.getAbsoluteTransform(),A=z767.tempBabMats[0];A.copyFrom(f),A.multiplyToRef(m,A),A.invertToRef(A);var b=z767.z4[0],v=z767.z4[1],x=z767.z4[2];b.x=y.x,b.y=y.y,b.z=y.z,v.x=p.x,v.y=p.y,v.z=p.z,v.subtractToRef(b,x),BABYLON.Vector3.TransformNormalToRef(x,A,x);var C=!1;x.x<0&&(C=!0);var S=a.rotationElements,T=z1.getAngDiff(c.yawTar,c.yaw);i.x=l.x,i.y=l.y,i.z=l.z,i.x+=S[2],i.y+=S[5],i.z+=S[8],i.normalize(i);var B=!1,O=.4*Math.PI;T<O&&-O<T&&(B=!0);var P=o+t.focusRange,M=!1;C&&!B||P*P<g&&(M=!0);var I=0;if(M){I=13*e,g<.5*P*P*.5&&(I=6.4*e);var N=3.2*e;I=N+(I-N)*r,i.x*=I,i.y*=I,i.z*=I,S=a.rotationElements;var z=(Y=a.body.linearVelocity).x,w=Y.y,_=Y.z,R=z*S[0]+w*S[3]+_*S[6],L=z*S[1]+w*S[4]+_*S[7],F=z*S[2]+w*S[5]+_*S[8],D=i.x,E=i.y,k=i.z,j=D*S[0]+E*S[3]+k*S[6],V=D*S[1]+E*S[4]+k*S[7],G=D*S[2]+E*S[5]+k*S[8];j=.5*(j-R)*t.adjustLerp,V=.5*(V-L)*t.adjustLerp,G=.5*(G-F)*t.adjustLerp,s.localWalkForce.x=j,s.localWalkForce.y=V,s.localWalkForce.z=G,i.x=j*S[0]+V*S[1]+G*S[2],i.y=j*S[3]+V*S[4]+G*S[5],i.z=j*S[6]+V*S[7]+G*S[8];var W=70*t.size;W*W<i.dot(i)&&(i.normalize(i),i.scaleEqual(W)),Y.addEqual(i),t.walkForce=I}else{var Y=a.body.linearVelocity;i.x=1*-Y.x,i.y=1*-Y.y,i.z=1*-Y.z,s.localWalkForce.x=i.x,s.localWalkForce.y=i.y,s.localWalkForce.z=i.z,Y.addEqual(i)}if(M||(t.walkForce=0),this.pubsub){var U=z767.tempVecs[3];M&&(U.x=y.x,U.y=y.y,U.z=y.z),i.normalize(i),this.pubsub.broadcast(t.id,t,U,i,t.walkForce)}},z365}(z767),e.z365=o}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z240(){return null!==t&&t.apply(this,arguments)||this}return __extends(z240,t),z240.prototype.update=function(t){t.path[t.pathIndex]&&t.currentObject&&t.currentObject.accType==e.z1044.z1048&&(t.targets.pathTarget.copyFrom(t.path[t.pathIndex]),t.targets.pathTarget.y<t.currentObject.bottom&&(t.targets.pathTarget.y=t.currentObject.bottom),t.targets.setTargetsToPathTarget())},z240}(z767),t.z240=o}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(e){function z180(){var t=e.call(this)||this;return t.holeManager=new o.BeddingSideHoleManager,t}return __extends(z180,e),z180.prototype.update=function(t){this.holeManager.update()},z180}(z767),t.z180=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1031(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1031,t),z1031.prototype.test=function(t){var e=t.path[t.pathIndex],o=t.path[t.pathIndex+1],i=t.currentObject.bedding;if(null==e)return!1;if(!i)return!1;var n=i.minHeight+i.position.y;return null==o?e.y>n:e.y>n&&o.y>n},z1031}(z770),e.z1031=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1025(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1025,t),z1025.prototype.test=function(t){if(t.isTouchingGround()){var e=t.targets.pathTarget;t.avoidingObject&&(e=t.targets.avoidTarget);var o=t.currentObject,i=t.physics.frontBody.body.position,n=i.x-e.x,s=i.z-e.z;if(1.44<n*n+s*s)return!1;if(o.isInBox(e.x,e.y,e.z,.01)){var a=o.bedding;if(a){var r=a.getLongTermPositionHeightAt(e.x,e.z);if(e.y-r<.5*-t.size)return!0}}return!1}},z1025}(z770),e.z1025=o}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z932(){return null!==t&&t.apply(this,arguments)||this}return __extends(z932,t),z932.prototype.test=function(t){if(0<(t.physics.frontBody.touchingAccTypes&o.z1044.z1047))return!0;if(!t.cage)return!1;if(t.cage.bedding){var e=t.physics.frontBody.body.position;if(t.getBeddingHeightFront()-e.y>.5*-t.size)return!0}return!1},z932}(z770),t.z932=e}(z0||(z0={})),function(c){var t,e;t=c.z768||(c.z768={}),e=function(t){function z931(){return null!==t&&t.apply(this,arguments)||this}return __extends(z931,t),z931.prototype.test=function(t){var e=t.currentObject;if(e&&(!t.usingObject||t.usingObject.accType!=c.z1044.CONNECTOR_z1048)){var o=e.bedding;if(!o)if(e.parent&&e.parent.bedding)o=e.parent.bedding;else{if(!t.rearObject||!t.rearObject.bedding)return;o=t.rearObject.bedding}var i=t.physics.frontBody.body.position,n=t.physics.rearBody.body.position;if(i.y>o.minHeight&&n.y>o.minHeight){var s=.5*t.size,a=t.getBeddingHeightFront(),r=t.getBeddingHeightRear();if(a<i.y-s&&r<n.y-s)return!0}}},z931}(z770),t.z931=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(e){function z929(){var t=null!==e&&e.apply(this,arguments)||this;return t.bodyIndex=0,t}return __extends(z929,e),z929.prototype.test=function(t){var e=t.currentObject;if(e){var o=e.bedding;if(o){var i=t.physics.bodies[this.bodyIndex].body.position,n=o.getHeightAt(i.x,i.z,!0);return i.y>n+t.size}return!0}},z929}(z770),e.z929=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z874(){return null!==t&&t.apply(this,arguments)||this}return __extends(z874,t),z874.prototype.test=function(t){var e=t.cage;if(!e)return!1;var o=e.bedding;if(o){var i=t.targets.pathTarget;if(o.getHeightAt(i.x,i.z)-i.y>t.size)return!0}return!1},z874}(z770),e.z874=o}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z847(){return null!==t&&t.apply(this,arguments)||this}return __extends(z847,t),z847.prototype.test=function(t){return 0<(t.physics.touchingAccTypes&e.z1044.z1047)},z847}(z770),t.z847=o}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z845(){return null!==t&&t.apply(this,arguments)||this}return __extends(z845,t),z845.prototype.test=function(t){return 0<(t.physics.touchingAccTypes&e.z1044.z1049)},z845}(z770),t.z845=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z843(){return null!==t&&t.apply(this,arguments)||this}return __extends(z843,t),z843.prototype.test=function(t){var e=t.currentObject,o=t.physics.frontBody.body.position;if(!e)return!1;if(e.bedding&&t.getBeddingHeightFront()-o.y>t.size)return!0;return!1},z843}(z770),e.z843=o}(z0||(z0={})),function(o){var t=function(e){function z72(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.enterz156=[o.z156.z526,o.z156.z547,o.z156.z755,o.z156.z407,o.z156.z320],t.updatez156=[o.z156.z755,o.z156.z526,o.z156.z165,o.z156.z716,o.z156.z235,o.z156.z718,o.z156.z458,o.z156.z446,o.z156.z590,o.z156.z214,o.z156.z362,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z442],t.states=[o.z71,o.z70,o.z64],t.exitz156=[o.z156.z546],t.transitions=[{condition:o.z768.z876,trueNode:{condition:o.z768.z883,falseNode:{state:o.z66,actions:[o.z156.z314]}}},{condition:o.z768.z962,trueNode:{state:o.z21,actions:[]}},{condition:o.z768.z928,falseNode:{state:o.z141}},{condition:o.z768.z929,trueNode:{state:o.z66,actions:[]}}],t.initialState=o.z71,t}return __extends(z72,e),z72}(z49);o.z72=t}(z0||(z0={})),function(o){var t=function(e){function z71(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z342],t.updatez156=[o.z156.z599,o.z156.z550,o.z156.z738,o.z156.z746,o.z156.z749],t.transitions=[{condition:o.z768.z824,trueNode:{state:o.z70}},{condition:o.z768.z997,trueNode:{state:o.z64}},{condition:o.z768.z849,falseNode:{condition:o.z768.z937,trueNode:{state:o.z64}}}],t.exitz156=[o.z156.z489],t}return __extends(z71,e),z71}(z49);o.z71=t}(z0||(z0={})),function(o){var t=function(e){function z70(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z344,o.z156.z488],t.updatez156=[o.z156.z599,o.z156.z549,o.z156.z737,o.z156.z745,o.z156.z748],t.transitions=[{condition:o.z768.z824,trueNode:{state:o.z71}},{condition:o.z768.z997,trueNode:{state:o.z64}},{condition:o.z768.z849,falseNode:{condition:o.z768.z937,trueNode:{state:o.z64}}}],t.exitz156=[o.z156.z489],t}return __extends(z70,e),z70}(z49);o.z70=t}(z0||(z0={})),function(o){var t=function(e){function z67(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="move",t.enterz156=[o.z156.z526,o.z156.z547,o.z156.z755,o.z156.z407,o.z156.z320,o.z156.z340],t.updatez156=[o.z156.z755,o.z156.z240,o.z156.z526,o.z156.z461,o.z156.z446,o.z156.z590,o.z156.z214,o.z156.z362,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z442],t.states=[o.z71,o.z70],t.exitz156=[o.z156.z546],t.transitions=[{condition:o.z768.z929,trueNode:{state:o.z66,actions:[]}},{condition:o.z768.z843,trueNode:{state:o.z72,actions:[]},falseNode:{condition:o.z768.z822,trueNode:{state:o.z66,actions:[o.z156.z514]}}}],t.initialState=o.z71,t}return __extends(z67,e),z67}(z49);o.z67=t}(z0||(z0={})),function(o){var t=function(e){function z64(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z516,o.z156.z407],t.updatez156=[o.z156.z365],t.transitions=[{condition:o.z768.z849,trueNode:{condition:o.z768.z997,falseNode:{state:o.z71}}},{condition:o.z768.z864,falseNode:{condition:o.z768.z937,falseNode:{state:o.z71}}}],t.exitz156=[o.z156.z489,o.z156.z466,o.z156.z757],t}return __extends(z64,e),z64}(z49);o.z64=t}(z0||(z0={})),function(t){var e=function(e){function z59(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[],t.updatez156=[],t.states=[],t.exitz156=[],t}return __extends(z59,e),z59}(z49);t.z59=e}(z0||(z0={})),function(o){var t=function(e){function z58(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z523,o.z156.z525],t.updatez156=[o.z156.z573],t.states=[],t.exitz156=[],t}return __extends(z58,e),z58}(z49);o.z58=t}(z0||(z0={})),function(t){var e=function(){function FoodTracker(){this.trackFoodGrid={},this.trackedFood={},this.pubsub=new Pubsub}return FoodTracker.prototype.isFoodInGridArea=function(t,e,o){var i=z1.round(t,1)+1+"_"+(z1.round(e,1)+1);if(this.trackFoodGrid[i]<0&&this.trackFoodGrid[i],!o)return this.trackFoodGrid[i];for(var n=this.trackedFood[i],s=0;n&&n.bed==o&&(n=n.nextFood,!(1e4<++s)););return n&&n.bed!=o?this.trackFoodGrid[i]:void 0},FoodTracker.prototype.add=function(t){if(t.isOnScene&&!t._isTracked){var e=t.position.x,o=t.position.y,i=z1.round(e,1)+1+"_"+(z1.round(o,1)+1);if(t._trackerKey=i,null==this.trackFoodGrid[i]&&(this.trackFoodGrid[i]=0),this.trackedFood[i]){if(this.trackedFood[i]==t)return void this.trackedFood[i];(this.trackedFood[i].prevFood=t).nextFood=this.trackedFood[i]}(this.trackedFood[i]=t)._isTracked=!0,this.trackFoodGrid[i]++,this.pubsub.broadcast(FoodTracker.FOOD_ADDED,t)}},FoodTracker.prototype.remove=function(t){if(t._isTracked){var e=t.position.x,o=t.position.y,i=(z1.round(e,1),z1.round(o,1));i=t._trackerKey,null==this.trackFoodGrid[i]&&(this.trackFoodGrid[i]=0),t.prevFood&&t.nextFood?(t.prevFood.nextFood=t.nextFood,t.nextFood.prevFood=t.prevFood):t.nextFood?(this.trackedFood[i]=t.nextFood,t.nextFood.prevFood=null):t.prevFood&&(t.prevFood.nextFood=null),this.trackedFood[i]==t&&(this.trackedFood[i]=t.nextFood),t.prevFood=null,t.nextFood=null,this.trackFoodGrid[i]--,t._isTracked=!1,this.pubsub.broadcast(FoodTracker.FOOD_REMOVED,t)}},FoodTracker.FOOD_ADDED=1,FoodTracker.FOOD_REMOVED=2,FoodTracker}();t.FoodTracker=e}(z0||(z0={})),function(S){var t=function(p){function Food(){var t=p.call(this)||this;return t.pouchSide=0,t.unpouching=!1,t.initAmount=1e3,t._amount=100,t.type=0,t.isOnBeddingSurface=!1,t._isOnGround=!1,t._meshToRadiusDistZ=.03,t._isTracked=!1,t.dragPlaneZ=-1.8,t.pubsub=new Pubsub,t.biteLocal=BABYLON.Vector3.Zero(),t.biteWorld=BABYLON.Vector3.Zero(),t.biteRadius=.05,t.radiusX=.05,t.radiusY=.05,t._lastRotateFrame=0,t._body=null,t._unpouchedFrameNum=0,t.isDragging=!1,t.stayInsideBody=null,t}return __extends(Food,p),Object.defineProperty(Food.prototype,"cage",{get:function(){return this._cage},set:function(t){!t&&this._cage,this._cage=t},enumerable:!1,configurable:!0}),Object.defineProperty(Food.prototype,"isOnGround",{get:function(){return this._isOnGround},set:function(t){t&&Food.Tracker.add(this),this._isOnGround=t},enumerable:!1,configurable:!0}),Object.defineProperty(Food.prototype,"dynamicBody",{get:function(){return this.body},enumerable:!1,configurable:!0}),Object.defineProperty(Food.prototype,"amount",{get:function(){return this._amount},set:function(t){this._amount=t},enumerable:!1,configurable:!0}),Food.prototype.init=function(t){var x=this;p.prototype.init.call(this,t),this.amount=this.initAmount,t.radiusX?this.radiusX=t.radiusX:this.radiusX,t.radiusY&&(this.radiusY=t.radiusY),this.owner=null,this.cage=null,t.color&&this.color.copyFrom(t.color);var e=t.x||0,o=t.y||0,i=t.z||0,n=t.rx||0,s=t.ry||0,a=t.rz||0;if(!t.isMenuItem){if(this.update=this._update,BABYLON.Quaternion.RotationYawPitchRollToRef(s,n,a,this.rotationQuaternion),!this._body){this.world=t.world;this.radius=.05;var r=[1,.1,.5,S.App.z1037,S.App.PhysicsGroupBedding|S.App.z1035|S.App.z1036|S.App.z1037Mound|S.App.z1034],c=new OIMO.Body({type:"sphere",size:[.05,.05,.05],pos:[e,o,i],rot:[180*n/Math.PI,180*s/Math.PI,180*a/Math.PI],move:!0,world:this.world,name:"food_"+this.getName(),config:r});this.body=c.body,this._body=this.body;var C=this,d=function(t,e,o,i,n,s,a,r,c){if(C.body&&(r.actor,!(r.actor&&r.actor!=x||c&&c.actor&&c.actor!=x||S.app.frameNum-C._unpouchedFrameNum<30))){var d=C.bowl;if(C.bowl=null,r.type==OIMO.SHAPE_GROUND){var p=.9;r.entity.accType==S.z1044.z1047&&(p=.5),r.entity.bowl&&(C.bowl=r.entity.bowl),C.body.linearVelocity.x*=p,C.body.linearVelocity.y*=p,C.body.linearVelocity.z*=p,C.body.angularVelocity.x*=p,C.body.angularVelocity.y*=p,C.body.angularVelocity.z*=p}if(r.type==OIMO.SHAPE_z1045){p=.9;var l=r.position.x-C.body.position.x,u=r.position.z-C.body.position.z,y=C.body.position.y+C.radius,g=r.position.y+r.halfHeight,m=l*l+u*u,f=r.radius-C.radius;m<f*f&&y<g&&(C.body.linearVelocity.x*=p,C.body.linearVelocity.y*=p,C.body.linearVelocity.z*=p,C.body.angularVelocity.x*=p,C.body.angularVelocity.y*=p,C.body.angularVelocity.z*=p),m<f*f&&(C.bowl=r.entity)}var A=!1,b=10;if(.1<n&&(A=!0),r.type==OIMO.SHAPE_z1045&&(b=1,C.bowl||(A=!1)),d&&!C.bowl&&-1!=d.foodMound.food.indexOf(C)&&d.removeFood(C),A){var v=!1;(r.type==OIMO.SHAPE_HOLEY_BOX||OIMO.SHAPE_z1045)&&(v=!0),C.onGroundHit(e,v,.07,r,i,n,s,b)}}};(this.body.shapes.actor=this).body.shapes.hitListeners=[],this.body.shapes.hitListeners.push(d),this.body.shapes.pubsub=this.pubsub,this.pubsub.subscribe("hit",d)}this.disablePhysics()}!1===t.skipAddToScene&&(this.isDragging=!0,this.setPositionDrag(e,o,i,!0))},Food.prototype.isValidDropLocation=function(t,e,o){return!!S.Cage.getCageAt(t,e,o)},Food.prototype.onGroundHit=function(t,e,o,i,n,s,a,r){void 0===e&&(e=!1),void 0===o&&(o=.07),void 0===i&&(i=null),void 0===r&&(r=10);var c=this,d=!1;c.body.linearVelocity.y*c.body.linearVelocity.y<o*o&&(d=!0);c._body.position.y;c.radius;var p=S.app.frameNum;if(e&&(p>c._lastRotateFrame+r||d)){var l=Food.tempVecs[0],u=Food.tempVecs[1],y=Food.tempVecs[2],g=c.body.rotation.elements;u.x=n,u.y=s,u.z=a,l.x=g[2],l.y=g[5],l.z=g[8],y.cross(l,u);var m=l.dot(u),f=Math.acos(m),A=Food.tempQuats[0];A.setFromAxisAngle(y,f),c.body.orientation.mul(A,c.body.orientation),c._lastRotateFrame=p}if(c.isOnGround=d,c.cage&&d&&i&&i.type==OIMO.SHAPE_GROUND&&c.cage.bedding){c.platform&&(c.platform.removeFood(c),c.platform=null);var b=c.cage.getObjectAt(c.position.x,c.position.y,c.position.z,S.z1044.z1045);if(b)return void(c.bowl=b);c.isOnBeddingSurface=!0,c.cage.bedding.addFood(c)}},Food.prototype.disablePhysics=function(){if(this.body){this._body.sleeping=!0,S.app.graphicsHelper.removeFromUpdate(this);var t=this._body;this.removeVelocity(),this.rotationQuaternion.x=t.orientation.x,this.rotationQuaternion.y=t.orientation.y,this.rotationQuaternion.z=t.orientation.z,this.rotationQuaternion.w=t.orientation.s;var e=this._body.position;if(this.bowl)this.bowl.addFood(this),this.platform&&(this.platform.removeFood(this),this.platform=null),this.cage&&this.cage.bedding&&this.cage.bedding.removeFood(this),this.setPosition(e.x,e.y,e.z);else if(this.platform&&this.platform.foodMoundCollider){var o=this.platform.foodMoundCollider.mesh.getHeightAtCoordinates(e.x,e.z);this.setPosition(e.x,o+this.radiusX,e.z)}else this.setPosition(e.x,e.y,e.z);this._body.position.y=999,this.body=null,this._body.parent&&(this._body.shapes.position.x=999,this.world.removeRigidBody(this._body)),S.app.foodManager&&S.app.foodManager.trackPhysics(this,!1)}},Food.prototype.enablePhysics=function(){this._body.parent||this.world.addRigidBody(this._body),this.isOnGround=!1,this.body||(this.body=this._body,this.body.position.x=this.position.x,this.body.position.y=this.position.y,this.body.position.z=this.position.z,this.body.shapes.position.x=this.position.x,this.body.shapes.position.y=this.position.y,this.body.shapes.position.z=this.position.z,this.setBodyRotationQuaternion(this.rotationQuaternion)),this.body.sleeping=!1,S.app.foodManager.trackPhysics(this,!0),S.app.graphicsHelper.addForUpdate(this)},Food.prototype.removeVelocity=function(){this._body.linearVelocity.x=0,this._body.linearVelocity.y=0,this._body.linearVelocity.z=0,this._body.angularVelocity.x=0,this._body.angularVelocity.y=0,this._body.angularVelocity.z=0,this._body.syncShapes()},Food.prototype.setPositionDrag=function(t,e,o,i){this._body,this.position.x,this.position.y,this.position.z;if(this.isDragging||i||(this.isDragging=!0,this.disablePhysics(),t,e,o),p.prototype.setPositionDrag.call(this,t,e,o,i),this.isDragging&&i&&(this.isDragging=!1,this.enablePhysics(),this.applyRandomAngVel(),this.updateCage(),this.cage)){if(this.cage.bedding){var n=this.cage.getHeightAt(this.position.x,this.position.z);this.position.y+this.radius-n<0&&(this.disablePhysics(),this.isOnBeddingSurface=!1,Food.Tracker.add(this),this.cage.bedding.addFood(this),this.setPosition(t,e,o))}var s=this.cage.getPlatformUnder(this.position.x,this.position.y,this.position.z);s?(this.platform=s,this.platform.addFood(this)):(this.platform=null,this.cage.bedding||this.cage.addFood(this))}},Food.prototype.applyRandomAngVel=function(){var t=this._body.angularVelocity;t.x=2*Math.random()-1,t.y=2*Math.random()-1,t.z=2*Math.random()-1,t.normalize(t);var e=2*Math.random()+1;t.x*=e,t.y*=e,t.z*=e},Food.prototype._update=function(){if(!this.isDragging&&this.body){var t=this.cage,e=this.platform,o=this.body.position,i=this.body.linearVelocity,n=this.radius+.05;if(t){if(!t.isInside(o.x,o.y,o.z,-n)){var s=t.position.x+.5*t.width,a=t.position.x-.5*t.width;o.x>s-n?(o.x=s-n,0<i.x&&(i.x*=-.2)):o.x<a+n&&(o.x=a+n,i.x<0&&(i.x*=-.2))}e?(o.x<e.position.x-.5*e.width||o.x>e.position.x+.5*e.width)&&(e.removeFood(this),this.platform=null,(e=t.getPlatformUnder(o.x,o.y,o.z))&&(this.platform=e).addFood(this)):(e=t.getPlatformUnder(o.x,o.y,o.z))&&(this.platform=e).addFood(this);var r=t.position.y+t.height,c=t.position.y-this._meshToRadiusDistZ;e&&(c=e.position.y-this._meshToRadiusDistZ);var d=t.front+.15;o.z<d&&(o.z=d,i.z<0&&(i.z*=-1)),o.y>r-n?(o.y=r-n,0<i.y&&(i.y*=-.2)):o.y<c+n&&(o.y=c+n,i.y<0&&(i.y*=-.2),this.onGroundHit(c,!0,.07,null,0,1,0))}this.isOnGround&&this.disablePhysics()}},Food.prototype.updateCage=function(){var t=S.Cage.getCageAt(this.position.x,this.position.y,this.position.z);t?(this.cage&&this.cage!=t&&this.cage.removeFood(this),this.cage!=t&&t.addFood(this),this.cage=t,this.stayInsideBody=t.body):this.cage&&(this.cage.removeFood(this),this.cage=null)},Food.prototype.removeFromAccessories=function(){this.cage&&(this.cage.bedding&&this.cage.bedding.removeFood(this),this.cage.removeFood(this)),this.platform&&this.platform.removeFood(this),this.bowl&&this.bowl.removeFood(this),this.cage=null,this.platform=null,this.bowl=null},Food.prototype.recycle=function(){this.owner&&(this.owner.food=null,this.owner=null),this.disablePhysics(),this.removeFromAccessories(),this.removeFromScene(),this.isActive=!1,Food.Tracker.remove(this)},Food.prototype.removeFromTracker=function(){Food.Tracker.remove(this)},Food.Tracker=new S.FoodTracker,Food.tempVecs=[new OIMO.Vec3(0,0,0),new OIMO.Vec3(0,0,0),new OIMO.Vec3(0,0,0)],Food.tempQuats=[new OIMO.Quat,new OIMO.Quat,new OIMO.Quat],Food.testNum=0,Food.tempBabVec=BABYLON.Vector3.Zero(),Food.tempBabQuats=[BABYLON.Quaternion.Identity(),BABYLON.Quaternion.Identity(),BABYLON.Quaternion.Identity()],Food}(S.PickUp);S.Food=t}(z0||(z0={})),function(o){var t=function(){function FoodBiteManager(){this.bitePositions=[],this.maxBites=5,this.food=[],this.material=o.Food.Material;var s=this.material;if(s){for(var t=[],a=this.maxBites,e=0;e<3*a;e++)t.push(0);var r=this;s.onBindObservable.add(function(){for(var t=r.food,e=0,o=0;o<t.length&&o<a;o++){var i=t[o].biteWorld,n=t[o].biteRadius;s.getEffect().setFloat("b"+o+"x",i.x),s.getEffect().setFloat("b"+o+"y",i.y),s.getEffect().setFloat("b"+o+"z",i.z),s.getEffect().setFloat("b"+o+"r",n),e++}s.getEffect().setFloat("numBites",e)})}}return FoodBiteManager.prototype.addFood=function(t){-1==this.food.indexOf(t)&&this.food.push(t)},FoodBiteManager.prototype.removeFood=function(t){var e=this.food.indexOf(t);-1<e&&this.food.splice(e,1)},FoodBiteManager}();o.FoodBiteManager=t}(z0||(z0={})),function(s){var t=function(){function FoodConfig(){}return FoodConfig.prototype.initObjectPool=function(t){ObjectPool.addClass("food",s.Food,{world:t}),ObjectPool.addClass("donut1",s.Food,{world:t,name:"donut1",x:0,y:0,z:0,radius:.04,radiusX:.04,radiusY:.06,color:new BABYLON.Color4(62/255,178/255,124/255)}),ObjectPool.addClass("sunflowerSeed2",s.Food,{world:t,name:"sunflowerSeed2",x:0,y:0,z:0,radius:.04,radiusX:.03,radiusY:.07,color:new BABYLON.Color4(.3,.3,.3)}),ObjectPool.addClass("pumpkinSeed2",s.Food,{world:t,name:"pumpkinSeed2",x:0,y:0,z:0,radius:.04,radiusX:.03,radiusY:.07,color:new BABYLON.Color4(0,0,0)}),ObjectPool.addClass("corn2",s.Food,{world:t,name:"corn2",x:0,y:0,z:0,radius:.04,radiusX:.03,radiusY:.06,color:new BABYLON.Color4(252/255,238/255,90/255)}),ObjectPool.addClass("disc",s.Food,{world:t,name:"disc",x:0,y:0,z:0,radius:.04,radiusX:.04,radiusY:.06,color:new BABYLON.Color4(252/255,177/255,90/255)}),ObjectPool.addClass("foodMound",s.FoodMound,{world:t}),ObjectPool.addClass("foodMoundCollider1",s.FoodMoundCollider,{world:t,width:1}),ObjectPool.addClass("foodMoundCollider2",s.FoodMoundCollider,{world:t,width:2}),ObjectPool.addClass("foodMoundCollider3",s.FoodMoundCollider,{world:t,width:3}),ObjectPool.addClass("foodMoundCollider4",s.FoodMoundCollider,{world:t,width:4})},FoodConfig.prototype.getSceneFileNames=function(t){},FoodConfig.prototype.getCreateMaterialFunctions=function(t){t.foodCustMat=this._createMaterials},FoodConfig.prototype._createMaterials=function(t,e,o){var i=new BABYLON.CustomMaterial("foodCustMat",t);i.specularColor.r=0,i.specularColor.g=0,i.specularColor.b=0,i.backFaceCulling=!1,o.foodCustMat=i;var n=s.Food.Material=i;n.Fragment_Definitions("\n\n                float ellipse(vec3 w, vec3 o, float rx, float ry, float rz){\n                    w -= o;\n                    float dx = w.x;\n                    float dy = w.y;\n                    float dz = w.z;\n                    float d = (dx*dx)/(rx*rx);\n                    d += (dy*dy)/(ry*ry);\n                    d += (dz*dz)/(rz*rz);\n                    return d;\n                }\n\n                float makeFoodBite(vec3 wuv, vec3 wpos, float radius){\n                    float df = ellipse(wuv, wpos, radius, radius, radius);\n                    //df += snoise(wuv*15.)*.04;\n                    return df;\n                }\n            "),n.AddUniform("numBites","float",null),n.AddUniform("b0x","float",null),n.AddUniform("b0y","float",null),n.AddUniform("b0z","float",null),n.AddUniform("b0r","float",null),n.AddUniform("b1x","float",null),n.AddUniform("b1y","float",null),n.AddUniform("b1z","float",null),n.AddUniform("b1r","float",null),n.AddUniform("b2x","float",null),n.AddUniform("b2y","float",null),n.AddUniform("b2z","float",null),n.AddUniform("b2r","float",null),n.AddUniform("b3x","float",null),n.AddUniform("b3y","float",null),n.AddUniform("b3z","float",null),n.AddUniform("b3r","float",null),n.AddUniform("b4x","float",null),n.AddUniform("b4y","float",null),n.AddUniform("b4z","float",null),n.AddUniform("b4r","float",null),n.Fragment_Custom_Diffuse("\n                int num = int(numBites);\n                float radius = .05;\n                float df = .0;\n                if(num > 0){\n                    radius = b0r;\n                    df = makeFoodBite(vPositionW, vec3(b0x, b0y, b0z), radius);\n                    if(df < 1.0){\n                        discard;\n                    }\n                }\n                if(num > 1){\n                    radius = b1r;\n                    df = makeFoodBite(vPositionW, vec3(b1x, b1y, b1z), radius);\n                    if(df < 1.0){\n                        discard;\n                    }\n                }\n                if(num > 2){\n                    radius = b2r;\n                    df = makeFoodBite(vPositionW, vec3(b2x, b2y, b2z), radius);\n                    if(df < 1.0){\n                        discard;\n                    }\n                }\n                if(num > 3){\n                    radius = b3r;\n                    df = makeFoodBite(vPositionW, vec3(b3x, b3y, b3z), radius);\n                    if(df < 1.0){\n                        discard;\n                    }\n                }\n                if(num > 4){\n                    radius = b4r;\n                    df = makeFoodBite(vPositionW, vec3(b4x, b4y, b4z), radius);\n                    if(df < 1.0){\n                        discard;\n                    }\n                }\n            ")},FoodConfig.prototype.getSPSData=function(t){var e=FoodConfig.maxObjects;t.push({shapeName:"sunflowerSeed2",meshName:"sunflowerSeed",numInstances:e,maxInstances:e,applyMaterialToSPS:"foodCustMat",isPickable:!1}),t.push({shapeName:"pumpkinSeed2",meshName:"pumpkinSeed",numInstances:e,maxInstances:e,applyMaterialToSPS:"foodCustMat",isPickable:!1}),t.push({shapeName:"donut1",meshName:"donut",numInstances:e,maxInstances:e,applyMaterialToSPS:"foodCustMat",isPickable:!1}),t.push({shapeName:"disc",meshName:"disc",numInstances:e,maxInstances:e,applyMaterialToSPS:"foodCustMat",isPickable:!1}),t.push({shapeName:"corn2",meshName:"corn",numInstances:e,maxInstances:e,applyMaterialToSPS:"foodCustMat",isPickable:!1})},FoodConfig.maxObjects=100,FoodConfig}();s.FoodConfig=t,s.App.AddEntityConfig(new t)}(z0||(z0={})),function(p){var t=function(){function FoodManager(t){this.capacity=0,this.inactive=[],this.totals=[],this.types=["sunflowerSeed2","pumpkinSeed2","donut1","disc","corn2"],this.isDirty=!1,this.biteManager=new p.FoodBiteManager,this._foodFalling=[],this._tempArr=[];p.FoodConfig.maxObjects;this.load(0,4),this.load(1,4),this.load(2,4),this.load(3,4),this.load(4,4)}return FoodManager.prototype.trackPhysics=function(t,e){var o=this._foodFalling.indexOf(t);e?-1==o&&(this._foodFalling.push(t),this.checkAddCollider(t)):-1!=o&&(this._foodFalling.splice(o,1),this.checkRemoveCollider(t))},FoodManager.prototype.checkAddCollider=function(t){var e,o=t.position,i=t.cage;if((i||(i=p.Cage.getCageAt(o.x,o.y,o.z)))&&!i.bedding){var n=Math.round(i.width),s=i.getPlatformUnder(o.x,o.y,o.z);if(s?(n=s.width,e=s.foodMoundCollider):e=i.foodMoundCollider,!e){e=ObjectPool.get("foodMoundCollider"+n);var a=i;s?(a=s).foodMoundCollider=e:i.foodMoundCollider=e;var r=a.position.x,c=a.position.y+.03,d=a.position.z-1.7;e.setPosition(r,c,d)}}},FoodManager.prototype.checkRemoveCollider=function(t){var e,o=t.position,i=t.cage;if(i){var n=t.platform,s=t.bowl;if(s)e=s.foodMoundCollider;else if(n){if(!(e=n.foodMoundCollider)){e=ObjectPool.get("foodMoundCollider"+n.width);var a=n.position.x,r=n.position.y+.03,c=n.position.z-1.7;e.setPosition(a,r,c)}}else{if(i.bedding)return;if(!(e=i.foodMoundCollider)){e=ObjectPool.get("foodMoundCollider"+i.width);a=i.position.x,r=i.position.y+.03,c=i.position.z-1.7;e.setPosition(a,r,c)}}e&&(e.setHeightAt(o.y-.5*t.radiusX,o.x,o.z,.18,!1),e.setHeightAt(o.y-.5*t.radiusX,o.x,o.z-.2,.18,!1))}},FoodManager.prototype.load=function(t,e){if(!(this.totals[t]>p.FoodConfig.maxObjects)){var o=this.types[t];this.inactive[t]||(this.inactive[t]=[]),null==this.totals[t]&&(this.totals[t]=0);for(var i=0;i<e;i++){var n=ObjectPool.get(o);if(!n)return;this.totals[t]++,n.shapeEnabled=!1,n.removeFromScene(),this.inactive[t].push(n)}}},FoodManager.prototype.getRandomInactive=function(){var t=Math.round(Math.random()*(this.types.length-1)),e=p.FoodConfig.maxObjects;if(0==this.inactive[t].length&&this.totals[t]<e){var o=10;this.totals[t]+o>e&&(o=e-this.totals[t]),this.load(t,o)}else if(0==this.inactive[t].length){for(var i=this._tempArr.length=0;i<this.types.length;i++)this.inactive[i].length&&this._tempArr.push(i);if(0==this._tempArr.length)return;var n=Math.round(Math.random()*(this._tempArr.length-1));t=this._tempArr[n]}var s=this.inactive[t].pop();return s.shapeEnabled=!0,s.type,s},FoodManager.prototype.recycle=function(t){this.inactive[t.type].push(t),t.recycle()},FoodManager}();p.FoodManager=t}(z0||(z0={})),function(v){var t=function(e){function FoodMound(){var t=e.call(this)||this;return t.food=[],t.num=0,t.numLayers=0,t.numPerLayer=0,t._height=0,FoodMound.count++,t.num=FoodMound.count,t}return __extends(FoodMound,e),Object.defineProperty(FoodMound.prototype,"height",{get:function(){return this._height},set:function(t){var e=t-this._height;this._height=t,this.foodShape&&this.foodShape.setScale(1,t/.1,1);for(var o=0;o<this.food.length;o++){var i=this.food[o];i.setPosition(i.position.x,e+i.position.y,i.position.z)}},enumerable:!1,configurable:!0}),FoodMound.prototype.createBody=function(t,e){if(this.body)return this.body.parent||this.world.addRigidBody(this.body),this.body.sleeping=!1,this.body.shapes.radius=t,void(this.bodyMesh&&(this.bodyMesh.scaling.x=2*t,this.bodyMesh.scaling.y=2*t,this.bodyMesh.scaling.z=2*t,this.bodyMesh.getScene().addMesh(this.bodyMesh)));var o=[2,.1,.1,v.App.z1037Mound,v.App.z1037],i=new OIMO.Body({type:"sphere",size:[t,t,t],pos:[0,0,0],rot:[0,0,0],move:!1,world:this.world,name:"foodMound"+this.num,config:o});this.body=i.body,this.bodyMesh=BABYLON.MeshBuilder.CreateSphere("",{diameter:1}),this.bodyMesh.scaling.x=t,this.bodyMesh.scaling.y=t,this.bodyMesh.scaling.z=t},FoodMound.prototype.init=function(t){if(this.world=t.world,null!=t.x){var e=t.x,o=t.y,i=t.z,n=t.radius,s=t.height;this.height=s,this.radius=n,this.setPosition(e,o,i),this.bowl=t.bowl;var a=n/.1,r=n,c=.1*.05,d=(Math.floor(s/.05),.08),p=1.5*-Math.PI,l=[];0;for(var u=this.numLayers=0;u<t.numFood;){r=n;for(var y=l[0]=0;y<a;y++){for(var g,m=p,f=2*r*Math.PI/.1,A=2*Math.PI/f,b=0;b<f&&(g=v.app.foodManager.getRandomInactive(),this.bowl&&(g.bowl=this.bowl,this.bowl.cage&&this.bowl.cage.addFood(g)),g.setRotation(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI),g.setPosition(e+Math.sin(m)*r+Math.random()*c-.5*c,o+d,i+Math.cos(m)*r+Math.random()*c-.5*c),m+=A,u++,this.food.push(g),!(u>=t.numFood));b++)g.shapeEnabled=!0,g.addToScene(),v.Food.Tracker.add(g),l[0]++;if((r-=.1)<0)break}if((d+=.05)>this.height)break}for(y=0;y<l.length;y++)0<this.numPerLayer&&(l[y],this.numPerLayer),this.numPerLayer=l[y]}},FoodMound.prototype.removeFromFoodTracker=function(){for(var t=0;t<this.food.length;t++){var e=this.food[t];v.Food.Tracker.remove(e)}},FoodMound.prototype.updateFoodTracker=function(){for(var t=0;t<this.food.length;t++){var e=this.food[t];v.Food.Tracker.remove(e),v.Food.Tracker.add(e)}},FoodMound.prototype.setPosition=function(t,e,o){for(var i=t-this.position.x,n=e-this.position.y,s=o-this.position.z,a=0;a<this.food.length;a++){var r=this.food[a];r.setPosition(i+r.position.x,n+r.position.y,s+r.position.z)}if(this.foodShape&&this.foodShape.setPosition(t,e,o),this.body){var c=this.body;c.position.x=t,c.position.y=e,c.position.z=o;var d=c.shapes;d.position.x=c.position.x,d.position.y=c.position.y,d.position.z=c.position.z,c.syncShapes(),this.bodyMesh&&(this.bodyMesh.position.x=t,this.bodyMesh.position.y=e,this.bodyMesh.position.z=o)}this.position.x=t,this.position.y=e,this.position.z=o},FoodMound.prototype.recycle=function(t){if(void 0===t&&(t=!0),t){for(var e=this.food,o=0;o<e.length;o++)v.app.foodManager.recycle(e[o]);e.length=0}this.body&&(this.body.parent&&(this.body.sleeping=!0,this.body.shapes.position.x=999,this.body.shapes.position.y=999,this.body.shapes.position.z=999,this.world.removeRigidBody(this.body)),this.bodyMesh&&this.bodyMesh.getScene().removeMesh(this.bodyMesh)),ObjectPool.recycle(this)},FoodMound.prototype.removeFromScene=function(){this.foodShape&&this.foodShape.removeFromScene();for(var t=this.food,e=0;e<t.length;e++)t[e].removeFromScene();this.body&&(this.body.position.y=9999,this.body.shapes.position.y=9999,this.body.syncShapes(),this.bodyMesh&&this.bodyMesh.getScene().removeMesh(this.bodyMesh))},FoodMound.prototype.addToScene=function(){this.foodShape&&this.foodShape.addToScene();for(var t=this.food,e=0;e<t.length;e++)t[e].addToScene()},FoodMound.prototype.removeFood=function(t){var e=this.food.indexOf(t);0<=e&&this.food.splice(e,1)},FoodMound.prototype.addFood=function(t){-1==this.food.indexOf(t)&&this.food.push(t)},FoodMound.activeObjects=[],FoodMound.count=0,FoodMound}(v.Entity);v.FoodMound=t}(z0||(z0={})),function(y){var t=function(e){function FoodMoundCollider(){var t=null!==e&&e.apply(this,arguments)||this;return t.subSize=0,t.radius=0,t.halfWidth=0,t.halfDepth=0,t.left=0,t.right=0,t.front=0,t.back=0,t.top=0,t.bottom=0,t.originalPositions=[],t.longTermPositions=[],t}return __extends(FoodMoundCollider,e),FoodMoundCollider.prototype.init=function(t){var e=t.x?t.x:0,o=t.y?t.y:0,i=t.z?t.z:0,n=t.width,s=Math.round(8*n);this.halfWidth=.5*n,this.subSize=n/s;var a=2,r=.3;if(this.halfDepth=.5*r,t.depth&&(r=t.depth,a=Math.round(8*r),this.halfDepth=.5*r),t.radius&&(this.radius=t.radius),this.world=t.world,!this.mesh){var c=y.app.graphicsHelper.scene,d=BABYLON.MeshBuilder.CreateGround("gd",{width:n,height:r,subdivisionsX:s,subdivisionsY:a,updatable:!0},c);this.mesh=d;c.removeMesh(d),d.position.x=e,d.position.y=o,d.position.z=i;var p=[1,1,.2,y.App.z1037Mound,y.App.z1037|y.App.z1034];this.body=new OIMO.Body({size:[n,r,this.radius],pos:[e,o,i],rot:[0,0,0],world:this.world,config:p,type:"ground",thickness:0,groundMesh:d}).body,this.body.shapes.entity=this}this.originalPositions.length=0;for(var l=this.mesh.getVerticesData(BABYLON.VertexBuffer.PositionKind),u=0;u<l.length;u++)this.originalPositions[u]=l[u];for(u=this.longTermPositions.length=0;u<l.length;u++)this.longTermPositions[u]=l[u]},FoodMoundCollider.prototype.setPosition=function(t,e,o){if(this.body){this.position.x=t,this.position.y=e,this.position.z=o;var i=this.body.position;i.x=t,i.y=e,i.z=o;var n=this.body.shapes.position;n.x=t,n.y=e,n.z=o,this.mesh.position.x=t,this.mesh.position.y=e,this.mesh.position.z=o,this.mesh.computeWorldMatrix(!0),this.mesh.refreshBoundingInfo(),this.updateBodyBounds(),this.cage=y.Cage.getCageAt(t,e,o)}},FoodMoundCollider.prototype.setHeightAt=function(y,g,m,f,A,t){void 0===f&&(f=0),void 0===A&&(A=!1),void 0===t&&(t=0);var b=t,e=this.mesh.position.y;y-e<-.06&&(y=e+-.06);var v=this.mesh;g-=v.position.x,m-=v.position.z,y-=v.position.y;var x=v.subdivisionsX,C=v.subdivisionsY,S=Math.round((g+v._maxX)*v.subdivisionsX/v._width),T=Math.round(-(m+v._maxZ)*v.subdivisionsY/v._height+v.subdivisionsY),B=3*(T*(v._subdivisionsX+1)+S)+1,O=1.4142*this.subSize,P=this.originalPositions,M=this.longTermPositions,I=!1;if(v.updateMeshPositions(function(t){if(P=M,0<f)for(var e=Math.ceil(f/O),o=-e;o<=e;o++)for(var i=-e;i<=e;i++){var r2=T+o,c2=S+i;if(!(x<c2||c2<0||C<r2||r2<0)){var n=(S+i)*v._width/v.subdivisionsX-v._maxX,s=-(v._maxZ+v._height*(T+o-v.subdivisionsY)/v.subdivisionsY),a=n-g,r=s-m,c=a*a+r*r;if(!(f*f<c)){var d=Math.sqrt(c),p=1-Math.min(d/f,1),l=3*(r2*(v._subdivisionsX+1)+c2)+1,u=P[l]+(y-P[l])*p;(0==b||0<b&&t[l]<u||b<0&&t[l]>u)&&(t[l]=u,I=!0,A||(M[B]=t[B]))}}}else t[B]=y,A||(M[B]=t[B]),I=!0}),I){var o=this;setTimeout(function(){o.mesh.updateCoordinateHeights(),o.mesh.refreshBoundingInfo(),o.updateBodyBounds()},60)}},FoodMoundCollider.prototype.updateBodyBounds=function(t){var e=this.mesh.getBoundingInfo().boundingBox,o=this.body.shapes;this.left=o.minX=e.minimumWorld.x,this.right=o.maxX=e.maximumWorld.x,this.bottom=o.minY=e.minimumWorld.y,this.top=o.maxY=e.maximumWorld.y,this.front=o.minZ=e.minimumWorld.z,this.back=o.maxZ=e.maximumWorld.z,o.updateProxy()},FoodMoundCollider.prototype.resetHeights=function(){this.mesh.updateMeshPositions(function(t){for(var e=0;e<t.length;e+=3)t[e+1]=0})},FoodMoundCollider}(y.Entity);y.FoodMoundCollider=t}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z758(){return null!==t&&t.apply(this,arguments)||this}return __extends(z758,t),z758.prototype.update=function(t){t.food&&e.app.foodManager.biteManager.addFood(t.food)},z758}(z767),t.z758=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z719(){return null!==t&&t.apply(this,arguments)||this}return __extends(z719,t),z719.prototype.update=function(t){if(t.physics.hitTracker&&!t.food&&t.targetPickUp&&!t.yieldingToOther&&t.isStuck(30,!0))for(var e=t.physics.hitTracker.hits,o=0;o<e.length;o++){var i=e.getAtIndex(o);if(i.actor.rodent){var n=i.actor.rodent;if(n.yieldingToOther!=t&&(n.yieldingToOther,n.targetPickUp&&!n.food&&n.isStuck(30,!0)&&(t.id,this.shouldHamGiveUpTargetPickupOverOther(t,i)))){t.yieldingToOther=i.actor.rodent,t.targetPickUp=null;break}}}},z719.prototype.shouldHamGiveUpTargetPickupOverOther=function(t,e){var o=!1,i=t.physics.headBody.body.position,n=e.actor.rodent,s=n.physics.headBody.body.position,a=t.targetPickUp.position,r=a.x-i.x,c=a.y-i.y,d=a.z-i.z,p=r*r+c*c+d*d,l=(a=n.targetPickUp.position).x-s.x,u=a.y-s.y,y=a.z-s.z,g=l*l+u*u+y*y;return t.id,n.id,g<p&&(o=!0),o},z719}(z767),e.z719=o}(z0||(z0={})),function(l){var t,e;t=l.z156||(l.z156={}),e=function(e){function z683(){var t=null!==e&&e.apply(this,arguments)||this;return t.offsetEndY=.15,t.offsetEndZ=0,t.offsetStartX=0,t.offsetStartY=0,t.offsetStartZ=.08,t}return __extends(z683,e),z683.prototype.update=function(t){if(t._numPouchedFoodRight||t._numPouchedFoodLeft){var e=t.pouchedFood;t.bones.mouth.update();var o=z767.z4[0];t.food&&t.food!=t.currentPickUpHand&&(t.bones.mouth.bone.getAbsolutePositionFromLocalToRef(t.food.offsetPos,t.mesh,o),t.food.setPosition(o.x,o.y,o.z));for(var i=e.length-1;0<=i;i--){var n=e[i];if(!n.unpouching)break;if(n.offsetPos.y+=.002,t.bones.mouth.bone.getAbsolutePositionFromLocalToRef(n.offsetPos,t.mesh,o),n.setPosition(o.x,o.y,o.z),n.offsetPos.y>this.offsetEndY){if(t.food){if(n.enablePhysics(),n.removeVelocity(),n.owner=null,t.memory.bed)z1.distanceSquaredXZ(t.memory.bed.position,n.position)<1&&(n.bed=t.memory.bed)}else t.food=n;n.unpouching=!1,n._unpouchedFrameNum=l.app.frameNum,1==n.pouchSide?t._numPouchedFoodRight--:t._numPouchedFoodLeft--,e.splice(i,1)}}var s=t.frameNum;if(!(s%60)){var a=1;t._numPouchedFoodLeft;t._numPouchedFoodRight||(a=-1);for(var r=e.length-1;e[r]&&(e[r].pouchSide!=a||e[r].unpouching);)r--;var c=e[r];if(c&&!c.unpouching){c.pouchSide;for(i=e.length-1;0<=i&&e[i]!=c;i--)if(!e[i].unpouching){var d=e[r],p=e[i];e[r]=p,e[i]=d;break}c.unpouching=!0,c.offsetPos.x=this.offsetStartX,c.offsetPos.y=this.offsetStartY,c.offsetPos.z=this.offsetStartZ,t.bones.mouth.bone.getAbsolutePositionFromLocalToRef(c.offsetPos,t.mesh,o),c.setPosition(o.x,o.y,o.z),c.addToScene(),c.updateCage()}}}},z683}(z767),t.z683=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z682(){var t=null!==e&&e.apply(this,arguments)||this;return t.tarX=0,t.tarY=-.05,t.tarZ=.08,t.ease=.02,t}return __extends(z682,e),z682.prototype.update=function(t){if(t.food){var e=t.food.offsetPos,o=this.ease;e.x+=(this.tarX-e.x)*o,e.y+=(this.tarY-e.y)*o,e.z+=(this.tarZ-e.z)*o}},z682}(z767),e.z682=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z680(){return null!==t&&t.apply(this,arguments)||this}return __extends(z680,t),z680.prototype.update=function(t){t.currentPickUpHead&&t.currentPickUpHead.updateWorldPositionFromLocalBone(),t.food.amount-=1},z680}(z767),e.z680=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z629(){return null!==t&&t.apply(this,arguments)||this}return __extends(z629,t),z629.prototype.update=function(t){t.levels.food.resetRandom(.5,1)},z629}(z767),e.z629=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z628(){return null!==t&&t.apply(this,arguments)||this}return __extends(z628,t),z628.prototype.update=function(t){t.levels.food.step(.3)},z628}(z767),e.z628=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z609(){var t=null!==e&&e.apply(this,arguments)||this;return t.radius=.05,t}return __extends(z609,e),z609.prototype.update=function(t){var e=t.bones.legFR,o=t.bones.legFL;if(t.food&&t.food!=t.currentPickUpHand){var i=z767.z4[0],n=z767.z4[1];i.copyFrom(t.food.position),n.copyFrom(i);var s=z767.z4[2];s.x=1,s.y=0,s.z=0;var a=this.radius;z1.TransformNormalToRef(s,t.mesh.getWorldMatrix(),s),i.x+=s.x*a,i.y+=s.y*a,i.z+=s.z*a,n.x-=s.x*a,n.y-=s.y*a,n.z-=s.z*a,o.targetPositionLerp=.1,e.targetPositionLerp=.1,o.setTargetPosition(i),e.setTargetPosition(n);var r=z1.distanceSquared(o.ikCtrl.targetPosition,i),c=z1.distanceSquared(e.ikCtrl.targetPosition,n);r<.001&&c<.001&&(t.currentPickUpHand=t.food,t.food.offsetPos.x=0,t.food.offsetPos.y=0,t.food.offsetPos.z=0)}},z609}(z767),e.z609=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z608(){var t=null!==e&&e.apply(this,arguments)||this;return t.radius=.05,t}return __extends(z608,e),z608.prototype.update=function(t){var e=t.bones.legFR,o=t.bones.legFL;if(t.food&&t.food!=t.currentPickUpHand){var i=z767.z4[0],n=z767.z4[1];t.bones.mouth.update(),i.copyFrom(t.bones.mouth.worldPos);var s=t.bones.mouth.axis;i.x+=.05*s.x,i.y+=.05*s.y,i.z+=.05*s.z,n.copyFrom(i);var a=z767.z4[2];a.x=1,a.y=0,a.z=0;var r=this.radius;z1.TransformNormalToRef(a,t.mesh.getWorldMatrix(),a),i.x+=a.x*r,i.y+=a.y*r,i.z+=a.z*r,n.x-=a.x*r,n.y-=a.y*r,n.z-=a.z*r,o.targetPositionLerp=.1,e.targetPositionLerp=.1,o.setTargetPosition(i),e.setTargetPosition(n)}o.updatePose(),e.updatePose()},z608}(z767),e.z608=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z534(){return null!==t&&t.apply(this,arguments)||this}return __extends(z534,t),z534.prototype.update=function(t){if(t.currentPickUpHead=null,t.currentPickUpHand=null,t.targetPickUp=null,t.food){var e=t.food;if(t.hasRoomInPouch())return t.addFoodToPouch(t.food),e.hamster=t,e.removeFromScene(),e.removeFromAccessories(),e.removeFromTracker(),void(t.food=null);t.food.recycle(),t.food=null}},z534}(z767),e.z534=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z533(){var t=null!==e&&e.apply(this,arguments)||this;return t.localAxisX=.97,t.localAxisY=.3,t.localAxisZ=-.3,t.centerX=0,t.centerY=.127,t.centerZ=-.13,t.cleanRadiusX=.045,t.cleanRadiusY=0,t.cleanRadiusZ=.06,t.cleanSpeed=-.15,t.poleAng=2.7,t.poleTargetX=.9,t.poleTargetY=.9,t.poleTargetZ=-.9,t.localAxis=BABYLON.Vector3.Zero(),t.translate=BABYLON.Vector3.Zero(),t.upAxis=BABYLON.Vector3.Zero(),t.frac=-.5,t}return __extends(z533,e),z533.prototype.update=function(t){var e=this.localAxis,o=this.translate,i=this.upAxis;e.x=-this.localAxisX,e.y=this.localAxisY,e.z=this.localAxisZ,o.x=this.centerX,o.y=this.centerY,o.z=this.centerZ;var n=1,s=t.pouchedFood,a=s.length-1;if(s[a]&&(n=s[a].pouchSide,s[a].unpouching)){var r,c=this.cleanRadiusX,d=this.cleanRadiusY,p=this.cleanRadiusZ,l=this.cleanSpeed,u=t.bones.mouth.worldPos;t.bones.legFR.setTargetPosition(u),t.bones.legFL.setTargetPosition(u);var y=1;-1==n?(y=1,o.z=this.centerZ):(y=.5,o.z=1.5*this.centerZ),c=this.cleanRadiusX*y,d=this.cleanRadiusY*y,p=this.cleanRadiusZ*y;var g=t.bones.head.bone;g.getDirectionToRef(BABYLON.Axis.Y,t.mesh,i),r=t.bones.legFL;var m=.5*t.adjustLerp;r.cleanController.axesViewer,r.cleanController.update(g,i,e,o,c,d,p,l,m,null,null,!0),-1==n?(y=.5,o.z=1.5*this.centerZ):(y=1,o.z=1*this.centerZ),c=this.cleanRadiusX*y,d=this.cleanRadiusY*y,p=this.cleanRadiusZ*y,(g=t.bones.head.bone).getDirectionToRef(BABYLON.Axis.Y,t.mesh,i),(r=t.bones.legFR).cleanController.axesViewer,e.x=this.localAxisX,e.y=this.localAxisY,e.z=this.localAxisZ,o.x*=-1,m=.5*t.adjustLerp,r.cleanController.update(g,i,e,o,-c,d,p,l,m,null,null,!0);var f=r.bone1.getAbsolutePosition(t.mesh),A=u.x-f.x,b=u.y-f.y,v=u.z-f.z;t.targets.lookToTarget.x+=A*this.frac,t.targets.lookToTarget.y+=b*this.frac,t.targets.lookToTarget.z+=v*this.frac}},z533}(z767),e.z533=o}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z529(){return null!==t&&t.apply(this,arguments)||this}return __extends(z529,t),z529.prototype.update=function(t){t.currentPickUpHead=null,t.currentPickUpHand=null,t.targetPickUp=null,t.food&&(e.app.foodManager.recycle(t.food),t.food=null)},z529}(z767),t.z529=o}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z520(){return null!==t&&t.apply(this,arguments)||this}return __extends(z520,t),z520.prototype.update=function(t){t.food&&e.app.foodManager.biteManager.removeFood(t.food)},z520}(z767),t.z520=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z519(){return null!==t&&t.apply(this,arguments)||this}return __extends(z519,t),z519.prototype.update=function(t){var e;t.food&&(t.food.bowl?e=t.food.bowl.foodMoundCollider:t.food.platform?e=t.food.platform.foodMoundCollider:t.food.cage&&(e=t.food.cage.foodMoundCollider),e&&(e.setHeightAt(t.food.position.y-t.food.radius,t.food.position.x,t.food.position.z,.18,!1,-1),e.setHeightAt(t.food.position.y-t.food.radius,t.food.position.x,t.food.position.z-.2,.18,!1,-1)))},z519}(z767),e.z519=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z456(){return null!==t&&t.apply(this,arguments)||this}return __extends(z456,t),z456.prototype.update=function(t){if(t.currentPickUpHand){var e=t.currentPickUpHand,o=e.position,i=z767.tempBabMats[0],n=z767.z4[1],s=t.physics.frontBody.body.position,a=t.physics.middleBody.body.position;n.x=.5*(a.x+s.x),n.y=.5*(a.y+s.y),n.z=.5*(a.z+s.z);var r=z767.z4[0];r.x=n.x-o.x,r.y=n.y-o.y,r.z=n.z-o.z,r.normalize();var c=z767.z4[1];c.x=0,c.y=1,c.z=0,c.x=t.targets.upVecTarget.x,c.y=t.targets.upVecTarget.y,c.z=t.targets.upVecTarget.z;var d=z767.z4[2];BABYLON.Vector3.CrossToRef(c,r,d),d.normalize(),BABYLON.Vector3.CrossToRef(r,d,c),BABYLON.Matrix.FromXYZAxesToRef(d,c,r,i),e.setRotationMatrix(i)}},z456}(z767),e.z456=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z432(){var t=null!==e&&e.apply(this,arguments)||this;return t.offsetX=0,t.offsetY=.15,t.offsetZ=-.03,t}return __extends(z432,e),z432.prototype.update=function(t){if(t.currentPickUpHead){var e=t.food.offsetPos,o=z767.z4[0];t.bones.mouth.bone.getAbsolutePositionFromLocalToRef(e,t.mesh,o),t.food.setPosition(o.x,o.y,o.z)}},z432}(z767),e.z432=o}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z410(){return null!==t&&t.apply(this,arguments)||this}return __extends(z410,t),z410.prototype.update=function(t){t.targetObject&&t.targetObject.accType!=e.z1044.z1057&&(t.targetObject.parent==t.cage&&t.physics.headBody.body.position.z<-1.5&&(t.focusDist=.1*t.initFocusDist))},z410}(z767),t.z410=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z409(){return null!==t&&t.apply(this,arguments)||this}return __extends(z409,t),z409.prototype.update=function(t){t.physics.headBody.body.position.z<-1.5&&(t.focusDist=.1*t.initFocusDist)},z409}(z767),e.z409=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z402(){return null!==t&&t.apply(this,arguments)||this}return __extends(z402,t),z402.prototype.update=function(t){if(t.currentPickUpHand){var e=t.currentPickUpHand.offsetPos,o=t.food,i=o.radiusY,n=(o.initAmount-o.amount)/o.initAmount;e.y=n*i,o.biteLocal.y=o.radiusY;var s=1.8*o.radiusY;o.biteRadius=.1*s+n*s*.9;var a=z767.z4[0];a.x=0,a.y=0,a.z=-1,z1.TransformNormalToRef(a,t.food.worldMatrix,a);o.offsetPos.x=.025*a.x,o.offsetPos.y+=.025*a.y,o.offsetPos.z=.025*a.z}},z402}(z767),e.z402=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z401(){return null!==t&&t.apply(this,arguments)||this}return __extends(z401,t),z401.prototype.update=function(t){t.food&&(t.food.offsetPos.x=0,t.food.offsetPos.y=.3,t.food.offsetPos.z=.05)},z401}(z767),e.z401=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z392(){var t=e.call(this)||this;return t.pawX=.7,t.pawY=-.1,t.pawZ=0,t.lerp=.2,t.offsetXR=0,t.offsetYR=0,t.offsetZR=0,t.offsetXL=0,t.offsetYL=0,t.offsetZL=0,t.fracHeight=0,t}return __extends(z392,e),z392.prototype.update=function(t,e){var o=t.physics,i=o.middleBody.rotationElements,n=t.targets.upVecTarget,s=z767.tempVecs[0],a=z767.tempVecs[1],r=n;s.x=i[0],s.y=i[3],s.z=i[6],a.cross(s,n);var c=o.headBody.body,d=o.rearBody.body,p=c.position,l=d.position,u=p.x-l.x,y=p.y-l.y,g=p.z-l.z,m=u*r.x+y*r.y+g*r.z,f=u*a.x+y*a.y+g*a.z,A=m+2*t.size,b=0,v=-t.size+A*this.fracHeight,x=f+0;b+=this.pawX,v+=this.pawY,x+=this.pawZ;var C,S,T=(s.x,r.x,a.x),B=(s.y,r.y,a.y),O=(s.z,r.z,a.z),P=t.bones.hip.bone,M=z767.z4[0],I=z767.z4[1],N=1-3.33*t.getStandFrac();C=.2*N,S=-.2*N,M.x=this.pawX,M.y=this.pawY,M.z=this.pawZ,M.x+=C,M.y+=S;var z=t.bones.hip.pitch.value;z<0&&z1.RotatePoint2D(M,-z,M),P.getAbsolutePositionFromLocalToRef(M,t.mesh,I),T=I.x,B=I.y,O=I.z,t.bones.legFL.setTargetPositionFloats(T+this.offsetXL,B+this.offsetYL,O+this.offsetZL),t.bones.legFR.setTargetPositionFloats(T+this.offsetXR,B+this.offsetYR,O+this.offsetZR),t.targets.midHandTarget.copyFrom(I),t.bones.legFL.targetPositionLerp=this.lerp,t.bones.legFR.targetPositionLerp=this.lerp,t.bones.legFL.updatePose(),t.bones.legFR.updatePose()},z392}(z767),e.z392=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(s){function z391(){var t=null!==s&&s.apply(this,arguments)||this;return t.pawX=.7,t.pawY=-.05,t.pawZ=0,t.lerp=.2,t.mult=2,t}return __extends(z391,s),z391.prototype.update=function(t){var e=t.food,o=z767.z4[0];o.x=0,o.y=0,o.z=-1;var i=.03;if(e){t.bones.hip.bone.getDirectionToRef(o,t.mesh,o);var n=(e.initAmount-e.amount)/e.initAmount;i=e.radiusX*Math.sin(.5*(1-n)*Math.PI)*this.mult}this.offsetXL=o.x*i,this.offsetYL=o.y*i,this.offsetZL=o.z*i,this.offsetXR=-o.x*i,this.offsetYR=-o.y*i,this.offsetZR=-o.z*i,s.prototype.update.call(this,t,!0)},z391}(e.z392),e.z391=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(s){function z390(){var t=null!==s&&s.apply(this,arguments)||this;return t.pawX=.7,t.pawY=-.1,t.pawZ=0,t.lerp=.2,t.foodRadiusX=.05,t.mult=2,t}return __extends(z390,s),z390.prototype.update=function(t){var e=t.food,o=z767.z4[0];o.x=1,o.y=0,o.z=0,z1.TransformNormalToRef(o,t.food.worldMatrix,o);var i=(e.initAmount-e.amount)/e.initAmount,n=e.radiusX*Math.sin(.5*(1-i)*Math.PI)*this.mult;this.offsetXL=o.x*n,this.offsetYL=o.y*n,this.offsetZL=o.z*n,this.offsetXR=-o.x*n,this.offsetYR=-o.y*n,this.offsetZR=-o.z*n,s.prototype.update.call(this,t,!0)},z390}(e.z392),e.z390=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(r){function z389(){var t=null!==r&&r.apply(this,arguments)||this;return t.pawX=.65,t.pawY=0,t.pawZ=0,t.lerp=.2,t.circleX=.66,t.circleY=0,t.circleZ=0,t.circleRadiusX=.03,t.circleRadiusY=.03,t.circleSpeed=.5,t}return __extends(z389,r),z389.prototype.update=function(t){var e=t.food,o=z767.z4[0];o.x=1,o.y=0,o.z=0,z1.TransformNormalToRef(o,t.mesh.getWorldMatrix(),o);var i=(e.initAmount-e.amount)/e.initAmount,n=e.radiusX*(1-i),s=Math.sin(t.frameNum*this.circleSpeed),a=Math.cos(t.frameNum*this.circleSpeed);this.pawX=this.circleX+a*this.circleRadiusX,this.pawY=this.circleY+s*this.circleRadiusY,this.pawZ=this.circleZ*e.pouchSide;e.offsetPos.y;this.offsetXL=o.x*n,this.offsetYL=o.y*n,this.offsetZL=o.z*n,this.offsetXR=-o.x*n,this.offsetYR=-o.y*n,this.offsetZR=-o.z*n,r.prototype.update.call(this,t,!0)},z389}(e.z392),e.z389=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(r){function z388(){var t=null!==r&&r.apply(this,arguments)||this;return t.pawX=.7,t.pawY=-.15,t.pawZ=0,t.lerp=.1,t.foodRadiusX=.05,t}return __extends(z388,r),z388.prototype.update=function(t){if(t.currentPickUpHand){var e=t.food,o=z767.z4[0];o.x=1,o.y=0,o.z=0,z1.TransformNormalToRef(o,t.mesh.getWorldMatrix(),o);this.offsetXL=.05*o.x,this.offsetYL=.05*o.y,this.offsetZL=.05*o.z,this.offsetXR=.05*-o.x,this.offsetYR=.05*-o.y,this.offsetZR=.05*-o.z,r.prototype.update.call(this,t,!0);var i=t.bones.legFL,n=t.bones.legFR,s=i.getDistSqToTarget(),a=n.getDistSqToTarget();if(s<.001&&a<.001)if(t.currentPickUpHand=null,t.food.enablePhysics(),t.food.owner=null,t.food=null,t.memory.bed)z1.distanceSquaredXZ(t.memory.bed.position,e.position)<1&&(e.bed=t.memory.bed)}},z388}(e.z392),e.z388=o}(z0||(z0={})),function(s){var t,e;t=s.z156||(s.z156={}),e=function(e){function z359(){var t=null!==e&&e.apply(this,arguments)||this;return t.lookAbove=0,t}return __extends(z359,e),z359.prototype.update=function(t){var e=t.targets.lookToTarget,o=t.targets.midHandTarget;if(e.x=o.x,e.y=o.y+this.lookAbove,e.z=o.z,t.food&&!t.usingObject){var i=t.physics.frontBody.body.position;if(e.y>i.y&&(e.y=i.y),t.physics.touchingAccTypes&s.z1044.z1045&&t.food.bowl){var n=t.food.bowl;if(n.isPositionInBowl(i.x,i.y,i.y)){n.body.position;return}}}},z359}(z767),t.z359=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z305(){return null!==t&&t.apply(this,arguments)||this}return __extends(z305,t),z305.prototype.update=function(t){var e=t.food;t.food&&(t.pouchFilledFracLeft<1&&t.pouchFilledFracRight<1?Math.random()<.5?e.pouchSide=-1:e.pouchSide=1:t.pouchFilledFracRight<1?e.pouchSide=1:t.pouchFilledFracLeft<1?e.pouchSide=-1:e.pouchSide=0)},z305}(z767),e.z305=o}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z256(){return null!==t&&t.apply(this,arguments)||this}return __extends(z256,t),z256.prototype.update=function(t){if(t.cage){var e=.2;t.physics.touchingAccTypes&o.z1044.z1045&&(e=.4,t.targets.standHeight.targetValue=e)}},z256}(z767),t.z256=e}(z0||(z0={})),function(_){var t,e;t=_.z156||(_.z156={}),e=function(e){function z194(){var t=null!==e&&e.apply(this,arguments)||this;return t.setFoodDistSq=.03,t.tmpVec=BABYLON.Vector3.Zero(),t}return __extends(z194,e),z194.prototype.update=function(t){var e,o=t.physics.headBody.body.position,i=t.targets.lookToTarget,n=t.targets.standToTarget,s=t.targets.moveToTarget;t.food&&t.food;var a=t.cage;if(a&&a.food){var r,c=(e=a.food).length,d=Number.MAX_VALUE,p=z767.z4[0],l=1*o.x,u=1*o.y,y=1*o.z;t.targetPickUp&&t.targetPickUp.owner&&t.targetPickUp.owner!=t&&(t.targetPickUp=null);var g=null,m=t.isHungry();t.usingObject&&t.usingObject.foodMound&&0<t.usingObject.foodMound.food.length&&(c=(e=t.usingObject.foodMound.food).length,g=t.usingObject.foodMound);for(var f=0;f<c;f++){if((A=e[f]).amount==A.initAmount)if(A.isOnScene,!(A.platform&&A.platform.position.y>t.position.y))if(!(A.bowl&&A.bowl.platform&&A.bowl.platform.position.y>t.position.y))if(m||!A.bed||A.bed!=t.memory.bed)if(!A.owner)(M=(B=l-(b=A.position).x)*B+(O=u-b.y)*O+(P=y-b.z)*P)<d&&(r=A,p.copyFrom(A.position),d=M)}var A,b,v=_.Food.Dragged;if(v)if((b=(A=v).position).x>a.left&&b.x<a.right&&b.y>a.bottom&&b.y<a.top)if(t.canSeePointerMove())(M=(B=l-b.x)*B+(O=u-b.y)*O+(P=y-b.z)*P)<d&&(r=A,p.copyFrom(b),d=M);if(r&&r.cage){var x=r.cage;r.position.x>x.right-.04?r.position.x=x.right-.04:r.position.x<x.left+.04&&(r.position.x=x.right+.04),r.position.y>x.top?r.position.y=x.bottom+.04:r.position.y<x.bottom+.04&&(r.position.y=x.bottom+.04),r.position.z>x.back-1?r.position.z=x.back-1:r.position.z<x.front+.04&&(r.position.z=x.front+.04)}if(r&&p.z<-1.95&&(p.z=-1.9),!g&&r&&t.targetPickUp!=r&&(t.targetObject=null,t.setPathTo(r.position)),(t.targetPickUp=r)&&!r.owner){var C=t.targets.destTarget,S=t.bones.mouth,T=this.tmpVec;S.bone.getAbsolutePositionToRef(t.mesh,T);var B,O,P,M=(B=T.x-p.x)*B+(O=T.y-p.y)*O+(P=T.z-p.z)*P;C.copyFrom(p),s.copyFrom(C),i.copyFrom(C),t.standDown&&t.targetPickUp?t.targetPickUp!=r?n.copyFrom(C):r.isOnGround||n.copyFrom(C):n.copyFrom(C);var I=!1,N=0;if(t.targetPickUp.body){var z=t.targetPickUp.body.linearVelocity;N=z.x*z.x+z.y*z.y+z.z*z.z}if(N<1e-4)if(M<this.setFoodDistSq)I=!0;else if(r.position.z<-1.8){var w=P*P;B*B+O*O<this.setFoodDistSq&&w<this.setFoodDistSq&&(I=!0)}I&&(t.currentObject.removeFood(t.targetPickUp),g&&g.removeFood(t.targetPickUp),t.hsm,t.targetPickUp.shapeEnabled=!0,t.food=t.targetPickUp,t.food.owner,(t.food.owner=t).food.removeFromTracker(),t.currentPickUpHead=t.targetPickUp,t.food==v&&t.food.disablePhysics(),_.Food.Dragged==r&&(_.Food.Dragged=null))}}},z194}(z767),t.z194=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z176(){var t=null!==e&&e.apply(this,arguments)||this;return t.biteX=0,t.biteY=.05,t.biteZ=0,t}return __extends(z176,e),z176.prototype.update=function(t){t.food&&(BABYLON.Vector3.TransformCoordinatesToRef(t.food.biteLocal,t.food.worldMatrix,t.food.biteWorld),this.testMesh)},z176}(z767),e.z176=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1030(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1030,t),z1030.prototype.test=function(t){if(1<=t.pouchFilledFracLeft&&1<=t.pouchFilledFracRight)return!0},z1030}(z770),e.z1030=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1021(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1021,t),z1021.prototype.test=function(t){var e=!1;return!t.food||(t.food.amount<=0&&(e=!0),e)},z1021}(z770),e.z1021=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1019(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1019,t),z1019.prototype.test=function(t){var e=!1;return.98<Math.random()?(e=!0,z1019.numTrueThisFrame++):z1019.numFalseThisFrame++,e},z1019.numTrueThisFrame=0,z1019.numFalseThisFrame=0,z1019}(z770),e.z1019=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1018(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1018,t),z1018.prototype.test=function(t){var e=!1;return.98<Math.random()?(e=!0,z1018.numTrueThisFrame++):z1018.numFalseThisFrame++,e},z1018.numTrueThisFrame=0,z1018.numFalseThisFrame=0,z1018}(z770),e.z1018=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z997(){return null!==t&&t.apply(this,arguments)||this}return __extends(z997,t),z997.prototype.test=function(t){return!!t.food},z997}(z770),e.z997=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z994(){return t.call(this)||this}return __extends(z994,t),z994.prototype.test=function(t){return!(!t._numPouchedFoodLeft&&!t._numPouchedFoodRight)},z994}(z770),e.z994=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z955(){return null!==t&&t.apply(this,arguments)||this}return __extends(z955,t),z955.prototype.test=function(t,e){if(!t.food)return!0;var o=!1;e.numFramesInState>t.targets.targetNum1&&(o=!0);var i=!1;return t.food.offsetPos.y<.1&&(i=!0),!(!o||!i)},z955}(z770),e.z955=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z942(){return null!==t&&t.apply(this,arguments)||this}return __extends(z942,t),z942.prototype.test=function(t){var e=t.memory.bed;return!!e&&(!!t.food&&(t.food.bed==e||void 0))},z942}(z770),e.z942=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z941(){return null!==t&&t.apply(this,arguments)||this}return __extends(z941,t),z941.prototype.test=function(t){var e=t.levels.food;return e.value==e.maxValue},z941}(z770),e.z941=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z940(){return null!==t&&t.apply(this,arguments)||this}return __extends(z940,t),z940.prototype.test=function(t){return t.levels.food.value<=0},z940}(z770),e.z940=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z916(){return null!==t&&t.apply(this,arguments)||this}return __extends(z916,t),z916.prototype.test=function(t){return t.isHungry()},z916}(z770),e.z916=o}(z0||(z0={})),function(p){var t,e;t=p.z768||(p.z768={}),e=function(t){function z903(){return null!==t&&t.apply(this,arguments)||this}return __extends(z903,t),z903.prototype.test=function(t){var e=t.cage;if(!e)return!1;if(t.targetPickUp&&!t.targetPickUp.owner)return!0;if(p.Food.Dragged){var o=e.position.x-.5*e.width,i=e.position.x+.5*e.width,n=e.position.y,s=e.position.y+e.height,a=p.Food.Dragged.position;if(a.x>o&&a.x<i&&a.y>n&&a.y<s&&t.canSeePointerMove())return!0}var r=t.physics.headBody.body.position,c=r.x,d=r.y;return!!p.Food.Tracker.isFoodInGridArea(c,d)||(!!(c-1>e.left&&p.Food.Tracker.isFoodInGridArea(c-1,d))||!!(c+1<e.right&&p.Food.Tracker.isFoodInGridArea(c+1,d)))},z903}(z770),t.z903=e}(z0||(z0={})),function(l){var t,e;t=l.z768||(l.z768={}),e=function(t){function z902(){return null!==t&&t.apply(this,arguments)||this}return __extends(z902,t),z902.prototype.test=function(t){var e=t.cage;if(!e)return!1;if(t.targetPickUp&&!t.targetPickUp.owner)return!0;if(l.Food.Dragged){var o=e.position.x-.5*e.width,i=e.position.x+.5*e.width,n=e.position.y,s=e.position.y+e.height,a=l.Food.Dragged.position;if(a.x>o&&a.x<i&&a.y>n&&a.y<s&&t.canSeePointerMove())return!0}var r=t.physics.headBody.body.position,c=r.x,d=r.y,p=t.memory.bed;return!!l.Food.Tracker.isFoodInGridArea(c,d,p)||(!!(c-1>e.left&&l.Food.Tracker.isFoodInGridArea(c-1,d,p))||!!(c+1<e.right&&l.Food.Tracker.isFoodInGridArea(c+1,d,p)))},z902}(z770),t.z902=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z887(){return null!==t&&t.apply(this,arguments)||this}return __extends(z887,t),z887.prototype.test=function(t){return t.yieldingToOther.food,!1},z887}(z770),e.z887=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z849(){return null!==t&&t.apply(this,arguments)||this}return __extends(z849,t),z849.prototype.test=function(t){return!!t.targetPickUp},z849}(z770),e.z849=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z818(){return null!==t&&t.apply(this,arguments)||this}return __extends(z818,t),z818.prototype.test=function(t){return t.food&&t.hasRoomInPouch()},z818}(z770),e.z818=o}(z0||(z0={})),function(o){var t=function(e){function z107(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z483,o.z156.z308,o.z156.z758,o.z156.z382,o.z156.z304],t.updatez156=[o.z156.z628,o.z156.z607,o.z156.z176],t.exitz156=[o.z156.z507,o.z156.z520,o.z156.z529,o.z156.z502,o.z156.z735,o.z156.z594,o.z156.z500,o.z156.z482,o.z156.z347,o.z156.z333],t.transitions=[{condition:o.z768.z1021,trueNode:{condition:o.z768.z971,trueNode:{state:o.z132,level:1},falseNode:{level:1,state:o.z102,actions:[o.z156.z520,o.z156.z529]}}}],t.states=[o.z105,o.z106],t.initialState=o.z106,t}return __extends(z107,e),z107}(z49);o.z107=t}(z0||(z0={})),function(o){var t=function(e){function z106(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z382,o.z156.z256],t.updatez156=[o.z156.z402,o.z156.z456,o.z156.z699,o.z156.z587,o.z156.z391,o.z156.z359,o.z156.z385,o.z156.z680],t.states=[o.z104],t.transitions=[{condition:o.z768.z918,trueNode:{condition:o.z768.z1018,trueNode:{state:o.z105}}}],t.initialState=o.z104,t}return __extends(z106,e),z106}(z49);o.z106=t}(z0||(z0={})),function(o){var t=function(e){function z105(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z353],t.updatez156=[o.z156.z699,o.z156.z390,o.z156.z385],t.states=[o.z104],t.transitions=[{condition:o.z768.z1019,trueNode:{state:o.z106}}],t.initialState=o.z104,t}return __extends(z105,e),z105}(z49);o.z105=t}(z0||(z0={})),function(o){var t=function(e){function z104(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z281,o.z156.z382],t.updatez156=[o.z156.z627,o.z156.z339,o.z156.z283,o.z156.z378,o.z156.z536,o.z156.z542,o.z156.z209,o.z156.z455,o.z156.z327],t.exitz156=[o.z156.z486],t}return __extends(z104,e),z104}(z49);o.z104=t}(z0||(z0={})),function(o){var t=function(e){function z103(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z523],t.updatez156=[o.z156.z733,o.z156.z734,o.z156.z406,o.z156.z194,o.z156.z719,o.z156.z588],t.exitz156=[o.z156.z494],t.transitions=[{condition:o.z768.z830,trueNode:{state:o.z101}},{condition:o.z768.z997,trueNode:{condition:o.z768.z916,falseNode:{condition:o.z768.z942,trueNode:{state:o.z112,level:1,actions:[o.z156.z467,o.z156.z493]},falseNode:{state:o.z99,actions:[o.z156.z519]}},trueNode:{state:o.z99,actions:[o.z156.z519]}}}],t}return __extends(z103,e),z103}(z49);o.z103=t}(z0||(z0={})),function(o){var t=function(e){function z102(){var t=null!==e&&e.apply(this,arguments)||this;return t.states=[o.z103,o.z101,o.z107,o.z99,o.z100],t.updatez156=[o.z156.z208,o.z156.z209,o.z156.z532],t.exitz156=[o.z156.z529],t.transitions=[{condition:o.z768.z982,falseNode:{state:o.z37}},{condition:o.z768.z997,falseNode:{condition:o.z768.z941,trueNode:{state:o.z112},falseNode:{condition:o.z768.z916,trueNode:{condition:o.z768.z903,falseNode:{state:o.z112}},falseNode:{condition:o.z768.z1030,trueNode:{condition:o.z768.z1005,trueNode:{state:o.z93},falseNode:{state:o.z112}},falseNode:{condition:o.z768.z902,falseNode:{state:o.z112}}}}}}],t.initialState=o.z101,t}return __extends(z102,e),z102}(z49);o.z102=t}(z0||(z0={})),function(o){var t=function(e){function z101(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z494,o.z156.z467],t.updatez156=[o.z156.z578],t.exitz156=[o.z156.z462],t.transitions=[{condition:o.z768.z830,falseNode:{state:o.z103}},{condition:o.z768.z887,falseNode:{state:o.z103}}],t}return __extends(z101,e),z101}(z49);o.z101=t}(z0||(z0={})),function(o){var t=function(e){function z100(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z483,o.z156.z308,o.z156.z382,o.z156.z304,o.z156.z382,o.z156.z256,o.z156.z263,o.z156.z305,o.z156.z401],t.updatez156=[o.z156.z432,o.z156.z682,o.z156.z354,o.z156.z697,o.z156.z588,o.z156.z608,o.z156.z385],t.exitz156=[o.z156.z534,o.z156.z502,o.z156.z735,o.z156.z594,o.z156.z500,o.z156.z482,o.z156.z347,o.z156.z333],t.states=[o.z104],t.transitions=[{condition:o.z768.z955,trueNode:{state:o.z103}}],t.initialState=o.z104,t}return __extends(z100,e),z100}(z49);o.z100=t}(z0||(z0={})),function(o){var t=function(e){function z99(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z528,o.z156.z424,o.z156.z494],t.updatez156=[o.z156.z333,o.z156.z348,o.z156.z308],t.transitions=[{condition:o.z768.z937,trueNode:{condition:o.z768.z916,trueNode:{state:o.z107},falseNode:{state:o.z100}}}],t}return __extends(z99,e),z99}(z49);o.z99=t}(z0||(z0={})),function(o){var t=function(e){function z98(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[],t.updatez156=[o.z156.z507,o.z156.z495,o.z156.z642,o.z156.z555,o.z156.z354,o.z156.z385,o.z156.z555,o.z156.z683,o.z156.z533,o.z156.z609,o.z156.z607,o.z156.z388,o.z156.z168],t.exitz156=[o.z156.z502,o.z156.z735,o.z156.z594,o.z156.z500,o.z156.z482,o.z156.z347,o.z156.z333],t.states=[o.z104],t.transitions=[{condition:o.z768.z994,falseNode:{condition:o.z768.z997,falseNode:{state:o.z112}}}],t.initialState=o.z104,t}return __extends(z98,e),z98}(z49);o.z98=t}(z0||(z0={})),function(o){var t=function(e){function z93(){var t=null!==e&&e.apply(this,arguments)||this;return t.historyLength=3,t.enterz156=[],t.updatez156=[o.z156.z409,o.z156.z198,o.z156.z208,o.z156.z209,o.z156.z532,o.z156.z733,o.z156.z734],t.exitz156=[],t.transitions=[{condition:o.z768.z979,trueNode:{state:o.z98}},{condition:o.z768.z1005,falseNode:{state:o.z112}}],t.states=[o.z116],t}return __extends(z93,e),z93}(z49);o.z93=t}(z0||(z0={})),function(u){var t;(t=u.BodyPart||(u.BodyPart={}))[t.HEAD=0]="HEAD",t[t.MOUTH=1]="MOUTH",t[t.NOSE=2]="NOSE",t[t.EAR_R=3]="EAR_R",t[t.EAR_L=4]="EAR_L",t[t.CHEEK_R=5]="CHEEK_R",t[t.CHEEK_L=6]="CHEEK_L",t[t.LEG_RR=7]="LEG_RR",t[t.LEG_RL=8]="LEG_RL",t[t.BELLY_R=9]="BELLY_R",t[t.BELLY_L=10]="BELLY_L";var e=function(c){function z1061(){var t=c.call(this)||this;return t._shapeName="",t.log=void 0,t.scene=null,t.mesh=null,t.num=0,t.bones=new u.Skeleton,t.physics=null,t.targets=new u.z1061Targets,t.path=[],t._pathIndex=0,t.underBeddingsTEST=[],t.propsNeedToBeSaved=!1,t._startPosX=0,t._startPosY=0,t.path2=[],t._path2Index=0,t._platformAboveFrame=0,t.mapPlacementInfo=new u.MapPlacementInfo({}),t._platformUnderFrame=0,t.targetNode=void 0,t.speed=1,t.walkSpeed=1,t.runSpeedFrac=0,t.forceToWheel=0,t.smoothRandomNumber2=new u.z1076(.9,1,1),t.smoothRandomNumber1=new u.z1076(.9,1,1),t.smoothRandomVec2=new u.z1077,t.tripping=0,t.size=.18,t.frameNum=0,t.pubsub=new Pubsub,t.levels=new u.z1061Levels,t.initFocusDist=0,t.dbid=0,t.adjustLerp=1,t._focusDist=0,t.focusRange=.01,t.initFocusRange=.01,t.foodFocusRange=.04,t.minStandAng=0,t.minStandDist=.5,t.initMinStandDist=.5,t._standing=!1,t._standFrameNum=-1,t._halfStanding=!1,t.forceStand=!1,t._standDown=!1,t._standDownFrameNum=-1,t.walkForce=0,t.walkForce0FrameNum=0,t.measuredSpeed=0,t.turnAng=0,t.localPos=new OIMO.Vec3,t.localPosFront=new OIMO.Vec3,t.localPosMid=new OIMO.Vec3,t.localPosRear=new OIMO.Vec3,t.lastPos=new OIMO.Vec3,t.lastPosFront=new OIMO.Vec3,t.lastPosRear=new OIMO.Vec3,t.lastPosMid=new OIMO.Vec3,t._currentObject=void 0,t._rearObject=void 0,t._usingObject=void 0,t.bottle=void 0,t._targetObject=void 0,t.placementType=u.PlacementType.FRONT,t.onChangeObservable=new BABYLON.Observable,t.pivotPoint=new OIMO.Vec3,t.pivotRadius=.4,t.pivotAng=0,t._pivotArea=0,t.pivotAreaDir=BABYLON.Vector3.Zero(),t.pivotMoveDir=0,t.pivotRadiusMax=0,t.pivotAreaLerp=1,t.pivotUpdateLook=!1,t.otherIndex=-1,t._targetPickUp=void 0,t.currentPickUpHead=void 0,t.currentPickUpHand=void 0,t._food=void 0,t.forceWalkFrontLegs=!1,t.whiskers=void 0,t.color=new BABYLON.Color4(1,1,1,1),t.isMenuItem=!1,t.lastPathCheckFrameNum=0,t.frameNumEnteredCage=0,t.minFramesToStayInCage=3600,t.maxFramesToStayInCage=7200,t.framesToStayInCage=999,t._tempUpVec=BABYLON.Vector3.Zero(),t._rotation=BABYLON.Vector3.Zero(),t.isDragging=!1,t.dragPlaneZ=-4.5,t._options={},t._bodyStandAngsDirty=!0,t._bodyFrontPosY=0,t._beddingHeightFront=0,t._beddingHeightFrameNumFront=0,t._bodyRearPosY=0,t._beddingHeightRear=0,t._beddingHeightFrameNumRear=0,t._lastCanSeePoint=BABYLON.Vector3.Zero(),t._lastCanSeePointFrame=0,t._lastCanSeePointResult=!1,t._currentStates=new z1072,t._frameNumCurrentStates=-1,t._canSeePointerFrame=0,t._canSeePointer=!1,t._canSeeDestFrame=0,t._canSeeDest=!1,t.TEST_poleTargetX=-1,t.TEST_poleTargetY=-1,t.TEST_poleTargetZ=0,t.TEST_setup=!1,t.initFocusDist=1.5*t.size,t.initMinStandDist=3*t.size,t.focusDist=t.initFocusDist,t.targets.upVecTarget.y=1,t._colors={},t._colors.body=new BABYLON.Vector3(.5,.5,.5),t._colors.eyes=new BABYLON.Vector3(0,0,0),t._colors.paws=new BABYLON.Vector3(1,1,1),t._colors.ears=new BABYLON.Vector3(1,1,1),t}return __extends(z1061,c),Object.defineProperty(z1061.prototype,"pathIndex",{get:function(){return this._pathIndex},set:function(t){if(this._pathIndex!=t){var e=this.path[t];e&&e.data.obj&&e.data.obj.isInTube}this._pathIndex=t},enumerable:!1,configurable:!0}),Object.defineProperty(z1061.prototype,"path2Index",{get:function(){return this._path2Index},set:function(t){this._path2Index!=t&&(this._path2Index=t,0<this.path2.length&&t>=this.path2.length&&this.pubsub.broadcast(u.z1061Events.END_PATH))},enumerable:!1,configurable:!0}),Object.defineProperty(z1061.prototype,"cage",{get:function(){var t=this.currentObject;return t&&t.parent&&(t=t.parent),t&&t.accType!=u.z1044.z1048?null:t},enumerable:!1,configurable:!0}),Object.defineProperty(z1061.prototype,"platformAbove",{get:function(){if(this._platformAboveFrame==u.app.frameNum)return this._platformAbove;if(this.cage){var t=this.physics.frontBody.body.position;this._platformAbove=this.cage.getPlatformAbove(t.x,t.y,t.z)}else this._platformAbove=null;return this._platformAboveFrame=u.app.frameNum,this._platformAbove},enumerable:!1,configurable:!0}),Object.defineProperty(z1061.prototype,"platformUnder",{get:function(){if(this._platformUnderFrame==u.app.frameNum)return this._platformUnder;if(this.cage){var t=this.physics.frontBody.body.position;this._platformUnder=this.cage.getPlatformUnder(t.x,t.y,t.z)}else this._platformUnder=null;return this._platformUnderFrame=u.app.frameNum,this._platformUnder},enumerable:!1,configurable:!0}),z1061.prototype.isFollowingPath=function(){return 0<this.path2.length&&this.path2Index<this.path2.length},z1061.prototype.incrementPathIndex=function(){var t,e,o=this;o.path2Index+=3,o.pathIndex=Math.floor(o.path2Index/3)-1;var i=o.targets.pathTarget;if(o.path2Index<o.path2.length){var n=o.size;null!=(null===(t=o.path[o.pathIndex])||void 0===t?void 0:t.data.offsetY)&&(n=null===(e=o.path[o.pathIndex])||void 0===e?void 0:e.data.offsetY),i.set(o.path2[o.path2Index],o.path2[o.path2Index+1]+n,o.path2[o.path2Index+2]),o.targets.setTargetsToPathTarget()}else o.path2Index>=o.path2.length&&(i.copyFrom(o.targets.destTarget),o.targets.setTargetsToDestination())},z1061.prototype.decrementPathIndex=function(){var t=this;0<t.pathIndex&&t.pathIndex--,0<t.path2Index&&(t.path2Index-=3);var e=t.targets.pathTarget;t.path2[t.path2Index+2]&&(e.set(t.path2[t.path2Index],t.path2[t.path2Index+1]+t.size,t.path2[t.path2Index+2]),t.targets.setTargetsToPathTarget())},Object.defineProperty(z1061.prototype,"focusDist",{get:function(){return this._focusDist},set:function(t){this._focusDist,this._focusDist=t},enumerable:!1,configurable:!0}),Object.defineProperty(z1061.prototype,"standing",{get:function(){return this._standing},set:function(t){t&&(this._standFrameNum=u.app.frameNum),this._standing=t},enumerable:!1,configurable:!0}),Object.defineProperty(z1061.prototype,"halfStanding",{get:function(){return this._halfStanding},set:function(t){this._halfStanding=t},enumerable:!1,configurable:!0}),Object.defineProperty(z1061.prototype,"standDown",{get:function(){return this._standDown},set:function(t){t&&(this._standDownFrameNum=u.app.frameNum),this._standDown=t},enumerable:!1,configurable:!0}),Object.defineProperty(z1061.prototype,"yieldingToOther",{get:function(){return this._yieldingToOther},set:function(t){this._yieldingToOther=t},enumerable:!1,configurable:!0}),Object.defineProperty(z1061.prototype,"avoidingObject",{get:function(){return this._avoidingObject},set:function(t){this._avoidingObject=t},enumerable:!1,configurable:!0}),Object.defineProperty(z1061.prototype,"currentObject",{get:function(){return this._currentObject},set:function(t){t!=this._currentObject&&(t&&t.accType==u.z1044.z1048&&(!this._currentObject||this._currentObject&&this._currentObject.parent!=t)&&(this.frameNumEnteredCage=u.app.frameNum,this.framesToStayInCage=this.minFramesToStayInCage+Math.random()*(this.maxFramesToStayInCage-this.minFramesToStayInCage),this.memory.addArray(t.objs)),this._currentObject&&this._currentObject.accType==u.z1044.z1054&&this._currentObject.removez1062(this)),this._currentObject=t},enumerable:!1,configurable:!0}),Object.defineProperty(z1061.prototype,"rearObject",{get:function(){return this._rearObject},set:function(t){this._rearObject,this._rearObject=t},enumerable:!1,configurable:!0}),Object.defineProperty(z1061.prototype,"usingObject",{get:function(){return this._usingObject},set:function(t){this._usingObject,this._usingObject=t},enumerable:!1,configurable:!0}),Object.defineProperty(z1061.prototype,"targetObject",{get:function(){return this._targetObject},set:function(t){t!=this._targetObject&&(this._targetObject=t)},enumerable:!1,configurable:!0}),Object.defineProperty(z1061.prototype,"pivotArea",{get:function(){return this._pivotArea},set:function(t){this._pivotArea!=t&&(this._pivotArea=t)},enumerable:!1,configurable:!0}),Object.defineProperty(z1061.prototype,"targetPickUp",{get:function(){return this._targetPickUp},set:function(t){this._targetPickUp=t},enumerable:!1,configurable:!0}),Object.defineProperty(z1061.prototype,"food",{get:function(){return this._food},set:function(t){this._food=t},enumerable:!1,configurable:!0}),z1061.prototype.init=function(t){if(t.shapeName&&(this._shapeName=t.shapeName),t.dbid&&(this.dbid=t.dbid),null!=t.x&&(this._startPosX=t.x),null!=t.y&&(this._startPosY=t.y),!t.skipLook){if(t.c){var e=t.c.split(","),o=0;for(var i in this._colors){if(!e[o])break;var n=this._colors[i];n||(n=BABYLON.Vector3.Zero(),this._colors[i]=n),u.z1073.SetVec3FromHex(e[o],n),o++}}var s=["be"];for(var a in null!=t.o&&(s=t.o.split(",")),this._options){var r=this._options[a];-1!=s.indexOf(r.propName)?r.value="1":r.value="0"}}this.adjustLerp=u.app.world.timeStep/.016,this.yieldingToOther&&(this.yieldingToOther=null),this.memory||(this.memory=new u.z1061Memory,this.memory.rodent=this)},z1061.prototype.update=function(){if(this.isOnScene){this.standDown=!1,this.standing=!1,this._bodyStandAngsDirty=!0;var t=this.physics;t.headBody.copyRotationElements(),t.middleBody.copyRotationElements(),t.frontBody.copyRotationElements(),t.rearBody.copyRotationElements(),this.bones.update(),this.levels.update()}},z1061.prototype.isStanding=function(){var t=this.physics;t.rearBody.standAng.value<-.5&&!t.frontBody.onGround&&this.forceStand;return t.rearBody.standAng.value<-.5&&t.frontBody.onGroundDuration<-200&&!this.forceStand&&!this.forceWalkFrontLegs},z1061.prototype.isUprightDot=function(t){var e=this.physics.middleBody.body.rotation.elements;return this._tempUpVec.x=e[1],this._tempUpVec.y=e[4],this._tempUpVec.z=e[7],z1.Dot(this.targets.upVecTarget,this._tempUpVec)<t||(e=this.physics.frontBody.body.rotation.elements,this._tempUpVec.x=e[1],this._tempUpVec.y=e[4],this._tempUpVec.z=e[7],z1.Dot(this.targets.upVecTarget,this._tempUpVec)<t)},z1061.prototype.isUpright=function(t){void 0===t&&(t=.25);var e=this.targets.rollAngToUp;return e<t&&-t<e},z1061.prototype.getStandFrac=function(){var t=-this.physics.rearBody.standAng.value/(.5*Math.PI);return t<0?0:1<t?1:t},z1061.prototype.getStandFracSmooth=function(){var t=-this.physics.rearBody.standAngSmooth/(.5*Math.PI);return t<0?0:1<t?1:t},z1061.prototype.getStandFracFront=function(){var t=-this.physics.frontBody.standAngSmooth/(.5*Math.PI);return t<0?0:1<t?1:t},z1061.prototype.isTouchingGround=function(){return this.physics.isTouchingGround()},z1061.prototype.forceTouchGround=function(){this.physics.forceTouchGround()},z1061.prototype.setLocalTarget=function(t,e,o){var i=o;this.bones.neck.bone.getAbsolutePositionToRef(this.mesh,i),this.bones.hip.bone.getLocalPositionFromAbsoluteToRef(i,this.mesh,i);var n=-this.bones.legFR.distToGround;i.x+=2.5*this.size,i.y=n+i.y*t,i.z=0,e&&(i.x+=e.x,i.y+=e.y,i.z+=e.z),this.bones.hip.bone.getAbsolutePositionFromLocalToRef(i,this.mesh,o)},z1061.prototype.setLocalTargetWithShoulders=function(t,e,o){var i=u.z1062.z4[0],n=this.size,s=this.bones.legFR.distToGround;i.x=1*n,i.y=-s*(1-t)*1/this.getScale(),i.z=0,e&&(i.x+=e.x,i.y+=e.y,i.z+=e.z),this.bones.shoulder.bone.getAbsolutePositionFromLocalToRef(i,this.mesh,i),o.x=i.x,o.y=i.y,o.z=i.z},z1061.prototype.setFrontPawTarget=function(){var t=z1061.z4[0],e=z1061.z4[1];t.x=this.size,t.y=0,t.z=0;var o=1*(this.physics.rearBody.standAng.value/-1.4);this.setLocalTarget(o,t,e),this.bones.legFR.setTargetPosition(e),this.bones.legFL.setTargetPosition(e),this.separateFrontPawTargets(.5*this.size)},z1061.prototype.separateFrontPawTargets=function(t){var e=this.physics.frontBody.rotationElements,o=z1061.z4[3];o.x=e[0],o.y=e[3],o.z=e[6],o.x*=t,o.y*=t,o.z*=t;var i=this.bones.legFR,n=this.bones.legFL;i.translateTargetPosition(o),o.x*=-1,o.y*=-1,o.z*=-1,n.translateTargetPosition(o)},z1061.prototype.getScale=function(){return this.mesh.scaling.x},z1061.prototype.setPosition=function(t,e,o){this.physics.setPosition(t,e,o),this.position.x=t,this.position.y=e,this.position.z=o},z1061.prototype.setRotation=function(t,e,o){this.physics.setRotation(t,e,o)},Object.defineProperty(z1061.prototype,"rotation",{get:function(){return this.getRotation()},enumerable:!1,configurable:!0}),z1061.prototype.getRotation=function(){return this.rotationQuaternion.toEulerAnglesToRef(this._rotation),this._rotation},z1061.prototype.rotateWithQuaternion=function(t){this.physics.rotateWithQuaternion(t)},z1061.prototype.alignMeshWithBody=function(t){void 0===t&&(t=!1),z641.getz767(u.z156.z740).update(this),t&&this.mesh.computeWorldMatrix(!0),z641.getz767(u.z156.z739).update(this)},z1061.prototype.getPathToRef=function(t,e,o){if(e.length=0,this.currentObject){var i=this,n=i.physics.frontBody.body.position,s=i.currentObject.getGraphNodeAt(n.x,n.y,n.z,!0);if(i.platformUnder&&s.y<i.platformUnder.position.y){var a=i.cage;if(a){var r=a.getGraphNodeAt(n.x,n.y,n.z,!0,null,0,!0,u.z1044.z1049);r&&(s=r)}}var c=i.currentObject;if(c.parent&&(c=c.parent),i.rearObject&&i.currentObject!=i.rearObject){var d=i.rearObject.getGraphNodeAt(n.x,n.y,n.z,!0),p=z1.distanceSquared(n,s);z1.distanceSquared(n,d)<p&&(s=d)}if(s.data.enterEvent&&i.path[0]&&i.path[0].data.enterEvent,o||(o=u.app.graphicsHelper.getObjectByPickInfo(u.app.pickInfo)),o||(o=u.app.getObjOnSceneAt(t.x,t.y,t.z)),!o||o.isOnScene){o&&o.isOnScene&&(c=o);var l=c.getGraphNodeAt(t.x,t.y,t.z,!0);l&&astar.search(e,u.app.graph.nodes,s,l)}}},z1061.prototype.setPathTo=function(t,e){if(this.currentObject){this.isTouchingGround();var o=this,i=o.physics.frontBody.body.position;e&&(i=e);var n=o.currentObject.getGraphNodeAt(i.x,i.y,i.z,!0,null,0,!0);if(o.platformUnder&&n.y<o.platformUnder.position.y){var s=o.cage;if(s){var a=s.getGraphNodeAt(i.x,i.y,i.z,!0,null,0,!0,u.z1044.z1049);a&&(n=a)}}var r=o.currentObject;if(r.parent&&(r=r.parent),o.rearObject&&o.currentObject!=o.rearObject){var c=o.rearObject.getGraphNodeAt(i.x,i.y,i.z,!0);if(.01<z1.distanceSquared(n,c)){var d=z1.distanceSquared(i,n);z1.distanceSquared(i,c)<d&&(n=c)}}o.targetObject&&o.targetObject.isOnScene?o.targetObject&&o.targetObject.isOnScene&&(r=o.targetObject):r.isInBox(t.x,t.y,t.z)||(r=u.Cage.getClosestCage(t.x,t.y,t.z));var p=r.getGraphNodeAt(t.x,t.y,t.z,!0);if(p){if(o.isFollowingPath()&&o.path[o.path.length-1]==p){if(o.path[o.pathIndex-2]==n)return;if(o.path[o.pathIndex-1]==n)return;if(o.path[o.pathIndex]==n)return;if(o.path[o.pathIndex+1]==n)return void o.incrementPathIndex();if(o.path[o.pathIndex+2]==n)return o.incrementPathIndex(),void o.incrementPathIndex()}n!=p&&(astar.search(o.path,u.app.graph.nodes,n,p),o.pathIndex=0,o.targetNode=p,o.path2.length=0,o.path2Index=0,n.data.enterEvent&&o.path[0]&&o.path[0].data.enterEvent,0<o.path.length&&(z1083.getSmoothPath(o.path2,o.path,i,t),this.pubsub.broadcast(u.z1061Events.NEW_PATH,this,this.path)))}}},z1061.prototype.setPathStartNodeEndNode=function(t,e){var o=this;if(astar.search(o.path,u.app.graph.nodes,t,e),o.pathIndex=0,o.targetNode=e,o.path2.length=0,(o.path2Index=0)<o.path.length){z1083.getSmoothPath(o.path2,o.path,t,e),u.app.pathHelper&&u.app.pathHelper.updateDrawPath(o.path);var i=o.path[0];i.data.enterNextNode?o.path[o.pathIndex+1]===i.data.enterNextNode&&o.pubsub.broadcast(i.data.enterEvent):i.data.enterEvent&&o.pubsub.broadcast(i.data.enterEvent)}},z1061.prototype.copyPathFrom=function(t){for(var e=this.path,o=t.length,i=0;i<o;i++)e[i]=t[i];e.length=t.length},z1061.prototype.reset=function(){this.maxStepHeight=this.initMaxStepHeight,this.focusDist=this.initFocusDist,this.focusRange=this.initFocusRange,this.minStandDist=this.initMinStandDist,this.speed=1,this.walkSpeed=1,this.physics.reset(),this.bones.reset(),this.standing=!1,this.yieldingToOther=null},z1061.prototype.removeFromScene=function(){this.isOnScene&&(this.isMenuItem&&this.isMenuItem,this.isMenuItem||this.addItemCount(1),this.usingObject&&this.usingObject.removez1062&&(this.usingObject.removez1062(this),this.usingObject=null),this.physics.removeBodies(),this.scene.removeMesh(this.mesh),this.scene.removeMesh(this.mesh),this.whiskers&&this.whiskers.removeFromScene(),this.isOnScene=!1,this.onChangeObservable.notifyObservers(this))},z1061.prototype.addToScene=function(){this.mesh.isVisible=!0,this.isOnScene||(this.isMenuItem&&this.isMenuItem,this.isMenuItem||this.addItemCount(-1),this.physics.addBodies(),this.scene.addMesh(this.mesh),this.whiskers&&this.whiskers.addToScene(),this.isOnScene=!0,this.onChangeObservable.notifyObservers(this))},z1061.prototype.translate=function(t,e,o){this.physics.translate(t,e,o),this.position.x+=t,this.position.y+=e,this.position.z+=o,this.alignMeshWithBody()},z1061.prototype.setPositionOnMapFromDrop=function(t,e,o){var i=u.Cage.getCageAt(t,e,o),n=e-i.bottom;n<.6&&(e=i.bottom+.6),(n=i.top-e)<.6&&(e=i.top-.6);var s=i.getPlatformUnder(t,e,o);s&&(n=e-s.position.y)<.6&&(e=s.position.y+.6),this._startPosX=t,this._startPosY=e,this.setPositionDrag(t,e,o,!0)},z1061.prototype.setPositionDrag=function(t,e,o,i){void 0===i&&(i=!1);var n=!1;i||this.isDragging||(this.pubsub.broadcast(u.z1061Events.DRAG),n=this.isDragging=!0),this.physics.setPositionDrag(t,e,o,i),(i||n)&&(this.alignMeshWithBody(),this.position.x=t,this.position.y=e,this.position.z=o),i&&(this.pubsub.broadcast(u.z1061Events.DROP),this.isDragging=!1)},z1061.prototype._initColors=function(){for(var t in this._colors){var e=this._colors[t];this.texture&&(this.texture.setVector3(t+"Color",e),this.texture.resetRefreshCounter())}},z1061.prototype.getColors=function(){return this._colors},z1061.prototype.setColor=function(t,e,o,i){if(i&&this._colors){var n=this._colors[i];n.x==t&&n.y==e&&n.z==o||(n.x=t,n.y=e,n.z=o,this.texture&&(this.texture.setVector3(i+"Color",n),this.texture.resetRefreshCounter()),this.propsNeedToBeSaved=!0,this.onChangeObservable.notifyObservers(this))}},z1061.prototype._initProps=function(){for(var t in this._options)this.texture&&this.setOption(t,this._options[t].value)},z1061.prototype.setOption=function(t,e){var o=this._options[t];o&&(o.value=e,this.texture&&(e="1"==e?1:0,this.texture.setFloat(this._options[t].uniformName,e),this.propsNeedToBeSaved=!0,this.texture.resetRefreshCounter()))},z1061.prototype.getOptions=function(){return this._options},z1061.prototype.onPickDown=function(t){this.onPickDownObservable&&this.onPickDownObservable.notifyObservers({eventData:t,obj:this})},z1061.prototype.addPickDownObserver=function(t,e,o){void 0===o&&(o=!1),this.onPickDownObservable?this.onPickDownObservable.removeCallback(t):this.onPickDownObservable=new BABYLON.Observable,this.onPickDownObservable.add(t,-1,o,e)},z1061.prototype.addToActiveObjects=function(){-1==z1061.activeObjects.indexOf(this)&&z1061.activeObjects.push(this)},z1061.prototype.removeFromActiveObjects=function(){var t=z1061.activeObjects.indexOf(this);-1!=t&&z1061.activeObjects.splice(t,1)},z1061.prototype.copyLook=function(t){this.mesh.position.copyFrom(t.mesh.position),this.mesh.rotationQuaternion.copyFrom(t.mesh.rotationQuaternion),this.physics.copy(t.physics),this.alignMeshWithBody()},z1061.prototype.recycle=function(){for(var t=0;t<this.hsm.length;t++)this.hsm[t].reset();this.food&&(this.food.recycle(),this.food=null,this.currentPickUpHand=null,this.currentPickUpHead=null),this.path.length=0,this.path2.length=0,this.path2Index=0,this.pathIndex=0,this.currentObject&&this.currentObject.bedding&&this.currentObject.bedding.removeHamFromUpdate(this),this.currentObject=null,this.rearObject=null,this.targetObject=null,this.removeFromScene(),this.removeFromActiveObjects(),this.mesh.parent&&(this.mesh.parent=null),this.mesh.renderingGroupId=0,this.whiskers&&this.whiskers.setRenderingGroupID(0),this.onPickDownObservable&&this.onPickDownObservable.clear(),ObjectPool.recycle(this)},z1061.prototype.notifyOnChangeObservers=function(){this.onChangeObservable.notifyObservers(this)},z1061.prototype.addOnChangeObserver=function(t,e){this.onChangeObservable.removeCallback(t,this),this.onChangeObservable.add(t,-1,!1,e)},z1061.prototype.isValidDropLocation=function(t,e,o){return!!u.Cage.getCageAt(t,e,o)},z1061.prototype.initBodyStandAngs=function(){var t=this;t._bodyStandAngsDirty=!1,t.physics.frontBody.standAngSmooth=z1.lerpNumber(t.physics.frontBody.standAng.value,0,.2*t.adjustLerp),t.physics.rearBody.standAngSmooth=z1.lerpNumber(t.physics.rearBody.standAng.value,0,.2*t.adjustLerp),t.physics.frontBody.standAng.targetValue=0,t.physics.rearBody.standAng.targetValue=0,t.bones.tail.ang=.6*-Math.PI-2*t.physics.rearBody.standAngSmooth},z1061.prototype.computeBodyStandAngs=function(){if(this._bodyStandAngsDirty){var t=this,e=t.physics.frontBody.rotationElements,o=t.physics.rearBody.rotationElements,i=t.targets.upVecTarget,n=e;(s=z1061.z4[0]).x=i.x,s.y=i.y,s.z=i.z,(a=z1061.z4[1]).x=n[2],a.y=n[5],a.z=n[8];var s,a,r=BABYLON.Vector3.Dot(s,a),c=Math.acos(r)-.5*Math.PI;n=o,(s=z1061.z4[0]).x=i.x,s.y=i.y,s.z=i.z,(a=z1061.z4[1]).x=n[2],a.y=n[5],a.z=n[8];var d=BABYLON.Vector3.Dot(s,a),p=Math.acos(d)-.5*Math.PI;t.physics.frontBody.standAngSmooth=z1.lerpNumber(t.physics.frontBody.standAng.value,c,.2*t.adjustLerp),t.physics.rearBody.standAngSmooth=z1.lerpNumber(t.physics.rearBody.standAng.value,p,.2*t.adjustLerp),t.physics.frontBody.standAng.targetValue=c,t.physics.rearBody.standAng.targetValue=p;var l=t.getStandFracSmooth(),u=.11;if(l<.8){u=2.01*(l/.8)-1.9}t.bones.tail.ang=u,this._bodyStandAngsDirty=!1}},z1061.prototype.getClosestz1061=function(t,e,o){void 0===t&&(t=2),void 0===e&&(e=2),void 0===o&&(o=Number.MAX_VALUE);var i=z1061.activeObjects,n=this.physics.middleBody.body.position;0==t?n=this.physics.headBody.body.position:1==t&&(n=this.physics.frontBody.body.position);for(var s=Number.MAX_VALUE,a=null,r=0;r<i.length;r++){var c=i[r];if(c!=this){var d=c.physics.middleBody.body.position;1==e?d=c.physics.frontBody.body.position:3==e&&(d=c.physics.rearBody.body.position);var p=n.x-d.x,l=n.y-d.y,u=n.z-d.z,y=p*p+l*l+u*u;y<s&&(a=c,s=y)}}if(s<o)return a},z1061.prototype.isStuck=function(t,e){void 0===t&&(t=30),void 0===e&&(e=!1);var o=u.app.frameNum;return!!(o-this.physics.frontBody.lastFrameSpeedAbove>t&&(e||o-this.walkForce0FrameNum>t))},z1061.prototype.getBeddingHeightFront=function(){var t=u.app.frameNum,e=this.physics.frontBody.body.position;if(this._beddingHeightFrameNumFront==t&&this._bodyFrontPosY==e.y)return this._beddingHeightFront;var o=this.currentObject;if(o&&o.bedding){var i=o.position.x-.5*o.width,n=o.position.x+.5*o.width,s=e.x,a=e.z,r=this.size;return s<i&&(s=i+r),n<s&&(s=n-r),this._beddingHeightFront=o.bedding.getHeightAt(s,a,!0),this._beddingHeightFrameNumFront=t,this._bodyFrontPosY=e.y,this._beddingHeightFront}},z1061.prototype.getBeddingHeightRear=function(){var t=u.app.frameNum,e=this.physics.rearBody.body.position;if(this._beddingHeightFrameNumRear==t&&this._bodyRearPosY==e.y)return this._beddingHeightRear;var o=this.currentObject;if(o&&o.bedding){var i=o.position.x-.5*o.width,n=o.position.x+.5*o.width,s=e.x,a=e.z,r=this.size;return s<i&&(s=i+r),n<s&&(s=n-r),this._beddingHeightRear=o.bedding.getHeightAt(s,a,!0),this._beddingHeightFrameNumRear=t,this._bodyRearPosY=e.y,this._beddingHeightRear}},z1061.prototype.getProps=function(){var t=z1061.tempArray;t.length=0;var e=c.prototype.getProps.call(this);e={};for(var o in e.x=z1.roundToDecimalPlace(this._startPosX,2),e.y=z1.roundToDecimalPlace(this._startPosY,2),this._colors){var i=this._colors[o];t.push(u.z1073.GetHexFromVec3(i))}for(var n=t.length,s=t.length-1;0<=s&&null==t[s];s--)n--;for(var a in t.length=n,e.c=t.join(),t.length=0,this._options){var r=this._options[a];"0"!=r.value&&t.push(r.propName)}return e.o=t.join(),this.propsNeedToBeSaved=!1,e},z1061.prototype.canSeePointSimple=function(t){if(this._lastCanSeePointFrame==u.app.frameNum&&this._lastCanSeePoint.equals(t))return this._lastCanSeePointResult;this._lastCanSeePointFrame=u.app.frameNum,this._lastCanSeePoint.copyFrom(t);var e=!1,o=this.physics.frontBody.body.position,i=this.physics.headBody.body.rotation.elements,n=z1061.z4[0],s=z1061.z4[1];return n.x=i[2],n.y=i[5],n.z=i[8],s.x=t.x-o.x,s.y=t.y-o.y,s.z=t.z-o.z,s.normalize(),-.5<BABYLON.Vector3.Dot(n,s)&&(e=!0),this._lastCanSeePointResult=e},z1061.prototype.getCurrentStateNames=function(){if(this.frameNum!=this._frameNumCurrentStates){for(var t=this._currentStates.length=0;t<this.hsm.length;t++)for(var e=this.hsm[t];e&&(this._currentStates.push(e.name),e!=e.currentState);)e=e.currentState;this._frameNumCurrentStates=this.frameNum}return this._currentStates},z1061.prototype.isInState=function(t){return-1!=this.getCurrentStateNames().indexOf(t)},z1061.prototype.changeState=function(t){for(var e=0;e<this.hsm.length&&!this.hsm[e].changeState(t);e++);},z1061.prototype.getTimeInCurrentState=function(t){for(var e,o=0,i=0;i<this.hsm.length;i++)if((e=this.hsm[i]).name==t){o=e.currentState.getTimeInState();break}return o},z1061.prototype.canSeePoint=function(t){var e=this.cage;if(!e)return!1;var o=e.left+.01,i=e.right-.01,n=e.top-.01,s=e.bottom+.01,a=e.back-.01;if(t.x<o)return!1;if(t.x>i)return!1;if(t.y<s)return!1;if(t.y>n)return!1;if(t.z>a)return!1;if(!this.canSeePointSimple(t))return!1;var r=this.position,c=t.y-r.y,d=this.physics.headBody.body.position;if(c<0){var p=this.platformUnder;if(p&&t.y<p.position.y){var l=p.connectedPlatformsCenterX-.5*p.connectedPlatformsWidth,u=p.connectedPlatformsCenterX+.5*p.connectedPlatformsWidth;return!z1.Get2DLineIntersection(d.x,d.y,t.x,t.y,l,p.position.y,u,p.position.y)}}else if(0<c){var y=this.platformAbove;if(y&&t.y>y.position.y){l=y.connectedPlatformsCenterX-.5*y.connectedPlatformsWidth,u=y.connectedPlatformsCenterX+.5*y.connectedPlatformsWidth;return!z1.Get2DLineIntersection(d.x,d.y,t.x,t.y,l,y.position.y,u,y.position.y)}}return!0},z1061.prototype.canSeePointerMove=function(){return this._canSeePointerFrame==u.app.frameNum||(this._canSeePointerFrame=u.app.frameNum,this._canSeePointer=this.canSeePoint(u.app.pointerMovePosition)),this._canSeePointer},z1061.prototype.canSeeDestTarg=function(){return this._canSeeDestFrame==u.app.frameNum||(this._canSeeDestFrame=u.app.frameNum,this._canSeeDest=this.canSeePoint(this.targets.destTarget)),this._canSeeDest},z1061.prototype.poseFrontLegs=function(t,e,o,i,n,s){var a;void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===o&&(o=.3),void 0===i&&(i=0),void 0===n&&(n=-.07),void 0===s&&(s=.24);var r=this;if(r.cage&&(a=r.cage.bindedKeepPosInside),datgui&&!this.isMenuItem&&(this.TEST_setup||(this.TEST_setup=!0)),t||e){var c=r.adjustLerp,d=r.getStandFrac(),p=null,l=r.physics.stretchFrac;r.mesh.parent&&(p=z1061.tempBabMat).copyFrom(r.mesh.parent.getWorldMatrix()),r.bones.mouth.update();var u=z1061.z4[0],y=z1061.z4[1],g=z1061.z4[2],m=z1061.z4[3],f=r.physics.rearBody.body.position;g.x=f.x,g.y=f.y,g.z=f.z;f=r.physics.frontBody.body.position;m.x=f.x,m.y=f.y,m.z=f.z,p&&(BABYLON.Vector3.TransformCoordinatesToRef(g,p,g),BABYLON.Vector3.TransformCoordinatesToRef(m,p,m)),u.copyFrom(r.bones.mouth.worldPos),y.x=.144,y.y=-.18,y.z=0,r.bones.shoulder.bone.getAbsolutePositionFromLocalToRef(y,r.mesh,y);var A=d-l,b=u.y;u.x=y.x+(u.x-y.x)*A,u.y=y.y+(u.y-y.y)*A,u.z=y.z+(u.z-y.z)*A,b<u.y&&(u.y=b),u.y<g.y-.5*r.size&&(u.y=g.y-.5*r.size);var v=r.bones.shoulder.bone;v.getLocalPositionFromAbsoluteToRef(u,r.mesh,u);var x=i,C=n,S=.5*s;b>m.y&&(x+=.75*(b-m.y));l=r.physics.stretchFrac;var T,B,O,P=z1061.z4[4];T=this.TEST_poleTargetX,B=this.TEST_poleTargetY,O=this.TEST_poleTargetZ;var M,I=z1061.z4[5];I.x=u.x+x,I.y=u.y+C,t&&(M=this.bones.legFL,I.z=M.dirX*S,M.ikCtrl.slerpAmount=1,v.getAbsolutePositionFromLocalToRef(I,r.mesh,P),BABYLON.Vector3.LerpToRef(M.ikCtrl.targetPosition,P,1,I),M.setTargetPosition(I),M.targetPoleAngle+=.5*(M.dirX*o-M.targetPoleAngle),M.ikCtrl.poleTargetLocalOffset.x=T,M.ikCtrl.poleTargetLocalOffset.y=B,M.ikCtrl.poleTargetLocalOffset.z=M.dirX*O,M.posed?M.targetPositionLerp=z1.lerpNumber(M.targetPositionLerp,1,.01*c):(M.targetPositionLerp=.5*c,M.targetPoleAngleLerp=.5*c),M.updatePose(a)),I.x=u.x+x,I.y=u.y+C,e&&(M=this.bones.legFR,I.z=M.dirX*S,M.ikCtrl.slerpAmount=1,v.getAbsolutePositionFromLocalToRef(I,r.mesh,P),BABYLON.Vector3.LerpToRef(M.ikCtrl.targetPosition,P,1,I),M.setTargetPosition(I),M.targetPoleAngle+=.5*(M.dirX*o-M.targetPoleAngle),M.ikCtrl.poleTargetLocalOffset.x=T,M.ikCtrl.poleTargetLocalOffset.y=B,M.ikCtrl.poleTargetLocalOffset.z=M.dirX*O,M.posed?M.targetPositionLerp=z1.lerpNumber(M.targetPositionLerp,1,.01*c):(M.targetPositionLerp=.5*c,M.targetPoleAngleLerp=.5*c),M.updatePose(a))}},z1061.prototype.rotatePawDown=function(t,e){void 0===e&&(e=.05),BABYLON.Quaternion.RotationYawPitchRollToRef(0,t.targetPoleAngle,-2+Math.abs(.75*t.targetPoleAngle),z1061._pawRotDownTarget);var o=z1061._pawRotDownTarget,i=z1061.tempBabQuats[0];t.bone2.getRotationQuaternionToRef(BABYLON.Space.WORLD,null,i),i.multiplyToRef(o,i),t.setPawRotationTarget(i),t.pawSlerpAmount=e},z1061.prototype.convertToMenuItem=function(){this.isMenuItem=!0,this.physics.setCollidesWithNone(),this.physics.setBelongsTo(u.App.z1034Menu),this.physics.addCollidesWith(u.App.z1033Menu),this.mesh.renderingGroupId=u.App.menuRenderingGroupID,this.whiskers.setRenderingGroupID(u.App.menuRenderingGroupID)},z1061.prototype.getName=function(){return this._shapeName},z1061.prototype.isHungry=function(){var t=this.levels.food;return t.value/t.maxValue<.5},z1061.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],z1061.tempBabMat=BABYLON.Matrix.Identity(),z1061.tempArray=[],z1061.tempArray2=[],z1061.activeObjects=[],z1061._pawRotDownTarget=BABYLON.Quaternion.RotationYawPitchRoll(0,0,-1.4),z1061}(u.Entity);u.z1061=e}(z0||(z0={})),function(x){var t=function(v){function z1062(){var t=v.call(this)||this;return t.canTranslate=!0,t.pouchedFood=new Array,t._maxPouchedFood=6,t._numPouchedFoodLeft=0,t._numPouchedFoodRight=0,t._pouchFilledFracLeft=0,t._pouchFilledFracRight=0,t.actionNames=void 0,t.eyesCloseAmount=0,t._eyesCloseLerp=.3,t._eyesBlinkLerp=.5,t.avoidDir=BABYLON.Vector3.Zero(),t.avoidForce=0,t.avoidForceMax=1,t.testLastStride=0,t.strength=1,t.startFrame=0,t.snoutLineLen=.5,t.snoutBlur=.05,t.snoutLineThickness=.03,t.snoutLineX=.09,t.noiseMult=5,t.rand=.5,t.cheekBlur=.03,t.cheekX=.362,t.cheekY=.245,t.shaderTweak1=.291,t.shaderTweak2=.107,t.shaderTweak3=-1.043,t.shaderTweak4=-.003,t.isOnWheel=!1,t.frameNumAddedToBedding=0,t._eyesCloseAmountBlink=0,t._nextBlinkFrame=-100,t._minFramesToNextBlink=600,t._maxFramesToNextBlink=1200,t._options={propBlaze:new x.PropsMenuOption("0","blaze","bh","hasBlaze"),propCheeks2:new x.PropsMenuOption("1","cheeks 1","c1","hasCheeks1"),propCheeks3:new x.PropsMenuOption("1","cheeks 2","c2","hasCheeks2"),propCheeksFlash:new x.PropsMenuOption("1","cheek flash","cf","hasCheekFlash"),propSnout:new x.PropsMenuOption("1","mustache","sn","hasSnout"),propChin:new x.PropsMenuOption("1","chin","ch","hasChin"),propFrontUnder:new x.PropsMenuOption("1","front under","fu","hasFU"),propBelly:new x.PropsMenuOption("1","belly","be","hasBelly"),propRearUnder:new x.PropsMenuOption("1","rear under","ru","hasRU"),propMiddleBand:new x.PropsMenuOption("0","middle band","mb","hasMiddleBand")},t.test_controls_created=!1,t.translated=BABYLON.Vector3.Zero(),t._otherHamInFrontFrameNum=0,t._isFacingBowl=!1,t._isFacingBowlFrameNum=0,z1062.count++,t.num=z1062.count,t}return __extends(z1062,v),Object.defineProperty(z1062.prototype,"pouchFilledFracLeft",{get:function(){var t=this._numPouchedFoodLeft/this._maxPouchedFood;return this._pouchFilledFracLeft+=.05*(t-this._pouchFilledFracLeft),this._pouchFilledFracLeft},enumerable:!1,configurable:!0}),Object.defineProperty(z1062.prototype,"pouchFilledFracRight",{get:function(){var t=this._numPouchedFoodRight/this._maxPouchedFood;return this._pouchFilledFracRight+=.05*(t-this._pouchFilledFracRight),this._pouchFilledFracRight},enumerable:!1,configurable:!0}),Object.defineProperty(z1062.prototype,"eyesCloseLerp",{get:function(){return this._eyesCloseLerp},set:function(t){this._eyesCloseLerp!=t&&(this._eyesCloseLerp=t)},enumerable:!1,configurable:!0}),Object.defineProperty(z1062.prototype,"eyesBlinkLerp",{get:function(){return this._eyesBlinkLerp},set:function(t){this._eyesBlinkLerp!=t&&(this._eyesBlinkLerp=t)},enumerable:!1,configurable:!0}),z1062.prototype.init=function(o){v.prototype.init.call(this,o),this.addToActiveObjects();var t=o.x?o.x:0,e=o.y?o.y:0,i=o.z?o.z:-1.5,n=o.rx?o.rx:0,s=o.ry?o.ry:0,a=o.rz?o.rz:0;if(this.hsm)for(var r=0;r<this.hsm.length;r++)this.hsm[r].reset();else{this.hsm=[];var c=x.app.stateFactory;this.hsm.push(c.createState(x.z89.name,this,!1)),this.hsm.push(c.createState(x.z88.name,this,!1))}if(o.isMenuItem&&(this.changeState(x.z43.name),this.changeState(x.z66.name)),this.levels.init(this),this.size=.144,this.isMenuItem=o.isMenuItem,this.scene=x.app.graphicsHelper.scene,this.physics)this.forceStand=!1,this.standing=!1,this.minStandDist=this.initMinStandDist,this.turnAng=0,this.reset(),this.physics.hardReset(),this.bones.hardReset(),this.physics.setPosition(t,e,i),this.physics.setRotation(n,s,a),this.targets.reset(),this.walkForce=0,this.measuredSpeed=0,this.path.length=0,this.path2.length=0,this.pathIndex=0,this.path2Index=0,this.avoidForce=0,this.isMenuItem&&this.isMenuItem;else{this.physics=new x.z1061Physics,this.physics.init(o.world,this,t,e,i,n,s,a);var f=this,A=BABYLON.Vector3.Zero(),d=function(t,e,o,i,n,s,a,r){if(f.avoidForce!=f.avoidForceMax&&r.type!=OIMO.SHAPE_GROUND&&r.type!=OIMO.SHAPE_z1045&&-.9<n&&n<.9){var c=r.position,d=f.physics.frontBody.body.position,p=t-c.x,l=e-c.y,u=o-c.z,y=d.x-c.x,g=d.y-c.y,m=d.z-c.z;p*p+l*l+u*u<y*y+g*g+m*m&&(A.x=y,A.y=0,A.z=m,A.normalize(),f.avoidForce=f.avoidForceMax,f.avoidDir.copyFrom(A))}};this.physics.addHitListenerToBody(this.physics.frontBody,d),this.physics.addHitListenerToBody(this.physics.headBody,d)}this.translated.x=0,this.translated.y=0,this.translated.z=0,this.localPosFront.copy(this.physics.frontBody.body.position),this.localPosMid.copy(this.physics.middleBody.body.position),this.localPosRear.copy(this.physics.rearBody.body.position),this.localPos.copy(this.localPosMid),this.lastPosFront.copy(this.localPosFront),this.lastPosMid.copy(this.localPosMid),this.lastPosRear.copy(this.localPosRear),this.lastPos.copy(this.localPosMid),o.state&&x[o.state]&&this.changeState(o.state),o.destTarget&&(this.targets.destTarget.x=o.destTarget.x,this.targets.destTarget.y=o.destTarget.y,this.targets.destTarget.z=o.destTarget.z),o.goToPoint&&(this.changeState(x.z38.name),o.goToPoint.x||(o.goToPoint.x=0),o.goToPoint.y||(o.goToPoint.y=0),o.goToPoint.z||(o.goToPoint.z=0),this.targets.pointerDownPosition.x=o.goToPoint.x,this.targets.pointerDownPosition.y=o.goToPoint.y,this.targets.pointerDownPosition.z=o.goToPoint.z);var p=this;if(o.destinations){this.changeState(x.z38.name),this.targets.destinations=o.destinations.slice(0);var l=p.targets.destinations.shift();p.targets.pointerDownPosition.copyFrom(l),this.pubsub.subscribe(x.z1061Events.END_PATH,function(){var t=p.targets.destinations.shift();t&&p.targets.pointerDownPosition.copyFrom(t),0==p.targets.destinations.length&&p.pubsub.unsubscribe(x.z1061Events.END_PATH)})}if(o.lookToTargets)for(r=0;r<o.lookToTargets.length;r++)this._timeOutIDs=[],function(e){p._timeOutIDs.push(setTimeout(function(){var t=o.lookToTargets[e];p.targets.pointerDownPosition.x=t.x,p.targets.pointerDownPosition.y=t.y,p.targets.pointerDownPosition.z=t.z,x.app.pointerDownPosition.x=t.x,x.app.pointerDownPosition.y=t.y,x.app.pointerDownPosition.z=t.z,x.app.pointerMovePosition.x=t.x,x.app.pointerMovePosition.y=t.y,x.app.pointerMovePosition.z=t.z},o.lookToTargets[e].time||0))}(r);this.mesh||(this.loadModel(),this.scene.removeMesh(this.mesh),this.scene.removeMesh(this.mesh),this.isOnScene=!1,this.mesh.isPickable=!0);var u=this.mesh.position,y=this.physics.middleBody.body.position;u.x=y.x,u.y=y.y,u.z=y.z,this.position.x=u.x,this.position.y=u.y,this.position.z=u.z,o.renderingGroupID&&(this.mesh.renderingGroupId=o.renderingGroupID),this.mesh.computeWorldMatrix(!0),this.alignMeshWithBody(!0),this.mesh.computeWorldMatrix(!0),z641.getz767(x.z156.z731).resetWalk(this),x.app.graphicsHelper.addObject(this);var g="test"+this.num;o.randSeed=g;if(!this.texture){var m=new BABYLON.CustomProceduralTexture("ham","./data/shaders/ham",128,this.scene);this.mesh.material.subMaterials[0].diffuseTexture=m,this.texture=m}if(this.isMenuItem||this.isMenuItem,!this.isMenuItem&&this.currentObject,this._initColors(),this.propsNeedToBeSaved=!1,this.texture&&(this.texture.setFloat("hasBelly",1),this.texture.setFloat("rand",this.rand),this.texture.setFloat("noiseMult",this.noiseMult),this.texture.setFloat("cheekX",this.cheekX),this.texture.setFloat("cheekY",this.cheekY),this.texture.setFloat("cheekBlur",this.cheekBlur),this.texture.setFloat("shaderTweak1",this.shaderTweak1),this.texture.setFloat("shaderTweak2",this.shaderTweak2),this.texture.setFloat("shaderTweak3",this.shaderTweak3),this.texture.setFloat("shaderTweak4",this.shaderTweak4),this._initProps()),this.texture&&this.texture.isReady()&&this.texture.render(),!this.isMenuItem&&datgui&&!this.test_controls_created){this.test_controls_created=!0;f=this}this.whiskers||(this.whiskers=new x.Whiskers(this,x.app.graphicsHelper.scene),this.whiskers.removeFromScene()),o.skipAddToScene},z1062.prototype.loadModel=function(){var t;t="hamster36_1";var e=new window[t].hamster("hamster"+this.num,this.scene,"./");z1062.mesh?e.skeleton=z1062.mesh.skeleton.clone("skeleton_"+e.id):z1062.mesh=e,e.rotationQuaternion=new BABYLON.Quaternion,this.rotationQuaternion=e.rotationQuaternion,e.shapeKeyGroups&&e.shapeKeyGroups.ENTIRE_MESH&&(this.eyeShapeKeyGroup=e.shapeKeyGroups.ENTIRE_MESH),(this.mesh=e).rotationQuaternion=new BABYLON.Quaternion;e.scaling.x=.5,e.scaling.y=.5,e.scaling.z=.5,this.bones.init(this,e.skeleton),this.initMaxStepHeight=.5*this.bones.legFL.bone1Len,this.maxStepHeight=this.initMaxStepHeight,this.maxStride=2.1*this.maxStepHeight;var o=new BABYLON.MultiMaterial(t+".Multimaterial#0",this.scene),i=this.scene.getMaterialByID(t+".Material").clone(t+".Material"+this.num);o.subMaterials[0]=i;var n=this.scene.getMaterialByID(t+".eye").clone(t+".eye"+this.num);(o.subMaterials[1]=n).specularPower=200,n.specularColor.r=1,n.specularColor.g=1,n.specularColor.b=1,n.diffuseColor.r=0,n.diffuseColor.g=0,n.diffuseColor.b=0,this.eyeMaterial=n,e.material=o;for(var s=0;s<e.subMeshes.length;s++)e.subMeshes[s].setBoundingInfo(new BABYLON.BoundingInfo(new BABYLON.Vector3(-4,-4,-4),new BABYLON.Vector3(4,4,4)))},z1062.prototype.update=function(){if(this.isOnScene){this.targets.onBeforeFrame(),v.prototype.update.call(this);var t=this.localPos,e=this.lastPos,o=t.x-e.x,i=t.y-e.y,n=t.z-e.z;this.measuredSpeed=Math.sqrt(o*o+i*i+n*n),e.copy(t),this.lastPosFront.copy(this.localPosFront),this.lastPosMid.copy(this.localPosMid),this.lastPosRear.copy(this.localPosRear);var s=this.targets,a=s.totUpVecTargets,r=s.lookToTargetOffset;r.x=0,r.y=0,r.z=0;var c=this.bones,d=this.physics,p=this.actionNames,l=this.log;c.beforeUpdate(),p&&(p.length=0,p.push("**** "+this.id+" ****")),l&&(l.length=0),this.hsm;for(var u=0;u<this.hsm.length;u++){this.currentHSM=this.hsm[u];for(var y=this.hsm[u].update().actions,g=0;g<y.length;g++){var m=y.getAtIndex(g);(this.currentz767=m).update(this)}if(this.currentz767=null,this.currentHSM=null,p)for(var f=this.hsm[u];f&&(p.push("*** "+f.name+" ***"),f!=f.currentState);)f=f.currentState}this.whiskers&&this.whiskers.update(),c.skeleton._markAsDirty(),d.update(),this.targets.minStandY=this.physics.rearBody.body.position.y-this.size,this.targets.minStandYFront=this.physics.rearBody.body.position.y-this.size,this.forceStand=!1,this.frameNum++,this.position.x=this.mesh.position.x,this.position.y=this.mesh.position.y,this.position.z=this.mesh.position.z,s.numUpVecTargets=0,a.x=0,a.y=0,a.z=0,this.avoidForce*=.8*this.adjustLerp;var A=x.app.frameNum;if(this.eyeShapeKeyGroup){var b=this.eyesCloseLerp;A>=this._nextBlinkFrame&&A<=this._nextBlinkFrame+4&&(b=this.eyesBlinkLerp),this._nextBlinkFrame==A?(this._eyesCloseAmountBlink=this.eyesCloseAmount,this.eyesCloseAmount=1):this._nextBlinkFrame+4<A&&(this.eyesCloseAmount=1,this._nextBlinkFrame=A+this._minFramesToNextBlink+Math.floor((this._maxFramesToNextBlink-this._minFramesToNextBlink)*Math.random()),this.eyesCloseAmount=this._eyesCloseAmountBlink),this.eyeShapeKeyGroup.shapeKeys.EYES_CLOSED.value=z1.lerpNumber(this.eyeShapeKeyGroup.shapeKeys.EYES_CLOSED.value,this.eyesCloseAmount,b*this.adjustLerp)}this.physics.beforeWorldUpdate(),this.translated.x=0,this.translated.y=0,this.translated.z=0,this.avoidingObject&&(this.avoidingObject=null,this.targets.setTargetsToDestination()),0==this.walkForce&&(this.walkForce0FrameNum=x.app.frameNum),this.physics.hitTracker&&this.physics.hitTracker.clearHits(),this.isOnWheel=!1}},z1062.prototype.setEyesCloseAmount=function(t){this.eyesCloseAmount=t},z1062.prototype.translate=function(t,e,o){this.translated.x+=t,this.translated.y+=e,this.translated.z+=o,this.physics.translate(t,e,o),this.bones.translate(t,e,o),this.alignMeshWithBody()},z1062.prototype.recycle=function(){if(this._timeOutIDs)for(var t=0;t<this._timeOutIDs.length;t++)clearTimeout(this._timeOutIDs[t]);this.eyesCloseAmount=0,this.eyeShapeKeyGroup.shapeKeys.EYES_CLOSED.value=0,v.prototype.recycle.call(this)},z1062.prototype.getMeshAbsolutePositionFromLocalToRef=function(t,e){BABYLON.Vector3.TransformCoordinatesToRef(t,this.mesh.getWorldMatrix(),e)},z1062.prototype.isUnderBedding=function(){var t=this.currentObject;if(t)return t.parent&&(t=t.parent),!!t.bedding&&(-1<t.bedding.hams.indexOf(this)||void 0)},z1062.prototype.addFoodToPouch=function(t){if(-1===this.pouchedFood.indexOf(t))return t.pouchSide<0?this._numPouchedFoodLeft++:0<t.pouchSide?this._numPouchedFoodRight++:t.pouchSide,this.pouchedFood.push(t),t.pouchSide},z1062.prototype.removeFoodFromPouch=function(){if(0!=this.pouchedFood.length){var t=this.pouchedFood.pop();return 0<t.pouchSide?this._numPouchedFoodRight--:t.pouchSide<0&&this._numPouchedFoodLeft--,t}},z1062.prototype.hasRoomInPouch=function(){var t=!1;return(this.pouchFilledFracRight<1||this.pouchFilledFracLeft<1)&&(t=!0),t},z1062.prototype.getOtherHamInFront=function(){if(this._otherHamInFront&&x.app.frameNum-this._otherHamInFrontFrameNum<30)return this._otherHamInFront;var t=z1062.activeObjects;if(1==t.length)return null;var e=this.cage,o=z1062.z4[0],i=z1062.z4[1];i.x=1,i.y=0,i.z=0,this.bones.hip.bone.getDirectionToRef(i,this.mesh,i);for(var n=this.position,s=0;s<t.length;s++){var a=t[s];if(a!=this)if(a.cage==e)if(o.x=a.position.x-n.x,o.y=a.position.y-n.y,o.z=a.position.z-n.z,0<BABYLON.Vector3.Dot(o,i))return this._otherHamInFrontFrameNum=x.app.frameNum,this._otherHamInFront=a}return null},z1062.prototype._initColors=function(){for(var t in this._colors){var e=this._colors[t];"eyes"==t?(this.eyeMaterial.diffuseColor.r=e.x,this.eyeMaterial.diffuseColor.g=e.y,this.eyeMaterial.diffuseColor.b=e.z):this.texture&&(this.texture.setVector3(t+"Color",e),this.texture.resetRefreshCounter())}},z1062.prototype.setColor=function(t,e,o,i){if(i&&this._colors){var n=this._colors[i];n.x==t&&n.y==e&&n.z==o||(n.x=t,n.y=e,n.z=o,"eyes"==i?(this.eyeMaterial.diffuseColor.r=t,this.eyeMaterial.diffuseColor.g=e,this.eyeMaterial.diffuseColor.b=o):this.texture&&(this.texture.setVector3(i+"Color",n),this.texture.resetRefreshCounter()),this.propsNeedToBeSaved=!0,this.onChangeObservable.notifyObservers(this))}},z1062.prototype.isFacingBowl=function(t){var e=x.app.frameNum;return e==this._isFacingBowlFrameNum&&this._isFacingBowlBowl==t||(this._isFacingBowlBowl=t,this._isFacingBowl=t.isBodyFacing(this.physics.middleBody,.3),this._isFacingBowlFrameNum=e),this._isFacingBowl},z1062.prototype.reset=function(){this.setEyesCloseAmount(0),this.eyesCloseLerp=.3,this.eyesBlinkLerp=.5,v.prototype.reset.call(this)},z1062.prototype.chooseABed=function(){var t,e,o=this.memory;if(!o.bed){var i=o.getAccessories(x.z1044.z1057),n=o.getPositions(x.z1044.z1057);if(i&&0!=i.length){var s=z1062.tempArray,a=z1062.tempArray2;s.length=0;for(var r=a.length=0;r<i.length;r++){(c=i[r])&&c.parent&&(c.parent.bedding&&!c.owner&&(s.push(c),a.push(n[r])))}if(0==a.length)for(r=0;r<i.length;r++){(c=i[r])&&(c.owner||(s.push(c),a.push(n[r])))}if(0==a.length)for(r=0;r<i.length;r++){var c;(c=i[r])&&(s.push(c),a.push(n[r]))}if(0<s.length){var d=Math.floor(s.length*Math.random());t=s[d],e=a[d]}t&&(o.bed=t,o.bedPos.copyFrom(e))}}},z1062.count=0,z1062}(x.z1061);x.z1062=t}(z0||(z0={})),function(e){var t=function(){function z1062Config(){this.objName="h",e.z1062.objectCount=10}return z1062Config.prototype.initObjectPool=function(t){ObjectPool.addClass(this.objName,e.z1062,{shapeName:this.objName,world:t,x:0,y:0,ry:Math.PI,c:"#EC7600FF,#000000FF,#EC7600FF,#EC7600FF",o:"c1,c2,cf,sn,ch,be"})},z1062Config.prototype.getz1064Items=function(t){t.push(new e.MenuItemInfo({id:this.objName,objectName:this.objName,category:"Hams",offsetY:-.3,offsetZ:0,offsetX:-.4,menuWidth:1.5,menuHeight:2.5,transNodeScale:2.5,countLabelX:0,countLabelY:-.7,createBodyContainer:!0}))},z1062Config.prototype.getz49s=function(t){t.push(e.z69),t.push(e.z68)},z1062Config.prototype.getListenerSetups=function(t){t.push({event:e.z1061Events.DRAG,state:e.z69})},z1062Config.objName="h",z1062Config}();e.z1062Config=t,e.App.AddEntityConfig(new t)}(z0||(z0={})),function(t){var e=function(){function z1061Events(){}return z1061Events.WALK=t.AppEvents.GetUniqueID(),z1061Events.DRAG=t.AppEvents.GetUniqueID(),z1061Events.DROP=t.AppEvents.GetUniqueID(),z1061Events.NEW_PATH_NODE=t.AppEvents.GetUniqueID(),z1061Events.END_PATH=t.AppEvents.GetUniqueID(),z1061Events.NEW_PATH=t.AppEvents.GetUniqueID(),z1061Events.REACHED_DESTINATION=t.AppEvents.GetUniqueID(),z1061Events}();t.z1061Events=e}(z0||(z0={})),function(t){var e=function(){function Level(t,e,o){void 0===e&&(e=1e3),void 0===o&&(o=0),this.name="",this._value=0,this.maxValue=1e3,this.stepValue=0,this.lowValue=100,this.debug=!1,this.name=t,this.maxValue=e,this.stepValue=o}return Object.defineProperty(Level.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t},enumerable:!1,configurable:!0}),Level.prototype.step=function(t){t||(t=this.stepValue),this._value<0&&0<t&&(this._value=0),this._value+=t,this.pubsub&&(this.pubsub.broadcast(Level.EVENT_CHANGE,this),this._value<this.lowValue?this.pubsub.broadcast(Level.EVENT_LOW,this):this._value<=0&&this.pubsub.broadcast(Level.EVENT_EMPTY,this)),this._value>this.maxValue&&(this._value=this.maxValue)},Level.prototype.resetRandom=function(t,e){void 0===t&&(t=1),void 0===e&&(e=1);var o=this.lowValue*t,i=this.maxValue*e;this.value=o+Math.random()*(i-o)},Level.prototype.subscribe=function(t,e,o){this.pubsub||(this.pubsub=new Pubsub),this.pubsub.subscribe(t,e,o)},Level.prototype.getPercentFull=function(){return this._value/this.maxValue*100},Level.EVENT_EMPTY=1,Level.EVENT_LOW=2,Level.EVENT_FULL=3,Level.EVENT_CHANGE=4,Level}();t.Level=e;var o=function(){function z1061Levels(){this.sleep=new e("sleep",2e4,-1),this.food=new e("food",1e3,-.15),this.water=new e("water",1e3,-.1),this.clean=new e("clean",1e3,-1),this.chew=new e("chew",1e3,-.3),this.scratch=new e("scratch",1e3,-.3),this.dig=new e("dig",1e3,-.3),this.home=new e("home",1e3,-.3),this.wheel=new e("wheel",1e3,-.3),this.bridge=new e("bridge",1e3,-.3),this.swing=new e("swing",1e3,-.3),this.attention=new e("attention",1e3,-.3)}return z1061Levels.prototype.init=function(t){this.sleep.value=this.sleep.maxValue,this.food.value=this.food.maxValue*Math.random()*.5,this.water.value=this.water.maxValue*Math.random(),this.clean.value=this.clean.maxValue,this.chew.value=this.chew.maxValue*Math.random(),this.attention.value=this.attention.maxValue,this.scratch.value=this.scratch.maxValue*Math.random(),this.dig.value=this.dig.maxValue*Math.random(),this.home.value=this.home.maxValue*Math.random(),this.wheel.value=this.wheel.maxValue*Math.random(),this.bridge.value=this.bridge.maxValue*Math.random(),this.swing.value=this.swing.maxValue*Math.random(),this.sleep.value=this.sleep.maxValue*Math.random()*.4+.6*this.sleep.maxValue,this.sleep.lowValue=.5*this.sleep.maxValue,this.sleep.rodent=t,this.food.rodent=t,this.water.rodent=t,this.clean.rodent=t,this.chew.rodent=t,this.attention.rodent=t,this.scratch.rodent=t,this.dig.rodent=t,this.home.rodent=t,this.wheel.rodent=t,this.bridge.rodent=t,this.swing.rodent=t,this.rodent=t},z1061Levels.prototype.update=function(){t.app.frameNum%2==0&&(this.food.step(),this.clean.step(),this.chew.step(),this.water.step(),this.sleep.step(),this.scratch.step(),this.dig.step(),this.home.step(),this.wheel.step(),this.bridge.step(),this.swing.step())},z1061Levels.prototype.createGUI=function(t){},z1061Levels}();t.z1061Levels=o}(z0||(z0={})),function(a){var t=function(){function z1061Memory(){this.accs=[],this.bedPos=BABYLON.Vector3.Zero(),this.accToLoad=[a.WaterBottle,a.Wheel,a.Bowl,a.Cage,a.Bedding,a.Bed,a.SimpleChew,a.HangingChew,a.House,a.Swing],this.accTypes=[a.z1044.z1056,a.z1044.z1054,a.z1044.z1045,a.z1044.z1048,a.z1044.z1047,a.z1044.z1057,a.z1044.z1058,a.z1044.z1059,a.z1044.z1055,a.z1044.SWING],this.accTypeToAdd=a.z1044.z1056|a.z1044.z1054|a.z1044.z1045|a.z1044.z1048|a.z1044.z1047|a.z1044.z1057|a.z1044.z1058|a.z1044.z1059|a.z1044.z1055|a.z1044.SWING,this._path=[]}return z1061Memory.subscribe=function(t,e,o){z1061Memory.pubsub.subscribe(t,e,o)},z1061Memory.prototype.addArray=function(t){for(var e=0;e<t.length;e++)this.add(t[e])},z1061Memory.prototype._addPos=function(t,e){var o=ObjectPool.get("BABYLON.Vector3");o.copyFrom(e);var i=this.accs[t+1];i.length,i.push(o),a.z1044.z1057},z1061Memory.prototype._addAcc=function(t){var e=this.accs[t.accType];e.length,e.push(t),t.accType==a.z1044.z1057&&t.accType},z1061Memory.prototype.add=function(t,e){if(this.accTypeToAdd&t.accType){t.accType,a.z1044.z1057;var o=this.accs[t.accType],i=this.accs[t.accType+1];o||(o=[],i=[],this.accs[t.accType]=o,this.accs[t.accType+1]=i),-1==o.indexOf(t)&&(this._addAcc(t),t.position.z<-3&&t.position,e||(e=t.position),this._addPos(t.accType,e),z1061Memory.pubsub.broadcast(z1061Memory.EVENT_ADDED,t,this.rodent))}},z1061Memory.prototype.getAccessories=function(t){return this.accs[t]},z1061Memory.prototype.getPositions=function(t){return this.accs[t+1]},z1061Memory.prototype.remove=function(t){if(this.accTypeToAdd&t.accType){var e=this.accs[t.accType],o=this.accs[t.accType+1],i=e.indexOf(t);if(-1!=i){e.splice(i,1);var n=o.splice(i,1);ObjectPool.recycle(n),z1061Memory.pubsub.broadcast(z1061Memory.EVENT_REMOVED,t,this.rodent)}}},z1061Memory.prototype.load=function(){this.erase();for(var t=this.rodent,e=0;e<this.accToLoad.length;e++){var o=this.accToLoad[e].activeObjects;this.accToLoad[e],a.Swing;for(var i=0;i<o.length;i++){var n=o[i];if(!n.isMenuItem){var s=n.position;n.cage==t.cage?this.add(n):(t.getPathToRef(s,this._path,n),0<this._path.length&&this.add(n))}}}},z1061Memory.prototype.erase=function(){for(var t=0;t<this.accTypes.length;t++){var e=this.accTypes[t];if(this.accs[e]){this.accs[e].length=0;for(var o=this.accs[e+1],i=0;i<o.length;i++)ObjectPool.recycle(o[i]);o.length=0}}},z1061Memory.EVENT_ADDED=1,z1061Memory.EVENT_REMOVED=2,z1061Memory.pubsub=new Pubsub,z1061Memory}();a.z1061Memory=t}(z0||(z0={})),function(t){var e=function(){function z1061Targets(){this.pointerDownPosition=new z1085(0,0,0,!1),this.lastFramePointerMoved=0,this.point1=new z1085(0,0,0,!0),this.point2=new z1085,this.destinations=[],this.destTarget=new z1085(0,0,0,!1),this.pathTarget=new z1085(0,0,0,!1),this.avoidTarget=new z1085(0,0,0),this.currentTarget=new z1085(0,0,0),this.moveToTarget=new z1085(0,0,0,!1),this.lookToTarget=new z1085(0,0,0,!1),this.lookToTargetOffset=BABYLON.Vector3.Zero(),this.lookToTargetOffset2=BABYLON.Vector3.Zero(),this.standToTarget=new z1085(0,0,0,!1),this.standToTargetFront=new z1085(0,0,0),this.standHeight=new SmartNumber(.4,.5),this.standDownFrac=.2,this.startPos=new z1085(0,0,0),this.midHandTarget=new z1085,this.dirTarget=new z1085(0,0,0,!1),this.targetDir=new z1085(0,0,0,!1),this.turnDir=1,this.wheelDir=1,this.upVecTarget=new OIMO.Vec3(0,1,0),this.lastUpVecTarget=new OIMO.Vec3,this.totUpVecTargets=new OIMO.Vec3,this.numUpVecTargets=0,this.rollAngToUp=0,this.otherTarget=new z1085,this.targetNum1=0,this.targetNum2=0,this.randAng=Math.random()*Math.PI*2,this._pathNodeHitDist=0,this.moveTargetLoweredFrameNum=0,this.upSlopeVec=new OIMO.Vec3,this.lastMoveTarget=new OIMO.Vec3,this.lastDestTarget=new OIMO.Vec3,this.lastPoseStandFrame=-999,this.limitTurnStandAtDot=.5,this.nextFrameTarget=0,this.destTarget.registerCallback(this._onDestTargetSet,this),this.pathTarget.registerCallback(this._onPathTargetSet,this),this.avoidTarget.registerCallback(this._onAvoidTargetSet,this),this.standToTarget.registerCallback(this._onStandToTargetSet,this),this.setTargetsToDestinationBinded=this.setTargetsToDestination.bind(this)}return Object.defineProperty(z1061Targets.prototype,"pathNodeHitDist",{get:function(){return this._pathNodeHitDist},set:function(t){this._pathNodeHitDist=t},enumerable:!1,configurable:!0}),z1061Targets.prototype.reset=function(){this.otherz1062=null,this.startPos.x=0,this.startPos.y=0,this.startPos.z=0,this.pointerDownPosition.x=0,this.pointerDownPosition.y=0,this.pointerDownPosition.z=0,this.point1.x=0,this.point1.y=0,this.point1.z=0,this.point2.x=0,this.point2.y=0,this.point2.z=0,this.destTarget.x=0,this.destTarget.y=0,this.destTarget.z=0,this.pathTarget.x=0,this.pathTarget.y=0,this.pathTarget.z=0,this.avoidTarget.x=0,this.avoidTarget.y=0,this.avoidTarget.z=0,this.currentTarget.x=0,this.currentTarget.y=0,this.currentTarget.z=0,this.moveToTarget.x=0,this.moveToTarget.y=0,this.moveToTarget.z=0,this.lookToTarget.x=0,this.lookToTarget.y=0,this.lookToTarget.z=0,this.lookToTargetOffset.x=0,this.lookToTargetOffset.y=0,this.lookToTargetOffset.z=0,this.standToTarget.x=0,this.standToTarget.y=0,this.standToTarget.z=0,this.standToTargetFront.x=0,this.standToTargetFront.y=0,this.standToTargetFront.z=0,this._minStandY=0,this.minStandYFront=0,this.midHandTarget.x=0,this.midHandTarget.y=0,this.midHandTarget.z=0,this.dirTarget.x=0,this.dirTarget.y=0,this.dirTarget.z=0,this.targetDir.x=0,this.targetDir.y=0,this.targetDir.z=0,this.turnDir=1,this.wheelDir=1,this.upVecTarget.x=0,this.upVecTarget.y=1,this.upVecTarget.z=0,this.lastUpVecTarget.x=0,this.lastUpVecTarget.y=0,this.lastUpVecTarget.z=0,this.totUpVecTargets.x=0,this.totUpVecTargets.y=0,this.totUpVecTargets.z=0,this.numUpVecTargets=0,this.rollAngToUp=0,this.pathNodeHitDist=0,this.upSlopeVec.x=0,this.upSlopeVec.y=0,this.upSlopeVec.z=0,this.limitTurnStandAtDot=.5},Object.defineProperty(z1061Targets.prototype,"minStandY",{get:function(){return this._minStandY},set:function(t){this._minStandY=t,this.minStandYFront=t},enumerable:!1,configurable:!0}),z1061Targets.prototype.translateTargets=function(){},z1061Targets.prototype._onDestTargetSet=function(){this.pathTarget.copyFrom(this.destTarget,!0),this.avoidTarget.copyFrom(this.destTarget,!0),this.currentTarget.copyFrom(this.destTarget,!0)},z1061Targets.prototype._onPathTargetSet=function(){this.avoidTarget.copyFrom(this.avoidTarget,!0),this.currentTarget.copyFrom(this.pathTarget,!0)},z1061Targets.prototype._onAvoidTargetSet=function(){this.currentTarget.copyFrom(this.avoidTarget,!0)},z1061Targets.prototype._onStandToTargetSet=function(){this.standToTargetFront.copyFrom(this.standToTarget,!0)},z1061Targets.prototype.setTargetsToDestination=function(){this.lookToTarget.copyFrom(this.destTarget),this.standToTarget.copyFrom(this.destTarget),this.moveToTarget.copyFrom(this.destTarget)},z1061Targets.prototype.setTargetsToPathTarget=function(){this.lookToTarget.copyFrom(this.pathTarget),this.standToTarget.copyFrom(this.pathTarget),this.moveToTarget.copyFrom(this.pathTarget)},z1061Targets.prototype.onBeforeFrame=function(){this.moveToTarget.updatePrev(),this.lookToTarget.updatePrev(),this.standToTarget.updatePrev(),this.standToTargetFront.updatePrev(),this.standHeight.update()},z1061Targets.prototype.addToDestinations=function(t,e,o){var i=this.destinations[this.destinations.length-1];if(!i||i.x!=t||i.y!=e||i.z!=o){var n=ObjectPool.get("BABYLON.Vector3");n.x=t,n.y=e,n.z=o,this.destinations.push(n),1==this.destinations.length&&this.pointerDownPosition.copyFrom(n)}},z1061Targets.prototype.setNextDestination=function(){var t=this.destinations[0],e=this.pointerDownPosition;if(t){if(t.x==e.x&&t.y==e.y&&t.z==e.z&&(ObjectPool.recycle(t),this.destinations.shift(),!(t=this.destinations[0])))return;e.copyFrom(t)}},z1061Targets._tempVec=new OIMO.Vec3(0,0,0),z1061Targets}();t.z1061Targets=e}(z0||(z0={})),function(A){var t,e;t=A.z156||(A.z156={}),e=function(t){function z709(){return null!==t&&t.apply(this,arguments)||this}return __extends(z709,t),z709.prototype.update=function(t){if(t.physics.touchingAccTypes&A.z1044.z1049){for(var e,o=t.physics.touchingShapes,i=0;i<o.length;i++){var n=o.data.data[i].entity;if(n.accType==A.z1044.z1049){e=n;break}}if(e){var s=t.size,a=e.position.x-.5*e.width+s,r=e.position.x+.5*e.width-s,c=t.physics.headBody,d=t.physics.frontBody,p=t.physics.middleBody,l=t.physics.rearBody,u=c.body.position,y=d.body.position,g=p.body.position,m=l.body.position,f=e.position.y;u.y>f&&y.y>f&&g.y>f&&m.y>f||u.y<f&&y.y<f&&g.y<f&&m.y<f||u.x<a||u.x>r||y.x<a&&y.x>r||g.x<a&&g.x>r||m.x<a&&m.x>r||(u.y<f&&c.setPosition(u.x,f+s,u.z),y.y<f&&d.setPosition(y.x,f+s,y.z),g.y<f&&p.setPosition(g.x,f+s,g.z),m.y<f&&l.setPosition(m.x,f+s,m.z))}}},z709}(z767),t.z709=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z684(){return null!==t&&t.apply(this,arguments)||this}return __extends(z684,t),z684.prototype.update=function(t){t.targets.limitTurnStandAtDot=1},z684}(z767),e.z684=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z681(){return null!==t&&t.apply(this,arguments)||this}return __extends(z681,t),z681.prototype.update=function(t){z1.lerpVec3ToRef(t.targets.destTarget,t.targets.point1,.05,t.targets.destTarget),t.targets.setTargetsToDestination();var e=t.physics.headBody.body.position;t.targets.lookToTarget.y-=.4,t.targets.lookToTarget.y<e.y&&(t.targets.lookToTarget.y=e.y)},z681}(z767),e.z681=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z510(){return null!==t&&t.apply(this,arguments)||this}return __extends(z510,t),z510.prototype.update=function(t){t.targetObject&&t.memory.remove(t.targetObject)},z510}(z767),e.z510=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z344(){return null!==t&&t.apply(this,arguments)||this}return __extends(z344,t),z344.prototype.update=function(t){if(t.currentHSM.currentState.currentState){var e=100*Math.random()+100;t.currentHSM.currentState.currentState.maxFramesInState=e}},z344}(z767),e.z344=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z343(){return null!==t&&t.apply(this,arguments)||this}return __extends(z343,t),z343.prototype.update=function(t){if(t.currentHSM.currentState.currentState){t.currentHSM.currentState.currentState.maxFramesInState=200}},z343}(z767),e.z343=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z342(){return null!==t&&t.apply(this,arguments)||this}return __extends(z342,t),z342.prototype.update=function(t){if(t.currentHSM.currentState.currentState){var e=500*Math.random()+500;t.currentHSM.currentState.currentState.maxFramesInState=e}},z342}(z767),e.z342=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z341(){return null!==t&&t.apply(this,arguments)||this}return __extends(z341,t),z341.prototype.update=function(t,e){if(t.currentHSM.currentState.currentState&&t.currentHSM.currentState.currentState.currentState){var o=500*Math.random()+500;t.currentHSM.currentState.currentState.currentState.maxFramesInState=o}},z341}(z767),e.z341=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z340(){return null!==t&&t.apply(this,arguments)||this}return __extends(z340,t),z340.prototype.update=function(t,e){if(t.currentHSM.currentState){var o=500*Math.random()+500;t.currentHSM.currentState.maxFramesInState=o}},z340}(z767),e.z340=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z268(){return null!==t&&t.apply(this,arguments)||this}return __extends(z268,t),z268.prototype.update=function(t){t.targets.targetNum1=Math.ceil(200*Math.random()+100)},z268}(z767),e.z268=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z267(){return null!==t&&t.apply(this,arguments)||this}return __extends(z267,t),z267.prototype.update=function(t){t.targets.targetNum1=Math.ceil(120*Math.random()+120)},z267}(z767),e.z267=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z266(){return null!==t&&t.apply(this,arguments)||this}return __extends(z266,t),z266.prototype.update=function(t){t.targets.targetNum1=Math.ceil(120*Math.random()+180)},z266}(z767),e.z266=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z265(){return null!==t&&t.apply(this,arguments)||this}return __extends(z265,t),z265.prototype.update=function(t){t.targets.targetNum1=Math.ceil(300*Math.random()+300)},z265}(z767),e.z265=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z264(){return null!==t&&t.apply(this,arguments)||this}return __extends(z264,t),z264.prototype.update=function(t){t.targets.targetNum1=Math.ceil(60*Math.random()+30)},z264}(z767),e.z264=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z263(){return null!==t&&t.apply(this,arguments)||this}return __extends(z263,t),z263.prototype.update=function(t){t.targets.targetNum1=Math.ceil(120*Math.random()+60)},z263}(z767),e.z263=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z262(){return null!==t&&t.apply(this,arguments)||this}return __extends(z262,t),z262.prototype.update=function(t){t.targets.targetNum2=Math.ceil(200*Math.random()+100)},z262}(z767),e.z262=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z261(){return null!==t&&t.apply(this,arguments)||this}return __extends(z261,t),z261.prototype.update=function(t){t.targets.targetNum2=Math.ceil(150*Math.random()+30)},z261}(z767),e.z261=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z306(){return null!==t&&t.apply(this,arguments)||this}return __extends(z306,t),z306.prototype.update=function(t){var e=z767.z4[0];e.x=1,e.y=2,e.z=0,t.bones.hip.bone.getAbsolutePositionFromLocalToRef(e,t.mesh,e);var o=t.cage;if(o&&o.right){var i=o.right-.5,n=o.left+.5,s=o.back-1,a=o.front+.5;e.x>i&&(e.x=i),e.x<n&&(e.x=n),e.z>s&&(e.z=s),e.z<a&&(e.z=a),t.targets.point1.copyFrom(e)}},z306}(z767),e.z306=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z726(){return null!==t&&t.apply(this,arguments)||this}return __extends(z726,t),z726.prototype.update=function(t){t.levels.attention.resetRandom(.5,1)},z726}(z767),e.z726=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z725(){return null!==t&&t.apply(this,arguments)||this}return __extends(z725,t),z725.prototype.update=function(t){t.levels.attention.resetRandom(.1,.3)},z725}(z767),e.z725=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z724(){return null!==t&&t.apply(this,arguments)||this}return __extends(z724,t),z724.prototype.update=function(t){t.levels.attention.step()},z724}(z767),e.z724=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z508(){return null!==t&&t.apply(this,arguments)||this}return __extends(z508,t),z508.prototype.update=function(t){t.hsm,t.currentObject,t.usingObject,t.id;var e=t.levels;e.chew.value=e.chew.maxValue*Math.random(),e.home.value=e.home.maxValue*Math.random(),e.wheel.value=e.wheel.maxValue*Math.random(),e.bridge.value=e.bridge.maxValue*Math.random(),e.swing.value=e.swing.maxValue*Math.random(),e.food.value=e.food.maxValue*Math.random(),e.water.value=e.water.maxValue*Math.random()},z508}(z767),e.z508=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z450(){return null!==t&&t.apply(this,arguments)||this}return __extends(z450,t),z450.prototype.update=function(t){t.levels.scratch.step(1)},z450}(z767),e.z450=o}(z0||(z0={})),function(pt){var t,e;t=pt.z156||(pt.z156={}),e=function(e){function z590(){var t=null!==e&&e.apply(this,arguments)||this;return t.lookBehindOverlap=.33,t.skipLook=!1,t.maxYawDiff=.3*Math.PI,t.TEST_LOOK_SKIP_1=!1,t.TEST_MAX_ROT_ANG=.25*Math.PI,t}return __extends(z590,e),z590.prototype.update=function(t){var e=t.targets.lookToTarget,o=t.targets.upVecTarget,i=t.bones.head;if(!this.skipLook){var n=t.physics.headBody.body,s=t.physics.frontBody.body,a=z767.tempVecs[0],r=z767.tempVecs[1],c=z767.tempVecs[2],d=z767.tempVecs[3],p=z767.tempVecs[4],l=z767.tempVecs[5],u=z767.tempVecs[6],y=t.physics.frontBody.rotationElements;if(p.x=y[0],p.y=y[3],p.z=y[6],l.x=y[1],l.y=y[4],l.z=y[7],u.x=y[2],u.y=y[5],u.z=y[8],!this.TEST_LOOK_SKIP_1&&t.standing&&(p.cross(u,o),p.normalize(p),l.x=o.x,l.y=o.y,l.z=o.z,u.cross(l,p),0<i.pitch)){var g=z767.tempBabMats[0],m=i.pitch,f=this.TEST_MAX_ROT_ANG;f<m&&(m=f),z1.RotationAxisToRef(p,m,g),z1.TransformNormalToRef(u,g,u),z1.TransformNormalToRef(l,g,l)}this.axesViewer&&this.axesViewer.update(t.physics.frontBody.body.position,p,l,u);var A=t.speed,b=e,v=t.targets.lookToTargetOffset,x=s.position,C=b.x+v.x-x.x,S=b.y+v.y-x.y,T=b.z+v.z-x.z,B=t.physics.frontBody.rotationElements,O=C*B[0]+S*B[3]+T*B[6],P=C*B[2]+S*B[5]+T*B[8];i.yawTar=Math.atan2(O,P);var M=t.physics.headBody.rotationElements,I=M[2],N=M[5],z=M[8],w=I,_=N,R=z,L=C*p.x+S*p.y+T*p.z,F=C*l.x+S*l.y+T*l.z,D=C*u.x+S*u.y+T*u.z,E=Math.atan2(L,D),k=E,j=w*p.x+_*p.y+R*p.z,V=w*u.x+_*u.y+R*u.z,G=Math.atan2(j,V),W=this.lookBehindOverlap;E<Math.PI-W&&0<=E&&1!=t.targets.turnDir?t.targets.turnDir=1:E>-(Math.PI-W)&&E<0&&-1!=t.targets.turnDir&&(t.targets.turnDir=-1),(E>G+Math.PI||E<G-Math.PI)&&(E=G+t.targets.turnDir*Math.PI*.75);var Y=.65*Math.PI,U=-1;(.8*Y<G||G<.8*-Y)&&(Y<E?E=Y:E<-Y&&(E=-Y));var X=z1.getAngDiff(E,G),Z=.3*Math.PI;if(Z<X?E=G+Z:X<-Z&&(E=G-Z),k!=E&&(U=Math.sqrt(L*L+D*D),L=Math.sin(E)*U,D=Math.cos(E)*U,C=L*p.x+F*l.x+D*u.x,S=L*p.y+F*l.y+D*u.y,T=L*p.z+F*l.z+D*u.z),!t.standing&&t.physics.frontBody.testCollidesWith(pt.App.PhysicsGroupBedding)){var q=this.maxYawDiff;(q<k||k<-q)&&(F=0,C=L*p.x+F*l.x+D*u.x,S=L*p.y+F*l.y+D*u.y,T=L*p.z+F*l.z+D*u.z)}a.x=I,a.y=N,a.z=z;var Q=r,J=d,K=c;J.x=C,J.y=S,J.z=T,J.normalize(J),K.cross(a,J),K.normalize(K),Q.cross(K,J);var $=a.x,tt=a.y,et=a.z,ot=$*Q.x+tt*Q.y+et*Q.z,it=$*J.x+tt*J.y+et*J.z,nt=Math.atan2(ot,it),st=.5*-(i.angToTar=nt),at=.01*Math.PI,rt=at+(.1*Math.PI-at)*A;rt<st?st=rt:st<-rt&&(st=-rt);var ht=n.angularVelocity;K.scaleEqual(62*st),r.sub(K,ht);var ct=150*t.size,dt=r.dot(r);t.isDragging&&(ct*=.5),ct*ct<dt&&(r.normalize(r),r.scaleEqual(ct)),ht.addEqual(r)}},z590}(z767),t.z590=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z587(){return null!==e&&e.apply(this,arguments)||this}return __extends(z587,e),z587.prototype.update=function(t){this.distAbove=.04,t.currentPickUpHand&&(this.distAbove=.08),e.prototype.update.call(this,t)},z587}(e.z588),e.z587=o}(z0||(z0={})),function(d){var t,e;t=d.z156||(d.z156={}),e=function(t){function z585(){return null!==t&&t.apply(this,arguments)||this}return __extends(z585,t),z585.prototype.update=function(t){var e;if(t.isFollowingPath()&&(null===(e=t.path[t.pathIndex])||void 0===e||!e.data.hitDist)){var o=t.targets.destTarget,i=t.targets.lookToTarget;if(!(o.equals(i)||10<t.path.length-t.path.length)){for(var n=t.pathIndex;n<t.path.length;n+=2){var s=t.path[n];if(!s)return;if(s.data.obj2&&(s.data.obj2.accType==d.z1044.z1046||s.data.obj2.accType==d.z1044.z1050||s.data.obj2.accType==d.z1044.z1049||s.data.obj2.accType==d.z1044.SWING))return}var a=t.cage;if(a&&a.isInBox(o.x,o.y,o.z)&&!(t.targets.destTarget.y<t.position.y&&t.platformUnder&&t.targets.destTarget.y<t.platformUnder.position.y)){var r=z767.z4[0],c=t.physics.frontBody.body.rotation.elements;r.x=c[2],r.y=c[5],r.z=c[8],BABYLON.Vector3.Dot(t.targets.dirTarget,r)<.5||(t.targetObject&&t.targetObject.targetPosition?i.copyFrom(t.targetObject.targetPosition):i.copyFrom(o))}}}},z585}(z767),t.z585=e}(z0||(z0={})),function(i){var t,e;t=i.z156||(i.z156={}),e=function(t){function z584(){return null!==t&&t.apply(this,arguments)||this}return __extends(z584,t),z584.prototype.update=function(t){var e=i.app.pointerDownPosition,o=t.targets.lookToTarget;o.x=e.x,o.y=e.y,o.z=e.z},z584}(z767),t.z584=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z582(){return null!==t&&t.apply(this,arguments)||this}return __extends(z582,t),z582.prototype.update=function(t){var e=t.targets,o=e.point1,i=e.destTarget;i.x=o.x,i.y=o.y,i.z=o.z},z582}(z767),e.z582=o}(z0||(z0={})),function(p){var t,e;t=p.z156||(p.z156={}),e=function(t){function z581(){return null!==t&&t.apply(this,arguments)||this}return __extends(z581,t),z581.prototype.update=function(t){if(!t.isMenuItem){if(p.app.pointerMoveIsBelowBedding)return;if(p.app.pointerMoveIsBelowBedding)return;if(!t.canSeePointerMove())return}var e=p.app.pointerMovePosition,o=t.targets.lookToTarget;if(o.x=e.x,o.y=e.y,o.z=e.z,t.isMenuItem){var i=p.app.graphicsHelper,n=t.mesh.parent,s=z767.z4[0],a=n.getWorldMatrix(),r=p.app.builder.pointerX,c=p.app.builder.pointerY;s.x=0,s.y=0,s.z=0,BABYLON.Vector3.TransformCoordinatesToRef(s,a,s),i.getPlanePositionAtScreenXY(r,c,s.z-1,s),o.copyFrom(s);var d=z767.tempBabMats[0];a.invertToRef(d),BABYLON.Vector3.TransformCoordinatesToRef(o,d,o)}},z581}(z767),t.z581=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z579(){return null!==t&&t.apply(this,arguments)||this}return __extends(z579,t),z579.prototype.update=function(t){var e=z767.z4[0];t.bones.hip.bone.getLocalPositionFromAbsoluteToRef(t.targets.lookToTarget,t.mesh,e);e.x+=1*(2*Math.random()-1),e.y+=1*(2*Math.random()-1),e.z+=1*(2*Math.random()-1);e.x<1&&(e.x=1),6<e.x&&(e.x=6);e.y<0&&(e.y=0),5<e.y&&(e.y=5);e.z<-10&&(e.z=-10),10<e.z&&(e.z=10),t.bones.hip.bone.getAbsolutePositionFromLocalToRef(e,t.mesh,t.targets.lookToTarget)},z579}(z767),e.z579=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z578(){return null!==t&&t.apply(this,arguments)||this}return __extends(z578,t),z578.prototype.update=function(t){var e=t.targets.lookToTarget,o=t.yieldingToOther;if(o){var i=o.physics.headBody.body.position;e.x=i.x,e.y=i.y,e.z=i.z}},z578}(z767),e.z578=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z358(){var t=null!==e&&e.apply(this,arguments)||this;return t.lookX=0,t.lookY=0,t.lookZ=0,t.fracHeight=0,t}return __extends(z358,e),z358.prototype.update=function(t){var e=t.targets.lookToTarget,o=t.bones.hip.bone,i=z767.z4[0],n=z767.z4[1],s=1/t.getScale(),a=t.size,r=3*a*t.getStandFrac()+2*a,c=4*a;i.x=c,i.y=r*this.fracHeight-a,i.z=0,i.x+=this.lookX,i.y+=this.lookY,i.z+=this.lookZ,i.x*=s,i.y*=s,i.z*=s;var d=t.bones.hip.pitch.value;d<0&&z1.RotatePoint2D(i,-d,i),o.getAbsolutePositionFromLocalToRef(i,t.mesh,n),e.copyFrom(n)},z358}(z767),e.z358=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z357(){return null!==t&&t.apply(this,arguments)||this}return __extends(z357,t),z357.prototype.update=function(t){t.setLocalTarget(.5,null,t.targets.lookToTarget)},z357}(z767),e.z357=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z355(){var t=e.call(this)||this;return t.fracHeight=1,t}return __extends(z355,e),z355}(e.z358),e.z355=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z354(){var t=e.call(this)||this;return t.fracHeight=0,t}return __extends(z354,e),z354.prototype.update=function(t){e.prototype.update.call(this,t)},z354}(e.z358),e.z354=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z353(){var t=e.call(this)||this;return t.fracHeight=.5,t}return __extends(z353,e),z353.prototype.update=function(t){e.prototype.update.call(this,t)},z353}(e.z358),e.z353=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z349(){var t=null!==e&&e.apply(this,arguments)||this;return t.skipLookNext=!1,t}return __extends(z349,e),z349.prototype.update=function(t){if(!this.skipLookNext){var e=t.path[t.pathIndex+1],o=t.path[t.pathIndex];e&&(t.targets.lookToTarget.x=o.x+.5*(e.x-o.x),t.targets.lookToTarget.y=o.y+.5*(e.y-o.y),t.targets.lookToTarget.z=o.z+.5*(e.z-o.z))}},z349}(z767),e.z349=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z346(){return null!==t&&t.apply(this,arguments)||this}return __extends(z346,t),z346.prototype.update=function(t){var e=t.targets.moveToTarget,o=t.targets.lookToTarget;o.x=e.x,o.y=e.y,o.z=e.z},z346}(z767),e.z346=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z282(){return null!==t&&t.apply(this,arguments)||this}return __extends(z282,t),z282.prototype.update=function(t){var e=t.targets.moveToTarget,o=t.targets.standToTarget;o.x=e.x,o.y=e.y,o.z=e.z},z282}(z767),e.z282=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z764(){return null!==t&&t.apply(this,arguments)||this}return __extends(z764,t),z764.prototype.update=function(t){t.smoothRandomNumber1.min=.3,t.smoothRandomNumber1.max=1,t.smoothRandomNumber1.speed=.3,t.smoothRandomNumber1.update();var e=.0015*Math.sin(.4*t.frameNum)*t.smoothRandomNumber1.value;t.bones.spine2.offsetPos.y=e},z764}(z767),e.z764=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z749(){return null!==t&&t.apply(this,arguments)||this}return __extends(z749,t),z749.prototype.update=function(t){var e=t.bones.legFL,o=t.bones.legFR,i=t.physics.frontBody.body,n=i.rotation.elements,s=8*-(Math.min(e.moveX,0)+Math.min(o.moveX,0));i.linearVelocity.x+=n[2]*s,i.linearVelocity.y+=n[5]*s,i.linearVelocity.z+=n[8]*s,t.walkForce=s},z749}(z767),e.z749=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z748(){return null!==t&&t.apply(this,arguments)||this}return __extends(z748,t),z748.prototype.update=function(t){var e=t.bones.legRL,o=t.bones.legRR,i=4*-(Math.min(e.moveX,0)+Math.min(o.moveX,0)),n=t.physics.frontBody.body,s=n.rotation.elements;n.linearVelocity.x+=s[2]*i,n.linearVelocity.y+=s[5]*i,n.linearVelocity.z+=s[8]*i,i=2*-(Math.min(e.moveY,0)+Math.min(o.moveY,0)),s=(n=t.physics.rearBody.body).rotation.elements,n.linearVelocity.x+=s[1]*i,n.linearVelocity.y+=s[4]*i,n.linearVelocity.z+=s[7]*i,t.walkForce=i},z748}(z767),e.z748=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z746(){return null!==t&&t.apply(this,arguments)||this}return __extends(z746,t),z746.prototype.update=function(t){if(t.isTouchingGround()){var e=t.bones.legFL,o=t.bones.legFR,i=4,n=t.getBeddingHeightFront();t.physics.frontBody.body.position.y>n&&(i=.5);var s=(Math.max(e.moveY,0)+Math.max(o.moveY,0))*i;t.physics.middleBody.body.linearVelocity.y+=s}},z746}(z767),e.z746=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z745(){return null!==t&&t.apply(this,arguments)||this}return __extends(z745,t),z745.prototype.update=function(t){if(t.isTouchingGround()){var e=t.bones.legRL,o=t.bones.legRR,i=2*(Math.max(e.moveY,0)+Math.max(o.moveY,0));t.physics.rearBody.body.linearVelocity.y+=i}},z745}(z767),e.z745=o}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z720(){return null!==t&&t.apply(this,arguments)||this}return __extends(z720,t),z720.prototype.update=function(t){t.pubsub.broadcast(e.z1061Events.WALK)},z720}(z767),t.z720=o}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z702(){return null!==t&&t.apply(this,arguments)||this}return __extends(z702,t),z702.prototype.update=function(t){if(!t.isFollowingPath()){var e=o.app.frameNum-1;t.targets.moveTargetLoweredFrameNum==e?t.targets.setTargetsToDestination():(t.standDown||t._standDownFrameNum!=e)&&(t.standing||t._standFrameNum!=e)||t.targets.setTargetsToDestination()}},z702}(z767),t.z702=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z687(){return null!==t&&t.apply(this,arguments)||this}return __extends(z687,t),z687.prototype.update=function(t){t.computeBodyStandAngs()},z687}(z767),e.z687=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z599(){return null!==t&&t.apply(this,arguments)||this}return __extends(z599,t),z599.prototype.update=function(t){t.initBodyStandAngs()},z599}(z767),e.z599=o}(z0||(z0={})),function(u){var t,e;t=u.z156||(u.z156={}),e=function(e){function z634(){var t=null!==e&&e.apply(this,arguments)||this;return t.TEST_DIST_3=.2,t.TEST_DIST_4=.4,t.TEST_DIST_5=.4,t}return __extends(z634,e),z634.prototype.update=function(t){if(!t.isFollowingPath()){var e=t.targets.destTarget,o=t.targets.moveToTarget,i=t.targets.lookToTarget,n=t.currentObject;if(n){n.parent&&(n=n.parent);var s=t.physics.rearBody.body.position,a=e.x-s.x,r=e.z-s.z,c=a*a+r*r,d=t.minStandDist+this.TEST_DIST_3;if(!(c<d*d)){var p=n.getPlatformUnder(s.x,s.y,s.z),l=e.y;l=p?p.position.y+this.TEST_DIST_4:n.getHeightAt(e.x,e.y)+this.TEST_DIST_4,o.y>l&&(o.y=l,t.targets.moveTargetLoweredFrameNum=u.app.frameNum),i.y-s.y>this.TEST_DIST_5&&(i.y=s.y+this.TEST_DIST_5)}}}},z634}(z767),t.z634=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z631(){var t=null!==e&&e.apply(this,arguments)||this;return t.TEST_DIST_1=.14,t.TEST_DIST_2=.14,t}return __extends(z631,e),z631.prototype.update=function(t){if(!(-.7<t.physics.rearBody.standAng.value||t.standing)&&1!=t.targets.limitTurnStandAtDot){var e=z767.z4[0],o=t.physics.frontBody.body.position,i=t.targets.moveToTarget;e.x=i.x-o.x,e.y=i.y-o.y,e.z=i.z-o.z,e.normalize();var n=z767.z4[1],s=t.physics.middleBody.rotationElements;if(n.x=s[1],n.y=s[4],n.z=s[7],BABYLON.Vector3.Dot(e,n)>t.targets.limitTurnStandAtDot){var a=z767.z4[2];a.x=o.x,a.y=o.y,a.z=o.z;var r=this.TEST_DIST_1,c=this.TEST_DIST_2;a.x+=e.x*r,a.y+=e.y*r,a.z+=e.z*r,t.targets.moveToTarget.copyFrom(a),t.targets.standToTarget.copyFrom(a),t.targets.lookToTarget.copyFrom(a),t.targets.moveToTarget.y=o.y+c,t.targets.standToTarget.y=o.y+c,t.targets.lookToTarget.y=o.y+c}}},z631}(z767),e.z631=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z627(){return null!==t&&t.apply(this,arguments)||this}return __extends(z627,t),z627.prototype.update=function(t){t.forceStand=!0},z627}(z767),e.z627=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z626(){return null!==t&&t.apply(this,arguments)||this}return __extends(z626,t),z626.prototype.update=function(t){t.forceTouchGround()},z626}(z767),e.z626=o}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z618(){return null!==t&&t.apply(this,arguments)||this}return __extends(z618,t),z618.prototype.update=function(t){var e=t.physics.rearBody.body.position;if(t.currentObject&&t.currentObject.floorY>e.y||.5<t.targets.targetDir.y)t.forceTouchGround();else{var o,i=t.path[t.pathIndex];if(i&&i.data.obj2)if((o=i.data.obj2).accType==n.z1044.z1049&&o.position.y>e.y)return void t.forceTouchGround();if((i=t.path[t.pathIndex-1])&&i.data.obj2)if((o=i.data.obj2).accType==n.z1044.z1049&&o.position.y>e.y)return void t.forceTouchGround()}},z618}(z767),t.z618=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z610(){return null!==t&&t.apply(this,arguments)||this}return __extends(z610,t),z610.prototype.update=function(t){var e=z767.tempVecs[0],o=z767.tempVecs[1],i=t.targets.upVecTarget;e.x=0,e.y=1,e.z=0;t.physics;if(i.dot(e)<.99)o.cross(e,i),o.normalize(o);else{var n=t.physics.middleBody.rotationElements;o.x=n[0],o.y=n[3],o.z=n[6]}t.targets.upSlopeVec.cross(i,o)},z610}(z767),e.z610=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z572(){var t=null!==e&&e.apply(this,arguments)||this;return t.bodyIndex=2,t.easeAmount=.5,t}return __extends(z572,e),z572}(e.z561),e.z572=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(n){function z570(){var t=null!==n&&n.apply(this,arguments)||this;return t.bodyIndex=2,t.easeAmount=.5,t}return __extends(z570,n),z570.prototype.update=function(t){var e=t.currentObject,o=(t.physics.bodies[this.bodyIndex],t.physics.frontBody.body.position);if(e&&e.getHeightAt){var i=.5*t.size;if(t.getBeddingHeightFront()<o.y-i)return}n.prototype.update.call(this,t)},z570}(e.z561),e.z570=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z568(){var t=null!==e&&e.apply(this,arguments)||this;return t.bodyIndex=3,t}return __extends(z568,e),z568.prototype.update=function(t){e.prototype.update.call(this,t)},z568}(e.z561),e.z568=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z565(){var t=null!==e&&e.apply(this,arguments)||this;return t.bodyIndex=3,t.skipTouchingGround=!0,t}return __extends(z565,e),z565.prototype.update=function(t){e.prototype.update.call(this,t)},z565}(e.z561),e.z565=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(i){function z564(){var t=null!==i&&i.apply(this,arguments)||this;return t.bodyIndex=3,t.speedFrac=.15,t}return __extends(z564,i),z564.prototype.update=function(t){if(!t.isMenuItem&&!t.isOnWheel){var e=!1,o=!1;t.physics.rearBody.onGround&&(t.standing||0==t.walkForce)&&(e=!0),t.isTouchingGround()&&(t.standing||0==t.walkForce)&&(o=!0),o!=e&&(t.physics.frontBody.onGround,t.physics.middleBody.onGround,t.physics.rearBody.onGround),t.isTouchingGround()&&(t.standing||0==t.walkForce?(t.standing?this.speedFrac=1:this.speedFrac=.15,i.prototype.update.call(this,t)):(t.standing,t.walkForce))}},z564}(e.z561),e.z564=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(n){function z562(){var t=null!==n&&n.apply(this,arguments)||this;return t.bodyIndex=3,t}return __extends(z562,n),z562.prototype.update=function(t){var e=t.currentObject,o=t.physics.bodies[this.bodyIndex].body.position;if(e&&e.getHeightAt){var i=.5*t.size;if(t.getBeddingHeightRear()<o.y-i)return}n.prototype.update.call(this,t)},z562}(e.z561),e.z562=o}(z0||(z0={})),function(D){var t,e;t=D.z156||(D.z156={}),e=function(t){function z560(){return null!==t&&t.apply(this,arguments)||this}return __extends(z560,t),z560.prototype.update=function(t){if(t.isTouchingGround()&&t.currentObject){var e=t.focusDist,o=z767.tempVecs[0],i=z767.tempVecs[1],n=D.app.world.timeStep,s=t.physics,a=s.frontBody.body,r=t.speed,c=t.turnAng,d=s.rearBody.body.position,p=t.targets.moveToTarget;i.copy(p),i.subEqual(d);var l,u,y,g,m,f,A=i.x*i.x+i.y*i.y+i.z*i.z,b=e+t.focusRange,v=0,x=(e=t.focusDist)-t.focusRange,C=t.physics.rearBody.standAng.value;if(b*b<A){var S=t.size;v=13*S;var T=t.currentObject;if(T){var B=T.bedding;B&&(0<=B.hams.indexOf(t)&&t.physics.getTouchingz1092ByType(D.z1044.z1047)&&(v*=1.5),t.isStuck(480)&&(v*=2))}v=(L=3.2*S)+(v-L)*r;var O=t.physics.frontBody.rotationElements,P=z767.z4[0];P.x=O[2],P.y=O[5],P.z=O[8];var M=s.frontBody.body.position;o.x=p.x-M.x,o.y=p.y-M.y,o.z=p.z-M.z,o.normalize(o),z1.Dot(P,o)<0&&(o.x=P.x,o.y=P.y,o.z=P.z),o.x*=v,o.y*=v,o.z*=v;var I=(F=a.linearVelocity).x,N=F.y,z=F.z,w=I*O[0]+N*O[3]+z*O[6],_=I*O[1]+N*O[4]+z*O[7],R=I*O[2]+N*O[5]+z*O[8];l=o.x,u=o.y,y=o.z,g=32*((g=l*O[0]+u*O[3]+y*O[6])-w)*n,m=32*((m=l*O[1]+u*O[4]+y*O[7])-_)*n,f=32*((f=l*O[2]+u*O[5]+y*O[8])-R)*n,o.x=g*O[0]+m*O[1]+f*O[2],o.y=g*O[3]+m*O[4]+f*O[5],o.z=g*O[6]+m*O[7]+f*O[8],F.addEqual(o),t.walkForce=v*n,t.walkForce=v}else if(C>.2*-Math.PI&&A<x*x){var L;62,v=.02,v=(L=-.005)+(-.01-L)*r,v=-.02,(c>.5*Math.PI||c<.5*-Math.PI)&&(o.y*=.5,o.y=0,o.normalize(o)),o.x*=v,o.y*=v,o.z*=v,o.x*=62,o.y*=62,o.z*=62,a=s.rearBody.body,O=t.physics.rearBody.rotationElements;var F;I=(F=a.linearVelocity).x,N=F.y,z=F.z,w=I*O[0]+N*O[3]+z*O[6],_=I*O[1]+N*O[4]+z*O[7],R=I*O[2]+N*O[5]+z*O[8];l=o.x,u=o.y,y=o.z,g=l*O[0]+u*O[3]+y*O[6],m=l*O[1]+u*O[4]+y*O[7],g=32*(g-w)*n,f=32*((f=l*O[2]+u*O[5]+y*O[8])-R)*n,o.x=g*O[0]+m*O[1]+f*O[2],o.y=g*O[3]+m*O[4]+f*O[5],o.z=g*O[6]+m*O[7]+f*O[8];1<o.dot(o)&&(o.normalize(o),o.scaleEqual(1)),F.addEqual(o),t.walkForce=v}}},z560}(z767),t.z560=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z558(){return null!==t&&t.apply(this,arguments)||this}return __extends(z558,t),z558.prototype.update=function(t){var e=z767.tempVecs[0],o=t.physics,i=t.physics.rearBody.rotationElements,n=t.physics.middleBody.rotationElements;e.x=i[2]+n[2],e.y=i[5]+n[5],e.z=i[8]+n[8],e.normalize(e);var s;t.speed,s=-10*t.size,e.x*=s,e.y*=s,e.z*=s;var a=o.rearBody.body;i=t.physics.rearBody.rotationElements;var r=a.linearVelocity,c=r.x,d=r.y,p=r.z,l=c*i[0]+d*i[3]+p*i[6],u=(i[1],i[4],i[7],c*i[2]+d*i[5]+p*i[8]),y=e.x,g=e.y,m=e.z,f=y*i[0]+g*i[3]+m*i[6],A=y*i[1]+g*i[4]+m*i[7],b=y*i[2]+g*i[5]+m*i[8];f=.5*(f-l),b=.5*(b-u),e.x=f*i[0]+A*i[1]+b*i[2],e.y=f*i[3]+A*i[4]+b*i[5],e.z=f*i[6]+A*i[7]+b*i[8];e.dot(e);r.addEqual(e),t.walkForce=s},z558}(z767),e.z558=o}(z0||(z0={})),function(w){var t,e;t=w.z156||(w.z156={}),e=function(e){function z460(){var t=null!==e&&e.apply(this,arguments)||this;return t.skipRollToSlope=!1,t.skipRollTest=!1,t.slowAngSpeed=.01*Math.PI,t.fastAngSpeed2=.15*Math.PI,t}return __extends(z460,e),z460.prototype.update=function(t){if(!this.skipRollToSlope){if(!t.standing){if(!t.isTouchingGround())return;t.physics.frontBody.testCollidesWith(w.App.PhysicsGroupBedding),!t.physics.middleBody.onGround&&t.physics.frontBody.onGround}var e=t.targets,o=e.upVecTarget,i=e.upSlopeVec,n=o.x,s=o.y,a=o.z,r=z767.tempVecs[0],c=z767.tempVecs[1],d=z767.tempVecs[2];c.x=0,c.y=1,c.z=0;var p=t.physics,l=t.physics.middleBody.rotationElements;r.x=l[0],r.y=l[3],r.z=l[6];var u=r.dot(i);u<0&&(u=-u),z1.nlerpVec3ToRef(o,c,u,r),n=r.x,s=r.y,a=r.z;var y=p.middleBody.body,g=l=t.physics.middleBody.rotationElements,m=y.angularVelocity,f=t.physics.rearBody.standAng.value;r.x=l[2],r.y=l[5],r.z=l[8],c.x=0,c.y=1,c.z=0,null!=n&&(c.x=n,c.y=s,c.z=a);var A,b,v;t.bones.head;if(!this.skipRollTest&&f<-.5&&!t.standing){var x=t.targets.dirTarget,C=z767.z4[0],S=t.physics.middleBody.rotationElements;if(C.x=S[1],C.y=S[4],C.z=S[7],.5<BABYLON.Vector3.Dot(x,C))return}d.cross(c,r),g=l,A=d.x,b=d.y,v=d.z;var T=A*g[0]+b*g[3]+v*g[6],B=A*g[1]+b*g[4]+v*g[7];g[2],g[5],g[8];e.rollAngToUp=Math.atan2(B,T);var O=e.rollAngToUp,P=t.speed,M=this.slowAngSpeed,I=M+(this.fastAngSpeed2-M)*P;I<O?O=I:O<-I&&(O=-I),r.scaleEqual(62*O),c.sub(r,m);var N;N=1e3*t.size;var z=c.dot(c);.1<t.getStandFrac()&&t.physics.frontBody.onGround,N*N<z&&(c.normalize(c),c.scaleEqual(N)),m.addEqual(c)}},z460}(z767),t.z460=e}(z0||(z0={}));!function(G){var t,e;t=G.z156||(G.z156={}),e=function(t){function z457(){return null!==t&&t.apply(this,arguments)||this}return __extends(z457,t),z457.prototype.update=function(t){if(t.isTouchingGround()){var e=z767.tempVecs[0],o=z767.tempVecs[1],i=z767.tempVecs[2],n=z767.tempVecs[3],s=(G.app.world.timeStep,t.physics),a=s.frontBody.body,r=(t.speed,t.bones.head),c=t.targets.moveToTarget,d=t.targets.upVecTarget,p=s.rearBody.body.position;o.copy(c),o.subEqual(p);var l=a,u=t.physics.frontBody.rotationElements;p=l.position;o.copy(c),o.subEqual(p);var y=o.x,g=o.y,m=o.z;e.x=u[2],e.y=u[5],e.z=u[8],o.cross(e,d),o.normalize(o),i.cross(d,o),L=d,F=i;var f=y*(R=o).x+g*L.x+m*F.x,A=y*R.y+g*L.y+m*F.y,b=y*R.z+g*L.z+m*F.z,v=Math.atan2(f,b);v>.5*Math.PI?(f=2,(b=0)<r.yaw&&(f=-2)):v<.5*-Math.PI&&(f=-2,b=0,r.yaw<0&&(f=2)),y=f*R.x+A*R.y+b*R.z,g=f*L.x+A*L.y+b*L.z,m=f*F.x+A*F.y+b*F.z;var x=z767.tempVecs[4],C=z767.tempVecs[5],S=z767.tempVecs[6];x.x=1,x.y=0,x.z=0,C.x=0,C.y=1,C.z=0,S.x=0,S.y=0,S.z=1,C.dot(d)<.99&&(x.cross(d,C),x.normalize(x),S.cross(x,d)),C=d;var T=y*x.x+g*x.y+m*x.z,B=y*C.x+g*C.y+m*C.z,O=y*S.x+g*S.y+m*S.z;y=T*x.x+B*C.x+O*S.x,g=T*x.y+B*C.y+O*S.y,m=T*x.z+B*C.z+O*S.z;f=y*(I=t.physics.frontBody.rotationElements)[0]+g*I[3]+m*I[6],A=y*I[1]+g*I[4]+m*I[7],b=y*I[2]+g*I[5]+m*I[8];var P=Math.atan2(f,b);t.turnAng=P;var M=0*Math.PI,I=u;if(M<P||P<-M){var N=c.x,z=(c.y,t.size),w=c.z;N=y+a.position.x,z=g+a.position.y,w=m+a.position.z,e.x=N-a.position.x,e.y=z-a.position.y,e.z=w-a.position.z,e.normalize(e);var _=t.physics.frontBody.rotationElements;o.x=_[2],o.y=_[5],o.z=_[8],i.cross(e,o),i.normalize(i),n.cross(i,e),n.normalize(n);var R=n,L=e,F=i,D=o.x*R.x+o.y*R.y+o.z*R.z,E=o.x*L.x+o.y*L.y+o.z*L.z,k=Math.atan2(D,E);Math.abs(k),Math.PI;var j=.1*-k*60,V=a.angularVelocity;F.scaleEqual(j),o.sub(F,V);900<o.dot(o)&&(o.normalize(o),o.scaleEqual(30)),V.addEqual(o)}}},z457}(z767),t.z457=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z437(){return null!==t&&t.apply(this,arguments)||this}return __extends(z437,t),z437.prototype.update=function(t){t.physics.collisionSelfFrac.targetValue=.1,t.physics.collisionOtherFrac.targetValue=.3},z437}(z767),e.z437=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z408(){return null!==t&&t.apply(this,arguments)||this}return __extends(z408,t),z408.prototype.update=function(t){t.focusDist=.5*t.initFocusDist,t.focusRange},z408}(z767),e.z408=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z407(){return null!==t&&t.apply(this,arguments)||this}return __extends(z407,t),z407.prototype.update=function(t){t.focusDist=.75*t.initFocusDist,t.focusRange},z407}(z767),e.z407=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z406(){return null!==t&&t.apply(this,arguments)||this}return __extends(z406,t),z406.prototype.update=function(t){t.focusDist=.01*t.initFocusDist,t.focusRange},z406}(z767),e.z406=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z404(){return null!==t&&t.apply(this,arguments)||this}return __extends(z404,t),z404.prototype.update=function(t){t.focusRange=2*t.size},z404}(z767),e.z404=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z403(){return null!==t&&t.apply(this,arguments)||this}return __extends(z403,t),z403.prototype.update=function(t){t.focusRange=1*t.size},z403}(z767),e.z403=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z400(){return null!==t&&t.apply(this,arguments)||this}return __extends(z400,t),z400.prototype.update=function(t){t.physics.rearBody.body.shapes.friction=.99},z400}(z767),e.z400=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z362(){return null!==t&&t.apply(this,arguments)||this}return __extends(z362,t),z362.prototype.update=function(t){var e=t.physics,o=e.middleBody.body.position,i=e.frontBody.body.position,n=e.rearBody.body.position;t.localPos.x=o.x,t.localPos.y=o.y,t.localPos.z=o.z,t.localPosMid.x=o.x,t.localPosMid.y=o.y,t.localPosMid.z=o.z,t.localPosFront.x=i.x,t.localPosFront.y=i.y,t.localPosFront.z=i.z,t.localPosRear.x=n.x,t.localPosRear.y=n.y,t.localPosRear.z=n.z},z362}(z767),e.z362=o}(z0||(z0={})),function(E){var t,e;t=E.z156||(E.z156={}),e=function(e){function z303(){var t=e.call(this)||this;return t.increaseSpeed=1,t.threshold=.2*Math.PI,t.line1Points=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],t.line2Points=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],t.testBox1=BABYLON.MeshBuilder.CreateBox("",{size:.1},E.app.graphicsHelper.scene),t.testBox1.renderingGroupId=1,t.testBox2=BABYLON.MeshBuilder.CreateBox("",{size:.1},E.app.graphicsHelper.scene),t.testBox2.renderingGroupId=1,t.line1Mesh=BABYLON.Mesh.CreateLines(null,t.line1Points,E.app.graphicsHelper.scene,!0),t.line1Mesh.color=BABYLON.Color3.Black(),t.line1Mesh.renderingGroupId=1,t.line1Mesh.alwaysSelectAsActiveMesh=!0,t.line2Mesh=BABYLON.Mesh.CreateLines(null,t.line2Points,E.app.graphicsHelper.scene,!0),t.line2Mesh.renderingGroupId=1,t.line2Mesh.alwaysSelectAsActiveMesh=!0,t}return __extends(z303,e),z303.prototype.update=function(t){if(t.isTouchingGround()){var e=t.size,o=(t.focusDist,z767.tempVecs[0]),i=z767.tempVecs[1],n=(z767.tempVecs[2],E.app.world.timeStep),s=t.physics,a=(t.speed,t.bones.head,t.physics.rearBody.standAng.value,s.rearBody.body.position,s.rearBody.body),r=t.physics.rearBody.rotationElements,c=t.targets.moveToTarget,d=t.pivotPoint,p=a.position,l=c,u=t.pivotRadius-1.3*t.size,y=p.x-d.x,g=p.z-d.z,m=l.x-d.x,f=l.z-d.z,A=Math.atan2(g,y),b=Math.atan2(f,m)+Math.PI,v=A+.1*z1.getAngDiff(b,A);i.x=d.x+Math.cos(v)*u,i.z=d.z+Math.sin(v)*u,i.y=d.y+.7*t.size,o.x=i.x-p.x,o.y=i.y-p.y,o.z=i.z-p.z,o.normalize(o);o.x,o.x,o.z,o.z;this.testBox1.position.x=l.x,this.testBox1.position.y=l.y,this.testBox1.position.z=l.z,this.testBox2.position.x=i.x,this.testBox2.position.y=i.y,this.testBox2.position.z=i.z;var x=13*e*this.increaseSpeed;o.x*=x,o.z*=x,o.y*=x,o.y=0;var C=a.linearVelocity,S=C.x,T=C.y,B=C.z,O=S*r[0]+T*r[3]+B*r[6],P=S*r[1]+T*r[4]+B*r[7],M=S*r[2]+T*r[5]+B*r[8],I=o.x,N=o.y,z=o.z,w=I*r[0]+N*r[3]+z*r[6],_=I*r[1]+N*r[4]+z*r[7],R=I*r[2]+N*r[5]+z*r[8];w=32*(w-O)*n,_=32*(_-P)*n,R=32*(R-M)*n,s.localWalkForce.x=w,s.localWalkForce.y=_,s.localWalkForce.z=R,o.x=w*r[0]+_*r[1]+R*r[2],o.y=w*r[3]+_*r[4]+R*r[5],o.z=w*r[6]+_*r[7]+R*r[8],C.addEqual(o),t.walkForce=x;var L=p,F=this.line2Points[0],D=this.line2Points[1];F.x=L.x,F.y=L.y,F.z=L.z;D.x=F.x+1*o.x,D.y=F.y+1*o.y,D.z=F.z+1*o.z,BABYLON.Mesh.CreateLines(null,this.line2Points,E.app.graphicsHelper.scene,!0,this.line2Mesh)}},z303}(z767),t.z303=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z301(){return null!==t&&t.apply(this,arguments)||this}return __extends(z301,t),z301.prototype.update=function(t){t.physics.rearJoint.setAngLimits(0,0)},z301}(z767),e.z301=o}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(e){function z258(){var t=null!==e&&e.apply(this,arguments)||this;return t.TEST_targetStandHeight=.2,t}return __extends(z258,e),z258.prototype.update=function(t){var e=this.TEST_targetStandHeight;t.usingObject&&t.usingObject.accType==o.z1044.z1045&&(e=.4),t.usingObject&&t.usingObject.accType==o.z1044.z1050&&(e=.4),t.usingObject&&t.usingObject.accType==o.z1044.SWING&&(e=.3),t.targets.standHeight.targetValue=e},z258}(z767),t.z258=e}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(e){function z255(){var t=null!==e&&e.apply(this,arguments)||this;return t.TEST_targetStandHeight=.2,t}return __extends(z255,e),z255.prototype.update=function(t){var e=this.TEST_targetStandHeight;t.usingObject&&t.usingObject.accType==o.z1044.z1045&&(e=.4),t.usingObject&&t.usingObject.accType==o.z1044.z1050&&(e=.4),t.usingObject&&t.usingObject.accType==o.z1044.SWING&&(e=.2*Math.random()+.1),t.targets.standHeight.targetValue=e},z255}(z767),t.z255=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z278(){return null!==t&&t.apply(this,arguments)||this}return __extends(z278,t),z278.prototype.update=function(t){t.currentObject?t.physics.stayInsideBody=t.currentObject.body:t.physics.stayInsideBody=null},z278}(z767),e.z278=o}(z0||(z0={})),function(it){var t,e;t=it.z156||(it.z156={}),e=function(e){function z209(){var t=e.call(this)||this;return t.adjustY=0,t.moveStandY=0,t.standFracRear=.5,t.standFracMid=.5,t.standFracFront=.5,t.minStandAng=.1,t.maxStrength=10,t.skipStand=!1,t.standYawLimit=2*Math.PI,t.standFracMid=.3,t.standFracFront=.15,t}return __extends(z209,e),z209.prototype.update=function(t){if(!t.standing&&(t.standing=!1,!this.skipStand&&(t.standDown||!t.isFollowingPath()))){var e=t.adjustLerp,o=z767.tempVecs[0],i=z767.tempVecs[1],n=z767.tempVecs[2],s=z767.tempVecs[3],a=t.physics,r=a.frontBody.body,c=a.middleBody.body,d=a.rearBody.body,p=t.targets.standToTarget,l=t.targets.upVecTarget,u=t.physics.frontBody.rotationElements,y=t.physics.middleBody.rotationElements,g=t.physics.rearBody.rotationElements,m=p.x,f=p.y+this.moveStandY,A=p.z,b=t.targets.standToTargetFront,v=b.x,x=b.y,C=b.z,S=m-d.position.x,T=f-d.position.y,B=A-d.position.z,O=S*S+B*B;if(t.computeBodyStandAngs(),t.forceStand||!(O>t.minStandDist*t.minStandDist)){var P=t.forceStand,M=t.physics.rearBody.body.position;if(t.physics.rearBody.testCollidesWith(it.App.PhysicsGroupBedding)){var I=a.groundXAxis,N=a.groundYAxis,z=a.groundZAxis,w=S*I.x+T*I.y+B*I.z,_=S*N.x+T*N.y+B*N.z,R=S*z.x+T*z.y+B*z.z,L=Math.sqrt(w*w+R*R),F=Math.atan2(_,L),D=t.targets.minStandY;if(!t.forceStand&&D>d.position.y&&f<D){var E=z767.tempVecs[0];E.x=m-M.x,E.y=0,E.z=A-M.z,E.normalize(E);var k=2*t.size,j=Math.atan((D-M.y)/k);F<j&&(F=j,m=M.x+E.x*k,f=D,A=M.z+E.z*k,D==t.targets.minStandYFront&&(v=m,x=f,C=A))}}else P=!0;var V=Math.PI;V=this.minStandAng;var G=1,W=.3,Y=0;G=this.standFracRear,W=this.standFracMid,Y=this.standFracFront;var U=0,X=0;if(t.standDown&&(Y=1,W=.3,G=0),P||V<F){var Z=this.standYawLimit;i.x=m-M.x,i.y=f-M.y,i.z=A-M.z,t.physics.rearBody.tranformToUpSpace(l,i,i);var q=Math.atan2(i.x,i.z);if(!t.forceStand){if(Z<q)return;if(q<-Z)return}t.standing=!0,o.x=m-d.position.x,o.y=f-d.position.y,o.z=A-d.position.z,o.normalize(o),0!=this.adjustY?(o.y+=this.adjustY,o.scaleEqual(.5*e)):this.adjustY,i.x=g[2],i.y=g[5],i.z=g[8],n.cross(o,i),n.normalize(n),s.cross(n,o),s.normalize(s);I=s,N=o,z=n;var Q=i.x*I.x+i.y*I.y+i.z*I.z,J=i.x*N.x+i.y*N.y+i.z*N.z;U=Math.atan2(Q,J);var K=-(t.physics.rearBody.angToStandTarget=U)*G,$=d.angularVelocity;z.scaleEqual(62*K),i.sub(z,$),i.scaleEqual(1*e);var tt=30;tt=this.maxStrength,(tt*=1*t.strength)*tt<i.dot(i)&&(i.normalize(i),i.scaleEqual(tt)),$.addEqual(i),o.x=m-c.position.x,o.y=f-c.position.y,o.z=A-c.position.z,o.normalize(o),0!=this.adjustY&&(o.y+=this.adjustY,o.scaleEqual(.5*e)),i.x=y[2],i.y=y[5],i.z=y[8],n.cross(o,i),n.normalize(n),s.cross(n,o),s.normalize(s);I=s,N=o,z=n,Q=i.x*I.x+i.y*I.y+i.z*I.z,J=i.x*N.x+i.y*N.y+i.z*N.z;X=Math.atan2(Q,J);K=-(t.physics.middleBody.angToStandTarget=X)*W;var et=c.angularVelocity;z.scaleEqual(62*K),i.sub(z,et),i.scaleEqual(1*e);tt=this.maxStrength;(tt*=1*t.strength)*tt<i.dot(i)&&(i.normalize(i),i.scaleEqual(tt)),et.addEqual(i),o.x=v-r.position.x,o.y=x-r.position.y,o.z=C-r.position.z,o.normalize(o),0!=this.adjustY&&(o.y+=this.adjustY,o.scaleEqual(.5*e)),i.x=u[2],i.y=u[5],i.z=u[8],n.cross(o,i),n.normalize(n),s.cross(n,o),s.normalize(s);I=s,N=o,z=n,Q=i.x*I.x+i.y*I.y+i.z*I.z,J=i.x*N.x+i.y*N.y+i.z*N.z;X=Math.atan2(Q,J);K=-(t.physics.frontBody.angToStandTarget=X)*Y;var ot=r.angularVelocity;z.scaleEqual(62*K),i.sub(z,ot),i.scaleEqual(1*e);tt=this.maxStrength;(tt*=1*t.strength)*tt<i.dot(i)&&(i.normalize(i),i.scaleEqual(tt)),ot.addEqual(i)}t.standing}}},z209}(z767),t.z209=e}(z0||(z0={})),function(m){var t,e;t=m.z156||(m.z156={}),e=function(t){function z208(){return null!==t&&t.apply(this,arguments)||this}return __extends(z208,t),z208.prototype.update=function(t){var e=t.cage;if(e&&(t.currentObject.accType==m.z1044.z1048&&!(0<t.pathIndex||t.getStandFrac()<.2||t.physics.middleBody.onGround||t.physics.frontBody.onGround))){var o=t.targets.standToTarget,i=t.physics.frontBody.body.position,n=t.physics.rearBody.body.position,s=o.x-n.x,a=o.z-n.z,r=s*s+a*a,c=o.y-i.y,d=o.y-o.prevY;if(!t.targetPickUp||t.food||t.targetPickUp.isDragging){if(r<t.minStandDist*t.minStandDist&&0<c&&0<=d)return}else if(t.usingObject&&t.usingObject.accType==m.z1044.z1045&&t.targetPickUp.bowl==t.usingObject)return;var p=e.position.y,l=t.platformUnder;if(l&&(p=l.position.y),e.bedding){var u=t.getBeddingHeightFront();p<u&&(p=u)}if(!(i.y-p<1.5*t.size)){o.copyFrom(i),t.forceStand=!0,t.standDown=!0;var y=z767.z4[0];y.copyFrom(t.targets.dirTarget),y.y=0,y.normalize();var g=t.size;o.x+=y.x*g,o.z+=y.z*g,t.pubsub.broadcast("standDown",t)}}},z208}(z767),t.z208=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z203(){var t=null!==e&&e.apply(this,arguments)||this;return t.supportSpine=!0,t}return __extends(z203,e),z203.prototype.update=function(t){if(this.supportSpine&&!t.standing&&t.isTouchingGround()){!t.physics.middleBody.onGround&&t.physics.frontBody.onGround;var e=t.measuredSpeed/.035;1<e&&(e=1);var o=z767.tempVecs[0],i=z767.tempVecs[1],n=z767.tempVecs[2],s=z767.tempVecs[3],a=t.physics.rearBody.body,r=t.speed,c=t.physics.rearBody.rotationElements;o.x=-c[2],o.y=-c[5],o.z=-c[8];var d=t.physics.headBody.rotationElements;s.x=-d[2],s.y=-d[5],s.z=-d[8];var p=i,l=s,u=n;u.cross(o,l),0==u.x&&0==u.y&&0==u.z?(n.x=0,n.y=1,n.z=0):u.normalize(u),p.cross(u,l);var y=o.x,g=o.y,m=o.z,f=y*p.x+g*p.y+m*p.z,A=y*l.x+g*l.y+m*l.z,b=.5*-Math.atan2(f,A),v=.01*Math.PI,x=v+(.1*Math.PI-v)*r;x<b?b=x:b<-x&&(b=-x);b*=1*e;var C=a.angularVelocity;u.scaleEqual(62*b),i.sub(u,C);var S;(S=2*t.strength)*S<i.dot(i)&&(i.normalize(i),i.scaleEqual(S)),C.addEqual(i)}},z203}(z767),e.z203=o}(z0||(z0={})),function(s){var t,e;t=s.z156||(s.z156={}),e=function(n){function z202(){return null!==n&&n.apply(this,arguments)||this}return __extends(z202,n),z202.prototype.update=function(t){var e=t.currentObject;if(e&&e.accType==s.z1044.z1054){var o=e.body.position,i=t.physics.frontBody.body.position;i.y<o.y-e.radius+2*t.size?n.prototype.update.call(this,t):i.y}},z202}(t.z203),t.z202=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z718(){return null!==t&&t.apply(this,arguments)||this}return __extends(z718,t),z718.prototype.update=function(t){if(!t.avoidingObject&&t.pathIndex<t.path.length){var e=t.path[t.pathIndex];if(!e)return;if(null!=e.data.enterEvent)if(e.data.enterNextNode){if(t.path[t.pathIndex+1]===e.data.enterNextNode){if((o=e.data.obj2||e.data.obj)&&!o.isOnScene)return t.path.length=0,void t.setPathTo(t.targets.destTarget);t.pubsub.broadcast(e.data.enterEvent)}}else{var o;if((o=e.data.obj2||e.data.obj)&&!o.isOnScene)return t.path.length=0,void t.setPathTo(t.targets.destTarget);t.pubsub.broadcast(e.data.enterEvent)}}},z718}(z767),e.z718=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z717(){return null!==t&&t.apply(this,arguments)||this}return __extends(z717,t),z717.prototype.update=function(t){var e=t.targets.moveToTarget,o=t.physics.headBody.body.position,i=z767.tempVecs[0];i.copy(e),i.subEqual(o);var n=i.x*i.x+i.y*i.y+i.z*i.z,s=t.focusRange,a=t.focusDist+s;n<a*a&&t.targets.setNextDestination()},z717}(z767),e.z717=o}(z0||(z0={})),function(f){var t,e;t=f.z156||(f.z156={}),e=function(t){function z716(){return null!==t&&t.apply(this,arguments)||this}return __extends(z716,t),z716.prototype.update=function(t){var e,o;if(t.isTouchingGround()&&(0<t.path2.length&&t.path2Index<t.path2.length||0<t.path.length&&t.pathIndex<t.path.length)){if(t.path2Index>=t.path2.length)return t.path2.length=0,t.path.length=0,void t.targets.setTargetsToDestination();var i=t.physics.frontBody.body,n=t.size,s=t.targets,a=s.pathTarget,r=s.pathNodeHitDist;t.path[t.pathIndex]&&t.path[t.pathIndex].data.hitDist&&(r=t.path[t.pathIndex].data.hitDist);var c=r*r,d=i.position,p=t.path2[t.path2Index]-d.x,l=t.path2[t.path2Index+1]-d.y,u=t.path2[t.path2Index+2]-d.z,y=p*p+l*l+u*u;if(t.path2[t.path2Index+2]<-10)return t.path2Index=t.path2.length+3,t.pathIndex=Math.floor(t.path2Index/3)-1,t.pathIndex<t.path.length-1&&(t.path.length=0,t.path2.length=0),void t.targets.setTargetsToDestination();if(y<c){var g=t.path[t.pathIndex];if(!g)return;if(g.data.enterNextNode){if(t.path[t.pathIndex+1]===g.data.enterNextNode)return}else if(g.data.enterEvent)return;t.path2Index+=3,t.pathIndex=Math.floor(t.path2Index/3)-1,t.pubsub.broadcast(f.z1061Events.NEW_PATH_NODE),t.path2Index>=t.path2.length&&(t.pathIndex<t.path.length-1&&(t.path.length=0,t.path2.length=0),t.targets.setTargetsToDestination())}if(t.path2Index<t.path2.length){var m=n;null!=(null===(e=t.path[t.pathIndex])||void 0===e?void 0:e.data.offsetY)&&(m=null===(o=t.path[t.pathIndex])||void 0===o?void 0:o.data.offsetY),a.set(t.path2[t.path2Index],t.path2[t.path2Index+1]+m,t.path2[t.path2Index+2])}else t.path2Index>=t.path2.length&&a.copyFrom(t.targets.destTarget)}},z716}(z767),t.z716=e}(z0||(z0={})),function(i){var t,e;t=i.z156||(i.z156={}),e=function(t){function z767CheckLookToNextNode(){return null!==t&&t.apply(this,arguments)||this}return __extends(z767CheckLookToNextNode,t),z767CheckLookToNextNode.prototype.update=function(t){if(t.isFollowingPath()){var e=t.targets.lookToTarget,o=t.path[t.pathIndex+1];o&&o.data.obj2&&o.data.obj2.accType==i.z1044.z1046&&(e.x=o.x,e.y=o.y,e.z=o.z)}},z767CheckLookToNextNode}(z767),t.z767CheckLookToNextNode=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z704(){return null!==t&&t.apply(this,arguments)||this}return __extends(z704,t),z704.prototype.update=function(t){if(t.isTouchingGround()&&!(t.pathIndex>=t.path.length)){var e=t.path[t.pathIndex],o=t.physics.middleBody.body.position;if(!(o.y<e.y)){if(t.path[t.pathIndex+1]){var i=t.path[t.pathIndex+1];if(i.data&&i.data.obj!=t.currentObject)return;if(i.x==e.x&&i.z==e.z&&i.y<e.y)return}var n=t.currentObject;if(n){var s=n.position.y,a=n.position.x-.5*n.width,r=n.position.x+.5*n.width;if(!(Math.abs(o.y-s)<t.size)){var c=4*t.size;if(!(o.x-a>c&&o.x-r<-c)){var d=t.targets.pathTarget,p=t.targets.lookToTarget,l=t.targets.moveToTarget,u=t.targets.standToTarget;d.set(e.x,e.y,e.z),p.x=d.x,p.y=d.y+.5*t.size,p.z=d.z,u.x=d.x,u.y=d.y,u.z=d.z,l.x=d.x,l.y=d.y,l.z=d.z}}}}}},z704}(z767),e.z704=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z701(){return null!==t&&t.apply(this,arguments)||this}return __extends(z701,t),z701.prototype.update=function(t){if(t.physics.hitTracker&&(!(.4<t.getStandFrac())&&(t.physics.frontBody.speedToWatch=.01,!t.yieldingToOther&&t.isStuck()&&!t.standing)))for(var e=t.physics.hitTracker.hits,o=0;o<e.length;o++){var i=e.getAtIndex(o),n=i.actor.rodent;if(n&&(!(.4<n.getStandFrac())&&n.yieldingToOther!=t&&n.isStuck()&&this.shouldHamYieldToOTher(t,i))){t.yieldingToOther=i.actor.rodent;break}}},z701.prototype.shouldHamYieldToOTher=function(t,e){var o=!1,i=e.parent,n=e.actor.rodent,s=t.physics.frontBody,a=n.physics.frontBody,r=t.targets.destTarget,c=s.body.position,d=n.targets.destTarget,p=a.body.position;r.equals(d);var l=!1,u=z767.z4[0],y=z767.z4[1];return 1<i.hamSegNum?l=!1:(z1.getOIMOLocalPositionFromGlobalToRef(s.body,p,y),z1.getOIMOLocalPositionFromGlobalToRef(a.body,c,u),y.z<u.z&&(l=!0)),l||(o=!0),o},z701}(z767),e.z701=o}(z0||(z0={})),function(a){var t,e;t=a.z156||(a.z156={}),e=function(t){function z685(){return null!==t&&t.apply(this,arguments)||this}return __extends(z685,t),z685.prototype.update=function(t){var e=t.physics.groundXAxis,o=t.physics.groundYAxis,i=t.physics.groundZAxis;if(!t.physics.frontBody.testCollidesWith(a.App.PhysicsGroupBedding))return e.x=1,e.y=0,e.z=0,o.x=0,o.y=1,o.z=0,i.x=0,i.y=0,void(i.z=1);var n=z767.tempVecs[0],s=t.targets.upVecTarget;o.x=s.x,o.y=s.y,o.z=s.z,n.x=0,n.y=1,n.z=0,n.dot(s)<.99?(e.cross(n,o),e.normalize(e),i.cross(e,o),i.normalize(i)):(e.x=1,e.y=0,e.z=0,i.x=0,i.y=0,i.z=1)},z685}(z767),t.z685=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z630(){return null!==t&&t.apply(this,arguments)||this}return __extends(z630,t),z630.prototype.update=function(t){var e=t.targets.otherz1062;if(e){var o=e.physics.middleBody.body.position,i=(t.targets.lookToTarget,t.targets.moveToTarget);i.x=o.x,i.y=o.y,i.z=o.z}},z630}(z767),e.z630=o}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z611(){return null!==t&&t.apply(this,arguments)||this}return __extends(z611,t),z611.prototype.update=function(t){var e=t.targets.destTarget,o=t.currentObject;if(o.isInBox&&!o.isInBox(e.x,e.y,e.z)&&(o=n.Cage.getCageAt(e.x,e.y,e.z)),o){var i=o.getObjectAt(e.x,e.y,e.z);i&&(t.targetObject=i)}},z611}(z767),t.z611=e}(z0||(z0={})),function(s){var t,e;t=s.z156||(s.z156={}),e=function(t){function z311(){return null!==t&&t.apply(this,arguments)||this}return __extends(z311,t),z311.prototype.update=function(t){var e=s.Cage.activeObjects,o=e.length,i=e[Math.floor(Math.random()*o)];i.id;for(var n=0;i==t.cage;)if(i=e[Math.floor(Math.random()*o)],10<++n)return;t.targetObject=i,t.targets.destTarget.copyFrom(i.position),t.setPathTo(i.position),t.path.length||(t.targetObject=null)},z311}(z767),t.z311=e}(z0||(z0={})),function(f){var t,e;t=f.z156||(f.z156={}),e=function(e){function z310(){var t=null!==e&&e.apply(this,arguments)||this;return t.arr=[],t.pathSetFrame=[],t}return __extends(z310,e),z310.prototype.update=function(t){var e=t.currentObject;if(e){var o=f.app.frameNum;if(this.pathSetFrame[t.num]!=o&&this.pathSetFrame[t.num]!=o-1&&this.pathSetFrame[t.num]!=o-2){var i=this.arr;if(i.length=0,e.accType==f.z1044.z1051){(g=e).getConnectedTubes(i),g.getConnectedCages(i);var n=i.length,s=null;if(1<n){var a=Math.floor(n*Math.random());s=i[a];var r=0;if(1<n)for(;t.rearObject==s;)if(s=i[a=Math.floor(n*Math.random())],10<++r)return;if(t.rearObject,t.targetObject=s,(t.position.y-s.position.y<1||s.accType==f.z1044.z1051)&&(t.setPathTo(s.position),t.path.length))return t.targets.destTarget.copyFrom(t.targetObject.position),t.targets.setTargetsToDestination(),void(this.pathSetFrame[t.num]=o);var c=g.getClosestEnterNode(t.targetObject.position),d=z767.tempVecs[0];return d.x=c.x+.5*c.data.outDir.x,d.y=c.y+.5*c.data.outDir.y,d.z=c.z+.5*c.data.outDir.z,d.z+=Math.round(3*Math.random()-1.5),t.setPathTo(d),t.path.length?(t.targets.destTarget.copyFrom(d),t.targets.setTargetsToDestination()):t.targetObject=null,void(this.pathSetFrame[t.num]=o)}if(1==n)return(s=i[0]).accType==f.z1044.z1051&&(s=s.getRandomConnectedAcc(t.currentObject)),t.targetObject=s,t.setPathTo(s.position),void(t.path.length?(t.targets.destTarget.copyFrom(t.targetObject.position),t.targets.setTargetsToDestination(),this.pathSetFrame[t.num]=o):t.targetObject=null);var p=this.arr;if(g.getConnectedCages(p),p.length){var l=p[Math.floor(p.length*Math.random())];t.targetObject=l,t.setPathTo(l.position),t.path.length?(t.targets.destTarget.copyFrom(t.targetObject.position),t.targets.setTargetsToDestination(),this.pathSetFrame[t.num]=o):t.targetObject=null}}else if(e.parent&&(e=e.parent),e.accType==f.z1044.z1048){var u=e;u.getTubesWithOpeningConnectors(i);for(var y=i.length-1;0<=y;y--){var g;(g=i[y]).parent&&i.splice(y,1)}if(u.getConnectedCages(i),i.length){var m=i[Math.floor(i.length*Math.random())];t.targetObject=m,t.setPathTo(m.position),t.path.length?(t.targets.destTarget.copyFrom(t.targetObject.position),t.targets.setTargetsToDestination(),this.pathSetFrame[t.num]=o):t.targetObject=null}}}}},z310}(z767),t.z310=e}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z309(){return null!==t&&t.apply(this,arguments)||this}return __extends(z309,t),z309.prototype.update=function(t){var e=n.TubeCover.activeObjects,o=e.length;if(o){var i=e[Math.floor(Math.random()*o)];t.targetObject=i.tube,t.targets.destTarget.copyFrom(t.targetObject.position),t.setPathTo(t.targetObject.position),t.path.length||(t.targetObject=null)}else t.targetObject=null},z309}(z767),t.z309=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z597(){return null!==t&&t.apply(this,arguments)||this}return __extends(z597,t),z597.prototype.update=function(t){t.targetObject=null},z597}(z767),e.z597=o}(z0||(z0={})),function(a){var t,e;t=a.z156||(a.z156={}),e=function(t){function z593(){return t.call(this)||this}return __extends(z593,t),z593.prototype.update=function(t){if(t.cage){var e=t.usingObject;if(e&&e.accType==a.z1044.z1050){var o=t.targets.destTarget,i=t.targets.moveToTarget,n=t.targets.lookToTarget,s=t.targets.standToTarget;t.physics.frontBody.body.position;t.isFollowingPath()||o.z<e.position.z-.5*e.depth&&(o.x=e.position.x,o.y=e.position.y+e.radius+t.size,o.z=e.position.z,i.x=e.position.x,i.y=e.position.y+e.radius+t.size,i.z=e.position.z,n.copyFrom(i),s.copyFrom(i))}}},z593}(z767),t.z593=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z592(){return t.call(this)||this}return __extends(z592,t),z592.prototype.update=function(t){var e=t.cage;if(e){var o=t.position,i=e.getPlatformUnder(o.x,o.y,o.z);if(i){var n=t.targets.destTarget,s=i.connectedPlatformsCenterX-.5*i.connectedPlatformsWidth,a=i.connectedPlatformsCenterX+.5*i.connectedPlatformsWidth;if(!(n.x>s&&n.x<a)){var r=n.x-i.connectedPlatformsCenterX;(r<0?e.getHeightAt(s-.1,o.z):e.getHeightAt(a+.1,o.z))-i.position.y<-.5&&(n.x=r<0?s+.05:a-.05,t.targets.moveToTarget.x=n.x)}}}},z592}(z767),e.z592=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z554(){return null!==t&&t.apply(this,arguments)||this}return __extends(z554,t),z554.prototype.update=function(t){t.pathIndex++,t.path2Index=3*t.pathIndex+3},z554}(z767),e.z554=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z528(){return null!==t&&t.apply(this,arguments)||this}return __extends(z528,t),z528.prototype.update=function(t){t.targets.point1.copyFrom(t.physics.frontBody.body.position)},z528}(z767),e.z528=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z506(){return null!==t&&t.apply(this,arguments)||this}return __extends(z506,t),z506.prototype.update=function(t){t.isFollowingPath()&&t.setPathTo(t.targets.destTarget)},z506}(z767),e.z506=o}(z0||(z0={})),function(m){var t,e;t=m.z156||(m.z156={}),e=function(e){function z441(){var t=null!==e&&e.apply(this,arguments)||this;return t.distBetweenNodes=.2,t.maxPos=4,t.bodyIndex=1,t}return __extends(z441,e),z441.prototype.update=function(t){var e=t.physics.bodies,o=e[this.bodyIndex],i=o.path,n=o.body.position,s=m.app.frameNum,a=o.lastFramePathSet,r=t.cage;if(o.lastFramePathSet=s,null==i&&(i=o.path=[],a=-10),a==s-1&&null!=i){var c=n.x-i[0],d=n.y-i[1],p=n.z-i[2];if(c*c+d*d+p*p>this.distBetweenNodes*this.distBetweenNodes){for(var l=3*(this.maxPos-2);0<=l;l-=3)i[l+3]=i[l],i[l+4]=i[l+1],i[l+5]=i[l+2];i[0]=n.x,i[1]=n.y,i[2]=n.z}}else{var u=z767.z4[0];for(l=0;l<e.length-this.bodyIndex;l++){var y=e[this.bodyIndex+l].body.position;if(u.x=y.x,u.y=y.y,u.z=y.z,r){var g=r.getHeightAt(u.x,u.z);u.y>g&&(u.y=g)}i[3*l]=u.x,i[3*l+1]=u.y,i[3*l+2]=u.z}}},z441}(z767),t.z441=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z435(){return null!==t&&t.apply(this,arguments)||this}return __extends(z435,t),z435.prototype.update=function(t){t.path[t.pathIndex]&&(t.currentObject=t.path[t.pathIndex].data.obj)},z435}(z767),e.z435=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z434(){return null!==t&&t.apply(this,arguments)||this}return __extends(z434,t),z434.prototype.update=function(t){t.currentObject=t.targetObject},z434}(z767),e.z434=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z431(){return null!==t&&t.apply(this,arguments)||this}return __extends(z431,t),z431.prototype.update=function(t){t.physics.rearBody.target.copyFrom(t.pivotPoint)},z431}(z767),e.z431=o}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z427(){return null!==t&&t.apply(this,arguments)||this}return __extends(z427,t),z427.prototype.update=function(t){t.targets.destTarget.copyFrom(e.app.graphicsHelper.camera.position)},z427}(z767),t.z427=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z426(){return null!==t&&t.apply(this,arguments)||this}return __extends(z426,t),z426.prototype.update=function(t){t.currentObject&&t.targets.destTarget.copyFrom(t.currentObject.position)},z426}(z767),e.z426=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z425(){return null!==t&&t.apply(this,arguments)||this}return __extends(z425,t),z425.prototype.update=function(t){t.targets.destTarget.copyFrom(t.targets.lastDestTarget)},z425}(z767),e.z425=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z424(){return null!==t&&t.apply(this,arguments)||this}return __extends(z424,t),z424.prototype.update=function(t){t.targets.destTarget.copyFrom(t.targets.lookToTarget),t.targets.moveToTarget.copyFrom(t.targets.lookToTarget)},z424}(z767),e.z424=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z423(){return null!==t&&t.apply(this,arguments)||this}return __extends(z423,t),z423.prototype.update=function(t){t.targets.destTarget.copyFrom(t.targets.moveToTarget)},z423}(z767),e.z423=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z422(){return null!==t&&t.apply(this,arguments)||this}return __extends(z422,t),z422.prototype.update=function(t){t.targets.destTarget.set(t.pivotPoint.x+Math.cos(t.pivotAng)*t.pivotRadius,t.pivotPoint.y,t.pivotPoint.z+Math.sin(t.pivotAng)*t.pivotRadius),t.targets.setTargetsToDestination()},z422}(z767),e.z422=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z421(){return null!==t&&t.apply(this,arguments)||this}return __extends(z421,t),z421.prototype.update=function(t){var e=t.currentObject;if(e){e.parent&&(e=e.parent);var o=t.targets.destTarget,i=e.getPlatformUnder(o.x,o.y+.3,o.z);if(i){var n=i.position.x-t.position.x;(n>.5*i.width||n<.5*-i.width||t.position.y<i.position.y)&&(o.y=i.position.y+.1,o.x=i.position.x,t.targets.setTargetsToDestination())}}},z421}(z767),e.z421=o}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z380(){return null!==t&&t.apply(this,arguments)||this}return __extends(z380,t),z380.prototype.update=function(t){t.targets.lastFramePointerMoved=e.app.frameNum},z380}(z767),t.z380=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z348(){return null!==t&&t.apply(this,arguments)||this}return __extends(z348,t),z348.prototype.update=function(t){var e=t.targets.currentTarget;(o=t.targets.lookToTarget).x=e.x,o.y=e.y,o.z=e.z;var o=t.targets.standToTarget},z348}(z767),e.z348=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z347(){return null!==t&&t.apply(this,arguments)||this}return __extends(z347,t),z347.prototype.update=function(t){var e=t.targets.destTarget,o=t.targets.lookToTarget;o.x=e.x,o.y=e.y,o.z=e.z},z347}(z767),e.z347=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z345(){return null!==t&&t.apply(this,arguments)||this}return __extends(z345,t),z345.prototype.update=function(t){if(t.isTouchingGround()){var e=t.targets.pathTarget,o=t.targets.lookToTarget;t.pathIndex>=t.path.length||(o.x=e.x,o.y=e.y+t.size,o.z=e.z)}},z345}(z767),e.z345=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z338(){return null!==t&&t.apply(this,arguments)||this}return __extends(z338,t),z338.prototype.update=function(t){if(t.isTouchingGround()){var e=t.physics.frontBody.path;if(e[6]){var o=t.physics.middleBody,i=o.target,n=o.body.position,s=z767.z4[0],a=z767.z4[1],r=z767.z4[2],c=t.physics.frontBody.body.position;a.x=c.x,a.y=c.y,a.z=c.z,r.x=e[0],r.y=e[1],r.z=e[2],s.x=n.x,s.y=n.y,s.z=n.z,z1.GetClosestPointToLineToRef(e,s,i,0,6)}}},z338}(z767),e.z338=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z334(){return null!==t&&t.apply(this,arguments)||this}return __extends(z334,t),z334.prototype.update=function(t){var e=t.physics.rearBody.body.position,o=t.targets.moveToTarget;o.x=e.x,o.y=e.y,o.z=e.z;var i=z767.z4[0],n=t.size;n=t.size,t.bones.hip.bone.getDirectionToRef(BABYLON.Axis.X,t.mesh,i),o.x+=i.x*n,o.y+=i.y*n,o.z+=i.z*n},z334}(z767),e.z334=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z333(){return null!==t&&t.apply(this,arguments)||this}return __extends(z333,t),z333.prototype.update=function(t){var e=t.targets.destTarget,o=t.targets.moveToTarget;o.x=e.x,o.y=e.y,o.z=e.z},z333}(z767),e.z333=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z332(){return null!==t&&t.apply(this,arguments)||this}return __extends(z332,t),z332.prototype.update=function(t){if(t.isTouchingGround()){var e=t.targets.pathTarget,o=t.targets.moveToTarget;t.pathIndex>=t.path.length||(o.x=e.x,o.y=e.y,o.z=e.z)}},z332}(z767),e.z332=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z331(){return null!==t&&t.apply(this,arguments)||this}return __extends(z331,t),z331.prototype.update=function(t){var e=t.targets.moveToTarget,o=e.y,i=t.currentObject;i&&(i.parent&&(i=i.parent),i.bedding&&(o=i.bedding.getHeightAt(e.x,e.z,!0),e.y=o+1*t.size))},z331}(z767),e.z331=o}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z324(){return null!==t&&t.apply(this,arguments)||this}return __extends(z324,t),z324.prototype.update=function(t){var e=o.app.pointerDownPosition;t.setPathTo(e)},z324}(z767),t.z324=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z320(){return null!==t&&t.apply(this,arguments)||this}return __extends(z320,t),z320.prototype.update=function(t){t.targets.pathNodeHitDist=3.5*t.size},z320}(z767),e.z320=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z318(){return null!==t&&t.apply(this,arguments)||this}return __extends(z318,t),z318.prototype.update=function(t){t.targets.pathNodeHitDist=0},z318}(z767),e.z318=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z316(){return null!==t&&t.apply(this,arguments)||this}return __extends(z316,t),z316.prototype.update=function(t){if(t.isTouchingGround()&&!(t.pathIndex>=t.path.length)){var e=t.targets.pathTarget,o=t.path[t.pathIndex];e.set(o.x,o.y,o.z)}},z316}(z767),e.z316=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z315(){return null!==t&&t.apply(this,arguments)||this}return __extends(z315,t),z315.prototype.update=function(t){if(t.isFollowingPath()){var e=t.platformUnder;e&&t.path[t.pathIndex].y-e.position.y<-.1&&t.setPathTo(t.targets.destTarget)}},z315}(z767),e.z315=o}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z314(){return null!==t&&t.apply(this,arguments)||this}return __extends(z314,t),z314.prototype.update=function(t){e.app.selectedz1062,t.setPathTo(t.targets.destTarget),0==t.path.length&&t.targets.setTargetsToDestination()},z314}(z767),t.z314=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z298(){return null!==t&&t.apply(this,arguments)||this}return __extends(z298,t),z298.prototype.update=function(t){t.rearObject=t.currentObject},z298}(z767),e.z298=o}(z0||(z0={})),function(p){var t,e;t=p.z156||(p.z156={}),e=function(t){function z294(){return null!==t&&t.apply(this,arguments)||this}return __extends(z294,t),z294.prototype.update=function(t){var e=t.physics.rearBody,o=e.body.position;if(e.target.frameNum!=p.app.frameNum){e.target.copyFrom(o);var i=t.cage;if(i){var n=i.bedding,s=t.physics.touchingAccTypes&p.z1044.z1047;if(n&&s){var a=o,r=t.physics.rearBody.target,c=t.size;return r.x=a.x-e.groundAxisY.x*c,r.y=a.y-e.groundAxisY.y*c,void(r.z=a.z-e.groundAxisY.z*c)}r=t.physics.rearBody.target;if(1<o.y-i.bottom){var d=t.platformUnder;d&&(r.y=d.position.y)}else r.y=i.bottom}}},z294}(z767),t.z294=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z292(){return null!==t&&t.apply(this,arguments)||this}return __extends(z292,t),z292.prototype.update=function(t){var e=t.physics.rearBody.body.position;t.physics.rearBody.target.copyFrom(e)},z292}(z767),e.z292=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z289(){return null!==t&&t.apply(this,arguments)||this}return __extends(z289,t),z289.prototype.update=function(t){if(t.isTouchingGround()){var e=t.physics.frontBody.path;if(e[6]){var o=t.physics.rearBody,i=o.target,n=o.body.position,s=z767.z4[0];s.x=n.x,s.y=n.y,s.z=n.z,z1.GetClosestPointToLineToRef(e,s,i,3,6)}}},z289}(z767),e.z289=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z272(){return null!==t&&t.apply(this,arguments)||this}return __extends(z272,t),z272.prototype.update=function(t){var e=t.targets.targetDir,o=t.physics.frontBody.rotationElements;e.y=0,e.x=o[2],e.z=o[8],e.normalize()},z272}(z767),e.z272=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z239(){return null!==t&&t.apply(this,arguments)||this}return __extends(z239,t),z239.prototype.update=function(t){t.targets.setTargetsToDestination()},z239}(z767),e.z239=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z235(){return null!==t&&t.apply(this,arguments)||this}return __extends(z235,t),z235.prototype.update=function(t){if(t.isTouchingGround())if(t.avoidingObject)t.avoidingObject;else{var e=t.targets,o=e.pathTarget,i=e.moveToTarget,n=e.lookToTarget,s=e.standToTarget;(0<t.path2.length&&t.path2Index<t.path2.length||0<t.path.length&&t.pathIndex<t.path.length)&&(s.x=o.x,s.y=o.y,s.z=o.z,i.x=o.x,i.y=o.y,i.z=o.z,n.x=o.x,n.y=o.y,n.z=o.z)}},z235}(z767),e.z235=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z234(){var t=null!==e&&e.apply(this,arguments)||this;return t.lookToPivotTarget=!0,t}return __extends(z234,e),z234.prototype.update=function(t){if(t.isTouchingGround()&&(t.avoidingObject,0!=t.pivotArea)){var e=t.targets,o=e.avoidTarget,i=e.moveToTarget,n=e.lookToTarget,s=e.standToTarget,a=t.physics.frontBody.body.position,r=t.pivotPoint,c=t.pivotRadius,d=z767.z4[0],p=z767.z4[1],l=z767.z4[2],u=z767.z4[3],y=z767.z4[4];d.x=0,d.y=1,d.z=0,p.x=r.x-a.x,p.y=0,p.z=r.z-a.z,p.normalize(),l.x=-p.x,l.y=-p.y,l.z=-p.z,0<t.pivotMoveDir?BABYLON.Vector3.CrossToRef(p,d,u):BABYLON.Vector3.CrossToRef(d,p,u),y.x=a.x,y.y=a.y,y.z=a.z,y.y=.5*(a.y+t.targets.pathTarget.y);var g=3*t.size;y.x+=u.x*g,y.z+=u.z*g;var m=t.currentObject;if(m){m.parent&&(m=m.parent);var f;f=t.pivotUpdateLook;var A=m.position.x-.5*m.width+t.size,b=m.position.x+.5*m.width-t.size,v=m.position.z+.5*m.depth-t.size,x=m.position.z-.5*m.depth+t.size,C=BABYLON.Vector3.Dot(t.pivotAreaDir,l);if(Math.acos(C)<.5*t.pivotArea){t.pivotArea=2*Math.PI,y.copyFrom(o);var S=t.pivotAreaLerp,T=t.targets.destTarget;t.isFollowingPath()&&(T=t.targets.pathTarget);var B=T.x-y.x,O=T.y-y.y,P=T.z-y.z;y.x+=B*S,y.y+=O*S,y.z+=P*S,o.x=y.x,o.y=y.y,o.z=y.z,s.x=y.x,s.y=y.y,s.z=y.z,i.x=y.x,i.y=y.y,i.z=y.z,f&&(n.x=y.x,n.y=y.y,n.z=y.z);(M=(B=T.x-y.x)*B+(O=T.y-y.y)*O+(P=T.z-y.z)*P)<.05*.05&&(t.pivotArea=0)}else{var M=(B=y.x-r.x)*B+(P=y.z-r.z)*P,I=t.pivotRadiusMax;t.pivotRadius&&(t.pivotRadiusMax,t.pivotRadius),0<I&&I*I<M?t.pivotArea=2*Math.PI:M<c*c&&(y.x=-c*p.x+r.x,y.z=-c*p.z+r.z,y.x+=u.x*g,y.z+=u.z*g);var N=100,z=100;if(y.x>b?N=b-r.x:y.x<A&&(N=r.x-A),y.z>v?z=v-r.z:y.z<x&&(z=r.z-x),100!=N||100!=z){var w=Math.min(N,z);y.x=-w*p.x+r.x,y.z=-w*p.z+r.z,y.x+=u.x*g,y.z+=u.z*g}if(t.cage){var _=t.cage.getPlatformUnder(r.x,r.y,r.z);if(_){var R=t.path[t.pathIndex+1];if(r.y-_.position.y<.7){var L=_.position.x-.5*_.width;if(_.platformToLeft){var F=_.platformToLeft;L=F.position.x-.5*F.width}var D=_.position.x+.5*_.width;if(_.platformToRight){var E=_.platformToRight;D=E.position.x+.5*E.width}var k=3*t.size,j=3*t.size;if(y.x<L)if(R){if(!(R.x>L))return void(t.pivotArea=0);y.x=L+k,y.y=_.position.y+j}else y.x=L+k,y.y=_.position.y+j;if(y.x>D)if(R){if(!(R.x<D))return void(t.pivotArea=0);y.x=D-k,y.y=_.position.y+j}else y.x=D-k,y.y=_.position.y+j}}}o.x=y.x,o.y=y.y,o.z=y.z,s.x=y.x,s.y=y.y,s.z=y.z,i.x=y.x,i.y=y.y,i.z=y.z,f&&(n.x=y.x,n.y=y.y,n.z=y.z),n.x>b||n.x}}}},z234}(z767),e.z234=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z220(){return null!==t&&t.apply(this,arguments)||this}return __extends(z220,t),z220.prototype.update=function(t){t.path[t.pathIndex]&&(t.usingObject=t.path[t.pathIndex].data.obj2||t.path[t.pathIndex].data.obj)},z220}(z767),e.z220=o}(z0||(z0={})),function(l){var t,e;t=l.z156||(l.z156={}),e=function(e){function z192(){var t=null!==e&&e.apply(this,arguments)||this;return t.arr=[],t}return __extends(z192,e),z192.prototype.update=function(t){var e=t.targets,o=e.destTarget,i=e.lookToTarget,n=e.moveToTarget,s=e.standToTarget,a=e.pointerDownPosition;if(t.currentObject&&!a.equals(o)){o.copyFrom(a),t.getPathToRef(o,this.arr);var r=t.physics.frontBody.body.position;if(0<this.arr.length&&(t.pathIndex=0,t.targetNode=this.arr[this.arr.length-1],t.path2.length=0,t.path2Index=0,t.copyPathFrom(this.arr),0<this.arr.length&&z1083.getSmoothPath(t.path2,t.path,r,o)),0==this.arr.length){var c=t.currentObject;if(!t.currentObject)return;if(t.currentObject.parent&&(c=t.currentObject.parent),!c.isInBox(a.x,a.y,a.z))return}i.x=o.x,i.y=o.y,i.z=o.z,s.x=i.x,s.y=i.y,s.z=i.z,n.x=o.x,n.y=o.y,n.z=o.z;var d=t.path[t.path.length-1];if(t.targetObject=d?d.data.obj:t.currentObject,t.targetObject&&t.targetObject.accType==l.z1044.z1048){var p=t.targetObject.getObjectAt(t.targets.destTarget.x,t.targets.destTarget.y,t.targets.destTarget.z,l.z1044.z1051|l.z1044.z1054|l.z1044.z1050|l.z1044.z1055);p&&(t.targetObject=p)}}},z192}(z767),t.z192=e}(z0||(z0={})),function(g){var t,e;t=g.z156||(g.z156={}),e=function(e){function z191(){var t=null!==e&&e.apply(this,arguments)||this;return t.arr=[],t}return __extends(z191,e),z191.prototype.update=function(t){g.app.getSelectedz1062();var e=g.app.pointerDownPosition,o=t.targets,i=o.destTarget,n=o.lookToTarget,s=o.moveToTarget,a=o.standToTarget,r=o.pointerDownPosition;if(t.currentObject&&!r.equals(e)){r.copyFrom(e),o.lastFramePointerMoved=g.app.frameNum,t.getPathToRef(e,this.arr);var c=t.physics.frontBody.body.position;if(0<this.arr.length&&(t.pathIndex=0,t.targetNode=this.arr[this.arr.length-1],t.path2.length=0,t.path2Index=0,t.copyPathFrom(this.arr),0<this.arr.length&&z1083.getSmoothPath(t.path2,t.path,c,e),t.pubsub.broadcast(g.z1061Events.NEW_PATH,this,t.path)),0==this.arr.length){var d=t.currentObject;if(!t.currentObject)return;if(t.currentObject.parent&&(d=t.currentObject.parent),-10<r.z&&!d.isInBox(r.x,r.y,r.z,1e-4))return}var p=t.path[0];g.app.getSelectedz1062(),p&&p.data.obj!=t.currentObject&&(p.data.enterEvent||(p.data.obj.parent,t.currentObject));var l=t.targets.pathTarget;if(i.set(e.x,e.y,e.z),0<t.path.length){var u=t.path[t.pathIndex];u&&(l.x=u.x,l.y=u.y,l.z=u.z)}if(t.currentObject.isInBox(e.x,e.y,e.z))0==this.arr.length&&(t.path.length=0,t.path2.length=0);else{var y=t.path[t.path.length-1];if(y&&t.currentObject.isInBox(y.x,y.y,y.z))return void(t.targetObject=t.currentObject)}t.targetObject=g.app.graphicsHelper.getObjectByPickInfo(g.app.pickInfo),n.x=e.x,n.y=e.y,n.z=e.z,a.x=n.x,a.y=n.y,a.z=n.z,s.x=e.x,s.y=e.y,s.z=e.z}},z191}(z767),t.z191=e}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z190(){return null!==t&&t.apply(this,arguments)||this}return __extends(z190,t),z190.prototype.update=function(t){var e=n.app.pointerDownPosition,o=t.targets,i=(o.destTarget,o.lookToTarget);o.standToTarget,o.moveToTarget.y,e.y;i.x=e.x,i.y=e.y,i.z=e.z},z190}(z767),t.z190=e}(z0||(z0={})),function(r){var t,e;t=r.z156||(r.z156={}),e=function(t){function z189(){return t.call(this)||this}return __extends(z189,t),z189.prototype.update=function(t){r.app.getSelectedz1062();var e=r.app.pointerMovePosition;if(!r.app.pointerMoveIsBelowBedding){var o=t.targets,i=o.destTarget,n=o.lookToTarget,s=o.moveToTarget,a=o.standToTarget;n.equals(e)||(o.lastFramePointerMoved=r.app.frameNum),i.equals(e)||i.set(e.x,e.y,e.z),t.avoidingObject||(n.x=e.x,n.y=e.y,n.z=e.z+0*t.size,a.x=n.x,a.y=n.y,a.z=n.z+0*t.size,s.x=e.x,s.y=e.y,s.z=e.z+0*t.size),t.minStandDist=5.5*t.size}},z189}(z767),t.z189=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z173(){var t=null!==e&&e.apply(this,arguments)||this;return t.scratchGlassTargSpeed=.1,t.scratchGlassTargRadiusX=.1,t.scratchGlassTargRadiusY=0,t.scratchGlassTargDistAbove=.6,t}return __extends(z173,e),z173.prototype.update=function(t){var e=t.targets.point1,o=t.cage;if(!t.isFollowingPath()&&o){var i=t.physics.frontBody.body.position;e.copyFrom(i),e.y=i.y;var n=this.scratchGlassTargDistAbove,s=this.scratchGlassTargRadiusX,a=this.scratchGlassTargRadiusY;e.y+=n,t.smoothRandomVec2.speed=this.scratchGlassTargSpeed,t.smoothRandomVec2.update(),e.x+=t.smoothRandomVec2.x*s,e.y+=t.smoothRandomVec2.y*a;e.z=o.front+.05,e.x>o.right-.05&&(e.x=o.right-.05),e.x<o.left+.05&&(e.x=o.left+.05),t.targets.destTarget.copyFrom(e),t.targets.setTargetsToDestination()}},z173}(z767),e.z173=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z167(){var t=null!==e&&e.apply(this,arguments)||this;return t.scratchGlassTargSpeed=.3,t.scratchGlassTargRadiusX=.3,t.scratchGlassTargRadiusY=0,t.scratchGlassTargDistAbove=.6,t}return __extends(z167,e),z167.prototype.update=function(t){var e=t.targets.point1,o=t.cage;if(!t.isFollowingPath()&&o){var i=t.physics.frontBody.body.position;e.copyFrom(i);var n=this.scratchGlassTargDistAbove,s=this.scratchGlassTargRadiusX,a=this.scratchGlassTargRadiusY;e.y+=n,t.smoothRandomVec2.speed=this.scratchGlassTargSpeed,t.smoothRandomVec2.update(),e.x+=t.smoothRandomVec2.x*s,e.y+=t.smoothRandomVec2.y*a;e.z=o.front+.05,e.x>o.right-.05&&(e.x=o.right-.05),e.x<o.left+.05&&(e.x=o.left+.05),t.targets.destTarget.copyFrom(e),t.targets.setTargetsToDestination()}},z167}(z767),e.z167=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z757(){return null!==t&&t.apply(this,arguments)||this}return __extends(z757,t),z757.prototype.update=function(t){t.physics.gravityFracOnGround=.2},z757}(z767),e.z757=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z516(){return null!==t&&t.apply(this,arguments)||this}return __extends(z516,t),z516.prototype.update=function(t){t.physics.gravityFracOnGround=0},z516}(z767),e.z516=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z442(){return null!==t&&t.apply(this,arguments)||this}return __extends(z442,t),z442.prototype.update=function(t){var e=t.physics,o=e.headBody,i=e.frontBody,n=e.rearBody;o.body.shapes.collisionSelfFrac=e.neckJoint.frac*e.headCollisionSelfFrac.value,i.body.shapes.collisionSelfFrac=e.frontJoint.frac,n.body.shapes.collisionSelfFrac=e.rearJoint.frac},z442}(z767),e.z442=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z440(){return null!==t&&t.apply(this,arguments)||this}return __extends(z440,t),z440.prototype.update=function(t){var e=t.physics,o=e.headBody,i=e.frontBody,n=e.rearBody;o.radius=o.radiusOrig*e.neckJoint.frac,i.radius=i.radiusOrig*e.frontJoint.frac,n.radius=n.radiusOrig*e.rearJoint.frac},z440}(z767),e.z440=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z383(){return null!==t&&t.apply(this,arguments)||this}return __extends(z383,t),z383.prototype.update=function(t){t.physics.headCollisionSelfFrac.targetValue=1,t.physics.headCollisionSelfFrac.lerpAmount=1},z383}(z767),e.z383=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z382(){return null!==t&&t.apply(this,arguments)||this}return __extends(z382,t),z382.prototype.update=function(t){t.physics.headCollisionSelfFrac.targetValue=0,t.physics.headCollisionSelfFrac.lerpAmount=1},z382}(z767),e.z382=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z607(){return null!==t&&t.apply(this,arguments)||this}return __extends(z607,t),z607.prototype.update=function(t){var e=t.bones.legFR,o=t.bones.legFL,i=z767.z4[0],n=e;n.bone3.getAbsolutePositionToRef(t.mesh,i);var s=i.x,a=i.y,r=i.z;(n=o).bone3.getAbsolutePositionToRef(t.mesh,i);var c=.5*(i.x+s),d=.5*(i.y+a),p=.5*(i.z+r);if(t.currentPickUpHead){var l=t.currentPickUpHead.position.x-c,u=t.currentPickUpHead.position.y-d,y=t.currentPickUpHead.position.z-p;l*l+y*y<.01&&Math.abs(u)<.03&&(t.currentPickUpHand=t.currentPickUpHead,t.currentPickUpHand.offsetPos.x=l,t.currentPickUpHand.offsetPos.y=u,t.currentPickUpHand.offsetPos.z=y,t.currentPickUpHand.offsetPos.x=0,t.currentPickUpHand.offsetPos.y=0,t.currentPickUpHand.offsetPos.z=0,t.currentPickUpHead=null)}if(t.currentPickUpHand){var g=t.currentPickUpHand.offsetPos,m=c+g.x,f=d+g.y,A=p+g.z;if(t.cage){var b=t.cage.bottom+t.currentPickUpHand.radius;f<b&&(f=b)}t.currentPickUpHand.setPosition(m,f,A)}},z607}(z767),e.z607=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z308(){return null!==t&&t.apply(this,arguments)||this}return __extends(z308,t),z308.prototype.update=function(t){t.targetPickUp&&(t.targetPickUp.owner||(t.food,t.targetPickUp.owner=t),t.targetPickUp.bone=t.bones.mouth.bone,t.currentPickUpHead=t.targetPickUp,t.currentPickUpHead.localPosition.copyFrom(t.bones.mouth.localPos),t.currentPickUpHead.updateWorldPositionFromLocalBone())},z308}(z767),e.z308=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z721(){return null!==t&&t.apply(this,arguments)||this}return __extends(z721,t),z721.prototype.update=function(t){var e=t.bones,o=e.bellyR,i=e.bellyL,n=.01*Math.sin(.1*t.frameNum);o.offsetPos.x+=n,i.offsetPos.x+=n},z721}(z767),e.z721=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z766(){return null!==t&&t.apply(this,arguments)||this}return __extends(z766,t),z766.prototype.update=function(t){var e=t.bones,o=e.bellyR.bone,i=e.bellyL.bone,n=e.chest.bone,s=e.spine1.bone,a=e.spine2.bone,r=e.shoulder.bone,c=e.legFR,d=e.legFL,p=e.legRR,l=e.legRL,u=.3*Math.max(p.moveY,l.moveY),y=.3*Math.max(c.moveY,d.moveY),g=s.getLocalMatrix();if(g._m[14]+=u,g._markAsUpdated(),(g=a.getLocalMatrix())._m[14]+=y-u,g._markAsUpdated(),(g=r.getLocalMatrix())._m[14]-=y,g._markAsUpdated(),o){var m=o.getLocalMatrix();m._m[14]-=.5*u,m._markAsUpdated(),(m=i.getLocalMatrix())._m[14]-=.5*u,m._markAsUpdated()}n&&((m=n.getLocalMatrix())._m[14]-=.5*y,m._markAsUpdated())},z766}(z767),e.z766=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z750(){return null!==t&&t.apply(this,arguments)||this}return __extends(z750,t),z750.prototype.update=function(t){var e=t.bones,o=e.bellyR,i=e.bellyL,n=e.legFR,s=e.legFL;e.legRR,e.legRL;o.offsetPos.x+=.1*n.moveZ,o.offsetPos.y+=.1*n.moveX,i.offsetPos.x+=.1*s.moveZ,i.offsetPos.y+=.1*s.moveX},z750}(z767),e.z750=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z747(){return null!==t&&t.apply(this,arguments)||this}return __extends(z747,t),z747.prototype.update=function(t){var e=t.bones,o=e.cheekR,i=e.cheekL,n=e.legFR,s=e.legFL;s.posed&&s.posed,n.posed&&n.posed;o.offsetPos.x+=.4*n.moveZ,o.offsetPos.y+=.4*n.moveX,o.offsetPos.z+=.4*n.moveY,i.offsetPos.x+=.4*s.moveZ,i.offsetPos.y+=.4*s.moveX,i.offsetPos.z+=.4*s.moveY,t.bones.bellyL.offsetPos.copyFrom(i.offsetPos),t.bones.bellyR.offsetPos.copyFrom(o.offsetPos)},z747}(z767),e.z747=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z744(){return null!==t&&t.apply(this,arguments)||this}return __extends(z744,t),z744.prototype.update=function(t){var e=t.bones,o=e.tail,i=e.legRR,n=e.legRL;o.yaw=n.moveX-i.moveX},z744}(z767),e.z744=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z740(){var t=null!==e&&e.apply(this,arguments)||this;return t.shiftShoulderY=0,t.shoulderYaw=0,t.shoulderPitch=0,t.TEST_POS_X=0,t.TEST_POS_Y=0,t.TEST_POS_Z=0,t.TEST_BELLY_R=0,t.TEST_BELLY_L=0,t}return __extends(z740,e),z740.prototype.update=function(t){var e,o,i,n,s=(L=t.physics).frontBody.body,a=L.middleBody.body,r=L.rearBody.body,c=z767.tempVecs[0],d=z767.tempQuats[0],p=z767.tempQuats[1],l=z767.tempBabQuats[0],u=t.bones,y=u.bellyR.bone,g=u.bellyL.bone,m=u.chest.bone,f=u.spine1.bone,A=u.spine1a.bone,b=u.spine2.bone,v=u.tail.bone,x=u.shoulder.bone,C=u.hip.bone,S=u.bellyR.origPos,T=u.shoulder.origPos,B=u.spine1.origPos,O=u.spine1a.origPos,P=u.spine2.origPos,M=u.hip.origPos,I=u.chest.origPos,N=t.bones.head,z=t.physics.rearBody.standAng.value,w=z/-1.4;1<w&&(w=1),w<0&&(w=0),e=t.mesh.position,o=a.position,t.isMenuItem&&t.isMenuItem,e.x=o.x,e.y=o.y,e.z=o.z;var _=z767.z4[0];f.setYawPitchRoll(0,0,Math.PI),_.x=0,_.y=1,_.z=0,f.rotate(_,.5*-u.shoulder.yaw.value),d.copy(r.orientation);var R=t.physics.rearBody.rotationElements;c.x=R[1],c.y=R[4],c.z=R[7],p.setFromAxisAngle(c,Math.PI),d.mul(p,d),(i=t.mesh.rotationQuaternion).x=d.x,i.y=d.y,i.z=d.z,i.w=d.s,d.invert(s.orientation),d.mul(d,r.orientation),l.x=d.x,l.y=d.z,l.z=d.y,l.w=d.s,b.setRotationQuaternion(l),A.setRotationQuaternion(l),(n=A.getLocalMatrix())._m[12]=O.x+t.bones.spine2.offsetPos.x+this.TEST_POS_X,n._m[13]=O.y+t.bones.spine2.offsetPos.y+this.TEST_POS_Y,n._m[14]=O.z+t.bones.spine2.offsetPos.x+this.TEST_POS_Z,n._markAsUpdated(),_.x=0,_.y=0,_.z=1,b.rotate(_,.3*u.shoulder.yaw.value),A.rotate(_,.4*u.shoulder.yaw.value);var L,F=L.middleBody.body.position,D=L.rearBody.body.position,E=F.x-D.x,k=F.y-D.y,j=F.z-D.z,V=Math.sqrt(E*E+k*k+j*j),G=1/t.mesh.scaling.x,W=(t.physics.rearJoint.frac-1)*t.physics.rearJoint.len*1,Y=V*G-(W=Math.min(1*t.size,W)),U=(L=t.physics).stretchFrac;(n=b.getLocalMatrix())._m[12]=P.x,n._m[13]=Y+t.bones.spine2.offsetPos.y,n._m[14]=P.z,n._markAsUpdated(),(n=f.getLocalMatrix())._m[12]=B.x,n._m[13]=Y,n._m[14]=B.z,n._markAsUpdated(),(n=C.getLocalMatrix())._m[12]=M.x,n._m[13]=1.5*t.size+w*t.size*.5,n._m[14]=M.z,n._markAsUpdated(),c.x=0,c.y=1,c.z=0,d.setFromAxisAngle(c,.5*-Math.PI),c.x=0,c.y=0,c.z=1;var X=u.hip.pitch.value;p.setFromAxisAngle(c,.5*-Math.PI+z+X),d.mul(d,p),l.x=d.x,l.y=d.y,l.z=d.z,l.w=d.s,C.setRotationQuaternion(l);var Z=u.tail;_.x=Z.origPos.x,_.y=Z.origPos.y,_.z=Z.origPos.z+Z.offsetZ.value,v.setPosition(_),p.setFromAxisAngle(c,Z.ang-.4*U),d.mul(d,p),c.x=1,c.y=0,c.z=0,p.setFromAxisAngle(c,Z.yaw),d.mul(d,p),l.x=d.x,l.y=d.y,l.z=d.z,l.w=d.s,v.setRotationQuaternion(l),x.setYawPitchRoll(.5*Math.PI,0,.5*Math.PI),_.x=0,_.y=0,_.z=1,x.rotate(_,.5*u.shoulder.yaw.value),_.x=1,_.y=0,_.z=0,x.rotate(_,u.shoulder.pitch.value),_.x=0,_.y=1,_.z=0,x.rotate(_,u.shoulder.roll.value);var q=x.getLocalMatrix(),Q=(N.pitch+N.offsetAng)/(4*Math.PI);0<(Q*=w)&&(Q=0);var J=2*Q;q._m[13]=T.y+J;var K=t.bones.shoulder.offsetPos;if(q._m[12]=T.x+K.x,q._m[13]=T.y+K.y,q._m[14]=T.z+K.z,q._markAsUpdated(),y){K=t.bones.bellyR.offsetPos;var $=y.getLocalMatrix();$._m[12]=S.x+K.x,$._m[13]=S.y+J+K.y,$._m[14]=S.z+K.z,$._markAsUpdated(),u.bellyR.angFrac=t.pouchFilledFracRight,u.bellyL.angFrac=t.pouchFilledFracLeft,K=t.bones.bellyL.offsetPos,($=g.getLocalMatrix())._m[12]=-(S.x+K.x),$._m[13]=S.y+J+K.y,$._m[14]=S.z+K.z,$._markAsUpdated()}m&&($=m.getLocalMatrix(),K=t.bones.chest.offsetPos,$._m[13]=I.y+.6*J+K.x,$._m[14]=I.z+K.z,$._markAsUpdated())},z740}(z767),e.z740=o}(z0||(z0={})),function(Nt){var t,e;t=Nt.z156||(Nt.z156={}),e=function(e){function z739(){var t=null!==e&&e.apply(this,arguments)||this;return t.frameNum=1,t.fracHeadForward=1,t.headPitch=0,t.switchYaw=!1,t.frontFrac=1,t.fracNeckToSpine=.5,t.switchNeckAlign=!1,t.TEST_CHEEK_R=0,t.TEST_CHEEK_L=0,t.TEST_CHEEK_X=0,t}return __extends(z739,e),z739.prototype.update=function(t){this.frameNum!=t.frameNum-1&&this.frameNum;var e=z767.z4[0],o=z767.z4[1];z767.z4[2];this.frameNum=t.frameNum;var i,n=t.physics,s=n.frontBody.body,a=z767.tempVecs[0],r=z767.tempVecs[1],c=z767.tempVecs[2],d=z767.tempVecs[3],p=z767.tempBabMats[0],l=z767.tempBabMats[1],u=z767.tempBabMats[2],y=t.bones,g=y.head.bone,m=y.neck.bone,f=y.cheeks.bone,A=y.cheekR.bone,b=y.cheekL.bone,v=y.ears.bone,x=y.head.origPos,C=y.neck.origPos,S=y.ears.origPos,T=y.cheekR.origPos,B=y.mouth.origPos,O=n.middleBody.body.position,P=n.frontBody.body.position,M=n.headBody.body.position,I=O.x-P.x,N=O.y-P.y,z=O.z-P.z,w=Math.sqrt(I*I+N*N+z*z),_=1/t.mesh.scaling.x,R=t.mesh.scaling.x,L=w*_*this.frontFrac,F=(x.y,x.y*R-0),D=(I=M.x-P.x,N=M.y-P.y,z=M.z-P.z,Math.sqrt(I*I+N*N+z*z)/F),E=(0+D*F)*_;E-=.25,this.switchNeckAlign&&(e.x=M.x,e.y=M.y,e.z=M.z,m.getLocalPositionFromAbsoluteToRef(e,t.mesh,e),E=e.y-t.size*_*.75);var k=t.bones.head;(i=m.getLocalMatrix())._m[12]=C.x,i._m[13]=L,i._m[14]=C.z,i._markAsUpdated(),(i=g.getLocalMatrix())._m[12]=x.x,i._m[13]=E,i._m[14]=x.z,i._markAsUpdated();var j=t.physics.frontBody.rotationElements,V=t.physics.middleBody.rotationElements,G=t.physics.headBody.rotationElements,W=j,Y=.5*(-t.physics.frontBody.standAng.value/(.5*Math.PI)+-t.physics.rearBody.standAng.value/(.5*Math.PI));d.x=G[2],d.y=G[5],d.z=G[8],c.x=V[1],c.y=V[4],c.z=V[7],r.x=V[0],r.y=V[3],r.z=V[6],a.x=j[2],a.y=j[5],a.z=j[8];var U=G[2],X=G[5],Z=G[8],q=U*W[1]+X*W[4]+Z*W[7];1<q?q=1:q<-1&&(q=-1);var Q=Math.asin(q),J=!1,K=!1;if(t.cage&&M.y<t.cage.bottom+t.size){M.y,t.cage.bottom;t.size;var $=.2*-Math.PI;Q<$&&(Q=$);var tt=t.physics.middleBody.rotationElements[3];.5<tt&&(J=!0),tt<-.5&&(K=!0)}var et=d.dot(a);a.x=W[1],a.y=W[4],a.z=W[7];var ot=d.dot(a),it=1-et;1<it&&(it=1);var nt=t.physics.rearBody.standAng.value;-1.4<nt&&(nt=-1.4);var st=it*Y,at=1-st,rt=-ot,ht=-(st*nt+at*(Q-=2*Math.abs(Q+.5*Math.PI)*rt*st));e.x=r.x,e.y=r.y,e.z=r.z,BABYLON.Matrix.RotationAxisToRef(e,ht,p),o.x=c.x,o.y=c.y,o.z=c.z,BABYLON.Vector3.TransformNormalToRef(o,p,e),o.x=d.x,o.y=d.y,o.z=d.z,BABYLON.Matrix.RotationAxisToRef(o,k.roll.value,u),BABYLON.Vector3.TransformNormalToRef(e,u,e),c.x=e.x,c.y=e.y,c.z=e.z;var ct=z767.tempVecs[4];ct.x=G[2],ct.y=G[5],ct.z=G[8];var dt=ct.x,pt=ct.y,lt=ct.z;if((J||K)&&pt<0){var ut=Math.sqrt(dt*dt+lt*lt);dt/=ut,pt=0,lt/=ut,ct.x=dt,ct.y=pt,ct.z=lt}r.x=j[0],r.y=j[3],r.z=j[6],d.cross(r,c),d.normalize(d);var yt=dt*r.x+pt*r.y+lt*r.z,gt=dt*c.x+pt*c.y+lt*c.z,mt=dt*d.x+pt*d.y+lt*d.z,ft=Math.atan2(yt,mt);isNaN(ft),1<gt?gt=1:gt<-1&&(gt=-1);var At=Q*at+Math.asin(gt)*st;d.x=ct.x,d.y=ct.y,d.z=ct.z,r.x=V[0],r.y=V[3],r.z=V[6],r.cross(d,c),r.normalize(r),c.cross(r,d),c.normalize(c),this.axisviewer&&this.axisviewer.update(s.position,r,c,d),dt=ct.x,pt=ct.y,lt=ct.z,k.yaw=ft,k.pitch=-At;var bt=p,vt=l;bt._m[0]=r.x,bt._m[1]=r.y,bt._m[2]=r.z,bt._m[3]=0,bt._m[4]=d.x,bt._m[5]=d.y,bt._m[6]=d.z,bt._m[7]=0,bt._m[8]=c.x,bt._m[9]=c.y,bt._m[10]=c.z,bt._m[11]=0,bt._m[12]=0,bt._m[13]=0,bt._m[14]=0,bt._m[15]=1,bt._markAsUpdated(),k.offsetAng&&(BABYLON.Matrix.RotationAxisToRef(BABYLON.Axis.X,k.offsetAng,vt),vt.multiplyToRef(bt,bt)),o.x=j[1],o.y=j[4],o.z=j[7];z1.Dot(o,c);if(m.setRotationMatrix(bt,BABYLON.Space.WORLD,t.mesh),a.x=1,a.y=0,a.z=0,k.pitch=1*At,f){f.setRotationMatrix(bt,BABYLON.Space.WORLD,t.mesh);var xt=t.bones.cheekR.offsetPos,Ct=2*Math.min(0,E),St=t.pouchFilledFracRight,Tt=t.pouchFilledFracLeft,Bt=0,Ot=.5,Pt=0;t.currentObject&&t.currentObject.accType==Nt.z1044.z1051&&(Ot=Bt=0,Pt=-.05),e.x=T.x+xt.x+St*Bt+Pt,e.y=T.y+xt.y+Ct+-.1*St,e.z=T.z+xt.z*(1-Y)+0*St,A.setPosition(e),e.x=1+St*Ot,e.y=1+.5*St,e.z=1+.5*St,A.setScale(e),xt=t.bones.cheekL.offsetPos,e.x=-T.x-xt.x-Tt*Bt-Pt,e.y=T.y+xt.y+Ct+-.1*Tt,e.z=T.z+xt.z*(1-Y)+0*Tt,b.setPosition(e),e.x=1+Tt*Ot,e.y=1+.5*Tt,e.z=1+.5*Tt,b.setScale(e)}if(v){var Mt=t.bones.ears.offsetPos;e.x=S.x+Mt.x,e.y=S.y+Mt.y,e.z=S.z+Mt.z,v.setPosition(e)}if(t.bones.mouth.bone){var It=t.bones.mouth.offsetPos;e.x=B.x+It.x,e.y=B.y+It.y,e.z=B.z+It.z,t.bones.mouth.bone.setPosition(e)}},z739}(z767),t.z739=e}(z0||(z0={})),function(t){var g,e;g=t.z156||(t.z156={}),e=function(e){function z736(){var t=null!==e&&e.apply(this,arguments)||this;return t.footAngles=[.5*Math.PI],t.scratchSpeed=1,t.scratchStride=.2,t.scratchFootAngle=.58,t.footOffsetZ=-.05,t}return __extends(z736,e),z736.prototype.update=function(t){var e=t.bones,o=e.legFR,i=e.legFL;if(i.bone1){var n=.4;n=.35,(n=.8)<(n=this.scratchSpeed*t.adjustLerp)&&(n=.8),t.bones.legTickFront+=n;var s=t.bones.legTickFront,a=this.scratchStride,r=t.maxStepHeight,c=t.maxStride;c<a&&(a=c);Math.PI,Math.PI;-1*Math.PI+1,-1*Math.PI+1,1.57;var d=s,p=s+3.14,l=.75*r;l=t.maxStepHeight*(a/c),l*=.75,o.posed=!0,i.posed=!0,this.footAngles[0]=this.scratchFootAngle;var u,y=t.currentObject;y&&y.bindedKeepPosInside&&t.rearObject==y&&(u=y.bindedKeepPosInside),o.updateStep2(p,a,l,1*o.distToGround,this.footAngles,g.z732.frontFootHeights,1,u),i.updateStep2(d,a,l,1*i.distToGround,this.footAngles,g.z732.frontFootHeights,2,u),i.footOffsetZ_.targetValue=-this.footOffsetZ,o.footOffsetZ_.targetValue=this.footOffsetZ}},z736.frontFootAngles=[],z736.frontFootHeights=[],z736.rearFootHeights=[],z736}(z767),g.z736=e}(z0||(z0={})),function(s){var t,e;t=s.z156||(s.z156={}),e=function(e){function z735(){var t=null!==e&&e.apply(this,arguments)||this;return t.pawRotationTargetWalk=BABYLON.Quaternion.RotationYawPitchRoll(.5*-Math.PI,0,.5*Math.PI),t}return __extends(z735,e),z735.prototype.update=function(t){s.app.world.timeStep;var e=t.adjustLerp,o=t.bones,i=o.legFR,n=o.legFL;o.legRR,o.legRL,t.physics;t.isStanding()?(n.posed?n.ikCtrl.slerpAmount=z1.lerpNumber(n.ikCtrl.slerpAmount,1,.01*e):(n.ikCtrl.slerpAmount=.05*e,n.pawSlerpAmount=.05*e,n.ikCtrl.slerpAmount=.1*e,n.pawSlerpAmount=.1*e),i.posed?i.ikCtrl.slerpAmount=z1.lerpNumber(i.ikCtrl.slerpAmount,1,.01*e):(i.ikCtrl.slerpAmount=.05*e,i.pawSlerpAmount=.05*e,i.ikCtrl.slerpAmount=.1*e,i.pawSlerpAmount=.1*e),n.updatePose(),i.updatePose(),n.moveWithBody=1,i.moveWithBody=1):(n.posed&&(n.ikCtrl.slerpAmount=.1*e,n.posed=!1),i.posed&&(i.ikCtrl.slerpAmount=.1*e,i.posed=!1))},z735}(z767),t.z735=e}(z0||(z0={})),function(x){var t,e;t=x.z156||(x.z156={}),e=function(e){function z734(){var t=null!==e&&e.apply(this,arguments)||this;return t.TEST_FRAC_X=-.05,t.TEST_FRAC_Y=-.5,t}return __extends(z734,e),z734.prototype.update=function(t){if(t.currentObject&&t.currentObject.accType==x.z1044.z1048){var e=t.bones.legFR,o=t.bones.legFL;if(t.standing){var i=t.physics.frontBody.standAng.value/-1.4,n=t.getStandFrac();if(i<.4||n<.4)o.posed&&e.posed&&(o.reset(),e.reset());else{var s=t.physics.rearBody.standAng.value,a=Math.sin(-s),r=.3*a;this.TEST_FRAC_X,this.TEST_FRAC_Y,e.offsetBone1Pos.x=r*this.TEST_FRAC_X,e.offsetBone1Pos.y=r*this.TEST_FRAC_Y,o.offsetBone1Pos.x=r*this.TEST_FRAC_X,o.offsetBone1Pos.y=r*this.TEST_FRAC_Y;var c=t.physics.frontBody.body.position,d=t.cage.front+t.cage.wallThickness,p=c.z-d,l=2*t.size,u=-1.4*t.size*a;if(l<p)return t.rotatePawDown(o),t.rotatePawDown(e),void t.poseFrontLegs(!0,!0,.3,0,u);var y=z767.z4[0],g=z767.z4[1],m=t.physics.frontBody.rotationElements;if(g.x=m[1],g.y=m[4],g.z=m[7],y.x=0,y.y=0,y.z=1,BABYLON.Vector3.Dot(g,y)<.1)return t.rotatePawDown(o),t.rotatePawDown(e),void t.poseFrontLegs(!0,!0,.3,0,u);var f=z767.z4[2];f.x=m[0],f.y=m[3],f.z=m[6],y.z=-1;var A=BABYLON.Vector3.Dot(f,y);f.scaleInPlace(-1);var b=!1,v=!1;if(-.9<A&&(v=!0),-.9<BABYLON.Vector3.Dot(f,y)&&(b=!0),v&&b)return e.posed&&e.reset(),void(o.posed&&o.reset());b?o.posed&&o.reset():t.rotatePawDown(o),v?e.posed&&e.reset():t.rotatePawDown(e),t.poseFrontLegs(!b,!v,.3,0,u)}}else o.posed&&e.posed&&(o.reset(),e.reset())}},z734}(z767),t.z734=e}(z0||(z0={})),function(m){var t,e;t=m.z156||(m.z156={}),e=function(e){function z733(){var t=null!==e&&e.apply(this,arguments)||this;return t.TEST_HALF_STAND_X=-.3,t}return __extends(z733,e),z733.prototype.update=function(t){if(t.currentObject&&t.currentObject.accType==m.z1044.z1048&&!t.usingObject){var e=t.physics.frontBody.standAng.value/-1.4,o=t.bones.chest,i=t.getStandFrac(),n=t.bones.legFL,s=t.bones.legFR,a=!1,r=!1,c=!0,d=!1;if(e<.3&&i<.3?c=!1:e<.4||i<.4||(c=!1),n.posed&&s.posed&&(d=!(c=!1)),t.standing||(c=!1),c?(n.posed||s.posed?n.posed?a=!0:s.posed&&(r=!0):n.onGround?s.onGround||(r=!0):a=!0,a&&(t.rotatePawDown(n),t.poseFrontLegs(!0,!1)),r&&(t.rotatePawDown(s),t.poseFrontLegs(!1,!0))):(d||(n.posed?(n.reset(),n.moveWithBody=30):s.posed&&(s.reset(),s.moveWithBody=30)),r=a=!1),0<i&&i<.4&&e<.4&&!d){var p=t.physics.rearBody.standAng.value,l=Math.sin(-p),u=-.45;t.standing||(u=-.2);var y,g=l*u;(y=s).posed||(y.footOffsetZ_.targetValue=.1*-l,y.footOffsetY.targetValue=.8*g,y.offsetBone1Pos.x=.4*g,y.offsetBone1Pos.y=.2*g,y.offsetBone1Pos.z=.15*-l,t.halfStanding||(y.moveWithBody=30)),(y=n).posed||(y.footOffsetZ_.targetValue=.1*l,y.footOffsetY.targetValue=.8*g,y.offsetBone1Pos.x=.4*g,y.offsetBone1Pos.y=.2*g,y.offsetBone1Pos.z=.15*l,t.halfStanding||(y.moveWithBody=30)),t.halfStanding=!0,o.targOffsetZ.targetValue=s.offsetBone1Pos.y+n.offsetBone1Pos.y}else if(t.halfStanding){n.footOffsetX_.targetValue=0,s.footOffsetX_.targetValue=0,n.footOffsetY.targetValue=0,s.footOffsetY.targetValue=0,n.footOffsetZ_.targetValue=0,s.footOffsetZ_.targetValue=0,n.offsetBone1Pos.x=0,n.offsetBone1Pos.y=0,n.offsetBone1Pos.z=0,n.offsetBone1Lerp=.1,s.offsetBone1Pos.x=0,s.offsetBone1Pos.y=0,s.offsetBone1Pos.z=0,s.offsetBone1Lerp=.1,t.halfStanding&&(s.moveWithBody=30,n.moveWithBody=30),o.targOffsetZ.targetValue=s.offsetBone1Pos.y+n.offsetBone1Pos.y,t.halfStanding=!1}}},z733}(z767),t.z733=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(n){function z732(){var t=n.call(this)||this;t.stride=0;for(var e=z732.frontFootAngles,o=z732.frontFootHeights,i=0;i<e.length;i++)o[i]=.1*Math.sin(e[i]);e=z732.rearFootAngles,o=z732.rearFootHeights;for(i=0;i<e.length;i++)o[i]=.1*Math.sin(e[i]);return t}return __extends(z732,n),z732.prototype.update=function(t){var e=t.bones,o=e.legFR,i=e.legFL,n=e.legRR,s=e.legRL;if(i.bone1){var a=t.localPos,r=t.lastPos,c=a.x-r.x,d=a.y-r.y,p=a.z-r.z,l=c*c+d*d+p*p,u=Math.sqrt(l),y=.4;y=.35,(y=.8)<(y=t.adjustLerp)&&(y=.8),y*=.3+.7*t.runSpeedFrac,t.bones.legTickRear+=y;var g=t.bones.legTickRear,m=0;m=100*u,m=3*u;var f=t.maxStepHeight,A=t.maxStride;A<(m=Math.max(m,A))&&(m=A);Math.PI,Math.PI;-1*Math.PI+1,-1*Math.PI+1;var b=g,v=g+1.57,x=g+3.14,C=g+4.71,S=.75*f;S=t.maxStepHeight*(m/A),S*=.75;var T=void 0;t.currentObject&&(T=t.currentObject.bindedKeepPosInside),o.updateStep2(x,m,S,1*o.distToGround,null,z732.frontFootHeights,1,T),i.updateStep2(b,m,S,1*i.distToGround,null,z732.frontFootHeights,2,T),n.updateStep2(v,m,S,1*n.distToGround,z732.rearFootAngles,z732.rearFootHeights,3,T),s.updateStep2(C,m,S,1*s.distToGround,z732.rearFootAngles,z732.rearFootHeights,4,T)}},z732.frontFootAngles=[],z732.rearFootAngles=[.25*Math.PI,.25*Math.PI,.05*Math.PI,.05*Math.PI,.05*Math.PI,.05*Math.PI,.25*Math.PI,.25*Math.PI,.75*Math.PI,.5*Math.PI,.15*Math.PI,.15*Math.PI,.15*Math.PI,.15*Math.PI,.15*Math.PI,.15*Math.PI],z732.frontFootHeights=[],z732.rearFootHeights=[],z732}(z767),e.z732=o}(z0||(z0={})),function(V){var l,t;l=V.z156||(V.z156={}),t=function(n){function z731(){var t=n.call(this)||this;t.pawRotationTargetWalkR=BABYLON.Quaternion.RotationYawPitchRoll(0,0,0),t.strideMult=1,t.TEST_REAR_PAW_YAW=0,t.TEST_REAR_PAW_PITCH=0,t.TEST_REAR_PAW_ROLL=0,t.TEST_MAX_STEP_HEIGHT=.1,t.TEST_LERP_STEP=0,t.TEST_DIST_TO_GROUND=0,t.legTickMult=22,t.maxLerpLerp=.3,t.minLerpLerp=.3,t.maxStrideMult=1.65,t.minStrideMult=1,t.tempArr1=[],t.tempArr2=[];for(var e=z731.frontFootAngles,o=z731.frontFootHeights,i=0;i<e.length;i++)o[i]=Math.sin(e[i]);e=z731.rearFootAngles,o=z731.rearFootHeights;for(i=0;i<e.length;i++)o[i]=Math.sin(e[i]);return t}return __extends(z731,n),z731.prototype.update=function(t,e){var o=V.app.world.timeStep,i=t.bones,n=i.legFR,s=i.legFL,a=i.legRR,r=i.legRL;if(s.bone1){var c=t.translated.x,d=t.translated.y,p=t.translated.z,l=t.localPosFront.x-t.lastPosFront.x,u=t.localPosFront.y-t.lastPosFront.y,y=t.localPosFront.z-t.lastPosFront.z,g=t.localPosMid.x-t.lastPosMid.x,m=t.localPosMid.y-t.lastPosMid.y,f=t.localPosMid.z-t.lastPosMid.z,A=t.localPosRear.x-t.lastPosRear.x,b=t.localPosRear.y-t.lastPosRear.y,v=t.localPosRear.z-t.lastPosRear.z;l-=c,u-=d,y-=p,A-=c,b-=d,v-=p,g-=c,m-=d,f-=p,s.posed&&n.posed?(l=A,u=b,y=v):(l=(l+A+g)/3,u=(u+b+m)/3,y=(y+v+f)/3);var x,C=l*l+u*u+y*y;x=Math.sqrt(C);var S=this.legTickMult*o,T=(Math.max(t.walkSpeed,.5)-.5)/.5;this.strideMult=(1-T)*(this.maxStrideMult-this.minStrideMult)+this.minStrideMult,S/=this.strideMult,t.bones.legTickRear+=S;var B=t.bones.legTickRear,O=0;O=.12*x/o,O*=this.strideMult;var P=.75*t.maxStepHeight,M=t.maxStride;P*=t.walkSpeed,M<O&&(O=M),O<.001&&(i.legTickRear=Math.random()*Math.PI*2);var I,N,z=Math.PI,w=(Math.PI,z=Math.PI+.15*Math.PI),_=Math.PI,R=B+-.28*Math.PI+_,L=(w=B+-.28*Math.PI,B+Math.PI+_),F=B+Math.PI;t.usingObject&&t.usingObject.bindedKeepPosInside&&t.usingObject.body==t.physics.stayInsideBody?(N=t.usingObject.bindedKeepPosInside,I=t.usingObject.bindedKeepPosInside):(t.platformUnder?(N=t.platformUnder.bindedKeepPosInside,I=t.platformUnder.bindedKeepPosInside):t.currentObject&&(N=t.currentObject.bindedKeepPosInside,I=t.currentObject.bindedKeepPosInside),t.rearObject&&t.rearObject!=t.currentObject&&(I=t.rearObject.bindedKeepPosInside));var D=z731.rearFootAngles,E=z731.rearFootHeights,k=t.physics.stretchFrac;.001<k&&(D=this.tempArr1,E=this.tempArr2,D[0]=.5*k,E[0]=0);var j=T*(this.maxLerpLerp-this.minLerpLerp)+this.minLerpLerp;n.posed?n.posed:(n.updateStep(w,O,P,z731.frontFootAngles,z731.frontFootHeights,j,N),n.setPawRotationTarget(this.pawRotationTargetWalkR)),s.posed?s.posed:(s.updateStep(R,O,P,z731.frontFootAngles,z731.frontFootHeights,j,N),s.setPawRotationTarget(this.pawRotationTargetWalkR)),a.posed?a.posed:a.updateStep(F,O,P,D,E,j,I),r.posed?r.posed:r.updateStep(L,O,P,D,E,j,I),s.initLerpStep=this.TEST_LERP_STEP,n.initLerpStep=this.TEST_LERP_STEP,r.initLerpStep=this.TEST_LERP_STEP,a.initLerpStep=this.TEST_LERP_STEP,t.testLastStride=O}},z731.prototype.resetWalk=function(t){var e=t.bones;e.hardReset();var o=e.legFR,i=e.legFL,n=e.legRR,s=e.legRL,a=l.z731.frontFootAngles,r=l.z731.frontFootHeights,c=l.z731.rearFootAngles,d=l.z731.rearFootHeights,p=this.pawRotationTargetWalkR;o.setPawRotationTarget(p),i.setPawRotationTarget(p),s.setPawRotationTarget(p),n.setPawRotationTarget(p),o.setPawRotation(p),i.setPawRotation(p),s.setPawRotation(p),n.setPawRotation(p),o.updateStep(0,0,0,a,r),i.updateStep(0,0,0,a,r),n.updateStep(0,0,0,c,d),s.updateStep(0,0,0,c,d)},z731.rearFootAngles=[0,0,0,0,0,0,0,0,.25*Math.PI,.25*Math.PI,.15*Math.PI,.15*Math.PI,.15*Math.PI,.15*Math.PI,0,0],z731.frontFootAngles=[0],z731.frontFootHeights=[0],z731.rearFootHeights=[0],z731}(z767),l.z731=t}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z700(){return null!==t&&t.apply(this,arguments)||this}return __extends(z700,t),z700.prototype.update=function(t){t.whiskers.move(),t.bones.head.updateChew(),t.bones.mouth.offsetPos.z=.01*t.bones.head.sinAng},z700}(z767),e.z700=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z699(){return null!==t&&t.apply(this,arguments)||this}return __extends(z699,t),z699.prototype.update=function(t){t.currentPickUpHand&&(t.whiskers.move(.2,.1),t.bones.head.updateChew(),t.bones.mouth.offsetPos.z=.01*t.bones.head.sinAng)},z699}(z767),e.z699=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z697(){return null!==t&&t.apply(this,arguments)||this}return __extends(z697,t),z697.prototype.update=function(t){t.bones.head.updateChew(.5,.03),t.bones.mouth.offsetPos.z=.01*t.bones.head.sinAng},z697}(z767),e.z697=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z644(){return null!==t&&t.apply(this,arguments)||this}return __extends(z644,t),z644.prototype.update=function(t){t.setEyesCloseAmount(1)},z644}(z767),e.z644=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z643(){return null!==t&&t.apply(this,arguments)||this}return __extends(z643,t),z643.prototype.update=function(t){t.setEyesCloseAmount(0)},z643}(z767),e.z643=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z642(){return null!==t&&t.apply(this,arguments)||this}return __extends(z642,t),z642.prototype.update=function(t){t.setEyesCloseAmount(.3)},z642}(z767),e.z642=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z596(){return null!==t&&t.apply(this,arguments)||this}return __extends(z596,t),z596.prototype.update=function(t){var e=t.cage;if(e){t.hsm;var o=-.4,i=.4,n=e.bottom+.02,s=e.left+.02,a=e.right-.02,r=t.physics.headBody.body,c=r.position,d=r.shapes.radius,p=n+d,l=s+d,u=a+d;0==e.body.shapes.holes.length&&(i=o=0),(c.z<o||c.z>i)&&(c.y<p&&(c.y=p,r.shapes.position.y=p,r.syncShapes()),c.x<l?(c.x=l,r.shapes.position.x=l,r.syncShapes()):c.x>u&&(c.x=u,r.shapes.position.x=u,r.syncShapes())),c=(r=t.physics.frontBody.body).position,p=n+(d=r.shapes.radius),l=s+d,u=a+d,(c.z<o||c.z>i)&&(c.y<p&&(c.y=p,r.shapes.position.y=p,r.syncShapes()),c.x<l?(c.x=l,r.shapes.position.x=l,r.syncShapes()):c.x>u&&(c.x=u,r.shapes.position.x=u,r.syncShapes())),c=(r=t.physics.middleBody.body).position,p=n+(d=r.shapes.radius),l=s+d,u=a+d,(c.z<o||c.z>i)&&(c.y<p&&(c.y=p,r.shapes.position.y=p,r.syncShapes()),c.x<l?(c.x=l,r.shapes.position.x=l,r.syncShapes()):c.x>u&&(c.x=u,r.shapes.position.x=u,r.syncShapes())),c=(r=t.physics.rearBody.body).position,p=n+(d=r.shapes.radius),l=s+d,u=a+d,(c.z<o||c.z>i)&&(c.y<p&&(c.y=p,r.shapes.position.y=p,r.syncShapes()),c.x<l?(c.x=l,r.shapes.position.x=l,r.syncShapes()):c.x>u&&(c.x=u,r.shapes.position.x=u,r.syncShapes()))}},z596}(z767),e.z596=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z594(){return null!==t&&t.apply(this,arguments)||this}return __extends(z594,t),z594.prototype.update=function(t){t.physics.neckJoint.lerpAmount=.5*t.adjustLerp,t.physics.frontJoint.lerpAmount=.5*t.adjustLerp,t.physics.rearJoint.lerpAmount=.5*t.adjustLerp},z594}(z767),e.z594=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z555(){var t=null!==e&&e.apply(this,arguments)||this;return t.amount=0,t.frac=.2,t}return __extends(z555,e),z555.prototype.update=function(t){t.bones.mouth.offsetPos.y=-this.amount*this.frac,t.bones.mouth.offsetPos.z=-this.amount},z555}(z767),e.z555=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z547(){return null!==t&&t.apply(this,arguments)||this}return __extends(z547,t),z547.prototype.update=function(t){t.bones.ears.offsetZ.targetValue=-.15,t.bones.ears.offsetY.targetValue=-.15},z547}(z767),e.z547=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z546(){return null!==t&&t.apply(this,arguments)||this}return __extends(z546,t),z546.prototype.update=function(t){t.bones.ears.offsetZ.targetValue=0,t.bones.ears.offsetY.targetValue=0},z546}(z767),e.z546=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z545(){return null!==t&&t.apply(this,arguments)||this}return __extends(z545,t),z545.prototype.update=function(t){var e=t.cage;if(e){var o=z767.z4[0],i=t.bones.legFL;i.bone3.getAbsolutePositionToRef(t.mesh,o),e.bindedKeepPosInside(o)&&(i.ikCtrl.targetPosition.copyFrom(o),i.ikCtrl.slerpAmount=1,i.ikCtrl.update()),(i=t.bones.legFR).bone3.getAbsolutePositionToRef(t.mesh,o),e.bindedKeepPosInside(o)&&(i.ikCtrl.targetPosition.copyFrom(o),i.ikCtrl.slerpAmount=1,i.ikCtrl.update()),(i=t.bones.legRL).bone3.getAbsolutePositionToRef(t.mesh,o),e.bindedKeepPosInside(o)&&(i.ikCtrl.targetPosition.copyFrom(o),i.ikCtrl.slerpAmount=1,i.ikCtrl.update()),(i=t.bones.legRR).bone3.getAbsolutePositionToRef(t.mesh,o),e.bindedKeepPosInside(o)&&(i.ikCtrl.targetPosition.copyFrom(o),i.ikCtrl.slerpAmount=1,i.ikCtrl.update()),datgui&&t.pubsub.broadcast("isFalling",t)}},z545}(z767),e.z545=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z543(){var t=null!==e&&e.apply(this,arguments)||this;return t.maxFootOffsetZ_=.063,t.maxFootOffsetX_=.21,t}return __extends(z543,e),z543.prototype.update=function(t){var e=t.bones,o=t.physics.stretchFrac,i=e.legRR,n=e.legRL,s=t.physics.rearBody.standAng.value,a=1.5*t.size,r=.25*t.size;a=this.maxFootOffsetX_,r=this.maxFootOffsetZ_,a-=this.maxFootOffsetX_*o*.5,r-=this.maxFootOffsetZ_*o;Math.PI;var c=1*a;n.footOffsetX_.lerpAmount,n.footOffsetX_.targetValue=c,i.footOffsetX_.targetValue=c;var d=1*r;n.footOffsetZ_.targetValue=-d,i.footOffsetZ_.targetValue=d},z543}(z767),e.z543=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z542(){return null!==t&&t.apply(this,arguments)||this}return __extends(z542,t),z542.prototype.update=function(t){t.bones.fracShoulderHeadYaw.targetValue=.75,t.bones.shoulder.pitch.targetValue=t.physics.frontBody.standAng.targetValue;var e=t.physics.frontBody.standAng.value/-1.4;1<e&&(e=1);var o=Math.sin(e*Math.PI)*t.size;t.bones.legFL.footOffsetX_.targetValue=o,t.bones.legFR.footOffsetX_.targetValue=o},z542}(z767),e.z542=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z541(){return null!==t&&t.apply(this,arguments)||this}return __extends(z541,t),z541.prototype.update=function(t){if(!t.standing){t.physics.frontBody.standAng.value/-1.4<.4?(t.bones.fracShoulderHeadYaw.targetValue=1,t.bones.shoulder.pitch.targetValue=t.physics.frontBody.standAng.targetValue):t.bones.shoulder.pitch.targetValue=0}},z541}(z767),e.z541=o}(z0||(z0={})),function(M){var t,e;t=M.z156||(M.z156={}),e=function(e){function z540(){var t=null!==e&&e.apply(this,arguments)||this;return t.standY=.8,t.standZ=.3,t.frontLegOffsetX=-.2,t.frontLegOffsetY=-.15,t.frontLegOffsetZ=-.15,t.tempVec=BABYLON.Vector3.Zero(),t.poleTargetX=-.9,t.poleTargetY=.3,t.poleTargetZ=-.9,t.poleAng=1.57,t.TEST_maxFootOffsetX=.07,t.TEST_maxFootOffsetZ=.22,t.chestOffsetX=0,t}return __extends(z540,e),z540.prototype.update=function(t){var e=t.physics.rearBody.body;t.targets.lastPoseStandFrame<M.app.frameNum-1&&t.targets.standToTarget.copyFrom(t.physics.frontBody.body.position),t.targets.lastPoseStandFrame=M.app.frameNum;var o=t.bones,i=o.legFR,n=o.legFL,s=o.legRR,a=o.legRL,r=t.targets.targetDir;0==r.x&&0==r.z&&(r.z=-1,r.y=0);var c=t.targets.standToTarget,d=z767.z4[1];d.x=t.targets.upVecTarget.x,d.y=t.targets.upVecTarget.y,d.z=t.targets.upVecTarget.z;var p=r,l=this.standY,u=this.standZ,y=t.targets.moveToTarget,g=e.position,m=Math.min(1,2*t.getStandFracSmooth());u+=.2*Math.sin((1-m)*Math.PI*.5);var f=p.x*u,A=p.y*u,b=p.z*u;f=f+d.x*l+g.x,A=A+d.y*l+g.y,b=b+d.z*l+g.z;var v=.05*t.adjustLerp;c.x=z1.lerpNumber(c.x,f,v),c.y=z1.lerpNumber(c.y,A,v),c.z=z1.lerpNumber(c.z,b,v),y.copyFrom(c);var x=t.physics.rearBody.standAng.value;x=t.physics.rearBody.standAngSmooth;var C=t.size,S=t.size;t.size,t.size,C=this.TEST_maxFootOffsetZ,S=this.TEST_maxFootOffsetX;var T=-x/(.5*Math.PI);1<(T+=t.physics.stretchFrac)&&(T=1),T<0&&(T=0);var B=(1-T)*C;B=t.physics.rearBody.onGround?C:0,a.footOffsetX_.lerpAmount,a.footOffsetX_.targetValue=B,s.footOffsetX_.targetValue=B;var O;O=S,a.footOffsetZ_.targetValue=-O,s.footOffsetZ_.targetValue=O;T=t.getStandFrac();var P=this.frontLegOffsetX;T<.33&&(P*=3.33*T),n.offsetBone1Pos.x=P,n.offsetBone1Pos.y=this.frontLegOffsetY,n.offsetBone1Pos.z=this.frontLegOffsetZ,i.offsetBone1Pos.x=P,i.offsetBone1Pos.y=this.frontLegOffsetY,i.offsetBone1Pos.z=-this.frontLegOffsetZ,t.bones.chest.targOffsetX.targetValue=this.chestOffsetX},z540}(z767),t.z540=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z536(){var t=null!==e&&e.apply(this,arguments)||this;return t.legPoleAng=.1*Math.PI,t.shoulderOffsetZ=0,t}return __extends(z536,e),z536.prototype.update=function(t){this.standY=t.targets.standHeight.value,this.frontLegOffsetX=-.2,e.prototype.update.call(this,t),t.forceStand=!0},z536}(e.z540),e.z536=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(o){function z539(){var t=null!==o&&o.apply(this,arguments)||this;return t.pawRotTar=BABYLON.Quaternion.RotationYawPitchRoll(0,1.2,0),t.legPoleAng=.1*Math.PI,t.frontLegOffsetX=-.08,t.frontLegOffsetY=-.2,t.frontLegOffsetZ=-.16,t.shoulderOffsetZ=0,t.TEST_rotX=-.47,t.TEST_rotY=0,t.TEST_rotZ=-.47,t}return __extends(z539,o),z539.prototype.update=function(t){this.standY=t.targets.standHeight.value,Math.random(),o.prototype.update.call(this,t),t.forceStand=!0,t.bones.shoulder.offsetPos.z=z1.lerpNumber(t.bones.shoulder.offsetPos.z,this.shoulderOffsetZ,.5*t.adjustLerp);var e=z767.tempBabQuats[0];e.x=0,e.y=0,e.z=0,e.w=1,t.bones.legFR.setPawRotationTarget(this.pawRotTar),t.bones.legFL.setPawRotationTarget(this.pawRotTar)},z539}(e.z540),e.z539=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z538(){var t=null!==e&&e.apply(this,arguments)||this;return t.pawRotTar=BABYLON.Quaternion.RotationYawPitchRoll(0,1.3,0),t.legPoleAng=.1*Math.PI,t.frontLegOffsetX=-.2,t.frontLegOffsetY=-.2,t.frontLegOffsetZ=0,t.shoulderOffsetZ=0,t.TEST_rotX=-.47,t.TEST_rotY=.68,t.TEST_rotZ=-.47,t}return __extends(z538,e),z538.prototype.update=function(t){this.standY=t.targets.standHeight.value,Math.random(),e.prototype.update.call(this,t),t.forceStand=!0,t.bones.shoulder.offsetPos.z=z1.lerpNumber(t.bones.shoulder.offsetPos.z,this.shoulderOffsetZ,.5*t.adjustLerp),t.bones.legFR.setPawRotationTarget(this.pawRotTar),t.bones.legFL.setPawRotationTarget(this.pawRotTar)},z538}(e.z540),e.z538=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z537(){var t=null!==e&&e.apply(this,arguments)||this;return t.legPoleAng=.1*Math.PI,t.frontLegOffsetX=-.2,t.frontLegOffsetY=-.15,t.frontLegOffsetZ=0,t.shoulderOffsetZ=0,t.chestOffsetX=-.13,t}return __extends(z537,e),z537.prototype.update=function(t){this.standY=3*t.size,e.prototype.update.call(this,t),t.forceStand=!0,t.bones.shoulder.offsetPos.z=z1.lerpNumber(t.bones.shoulder.offsetPos.z,this.shoulderOffsetZ,.5*t.adjustLerp)},z537}(e.z540),e.z537=o}(z0||(z0={})),function(u){var t,e;t=u.z156||(u.z156={}),e=function(e){function z532(){var t=null!==e&&e.apply(this,arguments)||this;return t.stretch=0,t.TEST_stretch_cutoff=.1,t}return __extends(z532,e),z532.prototype.update=function(t){if(t.physics.allowStretch&&t.currentObject&&t.currentObject.accType==u.z1044.z1048){if(t.usingObject&&t.usingObject.accType==u.z1044.z1045)if(t.targetPickUp)if(t.usingObject.isPositionInBowl(t.targetPickUp.position.x,t.targetPickUp.position.y,t.targetPickUp.position.z))return;if(!t.isTouchingGround()&&3<u.app.frameNum-t.physics.rearBody.lastFrameOnGround).001<t.physics.stretchFrac&&t.physics.stretchJoints(.95*t.physics.stretchDist);else if(t.physics.rearBody.testCollidesWith(u.App.PhysicsGroupBedding)){var e=t.physics.frontBody.body.position,o=t.targets.destTarget,i=(r=e.x-o.x)*r+(d=e.z-o.z)*d,n=t.minStandDist;if(n*n<i).001<t.physics.stretchFrac&&t.physics.stretchJoints(.95*t.physics.stretchDist);else{var s=t.physics.rearBody.body.position,a=t.targets.standToTarget,r=a.x-s.x,c=a.y-s.y,d=a.z-s.z;if(c<2*this.TEST_stretch_cutoff).001<t.physics.stretchFrac&&t.physics.stretchJoints(.95*t.physics.stretchDist);else{var p=Math.sqrt(r*r+c*c+d*d)-3.5*t.size,l=2*t.size;l<p&&(p=l),(p*=t.getStandFracSmooth())<0&&(p=0),0==p&&t.physics.stretchFrac<.001||t.physics.stretchJoints(p,.05)}}}else.001<t.physics.stretchFrac&&t.physics.stretchJoints(.95*t.physics.stretchDist)}},z532}(z767),t.z532=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z455(){return null!==t&&t.apply(this,arguments)||this}return __extends(z455,t),z455.prototype.update=function(t){if(t.standing&&!t.isUnderBedding()){var e=t.targets,o=z767.tempVecs[0],i=e.numUpVecTargets,n=e.totUpVecTargets,s=e.lastUpVecTarget;0<i&&(o.x=n.x,o.y=n.y,o.z=n.z),1<i&&(o.x/=i,o.y/=i,o.z/=i,o.normalize(o)),0<i&&(o.x+=2*s.x,o.y+=2*s.y,o.z+=2*s.z,o.normalize(o),s.x=o.x,s.y=o.y,s.z=o.z);var a=z767.tempVecs[1];a.x=0,a.y=1,a.z=0;var r=z767.tempVecs[2];r.x=0,r.y=0,r.z=1;var c=t.physics.rearBody.body.rotation.elements,d=c[2],p=c[8],l=-Math.atan2(d,p)/(.5*Math.PI),u=Math.atan2(o.x,o.y);t.bones.hip.pitch.targetValue=Math.min(u*l,0)}},z455}(z767),e.z455=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z416(){return null!==t&&t.apply(this,arguments)||this}return __extends(z416,t),z416.prototype.update=function(t){t.eyesCloseLerp=.3,t.eyesBlinkLerp=.5},z416}(z767),e.z416=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z415(){return null!==t&&t.apply(this,arguments)||this}return __extends(z415,t),z415.prototype.update=function(t){t.eyesCloseLerp=.05,t.eyesBlinkLerp=.1},z415}(z767),e.z415=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z413(){var t=null!==e&&e.apply(this,arguments)||this;return t.frontFootOffsetX_=0,t.rearFootOffsetX_=0,t}return __extends(z413,e),z413.prototype.update=function(t){t.bones.legFL.footOffsetX_.targetValue=-this.frontFootOffsetX_,t.bones.legFR.footOffsetX_.targetValue=this.frontFootOffsetX_,t.bones.legRL.footOffsetX_.targetValue=-this.rearFootOffsetX_,t.bones.legRR.footOffsetX_.targetValue=this.rearFootOffsetX_},z413}(z767),e.z413=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z397(){return null!==t&&t.apply(this,arguments)||this}return __extends(z397,t),z397.prototype.update=function(t){t.bones.legFL.stickToGround=!1,t.bones.legFR.stickToGround=!1},z397}(z767),e.z397=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z396(){return null!==t&&t.apply(this,arguments)||this}return __extends(z396,t),z396.prototype.update=function(t){t.isMenuItem||(t.bones.legFL.stickToGround=!0,t.bones.legFR.stickToGround=!0)},z396}(z767),e.z396=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z395(){var t=null!==e&&e.apply(this,arguments)||this;return t.targetL=new BABYLON.Vector3(-.03,.2,-.05),t.targetR=new BABYLON.Vector3(.03,.2,-.05),t.tempQuat=BABYLON.Quaternion.Identity(),t.ikSlerp=1,t.targetLerp=1,t._showDatgui=!1,t}return __extends(z395,e),z395.prototype.update=function(t,e){var o=t.bones.legFL,i=this.targetL,n=z767.tempVecs[0];o.ikCtrl.slerpAmount=this.ikSlerp,e?(e.getAbsolutePositionFromLocalToRef(i,t.mesh,n),BABYLON.Vector3.LerpToRef(o.ikCtrl.targetPosition,n,this.targetLerp,i)):BABYLON.Vector3.LerpToRef(o.ikCtrl.targetPosition,i,this.targetLerp,i),o.setTargetPosition(i),o=t.bones.legFR,i=this.targetR,o.ikCtrl.slerpAmount=this.ikSlerp,e?(e.getAbsolutePositionFromLocalToRef(i,t.mesh,n),BABYLON.Vector3.LerpToRef(o.ikCtrl.targetPosition,n,this.targetLerp,i)):BABYLON.Vector3.LerpToRef(o.ikCtrl.targetPosition,i,this.targetLerp,i),o.setTargetPosition(i)},z395.prototype.showTarget=function(){this.viewTarget=BABYLON.MeshBuilder.CreateBox("",{size:.05},t.app.graphicsHelper.scene)},z395}(z767),e.z395=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z394(){return null!==t&&t.apply(this,arguments)||this}return __extends(z394,t),z394.prototype.update=function(t){t.poseFrontLegs()},z394}(z767),e.z394=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z393(){var t=null!==e&&e.apply(this,arguments)||this;return t.TEST_POLE_ANG=1.3,t}return __extends(z393,e),z393.prototype.update=function(t){var e=this.TEST_POLE_ANG,o=e,i=t.getStandFrac();i<.33&&(o=(e- -.4)*(3.33*i)-.4);t.poseFrontLegs(!0,!0,o)},z393}(z767),e.z393=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z387(){var t=e.call(this)||this;return t.targetL.x=-.03,t.targetL.y=.2,t.targetL.z=0,t.targetR.x=.03,t.targetR.y=.2,t.targetR.z=0,t.targetLerp=.2,t}return __extends(z387,e),z387.prototype.update=function(t){e.prototype.update.call(this,t,t.bones.mouth.bone)},z387}(e.z395),e.z387=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z386(){var t=null!==e&&e.apply(this,arguments)||this;return t.pawRotX=0,t.pawRotY=0,t.pawRotZ=-1.4,t}return __extends(z386,e),z386.prototype.update=function(t){t.rotatePawDown(t.bones.legFR),t.rotatePawDown(t.bones.legFL)},z386}(z767),e.z386=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z385(){var t=null!==e&&e.apply(this,arguments)||this;return t.pawRotationTargetL=BABYLON.Quaternion.RotationYawPitchRoll(.4,0,-Math.PI),t.pawRotationTargetR=BABYLON.Quaternion.RotationYawPitchRoll(-.4,0,-Math.PI),t.pawRotX=0,t.pawRotY=.4,t.pawRotZ=-Math.PI,t.poleAngle=2.4,t}return __extends(z385,e),z385.prototype.update=function(t){var e=t.bones.legFR,o=z767.tempBabQuats[0];e.bone2.getRotationQuaternionToRef(BABYLON.Space.WORLD,null,o),o.multiplyToRef(this.pawRotationTargetR,o),e.setPawRotationTarget(o),e.pawSlerpAmount=1,e.targetPoleAngle=this.poleAngle,(e=t.bones.legFL).bone2.getRotationQuaternionToRef(BABYLON.Space.WORLD,null,o),o.multiplyToRef(this.pawRotationTargetL,o),e.setPawRotationTarget(o),e.pawSlerpAmount=1,e.targetPoleAngle=-this.poleAngle},z385}(z767),e.z385=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z379(){var t=null!==e&&e.apply(this,arguments)||this;return t.skipSetLegsDistToGround=!1,t}return __extends(z379,e),z379.prototype.update=function(t){var e=t.physics,o=t.bones;if(this.skipSetLegsDistToGround)return o.legRR.distToGround=o.legRR.origDistToGround,o.legRL.distToGround=o.legRL.origDistToGround,o.legFR.distToGround=o.legFR.origDistToGround,void(o.legFL.distToGround=o.legFL.origDistToGround);var i=e.middleBody.body.position.x-e.rearBody.body.position.x,n=e.middleBody.body.position.y-e.rearBody.body.position.y,s=e.middleBody.body.position.z-e.rearBody.body.position.z,a=i*i+n*n+s*s,r=Math.sqrt(a);r-=t.size,r*=2;var c=e.rearBody.standAng.value,d=Math.sin(-c);t.mesh.parent&&t.mesh.parent,o.legRR.distToGround=o.legRR.origDistToGround+d*r,o.legRL.distToGround=o.legRL.origDistToGround+d*r;var p=o.extendFrontLegs.value;o.legFR.distToGround=o.legFR.origDistToGround+p,o.legFL.distToGround=o.legFL.origDistToGround+p},z379}(z767),e.z379=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z378(){return null!==t&&t.apply(this,arguments)||this}return __extends(z378,t),z378.prototype.update=function(t){t.bones.legFL.ikCtrl.slerpAmount=1,t.bones.legFR.ikCtrl.slerpAmount=1,t.bones.legRL.ikCtrl.slerpAmount=1,t.bones.legRR.ikCtrl.slerpAmount=1},z378}(z767),e.z378=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z376(){return null!==t&&t.apply(this,arguments)||this}return __extends(z376,t),z376.prototype.update=function(t){t.isMenuItem||(t.bones.legRR.stickToGround||t.bones.legRR.stickToGround,t.bones.legFL.stickToGround=!0,t.bones.legFR.stickToGround=!0,t.bones.legRL.stickToGround=!0,t.bones.legRR.stickToGround=!0)},z376}(z767),e.z376=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z339(){return null!==t&&t.apply(this,arguments)||this}return __extends(z339,t),z339.prototype.update=function(t){t.maxStepHeight=0},z339}(z767),e.z339=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z328(){return null!==t&&t.apply(this,arguments)||this}return __extends(z328,t),z328.prototype.update=function(t){t.physics.neckJoint.frac=.1},z328}(z767),e.z328=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z327(){return null!==t&&t.apply(this,arguments)||this}return __extends(z327,t),z327.prototype.update=function(t){var e=t.physics.frontBody.body.position,o=z767.z4[0],i=z767.z4[1];z1.getVectorBetweenToRef(e,t.targets.lookToTarget,i),i.normalize(),t.bones.hip.bone.getDirectionToRef(BABYLON.Axis.X,t.mesh,o);var n=1;if(BABYLON.Vector3.Dot(i,o)<0)n=1;else{t.targets.upVecTarget;var s=t.physics.middleBody.rotationElements;o.x=s[2],o.y=s[5],o.z=s[8],1<(n=BABYLON.Vector3.Dot(i,o))||n<0&&(n=0)}t.physics.neckJoint.frac=.7+.3*n},z327}(z767),e.z327=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z304(){return null!==t&&t.apply(this,arguments)||this}return __extends(z304,t),z304.prototype.update=function(t){t.targets.standHeight.targetValue=Math.min(.15+.4*Math.random(),.4)},z304}(z767),e.z304=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z300(){return null!==t&&t.apply(this,arguments)||this}return __extends(z300,t),z300.prototype.update=function(t){t.bones.legRL.stickToGround=!1,t.bones.legRR.stickToGround=!1},z300}(z767),e.z300=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z299(){return null!==t&&t.apply(this,arguments)||this}return __extends(z299,t),z299.prototype.update=function(t){t.isMenuItem||(t.bones.legRL.stickToGround=!0,t.bones.legRR.stickToGround=!0)},z299}(z767),e.z299=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z283(){return null!==t&&t.apply(this,arguments)||this}return __extends(z283,t),z283.prototype.update=function(t){var e=z767.z4[0];t.bones.hip.bone.getDirectionToRef(BABYLON.Axis.X,t.mesh,e),t.targets.targetDir.set(z1.roundToDecimalPlace(e.x,1),z1.roundToDecimalPlace(e.y,1),z1.roundToDecimalPlace(e.z,1))},z283}(z767),e.z283=o}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z281(){return null!==t&&t.apply(this,arguments)||this}return __extends(z281,t),z281.prototype.update=function(t){if(!t.physics.rearBody.testCollidesWith(o.App.PhysicsGroupBedding)){var e=z767.z4[0];t.bones.hip.bone.getDirectionToRef(BABYLON.Axis.Y,t.mesh,e),t.targets.upVecTarget.x=e.x,t.targets.upVecTarget.y=e.y,t.targets.upVecTarget.z=e.z}},z281}(z767),t.z281=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z231(){return null!==t&&t.apply(this,arguments)||this}return __extends(z231,t),z231.prototype.update=function(t){if(!t.isTouchingGround()){var e=t.physics.middleBody.body.rotation.elements;t.targets.upVecTarget.x=e[1],t.targets.upVecTarget.y=e[4],t.targets.upVecTarget.z=e[7]}},z231}(z767),e.z231=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z377(){return null!==t&&t.apply(this,arguments)||this}return __extends(z377,t),z377.prototype.update=function(t){t.bones.legFL.stickToGround=!1,t.bones.legFR.stickToGround=!1,t.bones.legRL.stickToGround=!1,t.bones.legRR.stickToGround=!1},z377}(z767),e.z377=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z214(){return null!==t&&t.apply(this,arguments)||this}return __extends(z214,t),z214.prototype.update=function(t){if(t.isMenuItem,t.standing){if(!t.targetPickUp||t.food)return;t.targetPickUp}var e=t.targets.lookToTarget,o=t.physics.frontBody.body.position,i=t.physics.headBody.body.rotation.elements,n=z767.z4[0],s=z767.z4[1];n.x=e.x-o.x,n.y=e.y-o.y,n.z=e.z-o.z,n.normalize(),s.x=i[2],s.y=i[5],s.z=i[8];var a=BABYLON.Vector3.Dot(s,n);1<a&&(a=1);var r=1-Math.acos(a)/1.57;r<.5&&(r=.5),1<r&&(r=1),t.physics.neckJoint.frac=r},z214}(z767),e.z214=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z210(){return null!==t&&t.apply(this,arguments)||this}return __extends(z210,t),z210.prototype.update=function(t){t.bones.head.updateSniff(),t.whiskers.move()},z210}(z767),e.z210=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z204(){var t=null!==e&&e.apply(this,arguments)||this;return t.neckLen=1,t.frontLen=1,t.rearLen=1,t.stretch=0,t}return __extends(z204,e),z204.prototype.update=function(t){if(.01<t.measuredSpeed||t.measuredSpeed<-.01||t.bones.head.angToTar>.05*Math.PI||t.bones.head.angToTar<.05*-Math.PI)t.physics.resetJoints();else{var e=t.physics.rearBody.body.position,o=t.targets.lookToTarget,i=e.x-o.x,n=e.y-o.y,s=e.z-o.z,a=Math.sqrt(i*i+n*n+s*s)-4*t.size,r=2*t.size;r<a&&(a=r),t.physics.stretchJoints(a)}},z204}(z767),e.z204=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z168(){return null!==t&&t.apply(this,arguments)||this}return __extends(z168,t),z168.prototype.update=function(t){t.bones.legFL.updatePose(),t.bones.legFR.updatePose()},z168}(z767),e.z168=o}(z0||(z0={})),function(i){var t,e;t=i.z156||(i.z156={}),e=function(t){function z552(){return null!==t&&t.apply(this,arguments)||this}return __extends(z552,t),z552.prototype.update=function(t){var e=i.Cage.getClosestCage(t.position.x,t.position.y,t.position.z),o=e.getHeightAt(e.position.x,e.position.y);t.setPosition(e.position.x,o+.3,e.position.z)},z552}(z767),t.z552=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z498(){return null!==t&&t.apply(this,arguments)||this}return __extends(z498,t),z498.prototype.update=function(t){t.currentz1091=null},z498}(z767),e.z498=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z496(){return null!==t&&t.apply(this,arguments)||this}return __extends(z496,t),z496.prototype.update=function(t){t.currentObject=null,t.rearObject=null},z496}(z767),e.z496=o}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z507(){return null!==t&&t.apply(this,arguments)||this}return __extends(z507,t),z507.prototype.update=function(t){t.physics.frontBody.lastFrameSpeedAbove=e.app.frameNum},z507}(z767),t.z507=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z503(){return null!==t&&t.apply(this,arguments)||this}return __extends(z503,t),z503.prototype.update=function(t){t.targets.targetNum1=0},z503}(z767),e.z503=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z502(){return null!==t&&t.apply(this,arguments)||this}return __extends(z502,t),z502.prototype.update=function(t){t.reset()},z502}(z767),e.z502=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z501(){return null!==t&&t.apply(this,arguments)||this}return __extends(z501,t),z501.prototype.update=function(t){t.physics.resetJoints()},z501}(z767),e.z501=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z500(){return null!==t&&t.apply(this,arguments)||this}return __extends(z500,t),z500.prototype.update=function(t){t.bones.reset()},z500}(z767),e.z500=o}(z0||(z0={})),function(i){var t,e;t=i.z156||(i.z156={}),e=function(t){function z497(){return null!==t&&t.apply(this,arguments)||this}return __extends(z497,t),z497.prototype.update=function(t){var e=t.physics.frontBody.body.position,o=i.app.getObjOnSceneAt(e.x,e.y,e.z);t.currentObject=o},z497}(z767),t.z497=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z495(){return null!==t&&t.apply(this,arguments)||this}return __extends(z495,t),z495.prototype.update=function(t){t.focusDist=t.initFocusDist,t.focusRange=t.initFocusRange},z495}(z767),e.z495=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z494(){return null!==t&&t.apply(this,arguments)||this}return __extends(z494,t),z494.prototype.update=function(t){t.focusDist=t.initFocusDist},z494}(z767),e.z494=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z493(){return null!==t&&t.apply(this,arguments)||this}return __extends(z493,t),z493.prototype.update=function(t){t.food=null},z493}(z767),e.z493=o}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z492(){return null!==t&&t.apply(this,arguments)||this}return __extends(z492,t),z492.prototype.update=function(t){t.frameNumEnteredCage=e.app.frameNum,t.framesToStayInCage=t.minFramesToStayInCage+Math.random()*(t.maxFramesToStayInCage-t.minFramesToStayInCage)},z492}(z767),t.z492=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z491(){return null!==t&&t.apply(this,arguments)||this}return __extends(z491,t),z491.prototype.update=function(t){t.physics.frontJoint.frac=1},z491}(z767),e.z491=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z490(){return null!==t&&t.apply(this,arguments)||this}return __extends(z490,t),z490.prototype.update=function(t){t.bones.head.roll.reset()},z490}(z767),e.z490=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z489(){return null!==t&&t.apply(this,arguments)||this}return __extends(z489,t),z489.prototype.update=function(t){t.bones.legFL.reset(),t.bones.legFR.reset(),t.bones.legRL.reset(),t.bones.legRR.reset()},z489}(z767),e.z489=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z488(){return null!==t&&t.apply(this,arguments)||this}return __extends(z488,t),z488.prototype.update=function(t){t.bones.legRL.reset(),t.bones.legRR.reset()},z488}(z767),e.z488=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z487(){return null!==t&&t.apply(this,arguments)||this}return __extends(z487,t),z487.prototype.update=function(t){t.targets.limitTurnStandAtDot=.5},z487}(z767),e.z487=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z486(){return null!==t&&t.apply(this,arguments)||this}return __extends(z486,t),z486.prototype.update=function(t){t.maxStepHeight=t.initMaxStepHeight},z486}(z767),e.z486=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z485(){return null!==t&&t.apply(this,arguments)||this}return __extends(z485,t),z485.prototype.update=function(t){t.physics.neckJoint.frac=1},z485}(z767),e.z485=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z484(){return null!==t&&t.apply(this,arguments)||this}return __extends(z484,t),z484.prototype.update=function(t){t.otherIndex=-1},z484}(z767),e.z484=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z483(){return null!==t&&t.apply(this,arguments)||this}return __extends(z483,t),z483.prototype.update=function(t){t.path.length=0,t.path2.length=0,t.pathIndex=0,t.path2Index=0},z483}(z767),e.z483=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z482(){return null!==t&&t.apply(this,arguments)||this}return __extends(z482,t),z482.prototype.update=function(t){t.physics.reset()},z482}(z767),e.z482=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z481(){return null!==t&&t.apply(this,arguments)||this}return __extends(z481,t),z481.prototype.update=function(t){t.pivotArea=0},z481}(z767),e.z481=o}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z480(){return null!==t&&t.apply(this,arguments)||this}return __extends(z480,t),z480.prototype.update=function(t){t.targets.pointerDownPosition.copyFrom(e.app.pointerDownPosition)},z480}(z767),t.z480=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z479(){return null!==t&&t.apply(this,arguments)||this}return __extends(z479,t),z479.prototype.update=function(t){t.bones.shoulder.pitch.targetValue=0},z479}(z767),e.z479=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z478(){return null!==t&&t.apply(this,arguments)||this}return __extends(z478,t),z478.prototype.update=function(t){t.bones.shoulder.roll.reset()},z478}(z767),e.z478=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z477(){return null!==t&&t.apply(this,arguments)||this}return __extends(z477,t),z477.prototype.update=function(t){t.speed=1},z477}(z767),e.z477=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z476(){return null!==t&&t.apply(this,arguments)||this}return __extends(z476,t),z476.prototype.update=function(t){t.physics.frontBody.standAng.targetValue=0,t.physics.middleBody.standAng.targetValue=0,t.physics.rearBody.standAng.targetValue=0,t.bones.tail.ang=t.bones.tail.origAng,t.bones.shoulder.pitch.targetValue=0,t.bones.hip.pitch.targetValue=0,t.bones.legFL.footOffsetX_.targetValue=0,t.bones.legFR.footOffsetX_.targetValue=0,t.bones.fracShoulderHeadYaw.targetValue=1,t.standing=!1},z476}(z767),e.z476=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z475(){return null!==t&&t.apply(this,arguments)||this}return __extends(z475,t),z475.prototype.update=function(t){t.physics.frontBody.standAng.targetValue=0,t.physics.middleBody.standAng.targetValue=0,t.physics.rearBody.standAng.targetValue=0},z475}(z767),e.z475=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z474(){return null!==t&&t.apply(this,arguments)||this}return __extends(z474,t),z474.prototype.update=function(t){t.physics.stayInsideBody=null},z474}(z767),e.z474=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z473(){return null!==t&&t.apply(this,arguments)||this}return __extends(z473,t),z473.prototype.update=function(t){t.strength=1},z473}(z767),e.z473=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z472(){return null!==t&&t.apply(this,arguments)||this}return __extends(z472,t),z472.prototype.update=function(t){t.physics.stretchJoints(0,1)},z472}(z767),e.z472=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z471(){return null!==t&&t.apply(this,arguments)||this}return __extends(z471,t),z471.prototype.update=function(t){t.bones.tail.reset()},z471}(z767),e.z471=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z470(){return null!==t&&t.apply(this,arguments)||this}return __extends(z470,t),z470.prototype.update=function(t){t.targetObject=null,t.targetNode=null},z470}(z767),e.z470=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z469(){return null!==t&&t.apply(this,arguments)||this}return __extends(z469,t),z469.prototype.update=function(t){t.targetObject==t.currentObject&&(t.targetObject=null,t.targetNode=null)},z469}(z767),e.z469=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z468(){return null!==t&&t.apply(this,arguments)||this}return __extends(z468,t),z468.prototype.update=function(t){t.targetObject==t.usingObject&&(t.targetObject=null,t.targetNode=null)},z468}(z767),e.z468=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z467(){return null!==t&&t.apply(this,arguments)||this}return __extends(z467,t),z467.prototype.update=function(t){t.targetPickUp=null},z467}(z767),e.z467=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z466(){return null!==t&&t.apply(this,arguments)||this}return __extends(z466,t),z466.prototype.update=function(t){t.targets.upVecTarget.x=0,t.targets.upVecTarget.y=1,t.targets.upVecTarget.z=0},z466}(z767),e.z466=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z465(){return null!==t&&t.apply(this,arguments)||this}return __extends(z465,t),z465.prototype.update=function(t){t.usingObject=null},z465}(z767),e.z465=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z464(){return null!==t&&t.apply(this,arguments)||this}return __extends(z464,t),z464.prototype.update=function(t){t.physics.removeVelocity()},z464}(z767),e.z464=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z463(){return null!==t&&t.apply(this,arguments)||this}return __extends(z463,t),z463.prototype.update=function(t){t.walkSpeed=1},z463}(z767),e.z463=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z462(){return null!==t&&t.apply(this,arguments)||this}return __extends(z462,t),z462.prototype.update=function(t){t.yieldingToOther=null},z462}(z767),e.z462=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z741(){return null!==t&&t.apply(this,arguments)||this}return __extends(z741,t),z741.prototype.update=function(t){var e=t.usingObject;e&&e.addz1062(t)},z741}(z767),e.z741=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z517(){return null!==t&&t.apply(this,arguments)||this}return __extends(z517,t),z517.prototype.update=function(t){var e=t.usingObject;e&&e.removez1062&&e.removez1062(t)},z517}(z767),e.z517=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z219(){return null!==t&&t.apply(this,arguments)||this}return __extends(z219,t),z219.prototype.update=function(t){t.usingObject=t.targetObject},z219}(z767),e.z219=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z205(){return null!==t&&t.apply(this,arguments)||this}return __extends(z205,t),z205.prototype.update=function(t){var e=t.usingObject;e&&(t.physics.stayInsideBody=e.body)},z205}(z767),e.z205=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1029(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1029,t),z1029.prototype.test=function(t){return t.canSeeDestTarg()},z1029}(z770),e.z1029=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1028(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1028,t),z1028.prototype.test=function(t){return!!t.canSeePointerMove()},z1028}(z770),e.z1028=o}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z1027(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1027,t),z1027.prototype.test=function(t){return!!t.physics.headBody.testCollidesWith(e.App.PhysicsGroupBedding)||(!!t.physics.frontBody.testCollidesWith(e.App.PhysicsGroupBedding)||(!!t.physics.middleBody.testCollidesWith(e.App.PhysicsGroupBedding)||!!t.physics.rearBody.testCollidesWith(e.App.PhysicsGroupBedding)))},z1027}(z770),t.z1027=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1026(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1026,t),z1026.prototype.test=function(t){return!0},z1026}(z770),e.z1026=o}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z1017(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1017,t),z1017.prototype.test=function(t){return 100<e.app.frameNum-t.targets.lastFramePointerMoved},z1017}(z770),t.z1017=o}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z1016(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1016,t),z1016.prototype.test=function(t){return 300<e.app.frameNum-t.targets.lastFramePointerMoved},z1016}(z770),t.z1016=o}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z1015(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1015,t),z1015.prototype.test=function(t){return t.targets.targetNum1<e.app.frameNum-t.targets.lastFramePointerMoved},z1015}(z770),t.z1015=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1014(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1014,t),z1014.prototype.test=function(t){return!!t.isStuck(300,!0)},z1014}(z770),e.z1014=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1013(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1013,t),z1013.prototype.test=function(t){var e=t.targets.targetNum1;return!!t.isStuck(e,!0)},z1013}(z770),e.z1013=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1002(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1002,t),z1002.prototype.test=function(t){return!!t.currentObject},z1002}(z770),e.z1002=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1001(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1001,t),z1001.prototype.test=function(t){return 0<t.targets.destinations.length},z1001}(z770),e.z1001=o}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z986(){return null!==t&&t.apply(this,arguments)||this}return __extends(z986,t),z986.prototype.test=function(t){return e.app._lastPointerDownObj==t.currentObject},z986}(z770),t.z986=o}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z985(){return null!==t&&t.apply(this,arguments)||this}return __extends(z985,t),z985.prototype.test=function(t){return e.app._lastPointerDownObj==t.usingObject},z985}(z770),t.z985=o}(z0||(z0={})),function(i){var t,e;t=i.z768||(i.z768={}),e=function(t){function z984(){return null!==t&&t.apply(this,arguments)||this}return __extends(z984,t),z984.prototype.test=function(t){var e=i.app._lastPointerDownObj;if(e){var o=t.memory.getAccessories(e.accType);return!!(o&&0<=o.indexOf(e))}},z984}(z770),t.z984=e}(z0||(z0={})),function(i){var t,e;t=i.z768||(i.z768={}),e=function(t){function z983(){return null!==t&&t.apply(this,arguments)||this}return __extends(z983,t),z983.prototype.test=function(t,e){var o=i.app.pointerDownPosition;if(z1.distanceSquaredXY(o,t.position)<.09)return!0},z983}(z770),t.z983=e}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z982(){return null!==t&&t.apply(this,arguments)||this}return __extends(z982,t),z982.prototype.test=function(t,e){return!!t.targets.pointerDownPosition.equals(o.app.pointerDownPosition)},z982}(z770),t.z982=e}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z981(){return null!==t&&t.apply(this,arguments)||this}return __extends(z981,t),z981.prototype.test=function(t){return e.app.pointerDownObj==t},z981}(z770),t.z981=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z978(){return null!==t&&t.apply(this,arguments)||this}return __extends(z978,t),z978.prototype.test=function(t){if(0<t.walkForce)return!1;var e=t.targets.destTarget,o=t.physics.headBody.body.position,i=z1.distanceSquared(e,o),n=t.focusDist+t.focusRange;return i<n*n},z978}(z770),e.z978=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z977(){return null!==t&&t.apply(this,arguments)||this}return __extends(z977,t),z977.prototype.test=function(t){return t.pathIndex>=t.path.length-1},z977}(z770),e.z977=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z975(){return null!==t&&t.apply(this,arguments)||this}return __extends(z975,t),z975.prototype.test=function(t){return!!t.avoidingObject},z975}(z770),e.z975=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z974(){return null!==t&&t.apply(this,arguments)||this}return __extends(z974,t),z974.prototype.test=function(t){return!!t.isDragging},z974}(z770),e.z974=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z973(){return null!==t&&t.apply(this,arguments)||this}return __extends(z973,t),z973.prototype.test=function(t){return t.levels.clean.value==t.levels.clean.maxValue},z973}(z770),e.z973=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z972(){return null!==t&&t.apply(this,arguments)||this}return __extends(z972,t),z972.prototype.test=function(t){var e=t.targets.moveToTarget,o=t.physics.headBody.body.position,i=e.x-o.x,n=e.y-o.y,s=e.z-o.z,a=i*i+n*n+s*s,r=t.focusDist+t.focusRange;return a<r*r},z972}(z770),e.z972=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z971(){return null!==t&&t.apply(this,arguments)||this}return __extends(z971,t),z971.prototype.test=function(t){return t.levels.clean.value<=0},z971}(z770),e.z971=o}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z969(){return null!==t&&t.apply(this,arguments)||this}return __extends(z969,t),z969.prototype.test=function(t){return!!t.isInState(e.z132.name)},z969}(z770),t.z969=o}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z966(){return null!==t&&t.apply(this,arguments)||this}return __extends(z966,t),z966.prototype.test=function(t){return!(!t.currentObject||t.currentObject.accType!=e.z1044.z1048)},z966}(z770),t.z966=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z965(){return null!==t&&t.apply(this,arguments)||this}return __extends(z965,t),z965.prototype.test=function(t){return!(!t.currentObject||!t.currentObject.isDragging)&&(!t.currentObject.parent||!t.currentObject.parent.isDragging)},z965}(z770),e.z965=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z964(){return null!==t&&t.apply(this,arguments)||this}return __extends(z964,t),z964.prototype.test=function(t,e){return t.currentObject==t.targetObject},z964}(z770),e.z964=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z961(){return null!==t&&t.apply(this,arguments)||this}return __extends(z961,t),z961.prototype.test=function(t){return!!t.targetObject&&(t.currentObject==t.targetObject.parent||!(!t.targetObject.parent||!t.targetObject.parent.parent||t.currentObject!=t.targetObject.parent.parent))},z961}(z770),e.z961=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z960(){return null!==t&&t.apply(this,arguments)||this}return __extends(z960,t),z960.prototype.test=function(t){if(t.isFollowingPath())return!1;var e=1.1*t.size,o=t.physics.headBody.body.position,i=t.targets.pathTarget;t.pathIndex>=t.path.length-1&&(i=t.targets.destTarget);var n=o.x-i.x,s=o.y-i.y,a=o.z-i.z;return n*n+s*s+a*a<e*e},z960}(z770),e.z960=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z958(){return null!==t&&t.apply(this,arguments)||this}return __extends(z958,t),z958.prototype.test=function(t){return!!t.targets.destTarget.equals(t.targets.lastDestTarget)},z958}(z770),e.z958=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z957(){return null!==t&&t.apply(this,arguments)||this}return __extends(z957,t),z957.prototype.test=function(t){if(!t.currentObject)return!1;var e=t.targets.destTarget;return!!t.currentObject.isInBox(e.x,e.y,e.z)},z957}(z770),e.z957=o}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z952(){return null!==t&&t.apply(this,arguments)||this}return __extends(z952,t),z952.prototype.test=function(t){return!!e.Food.Dragged},z952}(z770),t.z952=o}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z951(){return null!==t&&t.apply(this,arguments)||this}return __extends(z951,t),z951.prototype.test=function(t){var e=o.app.getDragged();return!!e&&(!!t.targetObject&&(e==t.targetObject||!(!t.targetObject.parent||t.targetObject.parent!=e)))},z951}(z770),t.z951=e}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z950(){return null!==t&&t.apply(this,arguments)||this}return __extends(z950,t),z950.prototype.test=function(t){var e=o.app.getDragged();return!(!e||e!=t.usingObject)},z950}(z770),t.z950=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z944(){return null!==t&&t.apply(this,arguments)||this}return __extends(z944,t),z944.prototype.test=function(t){return!!t.physics.isFalling()},z944}(z770),e.z944=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z943(){return null!==t&&t.apply(this,arguments)||this}return __extends(z943,t),z943.prototype.test=function(t,e){return!!t.isFollowingPath()},z943}(z770),e.z943=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z939(){return null!==t&&t.apply(this,arguments)||this}return __extends(z939,t),z939.prototype.test=function(t){if(t.physics.frontBody.onGround&&t.physics.rearBody.onGround)return!0},z939}(z770),e.z939=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z938(){return null!==t&&t.apply(this,arguments)||this}return __extends(z938,t),z938.prototype.test=function(t){var e=t.physics.frontBody.body.position,o=t.currentObject;return!(!o||!o.isInBox(e.x,e.y,e.z))},z938}(z770),e.z938=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z937(){return t.call(this)||this}return __extends(z937,t),z937.prototype.test=function(t){var e=t.targets.destTarget,o=t.physics.frontBody.body.position,i=e.x-o.x,n=e.y-o.y,s=e.z-o.z,a=i*i+n*n+s*s,r=3*t.size;return a<r*r},z937}(z770),e.z937=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z936(){return t.call(this)||this}return __extends(z936,t),z936.prototype.test=function(t){var e=t.targets.pathTarget,o=t.physics.frontBody.body.position,i=e.x-o.x,n=e.y-o.y,s=e.z-o.z,a=i*i+n*n+s*s,r=2*t.size;return a<r*r},z936}(z770),e.z936=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z935(){return null!==t&&t.apply(this,arguments)||this}return __extends(z935,t),z935.prototype.test=function(t){var e=t.physics.frontBody.body.position,o=t.path[t.pathIndex-1];if(o){var i=e.x-o.x,n=e.y-o.y,s=e.z-o.z,a=i*i+n*n+s*s,r=t.size;return a<r*r}},z935}(z770),e.z935=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z923(){return null!==t&&t.apply(this,arguments)||this}return __extends(z923,t),z923.prototype.test=function(t){var e=t.physics.headBody.body.position,o=t.path[t.pathIndex-1];if(o){var i=e.x-o.x,n=e.y-o.y,s=e.z-o.z,a=i*i+n*n+s*s,r=t.size;return a<r*r}},z923}(z770),e.z923=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z919(){return null!==t&&t.apply(this,arguments)||this}return __extends(z919,t),z919.prototype.test=function(t){var e=t.bones.head,o=.2*Math.PI;return!(e.yaw>=o)&&!(e.yaw<=-o)},z919}(z770),e.z919=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z918(){return null!==t&&t.apply(this,arguments)||this}return __extends(z918,t),z918.prototype.test=function(t){return!!t.currentPickUpHand},z918}(z770),e.z918=o}(z0||(z0={})),function(n){var t,e;t=n.z768||(n.z768={}),e=function(t){function z913(){return null!==t&&t.apply(this,arguments)||this}return __extends(z913,t),z913.prototype.test=function(t){var e=t.physics.rearBody.body.position,o=t.currentObject;if(t.isDragging&&t.isDragging,!o){var i=t.physics.frontBody.body.position;t.currentObject=n.Cage.getCageAt(i.x,i.y,i.z),o=t.currentObject}return!(!o||!o.isInBox(e.x,e.y,e.z))},z913}(z770),t.z913=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z911(){return null!==t&&t.apply(this,arguments)||this}return __extends(z911,t),z911.prototype.test=function(t){var e=.2*Math.PI,o=t.bones.head,i=z1.getAngDiff(o.yawTar,o.yaw);return i<e&&-e<i},z911}(z770),e.z911=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z910(){return null!==t&&t.apply(this,arguments)||this}return __extends(z910,t),z910.prototype.test=function(t){var e=.3*Math.PI,o=t.bones.head;return!(o.angToTar>e||o.angToTar<-e)},z910}(z770),e.z910=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z909(){return null!==t&&t.apply(this,arguments)||this}return __extends(z909,t),z909.prototype.test=function(t){return!!t.isMenuItem},z909}(z770),e.z909=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z906(){return null!==t&&t.apply(this,arguments)||this}return __extends(z906,t),z906.prototype.test=function(t){var e=t.targets.moveToTarget,o=t.physics.frontBody.body.position,i=o.x-e.x,n=o.z-e.z,s=i*i+n*n,a=t.focusDist+t.focusRange;return a*a<s},z906}(z770),e.z906=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z905(){return null!==t&&t.apply(this,arguments)||this}return __extends(z905,t),z905.prototype.test=function(t){var e=t.targets.moveToTarget,o=t.physics.frontBody.body.position,i=o.x-e.x,n=o.z-e.z,s=i*i+n*n,a=t.focusDist;return s<a*a},z905}(z770),e.z905=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z904(){return null!==t&&t.apply(this,arguments)||this}return __extends(z904,t),z904.prototype.test=function(t){var e=t.size,o=z770.tempVecs[1],i=t.physics,n=t.targets.moveToTarget;o.copy(n);var s=i.frontBody.body.position,a=z770.z4[0],r=z770.z4[1],c=z770.z4[2];return a.x=s.x,a.y=s.y,a.z=s.z,r.x=n.x,r.y=n.y,r.z=n.z,r.subtractToRef(a,c),c.x*c.x+c.z*c.z<e*e},z904}(z770),e.z904=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z900(){return null!==t&&t.apply(this,arguments)||this}return __extends(z900,t),z900.prototype.test=function(t){if(t.targetObject){var e=t.path[t.pathIndex+1];return!(!e||!e.data.obj||e.data.obj!=t.targetObject)}},z900}(z770),e.z900=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z895(){return null!==t&&t.apply(this,arguments)||this}return __extends(z895,t),z895.prototype.test=function(t){return t.isTouchingGround()},z895}(z770),e.z895=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z889(){return null!==t&&t.apply(this,arguments)||this}return __extends(z889,t),z889.prototype.test=function(t){if(t.getOtherHamInFront())return!0},z889}(z770),e.z889=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z883(){return null!==t&&t.apply(this,arguments)||this}return __extends(z883,t),z883.prototype.test=function(t){return!(t.pathIndex>t.path.length)&&!!t.path[t.pathIndex].data.enterEvent},z883}(z770),e.z883=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z882(){return null!==t&&t.apply(this,arguments)||this}return __extends(z882,t),z882.prototype.test=function(t,e){return t.pathIndex<t.path.length-1},z882}(z770),e.z882=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z880(){return null!==t&&t.apply(this,arguments)||this}return __extends(z880,t),z880.prototype.test=function(t){var e=t.path[t.pathIndex],o=t.path[t.pathIndex+1];return!(!e||!o)&&!(e.data.obj!=o.data.obj&&!e.isConnectedTo(o))},z880}(z770),e.z880=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z873(){return null!==t&&t.apply(this,arguments)||this}return __extends(z873,t),z873.prototype.test=function(t){return 0<t.pivotArea},z873}(z770),e.z873=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z872(){return null!==t&&t.apply(this,arguments)||this}return __extends(z872,t),z872.prototype.test=function(t){var e=t.currentObject;if(e)return e.parent&&(e=e.parent),!!e.isInBox(t.pivotPoint.x,t.pivotPoint.y,t.pivotPoint.z)},z872}(z770),e.z872=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(e){function z871(){var t=null!==e&&e.apply(this,arguments)||this;return t.tempVec1=new OIMO.Vec3,t.tempVec2=new OIMO.Vec3,t}return __extends(z871,e),z871.prototype.test=function(t){var e=t.physics.headBody.body.position,o=t.physics.headBody.rotationElements,i=t.path[t.pathIndex-1],n=e.x-i.x,s=e.y-i.y,a=e.z-i.z;o[0],o[3],o[6],o[1],o[4],o[7];return n*o[2]+s*o[5]+a*o[8]>.5*t.size},z871}(z770),e.z871=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z870(){return null!==t&&t.apply(this,arguments)||this}return __extends(z870,t),z870.prototype.test=function(t){var e=t.physics.frontBody.body.position,o=t.physics.rearBody.body.position,i=t.path[t.pathIndex];if(i){var n=z1.distanceSquared(e,i);return z1.distanceSquared(o,i)<n}},z870}(z770),e.z870=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z864(){return null!==t&&t.apply(this,arguments)||this}return __extends(z864,t),z864.prototype.test=function(t){return!!t.standing},z864}(z770),e.z864=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z863(){return null!==t&&t.apply(this,arguments)||this}return __extends(z863,t),z863.prototype.test=function(t,e){return e.numFramesInState>t.targets.targetNum1},z863}(z770),e.z863=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z862(){return null!==t&&t.apply(this,arguments)||this}return __extends(z862,t),z862.prototype.test=function(t,e){return e.numFramesInState>t.targets.targetNum2},z862}(z770),e.z862=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z861(){return null!==t&&t.apply(this,arguments)||this}return __extends(z861,t),z861.prototype.test=function(t){return t.isStuck()},z861}(z770),e.z861=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z860(){return null!==t&&t.apply(this,arguments)||this}return __extends(z860,t),z860.prototype.test=function(t){return!!t.isStuck(180,!0)},z860}(z770),e.z860=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z859(){return null!==t&&t.apply(this,arguments)||this}return __extends(z859,t),z859.prototype.test=function(t){return!!t.isStuck(600,!0)},z859}(z770),e.z859=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z853(){return null!==t&&t.apply(this,arguments)||this}return __extends(z853,t),z853.prototype.test=function(t){return!t.targetObject},z853}(z770),e.z853=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z852(){return null!==t&&t.apply(this,arguments)||this}return __extends(z852,t),z852.prototype.test=function(t){return!(!t.targetObject||!t.targetObject.isOnScene)},z852}(z770),e.z852=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z846(){return null!==t&&t.apply(this,arguments)||this}return __extends(z846,t),z846.prototype.test=function(t){return!!t.isTouchingGround()},z846}(z770),e.z846=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z844(){return null!==t&&t.apply(this,arguments)||this}return __extends(z844,t),z844.prototype.test=function(t){return!0},z844}(z770),e.z844=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z840(){return null!==t&&t.apply(this,arguments)||this}return __extends(z840,t),z840.prototype.test=function(t){return t.isUpright()},z840}(z770),e.z840=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z839(){return null!==t&&t.apply(this,arguments)||this}return __extends(z839,t),z839.prototype.test=function(t){if(!t.usingObject)return!1;for(var e=Math.max(t.pathIndex-1,0);e<Math.min(t.path.length,t.pathIndex+2);e++){var o=t.path[e];if(o&&o.data.connector&&t.usingObject==o.data.connector)return!0}return!1},z839}(z770),e.z839=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z836(){return null!==t&&t.apply(this,arguments)||this}return __extends(z836,t),z836.prototype.test=function(t){return!(!t.usingObject||!t.usingObject.isOnScene)},z836}(z770),e.z836=o}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z833(){return null!==t&&t.apply(this,arguments)||this}return __extends(z833,t),z833.prototype.test=function(t){return t.isInState(e.z66.name)},z833}(z770),t.z833=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z830(){return null!==t&&t.apply(this,arguments)||this}return __extends(z830,t),z830.prototype.test=function(t){return!!t.yieldingToOther},z830}(z770),e.z830=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z829(){return null!==t&&t.apply(this,arguments)||this}return __extends(z829,t),z829.prototype.test=function(t){var e=t.yieldingToOther,o=t;t.id;var i=o.physics.frontBody,n=e.physics.frontBody,s=i.body.position,a=n.body.position,r=!1,c=z770.z4[0],d=z770.z4[1];return z1.getOIMOLocalPositionFromGlobalToRef(i.body,a,d),z1.getOIMOLocalPositionFromGlobalToRef(n.body,s,c),d.z<c.z&&(r=!0),r},z829}(z770),e.z829=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z828(){return null!==t&&t.apply(this,arguments)||this}return __extends(z828,t),z828.prototype.test=function(t){var e=t.yieldingToOther;if(t.id,!e)return!1;var o=t.physics.frontBody.body.position,i=e.physics.middleBody.body.position,n=o.x-i.x,s=o.y-i.y,a=o.z-i.z,r=n*n+s*s+a*a,c=3*t.size;return r<c*c},z828}(z770),e.z828=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z827(){return null!==t&&t.apply(this,arguments)||this}return __extends(z827,t),z827.prototype.test=function(t){var e=t.yieldingToOther;return!!e&&!!e.isStuck()},z827}(z770),e.z827=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z825(){return null!==t&&t.apply(this,arguments)||this}return __extends(z825,t),z825.prototype.test=function(t){var e=4*t.size,o=t.physics.frontBody.body.position,i=t.targets.startPos,n=o.x-i.x,s=o.y-i.y,a=o.z-i.z;return e*e<n*n+s*s+a*a},z825}(z770),e.z825=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z826(){return null!==t&&t.apply(this,arguments)||this}return __extends(z826,t),z826.prototype.test=function(t){var e=t.physics.headBody.body.position,o=t.physics.headBody.rotationElements,i=t.targets.moveToTarget,n=i.x-e.x,s=i.y-e.y,a=i.z-e.z;return 0<n*o[2]+s*o[5]+a*o[8]},z826}(z770),e.z826=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z824(){return null!==t&&t.apply(this,arguments)||this}return __extends(z824,t),z824.prototype.test=function(t){if(t.currentHSM.currentState.currentState){var e=t.currentHSM.currentState.currentState;return e.numFramesInState>=e.maxFramesInState}},z824}(z770),e.z824=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z823(){return null!==t&&t.apply(this,arguments)||this}return __extends(z823,t),z823.prototype.test=function(t){if(t.currentHSM.currentState.currentState){var e=t.currentHSM.currentState.currentState,o=e.numFramesInState>=.5*e.maxFramesInState;return o}},z823}(z770),e.z823=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z822(){return null!==t&&t.apply(this,arguments)||this}return __extends(z822,t),z822.prototype.test=function(t,e){return e.numFramesInState>=e.maxFramesInState},z822}(z770),e.z822=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z820(){return null!==t&&t.apply(this,arguments)||this}return __extends(z820,t),z820.prototype.test=function(t){return!t.path[t.pathIndex]},z820}(z770),e.z820=o}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z819(){return null!==t&&t.apply(this,arguments)||this}return __extends(z819,t),z819.prototype.test=function(t){return 300<e.app.frameNum-e.app.lastFramePointerMoved},z819}(z770),t.z819=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z817(){return null!==t&&t.apply(this,arguments)||this}return __extends(z817,t),z817.prototype.test=function(t){return Math.random()<.02},z817}(z770),e.z817=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z816(){return null!==t&&t.apply(this,arguments)||this}return __extends(z816,t),z816.prototype.test=function(t){return Math.random()<.1},z816}(z770),e.z816=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z815(){return null!==t&&t.apply(this,arguments)||this}return __extends(z815,t),z815.prototype.test=function(t){return Math.random()<.2},z815}(z770),e.z815=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z814(){return null!==t&&t.apply(this,arguments)||this}return __extends(z814,t),z814.prototype.test=function(t){return Math.random()<.5},z814}(z770),e.z814=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z788(){return null!==t&&t.apply(this,arguments)||this}return __extends(z788,t),z788.prototype.test=function(t){if(.4<t.getStandFrac())return!0;if(.2<t.getStandFrac()){var e=t.targets.destTarget,o=t.physics.frontBody.body.position,i=e.x-o.x,n=e.z-o.z,s=i*i+n*n,a=4*t.size;if(s<a*a)return!0}return!1},z788}(z770),e.z788=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z787(){return null!==t&&t.apply(this,arguments)||this}return __extends(z787,t),z787.prototype.test=function(t){t.physics.rearBody.body.position,t.physics.frontBody.body.position;return!1},z787}(z770),e.z787=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z786(){return null!==t&&t.apply(this,arguments)||this}return __extends(z786,t),z786.prototype.test=function(t){if(!t.standing||t.getStandFrac()<.3)return!1;var e=t.targets.lookToTarget,o=t.physics.frontBody.body.position,i=e.x-o.x,n=e.y-o.y,s=e.z-o.z,a=i*i+s*s,r=2*t.size;return a<r*r&&n>t.size},z786}(z770),e.z786=o}(z0||(z0={})),function(s){var t,e;t=s.z768||(s.z768={}),e=function(e){function z785(){var t=null!==e&&e.apply(this,arguments)||this;return t.path=[],t}return __extends(z785,e),z785.prototype.test=function(t){if(s.app.frameNum-t.lastPathCheckFrameNum<60)return!1;var e=t.cage;if(e){if(t.isInState(s.z131.name))return!1;var o=t.targets.destTarget,i=e.getPlatformUnder(o.x,o.y,o.z);if(i){var n=i.position.x-t.position.x;if(n>.5*i.width||n<.5*-i.width||t.position.y<i.position.y)return t.getPathToRef(t.targets.destTarget,this.path),0<this.path.length||(t.lastPathCheckFrameNum=s.app.frameNum,!1)}return!1}},z785}(z770),t.z785=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z782(){return null!==t&&t.apply(this,arguments)||this}return __extends(z782,t),z782.prototype.test=function(t){var e=t.physics,o=z770.tempVecs[0],i=t.targets.targetDir,n=e.rearBody.body.position,s=e.frontBody.body.position;o.x=n.x+i.x,o.y=n.y+i.y,o.z=n.z+i.z;var a=o.x-s.x,r=o.y-s.y,c=o.z-s.z,d=o.x-n.x,p=o.y-n.y,l=o.z-n.z;return!(d*d+p*p+l*l<a*a+r*r+c*c)},z782}(z770),e.z782=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z776(){return null!==t&&t.apply(this,arguments)||this}return __extends(z776,t),z776.prototype.test=function(t){var e=4*t.size,o=t.physics.middleBody.body.position,i=t.targets.destTarget,n=o.x-i.x,s=o.y-i.y,a=o.z-i.z;return n*n+s*s+a*a<e*e},z776}(z770),e.z776=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z775(){return null!==t&&t.apply(this,arguments)||this}return __extends(z775,t),z775.prototype.test=function(t){var e=1.1*t.size,o=t.physics.headBody.body.position,i=t.targets.pathTarget;t.pathIndex>=t.path.length-1&&(i=t.targets.destTarget);var n=o.x-i.x,s=o.y-i.y,a=o.z-i.z;return n*n+s*s+a*a<e*e},z775}(z770),e.z775=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z774(){return null!==t&&t.apply(this,arguments)||this}return __extends(z774,t),z774.prototype.test=function(t){return 1e4<t.getTimeInCurrentState("z120")},z774}(z770),e.z774=o}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function CondWasPreviousz60(){return null!==t&&t.apply(this,arguments)||this}return __extends(CondWasPreviousz60,t),CondWasPreviousz60.prototype.test=function(t){var e=t.hsm[0].currentState;if(e.history.data[0])return e.history.data[0].name==o.z60.name},CondWasPreviousz60}(z770),t.CondWasPreviousz60=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z1022(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1022,t),z1022.prototype.test=function(t){return t.levels.chew.value<=0},z1022}(z770),e.z1022=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z976(){return null!==t&&t.apply(this,arguments)||this}return __extends(z976,t),z976.prototype.test=function(t){return t.levels.attention.value<=0},z976}(z770),e.z976=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z970(){return null!==t&&t.apply(this,arguments)||this}return __extends(z970,t),z970.prototype.test=function(t){var e=t.levels.chew;return e.value==e.maxValue},z970}(z770),e.z970=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z925(){return null!==t&&t.apply(this,arguments)||this}return __extends(z925,t),z925.prototype.test=function(t){return t.levels.sleep.value<=0},z925}(z770),e.z925=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z924(){return null!==t&&t.apply(this,arguments)||this}return __extends(z924,t),z924.prototype.test=function(t){return t.levels.water.value<=0},z924}(z770),e.z924=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z866(){return null!==t&&t.apply(this,arguments)||this}return __extends(z866,t),z866.prototype.test=function(t){return t.levels.scratch.value<=0},z866}(z770),e.z866=o}(z0||(z0={})),function(t){var e=function(){function CleanController(t){this.cleanRadius=0,this.speed=.05,this.time=0,this.center=BABYLON.Vector3.Zero(),this.target=BABYLON.Vector3.Zero(),this.localYAxis=BABYLON.Vector3.Zero(),this.tempMat=BABYLON.Matrix.Identity(),this.tempVec=BABYLON.Vector3.Zero(),this.cleanRadiusX=0,this.cleanRadiusY=0,this.cleanRadiusZ=0,this.cleanSpeed=0,this.mesh=t}return CleanController.prototype.update=function(t,e,o,i,n,s,a,r,c,d,p){this.cleanSpeed=z1.lerpNumber(this.cleanSpeed,r,c),this.cleanRadiusX=z1.lerpNumber(this.cleanRadiusX,n,c),this.cleanRadiusY=z1.lerpNumber(this.cleanRadiusY,s,c),this.cleanRadiusZ=z1.lerpNumber(this.cleanRadiusZ,a,c);i.y;var l=this.target,u=this.tempVec,y=this.localYAxis;y.x=o.x,y.y=o.y,y.z=o.z,1!=y.x*y.x+y.y*y.y+y.z*y.z&&y.normalize(),null==p&&(p=Math.sin(this.time),d=Math.cos(this.time));var g=this.tempMat;this.speed=this.cleanSpeed,this.time+=this.speed,l.x=p*this.cleanRadiusX,l.y=p*this.cleanRadiusY,l.z=d*this.cleanRadiusZ,l.x+=i.x,l.y+=i.y,l.z+=i.z;var m=this.mesh;t.getDirectionToRef(y,m,u),z1.getWorldMatrixFromAxes(u,e,g),BABYLON.Vector3.TransformCoordinatesToRef(l,g,l);var f=t.getAbsolutePosition(m);if(l.x+=f.x,l.y+=f.y,l.z+=f.z,this.axesViewer){var A=BABYLON.Vector3.TransformCoordinates(i,g),b=BABYLON.Vector3.TransformNormal(BABYLON.Axis.Y,g);A.addInPlace(f),this.axesViewer.update(A,b,b,b)}this.testSphere&&this.testSphere.position.copyFrom(l)},CleanController}();t.CleanController=e}(z0||(z0={})),function(t){var e=function(g){function LegCleanController(t,e){var o=g.call(this,t)||this;return o.leg=e,o}return __extends(LegCleanController,g),LegCleanController.prototype.update=function(t,e,o,i,n,s,a,r,c,d,p,l){g.prototype.update.call(this,t,e,o,i,n,s,a,r,c,d,p);var u=this.leg,y=this.target;u.setTargetPosition(y),l||u.updatePose()},LegCleanController}(t.CleanController);t.LegCleanController=e}(z0||(z0={})),function(t){var e=function(){function Bone(){}return Bone.prototype.init=function(t,e){this.rodent=e,(this.bone=t)&&(this.origPos=this.bone.getPosition())},Bone.prototype.reset=function(){this.offsetPos&&(this.offsetPos.x=0,this.offsetPos.y=0,this.offsetPos.z=0),this.bone&&this.bone.setPosition(this.origPos)},Bone.tempBabVec=BABYLON.Vector3.Zero(),Bone}();t.Bone=e}(z0||(z0={})),function(i){var t=function(o){function Belly(t){void 0===t&&(t=1);var e=o.call(this)||this;return e.ang=0,e.minAng=0,e.maxAng=0,e.offsetPos=BABYLON.Vector3.Zero(),e._side=1,e._angFrac=0,e._side=t,e}return __extends(Belly,o),Object.defineProperty(Belly.prototype,"angFrac",{get:function(){return this._angFrac},set:function(t){if(t!=this._angFrac){this._angFrac=t,this.ang=this.minAng+(this.maxAng-this.minAng)*t;var e=i.Bone.tempBabVec;e.x=this.origRot.x,e.y=this.origRot.y,e.z=this.ang*this._side,this.bone&&this.bone.setRotation(e)}},enumerable:!1,configurable:!0}),Belly.prototype.init=function(t,e){o.prototype.init.call(this,t,e),t&&(this.origRot=t.getRotation(),this.minAng=this.origRot.z,this.maxAng=this.minAng+.1*Math.PI)},Belly}(i.Bone);i.Belly=t}(z0||(z0={})),function(t){var e=function(e){function Bone2(){var t=e.call(this)||this;return t.offsetPos=new BABYLON.Vector3,t}return __extends(Bone2,e),Bone2.prototype.update=function(){this.targOffsetX&&(this.targOffsetX.update(),this.offsetPos.x=this.targOffsetX.value),this.targOffsetY&&(this.targOffsetY.update(),this.offsetPos.y=this.targOffsetY.value),this.targOffsetZ&&(this.targOffsetZ.update(),this.offsetPos.z=this.targOffsetZ.value)},Bone2.prototype.reset=function(){e.prototype.reset.call(this),this.targOffsetX&&this.targOffsetX.reset(),this.targOffsetY&&this.targOffsetY.reset(),this.targOffsetZ&&this.targOffsetZ.reset()},Bone2}(t.Bone);t.Bone2=e}(z0||(z0={})),function(t){var e=function(e){function Ears(){var t=e.call(this)||this;return t.offsetY=new SmartNumber(0,.2),t.offsetZ=new SmartNumber(0,.2),t.offsetPos=new BABYLON.Vector3,t}return __extends(Ears,e),Ears.prototype.update=function(){this.offsetY.update(),this.offsetZ.update(),this.offsetPos.y=this.offsetY.value,this.offsetPos.z=this.offsetZ.value},Ears.prototype.reset=function(){e.prototype.reset.call(this),this.offsetY.reset(),this.offsetZ.reset()},Ears}(t.Bone);t.Ears=e}(z0||(z0={})),function(i){var t=function(o){function Head(){var t=null!==o&&o.apply(this,arguments)||this;return t.offsetPos=BABYLON.Vector3.Zero(),t.offset=0,t.yaw=0,t.yawTar=0,t.pitch=0,t.pitchTar=0,t.angToTar=0,t.pitchDiff=0,t.offsetAng=0,t.sinAng=0,t.chewAmp=.01,t.chewAng=0,t.chewSpeed=1,t.sniffAmp=.02,t.sniffSpeed=1,t.roll=new SmartNumber,t}return __extends(Head,o),Head.prototype.init=function(t,e){o.prototype.init.call(this,t,e),this.cleanController=new i.CleanController(this.rodent.mesh),this.roll.lerpAmount=.1},Head.prototype.update=function(){this.roll.update()},Head.prototype.updateChew=function(t,e){this.chewAng+=t||this.chewSpeed,this.sinAng=Math.sin(this.chewAng),this.offsetAng=e?e*this.sinAng:this.chewAmp*this.sinAng},Head.prototype.updateSniff=function(){this.chewAng+=this.sniffSpeed,this.sinAng=Math.sin(this.chewAng),this.offsetAng=this.sniffAmp*this.sinAng},Head.prototype.updateNod=function(t,e){this.chewAng+=e,this.sinAng=Math.sin(this.chewAng),this.offsetAng=t*this.sinAng},Head.prototype.reset=function(){o.prototype.reset.call(this),this.offset=0,this.yaw=0,this.yawTar=0,this.pitch=0,this.pitchTar=0,this.angToTar=0,this.pitchDiff=0,this.offsetAng=0,this.roll.reset()},Head}(i.Bone);i.Head=t}(z0||(z0={})),function(t){var e=function(e){function Hip(){var t=e.call(this)||this;return t.pitch=new SmartNumber,t.pitch.lerpAmount=.1,t}return __extends(Hip,e),Hip.prototype.update=function(){this.pitch.update()},Hip.prototype.reset=function(){e.prototype.reset.call(this),this.pitch.reset()},Hip}(t.Bone);t.Hip=e}(z0||(z0={})),function(l){var t=function(e){function Leg(){var t=null!==e&&e.apply(this,arguments)||this;return t.num=0,t.offsetBone1Pos=new BABYLON.Vector3(0,0,0),t._offsetBone1Pos=new BABYLON.Vector3(0,0,0),t.offsetBone1Lerp=.1,t.currStepHt=0,t.startStepTime=0,t.endStepTime=0,t.bone1=void 0,t.bone2=void 0,t.bone3=void 0,t.dirX=0,t.dirZ=0,t.bone1Len=0,t.bone2Len=0,t.footLen=0,t.distToGround=0,t.origDistToGround=0,t.maxStepDist=0,t.totalStepTime=0,t.footOffsetZ_=new SmartNumber(0,.5),t.footOffsetY=new SmartNumber(0,.5),t.footOffsetX_=new SmartNumber(0,.5),t.targetPoleTargetLocalOffset=BABYLON.Vector3.Zero(),t.targetPoleTargetLocalOffsetLerp=.2,t.moveX=0,t.moveY=0,t.moveZ=0,t.rodent=null,t.onGround=!1,t.onGroundPos=BABYLON.Vector3.Zero(),t.upAxis=BABYLON.Vector3.Zero(),t._posed=!1,t.posedFrame=-1,t.rollAng=0,t.relX=0,t.relY=0,t.relZ=0,t.moveWithBody=0,t.stickToGround=!1,t.offsetAng=0,t.stride=0,t.ikCtrl=null,t.targetPosition=BABYLON.Vector3.Zero(),t.targetPositionLerp=1,t.initPoleAngle=0,t._targetPoleAngle=0,t._targetPoleAngleFrameNum=0,t._targetPositionFrameNum=0,t.targetPoleAngleLerp=1,t.pawRotation=new z1084,t.pawRotationTarget=new z1084,t.poleTargetInit=BABYLON.Vector3.Zero(),t.pawSlerpAmount=1,t.lerpStep=1,t.initLerpStep=0,t.heelY=0,t._vecOne=new BABYLON.Vector3(1,1,1),t._meshScaled=!0,t.lastUpdateFrame=-1,t._posedFrame=0,t._numPoses=0,t._pawPosDirty=!0,t._pawLegPosition=BABYLON.Vector3.Zero(),t}return __extends(Leg,e),Object.defineProperty(Leg.prototype,"targetPoleAngle",{get:function(){return this._targetPoleAngle},set:function(t){t!=this._targetPoleAngle&&(this._targetPoleAngleFrameNum==l.app.frameNum&&l.app.frameNum,this._targetPoleAngleFrameNum=l.app.frameNum,this._targetPoleAngle=t)},enumerable:!1,configurable:!0}),Leg.prototype.setTargetPosition=function(t){this._targetPositionFrameNum==l.app.frameNum&&this._targetPositionFrameNum,this._targetPositionFrameNum=l.app.frameNum,this.targetPosition.x=t.x,this.targetPosition.y=t.y,this.targetPosition.z=t.z},Leg.prototype.setTargetPositionFloats=function(t,e,o){this._targetPositionFrameNum==l.app.frameNum&&this._targetPositionFrameNum,this._targetPositionFrameNum=l.app.frameNum,this.targetPosition.x=t,this.targetPosition.y=e,this.targetPosition.z=o},Leg.prototype.setPawRotationTarget=function(t){this.pawRotationTarget.copyFrom(t)},Leg.prototype.setPawRotation=function(t){this.pawRotation.copyFrom(t)},Leg.prototype.translateTargetPosition=function(t){this.targetPosition.x+=t.x,this.targetPosition.y+=t.y,this.targetPosition.z+=t.z},Leg.prototype.getDistSqToTarget=function(){var t=this.ikCtrl.targetPosition,e=this.targetPosition,o=t.x-e.x,i=t.y-e.y,n=t.z-e.z;return o*o+i*i+n*n},Object.defineProperty(Leg.prototype,"posed",{get:function(){return this._posed},set:function(t){t&&this.dirX,this._posed=t},enumerable:!1,configurable:!0}),Leg.prototype.update=function(){this.footOffsetZ_.update(),this.footOffsetY.update(),this.footOffsetX_.update(),BABYLON.Vector3.LerpToRef(this._offsetBone1Pos,this.offsetBone1Pos,this.offsetBone1Lerp,this._offsetBone1Pos),z1.nlerpVec3ToRef(this.ikCtrl.poleTargetLocalOffset,this.targetPoleTargetLocalOffset,this.targetPoleTargetLocalOffsetLerp,this.ikCtrl.poleTargetLocalOffset),1!=this.targetPoleAngleLerp?this.ikCtrl.poleAngle=z1.lerpNumber(this.ikCtrl.poleAngle,this.targetPoleAngle,this.targetPoleAngleLerp):this.ikCtrl.poleAngle=this.targetPoleAngle},Leg.prototype.init=function(t){1==t.dirX&&1==t.dirZ&&(this.pawRotationTarget._debug=!0);var e=this;e.rodent=t.rodent,e.stickToGround=!1;var o=e.rodent.adjustLerp;this.footOffsetZ_.lerpAmount=.5*o,this.footOffsetY.lerpAmount=.5*o,this.footOffsetX_.lerpAmount=.5*o,this.targetPoleTargetLocalOffsetLerp=.2*o,e.num=t.num;var i=t.rootBone;e.bone1=i,e.bone2=e.bone1.children[0],e.bone3=e.bone2.children[0],e.initBone1Pos=i.getPosition();var n=BABYLON.Vector3.Zero();e.dirZ=t.dirZ,e.dirX=t.dirX;var s=e.bone2.getPosition(),a=e.bone2.getPosition();n.x=0,n.y=0,n.z=0,e.bone1Len=BABYLON.Vector3.Distance(n,s),e.bone2Len=BABYLON.Vector3.Distance(n,a),e.footLen=t.footLen,i.getPositionToRef(null,null,n),e.bone3.getPositionToRef(null,null,a),e.distToGround=.85*(n.y-a.y),e.origDistToGround=e.distToGround,e.maxStepDist=.5*e.bone1Len;var r=BABYLON.Matrix.Identity(),c=e.bone1.getLocalMatrix(),d=e.bone2.getLocalMatrix(),p=e.bone3.getLocalMatrix();r.copyFrom(p),r.multiplyToRef(d,r),r.multiplyToRef(c,r),this.poleTargetInit.x=-.5,this.poleTargetInit.z=.2*this.dirX,this.dirZ<0&&(this.poleTargetInit.z=this.dirZ*this.dirX*0),this.ikCtrl||(this.ikCtrl=new BABYLON.BoneIKController(this.rodent.mesh,this.bone2,{poleTargetLocalOffset:new BABYLON.Vector3(this.poleTargetInit.x,this.poleTargetInit.y,this.poleTargetInit.z),bendAxis:new BABYLON.Vector3(0,0,1*-this.dirZ)})),0<this.dirZ&&(this.cleanController=new l.LegCleanController(this.rodent.mesh,this))},Leg.prototype.reset=function(){var t=this.rodent.adjustLerp;this.footOffsetZ_.targetValue=0,this.footOffsetY.targetValue=0,this.footOffsetX_.targetValue=0,this.ikCtrl.slerpAmount=.5*t,this.posed=!1,this.targetPoleAngle=this.initPoleAngle,this.targetPoleTargetLocalOffsetLerp=.2*t,this.targetPoleTargetLocalOffset.x=this.poleTargetInit.x,this.targetPoleTargetLocalOffset.y=this.poleTargetInit.y,this.targetPoleTargetLocalOffset.z=this.poleTargetInit.z,this.offsetBone1Pos.x=0,this.offsetBone1Pos.y=0,this.offsetBone1Pos.z=0,this.offsetBone1Lerp=.1,this.pawRotationTarget.x=0,this.pawRotationTarget.y=0,this.pawRotationTarget.z=0,this.pawRotationTarget.w=1},Leg.prototype.resetPole=function(){l.app.world.timeStep;var t=this.rodent.adjustLerp;this.targetPoleTargetLocalOffsetLerp=.2*t,this.targetPoleAngle=this.initPoleAngle,this.targetPoleTargetLocalOffset.x=this.poleTargetInit.x,this.targetPoleTargetLocalOffset.y=this.poleTargetInit.y,this.targetPoleTargetLocalOffset.z=this.poleTargetInit.z},Leg.prototype.hardReset=function(){var t=this;t.posed=!1,t.footOffsetZ_.reset(),t.footOffsetY.reset(),t.footOffsetX_.reset(),t.offsetBone1Pos.x=0,t._offsetBone1Pos.x=0,t.offsetBone1Pos.y=0,t._offsetBone1Pos.y=0,t.offsetBone1Pos.z=0,t._offsetBone1Pos.z=0,t.distToGround=t.origDistToGround,t.targetPoleAngle=this.initPoleAngle,t.ikCtrl.poleAngle=this.targetPoleAngle,t.targetPoleTargetLocalOffset.copyFrom(this.poleTargetInit),t.ikCtrl.poleTargetLocalOffset.copyFrom(this.targetPoleTargetLocalOffset),t.ikCtrl.slerpAmount=1,t.moveX=0,t.moveWithBody=0,t.stickToGround=!1,t.ikCtrl.refreshBoneLengths()},Leg.prototype.updateStep2=function(t,e,o,i,n,s,a,r){var c,d=(D=this).rodent,p=D.currStepHt,l=t;l=z1.mod(l,2*Math.PI);var u=0,y=0;if(n)if(1<n.length){var g=l%(2*Math.PI)/(2*Math.PI),m=n.length,f=(g*=m)-Math.floor(g),A=(g-=f)+1;A===m&&(A=0);var b=n[g];b+=(n[A]-b)*f;var v=e/(D.bone1Len+D.bone2Len);if(u=b*v,s){b=s[g];y=(b+=(s[A]-b)*f)*v}}else u=n[0];p=0;c=Math.cos(l),p=o*Math.sin(l);var x,C=c*=e;c-=C,e<.01&&-.01<e&&(p=0);var S=1*-p+D.footLen*y;C=C+this.footOffsetX_.value,x=this.footOffsetZ_.value;var T=D.initBone1Pos.x+.5*C+this._offsetBone1Pos.x,B=D.initBone1Pos.y+0*S+this._offsetBone1Pos.y,O=D.initBone1Pos.z+.5*x+this._offsetBone1Pos.z,P=T+C,M=B+S-D.distToGround,I=O+x;D.moveY=S,D.moveX=C,D.moveZ=x,D.bone1.markAsDirty();var N=D.bone1.getLocalMatrix();N._m[12]=T,N._m[13]=B,N._m[14]=O,N._markAsUpdated();var z=Leg.tempVec1,w=Leg.tempVec2;z.x=P,z.y=M,z.z=I,D.bone1.getParent().getAbsolutePositionFromLocalToRef(z,d.mesh,w);var _=w.x,R=w.y,L=w.z,F=this.ikCtrl.targetPosition;F.x=_,F.y=R,F.z=L,r&&r(F),this.ikCtrl.slerpAmount=z1.lerpNumber(this.ikCtrl.slerpAmount,1,.1*this.rodent.adjustLerp),this.ikCtrl.update();var D=this;BABYLON.Quaternion.RotationYawPitchRollToRef(.5*-Math.PI,0,.62*-Math.PI+u,D.pawRotationTarget),BABYLON.Quaternion.SlerpToRef(this.pawRotation,this.pawRotationTarget,this.pawSlerpAmount,this.pawRotation),this.bone3.setRotationQuaternion(this.pawRotation,BABYLON.Space.WORLD),this._meshScaled&&this.bone3.setScale(this._vecOne),D.onGround=!1,this._pawPosDirty=!0},Leg.prototype.updatePose=function(t){var e=l.app.frameNum;if(this._posedFrame==e?this._numPoses++:this._numPoses=1,this._posedFrame=e,this.posed=!0,this.posedFrame<this.rodent.frameNum-1&&(this.bone3.getAbsolutePositionToRef(this.rodent.mesh,this.ikCtrl.targetPosition),this.targetPosition.copyFrom(this.ikCtrl.targetPosition)),this.rodent.mesh.parent){var o=this.rodent.mesh.parent.getWorldMatrix(),i=o.m[12],n=o.m[13],s=o.m[14];this.lastParentPos||(this.lastParentPos=BABYLON.Vector3.Zero(),this.lastParentPos.x=i,this.lastParentPos.y=n,this.lastParentPos.z=s),this.ikCtrl.targetPosition.x+=i-this.lastParentPos.x,this.ikCtrl.targetPosition.y+=n-this.lastParentPos.y,this.ikCtrl.targetPosition.z+=s-this.lastParentPos.z,this.lastParentPos.x=i,this.lastParentPos.y=n,this.lastParentPos.z=s}this.posedFrame=this.rodent.frameNum,1!=this.targetPositionLerp?BABYLON.Vector3.LerpToRef(this.ikCtrl.targetPosition,this.targetPosition,this.targetPositionLerp,this.ikCtrl.targetPosition):this.ikCtrl.targetPosition.copyFrom(this.targetPosition);var a=Leg.tempVec2;a.x=this.initBone1Pos.x+this._offsetBone1Pos.x,a.y=this.initBone1Pos.y+this._offsetBone1Pos.y,a.z=this.initBone1Pos.z+this._offsetBone1Pos.z,this.bone1.setPosition(a),t&&t(this.ikCtrl.targetPosition,this.rodent.mesh),this.ikCtrl.update(),1!=this.pawSlerpAmount?BABYLON.Quaternion.SlerpToRef(this.pawRotation,this.pawRotationTarget,this.pawSlerpAmount,this.pawRotation):this.pawRotation.copyFrom(this.pawRotationTarget),this.bone3.setRotationQuaternion(this.pawRotation,BABYLON.Space.WORLD),this._meshScaled&&this.bone3.setScale(this._vecOne);var r=.1*this.rodent.adjustLerp;this.moveX=z1.lerpNumber(this.moveX,0,r),this.moveY=z1.lerpNumber(this.moveY,0,r),this.moveZ=z1.lerpNumber(this.moveZ,0,r),this._pawPosDirty=!0},Leg.prototype.updateStep=function(t,e,o,i,n,s,a){void 0===s&&(s=.1);var r=this,c=r.rodent,d=r.currStepHt,p=t;this.stride=e,p=z1.mod(p+this.offsetAng,2*Math.PI);var l=0,u=0;if(i)if(1<i.length){var y=p/(2*Math.PI),g=i.length,m=(y*=g)-Math.floor(y),f=(y-=m)+1;f===g&&(f=0);var A=e/(r.bone1Len+r.bone2Len),b=i[y];l=(b+=(i[f]-b)*m)*A;b=n[y];u=(b+=(n[f]-b)*m)*A}else l=i[0],u=n[0];r.moveWithBody&&r.moveWithBody--;var v=1.5*Math.PI,x=.35*Math.PI*2,C=2*Math.PI-x,S=.5*x,T=v-S,B=v+S,O=(d=0,!1),P=0;if(c.mesh.parent&&c.mesh.parent,T<=p&&p<=B){var M=(p-T)/x,I=Math.PI+M*Math.PI;P=Math.cos(I),d=o*Math.sin(I)}else{var N=B-2*Math.PI,z=p;v<z&&(z-=2*Math.PI),P=1-(z-N)/C*2,O=!0}P*=e;var w=r.footLen*u;this.heelY=w;var _=e/(.5*this.maxStepDist);1<_&&(_=1),d*=_;var R=this.footOffsetX_.value,L=this.footOffsetY.value,F=this.footOffsetZ_.value,D=1*-d+w+L,E=1*P+R,k=0*P+F;r.moveX=E-R,r.moveY=D-L,r.moveZ=k-F,r.offsetBone1Pos.x=.5*E,r.offsetBone1Pos.y=.5*D,r.offsetBone1Pos.z=.5*k;var j=r.initBone1Pos.x+r._offsetBone1Pos.x,V=r.initBone1Pos.y+r._offsetBone1Pos.y,G=r.initBone1Pos.z+r._offsetBone1Pos.z;r.bone1.markAsDirty();var W=r.bone1.getLocalMatrix();W._m[12]=j,W._m[13]=V,W._m[14]=G,W._markAsUpdated();r.offsetAng*=.95;var Y=j+E,U=V+D-r.distToGround,X=G+k,Z=Leg.tempVec1,q=Leg.tempVec2;Z.x=Y,Z.y=U,Z.z=X,r.bone1.getParent().getAbsolutePositionFromLocalToRef(Z,c.mesh,q);var Q=q.x,J=q.y,K=q.z,$=this.ikCtrl.targetPosition;if(this.onGround&&this.stickToGround&&!r.moveWithBody){this.lerpStep=this.initLerpStep,0<w&&($.x=this.onGroundPos.x+this.upAxis.x*w,$.y=this.onGroundPos.y+this.upAxis.y*w,$.z=this.onGroundPos.z+this.upAxis.z*w);var tt=this.bone1.getParent(),et=Leg.tempVec4;tt.getLocalPositionFromAbsoluteToRef($,this.rodent.mesh,et);var ot=et.y,it=et.z;-.3<et.y&&(ot=-.3);0<this.dirX&&et.z<0&&(it=0),this.dirX<0&&0<et.z&&(it=0),it==et.z&&ot==et.y||(et.y=ot,et.z=it,tt.getAbsolutePositionFromLocalToRef(et,this.rodent.mesh,$),this.onGroundPos.copyFrom($))}else{var nt=Leg.tempVec3;this.bone3.getAbsolutePositionToRef(this.rodent.mesh,nt),this.lerpStep=z1.lerpNumber(this.lerpStep,1,s*this.rodent.adjustLerp),$.x=nt.x+(Q-nt.x)*this.lerpStep,$.y=nt.y+(J-nt.y)*this.lerpStep,$.z=nt.z+(K-nt.z)*this.lerpStep}a&&a($,c.mesh.position),this.ikCtrl.update(),this.ikCtrl.slerpAmount=z1.lerpNumber(this.ikCtrl.slerpAmount,1,.05*this.rodent.adjustLerp),BABYLON.Quaternion.SlerpToRef(this.pawRotation,this.pawRotationTarget,this.pawSlerpAmount,this.pawRotation);var st=Leg.tempQuat1,at=Leg.tempQuat3;(this.bone1.getParent().getRotationQuaternionToRef(null,null,st),st.multiplyToRef(Leg.rollNeg90Quat,st),st.multiplyInPlace(this.pawRotation),l&&(BABYLON.Quaternion.RotationYawPitchRollToRef(0,0,l,at),st.multiplyInPlace(at)),this.bone3.setRotationQuaternion(st,BABYLON.Space.WORLD),this._meshScaled&&this.bone3.setScale(this._vecOne),O&&!r.onGround)&&(this.onGroundPos.copyFrom($),this.bone1.getParent().getDirectionToRef(BABYLON.Axis.Y,this.rodent.mesh,this.upAxis));r.onGround=O,this._pawPosDirty=!0},Leg.prototype.translate=function(t,e,o){this.onGround&&(this.onGroundPos.addInPlaceFromFloats(t,e,o),this.ikCtrl.targetPosition.addInPlaceFromFloats(t,e,o),this.ikCtrl.update())},Leg.prototype.getPawShoulderPositionToRef=function(t){var e=this.bone3.getAbsoluteTransform(),o=this.bone1.getParent().getAbsoluteTransform(),i=Leg.tempMat1;o.invertToRef(i),e.multiplyToRef(i,i),t.x=i.m[12],t.y=i.m[13],t.z=i.m[14]},Leg.prototype.getPawLegPositionToRef=function(t){if(!this._pawPosDirty)return t.x=this._pawLegPosition.x,t.y=this._pawLegPosition.y,void(t.z=this._pawLegPosition.z);var e=this.bone3.getAbsoluteTransform(),o=this.bone1.getParent().getAbsoluteTransform(),i=Leg.tempMat1;o.invertToRef(i),e.multiplyToRef(i,i),this._pawLegPosition.x=i.m[12]-this.initBone1Pos.x,this._pawLegPosition.y=i.m[13]-this.initBone1Pos.y,this._pawLegPosition.z=i.m[14]-this.initBone1Pos.z,t.x=this._pawLegPosition.x,t.y=this._pawLegPosition.y,t.z=this._pawLegPosition.z,this._pawPosDirty=!1},Leg.tempVec1=BABYLON.Vector3.Zero(),Leg.tempVec2=BABYLON.Vector3.Zero(),Leg.tempVec3=BABYLON.Vector3.Zero(),Leg.tempVec4=BABYLON.Vector3.Zero(),Leg.tempQuat1=BABYLON.Quaternion.Identity(),Leg.tempQuat2=BABYLON.Quaternion.Identity(),Leg.tempQuat3=BABYLON.Quaternion.Identity(),Leg.tempMat1=BABYLON.Matrix.Identity(),Leg.rollNeg90Quat=BABYLON.Quaternion.RotationYawPitchRoll(0,0,.5*-Math.PI),Leg}(l.Bone);l.Leg=t}(z0||(z0={})),function(t){var e=function(e){function Mouth(){var t=null!==e&&e.apply(this,arguments)||this;return t.localPos=BABYLON.Vector3.Zero(),t.worldPos=BABYLON.Vector3.Zero(),t.tmat1=BABYLON.Matrix.Identity(),t.tmat2=BABYLON.Matrix.Identity(),t.frameMouthPosUpdated=0,t.fracOpen=0,t.origAng=.05*Math.PI,t.ang=0,t.posRange=.35,t.axis=BABYLON.Vector3.Zero(),t}return __extends(Mouth,e),Mouth.prototype.update=function(){if(this.frameMouthPosUpdated!=this.rodent.frameNum){var t=this.bone,e=this.tmat1;BABYLON.Matrix.IdentityToRef(e),e._m[13]=.12,e._m[14]=.03,e._markAsUpdated();var o=this.tmat2,i=this.rodent.mesh.getWorldMatrix(),n=t.getLocalMatrix(),s=t.getParent().getAbsoluteTransform();e.multiplyToRef(n,e),e.multiplyToRef(s,o),o.multiplyToRef(i,o),this.worldPos.x=o.m[12],this.worldPos.y=o.m[13],this.worldPos.z=o.m[14],this.axis.x=o.m[4],this.axis.y=o.m[5],this.axis.z=o.m[6],this.frameMouthPosUpdated=this.rodent.frameNum}},Mouth}(t.Bone);t.Mouth=e}(z0||(z0={})),function(t){var e=function(e){function Shoulder(){var t=e.call(this)||this;return t.pitch=new SmartNumber,t.yaw=new SmartNumber,t.roll=new SmartNumber,t.pitch.lerpAmount=.1,t.yaw.lerpAmount=.8,t.roll.lerpAmount=.1,t}return __extends(Shoulder,e),Shoulder.prototype.update=function(){this.pitch.update(),this.yaw.update(),this.roll.update()},Shoulder.prototype.reset=function(){e.prototype.reset.call(this),this.pitch.reset(),this.yaw.reset(),this.roll.reset()},Shoulder}(t.Bone);t.Shoulder=e}(z0||(z0={})),function(a){var t=function(){function Skeleton(){this.ears=new a.Ears,this.cheeks=new a.Bone,this.neck=new a.Bone,this.spine2=new a.SpineBone,this.spine1a=new a.Bone,this.spine1=new a.Bone,this.spine0=new a.Bone,this.chest=new a.Bone2,this.bellyR=new a.Belly,this.bellyL=new a.Belly(-1),this.cheekR=new a.Bone,this.cheekL=new a.Bone,this.hip=new a.Hip,this.head=new a.Head,this.mouth=new a.Mouth,this.tail=new a.Tail,this.shoulder=new a.Shoulder,this.legFR=new a.Leg,this.legFL=new a.Leg,this.legRR=new a.Leg,this.legRL=new a.Leg,this.legTickFront=0,this.legTickRear=0,this.tempMat1=BABYLON.Matrix.Identity(),this.tempMat2=BABYLON.Matrix.Identity(),this.extendFrontLegs=new SmartNumber(0,.5),this.fracShoulderHeadYaw=new SmartNumber(0,.5)}return Skeleton.prototype.init=function(t,e){this.extendFrontLegs.lerpAmount=32*a.app.world.timeStep,this.fracShoulderHeadYaw.lerpAmount=32*a.app.world.timeStep,this.shoulder.offsetPos=BABYLON.Vector3.Zero(),this.cheekL.offsetPos=BABYLON.Vector3.Zero(),this.cheekR.offsetPos=BABYLON.Vector3.Zero(),this.bellyL.offsetPos=BABYLON.Vector3.Zero(),this.bellyR.offsetPos=BABYLON.Vector3.Zero(),this.chest.targOffsetX=new SmartNumber(0,.1),this.chest.targOffsetZ=new SmartNumber(0,.1),this.mouth.offsetPos=BABYLON.Vector3.Zero(),this.spine2.offsetPos=BABYLON.Vector3.Zero(),this.rodent=t,this.mouth.localPos.y=.2,this.mouth.localPos.z=0;var o=(this.skeleton=e).bones;this.bones=o;for(var i={},n=0;n<o.length;n++){var s=o[n];i[s.name.replace(".","_")]=s}this.head.init(i.head,t),this.cheeks.init(i.cheeks,t),this.ears.init(i.ears,t),this.mouth.init(i.mouth,t),this.neck.init(i.neck,t),this.shoulder.init(i.shoulder,t),this.chest.init(i.chest,t),this.spine2.init(i.spine2,t),this.spine1.init(i.spine1,t),this.spine1a.init(i.spine1_1,t),this.spine0.init(i.spine0,t),this.hip.init(i.hip,t),this.tail.init(i.tail,t),this.cheekL.init(i.cheek_L,t),this.cheekR.init(i.cheek_R,t),this.bellyL.init(i.belly_L,t),this.bellyR.init(i.belly_R,t),e.prepare(),this.legFR.init({rodent:t,rootBone:i.arm1_R,dirZ:1,dirX:1,footLen:.05,num:0}),this.legFL.init({rodent:t,rootBone:i.arm1_L,dirZ:1,dirX:-1,footLen:.05,num:1}),this.legRR.init({rodent:t,rootBone:i.leg1_R,dirZ:-1,dirX:1,footLen:.08,num:2}),this.legRL.init({rodent:t,rootBone:i.leg1_L,dirZ:-1,dirX:-1,footLen:.08,num:3}),this.legFL.distToGround=this.legFL.origDistToGround,this.legFR.distToGround=this.legFR.origDistToGround},Skeleton.prototype.update=function(){this.extendFrontLegs.update(),this.legRL.update(),this.legRR.update(),this.legFL.update(),this.legFR.update(),this.fracShoulderHeadYaw.update(),this.shoulder.yaw.targetValue=-this.head.yaw*this.fracShoulderHeadYaw.value,this.head.update(),this.shoulder.update(),this.ears.update(),this.hip.update(),this.chest.update(),this.tail.update()},Skeleton.prototype.reset=function(){this.legFL.reset(),this.legFR.reset(),this.legRL.reset(),this.legRR.reset(),this.tail.offsetZ.targetValue=0,this.shoulder.pitch.targetValue=0,this.extendFrontLegs.targetValue=0,this.hip.pitch.targetValue=0;var t=this.cheekL.offsetPos;t.x=0,t.y=0,t.z=0,(t=this.cheekR.offsetPos).x=0,t.y=0,t.z=0,(t=this.bellyL.offsetPos).x=0,t.y=0,t.z=0,(t=this.bellyR.offsetPos).x=0,t.y=0,t.z=0,(t=this.shoulder.offsetPos).x=0,t.y=0,t.z=0,this.chest.targOffsetX.targetValue=0,this.chest.targOffsetZ.targetValue=0,this.fracShoulderHeadYaw.targetValue=0},Skeleton.prototype.hardReset=function(){var t=this;t.ears.offsetZ.targetValue=0,t.ears.offsetY.targetValue=0,t.legTickFront=Math.random()*Math.PI*2,t.legTickRear=t.legTickFront,t.fracShoulderHeadYaw.reset(),t.head.reset(),t.neck.reset(),t.shoulder.reset(),t.chest.reset(),t.bellyR.reset(),t.bellyL.reset(),t.spine0.reset(),t.spine1.reset(),t.spine2.reset(),t.hip.reset(),t.tail.reset(),t.extendFrontLegs.reset(),t.legFL.hardReset(),t.legFR.hardReset(),t.legRL.hardReset(),t.legRR.hardReset()},Skeleton.prototype.beforeUpdate=function(){var t=this.cheekL.offsetPos;t.x=0,t.y=0,t.z=0,(t=this.cheekR.offsetPos).x=0,t.y=0,t.z=0,(t=this.bellyL.offsetPos).x=0,t.y=0,t.z=0,(t=this.bellyR.offsetPos).x=0,t.y=0,t.z=0},Skeleton.prototype.translate=function(t,e,o){this.legFL.translate(t,e,o),this.legFR.translate(t,e,o),this.legRL.translate(t,e,o),this.legRR.translate(t,e,o)},Skeleton}();a.Skeleton=t}(z0||(z0={})),function(t){var e=function(e){function SpineBone(){var t=e.call(this)||this;return t.pitch=new SmartNumber,t.yaw=new SmartNumber,t.roll=new SmartNumber,t.pitch.lerpAmount=.1,t.yaw.lerpAmount=.8,t.roll.lerpAmount=.1,t}return __extends(SpineBone,e),SpineBone.prototype.update=function(){this.pitch.update(),this.yaw.update(),this.roll.update()},SpineBone.prototype.reset=function(){e.prototype.reset.call(this),this.pitch.reset(),this.yaw.reset(),this.roll.reset()},SpineBone}(t.Bone);t.SpineBone=e}(z0||(z0={})),function(t){var e=function(i){function Tail(){var t=null!==i&&i.apply(this,arguments)||this;return t.yaw=0,t._ang=0,t.origAng=0,t.offsetZ=new SmartNumber(0,.1),t}return __extends(Tail,i),Object.defineProperty(Tail.prototype,"ang",{get:function(){return this._ang},set:function(t){this._ang=t},enumerable:!1,configurable:!0}),Tail.prototype.init=function(t,e){i.prototype.init.call(this,t,e);var o=t.getRotation();this.origAng=o.y},Tail.prototype.reset=function(){this.offsetPos&&(this.offsetPos.x=0,this.offsetPos.y=0,this.offsetPos.z=0),this.bone.setPosition(this.origPos),this.ang=this.origAng,this.offsetZ.targetValue=0},Tail.prototype.update=function(){this.offsetZ.update()},Tail}(t.Bone);t.Tail=e}(z0||(z0={})),function(t){var e=function(){function Whiskers(t,e){this.tempVec1=BABYLON.Vector3.Zero(),this.tempVec2=BABYLON.Vector3.Zero(),this.tempQuat1=BABYLON.Quaternion.Identity(),this.rightQuat=BABYLON.Quaternion.RotationYawPitchRoll(Math.PI,.55*-Math.PI,0),this.leftQuat=BABYLON.Quaternion.RotationYawPitchRoll(0,.55*Math.PI,0),this.totSpeed=0,this.speed=2,this.moveRange=.04,this.isOnScene=!0;this.owner=t;var o=this.createGroup(e,"#DDD",6);o.renderingGroupId=t.mesh.renderingGroupId,o.scaling.x=.25,o.scaling.y=.25,o.scaling.z=.25,o.isPickable=!1,o.rotationQuaternion=BABYLON.Quaternion.Identity(),o.parent=t.mesh,this.mesh1=o,(o=this.createGroup(e,"#DDD",6)).renderingGroupId=t.mesh.renderingGroupId,o.scaling.x=.25,o.scaling.y=.25,o.scaling.z=-.25,o.isPickable=!1,o.rotationQuaternion=BABYLON.Quaternion.Identity(),o.parent=t.mesh,this.mesh2=o}return Whiskers.prototype.setRenderingGroupID=function(t){this.mesh1.renderingGroupId=t,this.mesh2.renderingGroupId=t},Whiskers.prototype.createGroup=function(t,e,o,i){void 0===e&&(e="white"),void 0===o&&(o=10),void 0===i&&(i=.2);var n=document.createElement("canvas"),s=n.getContext("2d");n.width=600,n.height=600,s.beginPath(),s.moveTo(300,300),s.bezierCurveTo(380,295,520,295,600,320),s.bezierCurveTo(520,296,380,296,300,301),s.lineTo(300,300),s.fillStyle=e,s.fill();var a=n.toDataURL(),r=new BABYLON.Texture("data:curveTest",t,!1,!0,null,null,null,a),c=BABYLON.Mesh.CreatePlane("",4,t);c.setPivotPoint(new BABYLON.Vector3(0,-.5,0));var d=new BABYLON.StandardMaterial("",t);d.opacityTexture=r,(c.material=d).backFaceCulling=!1;var p=o,l=.4*Math.PI,u=.5*Math.PI,y=.4*Math.PI,g=(.2- -.1)/p,m=u,f=m/p,A=.1*Math.PI,b=new BABYLON.SolidParticleSystem("SPS",t,{updatable:!1});b.addShape(c,p,{positionFunction:function(t,e,o){var i=e;Math.random();var n=Math.sin(i/p*Math.PI);t.position.x=.3,t.position.z=.4*-n+Math.random()*n*.4*2,t.position.y=g*i-.1,t.position.y+=.1*Math.random()-.05;var s=.5+.5*n;s-=Math.random()*s*.25,t.scaling.x=s,t.rotation.z=.4*-m+i*f,t.rotation.z+=.5*-A+Math.random()*A,t.rotation.y=-t.position.z/.4*l;Math.PI;t.rotation.y<0&&(t.rotation.y*=-1);var a=1-t.rotation.y/l+.2;t.scaling.x>a&&(t.scaling.x=a,t.scaling.y=a),t.rotation.x=.5*-y+Math.random()*y}});var v=b.buildMesh();return v.material=d,(this.scene=t).removeMesh(c),c.dispose(),v},Whiskers.prototype.update=function(){var t=this.owner;t.mesh.scaling;t.isMenuItem&&t.mesh.scaling;var e=t.bones.head.bone;e.getRotationQuaternionToRef(BABYLON.Space.WORLD,null,this.tempQuat1);var o=this.tempVec1,i=this.tempVec2;i.y=2.5*t.size,e.getAbsolutePositionFromLocalToRef(i,null,o);var n=this.mesh1;n.position.copyFrom(o),this.tempQuat1.multiplyToRef(this.leftQuat,n.rotationQuaternion),(n=this.mesh2).position.copyFrom(o),this.tempQuat1.multiplyToRef(this.rightQuat,n.rotationQuaternion)},Whiskers.prototype.move=function(t,e){t||(t=this.moveRange),e||(e=this.speed),this.totSpeed+=this.speed,this.mesh1.rotation.z=Math.sin(this.totSpeed)*t,this.mesh2.rotation.z=this.mesh1.rotation.z},Whiskers.prototype.removeFromScene=function(){this.isOnScene&&(this.scene.removeMesh(this.mesh1),this.scene.removeMesh(this.mesh2),this.isOnScene=!1)},Whiskers.prototype.addToScene=function(){this.isOnScene||(this.scene.addMesh(this.mesh1),this.scene.addMesh(this.mesh2),this.isOnScene=!0)},Whiskers}();t.Whiskers=e}(z0||(z0={})),function(t){var e=function CollisionInfo(){};(z0||(z0={})).CollisionInfo=e}(),function(s){var t=function(){function PhysicsBody(){this.body=void 0,this.maxPathLen=0,this.lastFramePathSet=0,this.numCollisions=0,this.lastCollisionFrameNum=0,this.groundAxisX=void 0,this.groundAxisY=void 0,this.groundAxisZ=void 0,this._onGround=!1,this.onGroundShape=null,this.onGroundStartTime=0,this.onGroundEndTime=0,this.onGroundDuration=0,this.onGroundCount=0,this.lastFrameOnGround=0,this.localPos=null,this.rotationElements=[],this.pitchDiff=0,this.standAng=new SmartNumber(0,1),this.standAngSmooth=0,this.standForceMult=0,this.standForceEase=.2,this.maxStandForce=0,this.lastStandAng=0,this.angToStandTarget=0,this.frameUpSpaceComputed=-1,this.upXaxis=null,this.upYaxis=null,this.upZaxis=null,this.speedSq=0,this.watchSpeed=!1,this.lastFrameSpeedAbove=0,this.lastPosX=0,this.lastPosY=0,this.lastPosZ=0,this.speedToWatch=0,this.target=new z1085(0,0,0,!1),this.touchingAccTypes=0,this.collidesWith=null,this.belongsTo=null}return Object.defineProperty(PhysicsBody.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this.body.shapes.radius=t},enumerable:!1,configurable:!0}),Object.defineProperty(PhysicsBody.prototype,"onGround",{get:function(){return this._onGround},set:function(t){this._onGround=t},enumerable:!1,configurable:!0}),PhysicsBody.prototype.copyRotationElements=function(){var t=this.body.rotation.elements,e=this.rotationElements;e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]},PhysicsBody.prototype.getDirectionToRef=function(t,e){var o=t,i=this.body.rotation.elements,n=o.x*i[0]+o.y*i[1]+o.z*i[2],s=o.x*i[3]+o.y*i[4]+o.z*i[5],a=o.x*i[6]+o.y*i[7]+o.z*i[8];e.x=n,e.y=s,e.z=a},PhysicsBody.prototype.computeUpSpace=function(t){this.upXaxis||(this.upXaxis=new OIMO.Vec3,this.upYaxis=new OIMO.Vec3,this.upZaxis=new OIMO.Vec3);var e=this.upXaxis,o=this.upYaxis,i=this.upZaxis;if(s.app.frameNum!=this.frameUpSpaceComputed){var n=this.rotationElements;i.x=n[2],i.y=n[5],i.z=n[8],e.cross(i,t),e.normalize(e),o.x=t.x,o.y=t.y,o.z=t.z,i.cross(o,e),this.frameUpSpaceComputed=s.app.frameNum}},PhysicsBody.prototype.tranformToUpSpace=function(t,e,o){this.computeUpSpace(t);var i=e.x,n=e.y,s=e.z,a=this.upXaxis,r=this.upYaxis,c=this.upZaxis;o.x=i*a.x+n*a.y+s*a.z,o.y=i*r.x+n*r.y+s*r.z,o.z=i*c.x+n*c.y+s*c.z},PhysicsBody.prototype.tranformFromUpSpace=function(t,e,o){this.computeUpSpace(t);var i=e.x,n=e.y,s=e.z,a=this.upXaxis,r=this.upYaxis,c=this.upZaxis;o.x=i*a.x+n*r.x+s*c.x,o.y=i*a.y+n*r.y+s*c.y,o.z=i*a.z+n*r.z+s*c.z},PhysicsBody.prototype.isFacingDir=function(t,e){void 0===e&&(e=.1);var o=this.rotationElements,i=PhysicsBody.z4[0];return i.x=o[2],i.y=o[5],i.z=o[8],BABYLON.Vector3.Dot(i,t)<e},PhysicsBody.prototype.setRotationQuaternion=function(t){var e=t.w,o=t.x,i=t.y,n=t.z;void 0===t.w&&(e=t.s);var s=this.body.orientation;s.s=e;var a=2*(s.x=o),r=2*(s.y=i),c=2*(s.z=n),d=o*a,p=i*r,l=n*c,u=o*r,y=i*c,g=o*c,m=e*a,f=e*r,A=e*c,b=this.body.rotation.elements,v=this.body.shapes.rotation.elements;v[0]=b[0]=1-p-l,v[1]=b[1]=u-A,v[2]=b[2]=g+f,v[3]=b[3]=u+A,v[4]=b[4]=1-d-l,v[5]=b[5]=y-m,v[6]=b[6]=g-f,v[7]=b[7]=y+m,v[8]=b[8]=1-d-p,this.syncShapes(),this.copyRotationElements()},PhysicsBody.prototype.rotateWithQuaternion=function(t){var e=PhysicsBody.tempQuat;e.x=t.x,e.y=t.y,e.z=t.z,e.s=t.w;var o=this.body.orientation;o.mul(e,o),this.setRotationQuaternion(o)},PhysicsBody.prototype.setPosition=function(t,e,o){var i=this.body.position;i.x=t,i.y=e,i.z=o;var n=this.body.shapes.position;n.x=t,n.y=e,n.z=o;var s=this.body.lastPosition;s.x=t,s.y=e,s.z=o,this.syncShapes()},PhysicsBody.prototype.getLocalDirectionFromGlobalToRef=function(t,e){var o=this.body.rotation.elements,i=t.x,n=t.y,s=t.z;e.x=i*o[0]+n*o[3]+s*o[6],e.y=i*o[1]+n*o[4]+s*o[7],e.z=i*o[2]+n*o[5]+s*o[8]},PhysicsBody.prototype.getLocalPositionFromGlobalToRef=function(t,e){var o=this.body.rotation.elements,i=this.body.position,n=t.x-i.x,s=t.y-i.y,a=t.z-i.z;e.x=n*o[0]+s*o[3]+a*o[6],e.y=n*o[1]+s*o[4]+a*o[7],e.z=n*o[2]+s*o[5]+a*o[8]},PhysicsBody.prototype.getGlobalDirectionFromlocalToRef=function(t,e){var o=this.body.rotation.elements,i=t.x,n=t.y,s=t.z;e.x=i*o[0]+n*o[1]+s*o[2],e.y=i*o[3]+n*o[4]+s*o[5],e.z=i*o[6]+n*o[7]+s*o[8]},PhysicsBody.prototype.getGlobalPositionFromLocalToRef=function(t,e){var o=this.body.rotation.elements,i=this.body.position,n=t.x,s=t.y,a=t.z;e.x=n*o[0]+s*o[1]+a*o[2]+i.x,e.y=n*o[3]+s*o[4]+a*o[5]+i.y,e.z=n*o[6]+s*o[7]+a*o[8]+i.z},PhysicsBody.prototype.translate=function(t,e,o){var i=this.body.position;i.x+=t,i.y+=e,i.z+=o;var n=this.body.shapes.position;n.x=i.x,n.y=i.y,n.z=i.z,this.body.shapes.updateProxy()},PhysicsBody.prototype.removeVelocity=function(){this.body.linearVelocity.x=0,this.body.linearVelocity.y=0,this.body.linearVelocity.z=0,this.body.angularVelocity.x=0,this.body.angularVelocity.y=0,this.body.angularVelocity.z=0},PhysicsBody.prototype.copy=function(t){var e=t.body.rotation.elements,o=this.body.rotation.elements;o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[8]=e[8],(o=this.body.shapes.rotation.elements)[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[8]=e[8];var i=this.body.orientation,n=t.body.orientation;i.s=n.s,i.x=n.x,i.y=n.y,i.z=n.z,this.copyRotationElements();var s=t.body.position;this.setPosition(s.x,s.y,s.z)},PhysicsBody.prototype.removeCollidesWith=function(t){this.testCollidesWith(t)&&(this.body.shapes.collidesWith=this.body.shapes.collidesWith&~t)},PhysicsBody.prototype.addCollidesWith=function(t){this.testCollidesWith(t)||(this.body.shapes.collidesWith=this.body.shapes.collidesWith|t)},PhysicsBody.prototype.setCollidesWithNone=function(){this.body.shapes.collidesWith=0},PhysicsBody.prototype.setBelongsTo=function(t){this.body.shapes.belongsTo=t},PhysicsBody.prototype.testCollidesWith=function(t){return 0!=(this.body.shapes.collidesWith&t)},PhysicsBody.prototype.syncShapes=function(){this.body.syncShapes()},PhysicsBody.prototype.reset=function(){this.onGround=!1,this.onGroundStartTime=0,this.onGroundEndTime=0,this.onGroundDuration=0,this.pitchDiff=0,this.standAng.targetValue=0,this.standForceMult=0,this.standForceEase=.2,this.maxStandForce=0,this.lastStandAng=0,this.angToStandTarget=0,this.frameUpSpaceComputed=-1,this.lastFrameSpeedAbove=s.app.frameNum},PhysicsBody.prototype.updateGroundTime=function(t){0<this.onGroundDuration&&!this.onGround&&(this.onGroundEndTime=t),this.onGround?this.onGroundDuration=t-this.onGroundStartTime:this.onGroundDuration=this.onGroundEndTime-t},PhysicsBody.prototype.update=function(){this.onGround&&this.onGroundCount<0&&(this.onGroundCount=0),!this.onGround&&0<this.onGroundCount&&(this.onGroundCount=0),this.onGround?this.onGroundCount++:this.onGroundCount--,this.standAng&&this.standAng.update();var t=this.body.position,e=t.x-this.lastPosX,o=t.y-this.lastPosY,i=t.z-this.lastPosZ;this.speedSq=e*e+o*o+i*i,this.lastPosX=t.x,this.lastPosY=t.y,this.lastPosZ=t.z,this.speedSq>this.speedToWatch*this.speedToWatch&&(this.lastFrameSpeedAbove=s.app.frameNum)},PhysicsBody.prototype.removeBody=function(){this.body.parent&&(this.body.shapes.position.y=999,this.body.syncShapes(),this.body.parent.removeRigidBody(this.body))},PhysicsBody.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],PhysicsBody.tempQuat=new OIMO.Quat,PhysicsBody}();s.PhysicsBody=t}(z0||(z0={})),function(t){var e=function(){function PhysicsJoint(t,e){void 0===t&&(t=1),void 0===e&&(e=1),this._len=0,this.origLen=0,this.maxLen=0,this.lerpAmount=1,this.jointDir=1,this._frac=1,this.jointDir=t,this.lerpAmount=e}return Object.defineProperty(PhysicsJoint.prototype,"len",{get:function(){return this._len},set:function(t){this._len=t,this._frac=t/this.origLen},enumerable:!1,configurable:!0}),Object.defineProperty(PhysicsJoint.prototype,"frac",{get:function(){return this._frac},set:function(t){this._frac=t,this._len=this.origLen*t},enumerable:!1,configurable:!0}),PhysicsJoint.prototype.init=function(t,e){this.joint=t,this.origLen=e,this.len=e,this.maxLen=2*this.origLen},PhysicsJoint.prototype.reset=function(){this.len=this.origLen,this.maxLen=2*this.origLen,this.frac=1,this.jointDir<0?this.joint.localAnchorPoint2.z=this.len:this.joint.localAnchorPoint1.z=-this.len},PhysicsJoint.prototype.update=function(){1==this.lerpAmount?this.jointDir<0?this.joint.localAnchorPoint2.z=this.len:this.joint.localAnchorPoint1.z=-this.len:this.jointDir<0?this.joint.localAnchorPoint2.z=z1.lerpNumber(this.joint.localAnchorPoint2.z,this.len,this.lerpAmount):this.joint.localAnchorPoint1.z=z1.lerpNumber(this.joint.localAnchorPoint1.z,-this.len,this.lerpAmount)},PhysicsJoint.prototype.setAngLimits=function(t,e){this.joint.limitMotor.lowerLimit=t,this.joint.limitMotor.upperLimit=e},PhysicsJoint}();t.PhysicsJoint=e}(z0||(z0={})),function(s){var t=function(){function z1061HitTracker(t){this.rodent=null,this.pubsub=new Pubsub,this.hits=new z1072Set,this.bodies=[],this.rodent=t,this.pubsub.subscribe("hit",this.onTrigger.bind(this))}return z1061HitTracker.prototype.addBody=function(t){t.shapes.pubsub=this.pubsub,-1==this.bodies.indexOf(t)&&this.bodies.push(t)},z1061HitTracker.prototype.removeBody=function(t){var e=this.bodies.indexOf(t);-1!=e&&this.bodies.splice(e,1),t.shapes.pubsub=null},z1061HitTracker.prototype.enable=function(){for(var t=0;t<this.bodies.length;t++)this.bodies[t].pubsub=this.pubsub},z1061HitTracker.prototype.disable=function(){for(var t=0;t<this.bodies.length;t++)this.bodies[t].pubsub=null},z1061HitTracker.prototype.clearHits=function(){this.hits.clear()},z1061HitTracker.prototype.onTrigger=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=t[8].actor;if(o&&this.rodent!=o.rodent){var i=s.app.frameNum,n=t[8];this.hits.push(n,n.id,i)}},z1061HitTracker.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],z1061HitTracker}();s.z1061HitTracker=t}(z0||(z0={})),function(Y){var t=function(){function z1061Physics(){this.world=void 0,this.bodies=[],this.collisionSelfFrac=new SmartNumber(.95,.8),this.collisionOtherFrac=new SmartNumber(1,.8),this.headCollisionSelfFrac=new SmartNumber(1,.8),this.headBody=new Y.PhysicsBody,this.frontBody=new Y.PhysicsBody,this.middleBody=new Y.PhysicsBody,this.rearBody=new Y.PhysicsBody,this.neckJoint=new Y.PhysicsJoint(1,1),this.frontJoint=new Y.PhysicsJoint(1,1),this.rearJoint=new Y.PhysicsJoint(-1,1),this.draggerBody=null,this.draggerJoint=null,this.rodent=void 0,this._stayInsideBody=void 0,this._gravityFracOnGround=.2,this.touchingShapes=new z1072Set,this.touchingAccTypes=0,this.stayInsideBodyType=void 0,this.localWalkForce=new OIMO.Vec3,this.groundXAxis=new OIMO.Vec3(1,0,0),this.groundYAxis=new OIMO.Vec3(0,1,0),this.groundZAxis=new OIMO.Vec3(0,0,1),this._touchingGround=!1,this.hitTracker=null,this.allowStretch=!0,this.stretchFrac=0,this.stretchDist=0,this.dragObjJoint=void 0,this._tempVec=new OIMO.Vec3}return Object.defineProperty(z1061Physics.prototype,"gravityFracOnGround",{get:function(){return this._gravityFracOnGround},set:function(t){this._gravityFracOnGround=t},enumerable:!1,configurable:!0}),Object.defineProperty(z1061Physics.prototype,"stayInsideBody",{get:function(){return this._stayInsideBody},set:function(t){this._stayInsideBody=t},enumerable:!1,configurable:!0}),z1061Physics.prototype.init=function(t,d,e,o,i,n,s,a){if(void 0===e&&(e=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===a&&(a=0),!this.world){this.world=t;var r=d.adjustLerp;this.collisionSelfFrac.lerpAmount=.8*r,this.collisionOtherFrac.lerpAmount=.8*r,this.headCollisionSelfFrac.lerpAmount=.8*r;var c,p=e,l=o,u=i,y=(this.rodent=d).num,g=d.size,m=this;t=this.world;this.frontBody.maxStandForce=10,this.middleBody.maxStandForce=10,this.rearBody.maxStandForce=30,this.frontBody.standForceMult=.1,this.middleBody.standForceMult=.2,this.rearBody.standForceMult=3;var f="sphere",A=1*g,b=1*g,v=1*g,x=.6*g,C=.7*g,S=Y.App.z1033,T=Y.App.PhysicsGroupBedding,B=Y.App.z1034,O=Y.App.PhysicsGroupDragger,P=Y.App.z1035,M=Y.App.z1036,I=Y.App.z1037;d.isMenuItem&&(S=Y.App.z1033Menu,B=Y.App.z1034Menu,O=Y.App.PhysicsGroupDraggerMenu,I=M=P=T=0);var N=[1,.05,.2];y="hamster"+d.num;N[0]=1,N[1]=.05;var z=0,w=0,_=0;null!=s&&(w=180*s/Math.PI),null!=n&&(z=180*n/Math.PI),null!=a&&(_=180*a/Math.PI);var R=function(t,e,o,i,n,s,a,r){if(r.type==OIMO.SHAPE_GROUND||.9<n){var c=d.targets;c.numUpVecTargets++,c.totUpVecTargets.x+=i,c.totUpVecTargets.y+=n,c.totUpVecTargets.z+=s}else r.type},L=function(t,e,o,i,n,s,a,r){if(r.entity&&(m.touchingShapes.push(r,r.id,Y.app.frameNum),m.touchingAccTypes|=r.entity.accType,m.frontBody.touchingAccTypes|=r.entity.accType),.1<n){if(m.frontBody.body.position.y-e<.3*m.rodent.size)return;m.frontBody.onGround=!0,m.frontBody.onGroundShape=r,m.frontBody.onGroundDuration<0&&(m.frontBody.onGroundStartTime=Y.app.time)}};m.rearBody.groundAxisY=new OIMO.Vec3(0,1,0);var F=BABYLON.Matrix.Identity().setTranslation(new BABYLON.Vector3(0,0,1)),D=BABYLON.Matrix.Identity();BABYLON.Matrix.RotationYawPitchRollToRef(s,n,a,D),F.multiplyToRef(D,F);var E=F.getTranslation();N[3]=B,N[4]=B|S|T|Y.App.PhysicsGroupTriggerArea|P|M|I;var k=new OIMO.Body({type:f,size:[A,A,A],pos:[p+E.x*C,l+E.y*C,u+E.z*C],rot:[z,w,_],move:!0,world:t,name:y+"_front",config:N}).body;k.allowSleep=!1,k.shapes.actor=m,k.shapes.hitListeners=[],k.shapes.hitListeners.push(R),k.shapes.hitListeners.push(L),m.frontBody.body=k,m.frontBody.radius=A,m.frontBody.radiusOrig=A,k.hamSegNum=1,N[0]=1,N[1]=.05,N[3]=B,N[4]=B|S|T|Y.App.PhysicsGroupTriggerArea|P|M|I,(k=new OIMO.Body({type:f,size:[b,b,b],pos:[p,l,u],rot:[z,w,_],world:t,move:!0,name:y+"_middle",config:N}).body).allowSleep=!1,k.shapes.actor=m,k.shapes.hitListeners=[],k.shapes.hitListeners.push(R),k.shapes.hitListeners.push(function(t,e,o,i,n,s,a,r){if(r.entity&&(m.touchingShapes.push(r,r.id,Y.app.frameNum),m.touchingAccTypes|=r.entity.accType),.1<n){if(m.middleBody.body.position.y-e<.3*m.rodent.size)return;m.middleBody.onGround=!0,m.middleBody.onGroundShape=r,m.middleBody.onGroundDuration<0&&(m.middleBody.onGroundStartTime=Y.app.time)}}),m.middleBody.body=k,m.middleBody.radius=b,m.middleBody.radiusOrig=b,k.hamSegNum=2,N[0]=1,N[1]=.01,N[3]=B,N[4]=B|S|T|Y.App.PhysicsGroupTriggerArea|P|M|I,(k=new OIMO.Body({type:f,size:[v,v,v],pos:[p-E.x*C,l-E.y*C,u-E.z*C],rot:[z,w,_],move:!0,world:t,name:y+"_rear",config:N}).body).shapes.actor=m,k.shapes.hitListeners=[],k.shapes.hitListeners.push(R),k.shapes.hitListeners.push(function(t,e,o,i,n,s,a,r,c){if(r.entity&&(m.touchingShapes.push(r,r.id,Y.app.frameNum),m.touchingAccTypes|=r.entity.accType),.1<n){if(m.rearBody.body.position.y-e<.3*m.rodent.size)return;if(m.rodent.id,m.rearBody.onGround=!0,m.rearBody.onGroundShape=r,m.rearBody.lastFrameOnGround=Y.app.frameNum,m.rearBody.onGroundDuration<0&&(m.rearBody.onGroundStartTime=Y.app.time),c&&null!=c.x){var d=m.rearBody.groundAxisY;d.x=c.x,d.y=c.y,d.z=c.z}}else m.rodent.id}),m.rearBody.body=k,m.rearBody.radius=v,m.rearBody.radiusOrig=v,k.hamSegNum=3;var j,V=1.5*g;N[0]=.5,N[1]=.01,N[2]=.2,(k=new OIMO.Body({type:f,size:[x,x,x],pos:[p+E.x*V,l+E.y*V,u+E.z*V],rot:[z,w,_],move:!0,world:t,name:y+"_head",config:N}).body).allowSleep=!1,k.shapes.actor=m,k.shapes.hitListeners=[],k.shapes.hitListeners.push(L),m.headBody.body=k,m.headBody.radius=x,m.headBody.radiusOrig=x,k.hamSegNum=0,c=110;var G=1,W=d.size*G;j={type:"jointBall",body1:y+"_head",body2:y+"_front",pos1:[0,0,-W],pos2:[0,.15*d.size,0],collision:!1,world:t},m.neckJoint.init(new OIMO.Link(j).joint,W),c=180,j={type:"jointHinge",body1:y+"_front",body2:y+"_middle",pos1:[0,0,-(W=d.size*G)],pos2:[0,0,0],upperAngle:0,axe1:[0,1,0],axe2:[0,1,0],collision:!1,world:t,min:-c,max:c},m.frontJoint.init(new OIMO.Link(j).joint,W),G=1,c=80,j={type:"jointHinge",body1:y+"_middle",body2:y+"_rear",pos1:[0,0,0],pos2:[0,0,W=d.size*G],upperAngle:0,axe1:[1,0,0],axe2:[1,0,0],collision:!1,world:t,min:-c,max:c},m.rearJoint.init(new OIMO.Link(j).joint,W),(N=[1,1,1])[3]=O,N[4]=O,N[3]=null,N[4]=null;this.draggerBody=new OIMO.Body({type:"sphere",size:[.1,.1,.1],pos:[0,0,0],rot:[0,0,0],move:!1,world:t,name:y+"_dragger",config:N}).body,j={name:"bodyDraggerJoint",type:"jointDistance",body1:y+"_rear",body2:y+"_dragger",min:0,max:.01,pos1:[0,0,0],pos2:[0,0,0],collision:!1,spring:[7,.1],world:t},this.draggerJoint=new OIMO.Link(j).joint,this.world.removeRigidBody(this.draggerBody),this.frontBody.copyRotationElements(),this.middleBody.copyRotationElements(),this.rearBody.copyRotationElements(),this.headBody.copyRotationElements(),this.bodies[0]=this.headBody,this.bodies[1]=this.frontBody,this.bodies[2]=this.middleBody,this.bodies[3]=this.rearBody,this.frontBody.standAng||(this.frontBody.standAng=new SmartNumber(0,1)),this.middleBody.standAng||(this.middleBody.standAng=new SmartNumber(0,1)),this.rearBody.standAng||(this.rearBody.standAng=new SmartNumber(0,1,!0)),this.hitTracker||(this.hitTracker=new Y.z1061HitTracker(this.rodent),this.hitTracker.addBody(this.headBody.body),this.hitTracker.addBody(this.frontBody.body))}},z1061Physics.prototype.addHitListenerToBody=function(t,e){t.body.shapes.hitListeners.push(e)},z1061Physics.prototype.resetJoints=function(){this.frontJoint.frac=1,this.rearJoint.frac=1,this.neckJoint.frac=1},z1061Physics.prototype.reset=function(){this.headBody.body.shapes.friction=.01,this.frontBody.body.shapes.friction=.05,this.middleBody.body.shapes.friction=.05,this.rearBody.body.shapes.friction=.01,this.headCollisionSelfFrac.targetValue=1,this.collisionSelfFrac.targetValue=.95,this.collisionOtherFrac.targetValue=1,this.frontBody.standAng.targetValue=0,this.middleBody.standAng.targetValue=0,this.rearBody.standAng.targetValue=0,this.rearBody.standAng.lerpAmount=.2*this.rodent.adjustLerp,this.frontBody.onGroundShape=null,this.middleBody.onGroundShape=null,this.rearBody.onGroundShape=null;var t=-Math.PI/180*80,e=Math.PI/180*80;this.rearJoint.setAngLimits(t,e),this.stayInsideBody=null,this.stayInsideBodyType=null,this.headBody.radius=this.headBody.radiusOrig,this.frontBody.radius=this.frontBody.radiusOrig,this.middleBody.radius=this.middleBody.radiusOrig,this.rearBody.radius=this.rearBody.radiusOrig,this.gravityFracOnGround=.2,this.hitTracker&&this.hitTracker.clearHits()},z1061Physics.prototype.update=function(){this.neckJoint.update(),this.frontJoint.update(),this.rearJoint.update(),this.collisionOtherFrac.update(),this.collisionSelfFrac.update(),this.headCollisionSelfFrac.update(),this.collisionSelfFrac.value<.6&&this.collisionSelfFrac.value;var t=this.headBody,e=this.frontBody,o=this.middleBody,i=this.rearBody;t.body.shapes.collisionSelfFrac=this.headCollisionSelfFrac.value;var n=Y.app.time;e.updateGroundTime(n),o.updateGroundTime(n),i.updateGroundTime(n),e.update(),o.update(),i.update();var s=Y.app.world.gravity,a=Y.app.world.timeStep,r=z1061Physics.tempVecs[0];if(this.isTouchingGround()){r.x=0,r.y=0,r.z=0,r.addTime(s,-a*(1-this.gravityFracOnGround));var c=this.rodent,d=e.onGroundDuration;d<o.onGroundDuration&&(d=o.onGroundDuration),d<i.onGroundDuration&&(d=i.onGroundDuration);var p=c.isUpright(.7);(p||this._touchingGround||c.standing)&&(e.body.linearVelocity.addEqual(r),o.body.linearVelocity.addEqual(r),i.body.linearVelocity.addEqual(r),t.body.linearVelocity.addEqual(r))}e.onGround=!1,this.middleBody.onGround=!1,this.rearBody.onGround=!1,this._touchingGround=!1},z1061Physics.prototype.beforeWorldUpdate=function(){this.headBody.touchingAccTypes=0,this.frontBody.touchingAccTypes=0,this.middleBody.touchingAccTypes=0,this.rearBody.touchingAccTypes=0,this.touchingAccTypes=0,this.rodent.isMenuItem&&this.rodent.isMenuItem},z1061Physics.prototype.isTouchingGround=function(){return!!(this._touchingGround||this.frontBody.onGround||this.middleBody.onGround||this.rearBody.onGround)},z1061Physics.prototype.forceTouchGround=function(){this._touchingGround=!0;var t=this;t.frontBody.onGroundCount<0&&(t.frontBody.onGroundCount=0),t.middleBody.onGroundCount<0&&(t.middleBody.onGroundCount=0),t.rearBody.onGroundCount<0&&(t.rearBody.onGroundCount=0),t.frontBody.onGroundCount++,t.middleBody.onGroundCount++,t.rearBody.onGroundCount++,t.frontBody.onGroundStartTime=Y.app.time},z1061Physics.prototype._getRelativeBodyPosition=function(t,e){var o=this.rodent.mesh.position,i=t.body.position;e.x=i.x-o.x,e.y=i.y-o.y,e.z=i.z-o.z},z1061Physics.prototype.setPosition=function(t,e,o){this.rodent.isMenuItem&&this.rodent.isMenuItem,this.removeVelocity();var i=z1061Physics.tempVecs[0],n=this.rodent.size,s=.7*n,a=1.5*n,r=this.middleBody.body.position,c=this.middleBody;c.setPosition(t,e,o),c=this.frontBody,i.sub(c.body.position,r),i.normalize(i),c.setPosition(t+i.x*s,e+i.y*s,o+i.z*s),c=this.rearBody,i.sub(c.body.position,r),i.normalize(i),c.setPosition(t+i.x*s,e+i.y*s,o+i.z*s),c=this.headBody,i.sub(c.body.position,r),i.normalize(i),c.setPosition(t+i.x*a,e+i.y*a,o+i.z*a)},z1061Physics.prototype.setRotation=function(t,e,o){this.removeVelocity();var i=BABYLON.Matrix.Identity().setTranslation(new BABYLON.Vector3(0,0,1)),n=BABYLON.Matrix.Identity();BABYLON.Matrix.RotationYawPitchRollToRef(e,t,o,n),i.multiplyToRef(n,i);var s=i.getTranslation(),a=this.rodent.size,r=.7*a,c=1.5*a,d=this.middleBody.body.position,p=this.frontBody;p.setPosition(d.x+s.x*r,d.y+s.y*r,d.z+s.z*r),(p=this.rearBody).setPosition(d.x-s.x*r,d.y-s.y*r,d.z-s.z*r),(p=this.headBody).setPosition(d.x+s.x*c,d.y+s.y*c,d.z+s.z*c);var l=BABYLON.Quaternion.FromRotationMatrix(n);this.headBody.setRotationQuaternion(l),this.frontBody.setRotationQuaternion(l),this.middleBody.setRotationQuaternion(l),this.rearBody.setRotationQuaternion(l)},z1061Physics.prototype.rotateWithQuaternion=function(t){this.headBody.rotateWithQuaternion(t),this.frontBody.rotateWithQuaternion(t),this.middleBody.rotateWithQuaternion(t),this.rearBody.rotateWithQuaternion(t)},z1061Physics.prototype.stretchJoints=function(t,e,o){void 0===e&&(e=1),void 0===o&&(o=.5);var i=1*this.rodent.size,n=.18*-this.rodent.size;i<t?t=i:t<n&&(t=n),1==e?(this.neckJoint.len=this.neckJoint.origLen,this.frontJoint.len=this.frontJoint.origLen+t*(1-o),this.rearJoint.len=this.rearJoint.origLen+t*o):(this.neckJoint.len=z1.lerpNumber(this.neckJoint.len,this.neckJoint.origLen,e),this.frontJoint.len=z1.lerpNumber(this.frontJoint.len,this.frontJoint.origLen+t*(1-o),e),this.rearJoint.len=z1.lerpNumber(this.rearJoint.len,this.rearJoint.origLen+t*o,e));var s=this.frontJoint.len+this.rearJoint.len-(this.frontJoint.origLen+this.rearJoint.origLen);this.stretchFrac=s/i,this.stretchDist=s},z1061Physics.prototype.removeBodies=function(){this.headBody.body.parent&&(this.headBody.removeBody(),this.frontBody.removeBody(),this.middleBody.removeBody(),this.rearBody.removeBody(),this.world.removeRigidBody(this.draggerBody),this.hitTracker&&this.hitTracker.disable())},z1061Physics.prototype.addBodies=function(){this.headBody.body.parent||(this.world.addRigidBody(this.headBody.body),this.world.addRigidBody(this.frontBody.body),this.world.addRigidBody(this.middleBody.body),this.world.addRigidBody(this.rearBody.body),this.world.addJoint(this.neckJoint.joint),this.world.addJoint(this.frontJoint.joint),this.world.addJoint(this.rearJoint.joint),this.hitTracker&&this.hitTracker.enable())},z1061Physics.prototype.translate=function(t,e,o){this.rodent.isMenuItem&&this.rodent.isMenuItem,this.headBody.translate(t,e,o),this.frontBody.translate(t,e,o),this.middleBody.translate(t,e,o),this.rearBody.translate(t,e,o)},z1061Physics.prototype.setPositionDrag=function(t,e,o,i){void 0===i&&(i=!1);var n=this.draggerBody,s=this.rearBody.body,a=t-s.position.x,r=e-s.position.y,c=o-s.position.z;if(i)return this.removeDragger(),void this.translate(a,r,c);n.position.x=t,n.position.y=e,n.position.z=o;var d=n.shapes.position;d.x=t,d.y=e,d.z=o,n.shapes.updateProxy(),this.draggerJoint.parent||(this.translate(a,r,c),this.removeVelocity(),this.world.addRigidBody(this.draggerBody),this.world.addJoint(this.draggerJoint))},z1061Physics.prototype.removeDragger=function(){this.world.removeJoint(this.draggerJoint),this.world.removeRigidBody(this.draggerBody)},z1061Physics.prototype.removeVelocity=function(){this.headBody.removeVelocity(),this.frontBody.removeVelocity(),this.middleBody.removeVelocity(),this.rearBody.removeVelocity()},z1061Physics.prototype.copy=function(t){this.headBody.copy(t.headBody),this.frontBody.copy(t.frontBody),this.middleBody.copy(t.middleBody),this.rearBody.copy(t.rearBody)},z1061Physics.prototype.removeCollidesWith=function(t){this.headBody.removeCollidesWith(t),this.frontBody.removeCollidesWith(t),this.middleBody.removeCollidesWith(t),this.rearBody.removeCollidesWith(t)},z1061Physics.prototype.addCollidesWith=function(t){this.headBody.addCollidesWith(t),this.frontBody.addCollidesWith(t),this.middleBody.addCollidesWith(t),this.rearBody.addCollidesWith(t)},z1061Physics.prototype.setCollidesWithNone=function(){this.headBody.setCollidesWithNone(),this.frontBody.setCollidesWithNone(),this.middleBody.setCollidesWithNone(),this.rearBody.setCollidesWithNone()},z1061Physics.prototype.setBelongsTo=function(t){this.headBody.setBelongsTo(t),this.frontBody.setBelongsTo(t),this.middleBody.setBelongsTo(t),this.rearBody.setBelongsTo(t)},z1061Physics.prototype.hardReset=function(){this.resetJoints(),this._touchingGround=!1,this.stayInsideBody=null,this.stayInsideBodyType=null,this.groundXAxis.init(1,0,0),this.groundYAxis.init(0,1,0),this.groundZAxis.init(0,0,1),this.frontBody.standAng.targetValue=0,this.rearBody.standAng.targetValue=0,this.neckJoint.reset(),this.frontJoint.reset(),this.rearJoint.reset(),this.localWalkForce.x=0,this.localWalkForce.y=0,this.localWalkForce.z=0,this.headBody.reset(),this.frontBody.reset(),this.middleBody.reset(),this.rearBody.reset(),this.collisionOtherFrac.reset(),this.collisionSelfFrac.reset(),this.headCollisionSelfFrac.reset(),this.hitTracker&&this.hitTracker.clearHits(),this.setCollidesWithNone(),this.rodent.isMenuItem?(this.setBelongsTo(Y.App.z1034Menu),this.addCollidesWith(Y.App.z1033Menu)):(this.setBelongsTo(Y.App.z1034),this.addCollidesWith(Y.App.z1034),this.addCollidesWith(Y.App.z1033),this.addCollidesWith(Y.App.z1035),this.addCollidesWith(Y.App.PhysicsGroupBedding),this.addCollidesWith(Y.App.PhysicsGroupTriggerArea),this.addCollidesWith(Y.App.z1036),this.addCollidesWith(Y.App.z1037))},z1061Physics.prototype.isFalling=function(){var t=this.frontBody.onGroundCount;return t<this.middleBody.onGroundCount&&(t=this.middleBody.onGroundCount),t<this.rearBody.onGroundCount&&(t=this.rearBody.onGroundCount),t<-10},z1061Physics.prototype.getLocalPosFromWorldPosInBody=function(t,e,o,i){z1.getOIMOLocalPositionFromGlobalToRef(e,t,o);var n=o.x,s=o.y,a=o.z,r=n*n+s*s+a*a;if(i*i<r){var c=Math.sqrt(r);o.x=n/c*i,o.y=s/c*i,o.z=a/c*i}},z1061Physics.prototype.removeDragObjJoint=function(){var t=this.dragObjJoint;t&&t.parent&&this.world.removeJoint(t)},z1061Physics.prototype.addDragJointAt=function(t,e,o,i,n){var s=this.dragObjJoint,a=this._tempVec;this.getLocalPosFromWorldPosInBody(t,e,a,i);var r=a.x,c=a.y,d=a.z;this.getLocalPosFromWorldPosInBody(t,o,a,n);var p=a.x,l=a.y,u=a.z;if(s){s.parent&&this.world.removeJoint(s),s.body1=e,s.localAnchorPoint1.x=r,s.localAnchorPoint1.y=c,s.localAnchorPoint1.z=d,s.body2=o,s.localAnchorPoint2.x=p,s.localAnchorPoint2.y=l,s.localAnchorPoint2.z=u;var y=s.t,b1=e,b2=o;y.b1=b1,y.b2=b2,y.l1=b1.linearVelocity,y.l2=b2.linearVelocity,y.a1=b1.angularVelocity,y.a2=b2.angularVelocity,y.i1=b1.inverseInertia,y.i2=b2.inverseInertia,this.world.addJoint(s)}else{var g={name:"bodyDraggerJoint",type:"jointDistance",body1:e,body2:o,min:0,max:.01,pos1:[r,c,d],pos2:[p,l,u],collision:!1,spring:[7,.1],world:this.world};this.dragObjJoint=new OIMO.Link(g).joint}},z1061Physics.prototype.isBodyFacingPos=function(t,e,o){void 0===o&&(o=.5);var i=z1061Physics.z4[0],n=z1061Physics.z4[1],s=t.body.position;i.x=e.x-s.x,i.y=0,i.z=e.z-s.z,i.normalize();var a=t.rotationElements;return a[5]<a[4]?(n.x=a[2],n.y=0,n.z=a[8]):(n.x=-a[1],n.y=0,n.z=-a[7]),n.normalize(),o<BABYLON.Vector3.Dot(i,n)},z1061Physics.prototype.getTouchingz1092ByType=function(t){if(this.touchingAccTypes&t)for(var e=0;e<this.touchingShapes.length;e++){var o=this.touchingShapes.data.data[e];if(o.entity&&o.entity.accType==t)return o.entity}},z1061Physics.tempVecs=[new OIMO.Vec3,new OIMO.Vec3],z1061Physics.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],z1061Physics}();Y.z1061Physics=t}(z0||(z0={})),function(o){var t=function(e){function z91(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[],t.updatez156=[o.z156.z717,o.z156.z192],t.exitz156=[],t.transitions=[{condition:o.z768.z1001,falseNode:{previousState:!0}}],t}return __extends(z91,e),z91}(z49);o.z91=t}(z0||(z0={})),function(o){var t=function(e){function z57(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[],t.updatez156=[o.z156.z191,o.z156.z331],t.exitz156=[],t.states=[o.z124],t.transitions=[],t}return __extends(z57,e),z57}(z49);o.z57=t}(z0||(z0={})),function(o){var t=function(e){function z56(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[],t.updatez156=[o.z156.z191,o.z156.z331],t.exitz156=[],t.states=[o.z58],t.initialState=o.z58,t}return __extends(z56,e),z56}(z49);o.z56=t}(z0||(z0={})),function(o){var t=function(e){function z120(){var t=null!==e&&e.apply(this,arguments)||this;return t.historyLength=5,t.enterz156=[],t.updatez156=[o.z156.z633],t.states=[z49,o.z36,o.z37,o.z91,o.z6,o.z11,o.z102,o.z43,o.z132,o.z38,o.z112,o.z50,o.z62,o.z78,o.z92,o.z123,o.z56,o.z60,o.z118,o.z94,o.z45,o.z16,o.z48,o.z34,o.z82,o.z81,o.z40,o.z143,o.z147,o.z98,o.z93,o.z44,o.z119,o.z32],t.transitions=[{condition:o.z768.z859,trueNode:{condition:o.z768.z830,falseNode:{state:o.z112,level:-1,actions:[o.z156.z508,o.z156.z507]}}}],t.listeners=[{event:o.z1061Events.DRAG,state:o.z118,level:-1}],t.initialState=o.z112,t}return __extends(z120,e),z120}(z49);o.z120=t}(z0||(z0={})),function(o){var t=function(e){function z118(){var t=null!==e&&e.apply(this,arguments)||this;return t.allowEvents=[o.z1061Events.DROP],t.enterz156=[o.z156.z502,o.z156.z514,o.z156.z511,o.z156.z496],t.updatez156=[],t.transitions=[{condition:o.z768.z974,falseNode:{condition:o.z768.CondWasPreviousz60,trueNode:{state:o.z36},falseNode:{previousState:!0}}}],t.listeners=[{event:o.z1061Events.DROP,state:o.z36}],t}return __extends(z118,e),z118}(z49);o.z118=t}(z0||(z0={})),function(o){var t=function(e){function z92(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[],t.updatez156=[o.z156.z208,o.z156.z209,o.z156.z532,o.z156.z733,o.z156.z734],t.exitz156=[],t.transitions=[{condition:o.z768.z820,trueNode:{state:o.z112,actions:[]}},{condition:o.z768.z842,trueNode:{state:o.z116,actions:[o.z156.z314]}},{condition:o.z768.z978,trueNode:{state:o.z112}}],t}return __extends(z92,e),z92}(z49);o.z92=t}(z0||(z0={})),function(o){var t=function(e){function z89(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[],t.updatez156=[],t.states=[o.z120],t.initialState=o.z120,t}return __extends(z89,e),z89}(z49);o.z89=t}(z0||(z0={})),function(o){var t=function(e){function z43(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z400,o.z156.z334,o.z156.z483,o.z156.z272,o.z156.z382,o.z156.z501,o.z156.z720],t.updatez156=[o.z156.z382,o.z156.z495,o.z156.z483,o.z156.z536,o.z156.z542,o.z156.z386,o.z156.z393,o.z156.z581,o.z156.z209,o.z156.z455,o.z156.z532,o.z156.z327],t.transitions=[{condition:o.z768.z924,trueNode:{condition:o.z768.z991,trueNode:{state:o.z11}}},{condition:o.z768.z787,trueNode:{state:o.z108}}],t.exitz156=[o.z156.z502],t}return __extends(z43,e),z43}(z49);o.z43=t}(z0||(z0={})),function(o){var t=function(e){function z41(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z725,o.z156.z306,o.z156.z407],t.updatez156=[o.z156.z166,o.z156.z681,o.z156.z724,o.z156.z210,o.z156.z209,o.z156.z532,o.z156.z733,o.z156.z734],t.state=[],t.exitz156=[o.z156.z502],t.transitions=[{condition:o.z768.z976,trueNode:{condition:o.z768.z814,trueNode:{state:o.z110},falseNode:{state:o.z111}}}],t}return __extends(z41,e),z41}(z49);o.z41=t}(z0||(z0={})),function(o){var t=function(e){function z37(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z265],t.updatez156=[o.z156.z191,o.z156.z208,o.z156.z209,o.z156.z532,o.z156.z733,o.z156.z734],t.exitz156=[],t.transitions=[{condition:o.z768.z977,trueNode:{condition:o.z768.z835,trueNode:{condition:o.z768.z892,trueNode:{state:o.z119}}}},{condition:o.z768.z850,trueNode:{state:o.z6}},{condition:o.z768.z851,trueNode:{condition:o.z768.z961,trueNode:{state:o.z48,level:0}}},{condition:o.z768.z854,trueNode:{condition:o.z768.z900,trueNode:{state:o.z82,level:0}}},{condition:o.z768.z1001,trueNode:{state:o.z91,level:0}},{condition:o.z768.z966,trueNode:{condition:o.z768.z943,falseNode:{condition:o.z768.z1028,trueNode:{state:o.z36}}}},{condition:o.z768.z966,trueNode:{condition:o.z768.z943,falseNode:{condition:o.z768.z1013,trueNode:{condition:o.z768.z1015,trueNode:{state:o.z112}}}}},{condition:o.z768.z962,trueNode:{condition:o.z768.z943,falseNode:{condition:o.z768.z1013,trueNode:{state:o.z34}}}},{condition:o.z768.z882,trueNode:{condition:o.z768.z880,falseNode:{state:o.z34,actions:[o.z156.z483,o.z156.z470]}}}],t}return __extends(z37,e),z37}(z49);o.z37=t}(z0||(z0={})),function(o){var t=function(e){function z36(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z684,o.z156.z265],t.updatez156=[o.z156.z189,o.z156.z592,o.z156.z593,o.z156.z209,o.z156.z532,o.z156.z733,o.z156.z734,o.z156.z210],t.exitz156=[o.z156.z489,o.z156.z487],t.transitions=[{condition:o.z768.z785,trueNode:{state:o.z37,actions:[o.z156.z421,o.z156.z314]}},{condition:o.z768.z1028,falseNode:{state:o.z37}},{condition:o.z768.z982,falseNode:{state:o.z37}},{condition:o.z768.z1030,trueNode:{condition:o.z768.z1005,trueNode:{state:o.z93}}},{condition:o.z768.z903,trueNode:{condition:o.z768.z916,trueNode:{state:o.z102,level:0},falseNode:{condition:o.z768.z902,trueNode:{condition:o.z768.z1030,falseNode:{state:o.z102}}}}},{condition:o.z768.z1014,trueNode:{condition:o.z768.z1015,trueNode:{state:o.z112}}},{condition:o.z768.z981,trueNode:{condition:o.z768.z895,trueNode:{state:o.z60}}},{condition:o.z768.z977,trueNode:{condition:o.z768.z837,trueNode:{condition:o.z768.z936,trueNode:{state:o.z44}}}},{condition:o.z768.z977,trueNode:{condition:o.z768.z835,trueNode:{condition:o.z768.z892,trueNode:{state:o.z119}}}}],t}return __extends(z36,e),z36}(z49);o.z36=t}(z0||(z0={})),function(o){var t=function(e){function z35(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z311],t.updatez156=[o.z156.z208,o.z156.z209,o.z156.z532,o.z156.z733,o.z156.z734],t.exitz156=[],t.transitions=[{condition:o.z768.z853,trueNode:{state:o.z112,actions:[o.z156.z492]}},{condition:o.z768.z964,trueNode:{state:o.z112,actions:[o.z156.z160,o.z156.z698]}}],t}return __extends(z35,e),z35}(z49);o.z35=t}(z0||(z0={})),function(o){var t=function(e){function z34(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z310],t.updatez156=[o.z156.z208,o.z156.z209,o.z156.z532,o.z156.z733,o.z156.z734],t.exitz156=[],t.transitions=[{condition:o.z768.z982,falseNode:{state:o.z37}},{condition:o.z768.z853,trueNode:{state:o.z112,actions:[o.z156.z492]}},{condition:o.z768.z852,falseNode:{state:o.z116,actions:[o.z156.z310]}},{condition:o.z768.z882,trueNode:{condition:o.z768.z880,falseNode:{state:o.z116,actions:[o.z156.z597,o.z156.z483,o.z156.z310]}}},{condition:o.z768.z964,trueNode:{condition:o.z768.z966,trueNode:{condition:o.z768.z869,falseNode:{state:o.z112,actions:[o.z156.z492]}},falseNode:{state:o.z116,actions:[o.z156.z310]}}}],t}return __extends(z34,e),z34}(z49);o.z34=t}(z0||(z0={})),function(o){var t=function(e){function z33(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z309],t.updatez156=[o.z156.z208,o.z156.z209,o.z156.z532,o.z156.z733,o.z156.z734],t.exitz156=[],t.transitions=[{condition:o.z768.z853,trueNode:{state:o.z112,actions:[o.z156.z492]}},{condition:o.z768.z964,trueNode:{state:o.z35,actions:[o.z156.z160,o.z156.z698]}}],t}return __extends(z33,e),z33}(z49);o.z33=t}(z0||(z0={})),function(o){var t=function(e){function z137(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z644],t.updatez156=[o.z156.z764,o.z156.z559,o.z156.z354,o.z156.z536,o.z156.z693,o.z156.z751,o.z156.z542],t.transitions=[{condition:ABHSM.z813,trueNode:{state:o.z133}},{condition:ABHSM.z813,trueNode:{state:o.z134}}],t.exitz156=[o.z156.z643],t}return __extends(z137,e),z137}(z49);o.z137=t}(z0||(z0={})),function(o){var t=function(e){function z136(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[],t.updatez156=[o.z156.z537,o.z156.z542,o.z156.z692],t.exitz156=[],t}return __extends(z136,e),z136}(z49);o.z136=t}(z0||(z0={})),function(o){var t=function(e){function z135(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[],t.updatez156=[o.z156.z537,o.z156.z542,o.z156.z691],t.exitz156=[],t}return __extends(z135,e),z135}(z49);o.z135=t}(z0||(z0={})),function(o){var t=function(e){function z134(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[],t.updatez156=[o.z156.z559,o.z156.z353,o.z156.z539,o.z156.z690,o.z156.z751,o.z156.z542],t.transitions=[{condition:ABHSM.z813,trueNode:{state:o.z133}},{condition:ABHSM.z813,trueNode:{state:o.z137}}],t.exitz156=[],t}return __extends(z134,e),z134}(z49);o.z134=t}(z0||(z0={})),function(o){var t=function(e){function z133(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z643],t.updatez156=[o.z156.z559,o.z156.z353,o.z156.z538,o.z156.z689,o.z156.z751,o.z156.z542],t.transitions=[{condition:ABHSM.z813,trueNode:{state:o.z137}},{condition:ABHSM.z813,trueNode:{state:o.z134}}],t.exitz156=[],t}return __extends(z133,e),z133}(z49);o.z133=t}(z0||(z0={})),function(o){var t=function(e){function z132(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z495,o.z156.z334,o.z156.z483,o.z156.z272],t.updatez156=[o.z156.z507,o.z156.z764,o.z156.z382,o.z156.z327,o.z156.z208,o.z156.z209,o.z156.z455,o.z156.z532,o.z156.z603],t.transitions=[{condition:o.z768.z962,trueNode:{state:o.z37}},{condition:o.z768.z973,trueNode:{state:o.z112}}],t.exitz156=[o.z156.z502,o.z156.z643],t.states=[o.z137,o.z134,o.z133,o.z135,o.z136],t.initialState=o.z134,t}return __extends(z132,e),z132}(z49);o.z132=t}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z751(){return null!==t&&t.apply(this,arguments)||this}return __extends(z751,t),z751.prototype.update=function(t){var e=t.bones.legFL.ikCtrl.targetPosition,o=t.bones.legFR.ikCtrl.targetPosition,i=z767.z4[0],n=z767.z4[1],s=t.physics.frontBody.body.position;n.x=s.x,n.y=s.y,n.z=s.z,e.addToRef(o,i),i.scaleInPlace(.5),i.subtractInPlace(n),t.targets.lookToTarget.addInPlace(i)},z751}(z767),e.z751=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z695(){var t=null!==e&&e.apply(this,arguments)||this;return t.localAxisX=.84,t.localAxisY=.454,t.localAxisZ=.294,t.centerX=-.046,t.centerY=.155,t.centerZ=-.14,t.cleanRadiusX=.05,t.cleanRadiusY=0,t.cleanRadiusZ=.166,t.cleanSpeed=-.6,t.poleTargetX=-.9,t.poleTargetY=.3,t.poleTargetZ=-.9,t.poleAng=2.57,t.localAxis=BABYLON.Vector3.Zero(),t.translate=BABYLON.Vector3.Zero(),t.upAxis=BABYLON.Vector3.Zero(),t}return __extends(z695,e),z695.prototype.update=function(t){var e=this.localAxis,o=this.translate,i=this.upAxis;e.x=-this.localAxisX,e.y=this.localAxisY,e.z=this.localAxisZ,o.x=this.centerX,o.y=this.centerY,o.z=this.centerZ;var n=this.bone;n.getDirectionToRef(BABYLON.Axis.Y,t.mesh,i);var s=this.cleanRadiusX,a=this.cleanRadiusY,r=this.cleanRadiusZ,c=this.cleanSpeed,d=t.bones.legFL;d.targetPoleAngle=-this.poleAng,d.ikCtrl.poleTargetLocalOffset.x=this.poleTargetX,d.ikCtrl.poleTargetLocalOffset.y=this.poleTargetY,d.ikCtrl.poleTargetLocalOffset.z=d.dirX*this.poleTargetZ;var p=.5*t.adjustLerp;d.cleanController.update(n,i,e,o,s,a,r,c,p),(d=t.bones.legFR).targetPoleAngle=this.poleAng,d.ikCtrl.poleTargetLocalOffset.x=this.poleTargetX,d.ikCtrl.poleTargetLocalOffset.y=this.poleTargetY,d.ikCtrl.poleTargetLocalOffset.z=d.dirX*this.poleTargetZ,e.x=this.localAxisX,e.y=this.localAxisY,e.z=this.localAxisZ,o.x*=-1;p=.5*t.adjustLerp;d.cleanController.update(n,i,e,o,-s,a,r,c,p)},z695}(z767),e.z695=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z696(){var t=null!==e&&e.apply(this,arguments)||this;return t.centerX=-.01,t.centerY=.05,t.centerZ=-.25,t.cleanRadiusX=.02,t.cleanRadiusY=.02,t.cleanRadiusZ=.02,t.cleanSpeed=1,t.poleTargetX=-.9,t.poleTargetY=.3,t.poleTargetZ=-.9,t.poleAng=1.6,t}return __extends(z696,e),z696.prototype.update=function(t){this.bone=t.bones.spine2.bone,e.prototype.update.call(this,t)},z696}(e.z695),e.z696=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(o){function z694(){return null!==o&&o.apply(this,arguments)||this}return __extends(z694,o),z694.prototype.update=function(t){this.localAxisX=1,this.localAxisY=0,this.localAxisZ=0;var e=t.getScale();this.centerX=-.01,this.centerY=0,this.centerZ=.5*-this.bone.length*e,this.cleanRadiusX=.02,this.cleanRadiusY=.02,this.cleanRadiusZ=.5*this.bone.length*e,this.cleanSpeed=-.5,this.poleAng=1.6,o.prototype.update.call(this,t),this.translate.x=0,this.translate.y=0,t.bones.head.cleanController.update(this.bone,this.upAxis,this.localAxis,this.translate,this.cleanRadiusX,this.cleanRadiusY,this.cleanRadiusZ,this.cleanSpeed,.5*t.adjustLerp),t.targets.lookToTarget.copyFrom(t.bones.head.cleanController.target)},z694}(e.z695),e.z694=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z693(){var t=null!==e&&e.apply(this,arguments)||this;return t.pawRotTar=BABYLON.Quaternion.RotationYawPitchRoll(0,1.3,0),t.localAxisX=.84,t.localAxisY=.454,t.localAxisZ=.294,t.centerX=-.029,t.centerY=.155,t.centerZ=-.09,t.cleanRadiusX=.05,t.cleanRadiusY=0,t.cleanRadiusZ=.2,t}return __extends(z693,e),z693.prototype.update=function(t){this.poleAng=2.57,this.bone=t.bones.head.bone,e.prototype.update.call(this,t),t.bones.legFR.setPawRotationTarget(this.pawRotTar),t.bones.legFL.setPawRotationTarget(this.pawRotTar)},z693}(e.z695),e.z693=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z692(){return e.call(this)||this}return __extends(z692,e),z692.prototype.update=function(t){t.bones.fracShoulderHeadYaw.targetValue=1,this.bone=t.bones.legRL.bone2,e.prototype.update.call(this,t)},z692}(e.z694),e.z692=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z691(){return e.call(this)||this}return __extends(z691,e),z691.prototype.update=function(t){t.bones.fracShoulderHeadYaw.targetValue=1,this.bone=t.bones.legRR.bone2,e.prototype.update.call(this,t)},z691}(e.z694),e.z691=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z690(){var t=null!==e&&e.apply(this,arguments)||this;return t.localAxisX=1,t.localAxisY=.2,t.localAxisZ=0,t.centerX=.02,t.centerY=.03,t.centerZ=-.25,t.cleanRadiusX=.04,t.cleanRadiusY=0,t.cleanRadiusZ=.09,t.cleanSpeed=-.67,t.poleAng=2.14,t.poleTargetX=-.9,t.poleTargetY=-.9,t.poleTargetZ=-.9,t}return __extends(z690,e),z690.prototype.update=function(t){t.targets.lookToTarget.y+=t.size,this.bone=t.bones.head.bone,e.prototype.update.call(this,t)},z690}(e.z695),e.z690=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(i){function z689(){var t=null!==i&&i.apply(this,arguments)||this;return t.localAxisX=1,t.localAxisY=0,t.localAxisZ=0,t.centerX=-.01,t.centerY=.05,t.centerZ=-.25,t.cleanRadiusX=.05,t.cleanRadiusY=.02,t.cleanRadiusZ=.05,t.cleanSpeed=-.55,t.poleAng=2.4,t}return __extends(z689,i),z689.prototype.update=function(t){this.bone=t.bones.head.bone;var e=.02*t.frameNum,o=Math.sin(2*e)+Math.sin(Math.PI*e);o*=.25,o+=.5,this.cleanRadiusX=.05*o,this.centerY=this.cleanRadiusX,i.prototype.update.call(this,t)},z689}(e.z695),e.z689=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z603(){return null!==t&&t.apply(this,arguments)||this}return __extends(z603,t),z603.prototype.update=function(t){t.levels.clean.step(2)},z603}(z767),e.z603=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z559(){return null!==t&&t.apply(this,arguments)||this}return __extends(z559,t),z559.prototype.update=function(t){t.bones.head.updateNod(.01,1),t.whiskers.move()},z559}(z767),e.z559=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z451(){return null!==e&&e.apply(this,arguments)||this}return __extends(z451,e),z451.prototype.update=function(t){t.targets.lookToTarget.y+=t.size,this.bone=t.bones.head.bone,this.localAxisX=1,this.localAxisY=.2,this.localAxisZ=0,this.centerX=.026,this.centerY=.05,this.centerZ=-.244,this.cleanRadiusX=.02,this.cleanRadiusY=.02,this.cleanRadiusZ=.02,this.cleanSpeed=-1,e.prototype.update.call(this,t)},z451}(e.z695),e.z451=o}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z257(){return null!==t&&t.apply(this,arguments)||this}return __extends(z257,t),z257.prototype.update=function(t){if(t.cage){var e=.2;t.physics.touchingAccTypes&o.z1044.z1045&&(e=.4),t.targets.standHeight.targetValue=e}},z257}(z767),t.z257=e}(z0||(z0={})),function(o){var t=function(e){function z112(){var t=null!==e&&e.apply(this,arguments)||this;return t.historyLength=3,t.enterz156=[o.z156.z726],t.updatez156=[o.z156.z724],t.exitz156=[o.z156.z463],t.transitions=[{condition:o.z768.z962,trueNode:{state:o.z37}},{condition:o.z768.z1004,trueNode:{nodes:[{condition:o.z768.z982,falseNode:{state:o.z37}},{condition:o.z768.z976,trueNode:{condition:o.z768.z990,trueNode:{condition:o.z768.z939,trueNode:{state:o.z6}}}},{condition:o.z768.z831,trueNode:{condition:o.z768.z990,trueNode:{condition:o.z768.z939,trueNode:{state:o.z6}}}},{condition:o.z768.z924,trueNode:{condition:o.z768.z991,trueNode:{state:o.z11}}},{condition:o.z768.z1022,trueNode:{condition:o.z768.z993,trueNode:{state:o.z48}}},{condition:o.z768.z857,trueNode:{condition:o.z768.z992,trueNode:{condition:o.z768.z939,trueNode:{state:o.z32}}}},{condition:o.z768.z916,trueNode:{condition:o.z768.z903,trueNode:{state:o.z102},falseNode:{condition:o.z768.z940,trueNode:{condition:o.z768.z939,trueNode:{condition:o.z768.z1003,trueNode:{state:o.z143}}}}},falseNode:{condition:o.z768.z1030,falseNode:{condition:o.z768.z902,trueNode:{state:o.z102}}}},{condition:o.z768.z790,trueNode:{state:o.z34}},{condition:o.z768.z966,trueNode:{condition:o.z768.z943,falseNode:{condition:o.z768.z819,falseNode:{condition:o.z768.z1028,trueNode:{state:o.z36}}}}},{condition:o.z768.z866,trueNode:{condition:o.z768.z947,trueNode:{state:o.z78}}},{condition:o.z768.z917,trueNode:{condition:o.z768.z939,trueNode:{condition:o.z768.z996,trueNode:{state:o.z82}}}},{condition:o.z768.z925,trueNode:{condition:o.z768.z996,trueNode:{condition:o.z768.z1024,trueNode:{condition:o.z768.z814,trueNode:{state:o.z94},falseNode:{state:o.z82}},falseNode:{state:o.z82}},falseNode:{state:o.z94}}}]}}],t.states=[o.z116,o.z111,o.z110,o.z41],t.initialState=o.z110,t}return __extends(z112,e),z112}(z49);o.z112=t}(z0||(z0={})),function(o){var t=function(e){function z111(){var t=null!==e&&e.apply(this,arguments)||this;return t.historyLength=2,t.enterz156=[o.z156.z400,o.z156.z495,o.z156.z334,o.z156.z423,o.z156.z483,o.z156.z272,o.z156.z382,o.z156.z268,o.z156.z304],t.updatez156=[o.z156.z507,o.z156.z536,o.z156.z542,o.z156.z386,o.z156.z394,o.z156.z209,o.z156.z455,o.z156.z327,o.z156.z532],t.transitions=[{condition:o.z768.z863,trueNode:{condition:o.z768.z814,trueNode:{state:o.z132,level:1},falseNode:{condition:o.z768.z814,trueNode:{state:o.z110},falseNode:{state:o.z41}}}}],t.exitz156=[o.z156.z502],t.states=[o.z77,o.z116],t.initialState=o.z77,t}return __extends(z111,e),z111}(z49);o.z111=t}(z0||(z0={})),function(o){var t=function(e){function z110(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z495,o.z156.z265,o.z156.z418,o.z156.z196,o.z156.z483],t.updatez156=[o.z156.z177,o.z156.z195,o.z156.z417,o.z156.z210,o.z156.z208,o.z156.z209,o.z156.z532,o.z156.z733,o.z156.z734],t.exitz156=[],t.transitions=[{condition:o.z768.z785,trueNode:{state:o.z92,actions:[o.z156.z470,o.z156.z421,o.z156.z314],level:1}},{condition:o.z768.z863,trueNode:{condition:o.z768.z873,falseNode:{condition:o.z768.z814,trueNode:{state:o.z41},falseNode:{state:o.z111}}}}],t}return __extends(z110,e),z110}(z49);o.z110=t}(z0||(z0={})),function(o){var t=function(e){function z77(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[],t.updatez156=[],t.transitions=[{condition:o.z768.z889,trueNode:{state:o.z76},falseNode:{state:o.z74}}],t.states=[o.z76,o.z74],t.exitz156=[],t}return __extends(z77,e),z77}(z49);o.z77=t}(z0||(z0={})),function(o){var t=function(e){function z76(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z326,o.z156.z262,o.z156.z579],t.updatez156=[o.z156.z583],t.transitions=[{condition:o.z768.z862,trueNode:{state:o.z116}}],t.exitz156=[],t}return __extends(z76,e),z76}(z49);o.z76=t}(z0||(z0={})),function(o){var t=function(e){function z74(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z262,o.z156.z579],t.updatez156=[],t.transitions=[{condition:o.z768.z862,trueNode:{state:o.z116}}],t.exitz156=[],t}return __extends(z74,e),z74}(z49);o.z74=t}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z583(){return null!==t&&t.apply(this,arguments)||this}return __extends(z583,t),z583.prototype.update=function(t){var e=t.getOtherHamInFront();if(e){var o=e.physics.headBody.body.position;t.targets.lookToTarget.x=o.x,t.targets.lookToTarget.y=o.y,t.targets.lookToTarget.z=o.z}},z583}(z767),e.z583=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z418(){return null!==t&&t.apply(this,arguments)||this}return __extends(z418,t),z418.prototype.update=function(t){var e=t.physics.frontBody.body.position,o=t.targets.point1,i=t.physics.frontBody.rotationElements;o.copyFrom(e),o.x+=i[2],o.y+=i[5],o.z+=i[8]},z418}(z767),e.z418=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z417(){return null!==t&&t.apply(this,arguments)||this}return __extends(z417,t),z417.prototype.update=function(t){var e=t.position,o=t.targets.destTarget,i=z1.distanceSquared(e,o);t.walkSpeed+=i<.36?.05*(.6-t.walkSpeed):.05*(1-t.walkSpeed)},z417}(z767),e.z417=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z326(){return null!==t&&t.apply(this,arguments)||this}return __extends(z326,t),z326.prototype.update=function(t){},z326}(z767),e.z326=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z196(){return null!==t&&t.apply(this,arguments)||this}return __extends(z196,t),z196.prototype.update=function(t){var e=t.targets.point1;t.targets.destTarget.copyFrom(e),t.targets.setTargetsToDestination(),t.targets.lookToTarget.y-=.1},z196}(z767),e.z196=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z195(){var t=null!==e&&e.apply(this,arguments)||this;return t.exploreLerp=.1,t}return __extends(z195,e),z195.prototype.update=function(t){if(!t.isFollowingPath()){var e=t.targets.point1;t.targets.destTarget.copyFrom(e),t.targets.setTargetsToDestination(),t.targets.lookToTarget.y-=.1}},z195}(z767),e.z195=o}(z0||(z0={})),function(I){var t,e;t=I.z156||(I.z156={}),e=function(e){function z177(){var t=null!==e&&e.apply(this,arguments)||this;return t.exploreAngSpeed=.2,t.exploreLinSpeed=.015,t}return __extends(z177,e),z177.prototype.update=function(t){var e=t.targets.point1,o=t.cage;if(!t.isFollowingPath()&&o){var i;if(t.physics.touchingAccTypes&I.z1044.z1045)for(var n=t.physics.rearBody.body.position,s=0;s<t.physics.touchingShapes.length;s++){var a=t.physics.touchingShapes.data.data[s];if(a.entity&&(a.entity.accType==I.z1044.z1045||a.entity.accType==I.z1044.SWING)){var r=a.entity,c=r.position,d=n.x-c.x,p=n.z-c.z,l=d*d+p*p,u=r.radius+.5*t.size;if(l<u*u){var y=e.x-c.x,g=e.z-c.z,m=y*y+g*g,f=r.radius+3*t.size;m<f*f&&(e.z=c.z+f)}}}if(0<(t.physics.touchingAccTypes&I.z1044.z1049)&&(i=t.platformUnder),i){var A=z767.z4[1],b=i.connectedPlatformsWidth;A.copyFrom(i.position),A.z-=.5,A.x=i.connectedPlatformsCenterX,z1.LimitPointToCircsInRectXZ(e,A.x,A.z,b,i.depth-1),e.y=i.position.y+.15}else{var v=o.depth,x=z767.z4[0];x.copyFrom(o.position),x.z-=.5,v-=1,z1.LimitPointToCircsInRectXZ(e,x.x,x.z,o.width,v),e.y=o.getHeightAt(e.x,e.z)+.15}var C=I.z1062.activeObjects;for(s=0;s<C.length;s++){var S=C[s];if(S.currentObject==o){if((l=z1.distanceSquared(S.position,e))<.36){var T=z767.z4[0];T.x=e.x-S.position.x,T.z=e.z-S.position.z,T.y=0,T.normalize(),e.x=S.position.x+.6*T.x,e.z=S.position.z+.6*T.z}}}var B;B=this.exploreLinSpeed;var O=this.exploreAngSpeed;t.targets.randAng+=(2*Math.random()-1)*O;var P=Math.cos(t.targets.randAng)*B,M=Math.sin(t.targets.randAng)*B;e.x+=P,e.z+=M}},z177}(z767),t.z177=e}(z0||(z0={})),function(I){var t,e;t=I.z156||(I.z156={}),e=function(e){function z166(){var t=null!==e&&e.apply(this,arguments)||this;return t.exploreAngSpeed=.2,t.exploreLinSpeed=.002,t}return __extends(z166,e),z166.prototype.update=function(t){t.minStandDist=2;var e,o=t.targets.point1;e=this.exploreLinSpeed;var i=this.exploreAngSpeed;t.targets.randAng+=(2*Math.random()-1)*i;var n=Math.cos(t.targets.randAng)*e,s=Math.sin(t.targets.randAng)*e;if(o.x+=n,o.z+=s,t.platformUnder){var a,r=t.platformUnder.position.x-.5*t.platformUnder.width,c=t.platformUnder.position.x+.5*t.platformUnder.width;if(t.platformUnder.platformToLeft)r=(a=t.platformUnder.platformToLeft).position.x-.5*a.width;if(t.platformUnder.platformToRight)c=(a=t.platformUnder.platformToRight).position.x+.5*a.width;o.x<r&&(o.x=r),o.x>c&&(o.x=c)}var d=t.cage;if(d){var p=d.depth;(l=z767.z4[0]).copyFrom(d.position),l.z-=.5,p-=1;var l=d.position;if(z1.LimitPointToCircsInRectXZ(o,l.x,l.z,d.width,p),t.physics.touchingAccTypes&I.z1044.z1045)for(var u=t.physics.rearBody.body.position,y=0;y<t.physics.touchingShapes.length;y++){var g=t.physics.touchingShapes.data.data[y];if(g.entity&&g.entity.accType==I.z1044.z1045){var m=g.entity,f=m.position,A=u.x-f.x,b=u.z-f.z,v=A*A+b*b,x=m.radius+.5*t.size;if(v<x*x){var C=o.x-f.x,S=o.z-f.z,T=C*C+S*S,B=m.radius;if(B*B<T){var O=Math.sqrt(T),P=C/O,M=S/O;o.x=f.x+P*B,o.z=f.z+M*B}}}}}},z166}(z767),t.z166=e}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z1004(){return null!==t&&t.apply(this,arguments)||this}return __extends(z1004,t),z1004.prototype.test=function(t){return!!t.cage&&180<e.app.frameNum-t.frameNumEnteredCage},z1004}(z770),t.z1004=o}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z947(){return null!==t&&t.apply(this,arguments)||this}return __extends(z947,t),z947.prototype.test=function(t){return t.targets.point1.z<-1.8},z947}(z770),e.z947=o}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z790(){return null!==t&&t.apply(this,arguments)||this}return __extends(z790,t),z790.prototype.test=function(t){var e=t.cage;return!!e&&(0!=e.holes.length&&o.app.frameNum-t.frameNumEnteredCage>t.framesToStayInCage)},z790}(z770),t.z790=e}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z789(){return null!==t&&t.apply(this,arguments)||this}return __extends(z789,t),z789.prototype.test=function(t){return 0!=e.TubeCover.activeObjects.length&&e.app.frameNum-t.frameNumEnteredCage>t.framesToStayInCage},z789}(z770),t.z789=o}(z0||(z0={})),function(o){var t=function(e){function z78(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z725],t.updatez156=[o.z156.z507,o.z156.z724,o.z156.z450,o.z156.z209,o.z156.z532,o.z156.z733],t.state=[o.z50,o.z62],t.exitz156=[o.z156.z489],t.transitions=[{condition:o.z768.z962,trueNode:{state:o.z37}},{condition:o.z768.z976,trueNode:{state:o.z112}},{condition:o.z768.z819,falseNode:{condition:o.z768.z1028,trueNode:{state:o.z36,actions:[]}}}],t.initialState=o.z62,t}return __extends(z78,e),z78}(z49);o.z78=t}(z0||(z0={})),function(o){var t=function(e){function z62(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z341,o.z156.z489],t.updatez156=[o.z156.z507,o.z156.z173,o.z156.z592],t.transitions=[{condition:o.z768.z962,trueNode:{state:o.z37}},{condition:o.z768.z822,trueNode:{state:o.z50}}],t}return __extends(z62,e),z62}(z49);o.z62=t}(z0||(z0={})),function(o){var t=function(e){function z50(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z341],t.updatez156=[o.z156.z507,o.z156.z167,o.z156.z592,o.z156.z736],t.exitz156=[o.z156.z489],t.transitions=[{condition:o.z768.z962,trueNode:{state:o.z37}},{condition:o.z768.z822,trueNode:{state:o.z62}}],t}return __extends(z50,e),z50}(z49);o.z50=t}(z0||(z0={})),function(o){var t=function(e){function z60(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z400,o.z156.z334,o.z156.z483,o.z156.z272,o.z156.z382,o.z156.z501,o.z156.z720,o.z156.z666],t.updatez156=[o.z156.z339,o.z156.z764,o.z156.z382,o.z156.z495,o.z156.z483,o.z156.z536,o.z156.z542,o.z156.z386,o.z156.z393,o.z156.z356,o.z156.z688,o.z156.z209,o.z156.z532,o.z156.z327],t.transitions=[{condition:o.z768.z903,trueNode:{state:o.z102,level:0}},{condition:o.z768.z924,trueNode:{condition:o.z768.z991,trueNode:{state:o.z11}}},{condition:o.z768.z787,trueNode:{state:o.z108}},{condition:o.z768.z927,falseNode:{condition:o.z768.z1016,trueNode:{state:o.z112,actions:[]}}}],t.exitz156=[o.z156.z643,o.z156.z649,o.z156.z502],t}return __extends(z60,e),z60}(z49);o.z60=t}(z0||(z0={})),function(o){var i,t;i=o.z156||(o.z156={}),t=function(e){function z688(){var t=null!==e&&e.apply(this,arguments)||this;return t.nextUpdateFrame=[],t}return __extends(z688,e),z688.prototype.update=function(t){var e=o.app.frameNum;this.actionLookAtPointer||(this.actionLookAtPointer=z641.getz767(i.z581),this.actionPettingEvents=z641.getz767(i.z666)),this.nextUpdateFrame[t.id]||(this.nextUpdateFrame[t.id]=e+300),e>=this.nextUpdateFrame[t.id]&&(this.actionPettingEvents.ham==t&&this.actionPettingEvents.pointerIsOnHam?t.setEyesCloseAmount(.95):t.setEyesCloseAmount(0),this.nextUpdateFrame[t.id]=e+300)},z688}(z767),i.z688=t}(z0||(z0={})),function(a){var t,e;t=a.z156||(a.z156={}),e=function(e){function z666(){var t=e.call(this)||this;return t.bindedOnPointerMove=void 0,t.bindedOnPointerUp=void 0,t.bindedMeshIsHam=void 0,t.eventsAdded=!1,t.pointerDownID=-1,t.multiTouch=!1,t.lastPointerX=null,t.lastPointerY=null,t.pointerIsOnHam=!1,t.lastFrameMoveCameraToPointerDown=0,t.tempVec=new OIMO.Vec3,t.bindedOnPointerUp=t.onPointerUp.bind(t),t.bindedOnPointerMove=t.onPointerMove.bind(t),t.bindedMeshIsHam=t.meshIsHam.bind(t),t}return __extends(z666,e),z666.prototype.update=function(t){this.addEventListeners()},z666.prototype.addEventListeners=function(){if(!this.eventsAdded){var t=document.getElementById("main");t.addEventListener("pointerup",this.bindedOnPointerUp),t.addEventListener("pointermove",this.bindedOnPointerMove),a.app.registerOnPointerDown(a.z1062.name,this.onPointerDown,this),this.eventsAdded=!0,a.app.pointerDownObj&&a.app.pointerDownObj.physics&&(this.ham=a.app.pointerDownObj,this.pointerDownID=a.app.pointerDownID,a.app.graphicsHelper.pauseDragCamera(!0))}},z666.prototype.removeEventListeners=function(){if(this.eventsAdded){var t=document.getElementById("main");t.removeEventListener("pointerup",this.bindedOnPointerUp),a.app.unregisterOnPointerDown(a.z1062.name,this.onPointerDown,this),t.removeEventListener("pointermove",this.bindedOnPointerMove),this.eventsAdded=!1,this.pointerDownID=null,this.ham=null}},z666.prototype.onPointerUp=function(t){this.multiTouch=!1,this.pointerDownID=null,this.lastPointerX=null,this.lastPointerY=null,this.ham=null},z666.prototype.onPointerDown=function(t,e){this.multiTouch||(this.ham=e,this.pointerDownID=t.event.pointerId,a.app.graphicsHelper.pauseDragCamera(!0),this.ham)},z666.prototype.meshIsHam=function(t){return t==this.ham.mesh},z666.prototype.onPointerMove=function(t){if(this.ham&&a.app.doTouch&&0<=this.pointerDownID){a.app.graphicsHelper.pauseDragCamera(!0);var e=t.x,o=t.y;if(null==this.lastPointerX)return this.lastPointerX=e,void(this.lastPointerY=o);if(!a.app.graphicsHelper.scene.pick(e,o,this.bindedMeshIsHam).hit)return this.lastPointerX=e,this.lastPointerY=o,void(this.pointerIsOnHam=!1);this.pointerIsOnHam=!0,this.ham.targets.lastFramePointerMoved=a.app.frameNum;var i=e-this.lastPointerX,n=o-this.lastPointerY;this.lastPointerX=e,this.lastPointerY=o;var s=this.ham.physics.headBody.body;1<(i*=.01)?i=1:i<-1&&(i=1),1<(n*=-.01)?n=1:n<-1&&(n=1),this.tempVec.x=i,this.tempVec.y=n,this.tempVec.z=0,s.linearVelocity.addEqual(this.tempVec)}},z666}(z767),t.z666=e}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z649(){return null!==t&&t.apply(this,arguments)||this}return __extends(z649,t),z649.prototype.update=function(t){z641.getz767(e.z666).removeEventListeners()},z649}(z767),e.z649=o}(z0||(z0={})),function(d){var p,t;p=d.z156||(d.z156={}),t=function(c){function z356(){var t=c.call(this)||this;return t.pointerPos=[],t.targetPointerPos=[],t.nextUpdateFrame=[],t.fracHeight=0,t}return __extends(z356,c),z356.prototype.update=function(t){if(this.actionLookAtPointer||(this.actionLookAtPointer=z641.getz767(p.z581),this.actionPettingEvents=z641.getz767(p.z666)),this.actionPettingEvents.ham==t&&this.actionPettingEvents.pointerIsOnHam){this.pointerPos[t.id]||(this.pointerPos[t.id]=BABYLON.Vector3.Zero(),this.targetPointerPos[t.id]=BABYLON.Vector3.Zero(),this.nextUpdateFrame[t.id]=0);var e=this.targetPointerPos[t.id],o=this.pointerPos[t.id],i=d.app.frameNum;if(i>=this.nextUpdateFrame[t.id]){var n=z767.z4[0];n.copyFrom(d.app.pointerMovePosition);var s=t.physics.headBody.body.position,a=t.physics.rearBody.body.position,r=s.y-a.y+t.size;n.y-=r,this.nextUpdateFrame[t.id]=i+1,t.bones.hip.bone.getLocalPositionFromAbsoluteToRef(n,t.mesh,e)}o.x=.05*(e.x-o.x)+o.x,o.y=.05*(e.y-o.y)+o.y,o.z=.05*(e.z-o.z)+o.z,this.lookZ=-o.z,this.lookY=-o.y,c.prototype.update.call(this,t)}else{100<d.app.frameNum-t.targets.lastFramePointerMoved&&(this.actionLookAtPointer.update(t),t.setEyesCloseAmount(0))}},z356}(p.z358),p.z356=t}(z0||(z0={})),function(o){var t=function(e){function z94(){var t=null!==e&&e.apply(this,arguments)||this;return t.historyLength=3,t.enterz156=[],t.updatez156=[o.z156.z410,o.z156.z199,o.z156.z208,o.z156.z209,o.z156.z532,o.z156.z733,o.z156.z734],t.exitz156=[],t.transitions=[{condition:o.z768.z963,trueNode:{state:o.z45}},{condition:o.z768.z980,trueNode:{state:o.z45}}],t.states=[o.z116],t}return __extends(z94,e),z94}(z49);o.z94=t}(z0||(z0={})),function(o){var t=function(e){function z45(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z415,o.z156.z644,o.z156.z212],t.updatez156=[o.z156.z507,o.z156.z721,o.z156.z764,o.z156.z211],t.exitz156=[o.z156.z213],t.transitions=[{condition:o.z768.z981,trueNode:{state:o.z16}},{condition:o.z768.z982,falseNode:{condition:o.z768.z983,trueNode:{state:o.z16}}},{condition:o.z768.z865,trueNode:{state:o.z16}}],t.states=[],t}return __extends(z45,e),z45}(z49);o.z45=t}(z0||(z0={})),function(o){var t=function(e){function z16(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z642,o.z156.z415,o.z156.z643,o.z156.z342,o.z156.z470],t.updatez156=[o.z156.z721,o.z156.z764],t.exitz156=[o.z156.z416,o.z156.z643],t.transitions=[{condition:o.z768.z822,trueNode:{state:o.z112}},{condition:o.z768.z823,trueNode:{condition:o.z768.z982,trueNode:{state:o.z36}}}],t.states=[],t}return __extends(z16,e),z16}(z49);o.z16=t}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z213(){return null!==t&&t.apply(this,arguments)||this}return __extends(z213,t),z213.prototype.update=function(t){t.levels.sleep.resetRandom()},z213}(z767),e.z213=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z212(){return null!==t&&t.apply(this,arguments)||this}return __extends(z212,t),z212.prototype.update=function(t){t.levels.sleep.value=.2*t.levels.sleep.maxValue+Math.random()*t.levels.sleep.maxValue*.2},z212}(z767),e.z212=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z211(){return null!==t&&t.apply(this,arguments)||this}return __extends(z211,t),z211.prototype.update=function(t){t.levels.sleep.step(1)},z211}(z767),e.z211=o}(z0||(z0={})),function(l){var t,e;t=l.z156||(l.z156={}),e=function(e){function z199(){var t=null!==e&&e.apply(this,arguments)||this;return t.tempAccs=[],t.tempVecs=[],t.tempPath=[],t}return __extends(z199,e),z199.prototype.update=function(t){var e=t.cage;if(e){var o=t.targets.destTarget;if(t.targetObject&&t.targetObject.accType==l.z1044.z1057){if(t.isFollowingPath()||t.targetObject.parent==t.cage)return void(e==t.targetObject.parent&&(e.isInBox(o.x,o.y,o.z)||(t.memory.remove(t.targetObject),t.memory.add(t.targetObject),o.copyFrom(t.targetObject.position),t.setPathTo(o),t.path.length||t.targets.setTargetsToDestination())));if(t.setPathTo(t.targetObject.position),0!=t.path.length)return;t.memory.remove(t.targetObject),t.targetObject=null}var i,n=t.memory,s=null;if(n.bed)i=n.bed,s=n.bedPos;else{var a=n.getAccessories(l.z1044.z1057),r=n.getPositions(l.z1044.z1057);if(!a||0==a.length)return;this.tempAccs.length=0;for(var c=this.tempVecs.length=0;c<a.length;c++){(d=a[c])&&d.parent&&(d.parent.bedding&&!d.owner&&(this.tempAccs.push(d),this.tempVecs.push(r[c])))}if(0==this.tempVecs.length)for(c=0;c<a.length;c++){(d=a[c])&&(d.owner||(this.tempAccs.push(d),this.tempVecs.push(r[c])))}if(0==this.tempVecs.length)for(c=0;c<a.length;c++){var d;(d=a[c])&&(this.tempAccs.push(d),this.tempVecs.push(r[c]))}if(0<this.tempAccs.length){var p=Math.floor(this.tempAccs.length*Math.random());s=this.tempVecs[p],i=this.tempAccs[p]}}i&&(t.targetObject=i,t.targets.destTarget.set(s.x,s.y,s.z),t.setPathTo(s),n.bed=i,n.bedPos.copyFrom(s),0==t.path.length&&t.targets.setTargetsToDestination(),t.targetObject.parent!=t.cage&&0==t.path.length&&(n.bed=null,t.memory.remove(t.targetObject),t.targetObject=null))}},z199}(z767),t.z199=e}(z0||(z0={})),function(s){var t,e;t=s.z156||(s.z156={}),e=function(n){function z198(){return null!==n&&n.apply(this,arguments)||this}return __extends(z198,n),z198.prototype.update=function(t){if(n.prototype.update.call(this,t),t.targetObject){var e=t.targetObject,o=e.position;if(t.cage&&t.cage.isInBox(o.x,o.y,o.z)){t.targets.destTarget.y!=o.y&&(t.memory.remove(e),t.memory.add(e),t.targets.destTarget.y=o.y);var i=o.x;i=o.x<t.cage.position.x?t.cage.position.x-.5*t.cage.width+t.size:t.cage.position.x+.5*t.cage.width-t.size,t.targets.destTarget.x!=i&&(t.targets.destTarget.x=i,t.isFollowingPath()||t.targets.setTargetsToDestination()),t.isFollowingPath()||t.isInState(s.z65.name)||t.avoidingObject||t.targets.destTarget.equals(t.targets.moveToTarget)||t.targets.setTargetsToDestination()}else t.isFollowingPath()||t.setPathTo(o)}},z198}(t.z199),t.z198=e}(z0||(z0={})),function(s){var t,e;t=s.z768||(s.z768={}),e=function(t){function z979(){return null!==t&&t.apply(this,arguments)||this}return __extends(z979,t),z979.prototype.test=function(t){if(t.targetObject&&t.targetObject.accType==s.z1044.z1057){var e=t.targetObject,o=t.physics.headBody.body.position,i=t.cage,n=2*t.size;if(i!=e.parent)return!1;if(o.z>i.front+.5)return!1;if(e.position.x<i.position.x){if(o.x<i.left+n)return!0}else if(o.x>i.right-n)return!0;return!1}},z979}(z770),t.z979=e}(z0||(z0={})),function(t){var e,o;e=t.z768||(t.z768={}),o=function(t){function z865(){return null!==t&&t.apply(this,arguments)||this}return __extends(z865,t),z865.prototype.test=function(t){var e=t.levels.sleep;return e.value==e.maxValue},z865}(z770),e.z865=o}(z0||(z0={})),function(o){var t=function(e){function z116(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[],t.updatez156=[],t.transitions=[{condition:o.z768.z844,trueNode:{previousState:!0}}],t.exitz156=[],t}return __extends(z116,e),z116}(z49);o.z116=t}(z0||(z0={})),function(o){var t=function(e){function z108(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z761,o.z156.z523,o.z156.z521,o.z156.z525,o.z156.z377],t.updatez156=[o.z156.z545,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739],t.exitz156=[],t.transitions=[{condition:o.z768.z846,trueNode:{state:o.z141,actions:[]}},{condition:o.z768.z843,trueNode:{state:o.z141}}],t}return __extends(z108,e),z108}(z49);o.z108=t}(z0||(z0={})),function(o){var t=function(e){function z88(){var t=null!==e&&e.apply(this,arguments)||this;return t.historyLength=3,t.states=[o.z65,o.z66,o.z63,o.z108],t.updatez156=[o.z156.z596],t.initialState=o.z108,t}return __extends(z88,e),z88}(z49);o.z88=t}(z0||(z0={})),function(o){var t=function(e){function z69(){var t=null!==e&&e.apply(this,arguments)||this;return t.allowEvents=[o.z1061Events.DROP],t.enterz156=[o.z156.z502,o.z156.z471,o.z156.z514,o.z156.z496],t.updatez156=[o.z156.z590,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739],t.listeners=[{event:o.z1061Events.DROP,state:o.z108}],t}return __extends(z69,e),z69}(z49);o.z69=t}(z0||(z0={})),function(o){var t=function(e){function z68(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z502,o.z156.z514,o.z156.z511,o.z156.z761,o.z156.z476,o.z156.z472,o.z156.z677],t.updatez156=[o.z156.z377,o.z156.z231,o.z156.z461,o.z156.z446,o.z156.z203,o.z156.z590,o.z156.z369,o.z156.z362,o.z156.z731,o.z156.z740,o.z156.z766,o.z156.z739],t.exitz156=[o.z156.z506],t.transitions=[{condition:o.z768.z974,falseNode:{previousState:!0}}],t}return __extends(z68,e),z68}(z49);o.z68=t}(z0||(z0={})),function(o){var t=function(e){function z66(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z500,o.z156.z320,o.z156.z500,o.z156.z482,o.z156.z677,o.z156.z362,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z761,o.z156.z754,o.z156.z466,o.z156.z396,o.z156.z299,o.z156.z494],t.updatez156=[o.z156.z709,o.z156.z376,o.z156.z165,o.z156.z574,o.z156.z687,o.z156.z294,o.z156.z541,o.z156.z685,o.z156.z610,o.z156.z716,o.z156.z235,o.z156.z634,o.z156.z702,o.z156.z718,o.z156.z701,o.z156.z460,o.z156.z446,o.z156.z203,o.z156.z585,o.z156.z631,o.z156.z767CheckLookToNextNode,o.z156.z590,o.z156.z214,o.z156.z369,o.z156.z564,o.z156.z362,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z379,o.z156.z442],t.exitz156=[o.z156.z489,o.z156.z377],t.states=[],t.transitions=[{condition:o.z768.z909,trueNode:{state:z66}},{condition:o.z768.z830,trueNode:{state:o.z63}},{condition:o.z768.z873,trueNode:{state:o.z65}},{condition:o.z768.z912,trueNode:{state:o.z21,actions:[o.z156.z433]}},{condition:o.z768.z962,trueNode:{state:o.z21}},{condition:o.z768.z928,falseNode:{state:o.z141}},{condition:o.z768.z974,falseNode:{condition:o.z768.z913,falseNode:{state:o.z141}}},{condition:o.z768.z929,falseNode:{condition:o.z768.z1025,trueNode:{state:o.z67}}},{condition:o.z768.z843,trueNode:{state:o.z67}},{condition:o.z768.z944,trueNode:{state:o.z108}},{condition:o.z768.z861,trueNode:{condition:o.z768.z845,trueNode:{condition:o.z768.z932,trueNode:{state:o.z67}}}},{condition:o.z768.z876,trueNode:{state:o.z21}},{condition:o.z768.z860,trueNode:{condition:o.z768.z932,trueNode:{condition:o.z768.z830,falseNode:{condition:o.z768.z874,trueNode:{state:o.z67}}}}}],t.initialState=z66,t}return __extends(z66,e),z66}(z49);o.z66=t}(z0||(z0={})),function(o){var t=function(e){function z65(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z396,o.z156.z299,o.z156.z406,o.z156.z343],t.updatez156=[o.z156.z376,o.z156.z615,o.z156.z165,o.z156.z574,o.z156.z599,o.z156.z294,o.z156.z685,o.z156.z610,o.z156.z701,o.z156.z234,o.z156.z640,o.z156.z532,o.z156.z460,o.z156.z203,o.z156.z446,o.z156.z590,o.z156.z214,o.z156.z369,o.z156.z564,o.z156.z362,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z379,o.z156.z442],t.exitz156=[o.z156.z481,o.z156.z498,o.z156.z397,o.z156.z300],t.states=[],t.transitions=[{condition:o.z768.z830,trueNode:{previousState:!0,actions:[]}},{condition:o.z768.z873,falseNode:{actions:[],previousState:!0}},{condition:o.z768.z872,falseNode:{actions:[],previousState:!0}},{condition:o.z768.z962,trueNode:{state:o.z21,actions:[]}},{condition:o.z768.z928,falseNode:{state:o.z141}},{condition:o.z768.z824,trueNode:{previousState:!0,actions:[]}}],t}return __extends(z65,e),z65}(z49);o.z65=t}(z0||(z0={})),function(o){var t=function(e){function z63(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z396,o.z156.z299],t.updatez156=[o.z156.z376,o.z156.z574,o.z156.z687,o.z156.z294,o.z156.z685,o.z156.z610,o.z156.z634,o.z156.z460,o.z156.z446,o.z156.z203,o.z156.z590,o.z156.z214,o.z156.z362,o.z156.z731,o.z156.z750,o.z156.z744,o.z156.z740,o.z156.z766,o.z156.z747,o.z156.z739,o.z156.z379,o.z156.z442],t.exitz156=[o.z156.z462,o.z156.z397,o.z156.z300],t.states=[],t.transitions=[{condition:o.z768.z864,trueNode:{state:o.z66}},{condition:o.z768.z827,falseNode:{state:o.z66,actions:[]}},{condition:o.z768.z828,falseNode:{state:o.z66,actions:[]}},{condition:o.z768.z829,trueNode:{state:o.z66,actions:[]}}],t}return __extends(z63,e),z63}(z49);o.z63=t}(z0||(z0={})),function(o){var t=function(e){function z38(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[],t.updatez156=[o.z156.z192,o.z156.z208,o.z156.z209,o.z156.z532,o.z156.z733,o.z156.z734],t.exitz156=[],t.transitions=[{condition:o.z768.z834,trueNode:{state:o.z120,level:0}}],t}return __extends(z38,e),z38}(z49);o.z38=t}(z0||(z0={})),function(o){var t=function(e){function z124(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z523,o.z156.z525],t.updatez156=[],t.states=[o.z122,o.z121],t.exitz156=[],t.initialState=o.z122,t}return __extends(z124,e),z124}(z49);o.z124=t}(z0||(z0={})),function(o){var t=function(e){function z123(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[],t.updatez156=[o.z156.z191,o.z156.z331],t.exitz156=[],t.states=[o.z124],t.transitions=[{condition:o.z768.z937,trueNode:{state:o.z124,level:-1},falseNode:{state:z123,level:-1,actions:[o.z156.z500]}}],t}return __extends(z123,e),z123}(z49);o.z123=t}(z0||(z0={})),function(o){var t=function(e){function z122(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z342],t.updatez156=[o.z156.z550,o.z156.z738,o.z156.z746],t.transitions=[{condition:o.z768.z824,trueNode:{state:o.z121}}],t.exitz156=[o.z156.z489],t}return __extends(z122,e),z122}(z49);o.z122=t}(z0||(z0={})),function(o){var t=function(e){function z121(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z344,o.z156.z488],t.updatez156=[o.z156.z549,o.z156.z737,o.z156.z745],t.transitions=[{condition:o.z768.z824,trueNode:{state:o.z122}}],t.exitz156=[o.z156.z489],t}return __extends(z121,e),z121}(z49);o.z121=t}(z0||(z0={})),function(g){var m,t;m=g.z156||(g.z156={}),t=function(e){function z738(){var t=null!==e&&e.apply(this,arguments)||this;return t.footAngles=[.5*Math.PI],t.digFootAngle=.58,t.digSpeed=.8,t.digStride=.15,t}return __extends(z738,e),z738.prototype.update=function(t){var e=t.bones,o=e.legFR,i=e.legFL;if(!t.isInState(g.z98.name)&&i.bone1){var n=.4;n=.35,(n=.8)<(n=this.digSpeed*t.adjustLerp)&&(n=.8),t.bones.legTickFront+=n;var s=t.bones.legTickFront,a=this.digStride,r=t.maxStepHeight,c=t.maxStride;c<a&&(a=c);Math.PI,Math.PI;-1*Math.PI+1,-1*Math.PI+1,1.57;var d=s,p=s+3.14,l=.75*r;l=t.maxStepHeight*(a/c),l*=.75,o.posed=!0,i.posed=!0,this.footAngles[0]=this.digFootAngle;var u,y=t.currentObject;y&&y.bindedKeepPosInside&&t.rearObject==y&&(u=y.bindedKeepPosInside),o.updateStep2(p,a,l,1*o.distToGround,this.footAngles,m.z732.frontFootHeights,1,u),i.updateStep2(d,a,l,1*i.distToGround,this.footAngles,m.z732.frontFootHeights,2,u)}},z738.frontFootAngles=[],z738.frontFootHeights=[],z738.rearFootHeights=[],z738}(z767),m.z738=t}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z737(){var t=null!==e&&e.apply(this,arguments)||this;return t.digSpeed=.2,t.digStride=.2,t}return __extends(z737,e),z737.prototype.update=function(t){var e=t.bones,o=e.legRR,i=e.legRL;if(i.bone1){var n=.4;n=.35,(n=.8)<(n=this.digSpeed)&&(n=.8),t.bones.legTickRear+=n;var s=t.bones.legTickRear,a=this.digStride,r=t.maxStepHeight,c=t.maxStride;c<a&&(a=c);Math.PI;-1*Math.PI+1;var d=s+1.57,p=s+4.71,l=.75*r;l=t.maxStepHeight*(a/c),l*=.75,o.posed=!0,i.posed=!0;var u=t.currentObject,y=void 0;u&&u.bindedKeepPosInside&&t.rearObject==u&&(y=u.bindedKeepPosInside),o.updateStep2(d,a,l,1*o.distToGround,z737.footAngles,null,3,y),i.updateStep2(p,a,l,1*i.distToGround,z737.footAngles,null,4,y)}},z737.footAngles=[1.25*Math.PI,1.25*Math.PI,1.25*Math.PI],z737}(z767),e.z737=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z550(){var t=null!==e&&e.apply(this,arguments)||this;return t.frontFootOffsetX=-.06,t.frontFootOffsetZ=.07,t.rearFootOffsetX=.11,t.rearFootOffsetZ=-.15,t.frontTargetPoleAngle=.88,t.shoulderPitch=.3,t}return __extends(z550,e),z550.prototype.update=function(t){t.bones.legFL.footOffsetZ_.targetValue=-this.frontFootOffsetX,t.bones.legFR.footOffsetZ_.targetValue=this.frontFootOffsetX,t.bones.legFL.footOffsetX_.targetValue=this.frontFootOffsetZ,t.bones.legFR.footOffsetX_.targetValue=this.frontFootOffsetZ,t.bones.legRL.footOffsetZ_.targetValue=-this.rearFootOffsetX,t.bones.legRR.footOffsetZ_.targetValue=this.rearFootOffsetX,t.bones.legRL.footOffsetX_.targetValue=this.rearFootOffsetZ,t.bones.legRR.footOffsetX_.targetValue=this.rearFootOffsetZ,t.bones.legFL.targetPoleAngle=-this.frontTargetPoleAngle,t.bones.legFR.targetPoleAngle=this.frontTargetPoleAngle,t.bones.shoulder.pitch.targetValue=this.shoulderPitch+1*t.bones.head.pitch,t.bones.fracShoulderHeadYaw.targetValue=.75},z550}(z767),e.z550=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(e){function z549(){var t=null!==e&&e.apply(this,arguments)||this;return t.frontFootOffsetZ_=-.13,t.frontFootOffsetX_=.07,t.rearFootOffsetX_=-.15,t.frontTargetPoleAngle=.88,t}return __extends(z549,e),z549.prototype.update=function(t){t.bones.legFL.footOffsetZ_.targetValue=-this.frontFootOffsetZ_,t.bones.legFR.footOffsetZ_.targetValue=this.frontFootOffsetZ_,t.bones.legFL.footOffsetX_.targetValue=this.frontFootOffsetX_,t.bones.legFR.footOffsetX_.targetValue=this.frontFootOffsetX_,t.bones.legFL.targetPoleAngle=-this.frontTargetPoleAngle,t.bones.legFR.targetPoleAngle=this.frontTargetPoleAngle,t.bones.shoulder.pitch.targetValue=.3+1*t.bones.head.pitch,t.bones.fracShoulderHeadYaw.targetValue=.75},z549}(z767),e.z549=o}(z0||(z0={}));var OIMO_ARRAY_TYPE,JSONCrush=function(t,v){void 0===v&&(v=50);for(var e=[],o=127;--o;)(48<=o&&o<=57||65<=o&&o<=90||97<=o&&o<=122||"-_.!~*'()".includes(String.fromCharCode(o)))&&e.push(String.fromCharCode(o));for(o=32;o<255;++o){var i=String.fromCharCode(o);"\\"==i||e.includes(i)||e.unshift(i)}t=t.replace(new RegExp("","g"),"");var n=function(t,e){for(var o,c1,c2,i=e.length,n="",s=function(t){return encodeURI(encodeURIComponent(t)).replace(/%../g,"i").length},a={},r=2;r<v;r++)for(var c=0;c<t.length-r;++c)if(!(a[m=t.substr(c,r)]||(c1=(o=m).charCodeAt(0),c2=o.charCodeAt(o.length-1),56320<=c1&&c1<=57343||55296<=c2&&c2<=56319))){for(var d=1,p=t.indexOf(m,c+r);0<=p;++d)p=t.indexOf(m,p+r);1<d&&(a[m]=d)}for(;;){for(;i--&&t.includes(e[i]););if(i<0)break;var l=e[i],u=void 0,y=0,g=s(l);for(var m in a){var f=((d=a[m])-1)*s(m)-(d+1)*g;n.length||(f-=s("")),f<=0?delete a[m]:y<f&&(u=m,y=f)}if(!u)break;t=t.split(u).join(l)+l+u,n=l+n;var A={};for(var m in a){var b=m.split(u).join(l);for(d=0,c=t.indexOf(b);0<=c;++d)c=t.indexOf(b,c+b.length);1<d&&(A[b]=d)}a=A}return{a:t,b:n}}(t=JSONCrushSwap(t),e),s=n.a;return n.b.length&&(s+=""+n.b),s+="_",encodeURIComponent(s)},JSONUncrush=function(t){var e=(t=t.substring(0,t.length-1)).split(""),o=e[0];if(1<e.length)for(var i=0,n=e[1];i<n.length;i++){var s=n[i],a=o.split(s);o=a.join(a.pop())}return JSONCrushSwap(o,0)},JSONCrushSwap=function(t,e){void 0===e&&(e=1);var o=[['"',"'"],["':","!"],[",'","~"],["}",")","\\","\\"],["{","(","\\","\\"]],i=function(t,e){var o=new RegExp((e[2]?e[2]:"")+e[0]+"|"+((e[3]?e[3]:"")+e[1]),"g");return t.replace(o,function(t){return t===e[0]?e[1]:e[0]})};if(e)for(var n=0;n<o.length;++n)t=i(t,o[n]);else for(n=o.length;n--;)t=i(t,o[n]);return t},astar=function(){function astar(){}return astar.init=function(t){for(var e=0;e<t.length;e++){var o=t[e];o.f=0,o.g=0,o.h=0,o.visited=!1,o.closed=!1,o.parent=null}},astar.heap=function(){return new BinaryHeap(function(t){return t.f})},astar.search=function(t,e,o,i,n){t.length=0,astar.init(e),n=n||astar.manhattan;var s=astar.heap();for(s.push(o);0<s.size();){var a=s.pop();if(a===i){for(var r=a;r.parent;)t.push(r),r=r.parent;return t.reverse()}a.closed=!0;for(var c=a.connections,d=a.weights,p=0,l=c.length;p<l;p++){var u=c[p],y=d[p];if(!u.closed&&!u.isWall()){var g=a.g+y,m=u.visited;(!m||g<u.g)&&(u.visited=!0,u.parent=a,0==u.h&&u.h,u.h=u.h||n(u.pos,i.pos),u.g=g,u.f=u.g+u.h,m?s.rescoreElement(u):s.push(u))}}}},astar.manhattan=function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)+Math.abs(t.z-e.z)},astar}(),GraphNodeType={OPEN:1,WALL:0},Graph=function(){function Graph(){this.nodes=[]}return Graph.prototype.addNode=function(t){this.nodes.push(t)},Graph.prototype.removeNode=function(t){for(var e=0;e<this.nodes.length;e++)if(this.nodes[e]==t){this.nodes.splice(e,1);break}},Graph.prototype.toString=function(){for(var t,e,o,i,n="\n",s=this.nodes,a=0,r=s.length;a<r;a++){for(t="",o=0,i=(e=s[a]).length;o<i;o++)t+=e[o].type+" ";n=n+t+"\n"}return n},Graph}(),GraphNode=function(){function GraphNode(t,e,o,i){this.data={},this.id=0,this.type=0,this.connections=[],this.weights=[],this.events=[],this.deferTo=void 0,this.addConnection=function(t,e){-1==this.connections.indexOf(t)&&(this.connections.push(t),this.weights.push(e))},this.removeConnection=function(t){for(var e=0;e<this.connections.length;e++)if(this.connections[e]==t){this.connections.splice(e,1),this.weights.splice(e,1);break}},this.removeConnections=function(t){for(var e=this.connections.length-1;0<=e;e--)if(this.connections[e]!=t){var o=this.connections[e];this.connections.splice(e,1),this.weights.splice(e,1),o.removeConnection(this)}},this.id=GraphNode.count++,this.pos={x:t,y:e,z:o},this.type=i}return Object.defineProperty(GraphNode.prototype,"x",{get:function(){return this.pos.x},set:function(t){this.pos.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(GraphNode.prototype,"y",{get:function(){return this.pos.y},set:function(t){this.pos.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(GraphNode.prototype,"z",{get:function(){return this.pos.z},set:function(t){this.pos.z=t},enumerable:!1,configurable:!0}),GraphNode.prototype.replaceConnection=function(t,e,o){for(var i=0;i<this.connections.length&&this.connections[i]!=t;i++);this.connections[i]=e,this.weights[i]=o},GraphNode.prototype.isConnectedTo=function(t){return-1<this.connections.indexOf(t)},GraphNode.prototype.updateConnectionWeight=function(t,e){for(var o=0;o<this.connections.length;o++)if(this.connections[o]==t)return void(this.weights[o]=e)},GraphNode.prototype.toString=function(){return"["+this.x+" "+this.y+" "+this.z+"]"},GraphNode.prototype.isWall=function(){return this.type==GraphNodeType.WALL},GraphNode.count=0,GraphNode}();function BinaryHeap(t){this.content=[],this.scoreFunction=t}BinaryHeap.prototype={push:function(t){this.content.push(t),this.sinkDown(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return 0<this.content.length&&(this.content[0]=e,this.bubbleUp(0)),t},remove:function(t){var e=this.content.indexOf(t),o=this.content.pop();e!==this.content.length-1&&(this.content[e]=o,this.scoreFunction(o)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))},size:function(){return this.content.length},rescoreElement:function(t){this.sinkDown(this.content.indexOf(t))},sinkDown:function(t){for(var e=this.content[t];0<t;){var o=(t+1>>1)-1,i=this.content[o];if(!(this.scoreFunction(e)<this.scoreFunction(i)))break;this.content[o]=e,this.content[t]=i,t=o}},bubbleUp:function(t){for(var e=this.content.length,o=this.content[t],i=this.scoreFunction(o);;){var n=t+1<<1,s=n-1,a=null;if(s<e){var r=this.content[s],c=this.scoreFunction(r);c<i&&(a=s)}if(n<e){var d=this.content[n];this.scoreFunction(d)<(null===a?i:c)&&(a=n)}if(null===a)break;this.content[t]=this.content[a],this.content[a]=o,t=a}}},OIMO.Body=function(t){var e=t||{};if(e.world){this.parent=e.world,this.name=e.name||"";var o=e.move||!1,i=e.noSleep||!1,n=e.pos||[0,0,0];n=n.map(function(t){return t*OIMO.INV_SCALE});var s=e.size||[1,1,1];s=s.map(function(t){return t*OIMO.INV_SCALE});var a=e.rot||[0,0,0];a=a.map(function(t){return t*OIMO.TO_RAD});for(var r=[],c=0;c<a.length/3;c++){var d=OIMO.EulerToAxis(a[c+0],a[c+1],a[c+2]);r.push(d[0]),r.push(d[1]),r.push(d[2]),r.push(d[3])}var p=e.sc||new OIMO.ShapeConfig;e.config&&(p.density=e.config[0]||1,p.friction=e.config[1]||.4,p.restitution=e.config[2]||.2,p.belongsTo=e.config[3]||1,p.collidesWith=e.config[4]||4294967295),e.massPos&&(e.massPos=e.massPos.map(function(t){return t*OIMO.INV_SCALE}),p.relativePosition.init(e.massPos[0],e.massPos[1],e.massPos[2])),e.massRot&&(e.massRot=e.massRot.map(function(t){return t*OIMO.TO_RAD}),p.relativeRotation=OIMO.EulerToMatrix(e.massRot[0],e.massRot[1],e.massRot[2])),this.body=new OIMO.RigidBody(n[0],n[1],n[2],r[0],r[1],r[2],r[3]);var l,u,y=[],g=e.type||"box";"string"==typeof g&&(g=[g]);for(c=0;c<g.length;c++){switch(l=3*c,u=4*c,g[c]){case"funnel":y[c]=new OIMO.FunnelShape(p,s[l+0],s[l+1],s[l+2],s[l+3]);break;case"bowl":y[c]=new OIMO.BowlShape(p,s[l+0],s[l+1],s[l+2],s[l+3],s[l+4]);break;case"sphere":y[c]=new OIMO.SphereShape(p,s[l+0]);break;case"tube":y[c]=new OIMO.TubeShape(p,s[l+0],s[l+1],s[l+2]);break;case"box":y[c]=new OIMO.BoxShape(p,s[l+0],s[l+1],s[l+2]);break;case"holey_box":y[c]=new OIMO.HoleyBoxShape(p,s[l+0],s[l+1],s[l+2],e.holes);break;case"holey_sphere":y[c]=new OIMO.HoleySphereShape(p,s[l+0],e.holes);break;case"spiralSlide":y[c]=new OIMO.SpiralSlideShape(p,s[l+0],s[l+1],s[l+2]);break;case"curvedTube":y[c]=new OIMO.CurvedTubeShape(p,s[l+0],s[l+1],s[l+2]);break;case"teeTube":y[c]=new OIMO.TeeTubeShape(p,s[l+0],s[l+1],s[l+2]);break;case"crossTube":y[c]=new OIMO.CrossTubeShape(p,s[l+0],s[l+1],s[l+2]);break;case"ground":y[c]=new OIMO.GroundShape(p,s[0],s[1],e.thickness,e.groundMesh,s[2],e.fracPadding)}this.body.addShape(y[c]),0<c&&(y[c].relativePosition=new OIMO.Vec3(n[l+0],n[l+1],n[l+2]),r[u+0]&&(y[c].relativeRotation=[r[u+0],r[u+1],r[u+2],r[u+3]]))}o?(e.massPos||e.massRot?this.body.setupMass(1,!1):this.body.setupMass(1,!0),this.body.allowSleep=!i):this.body.setupMass(2),this.body.name=this.name,this.sleeping=this.body.sleeping,this.parent.addRigidBody(this.body)}},OIMO.SphereSphereCollisionDetector=function(){OIMO.CollisionDetector.call(this)},OIMO.SphereSphereCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype),OIMO.SphereSphereCollisionDetector.prototype.detectCollision=function(t,e,o){var i=t,n=e;if(0!==i.collidesWith&&0!==n.collidesWith&&0!=(i.belongsTo&n.collidesWith)){var s=1,a=1,r=i.parent.name,c=n.parent.name;"hamster4_head"!=r&&"hamster4_head"!=c||!0,null!=i.actor&&null!=n.actor&&(null!=i.actor&&i.actor==n.actor?(null!=i.actor.collisionSelfFrac&&(s=i.actor.collisionSelfFrac.value),null!=n.actor.collisionSelfFrac&&(a=n.actor.collisionSelfFrac.value),null!=i.collisionSelfFrac&&i.collisionSelfFrac<s&&(s=i.collisionSelfFrac,a=i.collisionSelfFrac),null!=n.collisionSelfFrac&&n.collisionSelfFrac<a&&(s=n.collisionSelfFrac,a=n.collisionSelfFrac)):(null!=i.actor.collisionOtherFrac&&(s=i.actor.collisionOtherFrac.value),null!=n.actor.collisionOtherFrac&&(a=n.actor.collisionOtherFrac.value)));var p1=i.position,p2=n.position,d=p2.x-p1.x,p=p2.y-p1.y,l=p2.z-p1.z,u=d*d+p*p+l*l,r1=i.radius*s,y=r1+n.radius*a;if(0<u&&u<y*y){var g=1/(u=Math.sqrt(u));d*=g,p*=g,l*=g,i.pubsub&&i.pubsub.broadcast("hit",p1.x+d*r1,p1.y+p*r1,p1.z+l*r1,d,p,l,u-y,i,n),n.pubsub&&n.pubsub.broadcast("hit",p1.x+d*r1,p1.y+p*r1,p1.z+l*r1,-d,-p,-l,u-y,n,i),i.disablePhysics||n.disablePhysics||o.addPoint(p1.x+d*r1,p1.y+p*r1,p1.z+l*r1,d,p,l,u-y,!1)}}},z0.App.Subscribe(z0.AppEvents.OIMO_WORLD_CREATED,function addToOIMOWorld(t){OIMO.SHAPE_z1051=3,OIMO.SHAPE_CYLINDER=4,OIMO.SHAPE_z1045=5,OIMO.SHAPE_SPIRAL_SLIDE=6,OIMO.SHAPE_CURVED_z1051=7,OIMO.SHAPE_TEE_z1051=8,OIMO.SHAPE_CROSS_z1051=9,OIMO.SHAPE_GROUND=10,OIMO.SHAPE_HOLEY_PLANE=11,OIMO.SHAPE_HOLEY_BOX=12,OIMO.SHAPE_FUNNEL=13,OIMO.SHAPE_HOLEY_SPHERE=14;var e=t.detectors;e[OIMO.SHAPE_z1051][OIMO.SHAPE_BOX]=new OIMO.CylinderBoxCollisionDetector(!0),e[OIMO.SHAPE_z1051][OIMO.SHAPE_z1051]=new OIMO.SphereSphereCollisionDetector(!0),e[OIMO.SHAPE_z1051][OIMO.SHAPE_SPHERE]=new OIMO.CylinderSphereCollisionDetector(!1),e[OIMO.SHAPE_SPHERE][OIMO.SHAPE_z1051]=new OIMO.CylinderSphereCollisionDetector(!0),e[OIMO.SHAPE_z1045][OIMO.SHAPE_SPHERE]=new OIMO.BowlSphereCollisionDetector(!1),e[OIMO.SHAPE_SPHERE][OIMO.SHAPE_z1045]=new OIMO.BowlSphereCollisionDetector(!0),e[OIMO.SHAPE_z1045][OIMO.SHAPE_BOX]=new OIMO.BowlBoxCollisionDetector(!1),e[OIMO.SHAPE_BOX][OIMO.SHAPE_z1045]=new OIMO.BowlBoxCollisionDetector(!0),e[OIMO.SHAPE_SPIRAL_SLIDE][OIMO.SHAPE_SPHERE]=new OIMO.SpiralSlideSphereCollisionDetector(!1),e[OIMO.SHAPE_SPHERE][OIMO.SHAPE_SPIRAL_SLIDE]=new OIMO.SpiralSlideSphereCollisionDetector(!0),e[OIMO.SHAPE_CURVED_z1051][OIMO.SHAPE_SPHERE]=new OIMO.CurvedTubeSphereCollisionDetector(!1),e[OIMO.SHAPE_SPHERE][OIMO.SHAPE_CURVED_z1051]=new OIMO.CurvedTubeSphereCollisionDetector(!0),e[OIMO.SHAPE_TEE_z1051][OIMO.SHAPE_SPHERE]=new OIMO.TeeTubeSphereCollisionDetector(!1),e[OIMO.SHAPE_SPHERE][OIMO.SHAPE_TEE_z1051]=new OIMO.TeeTubeSphereCollisionDetector(!0),e[OIMO.SHAPE_CROSS_z1051][OIMO.SHAPE_SPHERE]=new OIMO.CrossTubeSphereCollisionDetector(!1),e[OIMO.SHAPE_SPHERE][OIMO.SHAPE_CROSS_z1051]=new OIMO.CrossTubeSphereCollisionDetector(!0),e[OIMO.SHAPE_GROUND][OIMO.SHAPE_SPHERE]=new OIMO.GroundSphereCollisionDetector(!1),e[OIMO.SHAPE_SPHERE][OIMO.SHAPE_GROUND]=new OIMO.GroundSphereCollisionDetector(!0),e[OIMO.SHAPE_HOLEY_BOX][OIMO.SHAPE_SPHERE]=new OIMO.HoleyBoxSphereCollisionDetector(!1),e[OIMO.SHAPE_SPHERE][OIMO.SHAPE_HOLEY_BOX]=new OIMO.HoleyBoxSphereCollisionDetector(!0),e[OIMO.SHAPE_FUNNEL][OIMO.SHAPE_SPHERE]=new OIMO.FunnelSphereCollisionDetector(!1),e[OIMO.SHAPE_SPHERE][OIMO.SHAPE_FUNNEL]=new OIMO.FunnelSphereCollisionDetector(!0),e[OIMO.SHAPE_HOLEY_SPHERE][OIMO.SHAPE_SPHERE]=new OIMO.HoleySphereSphereCollisionDetector(!1),e[OIMO.SHAPE_SPHERE][OIMO.SHAPE_HOLEY_SPHERE]=new OIMO.HoleySphereSphereCollisionDetector(!0),e[OIMO.SHAPE_HOLEY_SPHERE][OIMO.SHAPE_HOLEY_SPHERE]=new OIMO.HoleySphereSphereCollisionDetector,e[OIMO.SHAPE_z1051][OIMO.SHAPE_HOLEY_SPHERE]=new OIMO.CylinderSphereCollisionDetector(!1),e[OIMO.SHAPE_HOLEY_SPHERE][OIMO.SHAPE_z1051]=new OIMO.CylinderSphereCollisionDetector(!0),e[OIMO.SHAPE_z1045][OIMO.SHAPE_HOLEY_SPHERE]=new OIMO.BowlSphereCollisionDetector(!1),e[OIMO.SHAPE_HOLEY_SPHERE][OIMO.SHAPE_z1045]=new OIMO.BowlSphereCollisionDetector(!0),e[OIMO.SHAPE_CURVED_z1051][OIMO.SHAPE_HOLEY_SPHERE]=new OIMO.CurvedTubeSphereCollisionDetector(!1),e[OIMO.SHAPE_HOLEY_SPHERE][OIMO.SHAPE_CURVED_z1051]=new OIMO.CurvedTubeSphereCollisionDetector(!0),e[OIMO.SHAPE_TEE_z1051][OIMO.SHAPE_HOLEY_SPHERE]=new OIMO.TeeTubeSphereCollisionDetector(!1),e[OIMO.SHAPE_HOLEY_SPHERE][OIMO.SHAPE_TEE_z1051]=new OIMO.TeeTubeSphereCollisionDetector(!0),e[OIMO.SHAPE_CROSS_z1051][OIMO.SHAPE_HOLEY_SPHERE]=new OIMO.CrossTubeSphereCollisionDetector(!1),e[OIMO.SHAPE_HOLEY_SPHERE][OIMO.SHAPE_CROSS_z1051]=new OIMO.CrossTubeSphereCollisionDetector(!0),e[OIMO.SHAPE_GROUND][OIMO.SHAPE_HOLEY_SPHERE]=new OIMO.GroundSphereCollisionDetector(!1),e[OIMO.SHAPE_HOLEY_SPHERE][OIMO.SHAPE_GROUND]=new OIMO.GroundSphereCollisionDetector(!0),e[OIMO.SHAPE_HOLEY_BOX][OIMO.SHAPE_HOLEY_SPHERE]=new OIMO.HoleyBoxSphereCollisionDetector(!1),e[OIMO.SHAPE_HOLEY_SPHERE][OIMO.SHAPE_HOLEY_BOX]=new OIMO.HoleyBoxSphereCollisionDetector(!0)}),OIMO.BowlShape=function(t,e,o,i,n,s,a,r){void 0===s&&(s=null),void 0===a&&(a=!0),void 0===r&&(r=!1),OIMO.Shape.call(this,t),this.curveRadius=i||0,this.radius=e,this.bottomRadius=s||e,this._offsetFloorHeight=0,this.contentRadius=this.radius-this.curveRadius,this.bottomRadius!=this.radius&&(this.outerSlopeVec=new OIMO.Vec3,this.outerSlopeVec.x=s-e,this.outerSlopeVec.y=-o,this.outerSlopeVec.normalize(this.outerSlopeVec)),this.height=o,this.halfHeight=.5*o,this.thickness=n||0,this.elements=new OIMO_ARRAY_TYPE(24),this.type=OIMO.SHAPE_z1045,this.doStayInside=a},OIMO.BowlShape.prototype=Object.create(OIMO.Shape.prototype),Object.defineProperty(OIMO.BowlShape.prototype,"offsetFloorHeight",{get:function(){return this._offsetFloorHeight},set:function(t){var e=this.radius-this.curveRadius;if(this.contentRadius=e,0<t){var o=this.curveRadius-t,i=this.curveRadius,n=Math.sqrt(o*o+i*i);this.contentRadius+=n}this._offsetFloorHeight=t},enumerable:!0,configurable:!0}),OIMO.BowlShape.prototype.calculateMassInfo=function(t){var e=this.radius,h=this.height,o=Math.PI*e*e*h,i=.2*Math.PI*.2*h,n=this.density*(o-i),s=n/12*(3*(e*e+.2*.2)+h*h),a=.5*n*(e*e+.2*.2),r=2*Math.PI*e*e*.2*e*e*.5;r=0,t.mass=n,t.inertia.init(s+0,0,0,0,s+0,0,0,0,a+r)},OIMO.BowlShape.prototype.updateProxy=function(){var t=this.rotation.elements,e=this.radius;e=this.bottomRadius;var o=this.position.x,i=this.position.y,n=this.position.z,s=this.halfHeight,a=this.thickness,r=s+a,c=-s-a,d=r*t[1]+o,p=r*t[4]+i,l=r*t[7]+n,u=c*t[1]+o,y=c*t[4]+i,g=c*t[7]+n,m=u,f=d,A=y,b=p,v=g,x=l;d<u&&(m=d,f=u),p<y&&(A=p,b=y),l<g&&(v=l,x=g);var C=.1+e;this.aabb.init(m-C,f+C,A-C,b+C,v-C,x+C),null!==this.proxy&&this.proxy.update()},OIMO.BowlSphereCollisionDetector=function(t){OIMO.CollisionDetector.call(this),this.flip=t,this.tempVec1=new OIMO.Vec3,this.tempVec2=new OIMO.Vec3,this.tempVec3=new OIMO.Vec3,this.tempVec4=new OIMO.Vec3,this.tempVec5=new OIMO.Vec3},OIMO.BowlSphereCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype),OIMO.BowlSphereCollisionDetector.prototype.detectCollision=function(t,e,o){var i,n;this.flip?(i=e,n=t):(i=t,n=e);var s=n.radius,a=.5*i.thickness,r=i.radius-a,c=i.bottomRadius,d=i.halfHeight,p=i.position,l=n.position,u=l.x-p.x,y=l.y-p.y,g=l.z-p.z,m=i.rotation.elements,f=u*m[0]+y*m[3]+g*m[6],A=u*m[1]+y*m[4]+g*m[7],b=u*m[2]+y*m[5]+g*m[8];if(!(d+a<A-s||A+s<-d-a)){var v,x=f*f+b*b;if(!((v=c+s)*v<x)){var C,S,T,B,O,P,M,I,N,z,w,_,R,L=r+a,F=L*L,D=Math.sqrt(x),E=1/D;if(C=f*E,S=0,T=b*E,c!=i.radius&&F<x){var k=this.tempVec1,j=this.tempVec2,V=this.tempVec3,G=this.tempVec4,W=this.tempVec5;G.x=1,G.y=0,G.z=0,j.x=0,j.y=1,j.z=0,V.x=0,V.y=0,V.z=1,G.x=C,G.y=0,G.z=T,V.cross(G,j),W.x=G.x*c,W.y=-i.halfHeight,W.z=G.z*c;var Y=c-r,U=-i.height;k.x=Y*G.x+U*j.x+0*V.x,k.y=Y*G.y+U*j.y+0*V.y,k.z=Y*G.z+U*j.z+0*V.z,k.normalize(k),G.x=k.x,G.y=k.y,G.z=k.z,V.cross(G,j),V.normalize(V),j.cross(V,G);var X=G.x,Z=G.y,q=G.z;G.x=X*m[0]+Z*m[1]+q*m[2],G.y=X*m[3]+Z*m[4]+q*m[5],G.z=X*m[6]+Z*m[7]+q*m[8];X=j.x,Z=j.y,q=j.z;j.x=X*m[0]+Z*m[1]+q*m[2],j.y=X*m[3]+Z*m[4]+q*m[5],j.z=X*m[6]+Z*m[7]+q*m[8];X=V.x,Z=V.y,q=V.z;V.x=X*m[0]+Z*m[1]+q*m[2],V.y=X*m[3]+Z*m[4]+q*m[5],V.z=X*m[6]+Z*m[7]+q*m[8];X=W.x,Z=W.y,q=W.z;W.x=X*m[0]+Z*m[1]+q*m[2]+p.x,W.y=X*m[3]+Z*m[4]+q*m[5]+p.y,W.z=X*m[6]+Z*m[7]+q*m[8]+p.z,i.pubsub&&i.pubsub.broadcast("",W,G,j,V);var Q=l.x-W.x,J=l.y-W.y,K=l.z-W.z,$=Q*G.x+J*G.y+K*G.z,tt=Q*j.x+J*j.y+K*j.z,et=Q*V.x+J*V.y+K*V.z;if(0<=(B=tt-s))return;return N=0,z=et,O=(I=$)*G.x+N*j.x+z*V.x+W.x,P=I*G.y+N*j.y+z*V.y+W.y,M=I*G.z+N*j.z+z*V.z+W.z,w=j.x,_=j.y,R=j.z,i.pubsub&&(W.x=O,W.y=P,W.z=M,i.pubsub.broadcast("contact",O,P,M),i.pubsub.broadcast("hitNormal",W,j,tt),i.pubsub.broadcast("hit",O,P,M,w,_,R,B,i,n)),o.addPoint(O,P,M,w,_,R,B,this.flip),void(n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,O,P,M,w,_,R,B,i))}var ot=A;ot<0&&(ot*=-1);var it,nt,st,at=!1,rt=!1,ht=i.curveRadius,ct=r-ht,dt=i.contentRadius;it=C*ct,st=T*ct,nt=-d+ht;var pt=!1,lt=!1;ht-a<s&&(lt=!0);var ut=i.offsetFloorHeight;if(-d<A+s&&A-s<d+a)if(lt)D<r&&(at=!0,A-s<-d+a+ut&&-d+ut<A&&(rt=!0));else if(D<dt){if(at=!0,A-s<-d+a+ut&&-d+ut<A)rt=!0;else if(-d+a+ut<A-s&&D+s<dt)return}else if(-d+ht<A&&D<r)pt=at=!0;else{(bt=(C=f-it)*C+(S=A-nt)*S+(T=b-st)*T)<ht*ht&&(at=!0)}var yt=!1;this.doStayInside&&n.actor&&(at||n.actor.stayInsideBody!=i.parent?at&&n.actor.stayInsideBody!=i.parent&&(at=!(yt=!0),-d+ht+ut<A&&(pt=!0)):(at=yt=!0,-d+ht+ut<A&&(pt=!0)));n.parent.name;rt&&(S=1,I=f,z=b,B=A-s-(N=-d+a+ut),w=(C=0)*m[T=0]+S*m[1]+T*m[2],_=C*m[3]+S*m[4]+T*m[5],R=C*m[6]+S*m[7]+T*m[8],O=I*m[0]+N*m[1]+z*m[2],P=I*m[3]+N*m[4]+z*m[5],M=I*m[6]+N*m[7]+z*m[8],O+=p.x,P+=p.y,M+=p.z,o.addPoint(O,P,M,w,_,R,B,this.flip),i.pubsub&&i.pubsub.broadcast("hit",O,P,M,w,_,R,B,i,n),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,O,P,M,w,_,R,B,i));var gt=a;if(d<A&&r-s-a<D&&D<r+s+a){var mt=(C=f*E)*r,ft=(T=b*E)*r,At=d;if((s+a)*(s+a)<(bt=(C=f-mt)*C+(S=A-At)*S+(T=b-ft)*T))return;T*=xt=1/(vt=Math.sqrt(bt)),S*=xt,B=vt-(s+a),w=(C*=xt)*m[0]+S*m[1]+T*m[2],_=C*m[3]+S*m[4]+T*m[5],R=C*m[6]+S*m[7]+T*m[8],N=At+S*gt,z=ft+T*gt,O=(I=mt+C*gt)*m[0]+N*m[1]+z*m[2],P=I*m[3]+N*m[4]+z*m[5],M=I*m[6]+N*m[7]+z*m[8],O+=p.x,P+=p.y,M+=p.z,o.addPoint(O,P,M,w,_,R,B,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,O,P,M,w,_,R,B,i),i.pubsub&&(i.pubsub.broadcast("hit",O,P,M,w,_,R,B,i,n),i.pubsub.broadcast("hitOutside",O,P,M,w,_,R,B,i,n))}else if(at&&(lt||pt)){if(C=-f*E,T=-b*E,(S=0)<=(B=r-s-a-D))return;33==n.id&&n.id,yt&&B<0*-s&&(B+=15*(B-0*-s))<2.5*-r&&(B=2.5*-r),w=C*m[0]+S*m[1]+T*m[2],_=C*m[3]+S*m[4]+T*m[5],R=C*m[6]+S*m[7]+T*m[8],N=A,z=-T*(r-a),O=(I=-C*(r-a))*m[0]+N*m[1]+z*m[2],P=I*m[3]+N*m[4]+z*m[5],M=I*m[6]+N*m[7]+z*m[8],O+=p.x,P+=p.y,M+=p.z,o.addPoint(O,P,M,w,_,R,B,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,O,P,M,w,_,R,B,i),i.pubsub&&(i.pubsub.broadcast("hit",O,P,M,w,_,R,B,i,n),i.pubsub.broadcast("hitInside",O,P,M,w,_,R,B,i,n))}else if(at&&ct<D){if((S=nt-A)<0)return;if((bt=(C=it-f)*C+S*S+(T=st-b)*T)<(ht-s-a)*(ht-s-a))return;if(C*=xt=1/(vt=Math.sqrt(bt)),T*=xt,S*=xt,0<=(B=ht-a-(vt+s)))return;33==n.id&&n.id,yt&&B<0*-s&&(B+=15*(B-0*-s))<2.5*-r&&(B=2.5*-r),w=C*m[0]+S*m[1]+T*m[2],_=C*m[3]+S*m[4]+T*m[5],R=C*m[6]+S*m[7]+T*m[8],N=nt-S*(ht-a),z=st-T*(ht-a),O=(I=it-C*(ht-a))*m[0]+N*m[1]+z*m[2],P=I*m[3]+N*m[4]+z*m[5],M=I*m[6]+N*m[7]+z*m[8],O+=p.x,P+=p.y,M+=p.z,o.addPoint(O,P,M,w,_,R,B,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,O,P,M,w,_,R,B,i),i.pubsub&&(i.pubsub.broadcast("hit",O,P,M,w,_,R,B,i,n),i.pubsub.broadcast("hitInside",O,P,M,w,_,R,B,i,n))}else if(!at&&r<D&&nt<A){if(T=b*E,(S=0)<=(B=D-s-(r+a)))return;w=(C=f*E)*m[0]+S*m[1]+T*m[2],_=C*m[3]+S*m[4]+T*m[5],R=C*m[6]+S*m[7]+T*m[8],N=A,z=T*(r+a),O=(I=C*(r+a))*m[0]+N*m[1]+z*m[2],P=I*m[3]+N*m[4]+z*m[5],M=I*m[6]+N*m[7]+z*m[8],O+=p.x,P+=p.y,M+=p.z,o.addPoint(O,P,M,w,_,R,B,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,O,P,M,w,_,R,B,i),i.pubsub&&(i.pubsub.broadcast("hit",O,P,M,w,_,R,B,i,n),i.pubsub.broadcast("hitOutside",O,P,M,w,_,R,B,i,n))}else if(!at&&ct<D&&A<nt&&A<d){var bt,vt,xt;if((ht+s+a)*(ht+s+a)<(bt=(C=f-it)*C+(S=A-nt)*S+(T=b-st)*T))return;T*=xt=1/(vt=Math.sqrt(bt)),S*=xt,B=vt-(ht+s+a),w=(C*=xt)*m[0]+S*m[1]+T*m[2],_=C*m[3]+S*m[4]+T*m[5],R=C*m[6]+S*m[7]+T*m[8],N=nt+S*ht,z=st+T*ht,O=(I=it+C*ht)*m[0]+N*m[1]+z*m[2],P=I*m[3]+N*m[4]+z*m[5],M=I*m[6]+N*m[7]+z*m[8],O+=p.x,P+=p.y,M+=p.z,o.addPoint(O,P,M,w,_,R,B,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,O,P,M,w,_,R,B,i),i.pubsub&&(i.pubsub.broadcast("hit",O,P,M,w,_,R,B,i,n),i.pubsub.broadcast("hitOutside",O,P,M,w,_,R,B,i,n))}else A<-d&&D<ct&&(S=-1,I=f,z=b,(B=(N=-d-a)-(A+s))<(T=C=0)&&(w=C*m[0]+S*m[1]+T*m[2],_=C*m[3]+S*m[4]+T*m[5],R=C*m[6]+S*m[7]+T*m[8],O=I*m[0]+N*m[1]+z*m[2],P=I*m[3]+N*m[4]+z*m[5],M=I*m[6]+N*m[7]+z*m[8],O+=p.x,P+=p.y,M+=p.z,o.addPoint(O,P,M,w,_,R,B,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,O,P,M,w,_,R,B,i),i.pubsub&&(i.pubsub.broadcast("hit",O,P,M,w,_,R,B,i,n),i.pubsub.broadcast("hitOutside",O,P,M,w,_,R,B,i,n))))}}},OIMO.BowlBoxCollisionDetector=function(t){OIMO.CollisionDetector.call(this),this.flip=t},OIMO.BowlBoxCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype),OIMO.BowlBoxCollisionDetector.prototype.detectCollision=function(t,e,o){this.flip?e:t},OIMO_ARRAY_TYPE||(OIMO_ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array),OIMO.FunnelShape=function(t,e,o,i,n){void 0===i&&(i=0),void 0===n&&(n=0),OIMO.Shape.call(this,t),this.innerRadius=i,this.radius=e,this.height=o,this.halfHeight=.5*o,this.thickness=n,this.slopeAngle=Math.atan2(o,e-i),this.tanSlopeAngle=Math.tan(this.slopeAngle),this.elements=new OIMO_ARRAY_TYPE(24),this.type=OIMO.SHAPE_FUNNEL},OIMO.FunnelShape.prototype=Object.create(OIMO.Shape.prototype),OIMO.FunnelShape.prototype.calculateMassInfo=function(t){var e=this.radius,h=this.height,o=Math.PI*e*e*h,i=.2*Math.PI*.2*h,n=this.density*(o-i),s=n/12*(3*(e*e+.2*.2)+h*h),a=.5*n*(e*e+.2*.2),r=2*Math.PI*e*e*.2*e*e*.5;r=0,t.mass=n,t.inertia.init(s+0,0,0,0,s+0,0,0,0,a+r)},OIMO.FunnelShape.prototype.updateProxy=function(){var t=this.rotation.elements,e=this.radius,o=this.position.x,i=this.position.y,n=this.position.z,s=(this.halfHeight,this.height),a=s*t[1]+o,r=s*t[4]+i,c=s*t[7]+n,d=0*t[1]+o,p=0*t[4]+i,l=0*t[7]+n,u=d,y=a,g=p,m=r,f=l,A=c;a<d&&(u=a,y=d),r<p&&(g=r,m=p),c<l&&(f=c,A=l);var b=.1+e;this.aabb.init(u-b,y+b,g-b,m+b,f-b,A+b),null!==this.proxy&&this.proxy.update()},OIMO.FunnelSphereCollisionDetector=function(t){OIMO.CollisionDetector.call(this),this.flip=t,this.hits=[],this.tempVec1=new OIMO.Vec3,this.tempVec2=new OIMO.Vec3,this.tempVec3=new OIMO.Vec3,this.tempVec4=new OIMO.Vec3},OIMO.FunnelSphereCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype),OIMO.FunnelSphereCollisionDetector.prototype.detectCollision=function(t,e,o){var i,n;this.flip?(i=e,n=t):(i=t,n=e);var s=n.radius,a=.5*i.thickness,r=i.radius,c=i.height,d=i.position,p=n.position,l=p.x-d.x,u=p.y-d.y,y=p.z-d.z,g=i.rotation.elements,m=l*g[0]+u*g[3]+y*g[6],f=l*g[1]+u*g[4]+y*g[7],A=l*g[2]+u*g[5]+y*g[8];if(!(c<f-s||f+s<-c)){var b=m*m+A*A,v=r+a+s;if(!(v*v<b)){var x,C,S,T,B,O,P,M,I,N,z,w,_,R=Math.sqrt(b);(tt=f)<0&&(tt*=-1);var L=!1,F=i.innerRadius,D=1/R;x=m*D,C=0,S=A*D;n.actor&&(L||n.actor.stayInsideBody!=i.parent?L&&n.actor.stayInsideBody!=i.parent&&(L=!!0):L=!0);n.parent.name;if(this.hits.length=0,c-s<f&&r-s<R&&R<r+s){var E=(x=m*D)*r,k=(S=A*D)*r,j=c,V=(x=m-E)*x+(C=f-j)*C+(S=A-k)*S;if(s*s<V)return;var G=Math.sqrt(V),W=1/G;if(S*=W,C*=W,0<(T=G-s))return;z=(x*=W)*g[0]+C*g[1]+S*g[2],w=x*g[3]+C*g[4]+S*g[5],_=x*g[6]+C*g[7]+S*g[8],I=j,N=k,B=(M=E)*g[0]+I*g[1]+N*g[2],O=M*g[3]+I*g[4]+N*g[5],P=M*g[6]+I*g[7]+N*g[8],B+=d.x,O+=d.y,P+=d.z,o.addPoint(B,O,P,z,w,_,T,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,B,O,P,z,w,_,T,i)}else if(F<R&&R<r+s){var Y=this.tempVec1,U=this.tempVec2,X=this.tempVec3,Z=this.tempVec4;Y.x=x,Y.y=0,Y.z=S;var q=f/i.tanSlopeAngle,Q=x*q,J=f,K=S*q;U.x=-Q,U.y=q/i.tanSlopeAngle,U.z=-K,U.normalize(U),X.cross(U,Y),X.normalize(X),Z.cross(X,U),Z.normalize(Z);var $=m-Q,tt=f-J,et=A-K,ot=$*Z.x+tt*Z.y+et*Z.z,it=$*U.x+tt*U.y+et*U.z,nt=ot,st=$*X.x+tt*X.y+et*X.z;if(x=U.x,C=U.y,S=U.z,it<0?(T=-it-s,x=-U.x,C=-U.y,S=-U.z):T=it-s,0<T)return;M=nt*Z.x+0*U.x+st*X.x,I=nt*Z.y+0*U.y+st*X.y,N=nt*Z.z+0*U.z+st*X.z,M+=Q,I+=J,N+=K,z=x*g[0]+C*g[1]+S*g[2],w=x*g[3]+C*g[4]+S*g[5],_=x*g[6]+C*g[7]+S*g[8],B=M*g[0]+I*g[1]+N*g[2],O=M*g[3]+I*g[4]+N*g[5],P=M*g[6]+I*g[7]+N*g[8],B+=d.x,O+=d.y,P+=d.z,o.addPoint(B,O,P,z,w,_,T,this.flip),n.hitListeners&&OIMO.notifyHitListeners(n.hitListeners,B,O,P,z,w,_,T,i)}}}},OIMO.GroundShape=function(t,e,o,i,n,s,a){OIMO.Shape.call(this,t),this.groundMesh=n,this.width=e,this.height=o,this.fracPadding=0,a&&(this.fracPadding=a),s&&(this.radius=s),this.halfWidth=.5*e,this.halfHeight=.5*o,this.minX=0,this.maxX=0,this.minY=0,this.maxY=0,this.minZ=0,this.maxZ=0,this.thickness=i||0,this.elements=new OIMO_ARRAY_TYPE(24),this.type=OIMO.SHAPE_GROUND},OIMO.GroundShape.prototype=Object.create(OIMO.Shape.prototype),OIMO.GroundShape.prototype.calculateMassInfo=function(t){var e=this.density;t.mass=e,t.inertia.init(1,0,0,0,1,0,0,0,1)},OIMO.GroundShape.prototype.updateProxy=function(){this.rotation.elements,this.position.x,this.position.y,this.position.z,this.halfHeight,this.halfWidth;var t=this.halfHeight;t<this.halfWidth&&(t=this.halfWidth);var e=this.minX,o=this.maxX,i=this.minZ,n=this.maxZ,s=this.minY,a=this.maxY;this.aabb.init(e-.1,o+.1,s,a+.1,i-.1,n+.1),null!==this.proxy&&this.proxy.update()},OIMO.GroundSphereCollisionDetector=function(t){OIMO.CollisionDetector.call(this),this.flip=t,this.hits=[],this.tempVec1=new OIMO.Vec3,this.tempVec2=new OIMO.Vec3,this.tempVec3=new OIMO.Vec3},OIMO.GroundSphereCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype),OIMO.GroundSphereCollisionDetector.prototype.detectCollision=function(t,e,o){var i,n;if(this.flip?(i=e,n=t):(i=t,n=e),0!==n.collidesWith&&0!==i.collidesWith&&0!=(i.belongsTo&n.collidesWith)){var s=n.position;if(n.actor&&n.actor.stayInsideBody){var a=n.actor.stayInsideBody.shapes;if(a.height){var r=a.position.y-.5*a.height,c=a.position.y+.5*a.height,d=a.position.x-.5*a.width,p=a.position.x+.5*a.width;if(i.position.y<r||i.position.y>c||i.position.x<d||i.position.x>p)return}}if(i.groundMesh.isReady()){var l=.86602*n.radius,u=i.groundMesh._boundingInfo.boundingBox,y=s.x,g=s.y,m=s.z;if(!(y-n.radius>u.maximumWorld.x||y+n.radius<u.minimumWorld.x||m-n.radius>u.maximumWorld.z||m+n.radius<u.minimumWorld.z)){if(i.radius){var f=y-i.position.x,A=y-i.position.x;if(f*f+A*A>i.radius*i.radius)return}var b=u.maximumWorld.x-l-.001,v=u.minimumWorld.x+l+.001,x=u.maximumWorld.z-l-.001,C=u.minimumWorld.z+l+.001;y<v?y=v:b<y&&(y=b),m<C?m=C:x<m&&(m=x);var S=y,T=m-l,B=i.groundMesh.getHeightAtCoordinates(S,T)+i.thickness,O=y+l,P=m+l,M=i.groundMesh.getHeightAtCoordinates(O,P)+i.thickness,I=y-l,N=m+l,z=i.groundMesh.getHeightAtCoordinates(I,N)+i.thickness,w=this.tempVec1,_=this.tempVec2,R=this.tempVec3,L=y-S,F=g-B,D=m-T;w.x=O-S,w.y=M-B,w.z=P-T,_.x=I-S,_.y=z-B,_.z=N-T;var E=w;E.normalize(E),R.cross(_,w),R.normalize(R);var k=_;k.cross(R,E),k.normalize(k);var j=L*k.x+F*k.y+D*k.z,V=L*R.x+F*R.y+D*R.z,G=L*E.x+F*E.y+D*E.z,W=V-n.radius,Y=-n.radius*i.fracPadding;if(W<Y&&W>4*-n.radius){var U=j,X=V-n.radius,Z=G,q=U*k.x+X*R.x+Z*E.x,Q=U*k.y+X*R.y+Z*E.y,J=U*k.z+X*R.z+Z*E.z;q+=S,Q+=B,J+=T;var K=R.x,$=R.y,tt=R.z;w.x=0,w.y=1,w.z=0;var et=W-Y;if(n.hitListeners&&0<n.hitListeners.length)for(var ot=0;ot<n.hitListeners.length;ot++)n.hitListeners[ot](q,Q,J,K,$,tt,et,i,R);n.actor&&n.actor.frontBody&&n.actor.frontBody.speedSq<1e-4&&o.addPoint(y,g-n.radius,m,0,1,0,0,this.flip),o.addPoint(q,Q,J,K,$,tt,et,this.flip)}}}}},OIMO.Hole=function(t,e,o,i,n,s,a){this.x=t,this.y=e,this.z=o,this.radius=i,this.xside=n,this.yside=s,this.zside=a},OIMO.HoleyBoxShape=function(t,e,o,i,n){OIMO.BoxShape.call(this,t,e,o,i),this.type=OIMO.SHAPE_HOLEY_BOX,this.holes=n,this.floorThickness=0,this.holeIndexes={},this.xsideIndex=-1,this.ysideIndex=-1,this.zsideIndex=-1,this.xsideIndexNeg=-1,this.ysideIndexNeg=-1,this.zsideIndexNeg=-1,this.updateHoles()},OIMO.CollisionInfo=function(){this.cx=0,this.cy=0,this.cz=0,this.dx=0,this.dy=0,this.dz=0,this.pen=0},OIMO.tempCollisionInfo=new OIMO.CollisionInfo,OIMO.HoleyBoxShape.prototype=Object.create(OIMO.BoxShape.prototype),OIMO.HoleyBoxShape.prototype.addHole=function(t){-1==this.holes.indexOf(t)&&(this.holes.push(t),this.updateHoles())},OIMO.HoleyBoxShape.prototype.removeHole=function(t){var e=this.holes.indexOf(t);-1<e&&(this.holes.splice(e,1),this.updateHoles())},OIMO.HoleyBoxShape.prototype.updateHoles=function(){this.holes.sort(function(t,e){var o,i,n;return 1==(n=t).xside?o=0:1==n.yside?o=1:1==n.zside?o=2:-1==n.xside?o=3:-1==n.yside?o=4:-1==n.zside&&(o=5),i=o,1==(n=e).xside?o=0:1==n.yside?o=1:1==n.zside?o=2:-1==n.xside?o=3:-1==n.yside?o=4:-1==n.zside&&(o=5),i-o});for(var t=this.holes.length-1;0<=t;t--){var e=this.holes[t];1==e.xside?this.xsideIndex=t:1==e.yside?this.ysideIndex=t:1==e.zside?this.zsideIndex=t:-1==e.xside?this.xsideIndexNeg=t:-1==e.yside?this.ysideIndexNeg=t:-1==e.zside&&(this.zsideIndexNeg=t)}},OIMO.HoleyBoxShape.prototype.getHoleCloseToPoint=function(t,e,o,i,n,s){var a,r=this.holes,c=r.length;this.halfHeight<.15&&n<0&&(n*=-1);var d=0;if(1==i?d=this.xsideIndex:1==n?d=this.ysideIndex:1==s?d=this.zsideIndex:-1==i?d=this.xsideIndexNeg:-1==n?d=this.ysideIndexNeg:-1==s&&(d=this.zsideIndexNeg),-1!=d)for(var p=d;p<c;p++){if(0!=(a=r[p]).zside){if(a.xside!=i||a.yside!=n)break;if(a.zside!=s)continue}else if(0!=a.yside){if(a.xside!=i||a.zside!=s)break;if(a.yside!=n)continue}else if(0!=a.xside){if(a.yside!=n||a.zside!=s)break;if(a.xside!=i)continue}var l,u=t-a.x,y=e-a.y,g=o-a.z;if(0!=a.xside?l=g*g+y*y:0!=a.yside?l=g*g+u*u:0!=a.zside&&(l=u*u+y*y),l<a.radius*a.radius)return a}},OIMO.getSphereHoleCollisionInfo=function(t,e,o,i,n,s,a,r,c,d,p,l,u,y){var g,m,f=t-n,A=e-s,b=o-a,v=n,x=s,C=a;9==y.id&&y.id;var S=.5*c;if(0!=l)g=f*f+A*A,v=f*(m=1/Math.sqrt(g))*r,x=A*m*r,0<c&&(g=(f=t-(T=n+v+f*m*S))*f+(A=e-(B=s+x+A*m*S))*A+(b=o-(O=a))*b,v=T+f*(m=1/Math.sqrt(g))*S,x=B+A*m*S,C=O+b*m*S);else if(0!=d){if(g=b*b+A*A,x=A*(m=1/Math.sqrt(g))*r,C=b*m*r,0<c)g=(f=t-(T=n))*f+(A=e-(B=s+x+A*m*S))*A+(b=o-(O=a+C+b*m*S))*b,v=T+f*(m=1/Math.sqrt(g))*S,x=B+A*m*S,C=O+b*m*S}else if(0!=p){var T,B,O;if(g=f*f+b*b,v=f*(m=1/Math.sqrt(g))*r,C=b*m*r,0<c)g=(f=t-(T=n+v+f*m*S))*f+(A=e-(B=s))*A+(b=o-(O=a+C+b*m*S))*b,v=T+f*(m=1/Math.sqrt(g))*S,x=B+A*m*S,C=O+b*m*S}var P=t-v,M=e-x,I=o-C,N=P*P+M*M+I*I;if(i*i<N)return u.hit=!1,void(u.pen=1);var z=Math.sqrt(N),w=1/z;P*=w,M*=w,I*=w;var _=z-i;u.cx=v,u.cy=x,u.cz=C,u.dx=P,u.dy=M,u.dz=I,u.pen=_,u.hit=!0},OIMO.HoleyBoxSphereCollisionDetector=function(t){OIMO.CollisionDetector.call(this),this.flip=t},OIMO.HoleyBoxSphereCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype),OIMO.notifyHitListeners=function(t,e,o,i,n,s,a,r,c,d,p){if(t&&0<t.length)for(var l=0;l<t.length;l++)t[l](e,o,i,n,s,a,r,c,d)},OIMO.HoleyBoxSphereCollisionDetector.prototype.detectCollision=function(t,e,o){var i,n;if(this.flip?(i=t,n=e):(i=e,n=t),n.id,2<n.depth&&n.depth,1==n.height&&n.height,0!==i.collidesWith&&0!==n.collidesWith&&0!=(n.belongsTo&i.collidesWith)){var s,a,r=i.parent.jointLink;if(r&&(a=(s=r.body.shapes).position,s.radius),!i.actor||!i.actor.stayInsideBodyType||i.actor.stayInsideBodyType==OIMO.SHAPE_HOLEY_BOX){var c=n.halfWidth,d=n.halfHeight,p=n.halfDepth,l=!1;!i.actor&&d>i.radius&&(l=!0),i.actor&&i.actor.stayInsideBody==n.parent&&(l=!0),i.actor&&i.actor.rodent&&i.actor.rodent.isMenuItem;var u,y,g,m,f=n.dimentions,A=i.position,b=A.x,v=A.y,x=A.z,C=n.position,S=C.x,T=C.y,B=C.z,O=i.radius,P=b-S,M=v-T,I=x-B,N=f[0]*P+f[1]*M+f[2]*I,z=f[3]*P+f[4]*M+f[5]*I,w=f[6]*P+f[7]*M+f[8]*I;if(r)var _=a.x-S,R=a.y-T,L=a.z-B,F=f[0]*_+f[1]*R+f[2]*L,D=f[3]*_+f[4]*R+f[5]*L,E=f[6]*_+f[7]*R+f[8]*L;var k,j,V=N,G=z,W=w,Y=0,U=0,X=0,Z=0,q=0,Q=0,J=0;c<N?N=c:N<-c?N=-c:J=1,d<z?z=d:z<-d?z=-d:J|=2,p<w?w=p:w<-p?w=-p:J|=4;n.holes;if(9==i.id&&i.id,l||7==J){var K=c-O,$=-c+O,tt=d-O,et=-d+O+n.floorThickness,ot=p-O,it=-p+O,nt=!1;if(K<N){if(u=-1,g=y=0,m=K-N,Z=c,q=z,Q=w,pt=n.getHoleCloseToPoint(N,z,w,1,0,0)){var st=OIMO.tempCollisionInfo,at=0,rt=-F+c;if(0<(gt=-V+c)&&rt<0){var ht=F-N;at=.18*Math.sin(gt/ht*Math.PI)}OIMO.getSphereHoleCollisionInfo(N,z,w,O,pt.x,pt.y,pt.z,pt.radius,at,1,0,0,st,i),st.pen<0&&(Z=st.cx,q=st.cy,Q=st.cz,u=st.dx,y=st.dy,g=st.dz,m=st.pen,nt=!0)}else m<0&&(nt=!0);nt&&(Y=S+Z*f[0]+q*f[3]+Q*f[6],U=T+Z*f[1]+q*f[4]+Q*f[7],X=B+Z*f[2]+q*f[5]+Q*f[8],P=u*f[0]+y*f[3]+g*f[6],M=u*f[1]+y*f[4]+g*f[7],I=u*f[2]+y*f[5]+g*f[8],i.hitListeners&&OIMO.notifyHitListeners(i.hitListeners,Y,U,X,P,M,I,m,n,null,"test 1"),o.addPoint(Y,U,X,P,M,I,m,this.flip))}else if(N<$){if(u=1,g=y=0,m=N-$,Z=-c,q=z,Q=w,pt=n.getHoleCloseToPoint(N,z,w,-1,0,0)){st=OIMO.tempCollisionInfo,at=0,rt=F+c;if(0<(gt=V+c)&&rt<0){ht=F-N;at=.18*Math.sin(gt/ht*Math.PI)}OIMO.getSphereHoleCollisionInfo(N,z,w,O,pt.x,pt.y,pt.z,pt.radius,at,-1,0,0,st,i),st.pen<0&&(Z=st.cx,q=st.cy,Q=st.cz,u=st.dx,y=st.dy,g=st.dz,m=st.pen,nt=!0)}else m<0&&(nt=!0);nt&&(Y=S+Z*f[0]+q*f[3]+Q*f[6],U=T+Z*f[1]+q*f[4]+Q*f[7],X=B+Z*f[2]+q*f[5]+Q*f[8],P=u*f[0]+y*f[3]+g*f[6],M=u*f[1]+y*f[4]+g*f[7],I=u*f[2]+y*f[5]+g*f[8],i.hitListeners&&OIMO.notifyHitListeners(i.hitListeners,Y,U,X,P,M,I,m,n,null,"test 2"),o.addPoint(Y,U,X,P,M,I,m,this.flip))}if(ot<w){if(y=u=0,g=-1,m=ot-w,Z=N,q=z,Q=p,pt=n.getHoleCloseToPoint(N,z,w,0,0,1)){st=OIMO.tempCollisionInfo,at=0;var ct=-E+p;if(0<(mt=-W+p)&&ct<0){ht=E-w;at=.18*Math.sin(mt/ht*Math.PI)}OIMO.getSphereHoleCollisionInfo(N,z,w,O,pt.x,pt.y,pt.z,pt.radius,at,0,0,1,st,i),st.pen<0&&(Z=st.cx,q=st.cy,Q=st.cz,u=st.dx,y=st.dy,g=st.dz,m=st.pen,nt=!0)}else m<0&&(nt=!0);nt&&(Y=S+Z*f[0]+q*f[3]+Q*f[6],U=T+Z*f[1]+q*f[4]+Q*f[7],X=B+Z*f[2]+q*f[5]+Q*f[8],P=u*f[0]+y*f[3]+g*f[6],M=u*f[1]+y*f[4]+g*f[7],I=u*f[2]+y*f[5]+g*f[8],i.hitListeners&&OIMO.notifyHitListeners(i.hitListeners,Y,U,X,P,M,I,m,n,null,"test 3"),o.addPoint(Y,U,X,P,M,I,m,this.flip))}else if(w<it){if(y=u=0,g=1,m=w-it,Z=N,q=z,Q=-p,pt=n.getHoleCloseToPoint(N,z,w,0,0,-1)){st=OIMO.tempCollisionInfo,ct=E+p;if(0<(mt=W+p)&&ct<0){ht=E-w;at=.18*Math.sin(mt/ht*Math.PI)}OIMO.getSphereHoleCollisionInfo(N,z,w,O,pt.x,pt.y,pt.z,pt.radius,at,0,0,-1,st,i),st.pen<0&&(Z=st.cx,q=st.cy,Q=st.cz,u=st.dx,y=st.dy,g=st.dz,m=st.pen,nt=!0)}else m<0&&(nt=!0);nt&&(Y=S+Z*f[0]+q*f[3]+Q*f[6],U=T+Z*f[1]+q*f[4]+Q*f[7],X=B+Z*f[2]+q*f[5]+Q*f[8],P=u*f[0]+y*f[3]+g*f[6],M=u*f[1]+y*f[4]+g*f[7],I=u*f[2]+y*f[5]+g*f[8],i.hitListeners&&OIMO.notifyHitListeners(i.hitListeners,Y,U,X,P,M,I,m,n,null,"test 4"),o.addPoint(Y,U,X,P,M,I,m,this.flip))}if(tt<z){if(y=-1,g=u=0,m=tt-z,Z=N,q=d,Q=w,pt=n.getHoleCloseToPoint(N,z,w,0,1,0)){st=OIMO.tempCollisionInfo;var dt=-D+d;if(0<(ft=-G+d)&&dt<0){ht=D-z;at=.18*Math.sin(ft/ht*Math.PI)}OIMO.getSphereHoleCollisionInfo(N,z,w,O,pt.x,pt.y,pt.z,pt.radius,at,0,1,0,st,i),st.pen<0&&(Z=st.cx,q=st.cy,Q=st.cz,u=st.dx,y=st.dy,g=st.dz,m=st.pen,nt=!0)}else m<0&&(nt=!0);nt&&(Y=S+Z*f[0]+q*f[3]+Q*f[6],U=T+Z*f[1]+q*f[4]+Q*f[7],X=B+Z*f[2]+q*f[5]+Q*f[8],P=u*f[0]+y*f[3]+g*f[6],M=u*f[1]+y*f[4]+g*f[7],I=u*f[2]+y*f[5]+g*f[8],i.hitListeners&&OIMO.notifyHitListeners(i.hitListeners,Y,U,X,P,M,I,m,n,null,"test 5"),o.addPoint(Y,U,X,P,M,I,m,this.flip))}else if(z<et){if(y=1,g=u=0,m=z-et,Z=N,q=-d,Q=w,pt=n.getHoleCloseToPoint(N,z,w,0,-1,0)){st=OIMO.tempCollisionInfo,dt=D+d;if(0<(ft=G+d)&&dt<0){ht=D-z;at=.18*Math.sin(ft/ht*Math.PI)}OIMO.getSphereHoleCollisionInfo(N,z,w,O,pt.x,pt.y,pt.z,pt.radius,at,0,-1,0,st,i),st.pen<0&&(Z=st.cx,q=st.cy,Q=st.cz,u=st.dx,y=st.dy,g=st.dz,m=st.pen,nt=!0)}else m<0&&(nt=!0);nt&&(Y=S+Z*f[0]+q*f[3]+Q*f[6],U=T+Z*f[1]+q*f[4]+Q*f[7],X=B+Z*f[2]+q*f[5]+Q*f[8],P=u*f[0]+y*f[3]+g*f[6],M=u*f[1]+y*f[4]+g*f[7],I=u*f[2]+y*f[5]+g*f[8],i.hitListeners&&OIMO.notifyHitListeners(i.hitListeners,Y,U,X,P,M,I,m,n,null,"test 6"),o.addPoint(Y,U,X,P,M,I,m,this.flip))}}else{at=0;var pt,lt=0,ut=0,yt=0;if(i.id,I=w<0?p+w:p-w,(P=N<0?c+N:c-N)<(M=z<0?d+z:d-z)?P<I?lt=N<0?-1:1:yt=w<0?-1:1:M<I?ut=z<0?-1:1:yt=w<0?-1:1,0!=lt){var gt;rt=lt*F-c;if(0<(gt=lt*V-c)&&rt<0){ht=lt*V-lt*F;at=.18*Math.sin(gt/ht*Math.PI)}}else if(0!=yt){var mt;ct=yt*E-p;if(0<(mt=yt*W-p)&&ct<0){ht=yt*W-yt*E;at=.18*Math.sin(mt/ht*Math.PI)}}else if(0!=ut){var ft;dt=ut*D-d;if(0<(ft=ut*G-d)&&dt<0){ht=ut*G-ut*D;at=.18*Math.sin(ft/ht*Math.PI)}}if(pt=n.getHoleCloseToPoint(V,G,W,lt,ut,yt)){st=OIMO.tempCollisionInfo;return OIMO.getSphereHoleCollisionInfo(V,G,W,O,pt.x,pt.y,pt.z,pt.radius,at,lt,ut,yt,st,i),void(st.pen<0&&(Z=st.cx,q=st.cy,Q=st.cz,u=st.dx,y=st.dy,g=st.dz,m=st.pen,Y=S+Z*f[0]+q*f[3]+Q*f[6],U=T+Z*f[1]+q*f[4]+Q*f[7],X=B+Z*f[2]+q*f[5]+Q*f[8],P=u*f[0]+y*f[3]+g*f[6],M=u*f[1]+y*f[4]+g*f[7],I=u*f[2]+y*f[5]+g*f[8],i.hitListeners&&OIMO.notifyHitListeners(i.hitListeners,Y,U,X,P,M,I,m,n,null,"test 7, wall="+at+", distSeg="+ht+", dx="+P),o.addPoint(Y,U,X,P,M,I,m,this.flip)))}Y=S+N*f[0]+z*f[3]+w*f[6],U=T+N*f[1]+z*f[4]+w*f[7],X=B+N*f[2]+z*f[5]+w*f[8],0<(k=(P=Y-A.x)*P+(M=U-A.y)*M+(I=X-A.z)*I)&&k<O*O&&(P*=-(j=1/(k=Math.sqrt(k))),M*=-j,I*=-j,i.hitListeners&&OIMO.notifyHitListeners(i.hitListeners,Y,U,X,P,M,I,m,n,null,"test 8"),o.addPoint(b+O*P,v+O*M,x+O*I,P,M,I,k-O,this.flip))}}}},OIMO.HoleySphereShape=function(t,e,o){OIMO.SphereShape.call(this,t,e),this.type=OIMO.SHAPE_HOLEY_SPHERE,this.holes=o,this.wallThickness=0,this.halfWidth=e,this.halfDepth=e,this.halfHeight=e,this.holeIndexes={}},OIMO.HoleySphereShape.prototype=Object.create(OIMO.SphereShape.prototype),OIMO.HoleySphereShape.prototype.addHole=function(t){-1==this.holes.indexOf(t)&&(this.holes.push(t),this.updateHoles())},OIMO.HoleySphereShape.prototype.removeHole=function(t){var e=this.holes.indexOf(t);-1<e&&(this.holes.splice(e,1),this.updateHoles())},OIMO.HoleySphereShape.prototype.updateHoles=function(){this.holes.sort(function(t,e){var o,i,n;return 1==(n=t).xside?o=0:1==n.yside?o=1:1==n.zside?o=2:-1==n.xside?o=3:-1==n.yside?o=4:-1==n.zside&&(o=5),i=o,1==(n=e).xside?o=0:1==n.yside?o=1:1==n.zside?o=2:-1==n.xside?o=3:-1==n.yside?o=4:-1==n.zside&&(o=5),i-o});for(var t=this.holes.length-1;0<=t;t--){var e=this.holes[t];1==e.xside?this.xsideIndex=t:1==e.yside?this.ysideIndex=t:1==e.zside?this.zsideIndex=t:-1==e.xside?this.xsideIndexNeg=t:-1==e.yside?this.ysideIndexNeg=t:-1==e.zside&&(this.zsideIndexNeg=t)}},OIMO.HoleySphereShape.prototype.getHoleCloseToPoint=function(t,e,o,i,n,s){var a,r=this.holes,c=r.length;if(1==c)return this.holes[0];this.halfHeight<.15&&n<0&&(n*=-1);var d=0;if(1==i?d=this.xsideIndex:1==n?d=this.ysideIndex:1==s?d=this.zsideIndex:-1==i?d=this.xsideIndexNeg:-1==n?d=this.ysideIndexNeg:-1==s&&(d=this.zsideIndexNeg),-1!=d)for(var p=d;p<c;p++){if(0!=(a=r[p]).zside){if(a.xside!=i||a.yside!=n)break;if(a.zside!=s)continue}else if(0!=a.yside){if(a.xside!=i||a.zside!=s)break;if(a.yside!=n)continue}else if(0!=a.xside){if(a.yside!=n||a.zside!=s)break;if(a.xside!=i)continue}var l,u=t-a.x,y=e-a.y,g=o-a.z;if(0!=a.xside?l=g*g+y*y:0!=a.yside?l=g*g+u*u:0!=a.zside&&(l=u*u+y*y),l<a.radius*a.radius)return a}},OIMO.HoleySphereSphereCollisionDetector=function(t){OIMO.CollisionDetector.call(this),this.flip=t},OIMO.HoleySphereSphereCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype);var z0,holeySphereCollisionDetector=function(t,e,o){var i,n;if(this.flip?(n=e,i=t):(n=t,i=e),i.parent.stayInsideBody,n.parent.stayInsideBody,0!==i.collidesWith&&0!==n.collidesWith&&0!=(i.belongsTo&n.collidesWith)){var s=1;null!=i.collisionFrac&&(s=i.collisionFrac);var a=!1;if(i.parent.stayInsideBody==n.parent&&(a=!0),i.actor&&i.actor.stayInsideBody==n.parent&&(a=!0),!n.parent.stayInsideBody||a){var r,c=i.position,d=n.position,p=c.x-d.x,l=c.y-d.y,u=c.z-d.z,y=p*p+l*l+u*u,r1=i.radius*s,r2=1*n.radius,g=r1+r2,m=n.holes,f=i.position,A=f.x,b=f.y,v=f.z,x=n.position,C=x.x,S=x.y,T=x.z,B=n.rotation.elements;if(m&&0<m.length){var O=A-C,P=b-S,M=v-T,I=B[0]*O+B[1]*P+B[2]*M,N=B[3]*O+B[4]*P+B[5]*M,z=B[6]*O+B[7]*P+B[8]*M;if(1==m.length){var w=n.holes[0],_=void 0;0!=w.xside?_=z*z+N*N:0!=w.yside?_=z*z+I*I:0!=w.zside&&(_=I*I+N*N),_<w.radius*w.radius&&(r=w)}}if(r){var R=OIMO.tempCollisionInfo,L=n.wallThickness,F=A-C,D=b-S,E=v-T,k=(I=B[0]*F+B[1]*D+B[2]*E,N=B[3]*F+B[4]*D+B[5]*E,z=B[6]*F+B[7]*D+B[8]*E,i.parent.jointLink);if(k){var j=k.body.shapes.position,V=j.x-C,G=j.y-S,W=j.z-T,Y=B[0]*V+B[1]*G+B[2]*W,U=I+r2;if(0<U&&Y+r2<0){var X=Y-I,Z=.18*Math.sin(U/X*Math.PI);L<Z&&(L=Z)}}if(OIMO.getSphereHoleCollisionInfo(I,N,z,i.radius,r.x,r.y,r.z,r.radius,L,r.xside,r.yside,r.zside,R,i),R.pen<0){var q=R.cx,Q=R.cy,J=R.cz,K=R.dx,$=R.dy,tt=R.dz,et=R.pen,ot=C+q*B[0]+Q*B[3]+J*B[6],it=S+q*B[1]+Q*B[4]+J*B[7],nt=T+q*B[2]+Q*B[5]+J*B[8],st=K*B[0]+$*B[3]+tt*B[6],at=K*B[1]+$*B[4]+tt*B[7],rt=K*B[2]+$*B[5]+tt*B[8];i.hitListeners&&OIMO.notifyHitListeners(i.hitListeners,ot,it,nt,st,at,rt,et,n,null,"test 1"),o.addPoint(ot,it,nt,st,at,rt,et,this.flip)}}else if(a){var ht=r2-r1-n.wallThickness;if(y<ht*ht)return;var ct=1/(y=Math.sqrt(y));p*=-ct,l*=-ct,u*=-ct;et=y-ht;o.addPoint(d.x+p*r2,d.y+l*r2,d.z+u*r2,+p,+l,+u,-et,this.flip)}else if(0<y&&y<g*g){var dt=1/(y=Math.sqrt(y));p*=dt,l*=dt,u*=dt,o.addPoint(c.x+p*r1,c.y+l*r1,c.z+u*r1,p,l,u,y-g,this.flip)}}}};OIMO.HoleySphereSphereCollisionDetector.prototype.detectCollision=holeySphereCollisionDetector,OIMO.HoleySphereHoleySphereCollisionDetector=function(){OIMO.CollisionDetector.call(this)},OIMO.HoleySphereHoleySphereCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype),OIMO.SpiralSlideShape=function(t,e,o,i){OIMO.Shape.call(this,t),this.spiralRadius=e,this.length=2*Math.PI*e;var n=o/this.length;1<n?n=1:n<-1&&(n=-1),this.slopeAngle=Math.asin(n),this.slideRadius=i,this.height=o,this.elements=new OIMO_ARRAY_TYPE(24),this.type=OIMO.SHAPE_SPIRAL_SLIDE},OIMO.SpiralSlideShape.prototype=Object.create(OIMO.Shape.prototype),OIMO.SpiralSlideShape.prototype.calculateMassInfo=function(t){var e=this.spiralRadius-this.slideRadius,o=this.spiralRadius+this.slideRadius,h=this.height+this.slideRadius,i=Math.PI*o*o*h,n=Math.PI*e*e*h,s=this.density*(i-n),a=s/12*(3*(o*o+e*e)+h*h),r=.5*s*(o*o+e*e);t.mass=s,t.inertia.init(a,0,0,0,a,0,0,0,r)},OIMO.SpiralSlideShape.prototype.updateProxy=function(){var t=this.rotation.elements,e=this.spiralRadius+this.slideRadius,o=this.position.x,i=this.position.y,n=this.position.z,s=this.height,a=s*t[1]+o,r=s*t[4]+i,c=s*t[7]+n,d=0*t[1]+o,p=0*t[4]+i,l=0*t[7]+n,u=d,y=a,g=p,m=r,f=l,A=c;a<d&&(u=a,y=d),r<p&&(g=r,m=p),c<l&&(f=c,A=l);var b=.005+e;this.aabb.init(u-b,y+b,g-b,m+b,f-b,A+b),null!==this.proxy&&this.proxy.update()},OIMO.SpiralSlideSphereCollisionDetector=function(t){OIMO.CollisionDetector.call(this),this.flip=t},OIMO.SpiralSlideSphereCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype),OIMO.SpiralSlideSphereCollisionDetector.prototype.tempVec1=new OIMO.Vec3,OIMO.SpiralSlideSphereCollisionDetector.prototype.tempVec2=new OIMO.Vec3,OIMO.SpiralSlideSphereCollisionDetector.prototype.tempVec3=new OIMO.Vec3,OIMO.SpiralSlideSphereCollisionDetector.prototype.tempQuat=new OIMO.Quat,OIMO.SpiralSlideSphereCollisionDetector.prototype.detectCollision=function(t,e,o){var i,n;this.flip?(i=e,n=t):(i=t,n=e);var s=n.radius,a=i.spiralRadius,r=i.slideRadius,c=a+r,d=i.height,p=i.position,l=n.position,u=l.x-p.x,y=l.y-p.y,g=l.z-p.z,m=i.rotation.elements,f=u*m[0]+y*m[3]+g*m[6],A=u*m[1]+y*m[4]+g*m[7],b=u*m[2]+y*m[5]+g*m[8];if(!(d<A-s||A+s<-r)){var v=c+s;if(!(v*v<f*f+b*b)){var x,C,S,T,B,O,P,M,I,N,z,w,_,R=2*Math.PI,L=Math.atan2(b,f);L+=.5*Math.PI,isNaN(L);var F=(L=(L=(L%R+R)%R)<0?L+R:L)/R*d;if(!(F<A-s||A+s<F-r)){var D=f*f+b*b;if(0!=D){var E=1/Math.sqrt(D),k=f*E,j=b*E,V=k*a,G=F,W=j*a,Y=this.tempVec3;Y.x=-k,Y.y=0,Y.z=-j;var U=this.tempQuat;U.setFromAxisAngle(Y,i.slopeAngle);var X=this.tempVec2;X.x=0,X.y=1,X.z=0,X.applyQuaternion(U);var Z=this.tempVec1;Z.cross(X,Y);var q=f-V,Q=A-G,J=b-W,K=q*Z.x+Q*Z.y+J*Z.z,$=q*X.x+Q*X.y+J*X.z,tt=q*Y.x+Q*Y.y+J*Y.z,et=$*$+tt*tt,ot=r-s;if(!(et<ot*ot)){var it=Math.sqrt(et),nt=1/it;M=K,I=-(C=-$*nt)*r,N=-(S=-tt*nt)*r,T=ot-it,z=(x=0)*Z.x+C*X.x+S*Y.x,w=x*Z.y+C*X.y+S*Y.y,_=x*Z.z+C*X.z+S*Y.z,C=w,S=_,z=(x=z)*m[0]+C*m[1]+S*m[2],w=x*m[3]+C*m[4]+S*m[5],_=x*m[6]+C*m[7]+S*m[8],B=M*Z.x+I*X.x+N*Y.x,O=M*Z.y+I*X.y+N*Y.y,P=M*Z.z+I*X.z+N*Y.z,I=O+=G,N=P+=W,B=(M=B+=V)*m[0]+I*m[1]+N*m[2],O=M*m[3]+I*m[4]+N*m[5],P=M*m[6]+I*m[7]+N*m[8],B+=p.x,O+=p.y,P+=p.z,isNaN(B),o.addPoint(B,O,P,z,w,_,T,this.flip)}}}}}},function(t){var e=function(){function Controller(){}return Controller.z4=[BABYLON.Vector3.Zero()],Controller}();t.Controller=e}(z0||(z0={})),function(t){var e=function(){function z1092PanelConfig(){this.maxObjects=0}return z1092PanelConfig.prototype.initObjectPool=function(t){},z1092PanelConfig.prototype.getSceneFileNames=function(t){},z1092PanelConfig.prototype.getCreateMeshFunctions=function(t){t.menuButtonSmall=this._createMeshes},z1092PanelConfig.prototype._createMeshes=function(t,e){var o=BABYLON.MeshBuilder.CreatePlane("",{size:1},t);t.removeMesh(o),e.menuButtonSmall=o},z1092PanelConfig.prototype.getSPSData=function(t){},z1092PanelConfig}();t.App.AddEntityConfig(new e)}(z0||(z0={})),function(O){var t=function(){function z1032(t){this.position=BABYLON.Vector3.Zero(),this.accessories=[],this.menuItemInfos=[],this.maxAccessories=100,this.isCentered=!1,this._rotationMatrix=BABYLON.Matrix.Identity(),this._rotationMatrixInverted=BABYLON.Matrix.Identity(),this._rotationQuaternion=BABYLON.Quaternion.Identity(),this._rotation=BABYLON.Vector3.Zero(),this._height=0,this._width=0,this._center=BABYLON.Vector3.Zero(),this.body=null,this.disableCountLabels=!1,this._tempPosition=BABYLON.Vector3.Zero(),this._index=0,this._currentX=0,this.targetX=0,this.offsetX=0,this._scale=1,this._isOnScene=!0,this._firstLoad=!0;z2.Helpers.ObjectPool;this.renderingGroupID=t}return z1032.prototype.getMenuItemPosition=function(t){if(this.mesh){var e=this.menuItemInfos[t];return this._tempPosition.x=e.x,this._tempPosition.y=e.y,this._tempPosition.z=e.z,this._tempPosition}return this.accessories[t].position},z1032.prototype.getMenuItemCoutLabelPosition=function(t){var e=this.menuItemInfos[t];return this.mesh?(this._tempPosition.x=e.x+e.countLabelX,this._tempPosition.y=e.y+e.countLabelY,this._tempPosition.z=e.z+e.countLabelZ):(this._tempPosition.copyFrom(this.accessories[t].position),this._tempPosition.x+=e.countLabelX,this._tempPosition.y+=e.countLabelY,this._tempPosition.z+=e.countLabelZ),this._tempPosition},Object.defineProperty(z1032.prototype,"currentX",{get:function(){return this._currentX},set:function(t){this._currentX=t},enumerable:!1,configurable:!0}),Object.defineProperty(z1032.prototype,"minAccPosX",{get:function(){return this.accessories[0].position.x},enumerable:!1,configurable:!0}),Object.defineProperty(z1032.prototype,"maxAccPosX",{get:function(){return this.accessories[this.accessories.length-1].position.x},enumerable:!1,configurable:!0}),Object.defineProperty(z1032.prototype,"currentIndex",{get:function(){return this._index},set:function(t){if(!(t>=this.menuItemInfos.length||t<0||t==this._index)){var e=this.accessories;this.targetX=e[t].position.x,this._index=t}},enumerable:!1,configurable:!0}),z1032.prototype.updateIndexByCurrentX=function(){var t=this.currentX,e=this.accessories;if(t<=e[0].position.x)this.currentIndex=0;else{for(var o=0;o<e.length-1;o++){var i=e[o].position.x,n=e[o+1].position.x;if(i<=t&&t<n){var s=t-i,a=n-t;return void(this.currentIndex=s<a?o:o+1)}}this.currentIndex=e.length-1}},Object.defineProperty(z1032.prototype,"transNode",{get:function(){return this._transNode},enumerable:!1,configurable:!0}),Object.defineProperty(z1032.prototype,"hidden",{get:function(){return!this._isOnScene},enumerable:!1,configurable:!0}),Object.defineProperty(z1032.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(z1032.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(z1032.prototype,"scale",{get:function(){return this._scale},enumerable:!1,configurable:!0}),z1032.prototype.setPosition=function(t){var e=this.position,o=t.x-e.x,i=t.y-e.y,n=t.z-e.z;if(this.mesh){this._transNode.position.x=t.x,this._transNode.position.y=t.y,this._transNode.position.z=t.z;for(var s=0;s<this.accessories.length;s++){this.accessories[s].mesh.computeWorldMatrix(!0)}}else for(s=0;s<this.accessories.length;s++)this.accessories[s].translate(o,i,n);this.position.copyFrom(t);var a=z1032.tempVecs[3];a.x=.5*this._width,a.y=0,a.z=0,BABYLON.Vector3.TransformCoordinatesToRef(a,this._rotationMatrix,a),this._center.x=t.x+a.x,this._center.y=t.y+a.y,this._center.z=t.z+a.z,a.x=0,a.y=0,a.z=2,BABYLON.Vector3.TransformCoordinatesToRef(a,this._rotationMatrix,a),this._selectedItem&&this.selectz1092(this._selectedItem)},z1032.prototype.setRotation=function(t,e,o){this._rotation.x=t,this._rotation.y=e,this._rotation.z=o;var i=z1032.tempVecs[4],n=z1032.tempQuats[0];BABYLON.Quaternion.RotationYawPitchRollToRef(e,t,o,n);var s=z1032.tempQuats[1];s.x=-this._rotationQuaternion.x,s.y=-this._rotationQuaternion.y,s.z=-this._rotationQuaternion.z,s.w=this._rotationQuaternion.w;var a,r=n.multiply(s);this._rotationQuaternion.copyFrom(n),this._rotationQuaternion.toRotationMatrix(this._rotationMatrix);var c=z1032.tempQuats[2];if(this.mesh)this._transNode.rotation.x=t,this._transNode.rotation.y=e,this._transNode.rotation.z=o;else for(var d=0;d<this.accessories.length;d++)a=this.accessories[d],i.x=a.position.x-this._center.x,i.y=a.position.y-this._center.y,i.z=a.position.z-this._center.z,0==d&&i.z,BABYLON.Vector3.TransformCoordinatesToRef(i,this._rotationMatrixInverted,i),BABYLON.Vector3.TransformCoordinatesToRef(i,this._rotationMatrix,i),i.x+=this._center.x,i.y+=this._center.y,i.z+=this._center.z,a.setPosition(i.x,i.y,i.z),r.multiplyToRef(a.rotationQuaternion,c),c.toEulerAnglesToRef(i),a.setRotation(i.x,i.y,i.z);BABYLON.Vector3.TransformCoordinatesToRef(i,this._rotationMatrixInverted,i),BABYLON.Vector3.TransformCoordinatesToRef(i,this._rotationMatrix,i),i.x+=this._center.x,i.y+=this._center.y,i.z+=this._center.z,this._rotationMatrix.invertToRef(this._rotationMatrixInverted),this._selectedItem&&this.selectz1092(this._selectedItem)},z1032.prototype.setScale=function(t){this._scale=t},z1032.prototype.addz1092=function(t,e){var o=t.mesh,i=t.meshes;if((o||i||t.shape)&&!this.mesh){var n=O.app.graphicsHelper.scene;if(this.mesh=new BABYLON.Mesh("accessoryPanel",n),this._transNode=new BABYLON.TransformNode("accTransNode",n),n.removeMesh(this.mesh),this.mesh.parent=n.activeCamera,1!=this._scale&&this._scale,this.mesh.scaling.x=this._scale,this.mesh.scaling.y=this._scale,this.mesh.scaling.z=this._scale,o?this.mesh.renderingGroupId=o.renderingGroupId:i&&i[0]?this.mesh.renderingGroupId=i[0].renderingGroupId:t.shape&&t.shape.sourceMesh&&(this.mesh.renderingGroupId=t.shape.sourceMesh.renderingGroupId),this._transNode.parent=this.mesh,e.transNodeScale){var s=e.transNodeScale;this._transNode.scaling.x=s,this._transNode.scaling.y=s,this._transNode.scaling.z=s}}if(o)o.parent=this._transNode;else if(i)for(var a=0;a<i.length;a++)i[a].parent=this._transNode;else t.shape&&t.setParentMesh(this._transNode);if(e&&e.createBodyContainer)if(this.body)this.body;else{var r=[1,.4,.2,O.App.z1033Menu,O.App.z1034Menu|O.App.z1033Menu],c=O.app.world,d=e.offsetX,p=e.offsetY+1,l=e.offsetZ;this.body=new OIMO.Body({holes:[],size:[6,2,2],pos:[d,p,l],rot:[0,0,0],world:c,config:r,type:"holey_box"}).body}var u,y=this.position,g=0,m=0,f=1,A=1,b=1;this._transNode&&(f=1/this._transNode.scaling.x,A=1/this._transNode.scaling.y,b=1/this._transNode.scaling.z);var v=this.accessories,x=this.menuItemInfos;if(0<=v.indexOf(t)){for(a=0;a<this.accessories.length;a++)if(t==this.accessories[a]){e=this.menuItemInfos[a];t.setPosition(e.x,e.y,e.z),this.hidden||t.addToScene();break}}else{var C,S;t.setScale(e.scale,e.scale,e.scale),e.rotation&&t.setRotation(e.rotation.x,e.rotation.y,e.rotation.z),v.unshift(t),x.unshift(e),v.length>this.maxAccessories&&(v[v.length-1].removeFromScene(),v.length=this.maxAccessories,x.length=this.maxAccessories),e.menuHeight>this._height+1&&(this._height=e.menuHeight+1);var T=e.menuWidth+.5;g=.5*e.menuWidth+y.x,e.offsetX&&(g+=e.offsetX,0<e.offsetX&&(T+=e.offsetX,e.menuX=e.offsetX)),m=y.y,e.offsetY&&(m+=e.offsetY),u=y.z+e.offsetZ,t.setPosition(g*f,m*A,u*b),e.x=g*f,e.y=m*A,e.z=u*b;var B=e.menuWidth;for(a=1;a<this.accessories.length;a++)C=this.accessories[a],S=this.menuItemInfos[a],C.translate(T*f,0,0),S.x+=T*f,B+=S.menuWidth+.5,this.mesh?S.menuX+=T:S.menuX+=T*f;this._width=B,this.body&&(this.body.shapes.halfWidth=.5*B),this.currentX=this.accessories[0].position.x,this.targetX=this.currentX}},z1032.prototype.getz1092ByClassName=function(t){for(var e=t.toLowerCase(),o=0;o<this.accessories.length;o++)if(this.accessories[o]._className==e)return this.accessories[o]},z1032.prototype.selectz1092ByName=function(t){for(var e=t.toLowerCase(),o=0;o<this.accessories.length;o++)if(this.accessories[o].shapeName.toLowerCase()==e)return this.selectz1092(this.accessories[o]),this.parent&&this.parent.selectz1092(this.parentz1092),this.show(),!0;return!1},z1032.prototype.getSelectedItem=function(){return this._selectedItem},z1032.prototype.selectz1092=function(t){this._selectedItem=t||null},z1032.prototype.show=function(){if(!this._isOnScene){var t;this.mesh&&this.mesh.getScene().addMesh(this.mesh);for(var e=0;e<this.accessories.length;e++)(t=this.accessories[e]).isMenuItem&&(t.addToScene(),t.update&&t.update());this._isOnScene=!0,this.parent&&this.parent.show()}},z1032.prototype.update=function(){this.currentX+=.05*(this.targetX-this.currentX)},z1032.prototype.hide=function(){if(this._isOnScene){var t;this.mesh&&this.mesh.getScene().removeMesh(this.mesh,!0);for(var e=0;e<this.accessories.length;e++)(t=this.accessories[e]).isMenuItem&&t.removeFromScene();this._isOnScene=!1}},z1032.tempVecs=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],z1032.tempQuats=[BABYLON.Quaternion.Identity(),BABYLON.Quaternion.Identity(),BABYLON.Quaternion.Identity()],z1032}();O.z1032=t}(z0||(z0={})),function(f){var t=function(){function Background(){this.num=0,this.width=0,this.height=0,this.drawFuncs={},this.enabled=!1,this._bgColorHex="",this._textureColorHex="",this._bgColorRGB="",this._fgColorRGB="",this.bgColor3=new BABYLON.Color3(235/255,235/255,235/255),this.patternName="",this._clearColor=new BABYLON.Color4,this._options={},this._colors={},Background.num++,this.num=Background.num,Background.activeObjects.push(this),this._colors.background=this.bgColor3}return Object.defineProperty(Background.prototype,"colorHex",{get:function(){return this._bgColorHex},set:function(t){this.setColorHex(t)},enumerable:!1,configurable:!0}),Background.prototype.setColor3=function(t){this.bgColor3.copyFrom(t),this._bgColorHex=f.z1073.GetHexFromColor3(t),this._updateRGBColors()},Background.prototype.setColorHex=function(t){f.z1073.SetColor3FromHex(t,this.bgColor3),this._bgColorHex=t,this._updateRGBColors()},Background.prototype._updateRGBColors=function(){var t={};f.z1073.setHSLFromColor3(this.bgColor3,t),this._fgColorRGB=f.z1073.HSLToRGB(t.h,t.s,Math.min(1.3*t.l,100)),this._bgColorRGB=f.z1073.HSLToRGB(t.h,t.s,90),this._clearColor.r=this.bgColor3.r,this._clearColor.g=this.bgColor3.g,this._clearColor.b=this.bgColor3.b,this._clearColor.a=1,this._bgColorHex!=this._textureColorHex&&this.setPattern(this.patternName)},Background.prototype.setPosition=function(t,e,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=0);var i=this.mesh;i.unfreezeWorldMatrix(),i.position.x=t,i.position.y=e,i.position.z=o,i.freezeWorldMatrix()},Background.prototype.setRotation=function(t,e,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=0);var i=this.mesh;i.unfreezeWorldMatrix(),i.rotation.x=t,i.rotation.y=e,i.rotation.z=o,i.freezeWorldMatrix()},Background.prototype.init=function(t,e,o,i,n,s,a,r,c,d,p,l,u){if(void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===r&&(r=0),void 0===c&&(c=0),void 0===d&&(d=1),void 0===p&&(p=null),void 0===l&&(l=0),void 0===u&&(u=0),this.scene=t,this._bgColorHex=this.bgColor3.toHexString(),this._updateRGBColors(),!this.mesh){this.mesh=BABYLON.MeshBuilder.CreatePlane("Background",{width:e,height:o},t),this.mesh.useVertexColors=!0,this.width=e,this.height=o,this.mesh.visibility=0;var y=new BABYLON.StandardMaterial("",t);y.diffuseColor.copyFrom(this.bgColor3),y.specularColor.r=0,y.specularColor.g=0,y.specularColor.b=0,this.mesh.material=y,t.removeMesh(this.mesh),f.app.graphicsHelper.addObject(this);var g=this;this.addBackground("none",function(t,e,o){t.fillStyle=g._fgColorRGB,t.fillRect(0,0,e,o)}),this.addBackground("chevrons",function(t,e,o){f.CanvasDraw.DrawChevronPattern(t,e,o,g._bgColorRGB,g._fgColorRGB,.2*o)}),this.addBackground("circles",function(t,e,o){f.CanvasDraw.DrawCircles1Pattern(t,e,o,g._bgColorRGB,g._fgColorRGB,.05*e,4,4)}),this.addBackground("curves",function(t,e,o){f.CanvasDraw.DrawCurves1Pattern(t,e,o,g._bgColorRGB,g._fgColorRGB)}),this.addBackground("paws",function(t,e,o){f.CanvasDraw.DrawPawPattern(t,e,o,g._bgColorRGB,g._fgColorRGB)}),this.addBackground("stripes 1",function(t,e,o){f.CanvasDraw.DrawStripes1Pattern(t,e,o,g._bgColorRGB,g._fgColorRGB)}),this.addBackground("stripes 2",function(t,e,o){f.CanvasDraw.DrawStripes2Pattern(t,e,o,g._bgColorRGB,g._fgColorRGB)}),this.addBackground("squares",function(t,e,o){f.CanvasDraw.DrawSquares1Pattern(t,e,o,g._bgColorRGB,g._fgColorRGB)}),this.addBackground("hearts",function(t,e,o){f.CanvasDraw.DrawHeartsPattern(t,e,o,g._bgColorRGB,g._fgColorRGB)})}var m=this.mesh;this.parent=p,m.rotation.x=a,m.rotation.y=r,m.rotation.z=c,m.position.x=i,m.position.y=n,m.position.z=s,f.app.graphicsHelper.addObject(this)},Background.prototype.addBackground=function(t,e){this._options[t]=new f.PropsMenuOption("0",t,t,null,"radio"),this.drawFuncs[t]=e},Background.prototype.setEnabled=function(t){t!==this.enabled&&(this.enabled=t)},Background.prototype.isEnabled=function(){return this.enabled},Background.prototype.recycle=function(){ObjectPool.recycle(this),this.setEnabled(!1),this.mesh.getScene().removeMesh(this.mesh)},Background.prototype._initProps=function(){for(var t in this._options)this.setOption(t,this._options[t].value)},Background.prototype.setOption=function(t,e){this.setPattern(t)},Background.prototype._onLoadTexture=function(){this.mesh.material.diffuseTexture=this.texture,this.mesh.material.emissiveTexture=this.texture,this.mesh.visibility=1,this.mesh.material.freeze()},Background.prototype.setPattern=function(t){this._bindedOnLoadTexture||(this._bindedOnLoadTexture=this._onLoadTexture.bind(this));var e=this._options[t];if(e){this.selectedOption&&(this.selectedOption.value="0"),e.value="1",this.selectedOption=e,this.mesh.material.unfreeze(),this.texture==this._texture2?this.texture=this._texture1:this.texture=this._texture2;var o=this.texture,i=this.drawFuncs[t],n=t+this._bgColorHex;o?f.CanvasDraw.UpdateTextureFromDrawFunction(o,i,n,256,256,this._bindedOnLoadTexture):((o=f.CanvasDraw.CreateTextureFromDrawFunction(i,n,this.scene,256,256,this._bindedOnLoadTexture)).uScale=this.width,o.vScale=this.height,this.texture=o,this._texture1?this._texture2=o:this._texture1=o),this.patternName=t,this._textureColorHex=this._bgColorHex,f.app.graphicsHelper.scene.clearColor=this._clearColor}},Background.prototype.getOptions=function(){return this._options},Background.prototype.getColors=function(){return this._colors},Background.num=0,Background.activeObjects=[],Background}();f.Background=t}(z0||(z0={})),function(f){var t=function(){function z1063(t,e,o){var s=this;this.menuDataDict={},this.pubsub=new Pubsub,this.tempColor=new BABYLON.Color3,this.accPosStartDrag=BABYLON.Vector3.Zero(),this.accPosition=BABYLON.Vector3.Zero(),this._menuButtons=[],this.selectedAccCat="",this.selectColor=BABYLON.Color3.Green(),this.colorPicker2=void 0,this.propsMenu=void 0,this.bgPatternMenu=void 0,this._dragAreaX=0,this._dragAreaY=0,this._validDropArea=!0,this._stackedDivs=[],this.pointerInRecycleArea=!1,this.offsetDrag=BABYLON.Vector2.Zero(),this.offsetDragFromMenu=BABYLON.Vector2.Zero(),this.tempVec2=BABYLON.Vector3.Zero(),this.tempVec3=BABYLON.Vector3.Zero(),this.tempVec4=BABYLON.Vector3.Zero(),this.bindedUpdateEditMenuPosition=void 0,this._bindedUpdateEditMenuPositionForHam=null,this._active=!1,this.onBJSPointerUp=function(t,e){if(f.app.pointerDownHasMoved,e)if(e.isMenuItem)s.onMenuItemSelected(t,e);else{var o=e;if(void 0!==o.placementType&&null!==o.placementType||o.parent&&(null!=o.parent.placementType?o=o.parent:o.parent.parent&&null!=o.parent.parent.placementType&&(o=o.parent.parent)),o.accType){if(s.buildMenu.isVisible&&s.buildMenu.activez1092Menu&&!s.buildMenu.activez1092Menu.hidden){var i=s.graphicsHelper.canvas,n=s.buildMenu.topMenuBackgroundY;if(i.height-t.event.clientY<n)return;s.accMenuWasOpen=!1,s.buildMenu.hidez1092Menu(!0)}s.buildMenu.isVisible&&s.selectz1092(o)}else o.physics&&o.bones&&s.selectz1062(o)}},this.onBJSPointerDown=function(t,e){if(s.buildMenu.isVisible&&s.buildMenu.activez1092Menu&&!s.buildMenu.activez1092Menu.hidden){var o=s.graphicsHelper.canvas;s.buildMenu.topMenuBackgroundY<o.height-t.event.clientY&&(s.accMenuWasOpen=!1,s.buildMenu.hidez1092Menu(!0),s.selectedMenuItem=null)}if(s.selectedMenuItem&&s.selectedMenuItem.isMenuItem&&s.colorPicker2.hide(),e){var i=e;void 0!==i.placementType&&null!==i.placementType||i.parent&&(null!=i.parent.placementType?i=i.parent:i.parent.parent&&null!=i.parent.parent.placementType&&(i=i.parent.parent)),i.accType?s.accToEdit==i&&i.onPointerDown&&i.onPointerDown(t,e):i.physics||(s.colorPicker2.hide(),s.deselectz1092())}},this.onPointerDownLong=function(t,e){e&&!e.isMenuItem&&(e.shapeName||e.physics&&(e==s.hamToEdit||s.selectz1062(e)))},this._pointerDown=!1,this._pointerDownOverHam=!1,this.pointerX=0,this.pointerY=0,this._bindedOnDocPointerDown=null,this._bindedOnDocPointerUp=null,this._bindedOnDocPointerMove=null,this._bindedOnTitleInputLostFocus=null,this.menuDataArr=t;var i=(this.graphicsHelper=e).scene;this.scene=i;for(var n=0;n<t.length;n++)this.menuDataDict[t[n].objectName.toLocaleLowerCase()]=t[n];this.background=o,this.createGUI(),this._banIcon=document.getElementById("icon-ban"),this._bindedOnDocPointerDown=this.onDocPointerDown.bind(this),this._bindedOnDocPointerUp=this.onDocPointerUp.bind(this),this._bindedOnDocPointerMove=this.onDocPointerMove.bind(this),this._bindedOnTitleInputLostFocus=this.onTitleInputLostFocus.bind(this)}return Object.defineProperty(z1063.prototype,"accToAddName",{get:function(){return this._accToAddName},set:function(t){this._accToAddName=t},enumerable:!1,configurable:!0}),Object.defineProperty(z1063.prototype,"zoomLevel",{get:function(){return f.app.zoomLevel},enumerable:!1,configurable:!0}),z1063.prototype.getSelectedz1062=function(){return this.hamToEdit},z1063.prototype.getSelectedz1092=function(){return this.accToEdit},z1063.prototype.makeDivTop=function(t){if(this._stackedDivs[this._stackedDivs.length-1]!=t){var e=this._stackedDivs.indexOf(t);0<=e&&this._stackedDivs.splice(e,1),this._stackedDivs.push(t);for(var o=0;o<this._stackedDivs.length;o++)this._stackedDivs[o].style.zIndex=o+1}},z1063.prototype.onNodesUpdated=function(t){this.pubsub.broadcast(z1063.NODES_UPDATED,t)},z1063.prototype.createGUI=function(){this._createHTML(),new z1081("#parts-cat-ctn"),this.buildMenu=new f.z1064(this.menuDataArr,this.graphicsHelper),this.pubsub.subscribe(z1063.ACCESSORY_DRAG_START,this.hideBottomMenu,this),this.pubsub.subscribe(z1063.ACCESSORY_DRAG_STOP,this.showBottomMenu,this);var s=this,t=!1;this.subscribe(z1063.ACCESSORY_DRAG_START,function(){s.buildMenu.isVisible?(s.buildMenu.hide(),t=!0):t=!1},this),this.subscribe(z1063.ACCESSORY_DRAG_STOP,function(){t&&s.buildMenu.show()},this);s=this;this.buildMenu.subscribe(f.z1064.SHOW,function(t){s.selectedAccCat=t,s.selectedMenuItem&&s.hideControls()}),this.buildMenu.subscribe(f.z1064.NEXT,function(){s.selectedMenuItem&&s.hideControls()}),this.buildMenu.subscribe(f.z1064.PREV,function(){s.selectedMenuItem&&s.hideControls()}),this.buildMenu.subscribe(f.z1064.MOVED,function(){s.selectedMenuItem&&s.updateEditMenuPosition()}),this._accEditMenu=document.getElementById("edit-menu"),this._accEditMenu.addEventListener("pointerdown",function(t){var e=t.target,o=e.parentNode.children;if(o)if(e==o[4])s.togglePropsMenu();else if(e==o[1])s.toggleColorPicker();else if(e==o[2])s.rotatePart();else if(e==o[0])s.translatePart(t);else if(e==o[3]){var i=s.accToEdit;if(i.accType==f.z1044.z1048){var n=i;n.bedding?(n.bedding.pubsub.unsubscribe(f.Bedding.NODES_UPDATED,s.onNodesUpdated,s),n.removeBedding()):(n.addBedding(),n.bedding.pubsub.subscribe(f.Bedding.NODES_UPDATED,s.onNodesUpdated,s))}}});var e=this._accEditMenu;this._menuButtons["translate-edit"]=e.children[0],this._menuButtons["paint-edit"]=e.children[1],this._menuButtons["rotate-edit"]=e.children[2],this._menuButtons["bedding-edit"]=e.children[3],this._menuButtons["fur-edit"]=e.children[4],this._accAddMenu=document.getElementById("add-menu"),e=this._accAddMenu,this._menuButtons["translate-add"]=e.children[0],this._menuButtons["paint-add"]=e.children[1],this._recycleAreaBG=document.getElementById("recycle-area").children[0];var o=document.body,i=this;this.colorPicker2||(this.colorPicker2=new f.z1065("simple-color-picker"),o.appendChild(this.colorPicker2._rootElement),this.colorPicker2.subscribe(f.z1065.POINTER_DOWN,function(){this.makeDivTop(this.colorPicker2._rootElement)},this)),this.propsMenu||(this.propsMenu=new f.z1066("simple-props-menu"),o.appendChild(this.propsMenu._rootElement),this.propsMenu.pubsub.subscribe(f.z1066.PROP_CHANGED,function(t,e){i.hamToEdit?i.hamToEdit.setOption(t,e):i.selectedMenuItem&&i.selectedMenuItem.setOption(t,e)}),this.propsMenu.subscribe(f.z1066.POINTER_DOWN,function(){this.makeDivTop(this.propsMenu._rootElement)},this)),this.bgPatternMenu||(this.bgPatternMenu=new f.z1066("bg-props-menu"),o.appendChild(this.bgPatternMenu._rootElement),this.bgPatternMenu.pubsub.subscribe(f.z1066.PROP_CHANGED,function(t,e){s.background.setOption(t,e)}),this.bgPatternMenu.updateMenu(this.background.getOptions())),this.hideControls()},z1063.prototype._createHTML=function(){if(!document.getElementById("nav-ctn-parts")){var t=document.getElementById("main"),e=document.body,o=f.z1073.CreateHTMLElementFromString('\n                <div id="close-btn-edit" class="fab">\n                    <span class=\'icon-check\'></span>\n                </div>\n            ');o.addEventListener("click",function(t){var e=f.app.hsm[0];e.changeState(e.history.data[0].name),f.app.removeFromHistory("build")}),t.appendChild(o);var i=document.createElement("div");i.id="nav-ctn-parts",i.innerHTML="\n                <div class='nav-btn-left nav-btn'>\n                <span class=\"icon-angle-left\"></span>\n                </div>\n                <div class='nav-btn-right nav-btn'>\n                <span class=\"icon-angle-right\"></span>\n                </div>\n            ",e.appendChild(i);var n=f.z1073.CreateHTMLElementFromString('<div id="parts-cat-ctn" touch-action="pan-x">');n.innerHTML='\n                <div class="chip" id="bowls">\n                    <span class="icon-bowl"></span>\n                </div>\n                <div class="chip" id="waterbottles">\n                    <span class="icon-waterbottle"></span>\n                </div>\n                <div class="chip" id="cages">\n                    <span class="icon-cage"></span>     \n                </div>\n                <div class="chip" id="houses">\n                    <span class="icon-house"></span>     \n                </div>\n                <div class="chip" id="bridges">\n                    <span class="icon-bridge"></span>\n                </div>\n                <div class="chip" id="tubes">\n                    <span class="icon-tube-straight"></span>        \n                </div>\n                <div class="chip" id="wheels">\n                    <span class="icon-wheel"></span>\n                </div>\n                <div class="chip" id="hams">\n                    <span class="icon-ham2"></span>\n                </div>',e.appendChild(n);var s=document.createElement("div");s.id="edit-menu",s.classList.add("mini-menu"),s.innerHTML='\n                <div><span class="icon-arrows"></span></div>\n                <div><span class="icon-paint-brush"></span></div>\n                <div><span class="icon-repeat"></span></div>\n                <div><span class="icon-bedding"></span></div>\n                <div><span class="icon-options"></span></div>\n            ',t.appendChild(s);var a=document.createElement("div");a.id="add-menu",a.classList.add("mini-menu"),a.innerHTML='\n                <div><span class="icon-arrows"></span></div>\n                <div><span class="icon-paint-brush"></span></div>\n            ',t.appendChild(a);var r=document.createElement("div");r.id="recycle-area",r.innerHTML='\n            <div class="recycle-background"><span class="icon-remove"></span></div>',t.appendChild(r);var c=document.createElement("div");c.id="icon-ban";var d=document.createElement("span");d.classList.add("icon-ban"),c.appendChild(d),t.appendChild(c),this._banIcon=document.getElementById("icon-ban")}},z1063.prototype._onColorChangedz1092=function(t){var e=t.color,o=this.hamToEdit,i=this.accToEdit;o?(o.setColor(e.r,e.g,e.b,t.name),o.propsNeedToBeSaved&&this.pubsub.broadcast(z1063.ACCESSORY_CHANGED,o)):i?(i.setColor(e.r,e.g,e.b,t.name),i.propsNeedToBeSaved&&this.pubsub.broadcast(z1063.ACCESSORY_CHANGED,i)):this.selectedMenuItem&&this.selectedMenuItem.setColor(e.r,e.g,e.b,t.name)},z1063.prototype._onColorChangedBackground=function(t){this.background.setColor3(t.color),f.app.saveDataItem(f.AppSettings.GetInstance())},z1063.prototype.onz1092Drag=function(t){if(this.dragObj){var e=z1063.z4[0],o=this.graphicsHelper,i=o.scene,n=i.pointerX,s=i.pointerY;t&&t.clientX&&(n=t.clientX,s=t.clientY);var a=.5*o.canvas.width,r=a-125,c=a+125,d=!1,p=.1*o.canvas.width,l=.1*o.canvas.height,u=p;l<p&&(u=l),s<125?this.graphicsHelper.moveCameraBorder=u:n<r||c<n?this.graphicsHelper.moveCameraBorder=u:d=!(this.graphicsHelper.moveCameraBorder=0),o.getPlanePositionAtScreenXY(n+this.offsetDrag.x,s+this.offsetDrag.y,this.dragObj.dragPlaneZ,e),this.dragObj.setPositionDrag(e.x,e.y+this.offsetDragFromMenu.y,e.z);var y=z1063.z4[1],g=this._getZPlacementForObj(this.dragObj);o.getPlanePositionAtScreenXY(n+this.offsetDrag.x,s+this.offsetDrag.y,g,y);var m=this.dragObj.mapPlacementInfo,f=m.mapPlacementSizeX,A=m.mapPlacementSizeY;.5<f&&(f=.5),.5<A&&(A=.5);var b=z1.round(y.x+m.mapOffsetDropTargetX,f)+m.mapOffsetX,v=z1.round(y.y+m.mapOffsetDropTargetY,A)+m.mapOffsetY;if(b!=this._dragAreaX||v!=this._dragAreaY){var x=b,C=v+this.offsetDragFromMenu.y,S=y.z,T=this._isValidDrop(this.dragObj,x,C,S);this._validDropArea=!!T}this._validDropArea?this.hideBanIcon():this.showBanIconXY(n-30,Math.max(s-150,0)),this._dragAreaX=b,this._dragAreaY=v;var B=this._recycleAreaBG;d&&s>o.canvas.height-100?(B.classList.add("object-in-area"),this.pointerInRecycleArea=!0,this._validDropArea=!0,this.hideBanIcon()):(B.classList.remove("object-in-area"),this.pointerInRecycleArea=!1)}},z1063.prototype._isValidDrop=function(t,e,o,i){var n=t.isValidDropLocation(e,o,i);if(n){var s=t;if(s.accType==f.z1044.z1049)for(var a=s.getChildren(),r=e-s.position.x,c=o-s.position.y,d=i-s.position.z,p=0;p<a.length;p++){var l=a[p],u=r+l.position.x,y=c+l.position.y,g=d+l.position.z;if(!l.isValidDropLocation(u,y,g,{dragPlatformY:o})){n=!1;break}}}return n},z1063.prototype.showBanIcon=function(t,e){var o=this,i=this.tempVec2;this.graphicsHelper.getScreenPointToRef(t,i);var n=this.zoomLevel;this._validDropArea&&(this._validDropArea=!1,o._banIcon.style.transform="translate3d("+i.x+"px, "+i.y+"px, 0) scale("+n+")"),o._banIcon.style.display="block",e&&setTimeout(function(){o.hideBanIcon(),o._validDropArea=!0},1e3*e)},z1063.prototype.showBanIconXY=function(t,e){var o=this.zoomLevel;this._banIcon.style.transform="translate3d("+t+"px, "+e+"px, 0) scale("+o+")",this._banIcon.style.display="block"},z1063.prototype.hideBanIcon=function(){this._banIcon.style.display="none"},z1063.prototype._getZPlacementForObj=function(t){var e=0,o=t.placementType;return o&f.PlacementType.BACK?e=1.5:o&f.PlacementType.MID?e=0:o&f.PlacementType.FRONT?e=-1.5:o&f.PlacementType.FRONT_GLASS&&(e=-1.7),e},z1063.prototype.onz1092Drop=function(t,e){if(this.dragObj){if(this.pubsub.broadcast(z1063.ACCESSORY_DRAG_STOP),this.hideRecycleArea(),this.pointerInRecycleArea)return this.deletePart(),this._recycleAreaBG.classList.remove("object-in-area"),this.dragObj=null,this.pointerInRecycleArea=!1,void this.buildMenu.updateCounts();var o=this._getZPlacementForObj(this.dragObj),i=z1063.z4[0];f.app.graphicsHelper.getPlanePositionAtScreenXY(t+this.offsetDrag.x,e+this.offsetDrag.y+this.offsetDragFromMenu.y,o,i);var n=void 0,s=this._dragAreaX,a=this._dragAreaY;if(this._dragAreaX,this._dragAreaY,this.accToAddName){if((n=this.dragObj).isValidDropLocation){var r=s,c=a+this.offsetDragFromMenu.y,d=i.z;return this._isValidDrop(this.dragObj,r,c,d)?n.physics?(n.setPositionOnMapFromDrop(s,a,i.z),this.pubsub.broadcast(z1063.ACCESSORY_ADDED,n),this.selectedMenuItem=null,this.hamToEdit=n):n.setPositionOnMapFromDrop?(n.setPositionOnMapFromDrop(s,a+this.offsetDragFromMenu.y,i.z),n.cage||f.app.translateCameraToObject(n),this.accToEdit=n,this.showControls(n),this.pubsub.broadcast(z1063.ACCESSORY_ADDED,n)):n.setPositionDrag(i.x,i.y,i.z,!0):(this.showBanIcon(n.position,1),n.recycle(),this.buildMenu.updateCounts()),this.dragObj=null,void(this.accToAddName=null)}}else if(this.accToEdit){n=this.accToEdit;var p=this.accPosStartDrag.x,l=this.accPosStartDrag.y,u=this.accPosStartDrag.z;r=s,c=a+this.offsetDragFromMenu.y,d=i.z;if(this._isValidDrop(this.dragObj,r,c,d)){if(n.setPositionOnMapFromDrop(s,a+this.offsetDragFromMenu.y,i.z),this.pubsub.broadcast(z1063.ACCESSORY_CHANGED,n),n.objs&&n.objs.length)for(var y=0;y<n.objs.length;y++){var g=n.objs[y];this.pubsub.broadcast(z1063.ACCESSORY_CHANGED,g)}}else this.showBanIcon(i,1),n.isDragging=!1,n.setPositionOnMapFromDrop(p,l,u),this.buildMenu.updateCounts();n.cage||f.app.translateCameraToObject(n),this.showControls(n)}else{var m=this.dragObj;m.isValidDropLocation(s,a,i.z)?(m.setPositionOnMapFromDrop(s,a,i.z),this.pubsub.broadcast(z1063.ACCESSORY_CHANGED,m)):(this.showBanIcon(i,1),m.setPositionDrag(this.accPosStartDrag.x,this.accPosStartDrag.y,this.accPosStartDrag.z,!0),this.buildMenu.updateCounts())}this.dragObj=null}},z1063.prototype.onMenuItemSelected=function(t,e){if(this.deselectz1092(),e.parent&&(e=e.parent),this.selectedMenuItem=e,this.showControls(e),e.getColors){var o=e.getColors();e.physics?this.colorPicker2.updateMenu2(o):this.colorPicker2.updateMenu(o),o||this.colorPicker2.setColor(e.color)}if(e.getOptions){var i=e.getOptions();i&&this.propsMenu.updateMenu(i)}},z1063.prototype._onMenuItemSelected=function(t){var e=this.selectedMenuItem,o=e.getName(),i=z1063.z4[0],n=this.scene;f.app.graphicsHelper.getPlanePositionAtScreenXY(n.pointerX,n.pointerY,e.dragPlaneZ,i);var s=!0,a=!1;e.physics&&(a=!(s=!1),e.recycle());var r=ObjectPool.get(o,{useLastRotateZ:!0,skipAddToScene:!0,z:-100,skipLook:!0});(s&&r.copyLook&&r.copyLook(e),r.addToScene(),(this.dragObj=r).setPositionDrag(i.x,i.y,i.z),this.offsetDrag.x=0,this.offsetDrag.y=0,r.mapPlacementInfo?this.offsetDragFromMenu.y=r.mapPlacementInfo.offsetDragFromMenuY:this.offsetDragFromMenu.y=0,this.onz1092Drag(t),this.pubsub.broadcast(z1063.ACCESSORY_DRAG_START),this.showRecycleArea(),this.hideColorPicker(),this.propsMenu.hide(),a)&&(0<f.z1062.objectCount&&this.buildMenu.refreshMenuItem(f.z1062Config.objName,"hams").bones.hardReset());r&&(this.accToAddName=o,this.deselectz1092())},z1063.prototype.deletePart=function(t){if(t&&(t.recycle(),this.pubsub.broadcast(z1063.ACCESSORY_DELETED,t),this.pubsub.broadcast(z1063.ACCESSORY_CHANGED,t)),this.accToPreview&&(this.accToPreview.recycle(),this.accToPreview=null),this.accToEdit){var e=this.accToEdit;if(e.objs){for(var o=z1063.tempArray,i=o.length=0;i<e.objs.length;i++)o.push(e.objs[i]);for(;o.length;){var n=o.pop();this.deletez1061sInz1092(n),n.recycle(),this.pubsub.broadcast(z1063.ACCESSORY_DELETED,n)}}this.deletez1061sInz1092(this.accToEdit),this.accToEdit.recycle(),this.pubsub.broadcast(z1063.ACCESSORY_DELETED,this.accToEdit),this.accToEdit=null}else if(this.hamToEdit){this.hamToEdit.recycle();var s=this.buildMenu.accessoryMenus.hams.getz1092ByClassName(f.z1062Config.objName);s.isMenuItem?(this.buildMenu.refreshMenuItem(f.z1062Config.objName,"hams"),this.hamToEdit.bones.hardReset(),s.recycle()):(this.buildMenu.refreshMenuItem(f.z1062Config.objName,"hams"),this.hamToEdit.bones.hardReset()),this.pubsub.broadcast(z1063.ACCESSORY_DELETED,this.hamToEdit),this.hamToEdit=null}else if(this.accToAddName){this.dragObj.recycle(),this.accToAddName=null}this.hideControls()},z1063.prototype.deletez1061sInz1092=function(t){for(var e=f.z1062.activeObjects,o=e.length-1;0<=o;){var i=e[o];i.currentObject==t&&(i.recycle(),this.pubsub.broadcast(z1063.ACCESSORY_DELETED,i)),o--}},z1063.prototype.rotatePart=function(){this.accToEdit.rotate(.5*Math.PI),this.accToEdit.limitPosition(),this.pubsub.broadcast(z1063.ACCESSORY_CHANGED,this.accToEdit),this.pubsub.broadcast(z1063.ACCESSORY_ROTATED,this.accToEdit)},z1063.prototype.translatePart=function(t){this.hideControls();var e=this.accToEdit||this.hamToEdit;if(e||!this.selectedMenuItem){this.graphicsHelper;this.accPosStartDrag.copyFrom(e.position),this.dragObj=e;var o=this.tempVec2;this.graphicsHelper.getScreenPointToRef(e.position,o),this.accToEdit||(this.offsetDrag.x=0,this.offsetDrag.y=0),this.onz1092Drag(t),this.showRecycleArea(),this.hideColorPicker(),this.propsMenu.hide(),this.pubsub.broadcast(z1063.ACCESSORY_DRAG_START)}else this._onMenuItemSelected(t)},z1063.prototype.toggleColorPicker=function(){this.colorPicker2.isVisible?this.hideColorPicker():this.showColorPicker()},z1063.prototype.togglePropsMenu=function(){this.propsMenu.isVisible?this.propsMenu.hide():(this.propsMenu.show(),this.makeDivTop(this.propsMenu._rootElement))},z1063.prototype.showColorPicker=function(t){if(t)this.tempColor.copyFrom(BABYLON.Color3.FromHexString(t));else{var e=this.accToEdit||this.hamToEdit||this.selectedMenuItem;this.tempColor.r=e.color.r,this.tempColor.g=e.color.g,this.tempColor.b=e.color.b}this.colorPicker2.show(),this.colorPicker2.unsubscribe(f.z1065.COLOR_CHANGED,this._onColorChangedBackground,this),this.colorPicker2.subscribe(f.z1065.COLOR_CHANGED,this._onColorChangedz1092,this),this.makeDivTop(this.colorPicker2._rootElement)},z1063.prototype.hideColorPicker=function(){this.colorPicker2.hide()},z1063.prototype.showColorPickerForBackGround=function(){this.colorPicker2.unsubscribe(f.z1065.COLOR_CHANGED,this._onColorChangedz1092,this),this.colorPicker2.subscribe(f.z1065.COLOR_CHANGED,this._onColorChangedBackground,this);var t=this.background.getColors();this.colorPicker2.updateMenu(t),t||this.colorPicker2.setColor(this.background.bgColor3),this.colorPicker2.show()},z1063.prototype.showControls=function(t){this.hideControls(),this._accEditMenu.classList.add("is-visible"),t.canTranslate&&this.showControl("translate-edit"),t.canRotate&&!t.isMenuItem&&this.showControl("rotate-edit"),this.showControl("paint-edit"),t.accType!=f.z1044.z1048||t.isMenuItem||this.showControl("bedding-edit"),t.physics&&this.showControl("fur-edit"),this.updateEditMenuPosition(),t.draggerBody?(this.bindedUpdateEditMenuPosition||(this.bindedUpdateEditMenuPosition=this.updateEditMenuPosition.bind(this)),this.graphicsHelper.scene.registerBeforeRender(this.bindedUpdateEditMenuPosition)):(this.graphicsHelper.subscribe(z3.CAMERA_MOVE,this.updateEditMenuPosition,this),this.graphicsHelper.subscribe(z3.SCREEN_RESIZED,this.updateEditMenuPosition,this)),t&&t.accType==f.z1044.z1048&&!t.isMenuItem&&t.bedding&&t.bedding.pubsub.subscribe(f.Bedding.NODES_UPDATED,this.onNodesUpdated,this)},z1063.prototype.hideControls=function(){this._accEditMenu.classList.remove("is-visible"),this.hideControl("translate-edit"),this.hideControl("rotate-edit"),this.hideControl("paint-edit"),this.hideControl("bedding-edit"),this.hideControl("fur-edit"),this.graphicsHelper.scene.unregisterBeforeRender(this.bindedUpdateEditMenuPosition),this.graphicsHelper.unsubscribe(z3.CAMERA_MOVE,this.updateEditMenuPosition,this),this.graphicsHelper.unsubscribe(z3.SCREEN_RESIZED,this.updateEditMenuPosition,this),this.hideColorPicker(),this.propsMenu.hide();var t=this.accToEdit;t&&t.accType==f.z1044.z1048&&t.bedding&&t.bedding.pubsub.unsubscribe(f.Bedding.NODES_UPDATED,this.onNodesUpdated,this)},z1063.prototype.hideControl=function(t){this._menuButtons[t].classList.remove("is-visible")},z1063.prototype.showControl=function(t){this._menuButtons[t].classList.add("is-visible")},z1063.prototype.selectz1062=function(t){if(this.deselectz1092(),this.hamToEdit=t,this.showControls(t),this.offsetDragFromMenu.y=0,this.offsetDragFromMenu.x=0,t.getColors){var e=t.getColors();this.colorPicker2.updateMenu2(e),e||this.colorPicker2.setColor(t.color)}if(t.getOptions){var o=t.getOptions();o&&this.propsMenu.updateMenu(o)}},z1063.prototype.updateEditMenuPosition=function(){var t=this.zoomLevel;if(this.accToEdit&&this.accToEdit.controlAnchor){var e=this._accEditMenu.getBoundingClientRect(),o=this.tempVec2;this.graphicsHelper.getScreenPointToRef(this.accToEdit.controlAnchor.position,o);var i=o.x-.5*e.width;(d=o.y-.5*e.height)<10&&(d=10),this._accEditMenu.style.transform="translate3d("+i+"px, "+d+"px, 0) scale("+t+")"}else if(this.hamToEdit)this.updateEditMenuPositionForHam();else if(this.selectedMenuItem){var n=this.selectedMenuItem,s=(e=this._accEditMenu.getBoundingClientRect(),o=this.tempVec2,this.tempVec4),a=this.tempVec3;if(n.getMeshAbsolutePositionFromLocalToRef){var r=n,c=r.physics.frontBody.body.position;a.x=c.x,a.y=c.y+.3,a.z=c.z,r.mesh.parent&&BABYLON.Vector3.TransformCoordinatesToRef(a,r.mesh.parent.getWorldMatrix(),a)}else this.buildMenu.getMenuPositionToRef(a),s.copyFrom(this.selectedMenuItem.position),this.buildMenu.activez1092Menu&&this.buildMenu.activez1092Menu.mesh&&(this.selectedMenuItem.meshes||this.selectedMenuItem.mesh)&&1!=this.buildMenu.activez1092Menu.mesh.scaling.x&&s.scaleInPlace(this.buildMenu.activez1092Menu.mesh.scaling.x),s.addToRef(a,a),this.selectedMenuItem.controlPositionLocal.addToRef(a,a);this.graphicsHelper.getScreenPointToRef(a,o);i=o.x-.5*e.width;var d=o.y-.5*e.height;this._accEditMenu.style.transform="translate3d("+i+"px, "+d+"px, 0) scale("+t+")"}},z1063.prototype.updateEditMenuPositionForHam=function(){if(this.hamToEdit){var t=this.zoomLevel,e=this._accEditMenu.getBoundingClientRect(),o=this.tempVec2,i=this.tempVec3;i.x=this.hamToEdit.position.x,i.y=this.hamToEdit.position.y+.4,i.z=this.hamToEdit.position.z,this.graphicsHelper.getScreenPointToRef(i,o);var n=o.x-.5*e.width,s=o.y-.5*e.height;this._accEditMenu.style.transform="translate3d("+n+"px, "+s+"px, 0) scale("+t+")"}},z1063.prototype.selectz1092=function(t){if(!this.dragObj&&t!=this.accToEdit){if(this.deselectz1092(),void 0===t.placementType||null===t.placementType){if(!t.parent||null==t.parent.placementType)return;t=t.parent}if(this.accToEdit=t,this.accToAddName=null,this.offsetDragFromMenu.y=t.mapPlacementInfo.offsetDragFromMenuY,this.showControls(t),this.accToEdit.showSelected&&this.accToEdit.showSelected(),this.accPosition.copyFrom(this.accToEdit.position),t.getColors){var e=t.getColors();this.colorPicker2.updateMenu(e),e||this.colorPicker2.setColor(t.color)}if(t.getOptions){var o=t.getOptions();o&&this.propsMenu.updateMenu(o)}}},z1063.prototype.deselectz1092=function(){this.hideControls(),this.accToEdit&&(this.accToEdit.propsNeedToBeSaved&&this.pubsub.broadcast(z1063.ACCESSORY_CHANGED,this.accToEdit),this.accToEdit=null),this.selectedMenuItem,this.hamToEdit&&(this.hamToEdit.propsNeedToBeSaved&&this.pubsub.broadcast(z1063.ACCESSORY_CHANGED,this.hamToEdit),this.hamToEdit.mesh.actionManager=null,this.hamToEdit=null)},Object.defineProperty(z1063.prototype,"isActive",{get:function(){return this._active},enumerable:!1,configurable:!0}),z1063.prototype.hideBottomMenu=function(){this.buildMenu.activez1092Menu&&(this.accMenuWasOpen=!this.buildMenu.activez1092Menu.hidden),this.buildMenu.hidez1092Menu()},z1063.prototype.showBottomMenu=function(){this.selectedAccCat&&this.accMenuWasOpen&&this.buildMenu.showz1092Menu(this.selectedAccCat)},z1063.prototype.showRecycleArea=function(){var t=this._recycleAreaBG.parentNode;t.classList.add("is-visible"),t.style.transform="scale("+this.zoomLevel+")"},z1063.prototype.hideRecycleArea=function(){this._recycleAreaBG.parentNode.classList.remove("is-visible")},z1063.prototype.removeGUI=function(){this.buildMenu.hide(),this._recycleAreaBG.parentNode.classList.remove("is-visible"),this.hideColorPicker(),this.propsMenu.hide()},z1063.prototype.onDocPointerMove=function(t){if(this._pointerDown,this.pointerX=t.x,this.pointerY=t.y,this._pointerDown&&!this.dragObj&&this.hamToEdit){var e=this.hamToEdit;this.scene.pick(this.scene.pointerX,this.scene.pointerY,function(t){return e.mesh==t}).pickedMesh?this._pointerDownOverHam=!0:this._pointerDownOverHam=!1}else this._pointerDownOverHam=!1,this._pointerDown&&this.accToEdit&&this.accToEdit.onPointerMove(t),this.dragObj&&this.onz1092Drag(t)},z1063.prototype.onDocPointerDown=function(){this._pointerDown=!0},z1063.prototype.onDocPointerUp=function(t){this._pointerDown=!1,this.onz1092Drop(t.clientX,t.clientY),this.graphicsHelper.moveCameraBorder=0,this.accToEdit&&this.accToEdit.onPointerUp(t)},z1063.prototype.onTitleInputLostFocus=function(){var t=document.getElementById("title-input");this.pubsub.broadcast(z1063.z1048_TITLE_UPDATED,t.value)},z1063.prototype.enterBuildMode=function(){if(!this._active){f.app.graphicsHelper.subscribe(z3.POINTER_DOWN,f.app.builder.onBJSPointerDown,f.app.builder),f.app.graphicsHelper.subscribe(z3.POINTER_DOWN,f.app.builder.onBJSPointerUp,f.app.builder),this.buildMenu.show();var t=document.getElementById("parts-cat-ctn").querySelector(".selected");t&&this.buildMenu.showz1092Menu(t.id);var e=document.getElementById("title-input-label"),o=document.getElementById("title-input"),i=document.getElementById("title-text");e.style.display="",i.style.display="none",o.value=i.innerHTML,o.addEventListener("focusout",this._bindedOnTitleInputLostFocus),this.buildMenu.showz1092Menu(),document.addEventListener("pointerdown",this._bindedOnDocPointerDown),document.addEventListener("pointerup",this._bindedOnDocPointerUp),document.addEventListener("pointermove",this._bindedOnDocPointerMove),document.getElementById("main").classList.add("build-mode"),this._active=!0}},z1063.prototype.exitBuildMode=function(){if(this._active){this.removeGUI(),this.deselectz1092();var t=document.getElementById("title-input-label"),e=document.getElementById("title-input"),o=document.getElementById("title-text");t.style.display="none",o.style.display="inline",o.innerHTML=e.value,e.removeEventListener("focusout",this._bindedOnTitleInputLostFocus),this.buildMenu.hide(!0),this.buildMenu.activez1092Menu=null,this._pointerDown=!1,document.removeEventListener("pointerdown",this._bindedOnDocPointerDown),document.removeEventListener("pointerup",this._bindedOnDocPointerUp),document.removeEventListener("pointermove",this._bindedOnDocPointerMove),this.accToAddName=null,this.accToEdit=null,this.selectedMenuItem=null,this._active=!1,f.app.graphicsHelper.unsubscribe(z3.POINTER_DOWN,f.app.builder.onBJSPointerDown,f.app.builder),f.app.graphicsHelper.unsubscribe(z3.POINTER_DOWN,f.app.builder.onBJSPointerUp,f.app.builder),document.getElementById("main").classList.remove("build-mode"),this.graphicsHelper.moveCameraBorder=0}},z1063.prototype.getDragged=function(){return this.dragObj},z1063.prototype.subscribe=function(t,e,o){this.pubsub.subscribe(t,e,o)},z1063.prototype.unsubscribe=function(t,e,o){this.pubsub.unsubscribe(t,e,o)},z1063.ACCESSORY_DELETED=f.AppEvents.GetUniqueID(),z1063.ACCESSORY_ADDED=f.AppEvents.GetUniqueID(),z1063.ACCESSORY_CHANGED=f.AppEvents.GetUniqueID(),z1063.ACCESSORY_ROTATED=f.AppEvents.GetUniqueID(),z1063.ACCESSORY_DRAG_START=f.AppEvents.GetUniqueID(),z1063.ACCESSORY_DRAG_STOP=f.AppEvents.GetUniqueID(),z1063.z1048_TITLE_UPDATED=f.AppEvents.GetUniqueID(),z1063.NODES_UPDATED=f.AppEvents.GetUniqueID(),z1063.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],z1063.tempBabQuats=[BABYLON.Quaternion.Zero(),BABYLON.Quaternion.Zero(),BABYLON.Quaternion.Zero()],z1063.tempBabMats=[BABYLON.Matrix.Identity(),BABYLON.Matrix.Identity()],z1063.tempArray=[],z1063}();f.z1063=t}(z0||(z0={})),function(y){var t=function(){function z1064(t,e){this.zoomLevel=1,this.countLabels=[],this.accessoryMenuY=170,this.topMenuBackgroundY=272,this.pubsub=new Pubsub,this._velocityX=0,this._skipNextFrameMoveByVelocity=!1,this._showAccMenuCatAfterLoad=null,this._menuItemsToLoad=[],this.graphicsHelper=e,this.scene=e.scene,this._createHTML("main"),this.rootMenu=document.getElementById("parts-cat-ctn"),this.navCtl=document.getElementById("nav-ctn-parts"),this._menuItemInfo=t,this.graphicsHelper.spsManagerManager.addNewSPSMan(y.app.spsData,y.App.menuRenderingGroupID,!0,this._onAfterSPSBuild.bind(this))}return z1064.prototype.translateCurrentMenuPanel=function(t){if(1!=this.activez1092Menu.accessories.length){var e=-this.activez1092Menu.maxAccPosX,o=-this.activez1092Menu.minAccPosX;this._velocityX=t,this._skipNextFrameMoveByVelocity=!0,this._transNode.position.x+=this._velocityX;var i=this._transNode.position.x;i<e?(this._velocityX=0,this._transNode.position.x=e):o<i&&(this._velocityX=0,this._transNode.position.x=o),this.activez1092Menu.currentX=-this._transNode.position.x,this.activez1092Menu.targetX=this.activez1092Menu.currentX,this.positionCountLabels(),this.pubsub.broadcast(z1064.MOVED)}},z1064.prototype.smoothStop=function(){this._skipNextFrameMoveByVelocity=!1,this.movePanelByVelocity()},z1064.prototype.getWorldMatrix=function(){return this._transNode.getWorldMatrix()},z1064.prototype.getMenuPositionToRef=function(t){t.x=this._transNode.position.x,t.y=this._transNode.position.y,t.z=this._transNode.position.z;var e=this.graphicsHelper.camera.position;t.x+=e.x,t.y+=e.y,t.z+=e.z},Object.defineProperty(z1064.prototype,"isVisible",{get:function(){return"visible"==this.rootMenu.style.visibility},enumerable:!1,configurable:!0}),z1064.prototype.subscribe=function(t,e,o){this.pubsub.subscribe(t,e,o)},z1064.prototype.unsubscribe=function(t,e,o){this.pubsub.unsubscribe(t,e,o)},z1064.prototype._onAfterSPSBuild=function(){requestAnimationFrame(this.finishCreatingMenu.bind(this))},z1064.prototype.finishCreatingMenu=function(){this.createMenus(this._menuItemInfo,this._onAfterMenuItemsCreated),this.pubsub.subscribe(z1064.AFTER_MENU_ITEMS_CREATED,this._onAfterMenuItemsCreated,this);var o=this;this.graphicsHelper.subscribe(z3.SCREEN_RESIZED,this.setz1092MenuPosition,this),this._background=ObjectPool.get("z1068",{name:"z1092MenuBGTubes",renderingGroupID:y.App.menuRenderingGroupID,textureName:"backgroundTexture"}),this._background.color.r=0,this._background.color.g=0,this._background.color.b=0,this._background.setPosition(0,-10,100),this._background.setScale(1e3,13,1),this._transNode=new BABYLON.TransformNode("menuItems",this.scene),this._transNode.parent=this.scene.activeCamera,this.graphicsHelper.setParentz1080s(this._transNode,y.App.menuRenderingGroupID);for(var t=this.graphicsHelper.spsManagerManager.spsManagers,e=0;e<t.length;e++){var i=t[e];i.renderingGroupID==y.App.menuRenderingGroupID&&(i.sps.computeBoundingBox=!0)}this._background.removeFromScene(),this._bindedMovePanelToTarget=this.movePanelToTarget.bind(this),this._bindedMovePanelByVelocity=this.movePanelByVelocity.bind(this),this._bindedPositionCountLabels=this._positionCountLabels.bind(this);var n=this,s=document.getElementById("parts-cat-ctn"),a=document.getElementById("nav-ctn-parts");s.addEventListener("click",function(t){var e=t.target;if(e.classList.contains("chip")||(e=e.parentNode),e&&e.classList.contains("chip")){var o=s.querySelector(".selected");o&&o.classList.remove("selected"),o!=e?(e.classList.add("selected"),a.style.visibility="visible",n.showz1092Menu(e.id)):(a.style.visibility="hidden",n.hidez1092Menu())}});a.addEventListener("click",function(t){var e=t.target;e.classList.contains("nav-btn")||(e=e.parentNode),e.classList.contains("nav-btn-left")?o.prev():e.classList.contains("nav-btn-right")&&o.next()})},z1064.prototype._createHTML=function(t){var e=document.getElementById("parts-labels-ctn");if(!e){var o=document.getElementById(t);(e=document.createElement("div")).id="parts-labels-ctn",o.appendChild(e)}},z1064.prototype.next=function(){var t=this.activez1092Menu;t&&(t.updateIndexByCurrentX(),t.currentIndex++,this.movePanelToTarget(),this.pubsub.broadcast(z1064.NEXT))},z1064.prototype.prev=function(){var t=this.activez1092Menu;t&&(t.updateIndexByCurrentX(),t.currentIndex--,this.movePanelToTarget(),this.pubsub.broadcast(z1064.PREV))},z1064.prototype.showz1092Menu=function(t){if(t){if(0<this._menuItemsToLoad.length)return void(this._showAccMenuCatAfterLoad=t);if(!this.accessoryMenus[t])return;if(this.activez1092Menu==this.accessoryMenus[t]&&!this.activez1092Menu.hidden)return void this.hidez1092Menu();this.hidez1092Menu(),this.activez1092Menu=this.accessoryMenus[t],this.activez1092Menu.show(),this.setz1092MenuPosition(),this._background.addToScene(),this.activez1092Menu.mesh&&(this.activez1092Menu.mesh.parent=this._transNode),this.navCtl.style.visibility="visible",this.pubsub.broadcast(z1064.SHOW,t),this.showz1092CountLabels()}},z1064.prototype.hidez1092Menu=function(t){if(void 0===t&&(t=!1),this.activez1092Menu){if(this.activez1092Menu.hide(),this.navCtl.style.visibility="hidden",t){var e=document.getElementById("parts-cat-ctn").querySelector(".selected");e&&e.classList.remove("selected"),this.activez1092Menu=null}this._background.removeFromScene(),this.hidez1092CountLabels(),this.pubsub.broadcast(z1064.HIDE)}},z1064.prototype._onAfterMenuItemsCreated=function(){this.accessoryMenus.cages&&this.accessoryMenus.cages.setScale(.5),this.accessoryMenus.bowls&&this.accessoryMenus.bowls.setScale(2),this.accessoryMenus.waterbottles&&this.accessoryMenus.waterbottles.setScale(1.25),this.accessoryMenus.bridges&&this.accessoryMenus.bridges.setScale(1.5),this.setz1092MenuPosition(),this._showAccMenuCatAfterLoad&&(this.showz1092Menu(this._showAccMenuCatAfterLoad),this._showAccMenuCatAfterLoad=null)},z1064.prototype.createMenus=function(t,e){this.createz1092Menus(t,e)},z1064.prototype.show=function(){this.rootMenu.classList.add("is-showing-options"),this.rootMenu.style.visibility="visible",this.activez1092Menu&&(this.updateCounts(),this.activez1092Menu.show(),this._background.addToScene(),this.navCtl.style.visibility="visible")},z1064.prototype.hide=function(t){void 0===t&&(t=!1),this.rootMenu.style.visibility="hidden",this.navCtl.style.visibility="hidden",this.hidez1092Menu(t)},z1064.prototype.toggle=function(){this.rootMenu.classList.contains("is-showing-options")?this.hide():this.show()},z1064.prototype._getPosZ=function(t){void 0===t&&(t=1);var e=this.graphicsHelper,o=e.scene.activeCamera.fov,i=1.5/t,n=6/t;return((e.canvas.height-220)/789*(n-i)+i)/Math.tan(.5*o)},z1064.prototype.setz1092MenuPosition=function(){if(this.activez1092Menu){var t=this.activez1092Menu,e=this.graphicsHelper,o=e.scene.activeCamera,i=e.canvas,n=i.height,s=this._getPosZ(this.activez1092Menu.scale),a=z1064.z4[0];a.x=0,a.y=0,a.z=s;var r=.5*i.width,c=n-this.accessoryMenuY;c<.5*n&&(c=.5*n);var d=o.position.z+s;if(e.getPlanePositionAtScreenXY(r,c,d,a),t._firstLoad){var p=z1064.z4[1];p.x=0,p.y=0,p.z=s;e.getPlanePositionAtScreenXY(0,0,d,p),t.currentX=o.position.x-p.x-.5*t.menuItemInfos[0].menuWidth,2*t.currentX>t.width&&(t.currentX=.5*t.width);var l=t.minAccPosX,u=t.maxAccPosX;t.currentX<l&&(t.currentX=l),t.currentX>u&&(t.currentX=u),t.targetX=t.currentX,t._firstLoad=!1}a.x-=o.position.x,a.y-=o.position.y,a.z-=o.position.z,a.x-=t.currentX,this._transNode.position.x=a.x,this._transNode.position.y=a.y,this._transNode.position.z=a.z,s=this._getPosZ(.5),(a=z1064.z4[0]).x=0,a.y=0,a.z=s,r=.5*i.width,c=n,d=o.position.z+s,e.getPlanePositionAtScreenXY(r,c,d,a),a.x-=o.position.x,a.y-=o.position.y,a.z-=o.position.z,a.x-=this._transNode.position.x,a.y-=this._transNode.position.y,a.z-=this._transNode.position.z,this._background.setPosition(0,a.y,a.z),y.app.updateOnceNextFrame.push(this._bindedMovePanelToTarget)}},z1064.prototype.refreshMenuItem=function(t,e){for(var o=this.createz1092MenuItem(t),i=this.accessoryMenus[e].accessories,n=0;n<i.length;n++)if(i[n]._className==o._className){i[n]=o;break}return this.accessoryMenus[e].addz1092(o),o},z1064.prototype.createz1092MenuItem=function(t){return this._getz1092MenuItem(t)},z1064.prototype._getz1092MenuItem=function(t,e,o,i){var n={shapeName:t,isMenuItem:!0,renderingGroupID:1};if(o)for(var s in o)n[s]=o[s];var a=ObjectPool.get(t,n,null,i);return a.removeFromScene(),a.removeFromActiveObjects(),a},z1064.prototype.createz1092Menus=function(t,e){if(!(0<this._menuItemsToLoad.length)){this.accessoryMenus={},this._menuItemsLoadedCallback=e;t.sort(function(t,e){return e.order-t.order});for(var o=t.length-1;0<=o;o--)this._menuItemsToLoad.push(t[o]);this._bindedLoadLastAccMenuItem||(this._bindedLoadLastAccMenuItem=this._loadLastAccMenuItem.bind(this)),this._loadLastAccMenuItem()}},z1064.prototype._loadLastAccMenuItem=function(){var t=this._menuItemsToLoad,e=t.length-1,o=this.accessoryMenus,i=t[e],n=i.category.toLocaleLowerCase();o[n]||(o[n]=new y.z1032(y.App.menuRenderingGroupID),i.disableCountLabels&&(o[n].disableCountLabels=!0),o[n].hide()),o[n].addz1092(this._getz1092MenuItem(i.objectName,null,null,!0),i),t.length--,0<t.length?requestAnimationFrame(this._bindedLoadLastAccMenuItem):this._menuItemsLoadedCallback&&this._menuItemsLoadedCallback()},z1064.prototype.hidez1092CountLabels=function(){for(var t=this.countLabels,e=0;e<t.length;e++)t[e].classList.remove("is-visible"),t[e].style.transform="translate3d(0, 0, 0)"},z1064.prototype.getMenuItemScreenPositionToRef=function(t,e){var o=this._transNode.getWorldMatrix();this.graphicsHelper.getScreenPointToRef(t,e,o)},z1064.prototype.movePanelToTarget=function(){var t=this.activez1092Menu;if(t&&!t.hidden){var e=this.activez1092Menu,o=e.currentX;e.update();var i=e.currentX,n=z1064.z4[0];n.copyFrom(this._transNode.position);var s=o-i;n.x+=s,this._transNode.position.x+=s,.001<Math.abs(s)&&-1===y.app.updateOnceNextFrame.indexOf(this._bindedMovePanelToTarget)&&y.app.updateOnceNextFrame.push(this._bindedMovePanelToTarget),this.positionCountLabels(),this.pubsub.broadcast(z1064.MOVED)}},z1064.prototype.movePanelByVelocity=function(){if(!this._skipNextFrameMoveByVelocity&&(this.activez1092Menu&&1!=this.activez1092Menu.accessories.length)){var t=-this.activez1092Menu.maxAccPosX,e=-this.activez1092Menu.minAccPosX;this._transNode.position.x+=this._velocityX,this._velocityX*=.9;var o=this._transNode.position.x;o<t?(this._velocityX=0,this._transNode.position.x=t):e<o&&(this._velocityX=0,this._transNode.position.x=e),this.activez1092Menu.currentX=-this._transNode.position.x,this.activez1092Menu.targetX=this.activez1092Menu.currentX,this.positionCountLabels(),.001<Math.abs(this._velocityX)&&-1===y.app.updateOnceNextFrame.indexOf(this._bindedMovePanelByVelocity)&&y.app.updateOnceNextFrame.push(this._bindedMovePanelByVelocity),this.pubsub.broadcast(z1064.MOVED)}},z1064.prototype.positionCountLabels=function(){y.app.updateOnceAfterRender.push(this._bindedPositionCountLabels)},z1064.prototype._positionCountLabels=function(){var t=this.activez1092Menu;if(t&&!t.hidden){var e=this.zoomLevel,o=this.countLabels;if(o.length)for(var i=this.graphicsHelper.canvas,n=t.accessories,s=i.clientWidth+30,a=i.clientHeight,r=z1064.z4[2],c=0;c<n.length;c++){this.getMenuItemScreenPositionToRef(t.getMenuItemCoutLabelPosition(c),r);var d=o[c];if(-30<r.x&&r.x<s&&-30<r.y&&r.y<a){var p=(r.x-15)*e,l=(r.y-15)*e;d.style.transform="translate3d("+p+"px, "+l+"px, 0)",d.classList.contains("is-visible")||d.classList.add("is-visible")}else d.classList.remove("is-visible"),d.style.transform="translate3d(0, 0, 0)"}}},z1064.prototype.updateCounts=function(){var t=this.activez1092Menu;if(t&&!t.disableCountLabels){var e=this.countLabels;if(e.length)for(var o=t.accessories,i=0;i<o.length;i++){var n=o[i],s=e[i],a=n.getObjectCount();s.innerHTML=""+a,n.isMenuItem&&(0==a&&n.isOnScene?n.removeFromScene():0<a&&!n.isOnScene&&n.addToScene())}}},z1064.prototype.showz1092CountLabels=function(){var t=this.activez1092Menu;if(t&&!t.disableCountLabels){for(var e=this.countLabels,o=document.getElementById("parts-labels-ctn"),i=t.accessories,n=e.length;n<i.length;n++)e[n]=document.createElement("DIV"),e[n].classList.add("menu-count-label"),o.appendChild(e[n]);this.updateCounts(),this.positionCountLabels()}},z1064.HIDE=1,z1064.SHOW=2,z1064.NEXT=3,z1064.PREV=4,z1064.MOVED=5,z1064.AFTER_MENU_ITEMS_CREATED=6,z1064.z4=[BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero(),BABYLON.Vector3.Zero()],z1064}();y.z1064=t}(z0||(z0={})),function(e){var t=function MapPlacementInfo(t){this.placementType=e.PlacementType.NONE,this.mapPlacementSizeX=1,this.mapPlacementSizeY=1,this.mapOffsetX=0,this.mapOffsetY=0,this.mapOffsetDropTargetX=0,this.mapOffsetDropTargetY=0,this.offsetDragFromMenuY=0,t.placementType?this.placementType=t.placementType:e.PlacementType.NONE,t.mapPlacementSizeX&&(this.mapPlacementSizeX=t.mapPlacementSizeX),t.mapPlacementSizeY&&(this.mapPlacementSizeY=t.mapPlacementSizeY),t.mapOffsetX&&(this.mapOffsetX=t.mapOffsetX),t.mapOffsetY&&(this.mapOffsetY=t.mapOffsetY),t.mapOffsetDropTargetX&&(this.mapOffsetDropTargetX=t.mapOffsetDropTargetX),t.mapOffsetDropTargetY&&(this.mapOffsetDropTargetY=t.mapOffsetDropTargetY),t.offsetDragFromMenuY&&(this.offsetDragFromMenuY=t.offsetDragFromMenuY)};e.MapPlacementInfo=t}(z0||(z0={})),function(t){var e=function MenuItemInfo(t){this.id="",this.objectName="",this.category="",this.order=0,this.menuWidth=1,this.menuHeight=1,this.offsetX=0,this.offsetY=0,this.offsetZ=0,this.menuRotationOffset=BABYLON.Vector3.Zero(),this.scale=1,this.disableCountLabels=!1,this.menuX=0,this.x=0,this.y=0,this.z=0,this.transNodeScale=1,this.createBodyContainer=!1,this.countLabelX=0,this.countLabelY=0,this.countLabelZ=0,this.id=t.id,this.objectName=t.objectName,this.category=t.category,t.order&&(this.order=t.order),t.menuWidth&&(this.menuWidth=t.menuWidth),t.menuHeight&&(this.menuHeight=t.menuHeight),t.offsetX&&(this.offsetX=t.offsetX),t.offsetY&&(this.offsetY=t.offsetY),t.offsetZ&&(this.offsetZ=t.offsetZ),t.menuRotationOffset&&this.menuRotationOffset.copyFrom(t.menuRotationOffset),t.scale&&(this.scale=t.scale),t.rotation&&(this.rotation=t.rotation),t.disableCountLabels&&(this.disableCountLabels=t.disableCountLabels),t.transNodeScale&&(this.transNodeScale=t.transNodeScale),t.createBodyContainer&&(this.createBodyContainer=t.createBodyContainer),t.countLabelX&&(this.countLabelX=t.countLabelX),t.countLabelY&&(this.countLabelY=t.countLabelY),t.countLabelZ&&(this.countLabelZ=t.countLabelZ)};(z0||(z0={})).MenuItemInfo=e}(),function(t){var e=function PropsMenuOption(t,e,o,i,n){void 0===n&&(n="switch"),this.value=t,this.labelName=e,this.propName=o,this.uniformName=i,this.inputType=n};(z0||(z0={})).PropsMenuOption=e}(),function(C){var t=function(){function z1065(t){this._rootElement=void 0,this._colorsElement=void 0,this._savedColorsElement=void 0,this._selectedIndex=0,this._pointerDown=!1,this._isDragging=!1,this._pointerOffsetX=0,this._pointerOffsetY=0,this._colorsToElements=[],this.pubsub=new Pubsub,this._stickToBottom=!0,this._bindedOnPointerMove=void 0,this._tempColor=BABYLON.Color3.White(),this._rootElement=this._createHTML(t);var e=this._rootElement;this._bindedOnPointerMove=this._onPointerMove.bind(this);var n=e.querySelector(".colors");this._colorsElement=n,this._propsElement=e.querySelector(".props"),this._propEls=this._propsElement.children;for(var o=[{r:255,g:0,b:0},{r:255,g:127,b:0},{r:255,g:255,b:0},{r:0,g:255,b:0},{r:0,g:0,b:255},{r:75,g:0,b:130},{r:148,g:0,b:211},{r:255,g:255,b:255},{r:225,g:218,b:187},{r:142,g:71,b:20},{r:0,g:0,b:0}],i={h:0,s:0,l:0},s=0;s<o.length;s++){var a=document.createElement("div");a.classList.add("color-cont");var r=document.createElement("div"),c=o[s],d="rgb("+c.r+","+c.g+","+c.b+")";r.style.backgroundColor=d,r.style.borderColor=d,r.classList.add("main-color"),r.classList.add("color");var p=this.RGBToHex(d);this._colorsToElements[p]=r;var l=document.createElement("div");l.classList.add("secondary-colors"),this.RBGToHSL(c.r,c.g,c.b,i);for(var u=80/o.length,y=90,g=0;g<o.length;g++){var m=document.createElement("div"),f=C.z1073.HSLToRGB(i.h,i.s,y);m.style.backgroundColor=f,m.style.borderColor=f,m.classList.add("secondary-color"),m.classList.add("color"),l.appendChild(m);p=this.RGBToHex(f);this._colorsToElements[p]=m,y-=u}a.appendChild(l),a.appendChild(r),n.appendChild(a)}a.classList.add("active"),r.classList.add("selected");var A=e.querySelector(".saved-colors");this._savedColorsElement=A;i={h:0,s:0,l:0};(m=document.createElement("div")).classList.add("color"),m.classList.add("save-color-btn");var b=document.createElement("span");b.classList.add("icon-plus"),m.appendChild(b),A.appendChild(m);for(g=0;g<o.length-1;g++){m=document.createElement("div"),f=C.z1073.HSLToRGB(i.h,i.s,y);m.style.borderColor=f,m.classList.add("color"),A.appendChild(m)}var v=this;this._rootElement.addEventListener("pointerdown",function(t){var e=t.target;if(e==v._rootElement){var o=e.getBoundingClientRect();v._pointerOffsetX=o.left-t.x,v._pointerOffsetY=o.top-t.y,v._isDragging=!0}v._pointerDown=!0,v.pubsub.broadcast(z1065.POINTER_DOWN)});var x=function(t){if(v.isVisible){var e=v._propEls[v._selectedIndex];e.children[0].style.backgroundColor=t;var o=e.children[1].innerHTML;C.z1073.SetColor3FromRBG(t,v._tempColor),v.pubsub.broadcast(z1065.COLOR_CHANGED,{name:o,color:v._tempColor})}};this._colorsElement.addEventListener("click",function(t){if(v._pointerDown){var e=t.target;if(e&&e.classList.contains("color")){var o=n.querySelector(".selected");if(o&&o==e)return;o&&o.classList.remove("selected"),e.classList.add("selected");var i=n.querySelector(".active");i&&i!=e.parentNode&&i.classList.remove("active"),e.parentNode.classList.contains("secondary-colors")?e.parentNode.parentNode.classList.add("active"):e.parentNode.classList.add("active"),x(e.style.backgroundColor)}v._pointerDown=!1}});A.addEventListener("click",function(t){if(v._pointerDown){var e=t.target;if(e&&e.classList.contains("save-color-btn")){var o=v._colorsElement.querySelector(".selected");if(o){var i=A.children[1],n="";if(i.style.backgroundColor!=o.style.backgroundColor){for(var s=A.children.length-1;1<s;s--){var c1=A.children[s-1],c2=A.children[s];c2.style.backgroundColor=c1.style.backgroundColor,n=c2.style.backgroundColor+"|"+n}i.style.backgroundColor=o.style.backgroundColor,n=i.style.backgroundColor+"|"+n,v.pubsub.broadcast(z1065.COLOR_ADDED,n)}}}else if(e&&e.classList.contains("color")){var a=v.RGBToHex(e.style.backgroundColor);v._setColorWithHex(a),x(e.style.backgroundColor)}v._pointerDown=!1}});v=this;e.querySelector(".close-btn").addEventListener("click",function(t){v._pointerDown&&(v.hide(),v._pointerDown=!1)});v=this;this._propsElement.addEventListener("click",function(t){if(v._pointerDown){var e=t.target;v._selectedIndex=v.getSelectionFromElement(e),v._selectMenuItem(v._selectedIndex),v._pointerDown=!1}}),document.addEventListener("pointerup",function(t){v._isDragging=!1}),window.addEventListener("resize",function(){v.keepInsidePage()}),new z1081(null,this._propsElement),new z1081(null,this._colorsElement)}return Object.defineProperty(z1065.prototype,"zoomLevel",{get:function(){return C.app.zoomLevel},enumerable:!1,configurable:!0}),z1065.prototype._onPointerMove=function(t){if(this._isDragging){var e=this.zoomLevel,o=t.x+this._pointerOffsetX,i=t.y+this._pointerOffsetY;this._rootElement.style.transform="translate3d("+o+"px, "+i+"px, 0) scale("+e+")",this._stickToBottom=!1,t.stopPropagation()}},z1065.prototype.getSelectionFromElement=function(t){for(var e=this._propEls,o=0;o<e.length;o++)if(t==e[o])return o},z1065.prototype.updateMenu=function(t){var e=this._propEls,o=0;if(t)for(var i in t){(s=e[o]).classList.add("is-visible"),s.children[1].innerHTML=i,s.children[0].style.backgroundColor=t[i].toHexString(),o+=1}for(var n=o;n<e.length;n++){var s;(s=e[n]).classList.remove("is-visible")}this._selectMenuItem(0)},z1065.prototype.updateMenu2=function(t){var e=this._propEls,o=0;if(t)for(var i in t){(s=e[o]).classList.add("is-visible"),s.children[1].innerHTML=i,s.children[0].style.backgroundColor=C.z1073.GetHexFromVec3(t[i]),o+=1}for(var n=o;n<e.length;n++){var s;(s=e[n]).classList.remove("is-visible")}this._selectMenuItem(0)},z1065.prototype._selectMenuItem=function(t){if(null!=t){this._selectedIndex=t;var e=this._propEls[t],o=e.children[0].style.backgroundColor,i=this.RGBToHex(o);this._setColorWithHex(i);for(t=0;t<this._propEls.length;t++)this._propEls[t].classList.remove("selected");e.classList.add("selected")}},Object.defineProperty(z1065.prototype,"isVisible",{get:function(){return"flex"==this._rootElement.style.display},enumerable:!1,configurable:!0}),z1065.prototype.show=function(){this._rootElement.style.display="flex";var t=this.zoomLevel;if(this._stickToBottom){var e=this._rootElement.getBoundingClientRect(),o=document.body.clientHeight,i=.5*document.body.clientWidth-.5*e.width,n=o-e.height-100;this._rootElement.style.transform="translate3d("+i+"px, "+n+"px, 0) scale("+t+")"}this._rootElement.parentElement.addEventListener("pointermove",this._bindedOnPointerMove)},z1065.prototype.hide=function(){this._rootElement.style.display="none",this._rootElement.parentElement.removeEventListener("pointermove",this._bindedOnPointerMove)},z1065.prototype.setColor=function(t){this._tempColor.r=t.r,this._tempColor.g=t.g,this._tempColor.b=t.b;var e=this._tempColor.toHexString();this._setColorWithHex(e)},z1065.prototype._setColorWithHex=function(t){t=t.toLowerCase();var e=this._colorsToElements[t],o=this._colorsElement.querySelector(".selected");if(o&&o!=e&&o.classList.remove("selected"),e){e.classList.add("selected");var i=this._colorsElement.querySelector(".active");i&&i!=e.parentNode&&i.classList.remove("active"),e.parentNode.classList.contains("secondary-colors")?e.parentNode.parentNode.classList.add("active"):e.parentNode.classList.add("active")}},z1065.prototype.RGBToHex=function(t){var e=-1<t.indexOf(",")?",":" ",o=(+(t=t.substr(4).split(")")[0].split(e))[0]).toString(16),i=(+t[1]).toString(16),n=(+t[2]).toString(16);return 1==o.length&&(o="0"+o),1==i.length&&(i="0"+i),1==n.length&&(n="0"+n),"#"+o+i+n},z1065.prototype.RBGToHSL=function(t,e,o,i){t/=255,e/=255,o/=255;var h,n,s=Math.max(t,e,o),a=Math.min(t,e,o),r=(s+a)/2;if(s==a)h=n=0;else{var c=s-a;switch(n=.5<r?c/(2-s-a):c/(s+a),s){case t:h=(e-o)/c+(e<o?6:0);break;case e:h=(o-t)/c+2;break;case o:h=(t-e)/c+4}h/=6}i.h=360*h,i.s=100*n,i.l=100*r},z1065.prototype.keepInsidePage=function(){if(this.isVisible){var t=this.zoomLevel,e=this._rootElement,o=e.getBoundingClientRect(),i=document.body.clientHeight,n=document.body.clientWidth,s=o.left,a=o.top;o.right>n&&(s=n-o.width),o.left<0&&(s=0),o.top+80>i&&(a=i-80),o.top<0&&(a=0),e.style.transform="translate3d("+s+"px, "+a+"px, 0) scale("+t+")"}},z1065.prototype.subscribe=function(t,e,o){this.pubsub.subscribe(t,e,o)},z1065.prototype.unsubscribe=function(t,e,o){this.pubsub.unsubscribe(t,e,o)},z1065.prototype.loadSavedColors=function(t){for(var e=t.split("|"),o=0;o<10;o++)this._savedColorsElement.children[o+1].style.backgroundColor=e[o]},z1065.prototype._createHTML=function(t){var e=C.z1073.CreateHTMLElementFromString('<div touch-action="none">');return e.id=t,e.classList.add("simple-color-picker"),e.classList.add("simple-dialog"),e.style.display="none",e.style.transformOrigin="0 0",e.innerHTML='<div class=\'close-btn\'>\n                <span class=\'icon-clear\'></span>\n            </div>\n            <div class="props" touch-action="auto">\n                <div>\n                    <div class="color"></div><div class="name"></div>\n                </div>\n                <div>\n                    <div class="color"></div><div class="name"></div>\n                </div>\n                <div>\n                    <div class="color"></div><div class="name"></div>\n                </div>\n                <div>\n                    <div class="color"></div><div class="name"></div>\n                </div>\n                <div>\n                    <div class="color"></div><div class="name"></div>\n                </div>\n            </div>\n            <div class="colors" touch-action="auto"></div>\n            <div class="saved-colors colors color-cont active" touch-action="auto"></div>',e},z1065.COLOR_CHANGED=1,z1065.COLOR_ADDED=2,z1065.POINTER_DOWN=3,z1065}();C.z1065=t}(z0||(z0={})),function(o){var t=function(){function z1066(t){this._rootElement=void 0,this._propsElement=void 0,this._pointerDown=!1,this._isDragging=!1,this._pointerOffsetX=0,this._pointerOffsetY=0,this.pubsub=new Pubsub,this._stickToBottom=!0,this._bindedOnPointerMove=void 0,this._bindedOnCheckboxChanged=void 0,this._rootElement=this.createHTML(t);var e=this._rootElement;this._propsElement=this._rootElement.getElementsByClassName("props")[0],this._bindedOnPointerMove=this._onPointerMove.bind(this),this._bindedOnCheckboxChanged=this._onCheckboxChanged.bind(this);var i=this;this._rootElement.addEventListener("pointerdown",function(t){var e=t.target;if(e==i._rootElement){var o=e.getBoundingClientRect();i._pointerOffsetX=o.left-t.x,i._pointerOffsetY=o.top-t.y,i._isDragging=!0}i._pointerDown=!0,i.pubsub.broadcast(z1066.POINTER_DOWN)});i=this;e.querySelector(".close-btn").addEventListener("click",function(t){i._pointerDown&&(i.hide(),i._pointerDown=!1)});i=this;document.addEventListener("pointerup",function(t){i._isDragging=!1}),window.addEventListener("resize",function(){i.keepInsidePage()})}return Object.defineProperty(z1066.prototype,"zoomLevel",{get:function(){return o.app.zoomLevel},enumerable:!1,configurable:!0}),z1066.prototype._onPointerMove=function(t){if(this._isDragging){var e=this.zoomLevel,o=t.x+this._pointerOffsetX,i=t.y+this._pointerOffsetY;this._rootElement.style.transform="translate3d("+o+"px, "+i+"px, 0) scale("+e+")",this._stickToBottom=!1,t.stopPropagation()}},z1066.prototype.updateMenu=function(t){var e=this._propEls;if(t){if(!e)for(var o in this._inputs={},this._propEls={},e=this._propEls,t){var i=t[o],n=document.createElement("div"),s=document.createElement("input"),a=document.createElement("label");if("switch"==i.inputType)n.classList.add("switch"),s.type="checkbox",s.id=o,s.classList.add("switch__input"),a.htmlFor=o,a.classList.add("switch__label"),a.innerHTML=i.labelName,n.appendChild(s),n.appendChild(a);else if("radio"==i.inputType){var r=document.createElement("span");a.classList.add("checkcontainer"),r.classList.add("radiobtn"),s.id=o,s.type="radio",s.name="radio",a.innerHTML=i.labelName,a.appendChild(s),a.appendChild(r),n.appendChild(a)}this._propsElement.appendChild(n),this._propEls[o]=n,this._inputs[o]=s}for(var o in t){var c=!1;"1"==(i=t[o]).value&&(c=!0),this._inputs[o].checked=c}}},Object.defineProperty(z1066.prototype,"isVisible",{get:function(){return"flex"==this._rootElement.style.display},enumerable:!1,configurable:!0}),z1066.prototype.show=function(){this._rootElement.style.display="flex";var t=this.zoomLevel;if(this._stickToBottom){var e=this._rootElement.getBoundingClientRect(),o=document.body.clientHeight,i=.5*document.body.clientWidth-.5*e.width,n=o-e.height-100;this._rootElement.style.transform="translate3d("+i+"px, "+n+"px, 0) scale("+t+")"}for(var s in this._rootElement.parentElement.addEventListener("pointermove",this._bindedOnPointerMove),this._propEls){this._propEls[s].addEventListener("change",this._bindedOnCheckboxChanged)}},z1066.prototype._onCheckboxChanged=function(t){this.pubsub.broadcast(z1066.PROP_CHANGED,t.target.id,t.target.checked)},z1066.prototype.hide=function(){if(this._rootElement.style.display="none",this._rootElement.parentElement.removeEventListener("pointermove",this._bindedOnPointerMove),this._propEls)for(var t in this._propEls){this._propEls[t].removeEventListener("change",this._bindedOnCheckboxChanged)}},z1066.prototype.keepInsidePage=function(){if(this.isVisible){var t=this.zoomLevel,e=this._rootElement,o=e.getBoundingClientRect(),i=document.body.clientHeight,n=document.body.clientWidth,s=o.left,a=o.top;o.right>n&&(s=n-o.width),o.left<0&&(s=0),o.top+80>i&&(a=i-80),o.top<0&&(a=0),e.style.transform="translate3d("+s+"px, "+a+"px, 0) scale("+t+")"}},z1066.prototype.subscribe=function(t,e,o){this.pubsub.subscribe(t,e,o)},z1066.prototype.unsubscribe=function(t,e,o){this.pubsub.unsubscribe(t,e,o)},z1066.prototype.createHTML=function(t){var e=o.z1073.CreateHTMLElementFromString('<div touch-action="none">');return e.id=t,e.classList.add("simple-props-menu"),e.classList.add("simple-dialog"),e.style.display="none",e.style.transformOrigin="0 0",e.innerHTML='<div class="close-btn">\n                <span class="icon-clear"></span>\n            </div>\n                <div class="props" touch-action="auto">\n            </div>',e},z1066.PROP_CHANGED=1,z1066.POINTER_DOWN=2,z1066}();o.z1066=t}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z678(){return null!==t&&t.apply(this,arguments)||this}return __extends(z678,t),z678.prototype.update=function(t){e.app.builder.enterBuildMode()},z678}(z767),t.z678=o}(z0||(z0={})),function(c){var t,e;t=c.z156||(c.z156={}),e=function(e){function z675(){var t=e.call(this)||this;return t.bindedDragz1064=void 0,t.bindedStopDragz1064=void 0,t.eventsAdded=!1,t.lastPos=BABYLON.Vector3.Zero(),t.dragging=!1,t.lastFrameDragz1064=0,t.bindedDragz1064=t.dragz1064.bind(t),t.bindedStopDragz1064=t.stopDragz1064.bind(t),t}return __extends(z675,e),z675.prototype.update=function(t){this.addEventListeners()},z675.prototype.addEventListeners=function(){if(!this.eventsAdded){var t=document.getElementById("main");t.addEventListener("pointermove",this.bindedDragz1064),t.addEventListener("pointerup",this.bindedStopDragz1064),this.eventsAdded=!0}},z675.prototype.removeEventListeners=function(){if(this.eventsAdded){var t=document.getElementById("main");t.removeEventListener("pointermove",this.bindedDragz1064),t.removeEventListener("pointerup",this.bindedStopDragz1064),t.removeEventListener("pointercancel",this.bindedStopDragz1064),t.removeEventListener("pointerleave",this.bindedStopDragz1064),this.eventsAdded=!1}},z675.prototype.stopDragz1064=function(t){this.dragging&&(c.app.builder.buildMenu.smoothStop(),this.dragging=!1)},z675.prototype.dragz1064=function(t){if(c.app.isPointerDown)if(c.app.multiTouch)this.dragging=!1;else if(c.app.builder.colorPicker2._isDragging)this.dragging=!1;else{var e=c.app.builder.buildMenu;if(e.activez1092Menu)if(e.isVisible){var o=!1;1<c.app.frameNum-this.lastFrameDragz1064&&(o=!0);var i=c.app.graphicsHelper,n=z767.z4[0],s=e.getWorldMatrix(),a=t.clientX,r=t.clientY;n.x=0,n.y=0,n.z=0,BABYLON.Vector3.TransformCoordinatesToRef(n,s,n),i.getPlanePositionAtScreenXY(a,r,n.z-1,n),o||e.translateCurrentMenuPanel(n.x-this.lastPos.x),this.lastPos.copyFrom(n),this.dragging=!0,this.lastFrameDragz1064=c.app.frameNum}else this.dragging=!1;else this.dragging=!1}else this.dragging=!1},z675}(z767),t.z675=e}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z659(){return null!==t&&t.apply(this,arguments)||this}return __extends(z659,t),z659.prototype.update=function(t){e.app.builder.exitBuildMode()},z659}(z767),t.z659=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z658(){return null!==t&&t.apply(this,arguments)||this}return __extends(z658,t),z658.prototype.update=function(t){z641.getz767(e.z675).removeEventListeners()},z658}(z767),e.z658=o}(z0||(z0={})),function(i){var t,e;t=i.z156||(i.z156={}),e=function(t){function z179(){return null!==t&&t.apply(this,arguments)||this}return __extends(z179,t),z179.prototype.update=function(t){for(var e=i.Bowl.activeObjects,o=0;o<e.length;o++){e[o].updateNumHamsAccess()}},z179}(z767),t.z179=e}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z178(){return null!==t&&t.apply(this,arguments)||this}return __extends(z178,t),z178.prototype.update=function(){if(n.app.builder){var t=n.app.builder.buildMenu.activez1092Menu;if(t&&!t.hidden)for(var e=t.accessories,o=0;o<e.length;o++){var i=e[o];i.physics&&i.update&&i.isMenuItem&&i.update()}}},z178}(z767),t.z178=e}(z0||(z0={})),function(i){var t,e;t=i.z156||(i.z156={}),e=function(t){function z163(){return null!==t&&t.apply(this,arguments)||this}return __extends(z163,t),z163.prototype.update=function(t){for(var e=i.WaterBottle.activeObjects,o=0;o<e.length;o++){e[o].updateNumHamsAccess()}},z163}(z767),t.z163=e}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z988(){return null!==t&&t.apply(this,arguments)||this}return __extends(z988,t),z988.prototype.test=function(t){var e;return null===(e=o.app.builder)||void 0===e?void 0:e.isActive},z988}(z770),t.z988=e}(z0||(z0={})),function(e){var t,o;t=e.z768||(e.z768={}),o=function(t){function z987(){return null!==t&&t.apply(this,arguments)||this}return __extends(z987,t),z987.prototype.test=function(t){return e.app.doTouch},z987}(z770),t.z987=o}(z0||(z0={})),function(o){var t,e;t=o.z768||(o.z768={}),e=function(t){function z927(){return null!==t&&t.apply(this,arguments)||this}return __extends(z927,t),z927.prototype.test=function(t){var e=o.app.builder;if(e)return!(!e.isActive||e.getSelectedz1062()!=t)},z927}(z770),t.z927=e}(z0||(z0={})),function(o){var t=function(e){function z155(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z678,o.z156.z667,o.z156.z675,o.z156.z670],t.updatez156=[],t.exitz156=[o.z156.z659,o.z156.z650,o.z156.z658,o.z156.z179,o.z156.z653],t}return __extends(z155,e),z155}(z49);o.z155=t}(z0||(z0={})),function(c){var t=function(e){function z1067(){var t=null!==e&&e.apply(this,arguments)||this;return t._cageUpdated=!1,t._isOpen=!1,t._updateScreenShotBinded=void 0,t._starterCages=[{name:"Starter 4",json:{names:["ap","c3","p2","r2","r1","c7","c1","c1","t3","t3","w2a","h3","wb1","hc","p2","b1","h","h"],props:[{bp:"none",bc:"#C0C0C0",x:1.44,y:-.64,z:-18.75},{x:2.5,y:-1.5,c:"#CCCCFF",bh:0},{x:2.5,y:-.5,c:"#A7A7FF"},{x:2,y:-1,rz:-.79,c:"#E1DABB,#C2B475"},{x:3,y:0,rz:.79,c:"#E1DABB,#C2B475"},{x:1.5,y:-3.5,c:"#CCCCFF",bh:"0.89,0.95,0.91,0.92,1,0.89,0.97,1,1",bc:"#FFFBAF"},{x:.5,y:-1.5,c:"#FFFFFF",bh:0},{x:.5,y:.5,c:"#FFFFFF",bh:0},{x:-1,y:-2,rz:-1.57,c:"#00FF00,#FFFF00"},{x:-1,y:-1,rz:-3.14,c:"#00FF00,#FFFF00,#FFFF00"},{x:.5,y:-1.45,rz:0,c:"#0000FF"},{x:.5,y:.5,rz:0,c:"#00FF00"},{x:3.15,y:1.9,rz:0,c:"#BFBFBF,#00FF00,#ADADAD,#00FF00,#FF7F00",wl:.1,nh:2},{x:0,y:1.75,rz:0,c:"#FF0000,#FFFF00,#00FF00,#0000FF"},{x:2.5,y:.5,c:"#A7A7FF"},{x:2.5,y:.54,rz:0,c:"#C1B575,#A39347",nf:0,nh:2},{x:0,y:-.9,c:"#EC7600FF,#000000FF,#FF7F00FF,#EC7600FF",o:"fu,be,ru"},{x:0,y:2,c:"#EC7600FF,#000000FF,#EC7600FF,#EC7600FF",o:"c1,c2,cf,sn,ch,be"}]},screenshot:"images/starter4.png"},{name:"Starter 3",json:{names:["ap","wb1","c1","c6","br","p1","p1","r2","w2b","c1","r1","h4","b1","c1","hc","h2","h","h"],props:[{bp:"none",bc:"#C0C0C0",x:0,y:2.42,z:-22},{x:-3.15,y:4,rz:0,c:"#BFBFBF,#00FF00,#ADADAD,#00FF00,#FF7F00",wl:.5397023719139331,nh:2},{x:2.5,y:1.5,c:"#FFFFFF",bh:0},{x:0,y:.5,c:"#F0CCFF",bh:0},{x:0,y:2.5,c:"#FFFFFF"},{x:1,y:2.5,c:"#82FF82"},{x:-1,y:2.5,c:"#82FF82"},{x:2,y:2,rz:-.79,c:"#E1DABB,#C2B475"},{x:0,y:.55,rz:0,c:"#00FF00"},{x:-2.5,y:2.5,c:"#FFFFFF",bh:0},{x:1,y:1,rz:.79,c:"#E1DABB,#C2B475"},{x:2.5,y:1.5,rz:0,c:"#FFFF00"},{x:-2.5,y:2.55,rz:0,c:"#C1B575,#A39347",nf:0,nh:2},{x:-2.5,y:.5,c:"#FFFFFF",bh:"1,1,1,1,1",bc:"#FFFBAF"},{x:3,y:2.75,rz:0,c:"#FF0000,#FFFF00,#00FF00,#0000FF"},{x:-2.5,y:2.5,rz:0,c:"#AF5719,#00C700"},{x:0,y:2,c:"#EC7600FF,#000000FF,#EC7600FF,#EC7600FF",o:"fu,be,ru"},{x:0,y:-.9,c:"#EC7600FF,#000000FF,#EC7600FF,#EC7600FF",o:"c1,c2,cf,sn,ch,be"}]},screenshot:"images/starter3.png"},{name:"Starter 2",json:{names:["ap","c4","w1b","t5","t3","t5","t5","t5","t3","t3","t3","t6","t6","c1","c1","wb1","wb1","h"],props:[{bp:"none",bc:"#C0C0C0",x:0,y:.95,z:-27.86},{x:0,y:-1.5,c:"#E1DABB",bh:0},{x:0,y:-1.45,rz:0,c:"#FFFFFF,#FF0000,#FFFFFF,#FF0000"},{x:-2,y:0,rz:0,c:"#FF3838,#FFFF00,#FFFF00,,#FFFF00"},{x:-2,y:1,rz:3.14,c:"#00FF00,#FFFF00,,,,#FFFF00"},{x:-1,y:1,rz:1.57,c:"#FF3838,#FFFF00,,,#FFFF00"},{x:1,y:1,rz:1.57,c:"#FF3838,#FFFF00,#FFFF00,,#FFFF00"},{x:2,y:0,rz:0,c:"#FF3838,#FFFF00,#FFFF00,,#FFFF00"},{x:2,y:1,rz:1.57,c:"#00FF00,#FFFF00"},{x:2,y:-1,rz:0,c:"#00FF00,#FFFF00"},{x:-2,y:-1,rz:-1.57,c:"#00FF00,#FFFF00"},{x:0,y:1,rz:1.57,c:"#FFFFFF,#FFFF00,,#FFFF00"},{x:0,y:2,rz:-1.57,c:"#FFFFFF,#FFFF00"},{x:1.5,y:1.5,c:"#FFFFFF",bh:"0.17,0.32,0.7,0.85,0.87",bc:"#FFFBAF"},{x:-1.5,y:1.5,c:"#FFFFFF",bh:"0.89,0.9,0.56,0.46,0.22",bc:"#FFFBAF"},{x:-1.15,y:0,rz:0,c:"#BFBFBF,#00FF00,#ADADAD,#00FF00,#FF7F00",wl:.1,nh:0},{x:-1.15,y:0,rz:0,c:"#BFBFBF,#00FF00,#ADADAD,#00FF00,#FF7F00",wl:.1,nh:0},{x:0,y:-.9,c:"#EC7600FF,#000000FF,#EC7600FF,#EC7600FF",o:"c1,c2,cf,sn,ch,be"}]},screenshot:"images/starter2.png"},{name:"Starter 1",json:{names:["ap","c4","wb1","hc","w2a","h3","h"],props:[{bp:"none",bc:"#C0C0C0",x:-.05,y:-.52,z:-13},{x:0,y:-1.5,c:"#E1DABB",bh:0},{x:-1.15,y:0,rz:0,c:"#BFBFBF,#00FF00,#ADADAD,#00FF00,#FF7F00",wl:.8951413966187282,nh:0},{x:1,y:-.25,rz:0,c:"#FF0000,#FFFF00,#00FF00,#0000FF"},{x:-.5,y:-1.45,rz:0,c:"#0000FF"},{x:.75,y:-1.5,rz:0,c:"#00FF00"},{x:0,y:-.9,c:"#EC7600FF,#000000FF,#EC7600FF,#EC7600FF",o:"c1,c2,cf,sn,ch,be"}]},screenshot:"images/starter1.png"}],t._titleMaxChars=30,t}return __extends(z1067,e),Object.defineProperty(z1067.prototype,"isOpen",{get:function(){return this._isOpen},enumerable:!1,configurable:!0}),Object.defineProperty(z1067.prototype,"currentCageID",{get:function(){return c.app.habStorage.cageID},enumerable:!1,configurable:!0}),z1067.prototype.init=function(){this._createHTML(),c.app.builder&&(c.app.builder.subscribe(c.z1063.ACCESSORY_CHANGED,this.cageUpdated,this),c.app.builder.subscribe(c.z1063.ACCESSORY_ADDED,this.cageUpdated,this)),c.app.habStorage.subscribe(c.z1074.AFTER_NEW_EVENT,this.onAfterCageAdded,this),c.app.habStorage.subscribe(c.z1074.AFTER_z1048_DELETED,this.onAfterCageDeleted,this),this._myHomesDiv=document.querySelector("#myHomes .horiz-scroll-cont"),this._starterHomesDiv=document.querySelector("#starterHomes .horiz-scroll-cont"),this._navMyHomes=new z1082("#myHomes","#myHomes .horiz-scroll-cont"),this._navStarterHomes=new z1082("#starterHomes","#starterHomes .horiz-scroll-cont"),this.loadMenu();var t=document.getElementById("start");this._div=t,this._div.addEventListener("click",this.onPointerUp.bind(this)),this._scrollDiv1=new z1081("#myHomes .horiz-scroll-cont"),this._scrollDiv2=new z1081("#starterHomes .horiz-scroll-cont")},z1067.prototype._createHTML=function(){var t=c.z1073.CreateHTMLElementFromString("\n            <div id=\"close-btn-start\" class='screen-close-btn'>\n                <span class='icon-clear'></span>\n            </div>\n            ");document.getElementById("start").appendChild(t);var e=document.querySelector("#save-shared-btn");e||((e=document.createElement("button")).innerHTML="<span class='icon-check'></span> save",e.id="save-shared-btn",document.querySelector("#main").appendChild(e),e.addEventListener("click",this.saveCage.bind(this)))},z1067.prototype.cageUpdated=function(){this._cageUpdated=!0},z1067.prototype.onPointerUp=function(t){if(!(this._scrollDiv1&&this._scrollDiv1.isDragging||this._scrollDiv2&&this._scrollDiv2.isDragging)){var e,o=t.target;o.dataset&&o.dataset.cageid?e=o.dataset:o.parentNode&&o.parentNode.dataset&&o.parentNode.dataset.cageid&&(e=o.parentNode.dataset);var i=!1;if(e){var n=parseInt(e.cageid),s=document.getElementById("title-text"),a=document.getElementById("title-input");if(n)this.currentCageID!=n&&(e.cagename?(s.textContent=e.cagename.substring(0,this._titleMaxChars),a.value=s.textContent):(s.textContent="",a.value=""),c.app.removeHab(),c.app.habStorage.loadCage(n),this.selectButton("button_"+n),document.getElementById("main").classList.remove("shared-home"),document.getElementById("main").classList.remove("starter-home")),i=!0;else if(null!=e.starterIndex){e.cagename?(s.textContent=e.cagename,a.value=e.cagename):(s.textContent="",a.value=""),c.app.removeHab();var r=this._starterCages[e.starterIndex].json;c.z1073.LoadObjectsFromJSON(r),this.selectButton("button_starter"+e.starterIndex),document.getElementById("main").classList.remove("shared-home"),document.getElementById("main").classList.add("starter-home"),i=!0}else this.loadSharedHome(),i=!0}i&&(this.closeScreen(),c.app.addToHistory("main"))}},z1067.prototype.loadSharedHome=function(){document.getElementById("title-text").textContent="",c.app.removeHab(),c.z1073.LoadObjectsFromJSON(this.sharedCageJSON),c.app.addz1062sToCages(),c.app.loadHamsMemory(),this.selectButton("button_shared"),document.getElementById("main").classList.add("shared-home"),document.getElementById("main").classList.remove("starter-home")},z1067.prototype.selectButton=function(t){for(var e=document.getElementsByClassName("cage-button"),o=0;o<e.length;o++)e[o].classList.remove("selected");var i=document.getElementById(t);i&&i.classList.add("selected")},z1067.prototype.closeScreen=function(){c.app.showMainUI(),this._isOpen=!1,document.getElementById("start").style.visibility="hidden",this._div.removeEventListener("pointermove",this._bindedOnPointerMove)},z1067.prototype.updateScreenshot=function(t){var e=this.currentCageID,o=document.getElementById("img_"+e);o&&(o.src=URL.createObjectURL(t),this._cageUpdated=!1,c.app.habStorage.updateScreenshot(e,t).then(function(t){}))},z1067.prototype.openScreen=function(){c.app.hideMainUI();var t=!(this._isOpen=!0),e=this.currentCageID;if(e){var o=document.getElementById("img_"+e);if(o&&""!=o.src&&(t=!0),this._cageUpdated||!t){var i=!1;c.app.builder&&c.app.builder.buildMenu.activez1092Menu&&(c.app.builder.buildMenu.hide(),i=!0),c.app.graphicsHelper.scene.render(),c.app.graphicsHelper.takeScreenshot(this.updateScreenshot.bind(this)),i&&c.app.builder&&c.app.builder.buildMenu.show()}this.selectButton("button_"+this.currentCageID)}document.getElementById("start").style.visibility="visible",this._div.addEventListener("pointermove",this._bindedOnPointerMove)},z1067.prototype.loadMenu=function(){if(c.app.habStorage){var s=this;c.app.habStorage.getCages().then(function(t){for(var e=document.querySelector("#myHomes .instructions"),o=0;o<t.length;o++){var i=t[o],n=void 0;i.screenshot&&(n=URL.createObjectURL(i.screenshot)),s.addCageButton(s._myHomesDiv,"button_"+i.id,i.id,i.name,n),e.classList.remove("is-visible")}0==t.length&&e.classList.add("is-visible"),s._navMyHomes.refreshButtons()});for(var t=this._starterCages,e=0;e<t.length;e++){var o=t[e];s.addCageButton(s._starterHomesDiv,"button_starter"+e,null,o.name,o.screenshot,e)}s._navStarterHomes.refreshButtons()}},z1067.prototype.addCageButton=function(t,e,o,i,n,s){var a=t,r=document.createElement("div");r.classList.add("cage-button"),r.id=e;var c=document.createElement("img");c.draggable=!1,c.width=250,c.height=250,c.id="img_"+o,c.classList.add("cage-screenshot"),c.dataset.cageid=o,c.dataset.cagename=i,null!=s&&(c.dataset.starterIndex=s),c.addEventListener("dragstart",this._preventDragImageFireFox),n&&(c.src=n);var d=document.createElement("div");d.id="name_"+o,d.classList.add("cage-name");var p=document.createElement("span");p.textContent=i.substring(0,this._titleMaxChars),d.appendChild(p),r.appendChild(d),r.appendChild(c),a.insertBefore(r,a.firstChild)},z1067.prototype._preventDragImageFireFox=function(t){t.preventDefault()},z1067.prototype.updateCageName=function(t){var e=this.currentCageID,o=document.getElementById("name_"+e);o&&(o.textContent=t.substring(0,this._titleMaxChars))},z1067.prototype.onAfterCageAdded=function(t){var e=document.getElementById("title-input").value;this.addCageButton(this._myHomesDiv,"button_"+t,t,e),this.takeScreenshot()},z1067.prototype.onAfterCageDeleted=function(t){document.getElementById("title-input").value="",document.getElementById("title-text").textContent="",this.removeCageButton(t),this.openScreen()},z1067.prototype.removeCageButton=function(t){var e=document.getElementById("button_"+t);e&&(this._myHomesDiv.removeChild(e),0==this._myHomesDiv.children.length&&document.querySelector("#myHomes .instructions").classList.add("is-visible"))},z1067.prototype.takeScreenshot=function(){var t=!1;c.app.builder&&c.app.builder.buildMenu.activez1092Menu&&(c.app.builder.buildMenu.hide(),t=!0),c.app.graphicsHelper.scene.render(),this._updateScreenShotBinded||(this._updateScreenShotBinded=this.updateScreenshot.bind(this)),c.app.graphicsHelper.takeScreenshot(this._updateScreenShotBinded),t&&c.app.builder&&c.app.builder.buildMenu.show()},z1067.prototype.addShared=function(t){if(!document.getElementById("sharedHomes")){var e=document.getElementById("start"),o=c.z1073.CreateHTMLElementFromString('<div id="sharedHomes">\n                        <h2>Shared With Me</h2>\n                        <div class="horiz-scroll-cont">\n                        </div>\n                    </div>'),i=document.getElementById("myHomes");e.insertBefore(o,i)}this.sharedCageJSON=t;var n=!1;c.app.builder&&c.app.builder.buildMenu.activez1092Menu&&(c.app.builder.buildMenu.hide(),n=!0),c.app.graphicsHelper.scene.render();var s=this;c.app.graphicsHelper.takeScreenshot(function(t){var e=URL.createObjectURL(t),o=document.querySelector("#sharedHomes .horiz-scroll-cont");s.addCageButton(o,"button_shared",null,"",e)}),n&&c.app.builder&&c.app.builder.buildMenu.show(),this.selectButton("button_shared"),document.getElementById("main").classList.add("shared-home"),document.getElementById("main").classList.remove("starter-home")},z1067.prototype.saveCage=function(){c.app.saveCage();var t=document.getElementById("sharedHomes");t&&(t.style.display="none");var e=document.querySelector("#myHomes .instructions");e&&e.classList.remove("is-visible"),document.getElementById("main").classList.remove("shared-home"),document.getElementById("main").classList.remove("starter-home"),c.app.showBuildScreen()},z1067.prototype.loadStarterCage=function(t){void 0===t&&(t=0),t=this._starterCages.length-1+t;var e=this._starterCages[t].json;c.z1073.LoadObjectsFromJSON(e),this.selectButton("button_starter"+t),document.getElementById("main").classList.add("starter-home")},z1067.prototype.getStarterCageJSON=function(t){return void 0===t&&(t=0),t=this._starterCages.length-1+t,this._starterCages[t].json},z1067.z4=[BABYLON.Vector3.Zero()],z1067}(c.Controller);c.z1067=t}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z762(){return null!==t&&t.apply(this,arguments)||this}return __extends(z762,t),z762.prototype.update=function(){e.app.registerOnPointerUp(e.TubeStraight.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.TubeCurved.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.TubeCurved2.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.TubeTee.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.TubeCap.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.TubeCross.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Cage.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Cage2x2.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Cage2x3.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Cage2x4.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Cage3x2.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Cage3x3.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Cage3x4.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Cage4x2.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Cage4x3.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Cage4x4.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Bedding.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.BeddingSides.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Platform1.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Platform2.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.SimpleChew.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.SimpleChew2.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Bridge.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Swing.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.WaterBottle1.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.WaterBottle2.name,e.app.setClickPoint,e.app)},z762}(z767),t.z762=o}(z0||(z0={})),function(a){var t,e;t=a.z156||(a.z156={}),e=function(e){function z674(){var t=e.call(this)||this;return t.bindedMoveCameraToPointerDown=void 0,t.bindedOnPointerUp=void 0,t.bindedOnPointerDown=void 0,t.eventsAdded=!1,t.pointerDownID=-1,t.multiTouch=!1,t.lastFrameMoveCameraToPointerDown=0,t.bindedMoveCameraToPointerDown=t.moveCameraToPointerDown.bind(t),t.bindedOnPointerUp=t.onPointerUp.bind(t),t.bindedOnPointerDown=t.onPointerDown.bind(t),t}return __extends(z674,e),z674.prototype.update=function(t){this.addEventListeners()},z674.prototype.addEventListeners=function(){if(!this.eventsAdded){var t=document.getElementById("main");t.addEventListener("pointermove",this.bindedMoveCameraToPointerDown),a.app.registerOnPointerDown("",this.onPointerDown,this),t.addEventListener("pointerup",this.bindedOnPointerUp),t.addEventListener("pointercancel",this.bindedOnPointerUp),t.addEventListener("pointerleave",this.bindedOnPointerUp),this.eventsAdded=!0}},z674.prototype.removeEventListeners=function(){if(this.eventsAdded){var t=document.getElementById("main");t.removeEventListener("pointermove",this.bindedMoveCameraToPointerDown),a.app.unregisterOnPointerDown("",this.onPointerDown,this),t.removeEventListener("pointerup",this.bindedOnPointerUp),t.removeEventListener("pointercancel",this.bindedOnPointerUp),t.removeEventListener("pointerleave",this.bindedOnPointerUp),this.eventsAdded=!1}},z674.prototype.onPointerUp=function(t){this.multiTouch=!1},z674.prototype.onPointerDown=function(t,e){var o=e;o&&o.parent&&(o=o.parent).parent&&(o=o.parent),o&&o.accType==a.z1044.z1048?this.pointerDownID=null:this.multiTouch||(this.pointerDownID=t.event.pointerId)},z674.prototype.moveCameraToPointerDown=function(t){if(null!=this.pointerDownID){var e=a.app.builder.buildMenu;if(!e.activez1092Menu||e.activez1092Menu.hidden){var o=!1;if(a.app.multiTouch)this.multiTouch=!0;else if(!this.multiTouch){this.pointerDownID!=t.pointerId&&(this.pointerDownID=t.pointerId,o=!0),1<a.app.frameNum-this.lastFrameMoveCameraToPointerDown&&(o=!0),this.lastFrameMoveCameraToPointerDown=a.app.frameNum,a.app.graphicsHelper.setMoveCameraPointer(t.clientX,t.clientY,o);var i=a.app.pointerDownStartPos,n=i.x-t.clientX,s=i.y-t.clientY;n*n+s*s>a.app.distSqForPointerMove&&(a.app.pointerDownHasMoved=!0)}}}},z674}(z767),t.z674=e}(z0||(z0={})),function(r){var t,e;t=r.z156||(r.z156={}),e=function(e){function z673(){var t=e.call(this)||this;return t.bindedOnPointerDown=void 0,t.bindedOnPointerMove=void 0,t.bindedOnPointerUp=void 0,t.eventsAdded=!1,t.pointerDownID=-1,t.multiTouch=!1,t.lastPointerX=null,t.lastPointerY=null,t.pointerDownFrameNum=0,t.pointerIsOnHam=!1,t.lastMovePointer=new OIMO.Vec3,t.dragging=!1,t.hamHitPoint=BABYLON.Vector3.Zero(),t.lastFrameMoveCameraToPointerDown=0,t.tempVec=new OIMO.Vec3,t.bindedOnPointerDown=t.onPointerDown.bind(t),t.bindedOnPointerUp=t.onPointerUp.bind(t),t.bindedOnPointerMove=t.onPointerMove.bind(t),t}return __extends(z673,e),z673.prototype.update=function(t){this.addEventListeners()},z673.prototype.addEventListeners=function(){if(!this.eventsAdded){var t=document.getElementById("main");t&&(t.addEventListener("pointerdown",this.bindedOnPointerDown),t.addEventListener("pointerup",this.bindedOnPointerUp),t.addEventListener("pointercancel",this.bindedOnPointerUp),t.addEventListener("pointerout",this.bindedOnPointerUp),t.addEventListener("pointerleave",this.bindedOnPointerUp),t.addEventListener("pointermove",this.bindedOnPointerMove),r.app.registerOnPointerDown(r.SimpleChew.name,this.onPointerDownBJS,this),r.app.registerOnPointerDown(r.SimpleChew2.name,this.onPointerDownBJS,this),this.eventsAdded=!0)}},z673.prototype.removeEventListeners=function(){if(this.eventsAdded){var t=document.getElementById("main");t&&(t.removeEventListener("pointerdown",this.bindedOnPointerDown),t.removeEventListener("pointerup",this.bindedOnPointerUp),t.removeEventListener("pointercancel",this.bindedOnPointerUp),t.removeEventListener("pointerout",this.bindedOnPointerUp),t.removeEventListener("pointerleave",this.bindedOnPointerUp),t.removeEventListener("pointermove",this.bindedOnPointerMove),r.app.unregisterOnPointerDown(r.SimpleChew.name,this.onPointerDownBJS,this),r.app.unregisterOnPointerDown(r.SimpleChew2.name,this.onPointerDownBJS,this),this.eventsAdded=!1)}},z673.prototype.doNudge=function(){var t=this.hamHitPoint,e=this.chew.draggerBody;this.tempVec.x=e.position.x-t.x,this.tempVec.y=e.position.y-t.y,this.tempVec.z=0,this.tempVec.normalize(this.tempVec),this.tempVec.x*=5,this.tempVec.y*=5,this.tempVec.z*=5,e.linearVelocity.addEqual(this.tempVec)},z673.prototype.onPointerDown=function(t){this.lastPointerX=t.x,this.lastPointerY=t.y},z673.prototype.onPointerUp=function(t){if(r.app.frameNum-this.pointerDownFrameNum<10)r.app.graphicsHelper.scene,t.x,t.y;this.chew&&this.dragging&&this.stopDragging(),this.multiTouch=!1,this.pointerDownID=null,this.lastPointerX=null,this.lastPointerY=null,this.chew=null,this.dragging=!1,this.dragBody=null,this.startDragCage=null},z673.prototype.onPointerDownBJS=function(t,e){this.multiTouch||(this.chew=e,this.pointerDownID=t.event.pointerId,this.pointerDownFrameNum=r.app.frameNum),this.lastPointerX=t.x,this.lastPointerY=t.y},z673.prototype.onPointerMove=function(t){if(this.chew&&this.dragging){var e=this.chew.draggerBody;r.app.graphicsHelper.getPlanePositionAtScreenXY(t.x,t.y,e.position.z,this.tempVec);var o=this.tempVec.x-this.lastMovePointer.x,i=this.tempVec.y-this.lastMovePointer.y,n=.25;if(n*n<o*o+i*i)return void this.stopDragging();if((n=.5)*n<(o=this.tempVec.x-this.dragBody.position.x)*o+(i=this.tempVec.y-this.dragBody.position.y)*i)return void this.stopDragging();var s=this.chew.draggerBody.linearVelocity;if(36<s.x*s.x+s.y*s.y)return void this.stopDragging();e.position.x=this.tempVec.x,e.position.y=this.tempVec.y,e.position.z=this.tempVec.z,this.lastMovePointer.x=this.tempVec.x,this.lastMovePointer.y=this.tempVec.y,this.lastMovePointer.z=this.tempVec.z}else if(this.chew){r.app.graphicsHelper.getPlanePositionAtScreenXY(t.x,t.y,this.chew.position.z,this.tempVec);var a=this.chew.draggerBody;0<z1.distanceSquaredXY(this.tempVec,a.position)&&this.startDragging(t),this.lastMovePointer.x=this.tempVec.x,this.lastMovePointer.y=this.tempVec.y,this.lastMovePointer.z=this.tempVec.z}this.lastPointerX=t.x,this.lastPointerY=t.y},z673.prototype.startDragging=function(t){if(this.chew&&!this.dragging){this.chew.draggerBody.linearVelocity.x=0,this.chew.draggerBody.linearVelocity.y=0,this.chew.draggerBody.linearVelocity.z=0,r.app.graphicsHelper.getPlanePositionAtScreenXY(t.x,t.y,this.chew.position.z,this.tempVec);var e=this.chew.dynamicBody,o=this.chew.draggerBody;this.dragBody=e,o.position.x=e.position.x,o.position.y=e.position.y,o.position.z=e.position.z,this.lastMovePointer.x=e.position.x,this.lastMovePointer.y=e.position.y,this.lastMovePointer.z=e.position.z;var i=e.shapes.radius,n=o.shapes.radius;this.chew.addDragJointAt(e.position,e,o,i,n),this.chew.isDragging=!0,this.dragging=!0}},z673.prototype.stopDragging=function(){this.chew&&(this.dragging=!1,this.chew.isDragging=!1,this.chew.removeDragObjJoint(),this.dragBody=null)},z673.prototype.meshIsHam=function(t){if(this.chew)return t==this.chew.mesh},z673}(z767),t.z673=e}(z0||(z0={})),function(r){var t,e;t=r.z156||(r.z156={}),e=function(e){function z672(){var t=e.call(this)||this;return t.bindedOnPointerDown=void 0,t.bindedOnPointerMove=void 0,t.bindedOnPointerUp=void 0,t.bindedMeshIsHam=void 0,t.eventsAdded=!1,t.pointerDownID=-1,t.multiTouch=!1,t.lastPointerX=null,t.lastPointerY=null,t.pointerDownFrameNum=0,t.pointerIsOnHam=!1,t.lastMovePointer=new OIMO.Vec3,t._dragging=!1,t.hamHitPoint=BABYLON.Vector3.Zero(),t.lastFrameMoveCameraToPointerDown=0,t.tempVec=new OIMO.Vec3,t.bindedOnPointerDown=t.onPointerDown.bind(t),t.bindedOnPointerUp=t.onPointerUp.bind(t),t.bindedOnPointerMove=t.onPointerMove.bind(t),t.bindedMeshIsHam=t.meshIsHam.bind(t),t}return __extends(z672,e),Object.defineProperty(z672.prototype,"dragging",{get:function(){return this._dragging},set:function(t){this._dragging=t},enumerable:!1,configurable:!0}),z672.prototype.update=function(t){this.addEventListeners()},z672.prototype.addEventListeners=function(){if(!this.eventsAdded){var t=document.getElementById("main");t&&(t.addEventListener("pointerdown",this.bindedOnPointerDown),t.addEventListener("pointerup",this.bindedOnPointerUp),t.addEventListener("pointercancel",this.bindedOnPointerUp),t.addEventListener("pointerout",this.bindedOnPointerUp),t.addEventListener("pointerleave",this.bindedOnPointerUp),t.addEventListener("pointermove",this.bindedOnPointerMove),r.app.registerOnPointerDown(r.z1062.name,this.onPointerDownBJS,this),this.eventsAdded=!0)}},z672.prototype.removeEventListeners=function(){if(this.eventsAdded){var t=document.getElementById("main");t&&(t.removeEventListener("pointerdown",this.bindedOnPointerDown),t.removeEventListener("pointerup",this.bindedOnPointerUp),t.removeEventListener("pointercancel",this.bindedOnPointerUp),t.removeEventListener("pointerout",this.bindedOnPointerUp),t.removeEventListener("pointerleave",this.bindedOnPointerUp),t.removeEventListener("pointermove",this.bindedOnPointerMove),r.app.unregisterOnPointerDown(r.z1062.name,this.onPointerDownBJS,this),this.eventsAdded=!1)}},z672.prototype.doNudge=function(){var t=this.hamHitPoint,e=this.getClosestBody(t);this.tempVec.x=e.position.x-t.x,this.tempVec.y=e.position.y-t.y,this.tempVec.z=0,this.tempVec.normalize(this.tempVec),this.tempVec.x*=5,this.tempVec.y*=5,this.tempVec.z*=5,e.linearVelocity.addEqual(this.tempVec)},z672.prototype.getClosestBody=function(t){var e=this.ham.physics,o=e.frontBody.body,i=e.middleBody.body,n=e.rearBody.body,s=z1.distanceSquaredXY(o.position,t),a=z1.distanceSquaredXY(i.position,t),r=z1.distanceSquaredXY(n.position,t),c=n;return s<a&&s<r?c=o:a<s&&a<r&&(c=i),c},z672.prototype.onPointerDown=function(t){this.lastPointerX=t.x,this.lastPointerY=t.y},z672.prototype.onPointerUp=function(t){if(r.app.frameNum-this.pointerDownFrameNum<10){var e=r.app.graphicsHelper.scene,o=t.x,i=t.y,n=e.pick(o,i,this.bindedMeshIsHam);n.hit&&(this.hamHitPoint.x=n.pickedPoint.x,this.hamHitPoint.y=n.pickedPoint.y,this.hamHitPoint.z=n.pickedPoint.z,this.doNudge())}this.ham&&this.dragging&&this.stopDragging(),this.multiTouch=!1,this.pointerDownID=null,this.lastPointerX=null,this.lastPointerY=null,this.ham=null,this.dragging=!1,this.dragBody=null,this.startDragCage=null},z672.prototype.onPointerDownBJS=function(t,e){this.multiTouch||(this.ham=e,this.pointerDownID=t.event.pointerId,this.pointerDownFrameNum=r.app.frameNum),this.lastPointerX=t.x,this.lastPointerY=t.y},z672.prototype.onPointerMove=function(t){if(this.ham&&this.dragging){var e=this.ham.physics.draggerBody;r.app.graphicsHelper.getPlanePositionAtScreenXY(t.x,t.y,e.position.z,this.tempVec);var o=this.tempVec.x-this.lastMovePointer.x,i=this.tempVec.y-this.lastMovePointer.y,n=.25;if(n*n<o*o+i*i)return void this.stopDragging();if((n=.5)*n<(o=this.tempVec.x-this.dragBody.position.x)*o+(i=this.tempVec.y-this.dragBody.position.y)*i)return void this.stopDragging();var s=this.ham.physics.middleBody.body.linearVelocity;if(36<s.x*s.x+s.y*s.y)return void this.stopDragging();e.position.x=this.tempVec.x,e.position.y=this.tempVec.y,e.position.z=this.tempVec.z,this.lastMovePointer.x=this.tempVec.x,this.lastMovePointer.y=this.tempVec.y,this.lastMovePointer.z=this.tempVec.z}else if(this.ham){r.app.graphicsHelper.getPlanePositionAtScreenXY(t.x,t.y,this.ham.position.z,this.tempVec);var a=this.getClosestBody(this.tempVec);.2*.2<z1.distanceSquaredXY(this.tempVec,a.position)&&this.startDragging(t),this.lastMovePointer.x=this.tempVec.x,this.lastMovePointer.y=this.tempVec.y,this.lastMovePointer.z=this.tempVec.z}this.lastPointerX=t.x,this.lastPointerY=t.y},z672.prototype.startDragging=function(t){if(this.ham&&!this.dragging){r.app.graphicsHelper.getPlanePositionAtScreenXY(t.x,t.y,this.ham.position.z,this.tempVec);var e=this.getClosestBody(this.tempVec),o=this.ham.physics.draggerBody;this.dragBody=e,o.position.x=e.position.x,o.position.y=e.position.y,o.position.z=e.position.z,this.lastMovePointer.x=e.position.x,this.lastMovePointer.y=e.position.y,this.lastMovePointer.z=e.position.z;var i=e.shapes.radius,n=o.shapes.radius;this.ham.physics.addDragJointAt(e.position,e,o,i,n),this.ham.isDragging=!0,this.ham.changeState(r.z118.name),this.ham.changeState(r.z68.name),this.dragging=!0}},z672.prototype.stopDragging=function(){this.ham&&(this.dragging=!1,this.ham.isDragging=!1,this.ham.physics.removeDragObjJoint(),this.dragBody=null)},z672.prototype.meshIsHam=function(t){if(this.ham)return t==this.ham.mesh},z672}(z767),t.z672=e}(z0||(z0={})),function(l){var t,e;t=l.z156||(l.z156={}),e=function(e){function z671(){var t=e.call(this)||this;return t.bindedOnPointerDown=void 0,t.bindedOnPointerMove=void 0,t.bindedOnPointerUp=void 0,t.bindedUpdateSwing=void 0,t.eventsAdded=!1,t.pointerDownID=-1,t.multiTouch=!1,t.lastPointerX=null,t.lastPointerY=null,t.lastAng=0,t.pointerDownFrameNum=0,t.pointerIsOnHam=!1,t.dragging=!1,t.dragSwingPosition=new OIMO.Vec3(0,0,0),t.dragSwingPoint=new OIMO.Vec3(0,0,0),t.dragVel=new OIMO.Vec3(0,0,0),t.offsetMat=BABYLON.Matrix.Identity(),t.currDragAng=0,t.multDragVel=100,t.lastFrameMoveCameraToPointerDown=0,t._lastMoveFrame=0,t.tempVec=new OIMO.Vec3,t.tempVec2=new OIMO.Vec3,t.bindedOnPointerDown=t.onPointerDown.bind(t),t.bindedOnPointerUp=t.onPointerUp.bind(t),t.bindedOnPointerMove=t.onPointerMove.bind(t),t.bindedUpdateSwing=t.updateSwing.bind(t),t}return __extends(z671,e),z671.prototype.update=function(t){this.addEventListeners()},z671.prototype.addEventListeners=function(){if(!this.eventsAdded){var t=document.getElementById("main");t&&(t.addEventListener("pointerdown",this.bindedOnPointerDown),t.addEventListener("pointerup",this.bindedOnPointerUp),t.addEventListener("pointercancel",this.bindedOnPointerUp),t.addEventListener("pointerout",this.bindedOnPointerUp),t.addEventListener("pointerleave",this.bindedOnPointerUp),t.addEventListener("pointermove",this.bindedOnPointerMove),l.app.registerOnPointerDown("z1044"+l.z1044.SWING,this.onPointerDownBJS,this),this.eventsAdded=!0)}},z671.prototype.removeEventListeners=function(){if(this.eventsAdded){var t=document.getElementById("main");t&&(t.removeEventListener("pointerdown",this.bindedOnPointerDown),t.removeEventListener("pointerup",this.bindedOnPointerUp),t.removeEventListener("pointercancel",this.bindedOnPointerUp),t.removeEventListener("pointerout",this.bindedOnPointerUp),t.removeEventListener("pointerleave",this.bindedOnPointerUp),t.removeEventListener("pointermove",this.bindedOnPointerMove),l.app.unregisterOnPointerDown("z1044"+l.z1044.SWING,this.onPointerDownBJS,this),this.eventsAdded=!1)}},z671.prototype.onPointerDown=function(t){this.lastPointerX=t.x,this.lastPointerY=t.y,this.startDragging(t)},z671.prototype.onPointerUp=function(t){if(l.app.frameNum-this.pointerDownFrameNum<10)l.app.graphicsHelper.scene,t.x,t.y;this.swing&&this.dragging&&(this.swing.bodyBottom.linearVelocity.x=this.dragVel.x*this.multDragVel,this.swing.bodyBottom.linearVelocity.y=this.dragVel.y*this.multDragVel,this.stopDragging()),this.dragVel.x=0,this.dragVel.y=0,this.multiTouch=!1,this.pointerDownID=null,this.lastPointerX=null,this.lastPointerY=null,this.swing=null,this.dragging=!1,this.dragBody=null,this.startDragCage=null},z671.prototype.updateSwing=function(){if(this.swing){if(this.dragging){var t=this.swing.bodyBottom.position,e=this.swing.position.x,o=this.swing.position.y+this.swing.armY,i=z767.z4[2];i.x=this.dragSwingPoint.x-e,i.y=this.dragSwingPoint.y-o,i.z=0,BABYLON.Vector3.TransformCoordinatesToRef(i,this.offsetMat,i),i.x+=e,i.y+=o,this.dragVel.x=i.x-t.x,this.dragVel.y=i.y-t.y,t.x=i.x,t.y=i.y,this.swing.bodyBottom.linearVelocity.x=0,this.swing.bodyBottom.linearVelocity.y=0,this.swing.bodyBottom.linearVelocity.z=0,this.swing.bodyBottom.angularVelocity.x=0,this.swing.bodyBottom.angularVelocity.y=0,this.swing.bodyBottom.angularVelocity.z=0;var n=z767.z4[0],s=z767.z4[1];s.x=(e-t.x)/this.swing.armLen,s.y=(o-t.y)/this.swing.armLen,s.z=0,BABYLON.Vector3.CrossToRef(s,BABYLON.Axis.Z,n);var a=z767.tempQuats[0];BABYLON.Quaternion.RotationQuaternionFromAxisToRef(n,s,BABYLON.Axis.Z,a);var r=this.swing.bodyBottom.orientation;r.x=a.x,r.y=a.y,r.z=a.z,r.s=a.w,this.swing.bodyBottom.syncShapes(),this.swing.checkLimitRotToCeiling()}this.swing.bodyBottom.awake(),0<=this.pointerDownID&&requestAnimationFrame(this.bindedUpdateSwing)}},z671.prototype.onPointerDownBJS=function(t,e){this.multiTouch||(this.swing=e,this.pointerDownID=t.event.pointerId,this.pointerDownFrameNum=l.app.frameNum,requestAnimationFrame(this.bindedUpdateSwing)),this.lastPointerX=t.x,this.lastPointerY=t.y},z671.prototype.getSwingPosFromPointerPos=function(t,e,o,i){l.app.graphicsHelper.getPlanePositionAtScreenXY(e,o,t.position.z,i);var n=t.position.x,s=t.position.y+t.armY,a=i.x-n,r=i.y-s,c=Math.sqrt(a*a+r*r),d=a/c,p=r/c;i.x=n+d*t.armLen,i.y=s+p*t.armLen,i.z=t.position.z},z671.prototype.onPointerMove=function(t){var e=0,o=0;if(this.swing&&(this.getSwingPosFromPointerPos(this.swing,t.x,t.y,this.tempVec),e=this.tempVec.x,o=this.tempVec.y),this.swing&&this.dragging){if(this._lastMoveFrame==l.app.frameNum)return;this._lastMoveFrame=l.app.frameNum,this.dragSwingPoint.x=e,this.dragSwingPoint.y=o}else this.swing&&(l.app.graphicsHelper.getPlanePositionAtScreenXY(t.x,t.y,this.swing.position.z,this.tempVec),this.startDragging(t));this.lastPointerX=t.x,this.lastPointerY=t.y},z671.prototype.startDragging=function(t){if(this.swing&&!this.dragging){this.getSwingPosFromPointerPos(this.swing,t.x,t.y,this.dragSwingPoint);var e=this.swing.bodyBottom.rotation.elements,o=this.swing.position.x,i=this.swing.position.y+this.swing.armY,n=(this.offsetMat,z767.tempBabMats[0]),s=z767.tempBabMats[1],a=z767.z4[0],r=z767.z4[1],c=z767.z4[2];r.x=(o-this.dragSwingPoint.x)/this.swing.armLen,r.y=(i-this.dragSwingPoint.y)/this.swing.armLen,r.z=0,BABYLON.Vector3.CrossToRef(r,BABYLON.Axis.Z,a),BABYLON.Matrix.FromXYZAxesToRef(a,r,BABYLON.Axis.Z,n),a.x=e[0],a.y=e[3],a.z=e[6],r.x=e[1],r.y=e[4],r.z=e[7],c.x=e[2],c.x=e[5],c.x=e[8],BABYLON.Matrix.FromXYZAxesToRef(a,r,c,s),n.invert(),s.multiplyToRef(n,this.offsetMat),this.dragVel.x=0,this.dragVel.y=0,this.swing.isDraggingBottom=!0,this.dragging=!0}},z671.prototype.stopDragging=function(){this.swing&&(this.dragging=!1,this.dragBody=null,this.swing.isDraggingBottom=!1)},z671}(z767),t.z671=e}(z0||(z0={})),function(a){var t,e;t=a.z156||(a.z156={}),e=function(e){function z670(){var t=e.call(this)||this;return t.bindedOnPointerDown=void 0,t.bindedOnPointerMove=void 0,t.bindedOnPointerUp=void 0,t.eventsAdded=!1,t.pointerDownID=-1,t.multiTouch=!1,t.lastPointerX=null,t.lastPointerY=null,t.pointerDownFrameNum=0,t.pointerIsOnHam=!1,t.pointerDownWaterLevel=0,t.lastMovePointer=new OIMO.Vec3,t.hamHitPoint=BABYLON.Vector3.Zero(),t.lastFrameMoveCameraToPointerDown=0,t.tempVec=new OIMO.Vec3,t.bindedOnPointerDown=t.onPointerDown.bind(t),t.bindedOnPointerUp=t.onPointerUp.bind(t),t.bindedOnPointerMove=t.onPointerMove.bind(t),t}return __extends(z670,e),z670.prototype.update=function(t){this.addEventListeners()},z670.prototype.addEventListeners=function(){if(!this.eventsAdded){var t=document.getElementById("main");t&&(t.addEventListener("pointerdown",this.bindedOnPointerDown),t.addEventListener("pointerup",this.bindedOnPointerUp),t.addEventListener("pointermove",this.bindedOnPointerMove),a.app.registerOnPointerDown(a.WaterBottle1.name,this.onPointerDownBJS,this),a.app.registerOnPointerDown(a.WaterBottle2.name,this.onPointerDownBJS,this),this.eventsAdded=!0)}},z670.prototype.removeEventListeners=function(){if(this.eventsAdded){var t=document.getElementById("main");t&&(t.removeEventListener("pointerdown",this.bindedOnPointerDown),t.removeEventListener("pointerup",this.bindedOnPointerUp),t.removeEventListener("pointermove",this.bindedOnPointerMove),a.app.unregisterOnPointerDown(a.WaterBottle1.name,this.onPointerDownBJS,this),a.app.unregisterOnPointerDown(a.WaterBottle2.name,this.onPointerDownBJS,this),this.eventsAdded=!1)}},z670.prototype.onPointerDown=function(t){this.lastPointerX=t.x,this.lastPointerY=t.y},z670.prototype.onPointerUp=function(t){this.waterBottle&&this.pointerDownWaterLevel!=this.waterBottle.waterLevel&&this.waterBottle.saveSettings(),this.multiTouch=!1,this.pointerDownID=null,this.lastPointerX=null,this.lastPointerY=null,this.waterBottle=null},z670.prototype.onPointerDownBJS=function(t,e){if(!this.multiTouch){if(e.isMenuItem)return;this.waterBottle=e,this.pointerDownID=t.event.pointerId,this.pointerDownFrameNum=a.app.frameNum,a.app.graphicsHelper.getPlanePositionAtScreenXY(t.event.x,t.event.y,this.waterBottle.position.z,this.tempVec),this.lastMovePointer.x=this.tempVec.x,this.lastMovePointer.y=this.tempVec.y,this.lastMovePointer.z=this.tempVec.z;var o=this.waterBottle.radius;this.pointerDownWaterLevel=this.waterBottle.waterLevel,this.waterBottle.bodyWaterLineDynamic.position.x+=2*(Math.random()-.5)*o,this.waterBottle.bodyWaterLineDynamic.position.z+=2*(Math.random()-.5)*o,this.waterBottle.bodyWaterLineDynamic.shapes.updateProxy(),a.app.graphicsHelper.pauseDragCamera(!0)}this.lastPointerX=t.x,this.lastPointerY=t.y},z670.prototype.onPointerMove=function(t){if(this.waterBottle){a.app.graphicsHelper.getPlanePositionAtScreenXY(t.x,t.y,this.waterBottle.position.z,this.tempVec);var e=this.tempVec.y-this.lastMovePointer.y,o=this.waterBottle.bodyWaterLineStatic,i=o.position,n=o.shapes.position,s=this.waterBottle.height-.1;this.waterBottle.waterLevel+e>s?e=s-this.waterBottle.waterLevel:this.waterBottle.waterLevel+e<.1&&(e=this.waterBottle.waterLevel-.1),this.waterBottle.waterLevel+=e,i.y+=e,n.x=i.x,n.y=i.y,n.z=i.z,o.shapes.updateProxy(),this.lastMovePointer.x=this.tempVec.x,this.lastMovePointer.y=this.tempVec.y,this.lastMovePointer.z=this.tempVec.z,this.waterBottle.shapeWaterLine.forceUpdate=!0,this.waterBottle.shapeWaterLine.translate(0,e,0),a.app.graphicsHelper.pauseDragCamera(!0)}},z670.prototype.startDragging=function(t){this.waterBottle&&a.app.graphicsHelper.getPlanePositionAtScreenXY(t.x,t.y,this.waterBottle.position.z,this.tempVec)},z670}(z767),t.z670=e}(z0||(z0={})),function(r){var t,e;t=r.z156||(r.z156={}),e=function(e){function z669(){var t=e.call(this)||this;return t.bindedOnPointerDown=void 0,t.bindedOnPointerMove=void 0,t.bindedOnPointerUp=void 0,t.bindedUpdateWheel=void 0,t.eventsAdded=!1,t.pointerDownID=-1,t.multiTouch=!1,t.lastPointerX=null,t.lastPointerY=null,t.lastAng=0,t.pointerDownFrameNum=0,t.pointerIsOnHam=!1,t.lastMovePointer=new OIMO.Vec3,t.dragging=!1,t.hamHitPoint=BABYLON.Vector3.Zero(),t.angVel=0,t.lastFrameMoveCameraToPointerDown=0,t._lastMoveFrame=0,t.tempVec=new OIMO.Vec3,t.tempVec2=new OIMO.Vec3,t.bindedOnPointerDown=t.onPointerDown.bind(t),t.bindedOnPointerUp=t.onPointerUp.bind(t),t.bindedOnPointerMove=t.onPointerMove.bind(t),t.bindedUpdateWheel=t.updateWheel.bind(t),t}return __extends(z669,e),z669.prototype.update=function(t){this.addEventListeners()},z669.prototype.addEventListeners=function(){if(!this.eventsAdded){var t=document.getElementById("main");t&&(t.addEventListener("pointerdown",this.bindedOnPointerDown),t.addEventListener("pointerup",this.bindedOnPointerUp),t.addEventListener("pointercancel",this.bindedOnPointerUp),t.addEventListener("pointerout",this.bindedOnPointerUp),t.addEventListener("pointerleave",this.bindedOnPointerUp),t.addEventListener("pointermove",this.bindedOnPointerMove),r.app.registerOnPointerDown("z1044"+r.z1044.z1054,this.onPointerDownBJS,this),this.eventsAdded=!0)}},z669.prototype.removeEventListeners=function(){if(this.eventsAdded){var t=document.getElementById("main");t&&(t.removeEventListener("pointerdown",this.bindedOnPointerDown),t.removeEventListener("pointerup",this.bindedOnPointerUp),t.removeEventListener("pointercancel",this.bindedOnPointerUp),t.removeEventListener("pointerout",this.bindedOnPointerUp),t.removeEventListener("pointerleave",this.bindedOnPointerUp),t.removeEventListener("pointermove",this.bindedOnPointerMove),r.app.unregisterOnPointerDown("z1044"+r.z1044.z1054,this.onPointerDownBJS,this),this.eventsAdded=!1)}},z669.prototype.onPointerDown=function(t){this.lastPointerX=t.x,this.lastPointerY=t.y},z669.prototype.onPointerUp=function(t){if(r.app.frameNum-this.pointerDownFrameNum<10)r.app.graphicsHelper.scene,t.x,t.y;this.wheel&&this.dragging&&this.stopDragging(),this.multiTouch=!1,this.pointerDownID=null,this.lastPointerX=null,this.lastPointerY=null,this.wheel=null,this.dragging=!1,this.dragBody=null,this.startDragCage=null},z669.prototype.updateWheel=function(){if(this.wheel){if(this.angVel)this.tempVec2.x=0,this.tempVec2.y=0,this.tempVec2.z=this.angVel,this.wheel.body.angularVelocity.addEqual(this.tempVec2);else if(10<r.app.frameNum-this.pointerDownFrameNum)for(var t=this.wheel.body.angularVelocity.z=0;t<this.wheel.hamsters.length;t++)this.wheel.hamsters.data[t].tripping=0;if(20<Math.abs(this.angVel))for(t=0;t<this.wheel.hamsters.length;t++)this.wheel.hamsters.data[t].tripping=3;else for(t=0;t<this.wheel.hamsters.length;t++){var e=this.wheel.hamsters.data[t];e.tripping&&3!=e.tripping&&(e.tripping=0)}this.angVel=0,this.wheel.hamsters.length||this.wheel.body.awake(),0<=this.pointerDownID&&requestAnimationFrame(this.bindedUpdateWheel)}},z669.prototype.onPointerDownBJS=function(t,e){this.multiTouch||(this.wheel=e,this.pointerDownID=t.event.pointerId,this.pointerDownFrameNum=r.app.frameNum,requestAnimationFrame(this.bindedUpdateWheel)),this.lastPointerX=t.x,this.lastPointerY=t.y},z669.prototype.onPointerMove=function(t){if(this.wheel&&this.dragging){if(this._lastMoveFrame==r.app.frameNum)return;this._lastMoveFrame=r.app.frameNum;var e=this.wheel.body,o=this.wheel.body.position;r.app.graphicsHelper.getPlanePositionAtScreenXY(t.x,t.y,e.position.z,this.tempVec);var i=this.tempVec.x-o.x,n=this.tempVec.y-o.y,s=Math.atan2(n,i);this.angVel=50*z1.getAngDiff(s,this.lastAng),this.lastAng=s,this.lastMovePointer.x=this.tempVec.x,this.lastMovePointer.y=this.tempVec.y,this.lastMovePointer.z=this.tempVec.z}else if(this.wheel){r.app.graphicsHelper.getPlanePositionAtScreenXY(t.x,t.y,this.wheel.position.z,this.tempVec);var a=this.wheel.body;0<z1.distanceSquaredXY(this.tempVec,a.position)&&this.startDragging(t),this.lastMovePointer.x=this.tempVec.x,this.lastMovePointer.y=this.tempVec.y,this.lastMovePointer.z=this.tempVec.z}this.lastPointerX=t.x,this.lastPointerY=t.y},z669.prototype.startDragging=function(t){if(this.wheel&&!this.dragging){this.wheel.body.angularVelocity;var e=this.wheel.body.position;r.app.graphicsHelper.getPlanePositionAtScreenXY(t.x,t.y,this.wheel.position.z,this.tempVec);var o=this.tempVec.x-e.x,i=this.tempVec.y-e.y;this.lastAng=Math.atan2(i,o),this.dragging=!0}},z669.prototype.stopDragging=function(){this.wheel&&(this.dragging=!1,this.dragBody=null)},z669}(z767),t.z669=e}(z0||(z0={})),function(y){var t,e;t=y.z156||(y.z156={}),e=function(n){function z668(){var t=n.call(this)||this;t.foodInfo=[],t.dragFrames=0,t.lastDragFrame=0,t._pointerMoveReg=!1,t.prevPointerX=0,t.prevPointerY=0,t.pointerVelX=0,t.pointerVelY=0;for(var e=y.app.getz1064Items(),o=0;o<e.length;o++){var i=e[o];"treats"==i.category&&t.foodInfo.push(i)}return t}return __extends(z668,n),z668.prototype.update=function(t){y.app.registerOnPointerDown("",this.createRandomFoodToDrag,this),y.app.registerOnPointerUp("",this.dropFood,this)},z668.prototype.dragFood=function(t,e){var o=y.app.graphicsHelper;if(y.app.multiTouch)return this.dragging.recycle(),this.dragging=null,y.Food.Dragged=null,y.app.unregisterOnPointerMove("",this.dragFood,this),void(this._pointerMoveReg=!1);if(!y.Food.Dragged)return this.dragging=null,y.app.unregisterOnPointerMove("",this.dragFood,this),void(this._pointerMoveReg=!1);var i=o.scene,n=z767.z4[0];o.getPlanePositionAtScreenXY(i.pointerX,i.pointerY,this.dragging.dragPlaneZ,n),this.dragging.setPositionDrag(n.x,n.y,n.z,!1),y.app.frameNum!=this.lastDragFrame&&(this.dragFrames++,this.lastDragFrame=y.app.frameNum,this.pointerVelX=n.x-this.prevPointerX,this.pointerVelY=n.y-this.prevPointerY,this.prevPointerX=n.x,this.prevPointerY=n.y)},z668.prototype.dropFood=function(t,e){var o=y.app.graphicsHelper;if(this.dragging){var i,n=o.scene,s=-1.7;e&&e.accType==y.z1044.z1056&&(s=-1.9,i=e);var a=z767.z4[0];o.getPlanePositionAtScreenXY(n.pointerX,n.pointerY,s,a);var r=y.Cage.getCageAt(a.x,a.y,0);if(r){var c;if(i||(c=r.getz1092Under(a.x,a.y,-1,y.z1044.z1045)),c)s=-1,o.getPlanePositionAtScreenXY(n.pointerX,n.pointerY,s,a);else if(r.bedding)r.bedding.getHeightAt(a.x,-2,!0)>a.y&&(s=-1.96);if(this.dragging.setPositionDrag(a.x,a.y,s,!0),this.dragging.body){var d=0,p=0;if(1<this.dragFrames){d=this.pointerVelX,p=this.pointerVelY,this.dragging.body.linearVelocity.x=50*d,this.dragging.body.linearVelocity.y=50*p}else this.dragging.body.linearVelocity.x+=.04*Math.random()-.02;Math.abs(d)}}else{for(var l=0;l<y.z1062.activeObjects.length;l++){var u=y.z1062.activeObjects[l];u._targetPickUp==this.dragging&&(u._targetPickUp=null)}this.dragging.recycle()}y.app.unregisterOnPointerMove("",this.dragFood,this),this._pointerMoveReg=!1,y.Food.Dragged=null,this.dragging=null}},z668.prototype.createRandomFoodToDrag=function(t,e){this.dragFrames=0;var o=e;if(o&&o.parent&&(o=o.parent).parent&&(o=o.parent),o&&(o.accType==y.z1044.z1048||e.whiskers)){this.dragging,y.Food.Dragged&&this.dropFood(t,e);var i=y.app.foodManager.getRandomInactive();if(!i)return;this._pointerMoveReg?this._pointerMoveReg:y.app.registerOnPointerMove("",this.dragFood,this),i.init({skipAddToScene:!0,rz:Math.PI*Math.random()}),i.addToScene(),this.dragging=i,y.Food.Dragged=i,this.dragFood(t,e)}},z668}(z767),t.z668=e}(z0||(z0={})),function(a){var t,e;t=a.z156||(a.z156={}),e=function(e){function z667(){var t=e.call(this)||this;return t.bindedMoveCameraToPointerDown=void 0,t.bindedOnPointerUp=void 0,t.bindedOnPointerDown=void 0,t.eventsAdded=!1,t.pointerDownID=-1,t.multiTouch=!1,t.lastFrameMoveCameraToPointerDown=0,t.bindedMoveCameraToPointerDown=t.moveCameraToPointerDown.bind(t),t.bindedOnPointerUp=t.onPointerUp.bind(t),t.bindedOnPointerDown=t.onPointerDown.bind(t),t}return __extends(z667,e),z667.prototype.update=function(t){this.addEventListeners();var e=document.getElementById("zoom-ctn");e&&(e.style.visibility="visible")},z667.prototype.addEventListeners=function(){if(!this.eventsAdded){var t=document.getElementById("main");t.addEventListener("pointermove",this.bindedMoveCameraToPointerDown),t.addEventListener("pointerdown",this.bindedOnPointerDown),t.addEventListener("pointerup",this.bindedOnPointerUp),t.addEventListener("pointercancel",this.bindedOnPointerUp),t.addEventListener("pointerleave",this.bindedOnPointerUp),this.eventsAdded=!0}},z667.prototype.removeEventListeners=function(){if(this.eventsAdded){var t=document.getElementById("main");t.removeEventListener("pointermove",this.bindedMoveCameraToPointerDown),t.removeEventListener("pointerdown",this.bindedOnPointerDown),t.removeEventListener("pointerup",this.bindedOnPointerUp),t.removeEventListener("pointercancel",this.bindedOnPointerUp),t.removeEventListener("pointerleave",this.bindedOnPointerUp),this.eventsAdded=!1}},z667.prototype.onPointerUp=function(t){this.multiTouch=!1},z667.prototype.onPointerDown=function(t){this.multiTouch||(this.pointerDownID=t.pointerId)},z667.prototype.moveCameraToPointerDown=function(t){if(a.app.builder){var e=a.app.builder.buildMenu;if(e.activez1092Menu&&!e.activez1092Menu.hidden)return}var o=!1;if(a.app.multiTouch)this.multiTouch=!0;else if(!this.multiTouch){this.pointerDownID!=t.pointerId&&(this.pointerDownID=t.pointerId,o=!0),1<a.app.frameNum-this.lastFrameMoveCameraToPointerDown&&(o=!0),this.lastFrameMoveCameraToPointerDown=a.app.frameNum,a.app.graphicsHelper.setMoveCameraPointer(t.clientX,t.clientY,o);var i=a.app.pointerDownStartPos,n=i.x-t.clientX,s=i.y-t.clientY;n*n+s*s>a.app.distSqForPointerMove&&(a.app.pointerDownHasMoved=!0)}},z667}(z767),t.z667=e}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z663(){return null!==t&&t.apply(this,arguments)||this}return __extends(z663,t),z663.prototype.update=function(t){e.app.registerOnPointerUp(e.WaterBottle.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Wheel1a.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Wheel1b.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Wheel1c.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Wheel2a.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Wheel2b.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Wheel2c.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Bowl1.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.Bowl2.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.House.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.House2.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.House3.name,e.app.setClickPoint,e.app),e.app.registerOnPointerUp(e.House4.name,e.app.setClickPoint,e.app),e.app.registerOnPointerDown("",e.app.onPointerDown,e.app),e.app.registerOnPointerUp("",e.app.onPointerUp,e.app)},z663}(z767),t.z663=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z657(){return null!==t&&t.apply(this,arguments)||this}return __extends(z657,t),z657.prototype.update=function(t){z641.getz767(e.z674).removeEventListeners()},z657}(z767),e.z657=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z656(){return null!==t&&t.apply(this,arguments)||this}return __extends(z656,t),z656.prototype.update=function(t){z641.getz767(e.z673).removeEventListeners()},z656}(z767),e.z656=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z655(){return null!==t&&t.apply(this,arguments)||this}return __extends(z655,t),z655.prototype.update=function(t){z641.getz767(e.z672).removeEventListeners()},z655}(z767),e.z655=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z654(){return null!==t&&t.apply(this,arguments)||this}return __extends(z654,t),z654.prototype.update=function(t){z641.getz767(e.z671).removeEventListeners()},z654}(z767),e.z654=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z653(){return null!==t&&t.apply(this,arguments)||this}return __extends(z653,t),z653.prototype.update=function(t){z641.getz767(e.z670).removeEventListeners()},z653}(z767),e.z653=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z652(){return null!==t&&t.apply(this,arguments)||this}return __extends(z652,t),z652.prototype.update=function(t){z641.getz767(e.z669).removeEventListeners()},z652}(z767),e.z652=o}(z0||(z0={})),function(o){var i,t;i=o.z156||(o.z156={}),t=function(t){function z651(){return null!==t&&t.apply(this,arguments)||this}return __extends(z651,t),z651.prototype.update=function(t){var e=z641.getz767(i.z668);o.app.unregisterOnPointerDown("",e.createRandomFoodToDrag,e),o.app.unregisterOnPointerUp("",e.dropFood,e)},z651}(z767),i.z651=t}(z0||(z0={})),function(t){var o,e;o=t.z156||(t.z156={}),e=function(t){function z650(){return null!==t&&t.apply(this,arguments)||this}return __extends(z650,t),z650.prototype.update=function(t){z641.getz767(o.z667).removeEventListeners();var e=document.getElementById("zoom-ctn");e&&(e.style.visibility="hidden")},z650}(z767),o.z650=e}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z646(){return null!==t&&t.apply(this,arguments)||this}return __extends(z646,t),z646.prototype.update=function(t){e.app.unregisterOnPointerUp(e.WaterBottle.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Wheel1a.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Wheel1b.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Wheel1c.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Wheel2a.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Wheel2b.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Wheel2c.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Bowl1.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Bowl2.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.House.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.House2.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.House3.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.House4.name,e.app.setClickPoint,e.app)},z646}(z767),t.z646=o}(z0||(z0={})),function(t){var e,o;e=t.z156||(t.z156={}),o=function(t){function z551(){return null!==t&&t.apply(this,arguments)||this}return __extends(z551,t),z551.prototype.update=function(){},z551}(z767),e.z551=o}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z527(){return null!==t&&t.apply(this,arguments)||this}return __extends(z527,t),z527.prototype.update=function(){e.app.unregisterOnPointerUp(e.TubeStraight.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.TubeCurved.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.TubeCurved2.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.TubeTee.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.TubeCap.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.TubeCross.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Cage.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Cage2x2.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Cage2x3.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Cage2x4.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Cage3x2.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Cage3x3.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Cage3x4.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Cage4x2.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Cage4x3.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Cage4x4.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Bedding.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.BeddingSides.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Platform1.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Platform2.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.SimpleChew.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.SimpleChew2.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Bridge.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.Swing.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.WaterBottle1.name,e.app.setClickPoint,e.app),e.app.unregisterOnPointerUp(e.WaterBottle2.name,e.app.setClickPoint,e.app)},z527}(z767),t.z527=o}(z0||(z0={})),function(i){var t,e;t=i.z156||(i.z156={}),e=function(t){function z215(){return null!==t&&t.apply(this,arguments)||this}return __extends(z215,t),z215.prototype.update=function(){for(var t=i.z1062.activeObjects,e=t.length,o=0;o<e;o++)t[o].mesh.isVisible=!0},z215}(z767),t.z215=e}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z181(){return null!==t&&t.apply(this,arguments)||this}return __extends(z181,t),z181.prototype.update=function(){e.app.time=Date.now()},z181}(z767),t.z181=o}(z0||(z0={})),function(i){var t,e;t=i.z156||(i.z156={}),e=function(t){function z175(){return null!==t&&t.apply(this,arguments)||this}return __extends(z175,t),z175.prototype.update=function(){for(var t=i.z1062.activeObjects,e=t.length,o=0;o<e;o++)t[o].update()},z175}(z767),t.z175=e}(z0||(z0={})),function(o){var t,e;t=o.z156||(o.z156={}),e=function(t){function z174(){return null!==t&&t.apply(this,arguments)||this}return __extends(z174,t),z174.prototype.update=function(){for(var t=o.z1062.activeObjects.length,e=0;e<t;e++);},z174}(z767),t.z174=e}(z0||(z0={})),function(a){var t,e;t=a.z156||(a.z156={}),e=function(t){function z172(){return null!==t&&t.apply(this,arguments)||this}return __extends(z172,t),z172.prototype.update=function(){for(var t,e,o,i=a.app.graphicsHelper.objs,n=i.length;n--;){var s=i[n];s.update&&s.update(),s.body&&(t=s.body,isNaN(t.position.x)||(e=s.rotationQuaternion,o=t.orientation,e.x==o.x&&e.y==o.y&&e.z==o.z&&e.w==o.s||(s.rotationQuaternion.x=t.orientation.x,s.rotationQuaternion.y=t.orientation.y,s.rotationQuaternion.z=t.orientation.z,s.rotationQuaternion.w=t.orientation.s,s.onChangeObservable&&s.onChangeObservable.notifyObservers(s)),s.setPosition(t.position.x,t.position.y,t.position.z)))}},z172}(z767),t.z172=e}(z0||(z0={})),function(n){var t,e;t=n.z156||(n.z156={}),e=function(t){function z171(){return null!==t&&t.apply(this,arguments)||this}return __extends(z171,t),z171.prototype.update=function(){for(var t=n.app.updateOnce,e=t.length,o=0;o<e;o++)t[o]();t.length=0;var i=n.app.updateOnceNextFrame;for(o=0;o<i.length;o++)t.push(i[o]);n.app.updateOnceNextFrame.length=0},z171}(z767),t.z171=e}(z0||(z0={})),function(e){var t,o;t=e.z156||(e.z156={}),o=function(t){function z170(){return null!==t&&t.apply(this,arguments)||this}return __extends(z170,t),z170.prototype.update=function(){e.app.world.step()},z170}(z767),t.z170=o}(z0||(z0={})),function(o){var t=function(e){function z154(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z668],t.updatez156=[],t.exitz156=[o.z156.z651],t}return __extends(z154,e),z154}(z49);o.z154=t}(z0||(z0={})),function(o){var t=function(e){function z153(){var t=null!==e&&e.apply(this,arguments)||this;return t.historyLength=2,t.enterz156=[],t.updatez156=[o.z156.z181,o.z156.z178,o.z156.z175,o.z156.z170,o.z156.z172,o.z156.z171,o.z156.z180],t.exitz156=[],t.states=[o.z154,o.z150,o.z155,o.z152],t.initialState=o.z150,t}return __extends(z153,e),z153}(z49);o.z153=t}(z0||(z0={})),function(o){var t=function(e){function z152(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z762,o.z156.z663,o.z156.z667],t.updatez156=[],t.exitz156=[o.z156.z527,o.z156.z646,o.z156.z650],t}return __extends(z152,e),z152}(z49);o.z152=t}(z0||(z0={})),function(o){var t=function(e){function z151(){var t=null!==e&&e.apply(this,arguments)||this;return t.historyLength=2,t.enterz156=[],t.updatez156=[o.z156.z181,o.z156.z175,o.z156.z174,o.z156.z170,o.z156.z172,o.z156.z171,o.z156.z180],t.exitz156=[],t.states=[o.z154,o.z150,o.z155],t.initialState=o.z150,t}return __extends(z151,e),z151}(z49);o.z151=t}(z0||(z0={})),function(o){var t=function(e){function z150(){var t=null!==e&&e.apply(this,arguments)||this;return t.enterz156=[o.z156.z762,o.z156.z663,o.z156.z672,o.z156.z673,o.z156.z669,o.z156.z671,o.z156.z670],t.updatez156=[],t.exitz156=[o.z156.z527,o.z156.z646,o.z156.z655,o.z156.z656,o.z156.z652,o.z156.z654,o.z156.z653],t}return __extends(z150,e),z150}(z49);o.z150=t}(z0||(z0={}));